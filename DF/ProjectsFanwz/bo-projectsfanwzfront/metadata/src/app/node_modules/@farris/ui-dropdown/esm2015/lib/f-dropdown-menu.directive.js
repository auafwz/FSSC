/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, HostBinding, ElementRef, Input } from '@angular/core';
import { FDropdownDirective } from './f-dropdown.directive';
export class FDropdownMenuDirective {
    /**
     * @param {?} elementRef
     * @param {?} dropdown
     */
    constructor(elementRef, dropdown) {
        this.elementRef = elementRef;
        this.dropdown = dropdown;
        this._docRect = { width: 0, height: 0 };
        this.showDropdownMenu = true;
        // 内部使用，在不变更依赖的情况下，触发改变
        this.dpIsOpen = false;
        /** @type {?} */
        var me = this;
        this.dropdown.getOpenState().subscribe((/**
         * @param {?} state
         * @return {?}
         */
        (state) => {
            me.dpIsOpen = me.dropdown.isOpen;
            me.openStateChange();
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
    }
    /**
     * @private
     * @param {?} pment
     * @return {?}
     */
    getRealPlacement(pment) {
        /** @type {?} */
        var result = 'bottom-right';
        switch (pment) {
            case 'top':
                result = 'top-right';
                break;
            case 'left':
                result = 'left-bottom';
                break;
            case 'right':
                result = 'right-bottom';
                break;
            case 'bottom':
                result = 'bottom-right';
                break;
            default:
                result = pment;
        }
        return result;
    }
    /**
     * @private
     * @return {?}
     */
    openStateChange() {
        if (this.dpIsOpen) {
            if (this.elementRef.nativeElement.className.indexOf('show') < 0) {
                this.elementRef.nativeElement.className += ' show';
                if (this.dropdown.needToCalculate()) {
                    this._docRect = this.dropdown.getRectifyReferenceEl();
                }
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.changeDirection();
                }), 0);
            }
        }
        else {
            if (this.elementRef.nativeElement.className.indexOf('show') > -1) {
                this.elementRef.nativeElement.className = this.elementRef.nativeElement.className.replace(' show', ' ');
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    changeDirection() {
        if (this.dropdown.needToCalculate()) {
            /** @type {?} */
            const rect = this.elementRef.nativeElement.getBoundingClientRect();
            /** @type {?} */
            let placement = this.dropdown.placement;
            /** @type {?} */
            let newplacement = this.getRealPlacement(placement);
            placement = newplacement;
            //
            if (newplacement.indexOf('right') > -1 &&
                rect.right > this._docRect.width) {
                placement = placement.replace('right', 'left');
            }
            if (newplacement.indexOf('left') > -1 &&
                rect.left - rect.width < 0) {
                placement = placement.replace('left', 'right');
            }
            if (newplacement.indexOf('bottom') > -1 &&
                rect.bottom > this._docRect.height) {
                placement = placement.replace('down', 'up');
            }
            if (newplacement.indexOf('up') > -1 &&
                rect.bottom - rect.height < 0) {
                placement = placement.replace('up', 'bottom');
            }
            if (newplacement !== this.dropdown.placement) {
                this.dropdown.placement = newplacement;
            }
            if (placement !== newplacement) {
                this.dropdown.placement = placement;
            }
            this.dropdown.resetCalculate(false);
        }
    }
}
FDropdownMenuDirective.decorators = [
    { type: Directive, args: [{
                selector: '[fDropdownMenu]'
            },] }
];
/** @nocollapse */
FDropdownMenuDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: FDropdownDirective }
];
FDropdownMenuDirective.propDecorators = {
    showDropdownMenu: [{ type: HostBinding, args: ['class.dropdown-menu',] }],
    dpIsOpen: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    FDropdownMenuDirective.prototype._docRect;
    /** @type {?} */
    FDropdownMenuDirective.prototype.showDropdownMenu;
    /** @type {?} */
    FDropdownMenuDirective.prototype.dpIsOpen;
    /**
     * @type {?}
     * @private
     */
    FDropdownMenuDirective.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    FDropdownMenuDirective.prototype.dropdown;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZi1kcm9wZG93bi1tZW51LmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZHJvcGRvd24vIiwic291cmNlcyI6WyJsaWIvZi1kcm9wZG93bi1tZW51LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxXQUFXLEVBRVgsVUFBVSxFQUVWLEtBQUssRUFDTixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUs1RCxNQUFNLE9BQU8sc0JBQXNCOzs7OztJQU1qQyxZQUNVLFVBQXNCLEVBQ3RCLFFBQTRCO1FBRDVCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBb0I7UUFQOUIsYUFBUSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDUCxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7O1FBRWxELGFBQVEsR0FBQyxLQUFLLENBQUM7O1lBTW5CLEVBQUUsR0FBRyxJQUFJO1FBQ2IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxTQUFTOzs7O1FBQUMsQ0FBQyxLQUFjLEVBQUUsRUFBRTtZQUN4RCxFQUFFLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQ2pDLEVBQUUsQ0FBQyxlQUFlLEVBQUUsQ0FBQTtRQUN0QixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFDRCxrQkFBa0I7SUFFbEIsQ0FBQzs7Ozs7O0lBQ08sZ0JBQWdCLENBQUMsS0FBSzs7WUFDeEIsTUFBTSxHQUFHLGNBQWM7UUFDM0IsUUFBUSxLQUFLLEVBQUU7WUFDYixLQUFLLEtBQUs7Z0JBQ1IsTUFBTSxHQUFHLFdBQVcsQ0FBQztnQkFDckIsTUFBTTtZQUNSLEtBQUssTUFBTTtnQkFDVCxNQUFNLEdB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QUFDLENBQUM7YUFDL0M7WUFDRCxJQUFJLFlBQVksS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRTtnQkFDNUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDO2FBQ3hDO1lBQ0QsSUFBSSxTQUFTLEtBQUssWUFBWSxFQUFFO2dCQUM5QixJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7YUFDckM7WUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNyQztJQUNILENBQUM7OztZQW5HRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGlCQUFpQjthQUM1Qjs7OztZQVJDLFVBQVU7WUFJSCxrQkFBa0I7OzsrQkFPeEIsV0FBVyxTQUFDLHFCQUFxQjt1QkFFakMsS0FBSzs7Ozs7OztJQUhOLDBDQUEyQzs7SUFDM0Msa0RBQTREOztJQUU1RCwwQ0FBeUI7Ozs7O0lBR3ZCLDRDQUE4Qjs7Ozs7SUFDOUIsMENBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsXHJcbiAgSG9zdEJpbmRpbmcsXHJcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcclxuICBFbGVtZW50UmVmLFxyXG4gIE9wdGlvbmFsLFxyXG4gIElucHV0XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZEcm9wZG93bkRpcmVjdGl2ZSB9IGZyb20gJy4vZi1kcm9wZG93bi5kaXJlY3RpdmUnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZkRyb3Bkb3duTWVudV0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGRHJvcGRvd25NZW51RGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3Q2hlY2tlZCB7XHJcbiAgcHJpdmF0ZSBfZG9jUmVjdCA9IHsgd2lkdGg6IDAsIGhlaWdodDogMCB9O1xyXG4gIEBIb3N0QmluZGluZygnY2xhc3MuZHJvcGRvd24tbWVudScpIHNob3dEcm9wZG93bk1lbnUgPSB0cnVlO1xyXG4gIC8vIOWGhemDqOS9v+eUqO+8jOWcqOS4jeWPmOabtOS+nei1lueahOaDheWGteS4i++8jOinpuWPkeaUueWPmFxyXG4gIEBJbnB1dCgpICBkcElzT3Blbj1mYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICBwcml2YXRlIGRyb3Bkb3duOiBGRHJvcGRvd25EaXJlY3RpdmVcclxuICApIHtcclxuICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICB0aGlzLmRyb3Bkb3duLmdldE9wZW5TdGF0ZSgpLnN1YnNjcmliZSgoc3RhdGU6IGJvb2xlYW4pID0+IHtcclxuICAgICAgbWUuZHBJc09wZW4gPSBtZS5kcm9wZG93bi5pc09wZW47XHJcbiAgICAgIG1lLm9wZW5TdGF0ZUNoYW5nZSgpXHJcbiAgICB9KTtcclxuICB9XHJcbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xyXG4gIFxyXG4gIH1cclxuICBwcml2YXRlIGdldFJlYWxQbGFjZW1lbnQocG1lbnQpIHtcclxuICAgIHZhciByZXN1bHQgPSAnYm90dG9tLXJpZ2h0JztcclxuICAgIHN3aXRjaCAocG1lbnQpIHtcclxuICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICByZXN1bHQgPSAndG9wLXJpZ2h0JztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgcmVzdWx0ID0gJ2xlZnQtYm90dG9tJztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHJlc3VsdCA9ICdyaWdodC1ib3R0b20nO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdib3R0b20nOlxyXG4gICAgICAgIHJlc3VsdCA9ICdib3R0b20tcmlnaHQnO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJlc3VsdCA9IHBtZW50O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbiAgcHJpdmF0ZSBvcGVuU3RhdGVDaGFuZ2UoKSB7XHJcbiAgICBpZiAodGhpcy5kcElzT3Blbikge1xyXG4gICAgICBpZiAodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoJ3Nob3cnKSA8IDApIHtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc05hbWUgKz0gJyBzaG93JztcclxuICAgICAgICBpZiAodGhpcy5kcm9wZG93bi5uZWVkVG9DYWxjdWxhdGUoKSkge1xyXG4gICAgICAgICAgdGhpcy5fZG9jUmVjdCA9IHRoaXMuZHJvcGRvd24uZ2V0UmVjdGlmeVJlZmVyZW5jZUVsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldFRpbWVvdXQoKCk9PntcclxuICAgICAgICAgIHRoaXMuY2hhbmdlRGlyZWN0aW9uKCk7XHJcbiAgICAgICAgfSwwKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKCdzaG93JykgPiAtMSkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZSA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKCcgc2hvdycsICcgJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBjaGFuZ2VEaXJlY3Rpb24oKXtcclxuICAgIGlmICh0aGlzLmRyb3Bkb3duLm5lZWRUb0NhbGN1bGF0ZSgpKSB7XHJcbiAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgbGV0IHBsYWNlbWVudCA9IHRoaXMuZHJvcGRvd24ucGxhY2VtZW50O1xyXG4gICAgICBsZXQgbmV3cGxhY2VtZW50ID0gdGhpcy5nZXRSZWFsUGxhY2VtZW50KHBsYWNlbWVudCk7XHJcbiAgICAgIHBsYWNlbWVudCA9IG5ld3BsYWNlbWVudDtcclxuICAgICAgLy9cclxuICAgICAgaWYgKG5ld3BsYWNlbWVudC5pbmRleE9mKCdyaWdodCcpID4gLTEgJiZcclxuICAgICAgICByZWN0LnJpZ2h0ID4gdGhpcy5fZG9jUmVjdC53aWR0aFxyXG4gICAgICApIHtcclxuICAgICAgICBwbGFjZW1lbnQgPSBwbGFjZW1lbnQucmVwbGFjZSgncmlnaHQnLCAnbGVmdCcpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChcclxuICAgICAgICBuZXdwbGFjZW1lbnQuaW5kZXhPZignbGVmdCcpID4gLTEgJiZcclxuICAgICAgICByZWN0LmxlZnQgLSByZWN0LndpZHRoIDwgMFxyXG4gICAgICApIHtcclxuICAgICAgICBwbGFjZW1lbnQgPSBwbGFjZW1lbnQucmVwbGFjZSgnbGVmdCcsICdyaWdodCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgbmV3cGxhY2VtZW50LmluZGV4T2YoJ2JvdHRvbScpID4gLTEgJiZcclxuICAgICAgICByZWN0LmJvdHRvbSA+IHRoaXMuX2RvY1JlY3QuaGVpZ2h0XHJcbiAgICAgICkge1xyXG4gICAgICAgIHBsYWNlbWVudCA9IHBsYWNlbWVudC5yZXBsYWNlKCdkb3duJywgJ3VwJyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKFxyXG4gICAgICAgIG5ld3BsYWNlbWVudC5pbmRleE9mKCd1cCcpID4gLTEgJiZcclxuICAgICAgICByZWN0LmJvdHRvbSAtIHJlY3QuaGVpZ2h0IDwgMFxyXG4gICAgICApIHtcclxuICAgICAgICBwbGFjZW1lbnQgPSBwbGFjZW1lbnQucmVwbGFjZSgndXAnLCAnYm90dG9tJyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG5ld3BsYWNlbWVudCAhPT0gdGhpcy5kcm9wZG93bi5wbGFjZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmRyb3Bkb3duLnBsYWNlbWVudCA9IG5ld3BsYWNlbWVudDtcclxuICAgICAgfVxyXG4gICAgICBpZiAocGxhY2VtZW50ICE9PSBuZXdwbGFjZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmRyb3Bkb3duLnBsYWNlbWVudCA9IHBsYWNlbWVudDtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmRyb3Bkb3duLnJlc2V0Q2FsY3VsYXRlKGZhbHNlKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19