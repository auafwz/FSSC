/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, Renderer2, Injector, ViewChild, ElementRef } from '@angular/core';
import { LocaleService } from '@farris/ui-locale';
var PanelInputComponent = /** @class */ (function () {
    function PanelInputComponent(renderer, injector) {
        this.renderer = renderer;
        this.injector = injector;
        this.localStorageKey = 'farrisSearchRecord';
        this.searchHandle = new EventEmitter();
        this.submitChange = new EventEmitter();
        this.placeholder = '';
        this.searchTags = [];
        this.searchItems = [];
        this.searchFocus = false;
        this.historyText = '历史搜索';
        this.resultText = '查询结果';
        this.resultTitle = '历史搜索';
        this.localeService = this.injector.get(LocaleService);
    }
    Object.defineProperty(PanelInputComponent.prototype, "item", {
        get: /**
         * @return {?}
         */
        function () {
            return this._item;
        },
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            var _this = this;
            this._item = data;
            if (this._item) {
                if (!this._item.hasOwnProperty('value')) {
                    //this._item.value.value = undefined;
                    this._item.value = { value: '' };
                }
                if (this._item.placeHolder) {
                    this.placeholder = this._item.placeHolder || '';
                }
                this.inputValue = this._item.value.value;
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    /** @type {?} */
                    var filterPanelArray = JSON.parse(localStorage.getItem(_this.localStorageKey));
                    if (Array.isArray(filterPanelArray)) {
                        filterPanelArray = null;
                    }
                    if (filterPanelArray && filterPanelArray[_this._item.labelCode]) {
                        _this.searchTags = filterPanelArray[_this._item.labelCode];
                        _this.searchItems = filterPanelArray[_this._item.labelCode];
                    }
                }), 0);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PanelInputComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        this.renderer.listen(document, 'click', (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (!event.target.closest('.f-filter-search-result-panel') && !event.target.closest('.filter-type-input .form-control')) {
                self.searchFocus = false;
            }
        }));
        this.historyText = this.localeService.getValue('filterPanel.searchHistory');
        this.resultText = this.localeService.getValue('filterPanel.searchResult');
        this.resultTitle = this.historyText;
        this.setSubmitChange();
        this.inputText.nativeElement.focus();
    };
    /**
     * 绑定点击回车触发查询
     * @param e
     */
    /**
     * 绑定点击回车触发查询
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputKeyEnter = /**
     * 绑定点击回车触发查询
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this._item.value.value = this.inputValue;
        this._item.valueText = this._item.value.value;
        this.setSubmitChange();
        this.searchHandle.emit({ value: this._item.value.value, type: 'enter' });
    };
    /**
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputChanged = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this._item.value.value = this.inputValue;
        this._item.valueText = this._item.value.value;
        this.setSubmitChange();
        this.searchHandle.emit(this._item.value.value);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputValueChange = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.searchItems = this.searchTags;
        this.resultTitle = this.historyText;
        this._item.value.value = this.inputValue;
        this._item.valueText = this._item.value.value;
        this.setSubmitChange();
        if (this.inputValue && this.searchItems.length) {
            /** @type {?} */
            var arr = this.fuzzyQuery(this.searchItems, this.inputValue);
            if (arr.length) {
                this.searchItems = arr;
                this.resultTitle = this.resultText;
            }
            else {
                this.searchItems = this.searchTags;
                this.resultTitle = this.historyText;
            }
        }
    };
    /**
     * @private
     * @param {?} list
     * @param {?} keyWord
     * @return {?}
     */
    PanelInputComponent.prototype.fuzzyQuery = /**
     * @private
     * @param {?} list
     * @param {?} keyWord
     * @return {?}
     */
    function (list, keyWord) {
        /** @type {?} */
        var reg = new RegExp(keyWord);
        /** @type {?} */
        var arr = [];
        for (var i = 0; i < list.length; i++) {
            if (reg.test(list[i])) {
                arr.push(list[i]);
            }
        }
        return arr;
    };
    /**
     * @param {?} e
     * @return {?}
     */
    PanelInputComponent.prototype.inputFocus = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.searchFocus = true;
        this.inputValueChange(e);
    };
    /**
     * @param {?} tag
     * @param {?} event
     * @return {?}
     */
    PanelInputComponent.prototype.clickTag = /**
     * @param {?} tag
     * @param {?} event
     * @return {?}
     */
    function (tag, event) {
        event.stopPropagation();
        if (this.inputValue !== tag) {
            this.inputValue = tag;
            this._item.value.value = this.inputValue;
            this._item.valueText = this._item.value.value;
            this.setSubmitChange();
            this.searchHandle.emit({ value: this._item.value.value, type: 'enter' });
        }
    };
    /**
     * @param {?} tag
     * @param {?} index
     * @param {?} event
     * @return {?}
     */
    PanelInputComponent.prototype.removeTag = /**
     * @param {?} tag
     * @param {?} index
     * @param {?} event
     * @return {?}
     */
    function (tag, index, event) {
        event.stopPropagation();
        if (this.searchTags && this.searchTags.length) {
            this.searchTags.splice(index, 1);
        }
        this.searchItems = this.searchTags;
        /** @type {?} */
        var filterPanelArray = JSON.parse(localStorage.getItem(this.localStorageKey));
        if (Array.isArray(filterPanelArray)) {
            filterPanelArray = null;
        }
        if (filterPanelArray && filterPanelArray[this._item.labelCode]) {
            if (this.searchTags.length) {
                filterPanelArray[this._item.labelCode] = this.searchTags;
            }
            else {
                delete filterPanelArray[this._item.labelCode];
            }
        }
        localStorage.setItem(this.localStorageKey, JSON.stringify(filterPanelArray));
    };
    /**
     * @param {?} item
     * @param {?} event
     * @return {?}
     */
    PanelInputComponent.prototype.clickSearchItem = /**
     * @param {?} item
     * @param {?} event
     * @return {?}
     */
    function (item, event) {
        this.clickTag(item, event);
        this.searchFocus = false;
    };
    /**
     * @return {?}
     */
    PanelInputComponent.prototype.setSubmitChange = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var val = this._item.value;
        if (Object.keys(val).length < 0 || !val.value) {
            this.submitChange.emit(false);
        }
        else {
            this.submitChange.emit(true);
        }
    };
    /**
     * @return {?}
     */
    PanelInputComponent.prototype.showSearchTags = /**
     * @return {?}
     */
    function () {
        if (this.searchTags && this.searchTags.length > 0) {
            if (this.searchTags.length == 1 && this.searchTags[0].length == 0) {
                return false;
            }
            return true;
        }
        return false;
    };
    PanelInputComponent.decorators = [
        { type: Component, args: [{
                    selector: 'panel-filter-input',
                    template: "<input class=\"form-control\" type=\"text\" [(ngModel)]=\"inputValue\" [placeholder]=\"placeholder\"\r\n    (keyup.enter)=\"inputKeyEnter($event)\" (keyup)=\"inputValueChange($event)\" (blur)=\"inputChanged($event)\"\r\n    (focus)=\"inputFocus($event)\" #inputText>\r\n\r\n<!-- <div class=\"f-filter-search-result-panel\" [hidden]=\"!(searchItems && searchItems.length && searchFocus)\">\r\n    <div class=\"search-result-title\">{{ resultTitle }}</div>\r\n    <div class=\"search-result-list\">\r\n        <div class=\"search-result-item\" \r\n        *ngFor=\"let item of searchItems;\" \r\n        (click)=\"clickSearchItem(item,$event)\"\r\n        [innerHTML]=\"item | filterHighlightSearchResult:inputValue | filterSafe: 'html'\"\r\n        [title]=\"item\"\r\n        ></div>\r\n    </div>\r\n</div> -->\r\n\r\n<div class=\"f-filter-panel-search-tags\" *ngIf=\"showSearchTags()\">\r\n    <ng-container *ngFor=\"let tag of searchTags;let i = index;\">\r\n        <div class=\"panel-search-tag\" *ngIf=\"tag.length>0\">\r\n            <span class=\"panel-search-tag-text\" (click)=\"clickTag(tag,$event)\" [title]=\"tag\">{{tag}}</span>\r\n            <span class=\"panel-search-tag-remove f-icon modal_close\" (click)=\"removeTag(tag,i,$event)\"></span>\r\n        </div>\r\n    </ng-container>\r\n</div>"
                }] }
    ];
    /** @nocollapse */
    PanelInputComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: Injector }
    ]; };
    PanelInputComponent.propDecorators = {
        item: [{ type: Input }],
        localStorageKey: [{ type: Input }],
        searchHandle: [{ type: Output }],
        submitChange: [{ type: Output }],
        inputText: [{ type: ViewChild, args: ['inputText',] }]
    };
    return PanelInputComponent;
}());
export { PanelInputComponent };
if (false) {
    /** @type {?} */
    PanelInputComponent.prototype._item;
    /** @type {?} */
    PanelInputComponent.prototype.localStorageKey;
    /** @type {?} */
    PanelInputComponent.prototype.searchHandle;
    /** @type {?} */
    PanelInputComponent.prototype.submitChange;
    /** @type {?} */
    PanelInputComponent.prototype.inputText;
    /** @type {?} */
    PanelInputComponent.prototype.placeholder;
    /** @type {?} */
    PanelInputComponent.prototype.inputValue;
    /** @type {?} */
    PanelInputComponent.prototype.searchTags;
    /** @type {?} */
    PanelInputComponent.prototype.searchItems;
    /** @type {?} */
    PanelInputComponent.prototype.searchFocus;
    /** @type {?} */
    PanelInputComponent.prototype.localeService;
    /** @type {?} */
    PanelInputComponent.prototype.historyText;
    /** @type {?} */
    PanelInputComponent.prototype.resultText;
    /** @type {?} */
    PanelInputComponent.prototype.resultTitle;
    /**
     * @type {?}
     * @private
     */
    PanelInputComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    PanelInputComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXItcGFuZWwvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9pbnB1dGNvbXBvbmVudC9pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRDtJQWdESSw2QkFDWSxRQUFtQixFQUNuQixRQUFrQjtRQURsQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLGFBQVEsR0FBUixRQUFRLENBQVU7UUFmckIsb0JBQWUsR0FBRyxvQkFBb0IsQ0FBQztRQUN0QyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEMsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTVDLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBRWpCLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFDaEIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFFcEIsZ0JBQVcsR0FBRyxNQUFNLENBQUM7UUFDckIsZUFBVSxHQUFHLE1BQU0sQ0FBQztRQUNwQixnQkFBVyxHQUFHLE1BQU0sQ0FBQztRQUlqQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUE3Q0Qsc0JBQ0kscUNBQUk7Ozs7UUFEUjtZQUVBLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNsQixDQUFDOzs7OztRQUNELFVBQVMsSUFBSTtZQUFiLGlCQXNCQztZQXJCRyxJQUFJLENB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OztJQTZCWCw4Q0FBZ0Q7O0lBQ2hELDJDQUE0Qzs7SUFDNUMsMkNBQTRDOztJQUM1Qyx3Q0FBOEM7O0lBQzlDLDBDQUFpQjs7SUFDakIseUNBQW1COztJQUNuQix5Q0FBZ0I7O0lBQ2hCLDBDQUFpQjs7SUFDakIsMENBQW9COztJQUNwQiw0Q0FBNkI7O0lBQzdCLDBDQUFxQjs7SUFDckIseUNBQW9COztJQUNwQiwwQ0FBcUI7Ozs7O0lBRWpCLHVDQUEyQjs7Ozs7SUFDM0IsdUNBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgUmVuZGVyZXIyLCBJbmplY3RvciwgVmlld0NoaWxkLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncGFuZWwtZmlsdGVyLWlucHV0JyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9pbnB1dC5jb21wb25lbnQuaHRtbCdcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBQYW5lbElucHV0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIF9pdGVtOiBhbnk7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgZ2V0IGl0ZW0oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faXRlbTtcclxuICAgIH1cclxuICAgIHNldCBpdGVtKGRhdGEpIHtcclxuICAgICAgICB0aGlzLl9pdGVtID0gZGF0YTtcclxuICAgICAgICBpZiAodGhpcy5faXRlbSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX2l0ZW0uaGFzT3duUHJvcGVydHkoJ3ZhbHVlJykpIHtcclxuICAgICAgICAgICAgICAgIC8vdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWUgPSB7IHZhbHVlOiAnJyB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuX2l0ZW0ucGxhY2VIb2xkZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLl9pdGVtLnBsYWNlSG9sZGVyIHx8ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpbHRlclBhbmVsQXJyYXkgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubG9jYWxTdG9yYWdlS2V5KSk7XHJcbiAgICAgICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KGZpbHRlclBhbmVsQXJyYXkpKXtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJQYW5lbEFycmF5ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJQYW5lbEFycmF5ICYmIGZpbHRlclBhbmVsQXJyYXlbdGhpcy5faXRlbS5sYWJlbENvZGVdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hUYWdzID0gZmlsdGVyUGFuZWxBcnJheVt0aGlzLl9pdGVtLmxhYmVsQ29kZV07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hJdGVtcyA9IGZpbHRlclBhbmVsQXJyYXlbdGhpcy5faXRlbS5sYWJlbENvZGVdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCkgbG9jYWxTdG9yYWdlS2V5ID0gJ2ZhcnJpc1NlYXJjaFJlY29yZCc7XHJcbiAgICBAT3V0cHV0KCkgc2VhcmNoSGFuZGxlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIHN1Ym1pdENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBWaWV3Q2hpbGQoJ2lucHV0VGV4dCcpIGlucHV0VGV4dDogRWxlbWVudFJlZjtcclxuICAgIHBsYWNlaG9sZGVyID0gJyc7XHJcbiAgICBpbnB1dFZhbHVlOiBzdHJpbmc7XHJcbiAgICBzZWFyY2hUYWdzID0gW107XHJcbiAgICBzZWFyY2hJdGVtcyA9IFtdO1xyXG4gICAgc2VhcmNoRm9jdXMgPSBmYWxzZTtcclxuICAgIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2U7XHJcbiAgICBoaXN0b3J5VGV4dCA9ICfljoblj7LmkJzntKInO1xyXG4gICAgcmVzdWx0VGV4dCA9ICfmn6Xor6Lnu5PmnpwnO1xyXG4gICAgcmVzdWx0VGl0bGUgPSAn5Y6G5Y+y5pCc57SiJztcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG4gICAgfVxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oZG9jdW1lbnQsICdjbGljaycsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWV2ZW50LnRhcmdldC5jbG9zZXN0KCcuZi1maWx0ZXItc2VhcmNoLXJlc3VsdC1wYW5lbCcpICYmICFldmVudC50YXJnZXQuY2xvc2VzdCgnLmZpbHRlci10eXBlLWlucHV0IC5mb3JtLWNvbnRyb2wnKSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zZWFyY2hGb2N1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuaGlzdG9yeVRleHQgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLnNlYXJjaEhpc3RvcnknKTtcclxuICAgICAgICB0aGlzLnJlc3VsdFRleHQgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlclBhbmVsLnNlYXJjaFJlc3VsdCcpO1xyXG4gICAgICAgIHRoaXMucmVzdWx0VGl0bGUgPSB0aGlzLmhpc3RvcnlUZXh0O1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5pbnB1dFRleHQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDnu5Hlrprngrnlh7vlm57ovabop6blj5Hmn6Xor6JcclxuICAgICAqIEBwYXJhbSBlIFxyXG4gICAgICovXHJcbiAgICBpbnB1dEtleUVudGVyKGUpe1xyXG4gICAgICAgIHRoaXMuX2l0ZW0udmFsdWUudmFsdWUgPSB0aGlzLmlucHV0VmFsdWU7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U3VibWl0Q2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hIYW5kbGUuZW1pdCh7dmFsdWU6dGhpcy5faXRlbS52YWx1ZS52YWx1ZSx0eXBlOidlbnRlcid9KTtcclxuICAgIH1cclxuICAgIGlucHV0Q2hhbmdlZChlKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IHRoaXMuaW5wdXRWYWx1ZTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KHRoaXMuX2l0ZW0udmFsdWUudmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGlucHV0VmFsdWVDaGFuZ2UoZSkge1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSXRlbXMgPSB0aGlzLnNlYXJjaFRhZ3M7XHJcbiAgICAgICAgdGhpcy5yZXN1bHRUaXRsZSA9IHRoaXMuaGlzdG9yeVRleHQ7XHJcbiAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IHRoaXMuaW5wdXRWYWx1ZTtcclxuICAgICAgICB0aGlzLl9pdGVtLnZhbHVlVGV4dCA9IHRoaXMuX2l0ZW0udmFsdWUudmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZXRTdWJtaXRDaGFuZ2UoKTtcclxuICAgICAgICBpZih0aGlzLmlucHV0VmFsdWUgJiYgdGhpcy5zZWFyY2hJdGVtcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICBsZXQgYXJyID0gdGhpcy5mdXp6eVF1ZXJ5KHRoaXMuc2VhcmNoSXRlbXMsIHRoaXMuaW5wdXRWYWx1ZSk7XHJcbiAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEl0ZW1zID0gYXJyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRUaXRsZSA9IHRoaXMucmVzdWx0VGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSXRlbXMgPSB0aGlzLnNlYXJjaFRhZ3M7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdFRpdGxlID0gdGhpcy5oaXN0b3J5VGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZ1enp5UXVlcnkobGlzdCwga2V5V29yZCkge1xyXG4gICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKGtleVdvcmQpO1xyXG4gICAgICAgIHZhciBhcnIgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHJlZy50ZXN0KGxpc3RbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaChsaXN0W2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgfVxyXG5cclxuICAgIGlucHV0Rm9jdXMoZSkge1xyXG4gICAgICAgIHRoaXMuc2VhcmNoRm9jdXMgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaW5wdXRWYWx1ZUNoYW5nZShlKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGlja1RhZyh0YWcsIGV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRWYWx1ZSAhPT0gdGFnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRhZztcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZS52YWx1ZSA9IHRoaXMuaW5wdXRWYWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5faXRlbS52YWx1ZVRleHQgPSB0aGlzLl9pdGVtLnZhbHVlLnZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLnNldFN1Ym1pdENoYW5nZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnNlYXJjaEhhbmRsZS5lbWl0KHt2YWx1ZTp0aGlzLl9pdGVtLnZhbHVlLnZhbHVlLHR5cGU6J2VudGVyJ30pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlbW92ZVRhZyh0YWcsIGluZGV4LCBldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmICh0aGlzLnNlYXJjaFRhZ3MgJiYgdGhpcy5zZWFyY2hUYWdzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlYXJjaFRhZ3Muc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZWFyY2hJdGVtcyA9IHRoaXMuc2VhcmNoVGFncztcclxuICAgICAgICBsZXQgZmlsdGVyUGFuZWxBcnJheSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5sb2NhbFN0b3JhZ2VLZXkpKTtcclxuICAgICAgICBpZihBcnJheS5pc0FycmF5KGZpbHRlclBhbmVsQXJyYXkpKXtcclxuICAgICAgICAgICAgZmlsdGVyUGFuZWxBcnJheSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGZpbHRlclBhbmVsQXJyYXkgJiYgZmlsdGVyUGFuZWxBcnJheVt0aGlzLl9pdGVtLmxhYmVsQ29kZV0pe1xyXG4gICAgICAgICAgICBpZih0aGlzLnNlYXJjaFRhZ3MubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgIGZpbHRlclBhbmVsQXJyYXlbdGhpcy5faXRlbS5sYWJlbENvZGVdID0gdGhpcy5zZWFyY2hUYWdzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgZmlsdGVyUGFuZWxBcnJheVt0aGlzLl9pdGVtLmxhYmVsQ29kZV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5sb2NhbFN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KGZpbHRlclBhbmVsQXJyYXkpKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGlja1NlYXJjaEl0ZW0oaXRlbSwgZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmNsaWNrVGFnKGl0ZW0sIGV2ZW50KTtcclxuICAgICAgICB0aGlzLnNlYXJjaEZvY3VzID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U3VibWl0Q2hhbmdlKCl7XHJcbiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5faXRlbS52YWx1ZTtcclxuICAgICAgICBpZihPYmplY3Qua2V5cyh2YWwpLmxlbmd0aCA8IDAgfHwgIXZhbC52YWx1ZSl7XHJcbiAgICAgICAgICAgIHRoaXMuc3VibWl0Q2hhbmdlLmVtaXQoZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHNob3dTZWFyY2hUYWdzKCl7XHJcbiAgICAgICAgaWYodGhpcy5zZWFyY2hUYWdzJiZ0aGlzLnNlYXJjaFRhZ3MubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICBpZih0aGlzLnNlYXJjaFRhZ3MubGVuZ3RoPT0xJiZ0aGlzLnNlYXJjaFRhZ3NbMF0ubGVuZ3RoPT0wKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==