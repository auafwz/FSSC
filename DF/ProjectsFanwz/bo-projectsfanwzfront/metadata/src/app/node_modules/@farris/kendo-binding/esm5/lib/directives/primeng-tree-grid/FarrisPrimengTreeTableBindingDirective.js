/*******************************************************************************************************************
 *                                     FarrisPrimengTreeTableBindingDirective指令说明                               *
 * *****************************************************************************************************************
 *
 * 1. 依赖primeng版本: primeng:^9.0.0,primeicons:^4.0.0
 *
 * 2. 由于可编辑树表无法触发编辑单元格的关闭事件onEditComplete，因此对priemeng的node_modules\primeng\fesm5\primeng-treetable.js脚本作出修改：
 *    源码修改如下，+表示新增加的脚本语句:
 *
 *  TreeTable.prototype.updateEditingCell = function (cell, data, field) { //+ 参数增加data和field
 *      this.editingCell = cell;
 *      this.editingCellData = data; //+
 *      this.editingCellField = field; //+
 *      this.bindDocumentEditListener();
 *  };
 *
 *  TreeTable.prototype.bindDocumentEditListener = function () {
 *       var _this = this;
 *       if (!this.documentEditListener) {
 *           this.documentEditListener = function (event) {
 *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {
 *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');
 *                   _this.editingCell = null;
 *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+
 *                   _this.unbindDocumentEditListener();
 *               }
 *               _this.editingCellClick = false;
 *           };
 *           document.addEventListener('click', this.documentEditListener);
 *       }
 *   };
 *
 *  TreeTable.prototype.bindDocumentEditListener = function () {
 *       var _this = this;
 *       if (!this.documentEditListener) {
 *           this.documentEditListener = function (event) {
 *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {
 *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');
 *                   _this.editingCell = null;
 *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+
 *                   _this.unbindDocumentEditListener();
 *               }
 *               _this.editingCellClick = false;
 *           };
 *           document.addEventListener('click', this.documentEditListener);
 *       }
 *   };
 *
 *  TTEditableColumn.prototype.openCell = function () {
 *       var _this = this;
 *        this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);//+
 *        domhandler_1.DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');
 *        this.tt.onEditInit.emit({ field: this.field, data: this.data });
 *        this.zone.runOutsideAngular(function () {
 *            setTimeout(function () {
 *                var focusable = domhandler_1.DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');
 *                if (focusable) {
 *                     focusable.focus();
 *                 }
 *             }, 50);
 *        });
 *   };
 *
 *  TTEditableColumn.prototype.onClick = function (event) {
 *        if (this.isEnabled()) {
 *            this.tt.editingCellClick = true;
 *            if (this.tt.editingCell) {
 *                if (this.tt.editingCell !== this.el.nativeElement) {
 *                    if (!this.tt.isEditingCellValid()) {
 *                        return;
 *                    }
 *                    this.tt.onEditComplete.emit({ field: this.tt.oldField, data: this.tt.oldDdata });//+
 *                    DomHandler.removeClass(this.tt.editingCell, 'ui-editing-cell');
 *                    this.openCell();
 *                }
 *            }
 *            else {
 *                this.openCell();
 *            }
 *        }
 *  };
 *
 *  TTEditableColumn.prototype.openCell = function () {
 *         var _this = this;
 *         this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);
 *         DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');
 *         this.tt.onEditInit.emit({ field: this.field, data: this.data });
 *         this.tt.oldField= this.field; //+
 *         this.tt.oldDdata=this.data;  //+
 *         this.zone.runOutsideAngular(function () {
 *             setTimeout(function () {
 *                 var focusable = DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');
 *                if (focusable) {
 *                     focusable.focus();
 *                 }
 *           }, 50);
 *       });
 *   };
 *
 * 3. HTML模板
 * (1) 不启用多表头
 *      <p-treeTable [columns]="treeGridColumns" farrisPrimengTreeTableBinding farrisHierarchyInfoKey="layerField" [resizableColumns]="true" farrisPrimengTreeTableIdField="id">
 *             <ng-template pTemplate="header" let-columns>
 *                 <tr>
 *                     <th *ngFor="let col of columns" ttResizableColumn>
 *                         {{col.header}}
 *                     </th>
 *                 </tr>
 *             </ng-template>
 *             <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
 *                 <tr>
 *                     <td *ngFor="let col of columns; let i = index" ttEditableColumn [ttEditableColumn]="rowData"
 *                         [ttEditableColumnField]="col.field">
 *                         <p-treeTableToggler [rowNode]="rowNode" *ngIf="i === 0"></p-treeTableToggler>
 *                         <p-treeTableCellEditor>
 *                             <ng-template pTemplate="input">
 *                                  <!-- 控件动态生成区域，此处可放置控件动态生成组件，生成规则如下：
 *                                            1. 字符串类型：文本控件
 *                                            2. 数字类型：数字控件
 *                                            3. 布尔类型：复选框控件
 *                                            4. 日期时间类型：日期时间控件
 *                                            5. 枚举类型：下拉框控件
 *                                            6. 帮助类型：帮助控件-->
 *                             </ng-template>
 *                             <ng-template pTemplate="output">{{ col | formatCellData : rowData }}</ng-template>
 *                         </p-treeTableCellEditor>
 *                     </td>
 *                 </tr>
 *             </ng-template>
 *     </p-treeTable>
 *
 * (2) 启用多表头
 *
 *  <p-treeTable [columns]="treeGridColumns" farrisPrimengTreeTableBinding farrisHierarchyInfoKey="layerField" [resizableColumns]="true" farrisPrimengTreeTableIdField="id">
 *             <ng-template pTemplate="header" let-columns>
 *                  <tr *ngFor="let columnHeader of treeGridColumnHeaders">
 *                      <th *ngFor="let col of columnHeader" ttResizableColumn [attr.rowspan]="col.rowspan" [attr.colspan]="col.colspan">
 *                          {{col.header}}
 *                      </th>
 *                  </tr>
 *             </ng-template>
 *             <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
 *                 <tr>
 *                     <td *ngFor="let col of columns; let i = index" ttEditableColumn [ttEditableColumn]="rowData"
 *                         [ttEditableColumnField]="col.field">
 *                         <p-treeTableToggler [rowNode]="rowNode" *ngIf="i === 0"></p-treeTableToggler>
 *                         <p-treeTableCellEditor>
 *                             <ng-template pTemplate="input">
 *                                  <!-- 控件动态生成区域，此处可放置控件动态生成组件，生成规则如下：
 *                                            1. 字符串类型：文本控件
 *                                            2. 数字类型：数字控件
 *                                            3. 布尔类型：复选框控件
 *                                            4. 日期时间类型：日期时间控件
 *                                            5. 枚举类型：下拉框控件
 *                                            6. 帮助类型：帮助控件-->
 *                             </ng-template>
 *                             <ng-template pTemplate="output">{{ col | formatCellData : rowData }}</ng-template>
 *                         </p-treeTableCellEditor>
 *                     </td>
 *                 </tr>
 *             </ng-template>
 *  </p-treeTable>
 *
 * 多表头数据格式：
 *  this.treeGridColumnHeaders=[
 *     [{ header: 'Brand',rowspan:3, colspan:1},{ header: 'Sale Rate',rowspan:1, colspan:4}],
 *     [{ header: 'Sales',rowspan:1, colspan:2},{ header: 'Profits',rowspan:1, colspan:2}],
 *     [{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1},{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1}],
 *  ]

 **********************************************************************************************************************/
import * as tslib_1 from "tslib";
import { Directive, Input, HostListener, Output, EventEmitter } from '@angular/core';
import { FrameContext, ChangeType } from '@farris/devkit';
import { TreeTable } from 'primeng/treetable';
import { TreeNodeBuilderFactory } from '../tree_table_node_builder/tree_node_builder_factory';
import { DateTimeHelperService } from '@farris/ui-common/date';
var PARENT_ELEMENT = "parentElement";
var PATH = "path";
var IS_DETAIL = 'isDetail';
var FarrisPrimengTreeTableBindingDirective = /** @class */ (function () {
    function FarrisPrimengTreeTableBindingDirective(treeTable, frameContext, dateService) {
        this.treeTable = treeTable;
        this.frameContext = frameContext;
        this.dateService = dateService;
        this.selectedRowId = null;
        this.treeTableSelectedEvent = null;
        /**
         * 节点选择变更事件
         */
        this.nodeSelectChange = new EventEmitter();
        this.oldTreeNodeMap = {};
    }
    Object.defineProperty(FarrisPrimengTreeTableBindingDirective.prototype, "bindingData", {
        /**
         * 绑定数据
         */
        get: function () {
            return this.frameContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisPrimengTreeTableBindingDirective.prototype, "bindingList", {
        /**
         * 绑定数据列表
         */
        get: function () {
            return this.bindingData.getList();
        },
        enumerable: true,
        configurable: true
    });
    FarrisPrimengTreeTableBindingDirective.prototype.getHierarchyInfoField = function () {
        var infos = this.hierarchyInfoKey.split('/');
        return infos[infos.length - 1];
    };
    FarrisPrimengTreeTableBindingDirective.prototype.ngOnChanges = function (changes) {
    };
    FarrisPrimengTreeTableBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        //解析获取分级码字段编号
        this.hierarchyInfoField = this.getHierarchyInfoField();
        // 将分级码信息保存到root-component
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);
        this.bindingData.changes.subscribe(function (change) {
            _this.bindData(change);
            _this.updateSelectedRow(change);
        });
        this.frameContext.viewModel.uiState.setPropertyValue('ids', []);
    };
    /**
     * 获取树列表绑定数据对应的实体数组
     * @returns 实体数组
     */
    FarrisPrimengTreeTableBindingDirective.prototype.getEntityArr = function () {
        var entityCollection = this.frameContext.repository.entityCollection;
        var bindingPath = this.frameContext.bindingData.bindingPath;
        if (!bindingPath || bindingPath === '/') {
            return entityCollection.toArray();
        }
        var bindingList = this.frameContext.bindingData.list;
        var bindingPathArr = bindingPath.split('/').filter(function (str) { return str; });
        var pathArray = [];
        bindingPathArr.forEach(function (path) {
            pathArray.push(bindingList.primaryKey + ":" + bindingList.currentId);
            pathArray.push(path);
            bindingList = bindingList.currentItem[path];
        });
        return entityCollection.getEntitiesByPath(pathArray).toArray();
    };
    /**
     * 将真实顺序标记到对应的实体上
     * @param entityArr 实体数组
     * @param treeNodes 树节点
     */
    FarrisPrimengTreeTableBindingDirective.prototype.setActualIndex = function (entityArr, treeNodes) {
        var _this = this;
        if (entityArr.length < 1)
            return;
        // 初始化序号器并依次遍历每一棵树
        var counter = { index: 0 };
        var primaryKey = entityArr[0].primaryKey;
        treeNodes.forEach(function (rootNode) {
            _this.traverseTree(rootNode, counter, entityArr, primaryKey);
        });
    };
    /**
     * 前序递归遍历树节点并在对应实体上标记序号
     * @param treeNode 树节点
     * @param counter 序号器
     * @param entityArr 实体数组
     * @description
     * 在进行前端校验时，按照Entity在数组中的下标生成（错误提示的）行号的方式不适用于树列表，
     * 因为树列表可以在已经添加的节点上加入子节点，而Entity总是在最后追加新对象，导致二者的顺序不一定相同，
     * 所以在绑定数据的时候将树节点在列表中的真实顺序通过一个附加的属性（__ACTUAL_INDEX__）赋给Entity示例，
     * 当Entity调用validate方法时，检查是否存在该属性，如果存在则应用该属性的值作为行号。
     */
    FarrisPrimengTreeTableBindingDirective.prototype.traverseTree = function (treeNode, counter, entityArr, primaryKey) {
        var _this = this;
        var INDEX_LABEL = "__ACTUAL_INDEX__";
        // 处理当前节点
        var entity = entityArr.find(function (e) { return e[primaryKey] === treeNode.data[primaryKey]; });
        if (entity) {
            Object.defineProperty(entity, INDEX_LABEL, {
                value: counter.index
            });
            counter.index++;
        }
        // 递归遍历分支
        treeNode.children.forEach(function (rootNode) {
            _this.traverseTree(rootNode, counter, entityArr, primaryKey);
        });
    };
    /**
     * 处理数据变更
     * @param change 变更
     * @returns 是否跳过绑定数据的整体刷新
     * @description
     * 目的是尽量少的重新构造整个树列表，比如在发生值变化事件时尽量只更改变化的值就结束，
     * 如果任何变化都重新构造树，会导致Tab键切换功能难以实现等问题。
     */
    FarrisPrimengTreeTableBindingDirective.prototype.handleChange = function (change) {
        // 没有变更时，继续绑定数据刷新
        if (!change)
            return false;
        // 分类处理具体的变更
        switch (change.type) {
            case ChangeType.SelectionChanged:
                return this.handleSelectionChanged(change);
            case ChangeType.GlobalSelectionChanged:
                return this.handleSelectionChanged(change);
            case ChangeType.ValueChanged:
                return this.handleValueChanged(change);
            default:
                return false;
        }
    };
    /**
     * 处理行切换变更
     * @param change 变更
     * @returns 是否跳过绑定数据的整体刷新
     */
    FarrisPrimengTreeTableBindingDirective.prototype.handleSelectionChanged = function (change) {
        // 当前绑定路径下发生行切换事件，不进行数据刷新（为了支持Tab键切换单元格）
        if (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) {
            var path = change.path;
            var frmPath = this.bindingData.bindingPath.split("/").filter(function (str) { return str; });
            if (path.length === frmPath.length) {
                var same = true;
                for (var i = 0; i < path.length; i++) {
                    if (path[i] !== frmPath[i])
                        same = false;
                }
                if (same)
                    return true;
            }
        }
        return false;
    };
    /**
     * 处理行切换变更
     * @param change 变更
     * @returns 是否跳过绑定数据的整体刷新
     */
    FarrisPrimengTreeTableBindingDirective.prototype.handleValueChanged = function (change) {
        var e_1, _a, e_2, _b;
        if (change.type !== ChangeType.ValueChanged) {
            return false;
        }
        // 接收到值变化事件，尝试仅进行局部数据的更新（为了支持Tab键切换单元格）
        var path = change.path;
        var bindingPathArr = this.bindingData.bindingPath.split("/").filter(function (str) { return str; });
        try {
            // 判断绑定路径是否相同，如果不相同则整体刷新
            for (var bindingPathArr_1 = tslib_1.__values(bindingPathArr), bindingPathArr_1_1 = bindingPathArr_1.next(); !bindingPathArr_1_1.done; bindingPathArr_1_1 = bindingPathArr_1.next()) {
                var item = bindingPathArr_1_1.value;
                if (path.length > 0) {
                    if (item === path[0]) {
                        path.shift();
                    }
                    else {
                        return false;
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (bindingPathArr_1_1 && !bindingPathArr_1_1.done && (_a = bindingPathArr_1.return)) _a.call(bindingPathArr_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // 通过id找到待更新的树节点
        var id = change.id;
        if (id) {
            var primaryKey = this.bindingList.primaryKey;
            var nodes = this.treeTable.value;
            var targetNode = null;
            try {
                for (var nodes_1 = tslib_1.__values(nodes), nodes_1_1 = nodes_1.next(); !nodes_1_1.done; nodes_1_1 = nodes_1.next()) {
                    var node = nodes_1_1.value;
                    var result = this.findTreeNodeById(node, primaryKey, id);
                    if (result) {
                        targetNode = result;
                        break;
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (nodes_1_1 && !nodes_1_1.done && (_b = nodes_1.return)) _b.call(nodes_1);
                }
                finally { if (e_2) throw e_2.error; }
            }
            if (targetNode && path.length === 1) {
                var propertyName = path.shift();
                if (targetNode.data.hasOwnProperty(propertyName) && change.hasOwnProperty("value")) {
                    targetNode.data[propertyName] = change.value;
                    return true;
                }
            }
        }
        return false;
    };
    /**
     * 通过主键值查找树节点
     * @param treeNode 树根节点
     * @param primaryKey 主键名
     * @param keyValue 主键值
     * @returns 树节点
     * @todo 递归遍历实现比较低效，考虑通过oldTreeNodeMap查找树节点
     */
    FarrisPrimengTreeTableBindingDirective.prototype.findTreeNodeById = function (treeNode, primaryKey, keyValue) {
        var e_3, _a;
        if (!treeNode)
            return null;
        if (treeNode.data.hasOwnProperty(primaryKey) && treeNode.data[primaryKey] === keyValue)
            return treeNode;
        if (treeNode.children) {
            try {
                for (var _b = tslib_1.__values(treeNode.children), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var node = _c.value;
                    var result = this.findTreeNodeById(node, primaryKey, keyValue);
                    if (result)
                        return result;
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        return null;
    };
    /**
    * 绑定数据
    */
    FarrisPrimengTreeTableBindingDirective.prototype.bindData = function (change) {
        var skipRefresh = this.handleChange(change);
        if (skipRefresh) {
            return;
        }
        // this.sourceData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        var oldTreeNodes = this.treeTable.value;
        var treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        var treeNodes = [];
        if (treeNodesData && treeNodesData.length > 0) {
            var hierarchyInfo = treeNodesData[0][this.hierarchyInfoField];
            var builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);
            // 服务器返回的分级节点信息匹配不到现有工厂里面的任何一种情况。确认新加的builder已经在工厂中注册
            if (builder == null) {
                throw new Error('TreeTable builder is null!');
            }
            var expandLevel = -1;
            var treeExpandLevel = this.treeTable['expandLevel'];
            if (typeof treeExpandLevel !== 'undefined') {
                expandLevel = treeExpandLevel;
            }
            var context = {
                expandLevel: expandLevel,
                component: this.treeTable,
            };
            var treeNodesBuilder = new builder(treeNodesData, oldTreeNodes, this.bindingList.primaryKey, this.hierarchyInfoField, context);
            treeNodes = treeNodesBuilder.build();
            // 获取绑定数据对应的实体列表
            var entityArr = this.getEntityArr();
            // 根据treeNodes的顺序在对应的实体上添加序号字段__ACTUAL_INDEX__
            this.setActualIndex(entityArr, treeNodes);
        }
        if (!this.treeTable.lazy) {
            this.treeTable.totalRecords = (this.treeTable._value ? this.treeTable._value.length : 0);
            if (this.treeTable.sortMode == 'single' && this.treeTable.sortField)
                this.treeTable.sortSingle();
            else if (this.treeTable.sortMode == 'multiple' && this.treeTable.multiSortMeta)
                this.treeTable.sortMultiple();
            else if (this.treeTable.hasFilter()) //sort already filters
                this.treeTable._filter();
        }
        this.treeTable.tableService.onUIUpdate(treeNodes);
        this.treeTable.value = treeNodes;
        this.treeTable.updateSerializedValue();
        // this.treeNodeMap = {};
        // this.sourceDataClone = this.sourceData;
        // this.treeTable.value = [...this.treeNodesBuilder()];
        // this.treeTableValueHandler();
    };
    FarrisPrimengTreeTableBindingDirective.prototype.updateSelectedRow = function (change) {
        var currentId = this.bindingList.currentId;
        if (this.treeTableSelectedEvent) {
            this.treeTableSelectedEvent = false;
            this.selectedRowId = currentId;
            return;
        }
        var serializedValue = this.treeTable.serializedValue;
        var treeNode = serializedValue && serializedValue.find(function (item) { return item && item.node && item.node.data && item.node.data.id === currentId; }) || null;
        if (treeNode) {
            if (this.treeTable.isSelected(treeNode.node) || currentId === this.selectedRowId) {
                return;
            }
            this.selectedRowId = currentId;
            this.treeTable.handleRowClick({ rowNode: treeNode, originalEvent: { target: { nodeName: '' } } });
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onEditInitHandler = function (event) {
        this.nodeSelectChange.emit(event['data']);
        var id = event.data[this.idField];
        this.setCurrentIdToBindingList(id);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onEditCompleteHandler = function (event) {
        var fieldName = event.field;
        var column = this.columns.find(function (item) { return item.field === fieldName; });
        if (fieldName && column && column.editor && column.editor.options && column.editor.options.type === 'EditorTypes.LOOKUP') {
            return;
        }
        if (event && event.hasOwnProperty('data')) {
            var primaryKeyValue = event.data[this.frameContext.repository.primaryKey];
            var value = this.getValue(fieldName, event.data);
            var bindingPath = this.frameContext.viewModel.bindingPath || '/';
            var bindingPaths = bindingPath.split('/').filter(function (p) { return p; });
            var bindingData = this.bindingData.getValue(bindingPaths);
            var oldValue = this.getValue(fieldName, bindingData);
            var column_1 = this.treeTable.columns.find(function (item) { return item.field === fieldName; });
            var dataType = column_1 && column_1.dataType || null;
            if (dataType === 'date' || dataType === 'datetime') {
                if (this.dateService) {
                    var format = column_1 && column_1.formatter && column_1.formatter.options && column_1.formatter.options.format || 'yyyy-MM-dd';
                    value = this.dateService.formatTo(value, format);
                    if (!value) {
                        value = null;
                    }
                }
            }
            else if (dataType === 'number') {
                value = Number(value);
            }
            if (value !== oldValue) {
                this.updateBindingList(primaryKeyValue, fieldName, value);
            }
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeExpandHandler = function (event) {
        // this.setNodeExpandedValue(event);
        var selectedId = event && event.node && event.node.id || null;
        if (!selectedId) {
            return;
        }
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        var expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(selectedId);
        virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeCollapseHandler = function (event) {
        // this.setNodeExpandedValue(event);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeSelectHandler = function (event) {
        var id = event && event.node && event.node.data && event.node.data[this.frameContext.repository.primaryKey] || null;
        if (id === this.bindingList.currentId) {
            return;
        }
        this.treeTableSelectedEvent = true;
        this.setCurrentIdToBindingList(id);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeUnselectHandler = function (event) {
        this.setCurrentIdToBindingList(null);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.setNodeExpandedValue = function (event) {
        if (!event || !this.oldTreeNodeMap || Object.keys(this.oldTreeNodeMap).length <= 0) {
            return;
        }
        try {
            var currentId = event.node.data.id;
            this.oldTreeNodeMap[currentId].expanded = event.expanded;
        }
        catch (e) {
            console.warn("setNodeExpandedValue error:" + e.message);
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.setCurrentIdToBindingList = function (selectedId) {
        var oldCurrentId = this.bindingList.currentId;
        if (oldCurrentId === selectedId) {
            return;
        }
        this.bindingList.setCurrentId(selectedId, true);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.getPaths = function () {
        var paths = [];
        if (!this.frameContext.viewModel || !this.frameContext.viewModel.bindingPath || this.frameContext.viewModel.bindingPath === '/') {
            return paths;
        }
        else {
            var bindingPath = this.frameContext.viewModel.bindingPath;
            paths = bindingPath.substring(1, bindingPath.length).split('/');
            return paths;
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.updateBindingList = function (primaryValue, propertyName, value) {
        if (!propertyName) {
            return;
        }
        // 更新主表部分行的字段
        var propertyNames = propertyName.split('.').filter(function (item) { return item; });
        var bindingPath = this.getBindingPathArray();
        // 取出来的一定是bindingList
        var list = this.bindingData.getValue(bindingPath);
        // 修改的是当前行
        var paths = bindingPath.concat(propertyNames);
        if (list && primaryValue === list.currentItem.primaryKeyValue) {
            this.bindingData.setValue(paths, value, true, true);
            return;
        }
        var bindingObject = this.bindingList.findById(primaryValue);
        if (!bindingObject) {
            return;
        }
        if (propertyNames.length < 2) {
            bindingObject.setValue(propertyName, value, true, true, this.bindingData.getValudChangeInvokerFactory()(paths));
        }
        else {
            var targetBindingObject_1 = null;
            var fpaths = propertyNames.slice(0, propertyNames.length - 1);
            var targetPropertyName = propertyNames[propertyNames.length - 1];
            fpaths.forEach(function (prop) {
                targetBindingObject_1 = targetBindingObject_1 && targetBindingObject_1[prop] || bindingObject[prop];
            });
            // todo:需要添加值变化事件
            targetBindingObject_1.setValue(targetPropertyName, value, true, true, this.bindingData.getValudChangeInvokerFactory()(paths));
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.getBindingPathArray = function () {
        var path = this.frameContext.viewModel.bindingPath;
        if (path) {
            return path.split('/').filter(function (n) { return n !== ''; });
        }
        return [];
    };
    FarrisPrimengTreeTableBindingDirective.prototype.getValue = function (path, data) {
        var value = '';
        if (path.indexOf('.') === -1) {
            value = data[path];
        }
        else {
            value = path.split('.').reduce(function (result, prop) {
                return result[prop];
            }, data);
        }
        return value;
    };
    FarrisPrimengTreeTableBindingDirective.prototype.setChecks = function (ids) {
        this.frameContext.viewModel.uiState.setPropertyValue('ids', ids);
    };
    FarrisPrimengTreeTableBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisPrimengTreeTableBinding]'
                },] }
    ];
    /** @nocollapse */
    FarrisPrimengTreeTableBindingDirective.ctorParameters = function () { return [
        { type: TreeTable },
        { type: FrameContext },
        { type: DateTimeHelperService }
    ]; };
    FarrisPrimengTreeTableBindingDirective.propDecorators = {
        hierarchyInfoKey: [{ type: Input, args: ['farrisHierarchyInfoKey',] }],
        columns: [{ type: Input, args: ['columns',] }],
        idField: [{ type: Input, args: ['farrisPrimengTreeTableIdField',] }],
        nodeSelectChange: [{ type: Output }],
        onEditInitHandler: [{ type: HostListener, args: ['onEditInit', ['$event'],] }],
        onEditCompleteHandler: [{ type: HostListener, args: ['onEditComplete', ['$event'],] }],
        onNodeExpandHandler: [{ type: HostListener, args: ['onNodeExpand', ['$event'],] }],
        onNodeCollapseHandler: [{ type: HostListener, args: ['onNodeCollapse', ['$event'],] }],
        onNodeSelectHandler: [{ type: HostListener, args: ['onNodeSelect', ['$event'],] }],
        onNodeUnselectHandler: [{ type: HostListener, args: ['onNodeUnselect', ['$event'],] }]
    };
    return FarrisPrimengTreeTableBindingDirective;
}());
export { FarrisPrimengTreeTableBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmFycmlzUHJpbWVuZ1RyZWVUYWJsZUJpbmRpbmdEaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9wcmltZW5nLXRyZWUtZ3JpZC9GYXJyaXNQcmltZW5nVHJlZVRhYmxlQmluZGluZ0RpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7d0hBMEt3SDs7QUFFeEgsT0FBTyxFQUFFLFNBQVMsRUFBb0MsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFRLE1BQU0sZUFBZSxDQUFDO0FBQzdILE9BQU8sRUFBNEIsWUFBWSxFQUFVLFVBQVUsRUFBd0MsTUFBTSxnQkFBZ0IsQ0FBQztBQUNsSSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFOUMsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sc0RBQXNELENBQUM7QUFDOUYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDL0QsSUFBTSxjQUFjLEdBQVcsZUFBZSxDQUFDO0FBQy9DLElBQU0sSUFBSSxHQUFXLE1BQU0sQ0FBQztBQUM1QixJQUFNLFNBQVMsR0FBVyxVQUFVLENBQUM7QUFNckM7SUFtREUsZ0RBQ1UsU0FBb0IsRUFDcEIsWUFBMEIsRUFDMUIsV0FBa0M7UUFGbEMsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7UUFsRHBD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RSxDQUFDLFFBQVEsQ0FBQzt3Q0FTdkMsWUFBWSxTQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDOztJQXVGNUMsNkNBQUM7Q0FBQSxBQWhlRCxJQWdlQztTQTdkWSxzQ0FBc0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYXJyaXNQcmltZW5nVHJlZVRhYmxlQmluZGluZ0RpcmVjdGl2ZeaMh+S7pOivtOaYjiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqXHJcbiAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAqIFxyXG4gKiAxLiDkvp3otZZwcmltZW5n54mI5pysOiBwcmltZW5nOl45LjAuMCxwcmltZWljb25zOl40LjAuMFxyXG4gKiBcclxuICogMi4g55Sx5LqO5Y+v57yW6L6R5qCR6KGo5peg5rOV6Kem5Y+R57yW6L6R5Y2V5YWD5qC855qE5YWz6Zet5LqL5Lu2b25FZGl0Q29tcGxldGXvvIzlm6DmraTlr7lwcmllbWVuZ+eahG5vZGVfbW9kdWxlc1xccHJpbWVuZ1xcZmVzbTVcXHByaW1lbmctdHJlZXRhYmxlLmpz6ISa5pys5L2c5Ye65L+u5pS577yaIFxyXG4gKiAgICDmupDnoIHkv67mlLnlpoLkuIvvvIwr6KGo56S65paw5aKe5Yqg55qE6ISa5pys6K+t5Y+lOlxyXG4gKiBcclxuICogIFRyZWVUYWJsZS5wcm90b3R5cGUudXBkYXRlRWRpdGluZ0NlbGwgPSBmdW5jdGlvbiAoY2VsbCwgZGF0YSwgZmllbGQpIHsgLy8rIOWPguaVsOWinuWKoGRhdGHlkoxmaWVsZFxyXG4gKiAgICAgIHRoaXMuZWRpdGluZ0NlbGwgPSBjZWxsO1xyXG4gKiAgICAgIHRoaXMuZWRpdGluZ0NlbGxEYXRhID0gZGF0YTsgLy8rXHJcbiAqICAgICAgdGhpcy5lZGl0aW5nQ2VsbEZpZWxkID0gZmllbGQ7IC8vK1xyXG4gKiAgICAgIHRoaXMuYmluZERvY3VtZW50RWRpdExpc3RlbmVyKCk7XHJcbiAqICB9O1xyXG4gKiBcclxuICogIFRyZWVUYWJsZS5wcm90b3R5cGUuYmluZERvY3VtZW50RWRpdExpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xyXG4gKiAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gKiAgICAgICBpZiAoIXRoaXMuZG9jdW1lbnRFZGl0TGlzdGVuZXIpIHtcclxuICogICAgICAgICAgIHRoaXMuZG9jdW1lbnRFZGl0TGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICogICAgICAgICAgICAgICBpZiAoX3RoaXMuZWRpdGluZ0NlbGwgJiYgIV90aGlzLmVkaXRpbmdDZWxsQ2xpY2sgJiYgX3RoaXMuaXNFZGl0aW5nQ2VsbFZhbGlkKCkpIHtcclxuICogICAgICAgICAgICAgICAgICAgZG9taGFuZGxlcl8xLkRvbUhhbmRsZXIucmVtb3ZlQ2xhc3MoX3RoaXMuZWRpdGluZ0NlbGwsICd1aS1lZGl0aW5nLWNlbGwnKTtcclxuICogICAgICAgICAgICAgICAgICAgX3RoaXMuZWRpdGluZ0NlbGwgPSBudWxsO1xyXG4gKiAgICAgICAgICAgICAgICAgICBfdGhpcy5vbkVkaXRDb21wbGV0ZS5lbWl0KHsgZmllbGQ6IF90aGlzLmVkaXRpbmdDZWxsRmllbGQsIGRhdGE6IF90aGlzLmVkaXRpbmdDZWxsRGF0YSB9KTsvLytcclxuICogICAgICAgICAgICAgICAgICAgX3RoaXMudW5iaW5kRG9jdW1lbnRFZGl0TGlzdGVuZXIoKTtcclxuICogICAgICAgICAgICAgICB9XHJcbiAqICAgICAgICAgICAgICAgX3RoaXMuZWRpdGluZ0NlbGxDbGljayA9IGZhbHNlO1xyXG4gKiAgICAgICAgICAgfTtcclxuICogICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kb2N1bWVudEVkaXRMaXN0ZW5lcik7XHJcbiAqICAgICAgIH1cclxuICogICB9O1xyXG4gKiBcclxuICogIFRyZWVUYWJsZS5wcm90b3R5cGUuYmluZERvY3VtZW50RWRpdExpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xyXG4gKiAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gKiAgICAgICBpZiAoIXRoaXMuZG9jdW1lbnRFZGl0TGlzdGVuZXIpIHtcclxuICogICAgICAgICAgIHRoaXMuZG9jdW1lbnRFZGl0TGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICogICAgICAgICAgICAgICBpZiAoX3RoaXMuZWRpdGluZ0NlbGwgJiYgIV90aGlzLmVkaXRpbmdDZWxsQ2xpY2sgJiYgX3RoaXMuaXNFZGl0aW5nQ2VsbFZhbGlkKCkpIHtcclxuICogICAgICAgICAgICAgICAgICAgZG9taGFuZGxlcl8xLkRvbUhhbmRsZXIucmVtb3ZlQ2xhc3MoX3RoaXMuZWRpdGluZ0NlbGwsICd1aS1lZGl0aW5nLWNlbGwnKTtcclxuICogICAgICAgICAgICAgICAgICAgX3RoaXMuZWRpdGluZ0NlbGwgPSBudWxsO1xyXG4gKiAgICAgICAgICAgICAgICAgICBfdGhpcy5vbkVkaXRDb21wbGV0ZS5lbWl0KHsgZmllbGQ6IF90aGlzLmVkaXRpbmdDZWxsRmllbGQsIGRhdGE6IF90aGlzLmVkaXRpbmdDZWxsRGF0YSB9KTsvLytcclxuICogICAgICAgICAgICAgICAgICAgX3RoaXMudW5iaW5kRG9jdW1lbnRFZGl0TGlzdGVuZXIoKTtcclxuICogICAgICAgICAgICAgICB9XHJcbiAqICAgICAgICAgICAgICAgX3RoaXMuZWRpdGluZ0NlbGxDbGljayA9IGZhbHNlO1xyXG4gKiAgICAgICAgICAgfTtcclxuICogICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kb2N1bWVudEVkaXRMaXN0ZW5lcik7XHJcbiAqICAgICAgIH1cclxuICogICB9O1xyXG4gKiBcclxuICogIFRURWRpdGFibGVDb2x1bW4ucHJvdG90eXBlLm9wZW5DZWxsID0gZnVuY3Rpb24gKCkge1xyXG4gKiAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gKiAgICAgICAgdGhpcy50dC51cGRhdGVFZGl0aW5nQ2VsbCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsdGhpcy5kYXRhLCB0aGlzLmZpZWxkKTsvLytcclxuICogICAgICAgIGRvbWhhbmRsZXJfMS5Eb21IYW5kbGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ3VpLWVkaXRpbmctY2VsbCcpO1xyXG4gKiAgICAgICAgdGhpcy50dC5vbkVkaXRJbml0LmVtaXQoeyBmaWVsZDogdGhpcy5maWVsZCwgZGF0YTogdGhpcy5kYXRhIH0pO1xyXG4gKiAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKGZ1bmN0aW9uICgpIHtcclxuICogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICogICAgICAgICAgICAgICAgdmFyIGZvY3VzYWJsZSA9IGRvbWhhbmRsZXJfMS5Eb21IYW5kbGVyLmZpbmRTaW5nbGUoX3RoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2lucHV0LCB0ZXh0YXJlYScpO1xyXG4gKiAgICAgICAgICAgICAgICBpZiAoZm9jdXNhYmxlKSB7XHJcbiAqICAgICAgICAgICAgICAgICAgICAgZm9jdXNhYmxlLmZvY3VzKCk7XHJcbiAqICAgICAgICAgICAgICAgICB9XHJcbiAqICAgICAgICAgICAgIH0sIDUwKTtcclxuICogICAgICAgIH0pO1xyXG4gKiAgIH07XHJcbiAqIFxyXG4gKiAgVFRFZGl0YWJsZUNvbHVtbi5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gKiAgICAgICAgaWYgKHRoaXMuaXNFbmFibGVkKCkpIHtcclxuICogICAgICAgICAgICB0aGlzLnR0LmVkaXRpbmdDZWxsQ2xpY2sgPSB0cnVlO1xyXG4gKiAgICAgICAgICAgIGlmICh0aGlzLnR0LmVkaXRpbmdDZWxsKSB7XHJcbiAqICAgICAgICAgICAgICAgIGlmICh0aGlzLnR0LmVkaXRpbmdDZWxsICE9PSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpIHtcclxuICogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy50dC5pc0VkaXRpbmdDZWxsVmFsaWQoKSkge1xyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICogICAgICAgICAgICAgICAgICAgIH1cclxuICogICAgICAgICAgICAgICAgICAgIHRoaXMudHQub25FZGl0Q29tcGxldGUuZW1pdCh7IGZpZWxkOiB0aGlzLnR0Lm9sZEZpZWxkLCBkYXRhOiB0aGlzLnR0Lm9sZERkYXRhIH0pOy8vK1xyXG4gKiAgICAgICAgICAgICAgICAgICAgRG9tSGFuZGxlci5yZW1vdmVDbGFzcyh0aGlzLnR0LmVkaXRpbmdDZWxsLCAndWktZWRpdGluZy1jZWxsJyk7XHJcbiAqICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5DZWxsKCk7XHJcbiAqICAgICAgICAgICAgICAgIH1cclxuICogICAgICAgICAgICB9XHJcbiAqICAgICAgICAgICAgZWxzZSB7XHJcbiAqICAgICAgICAgICAgICAgIHRoaXMub3BlbkNlbGwoKTtcclxuICogICAgICAgICAgICB9XHJcbiAqICAgICAgICB9XHJcbiAqICB9O1xyXG4gKiBcclxuICogIFRURWRpdGFibGVDb2x1bW4ucHJvdG90eXBlLm9wZW5DZWxsID0gZnVuY3Rpb24gKCkge1xyXG4gKiAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAqICAgICAgICAgdGhpcy50dC51cGRhdGVFZGl0aW5nQ2VsbCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsdGhpcy5kYXRhLCB0aGlzLmZpZWxkKTtcclxuICogICAgICAgICBEb21IYW5kbGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ3VpLWVkaXRpbmctY2VsbCcpO1xyXG4gKiAgICAgICAgIHRoaXMudHQub25FZGl0SW5pdC5lbWl0KHsgZmllbGQ6IHRoaXMuZmllbGQsIGRhdGE6IHRoaXMuZGF0YSB9KTtcclxuICogICAgICAgICB0aGlzLnR0Lm9sZEZpZWxkPSB0aGlzLmZpZWxkOyAvLytcclxuICogICAgICAgICB0aGlzLnR0Lm9sZERkYXRhPXRoaXMuZGF0YTsgIC8vK1xyXG4gKiAgICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcihmdW5jdGlvbiAoKSB7XHJcbiAqICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gKiAgICAgICAgICAgICAgICAgdmFyIGZvY3VzYWJsZSA9IERvbUhhbmRsZXIuZmluZFNpbmdsZShfdGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnaW5wdXQsIHRleHRhcmVhJyk7XHJcbiAqICAgICAgICAgICAgICAgIGlmIChmb2N1c2FibGUpIHtcclxuICogICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGUuZm9jdXMoKTtcclxuICogICAgICAgICAgICAgICAgIH1cclxuICogICAgICAgICAgIH0sIDUwKTtcclxuICogICAgICAgfSk7XHJcbiAqICAgfTtcclxuICogXHJcbiAqIDMuIEhUTUzmqKHmnb9cclxuICogKDEpIOS4jeWQr+eUqOWkmuihqOWktFxyXG4gKiAgICAgIDxwLXRyZWVUYWJsZSBbY29sdW1uc109XCJ0cmVlR3JpZENvbHVtbnNcIiBmYXJyaXNQcmltZW5nVHJlZVRhYmxlQmluZGluZyBmYXJyaXNIaWVyYXJjaHlJbmZvS2V5PVwibGF5ZXJGaWVsZFwiIFtyZXNpemFibGVDb2x1bW5zXT1cInRydWVcIiBmYXJyaXNQcmltZW5nVHJlZVRhYmxlSWRGaWVsZD1cImlkXCI+XHJcbiAqICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJoZWFkZXJcIiBsZXQtY29sdW1ucz5cclxuICogICAgICAgICAgICAgICAgIDx0cj5cclxuICogICAgICAgICAgICAgICAgICAgICA8dGggKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zXCIgdHRSZXNpemFibGVDb2x1bW4+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIHt7Y29sLmhlYWRlcn19XHJcbiAqICAgICAgICAgICAgICAgICAgICAgPC90aD5cclxuICogICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAqICAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAqICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJib2R5XCIgbGV0LXJvd05vZGUgbGV0LXJvd0RhdGE9XCJyb3dEYXRhXCIgbGV0LWNvbHVtbnM9XCJjb2x1bW5zXCI+XHJcbiAqICAgICAgICAgICAgICAgICA8dHI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgPHRkICpuZ0Zvcj1cImxldCBjb2wgb2YgY29sdW1uczsgbGV0IGkgPSBpbmRleFwiIHR0RWRpdGFibGVDb2x1bW4gW3R0RWRpdGFibGVDb2x1bW5dPVwicm93RGF0YVwiXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFt0dEVkaXRhYmxlQ29sdW1uRmllbGRdPVwiY29sLmZpZWxkXCI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIDxwLXRyZWVUYWJsZVRvZ2dsZXIgW3Jvd05vZGVdPVwicm93Tm9kZVwiICpuZ0lmPVwiaSA9PT0gMFwiPjwvcC10cmVlVGFibGVUb2dnbGVyPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICA8cC10cmVlVGFibGVDZWxsRWRpdG9yPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImlucHV0XCI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0g5o6n5Lu25Yqo5oCB55Sf5oiQ5Yy65Z+f77yM5q2k5aSE5Y+v5pS+572u5o6n5Lu25Yqo5oCB55Sf5oiQ57uE5Lu277yM55Sf5oiQ6KeE5YiZ5aaC5LiL77yaXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLiDlrZfnrKbkuLLnsbvlnovvvJrmlofmnKzmjqfku7ZcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIuIOaVsOWtl+exu+Wei++8muaVsOWtl+aOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMy4g5biD5bCU57G75Z6L77ya5aSN6YCJ5qGG5o6n5Lu2XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA0LiDml6XmnJ/ml7bpl7TnsbvlnovvvJrml6XmnJ/ml7bpl7Tmjqfku7ZcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDUuIOaemuS4vuexu+Wei++8muS4i+aLieahhuaOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNi4g5biu5Yqp57G75Z6L77ya5biu5Yqp5o6n5Lu2LS0+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cIm91dHB1dFwiPnt7IGNvbCB8IGZvcm1hdENlbGxEYXRhIDogcm93RGF0YSB9fTwvbmctdGVtcGxhdGU+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIDwvcC10cmVlVGFibGVDZWxsRWRpdG9yPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAqICAgICAgICAgICAgICAgICA8L3RyPlxyXG4gKiAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG4gKiAgICAgPC9wLXRyZWVUYWJsZT5cclxuICogXHJcbiAqICgyKSDlkK/nlKjlpJrooajlpLRcclxuICogXHJcbiAqICA8cC10cmVlVGFibGUgW2NvbHVtbnNdPVwidHJlZUdyaWRDb2x1bW5zXCIgZmFycmlzUHJpbWVuZ1RyZWVUYWJsZUJpbmRpbmcgZmFycmlzSGllcmFyY2h5SW5mb0tleT1cImxheWVyRmllbGRcIiBbcmVzaXphYmxlQ29sdW1uc109XCJ0cnVlXCIgZmFycmlzUHJpbWVuZ1RyZWVUYWJsZUlkRmllbGQ9XCJpZFwiPlxyXG4gKiAgICAgICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiaGVhZGVyXCIgbGV0LWNvbHVtbnM+XHJcbiAqICAgICAgICAgICAgICAgICAgPHRyICpuZ0Zvcj1cImxldCBjb2x1bW5IZWFkZXIgb2YgdHJlZUdyaWRDb2x1bW5IZWFkZXJzXCI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgIDx0aCAqbmdGb3I9XCJsZXQgY29sIG9mIGNvbHVtbkhlYWRlclwiIHR0UmVzaXphYmxlQ29sdW1uIFthdHRyLnJvd3NwYW5dPVwiY29sLnJvd3NwYW5cIiBbYXR0ci5jb2xzcGFuXT1cImNvbC5jb2xzcGFuXCI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB7e2NvbC5oZWFkZXJ9fVxyXG4gKiAgICAgICAgICAgICAgICAgICAgICA8L3RoPlxyXG4gKiAgICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAqICAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAqICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJib2R5XCIgbGV0LXJvd05vZGUgbGV0LXJvd0RhdGE9XCJyb3dEYXRhXCIgbGV0LWNvbHVtbnM9XCJjb2x1bW5zXCI+XHJcbiAqICAgICAgICAgICAgICAgICA8dHI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgPHRkICpuZ0Zvcj1cImxldCBjb2wgb2YgY29sdW1uczsgbGV0IGkgPSBpbmRleFwiIHR0RWRpdGFibGVDb2x1bW4gW3R0RWRpdGFibGVDb2x1bW5dPVwicm93RGF0YVwiXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFt0dEVkaXRhYmxlQ29sdW1uRmllbGRdPVwiY29sLmZpZWxkXCI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIDxwLXRyZWVUYWJsZVRvZ2dsZXIgW3Jvd05vZGVdPVwicm93Tm9kZVwiICpuZ0lmPVwiaSA9PT0gMFwiPjwvcC10cmVlVGFibGVUb2dnbGVyPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICA8cC10cmVlVGFibGVDZWxsRWRpdG9yPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImlucHV0XCI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0g5o6n5Lu25Yqo5oCB55Sf5oiQ5Yy65Z+f77yM5q2k5aSE5Y+v5pS+572u5o6n5Lu25Yqo5oCB55Sf5oiQ57uE5Lu277yM55Sf5oiQ6KeE5YiZ5aaC5LiL77yaXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLiDlrZfnrKbkuLLnsbvlnovvvJrmlofmnKzmjqfku7ZcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIuIOaVsOWtl+exu+Wei++8muaVsOWtl+aOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMy4g5biD5bCU57G75Z6L77ya5aSN6YCJ5qGG5o6n5Lu2XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA0LiDml6XmnJ/ml7bpl7TnsbvlnovvvJrml6XmnJ/ml7bpl7Tmjqfku7ZcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDUuIOaemuS4vuexu+Wei++8muS4i+aLieahhuaOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNi4g5biu5Yqp57G75Z6L77ya5biu5Yqp5o6n5Lu2LS0+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cIm91dHB1dFwiPnt7IGNvbCB8IGZvcm1hdENlbGxEYXRhIDogcm93RGF0YSB9fTwvbmctdGVtcGxhdGU+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIDwvcC10cmVlVGFibGVDZWxsRWRpdG9yPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAqICAgICAgICAgICAgICAgICA8L3RyPlxyXG4gKiAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG4gKiAgPC9wLXRyZWVUYWJsZT5cclxuICogXHJcbiAqIOWkmuihqOWktOaVsOaNruagvOW8j++8mlxyXG4gKiAgdGhpcy50cmVlR3JpZENvbHVtbkhlYWRlcnM9W1xyXG4gKiAgICAgW3sgaGVhZGVyOiAnQnJhbmQnLHJvd3NwYW46MywgY29sc3BhbjoxfSx7IGhlYWRlcjogJ1NhbGUgUmF0ZScscm93c3BhbjoxLCBjb2xzcGFuOjR9XSxcclxuICogICAgIFt7IGhlYWRlcjogJ1NhbGVzJyxyb3dzcGFuOjEsIGNvbHNwYW46Mn0seyBoZWFkZXI6ICdQcm9maXRzJyxyb3dzcGFuOjEsIGNvbHNwYW46Mn1dLFxyXG4gKiAgICAgW3sgaGVhZGVyOiAnTGFzdCBZZWFyJyxyb3dzcGFuOjEsIGNvbHNwYW46MX0seyBoZWFkZXI6ICdUaGlzIFllYXInLHJvd3NwYW46MSwgY29sc3BhbjoxfSx7IGhlYWRlcjogJ0xhc3QgWWVhcicscm93c3BhbjoxLCBjb2xzcGFuOjF9LHsgaGVhZGVyOiAnVGhpcyBZZWFyJyxyb3dzcGFuOjEsIGNvbHNwYW46MX1dLFxyXG4gKiAgXVxyXG5cclxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG5pbXBvcnQgeyBEaXJlY3RpdmUsIE9uSW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgSG9zdExpc3RlbmVyLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSwgQmluZGluZ0xpc3QsIEZyYW1lQ29udGV4dCwgQ2hhbmdlLCBDaGFuZ2VUeXBlLCBFbnRpdHlDb2xsZWN0aW9uLCBFbnRpdHlMaXN0LCBFbnRpdHkgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IFRyZWVUYWJsZSB9IGZyb20gJ3ByaW1lbmcvdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgVHJlZU5vZGUgfSBmcm9tICdwcmltZW5nL2FwaSc7XHJcbmltcG9ydCB7IFRyZWVOb2RlQnVpbGRlckZhY3RvcnkgfSBmcm9tICcuLi90cmVlX3RhYmxlX25vZGVfYnVpbGRlci90cmVlX25vZGVfYnVpbGRlcl9mYWN0b3J5JztcclxuaW1wb3J0IHsgRGF0ZVRpbWVIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vZGF0ZSc7XHJcbmNvbnN0IFBBUkVOVF9FTEVNRU5UOiBzdHJpbmcgPSBcInBhcmVudEVsZW1lbnRcIjtcclxuY29uc3QgUEFUSDogc3RyaW5nID0gXCJwYXRoXCI7XHJcbmNvbnN0IElTX0RFVEFJTDogc3RyaW5nID0gJ2lzRGV0YWlsJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRmFycmlzUHJpbWVuZ1RyZWVOb2RlIGV4dGVuZHMgVHJlZU5vZGUge1xyXG4gIGlkPzogc3RyaW5nO1xyXG59XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmYXJyaXNQcmltZW5nVHJlZVRhYmxlQmluZGluZ10nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNQcmltZW5nVHJlZVRhYmxlQmluZGluZ0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBwcml2YXRlIHNlbGVjdGVkUm93SWQgPSBudWxsO1xyXG4gIHByaXZhdGUgdHJlZVRhYmxlU2VsZWN0ZWRFdmVudCA9IG51bGw7XHJcbiAgLyoqXHJcbiAgICog5YiG57qn56CB5L+h5oGv5a2X5q6177yM5bGe5oCn5Y+v6IO95pyJ5Lik56eN5qC85byP55qE5YC877ya5YiG57qn56CB5a2X5q6177yI5Li76KGo77yJ5oiW5LuO6KGo5YmN56uvY29kZXMv5YiG57qn56CB5a2X5q6177yI5a2Q6KGo77yJXHJcbiAgICovXHJcbiAgQElucHV0KCdmYXJyaXNIaWVyYXJjaHlJbmZvS2V5JylcclxuICBwdWJsaWMgaGllcmFyY2h5SW5mb0tleTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY29sdW1ucycpXHJcbiAgcHVibGljIGNvbHVtbnM6IGFueTtcclxuICAvKipcclxuICAgKiDlhoXnoIHvvIzmlbDmja7nmoTllK/kuIDmoIfor4ZcclxuICAgKi9cclxuICBASW5wdXQoJ2ZhcnJpc1ByaW1lbmdUcmVlVGFibGVJZEZpZWxkJylcclxuICBwdWJsaWMgaWRGaWVsZDogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDoioLngrnpgInmi6nlj5jmm7Tkuovku7ZcclxuICAgKi9cclxuICBAT3V0cHV0KCkgbm9kZVNlbGVjdENoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgcHJpdmF0ZSBvbGRUcmVlTm9kZU1hcDogeyBba2V5OiBzdHJpbmddOiBGYXJyaXNQcmltZW5nVHJlZU5vZGUgfSA9IHt9O1xyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5YiG57qn56CB55qE5a2X5q6157yW5Y+377yM5LuOaGllcmFyY2h5SW5mb0tleeWxnuaAp+S4reino+aekOiOt+WPllxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGllcmFyY2h5SW5mb0ZpZWxkOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdEYXRhKCk6IEJpbmRpbmdEYXRhIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNruWIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmdldExpc3QoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0SGllcmFyY2h5SW5mb0ZpZWxkKCk6IHN0cmluZyB7XHJcbiAgICBsZXQgaW5mb3MgPSB0aGlzLmhpZXJhcmNoeUluZm9LZXkuc3BsaXQoJy8nKTtcclxuICAgIHJldHVybiBpbmZvc1tpbmZvcy5sZW5ndGggLSAxXTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSB0cmVlVGFibGU6IFRyZWVUYWJsZSxcclxuICAgIHByaXZhdGUgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXHJcbiAgICBwcml2YXRlIGRhdGVTZXJ2aWNlOiBEYXRlVGltZUhlbHBlclNlcnZpY2VcclxuICApIHsgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIC8v6Kej5p6Q6I635Y+W5YiG57qn56CB5a2X5q6157yW5Y+3XHJcbiAgICB0aGlzLmhpZXJhcmNoeUluZm9GaWVsZCA9IHRoaXMuZ2V0SGllcmFyY2h5SW5mb0ZpZWxkKCk7XHJcbiAgICAvLyDlsIbliIbnuqfnoIHkv6Hmga/kv53lrZjliLByb290LWNvbXBvbmVudFxyXG4gICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ2hpZXJhcmNoeUluZm9LZXknLCB0aGlzLmhpZXJhcmNoeUluZm9LZXkpO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgdGhpcy5iaW5kRGF0YShjaGFuZ2UpO1xyXG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkUm93KGNoYW5nZSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIFtdKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluagkeWIl+ihqOe7keWumuaVsOaNruWvueW6lOeahOWunuS9k+aVsOe7hFxyXG4gICAqIEByZXR1cm5zIOWunuS9k+aVsOe7hFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RW50aXR5QXJyKCk6IEVudGl0eVtdIHtcclxuICAgIGNvbnN0IGVudGl0eUNvbGxlY3Rpb24gPSB0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb247XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aDogc3RyaW5nID0gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuYmluZGluZ1BhdGg7XHJcbiAgICBpZiAoIWJpbmRpbmdQYXRoIHx8IGJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIGVudGl0eUNvbGxlY3Rpb24udG9BcnJheSgpO1xyXG4gICAgfVxyXG4gICAgbGV0IGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCA9IHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmxpc3Q7XHJcbiAgICBsZXQgYmluZGluZ1BhdGhBcnI6IHN0cmluZ1tdID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIoc3RyID0+IHN0cik7XHJcbiAgICBsZXQgcGF0aEFycmF5ID0gW107XHJcbiAgICBiaW5kaW5nUGF0aEFyci5mb3JFYWNoKChwYXRoOiBzdHJpbmcpID0+IHtcclxuICAgICAgcGF0aEFycmF5LnB1c2goYCR7YmluZGluZ0xpc3QucHJpbWFyeUtleX06JHtiaW5kaW5nTGlzdC5jdXJyZW50SWR9YCk7XHJcbiAgICAgIHBhdGhBcnJheS5wdXNoKHBhdGgpO1xyXG4gICAgICBiaW5kaW5nTGlzdCA9IGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtW3BhdGhdO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gKGVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXRpZXNCeVBhdGgocGF0aEFycmF5KSBhcyBFbnRpdHlMaXN0PGFueT4pLnRvQXJyYXkoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bCG55yf5a6e6aG65bqP5qCH6K6w5Yiw5a+55bqU55qE5a6e5L2T5LiKXHJcbiAgICogQHBhcmFtIGVudGl0eUFyciDlrp7kvZPmlbDnu4RcclxuICAgKiBAcGFyYW0gdHJlZU5vZGVzIOagkeiKgueCuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0QWN0dWFsSW5kZXgoZW50aXR5QXJyOiBFbnRpdHlbXSwgdHJlZU5vZGVzOiBUcmVlTm9kZVtdKSB7XHJcbiAgICBpZiAoZW50aXR5QXJyLmxlbmd0aCA8IDEpXHJcbiAgICAgIHJldHVybjtcclxuICAgIC8vIOWIneWni+WMluW6j+WPt+WZqOW5tuS+neasoemBjeWOhuavj+S4gOajteagkVxyXG4gICAgbGV0IGNvdW50ZXIgPSB7IGluZGV4OiAwIH07XHJcbiAgICBjb25zdCBwcmltYXJ5S2V5OiBzdHJpbmcgPSBlbnRpdHlBcnJbMF0ucHJpbWFyeUtleTtcclxuICAgIHRyZWVOb2Rlcy5mb3JFYWNoKChyb290Tm9kZSkgPT4ge1xyXG4gICAgICB0aGlzLnRyYXZlcnNlVHJlZShyb290Tm9kZSwgY291bnRlciwgZW50aXR5QXJyLCBwcmltYXJ5S2V5KTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliY3luo/pgJLlvZLpgY3ljobmoJHoioLngrnlubblnKjlr7nlupTlrp7kvZPkuIrmoIforrDluo/lj7dcclxuICAgKiBAcGFyYW0gdHJlZU5vZGUg5qCR6IqC54K5XHJcbiAgICogQHBhcmFtIGNvdW50ZXIg5bqP5Y+35ZmoXHJcbiAgICogQHBhcmFtIGVudGl0eUFyciDlrp7kvZPmlbDnu4RcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiDlnKjov5vooYzliY3nq6/moKHpqozml7bvvIzmjInnhadFbnRpdHnlnKjmlbDnu4TkuK3nmoTkuIvmoIfnlJ/miJDvvIjplJnor6/mj5DnpLrnmoTvvInooYzlj7fnmoTmlrnlvI/kuI3pgILnlKjkuo7moJHliJfooajvvIxcclxuICAgKiDlm6DkuLrmoJHliJfooajlj6/ku6XlnKjlt7Lnu4/mt7vliqDnmoToioLngrnkuIrliqDlhaXlrZDoioLngrnvvIzogIxFbnRpdHnmgLvmmK/lnKjmnIDlkI7ov73liqDmlrDlr7nosaHvvIzlr7zoh7TkuozogIXnmoTpobrluo/kuI3kuIDlrprnm7jlkIzvvIxcclxuICAgKiDmiYDku6XlnKjnu5HlrprmlbDmja7nmoTml7blgJnlsIbmoJHoioLngrnlnKjliJfooajkuK3nmoTnnJ/lrp7pobrluo/pgJrov4fkuIDkuKrpmYTliqDnmoTlsZ7mgKfvvIhfX0FDVFVBTF9JTkRFWF9f77yJ6LWL57uZRW50aXR556S65L6L77yMXHJcbiAgICog5b2TRW50aXR56LCD55SodmFsaWRhdGXmlrnms5Xml7bvvIzmo4Dmn6XmmK/lkKblrZjlnKjor6XlsZ7mgKfvvIzlpoLmnpzlrZjlnKjliJnlupTnlKjor6XlsZ7mgKfnmoTlgLzkvZzkuLrooYzlj7fjgIJcclxuICAgKi9cclxuICBwcml2YXRlIHRyYXZlcnNlVHJlZSh0cmVlTm9kZTogVHJlZU5vZGUsIGNvdW50ZXI6IHsgaW5kZXg6IG51bWJlciB9LCBlbnRpdHlBcnI6IEVudGl0eVtdLCBwcmltYXJ5S2V5OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IElOREVYX0xBQkVMID0gXCJfX0FDVFVBTF9JTkRFWF9fXCI7XHJcbiAgICAvLyDlpITnkIblvZPliY3oioLngrlcclxuICAgIGNvbnN0IGVudGl0eSA9IGVudGl0eUFyci5maW5kKGUgPT4gZVtwcmltYXJ5S2V5XSA9PT0gdHJlZU5vZGUuZGF0YVtwcmltYXJ5S2V5XSk7XHJcbiAgICBpZiAoZW50aXR5KSB7XHJcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlbnRpdHksIElOREVYX0xBQkVMLCB7XHJcbiAgICAgICAgdmFsdWU6IGNvdW50ZXIuaW5kZXhcclxuICAgICAgfSk7XHJcbiAgICAgIGNvdW50ZXIuaW5kZXgrKztcclxuICAgIH1cclxuICAgIC8vIOmAkuW9kumBjeWOhuWIhuaUr1xyXG4gICAgdHJlZU5vZGUuY2hpbGRyZW4uZm9yRWFjaCgocm9vdE5vZGUpID0+IHtcclxuICAgICAgdGhpcy50cmF2ZXJzZVRyZWUocm9vdE5vZGUsIGNvdW50ZXIsIGVudGl0eUFyciwgcHJpbWFyeUtleSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuaVsOaNruWPmOabtFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICogQHJldHVybnMg5piv5ZCm6Lez6L+H57uR5a6a5pWw5o2u55qE5pW05L2T5Yi35pawXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICog55uu55qE5piv5bC96YeP5bCR55qE6YeN5paw5p6E6YCg5pW05Liq5qCR5YiX6KGo77yM5q+U5aaC5Zyo5Y+R55Sf5YC85Y+Y5YyW5LqL5Lu25pe25bC96YeP5Y+q5pu05pS55Y+Y5YyW55qE5YC85bCx57uT5p2f77yMXHJcbiAgICog5aaC5p6c5Lu75L2V5Y+Y5YyW6YO96YeN5paw5p6E6YCg5qCR77yM5Lya5a+86Ie0VGFi6ZSu5YiH5o2i5Yqf6IO96Zq+5Lul5a6e546w562J6Zeu6aKY44CCXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVDaGFuZ2UoY2hhbmdlPzogQ2hhbmdlKTogYm9vbGVhbiB7XHJcbiAgICAvLyDmsqHmnInlj5jmm7Tml7bvvIznu6fnu63nu5HlrprmlbDmja7liLfmlrBcclxuICAgIGlmICghY2hhbmdlKVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAvLyDliIbnsbvlpITnkIblhbfkvZPnmoTlj5jmm7RcclxuICAgIHN3aXRjaCAoY2hhbmdlLnR5cGUpIHtcclxuICAgICAgY2FzZSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQ6XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlU2VsZWN0aW9uQ2hhbmdlZChjaGFuZ2UpO1xyXG4gICAgICBjYXNlIENoYW5nZVR5cGUuR2xvYmFsU2VsZWN0aW9uQ2hhbmdlZDpcclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVTZWxlY3Rpb25DaGFuZ2VkKGNoYW5nZSk7XHJcbiAgICAgIGNhc2UgQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQ6XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVmFsdWVDaGFuZ2VkKGNoYW5nZSk7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDlpITnkIbooYzliIfmjaLlj5jmm7RcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqIEByZXR1cm5zIOaYr+WQpui3s+i/h+e7keWumuaVsOaNrueahOaVtOS9k+WIt+aWsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFuZGxlU2VsZWN0aW9uQ2hhbmdlZChjaGFuZ2U6IENoYW5nZSk6IGJvb2xlYW4ge1xyXG4gICAgLy8g5b2T5YmN57uR5a6a6Lev5b6E5LiL5Y+R55Sf6KGM5YiH5o2i5LqL5Lu277yM5LiN6L+b6KGM5pWw5o2u5Yi35paw77yI5Li65LqG5pSv5oyBVGFi6ZSu5YiH5o2i5Y2V5YWD5qC877yJXHJcbiAgICBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkKSB7XHJcbiAgICAgIGxldCBwYXRoID0gY2hhbmdlLnBhdGg7XHJcbiAgICAgIGxldCBmcm1QYXRoID0gdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aC5zcGxpdChcIi9cIikuZmlsdGVyKHN0ciA9PiBzdHIpO1xyXG4gICAgICBpZiAocGF0aC5sZW5ndGggPT09IGZybVBhdGgubGVuZ3RoKSB7XHJcbiAgICAgICAgbGV0IHNhbWUgPSB0cnVlO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgaWYgKHBhdGhbaV0gIT09IGZybVBhdGhbaV0pXHJcbiAgICAgICAgICAgIHNhbWUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNhbWUpXHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlpITnkIbooYzliIfmjaLlj5jmm7RcclxuICAgKiBAcGFyYW0gY2hhbmdlIOWPmOabtFxyXG4gICAqIEByZXR1cm5zIOaYr+WQpui3s+i/h+e7keWumuaVsOaNrueahOaVtOS9k+WIt+aWsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFuZGxlVmFsdWVDaGFuZ2VkKGNoYW5nZTogQ2hhbmdlKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoY2hhbmdlLnR5cGUgIT09IENoYW5nZVR5cGUuVmFsdWVDaGFuZ2VkKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIC8vIOaOpeaUtuWIsOWAvOWPmOWMluS6i+S7tu+8jOWwneivleS7hei/m+ihjOWxgOmDqOaVsOaNrueahOabtOaWsO+8iOS4uuS6huaUr+aMgVRhYumUruWIh+aNouWNleWFg+agvO+8iVxyXG4gICAgbGV0IHBhdGggPSBjaGFuZ2UucGF0aDtcclxuICAgIGxldCBiaW5kaW5nUGF0aEFyciA9IHRoaXMuYmluZGluZ0RhdGEuYmluZGluZ1BhdGguc3BsaXQoXCIvXCIpLmZpbHRlcihzdHIgPT4gc3RyKTtcclxuICAgIC8vIOWIpOaWree7keWumui3r+W+hOaYr+WQpuebuOWQjO+8jOWmguaenOS4jeebuOWQjOWImeaVtOS9k+WIt+aWsFxyXG4gICAgZm9yIChsZXQgaXRlbSBvZiBiaW5kaW5nUGF0aEFycikge1xyXG4gICAgICBpZiAocGF0aC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgaWYgKGl0ZW0gPT09IHBhdGhbMF0pIHtcclxuICAgICAgICAgIHBhdGguc2hpZnQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g6YCa6L+HaWTmib7liLDlvoXmm7TmlrDnmoTmoJHoioLngrlcclxuICAgIGxldCBpZCA9IGNoYW5nZS5pZDtcclxuICAgIGlmIChpZCkge1xyXG4gICAgICBjb25zdCBwcmltYXJ5S2V5ID0gdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xyXG4gICAgICBsZXQgbm9kZXMgPSB0aGlzLnRyZWVUYWJsZS52YWx1ZTtcclxuICAgICAgbGV0IHRhcmdldE5vZGUgPSBudWxsO1xyXG4gICAgICBmb3IgKGxldCBub2RlIG9mIG5vZGVzKSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuZmluZFRyZWVOb2RlQnlJZChub2RlLCBwcmltYXJ5S2V5LCBpZCk7XHJcbiAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgdGFyZ2V0Tm9kZSA9IHJlc3VsdDtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAodGFyZ2V0Tm9kZSAmJiBwYXRoLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHBhdGguc2hpZnQoKTtcclxuICAgICAgICBpZiAodGFyZ2V0Tm9kZS5kYXRhLmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkgJiYgY2hhbmdlLmhhc093blByb3BlcnR5KFwidmFsdWVcIikpIHtcclxuICAgICAgICAgIHRhcmdldE5vZGUuZGF0YVtwcm9wZXJ0eU5hbWVdID0gY2hhbmdlLnZhbHVlO1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmAmui/h+S4u+mUruWAvOafpeaJvuagkeiKgueCuVxyXG4gICAqIEBwYXJhbSB0cmVlTm9kZSDmoJHmoLnoioLngrlcclxuICAgKiBAcGFyYW0gcHJpbWFyeUtleSDkuLvplK7lkI1cclxuICAgKiBAcGFyYW0ga2V5VmFsdWUg5Li76ZSu5YC8XHJcbiAgICogQHJldHVybnMg5qCR6IqC54K5XHJcbiAgICogQHRvZG8g6YCS5b2S6YGN5Y6G5a6e546w5q+U6L6D5L2O5pWI77yM6ICD6JmR6YCa6L+Hb2xkVHJlZU5vZGVNYXDmn6Xmib7moJHoioLngrlcclxuICAgKi9cclxuICBwcml2YXRlIGZpbmRUcmVlTm9kZUJ5SWQodHJlZU5vZGU6IFRyZWVOb2RlLCBwcmltYXJ5S2V5OiBzdHJpbmcsIGtleVZhbHVlOiBhbnkpOiBUcmVlTm9kZSB8IG51bGwge1xyXG4gICAgaWYgKCF0cmVlTm9kZSlcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICBpZiAodHJlZU5vZGUuZGF0YS5oYXNPd25Qcm9wZXJ0eShwcmltYXJ5S2V5KSAmJiB0cmVlTm9kZS5kYXRhW3ByaW1hcnlLZXldID09PSBrZXlWYWx1ZSlcclxuICAgICAgcmV0dXJuIHRyZWVOb2RlO1xyXG4gICAgaWYgKHRyZWVOb2RlLmNoaWxkcmVuKSB7XHJcbiAgICAgIGZvciAobGV0IG5vZGUgb2YgdHJlZU5vZGUuY2hpbGRyZW4pIHtcclxuICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5maW5kVHJlZU5vZGVCeUlkKG5vZGUsIHByaW1hcnlLZXksIGtleVZhbHVlKTtcclxuICAgICAgICBpZiAocmVzdWx0KVxyXG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIOe7keWumuaVsOaNrlxyXG4gICovXHJcbiAgcHJpdmF0ZSBiaW5kRGF0YShjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGxldCBza2lwUmVmcmVzaDogYm9vbGVhbiA9IHRoaXMuaGFuZGxlQ2hhbmdlKGNoYW5nZSk7XHJcbiAgICBpZiAoc2tpcFJlZnJlc2gpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gdGhpcy5zb3VyY2VEYXRhID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oeyBpZ25vcmVNdWx0aUxhbmdJbnB1dDogdHJ1ZSB9KTtcclxuICAgIGNvbnN0IG9sZFRyZWVOb2RlcyA9IHRoaXMudHJlZVRhYmxlLnZhbHVlO1xyXG4gICAgY29uc3QgdHJlZU5vZGVzRGF0YSA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKHsgaWdub3JlTXVsdGlMYW5nSW5wdXQ6IHRydWUgfSk7XHJcbiAgICBsZXQgdHJlZU5vZGVzOiBUcmVlTm9kZVtdID0gW107XHJcblxyXG4gICAgaWYgKHRyZWVOb2Rlc0RhdGEgJiYgdHJlZU5vZGVzRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGxldCBoaWVyYXJjaHlJbmZvID0gdHJlZU5vZGVzRGF0YVswXVt0aGlzLmhpZXJhcmNoeUluZm9GaWVsZF07XHJcbiAgICAgIGNvbnN0IGJ1aWxkZXI6IFR5cGU8YW55PiA9IFRyZWVOb2RlQnVpbGRlckZhY3RvcnkuZ2V0QnVpbGRlcihoaWVyYXJjaHlJbmZvKTtcclxuICAgICAgLy8g5pyN5Yqh5Zmo6L+U5Zue55qE5YiG57qn6IqC54K55L+h5oGv5Yy56YWN5LiN5Yiw546w5pyJ5bel5Y6C6YeM6Z2i55qE5Lu75L2V5LiA56eN5oOF5Ya144CC56Gu6K6k5paw5Yqg55qEYnVpbGRlcuW3sue7j+WcqOW3peWOguS4reazqOWGjFxyXG4gICAgICBpZiAoYnVpbGRlciA9PSBudWxsKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmVlVGFibGUgYnVpbGRlciBpcyBudWxsIScpO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBleHBhbmRMZXZlbCA9IC0xO1xyXG4gICAgICBjb25zdCB0cmVlRXhwYW5kTGV2ZWwgPSB0aGlzLnRyZWVUYWJsZVsnZXhwYW5kTGV2ZWwnXTtcclxuICAgICAgaWYgKHR5cGVvZiB0cmVlRXhwYW5kTGV2ZWwgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgZXhwYW5kTGV2ZWwgPSB0cmVlRXhwYW5kTGV2ZWw7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgY29udGV4dCA9IHtcclxuICAgICAgICBleHBhbmRMZXZlbCxcclxuICAgICAgICBjb21wb25lbnQ6IHRoaXMudHJlZVRhYmxlLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCB0cmVlTm9kZXNCdWlsZGVyID0gbmV3IGJ1aWxkZXIoXHJcbiAgICAgICAgdHJlZU5vZGVzRGF0YSwgb2xkVHJlZU5vZGVzLFxyXG4gICAgICAgIHRoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleSwgdGhpcy5oaWVyYXJjaHlJbmZvRmllbGQsIGNvbnRleHRcclxuICAgICAgKTtcclxuICAgICAgdHJlZU5vZGVzID0gdHJlZU5vZGVzQnVpbGRlci5idWlsZCgpO1xyXG4gICAgICAvLyDojrflj5bnu5HlrprmlbDmja7lr7nlupTnmoTlrp7kvZPliJfooahcclxuICAgICAgbGV0IGVudGl0eUFycjogRW50aXR5W10gPSB0aGlzLmdldEVudGl0eUFycigpO1xyXG4gICAgICAvLyDmoLnmja50cmVlTm9kZXPnmoTpobrluo/lnKjlr7nlupTnmoTlrp7kvZPkuIrmt7vliqDluo/lj7flrZfmrrVfX0FDVFVBTF9JTkRFWF9fXHJcbiAgICAgIHRoaXMuc2V0QWN0dWFsSW5kZXgoZW50aXR5QXJyLCB0cmVlTm9kZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdGhpcy50cmVlVGFibGUubGF6eSkge1xyXG4gICAgICB0aGlzLnRyZWVUYWJsZS50b3RhbFJlY29yZHMgPSAodGhpcy50cmVlVGFibGUuX3ZhbHVlID8gdGhpcy50cmVlVGFibGUuX3ZhbHVlLmxlbmd0aCA6IDApO1xyXG4gICAgICBpZiAodGhpcy50cmVlVGFibGUuc29ydE1vZGUgPT0gJ3NpbmdsZScgJiYgdGhpcy50cmVlVGFibGUuc29ydEZpZWxkKVxyXG4gICAgICAgIHRoaXMudHJlZVRhYmxlLnNvcnRTaW5nbGUoKTtcclxuICAgICAgZWxzZSBpZiAodGhpcy50cmVlVGFibGUuc29ydE1vZGUgPT0gJ211bHRpcGxlJyAmJiB0aGlzLnRyZWVUYWJsZS5tdWx0aVNvcnRNZXRhKVxyXG4gICAgICAgIHRoaXMudHJlZVRhYmxlLnNvcnRNdWx0aXBsZSgpO1xyXG4gICAgICBlbHNlIGlmICh0aGlzLnRyZWVUYWJsZS5oYXNGaWx0ZXIoKSkgLy9zb3J0IGFscmVhZHkgZmlsdGVyc1xyXG4gICAgICAgIHRoaXMudHJlZVRhYmxlLl9maWx0ZXIoKTtcclxuICAgIH1cclxuICAgIHRoaXMudHJlZVRhYmxlLnRhYmxlU2VydmljZS5vblVJVXBkYXRlKHRyZWVOb2Rlcyk7XHJcbiAgICB0aGlzLnRyZWVUYWJsZS52YWx1ZSA9IHRyZWVOb2RlcztcclxuICAgIHRoaXMudHJlZVRhYmxlLnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG5cclxuICAgIC8vIHRoaXMudHJlZU5vZGVNYXAgPSB7fTtcclxuICAgIC8vIHRoaXMuc291cmNlRGF0YUNsb25lID0gdGhpcy5zb3VyY2VEYXRhO1xyXG4gICAgLy8gdGhpcy50cmVlVGFibGUudmFsdWUgPSBbLi4udGhpcy50cmVlTm9kZXNCdWlsZGVyKCldO1xyXG4gICAgLy8gdGhpcy50cmVlVGFibGVWYWx1ZUhhbmRsZXIoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZFJvdyhjaGFuZ2U6IENoYW5nZSkge1xyXG4gICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICBpZiAodGhpcy50cmVlVGFibGVTZWxlY3RlZEV2ZW50KSB7XHJcbiAgICAgIHRoaXMudHJlZVRhYmxlU2VsZWN0ZWRFdmVudCA9IGZhbHNlO1xyXG4gICAgICB0aGlzLnNlbGVjdGVkUm93SWQgPSBjdXJyZW50SWQ7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHNlcmlhbGl6ZWRWYWx1ZSA9IHRoaXMudHJlZVRhYmxlLnNlcmlhbGl6ZWRWYWx1ZTtcclxuXHJcbiAgICBjb25zdCB0cmVlTm9kZSA9IHNlcmlhbGl6ZWRWYWx1ZSAmJiBzZXJpYWxpemVkVmFsdWUuZmluZChpdGVtID0+IGl0ZW0gJiYgaXRlbS5ub2RlICYmIGl0ZW0ubm9kZS5kYXRhICYmIGl0ZW0ubm9kZS5kYXRhLmlkID09PSBjdXJyZW50SWQpIHx8IG51bGw7XHJcbiAgICBpZiAodHJlZU5vZGUpIHtcclxuICAgICAgaWYgKHRoaXMudHJlZVRhYmxlLmlzU2VsZWN0ZWQodHJlZU5vZGUubm9kZSkgfHwgY3VycmVudElkID09PSB0aGlzLnNlbGVjdGVkUm93SWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zZWxlY3RlZFJvd0lkID0gY3VycmVudElkO1xyXG4gICAgICB0aGlzLnRyZWVUYWJsZS5oYW5kbGVSb3dDbGljayh7IHJvd05vZGU6IHRyZWVOb2RlLCBvcmlnaW5hbEV2ZW50OiB7IHRhcmdldDogeyBub2RlTmFtZTogJycgfSB9IH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdvbkVkaXRJbml0JywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25FZGl0SW5pdEhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5ub2RlU2VsZWN0Q2hhbmdlLmVtaXQoZXZlbnRbJ2RhdGEnXSk7XHJcbiAgICBjb25zdCBpZCA9IGV2ZW50LmRhdGFbdGhpcy5pZEZpZWxkXTtcclxuICAgIHRoaXMuc2V0Q3VycmVudElkVG9CaW5kaW5nTGlzdChpZCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignb25FZGl0Q29tcGxldGUnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBvbkVkaXRDb21wbGV0ZUhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IGZpZWxkTmFtZSA9IGV2ZW50LmZpZWxkO1xyXG4gICAgY29uc3QgY29sdW1uID0gdGhpcy5jb2x1bW5zLmZpbmQoaXRlbSA9PiBpdGVtLmZpZWxkID09PSBmaWVsZE5hbWUpO1xyXG4gICAgaWYgKGZpZWxkTmFtZSAmJiBjb2x1bW4gJiYgY29sdW1uLmVkaXRvciAmJiBjb2x1bW4uZWRpdG9yLm9wdGlvbnMgJiYgY29sdW1uLmVkaXRvci5vcHRpb25zLnR5cGUgPT09ICdFZGl0b3JUeXBlcy5MT09LVVAnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChldmVudCAmJiBldmVudC5oYXNPd25Qcm9wZXJ0eSgnZGF0YScpKSB7XHJcbiAgICAgIGNvbnN0IHByaW1hcnlLZXlWYWx1ZSA9IGV2ZW50LmRhdGFbdGhpcy5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5wcmltYXJ5S2V5XTtcclxuXHJcbiAgICAgIGxldCB2YWx1ZTogYW55ID0gdGhpcy5nZXRWYWx1ZShmaWVsZE5hbWUsIGV2ZW50LmRhdGEpO1xyXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aCB8fCAnLyc7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdEYXRhID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShiaW5kaW5nUGF0aHMpO1xyXG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoZmllbGROYW1lLCBiaW5kaW5nRGF0YSk7XHJcbiAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMudHJlZVRhYmxlLmNvbHVtbnMuZmluZChpdGVtID0+IGl0ZW0uZmllbGQgPT09IGZpZWxkTmFtZSk7XHJcbiAgICAgIGNvbnN0IGRhdGFUeXBlID0gY29sdW1uICYmIGNvbHVtbi5kYXRhVHlwZSB8fCBudWxsO1xyXG4gICAgICBpZiAoZGF0YVR5cGUgPT09ICdkYXRlJyB8fCBkYXRhVHlwZSA9PT0gJ2RhdGV0aW1lJykge1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGVTZXJ2aWNlKSB7XHJcbiAgICAgICAgICBjb25zdCBmb3JtYXQgPSBjb2x1bW4gJiYgY29sdW1uLmZvcm1hdHRlciAmJiBjb2x1bW4uZm9ybWF0dGVyLm9wdGlvbnMgJiYgY29sdW1uLmZvcm1hdHRlci5vcHRpb25zLmZvcm1hdCB8fCAneXl5eS1NTS1kZCc7XHJcbiAgICAgICAgICB2YWx1ZSA9IHRoaXMuZGF0ZVNlcnZpY2UuZm9ybWF0VG8odmFsdWUsIGZvcm1hdCk7XHJcbiAgICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gbnVsbDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgdmFsdWUgPSBOdW1iZXIodmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh2YWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZUJpbmRpbmdMaXN0KHByaW1hcnlLZXlWYWx1ZSwgZmllbGROYW1lLCB2YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ29uTm9kZUV4cGFuZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uTm9kZUV4cGFuZEhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgLy8gdGhpcy5zZXROb2RlRXhwYW5kZWRWYWx1ZShldmVudCk7XHJcbiAgICBjb25zdCBzZWxlY3RlZElkID0gZXZlbnQgJiYgZXZlbnQubm9kZSAmJiBldmVudC5ub2RlLmlkIHx8IG51bGw7XHJcbiAgICBpZiAoIXNlbGVjdGVkSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgIGV4cGFuZE5vZGVzLnB1c2goc2VsZWN0ZWRJZCk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnLCBleHBhbmROb2Rlcyk7XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdvbk5vZGVDb2xsYXBzZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uTm9kZUNvbGxhcHNlSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICAvLyB0aGlzLnNldE5vZGVFeHBhbmRlZFZhbHVlKGV2ZW50KTtcclxuICB9XHJcbiAgQEhvc3RMaXN0ZW5lcignb25Ob2RlU2VsZWN0JywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25Ob2RlU2VsZWN0SGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBpZCA9IGV2ZW50ICYmIGV2ZW50Lm5vZGUgJiYgZXZlbnQubm9kZS5kYXRhICYmIGV2ZW50Lm5vZGUuZGF0YVt0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LnByaW1hcnlLZXldIHx8IG51bGw7XHJcbiAgICBpZiAoaWQgPT09IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMudHJlZVRhYmxlU2VsZWN0ZWRFdmVudCA9IHRydWU7XHJcbiAgICB0aGlzLnNldEN1cnJlbnRJZFRvQmluZGluZ0xpc3QoaWQpO1xyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdvbk5vZGVVbnNlbGVjdCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uTm9kZVVuc2VsZWN0SGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICB0aGlzLnNldEN1cnJlbnRJZFRvQmluZGluZ0xpc3QobnVsbCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgc2V0Tm9kZUV4cGFuZGVkVmFsdWUoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKCFldmVudCB8fCAhdGhpcy5vbGRUcmVlTm9kZU1hcCB8fCBPYmplY3Qua2V5cyh0aGlzLm9sZFRyZWVOb2RlTWFwKS5sZW5ndGggPD0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgY3VycmVudElkID0gZXZlbnQubm9kZS5kYXRhLmlkO1xyXG4gICAgICB0aGlzLm9sZFRyZWVOb2RlTWFwW2N1cnJlbnRJZF0uZXhwYW5kZWQgPSBldmVudC5leHBhbmRlZDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBzZXROb2RlRXhwYW5kZWRWYWx1ZSBlcnJvcjoke2UubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBzZXRDdXJyZW50SWRUb0JpbmRpbmdMaXN0KHNlbGVjdGVkSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3Qgb2xkQ3VycmVudElkID0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICBpZiAob2xkQ3VycmVudElkID09PSBzZWxlY3RlZElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYmluZGluZ0xpc3Quc2V0Q3VycmVudElkKHNlbGVjdGVkSWQsIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRQYXRocygpOiBzdHJpbmdbXSB7XHJcbiAgICBsZXQgcGF0aHMgPSBbXTtcclxuICAgIGlmICghdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsIHx8ICF0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHBhdGhzO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGxldCBiaW5kaW5nUGF0aCA9IHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgICAgcGF0aHMgPSBiaW5kaW5nUGF0aC5zdWJzdHJpbmcoMSwgYmluZGluZ1BhdGgubGVuZ3RoKS5zcGxpdCgnLycpO1xyXG4gICAgICByZXR1cm4gcGF0aHM7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgdXBkYXRlQmluZGluZ0xpc3QocHJpbWFyeVZhbHVlOiBhbnksIHByb3BlcnR5TmFtZTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgICBpZiAoIXByb3BlcnR5TmFtZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDmm7TmlrDkuLvooajpg6jliIbooYznmoTlrZfmrrVcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZXMgPSBwcm9wZXJ0eU5hbWUuc3BsaXQoJy4nKS5maWx0ZXIoaXRlbSA9PiBpdGVtKTtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy5nZXRCaW5kaW5nUGF0aEFycmF5KCk7XHJcbiAgICAvLyDlj5blh7rmnaXnmoTkuIDlrprmmK9iaW5kaW5nTGlzdFxyXG4gICAgY29uc3QgbGlzdCA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUoYmluZGluZ1BhdGgpIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgLy8g5L+u5pS555qE5piv5b2T5YmN6KGMXHJcbiAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLmNvbmNhdChwcm9wZXJ0eU5hbWVzKTtcclxuICAgIGlmIChsaXN0ICYmIHByaW1hcnlWYWx1ZSA9PT0gbGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWUpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRWYWx1ZShwYXRocywgdmFsdWUsIHRydWUsIHRydWUpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nTGlzdC5maW5kQnlJZChwcmltYXJ5VmFsdWUpO1xyXG4gICAgaWYgKCFiaW5kaW5nT2JqZWN0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChwcm9wZXJ0eU5hbWVzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgYmluZGluZ09iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlLCB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVkQ2hhbmdlSW52b2tlckZhY3RvcnkoKShwYXRocykpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IHRhcmdldEJpbmRpbmdPYmplY3QgPSBudWxsO1xyXG4gICAgICBjb25zdCBmcGF0aHMgPSBwcm9wZXJ0eU5hbWVzLnNsaWNlKDAsIHByb3BlcnR5TmFtZXMubGVuZ3RoIC0gMSk7XHJcbiAgICAgIGNvbnN0IHRhcmdldFByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZXNbcHJvcGVydHlOYW1lcy5sZW5ndGggLSAxXTtcclxuICAgICAgZnBhdGhzLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgICAgdGFyZ2V0QmluZGluZ09iamVjdCA9IHRhcmdldEJpbmRpbmdPYmplY3QgJiYgdGFyZ2V0QmluZGluZ09iamVjdFtwcm9wXSB8fCBiaW5kaW5nT2JqZWN0W3Byb3BdO1xyXG4gICAgICB9KTtcclxuICAgICAgLy8gdG9kbzrpnIDopoHmt7vliqDlgLzlj5jljJbkuovku7ZcclxuICAgICAgdGFyZ2V0QmluZGluZ09iamVjdC5zZXRWYWx1ZSh0YXJnZXRQcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlLCB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVkQ2hhbmdlSW52b2tlckZhY3RvcnkoKShwYXRocykpO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGdldEJpbmRpbmdQYXRoQXJyYXkoKTogYW55W10ge1xyXG4gICAgY29uc3QgcGF0aCA9IHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgIGlmIChwYXRoKSB7XHJcbiAgICAgIHJldHVybiBwYXRoLnNwbGl0KCcvJykuZmlsdGVyKG4gPT4gbiAhPT0gJycpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxuICBwcml2YXRlIGdldFZhbHVlKHBhdGg6IHN0cmluZywgZGF0YTogYW55KSB7XHJcbiAgICBsZXQgdmFsdWUgPSAnJztcclxuICAgIGlmIChwYXRoLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgdmFsdWUgPSBkYXRhW3BhdGhdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFsdWUgPSBwYXRoLnNwbGl0KCcuJykucmVkdWNlKChyZXN1bHQsIHByb3ApID0+IHtcclxuICAgICAgICByZXR1cm4gcmVzdWx0W3Byb3BdO1xyXG4gICAgICB9LCBkYXRhKTtcclxuICAgIH1cclxuICAgIHJldHVybiB2YWx1ZTtcclxuICB9XHJcbiAgcHJvdGVjdGVkIHNldENoZWNrcyhpZHM6IHN0cmluZ1tdKSB7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCBpZHMpO1xyXG4gIH1cclxufSJdfQ==