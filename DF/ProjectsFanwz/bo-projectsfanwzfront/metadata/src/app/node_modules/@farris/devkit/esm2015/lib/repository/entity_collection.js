import { Modification, ModifyType } from '../changeset/index';
import { Subject } from 'rxjs';
import { Entity, FieldMetadataUtil, EntityList } from '../entity/index';
// tslint:disable: no-bitwise
/**
 * 实体集合
 * @todo：应该用EntityList代替。
 */
class EntityCollection {
    /**
     * 构造函数
     */
    constructor(entityType) {
        this.innerEntitySet = new Set();
        this.innerEntityMap = new Map();
        this.collectionChanged = new Subject();
        this.changes = new Subject();
        this.entityType = entityType;
        this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType) || entityType.prototype.primaryKey;
    }
    /**
     * 实体数量
     */
    count() {
        return this.innerEntitySet.size;
    }
    get entityTypeName() {
        return this.entityType.name;
    }
    /**
     * 是否包含指定主键值的实体
     * @param id 主键值
     */
    has(id) {
        return this.innerEntityMap.has(id);
    }
    /**
     * 清空全部实体
     */
    clear() {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        this.notifyCollectionChanged(new Modification([], ModifyType.Load));
    }
    /**
     * 清空全部实体
     * @param isReset 是否为重置实体操作
     */
    reset() {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        const modification = new Modification([], ModifyType.Load);
        modification.isReset = true;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 转换为实体数组
     */
    toArray() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 转换为JSON数组
     */
    toJSON() {
        const result = [];
        const entities = this.toArray();
        entities.forEach((entity) => {
            result.push(entity.toJSON());
        });
        return result;
    }
    /**
     * 批量加载实体
     */
    loadEntities(entities, entityCreate = false) {
        this.innerEntityMap.forEach(item => {
            item.unsubscribe.next();
            item.unsubscribe.complete();
            item.valueChanged.complete();
            item.data = undefined;
        });
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        entities.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        const modification = new Modification(entities, ModifyType.Load);
        modification.entityCreate = entityCreate;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 追加实体
     * @param entity 要追加的实体
     * @param isCloned 实体是否是克隆的
     */
    addEntity(entity, isCloned = false) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        const modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;
        this.notifyCollectionChanged(new Modification([entity], modifyType));
    }
    /**
     * 在当前行前或后插入数据
     * @param entity 实体
     * @param position 位置
     */
    insertEntity(entity, position) {
        this.verifyEntityToAdd(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));
    }
    /**
     * 更新实体
     * @param entity entity
     * @param data 实体数据
     */
    updateEntity(entity, data) {
        entity.load(data);
        this.notifyCollectionChanged(new Modification(data, ModifyType.Update, null, null));
    }
    /**
     * 批量追加实体
     * @param entities 要加载的实体数组
     */
    addEntities(entities) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.Add));
    }
    /**
     * 添加实体（不切换当前行）
     * @param entities 实体
     */
    addData(entities) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        this.notifyCollectionChanged(new Modification(entitiesToAdd, ModifyType.AddData));
    }
    /**
     * 根据主键值获取实体
     */
    getEntityById(identity) {
        if (this.innerEntityMap.has(identity) === false) {
            return null;
        }
        const entity = this.innerEntityMap.get(identity);
        return entity;
    }
    /**
     * 根据路径获取实体
     */
    getEntityByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let parentNode = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && parentNode; i = i + 1) {
            const currentPath = pathArray[i];
            if ((parentNode instanceof Entity) || (parentNode.constructor &&
                parentNode.constructor.prototype &&
                parentNode.constructor.prototype.typeName === 'ConcreteEntityPrototype')) {
                // @todo：强识了别冒号
                if (currentPath.indexOf(':') === -1) {
                    parentNode = parentNode[pathArray[i]];
                }
            }
            else {
                parentNode = parentNode.get(pathArray[i].split(':')[1]);
            }
        }
        return parentNode;
    }
    /**
     * id:1/a/id:2/c
     * @param pathArray 路径数组
     */
    getEntitiesByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let entity = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && entity; i += 2) {
            const path = pathArray[i];
            entity = entity[path];
            if (!(entity instanceof EntityList)) {
                throw new Error('路径格式错误');
            }
            if ((i + 1) < pathArray.length) {
                const id = pathArray[i + 1].split(':')[1];
                entity = entity.get(id);
            }
        }
        return entity;
    }
    /**
     * 返回符合指定条件的实体集合
     * @param predicate 条件谓词
     */
    getEntities(predicate) {
        const entities = Array.from(this.innerEntitySet);
        const matchedEntities = entities.filter(predicate);
        return matchedEntities;
    }
    /**
     * 获取全部实体
     */
    getAllEntities() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 根据主键值删除对应实体
     * @param identity 主键值
     */
    removeEntityById(identity) {
        this.verifyEntityToRemove(identity);
        const entityToRemove = this.innerEntityMap.get(identity);
        this.innerEntityMap.delete(identity);
        this.innerEntitySet.delete(entityToRemove);
        this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));
        return entityToRemove;
    }
    removeEntitiesByIds(id) {
    }
    /**
     * 删除符合条件的实体集合
     */
    removeEntities(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));
        return entitiesToRemove;
    }
    /**
     * 移除数据（不切换当前行）
     * @param predicate 过滤函数
     */
    removeData(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));
        return entitiesToRemove;
    }
    /**
     * 重置子表数据
     * @param paths 路径
     * 路径格式 ['id:provinceId','id:cityMDMs','zoneMDMs']
     * @description path参数格式
     * ```json
     * [
     * "id:b5ed23ca-88d9-4377-98ec-92f35c1325f1",
     * "cityMDMs",
     * "id:373706af-622f-4aea-a006-dddbffd7bda3",
     * "zoneMDMs"
     * ]
     * ```
     * @param entities 实体数组
     */
    resetEntities(paths, entities) {
        if (paths[0].indexOf(':') === -1) {
            throw new Error('路径格式错误');
        }
        // 获取主实体
        const id = paths[0].split(':')[1];
        let entity = this.innerEntityMap.get(id);
        let entityList = entity[paths[1]];
        if (!entity) {
            throw new Error(`找不到主键为${id}的实体`);
        }
        for (let index = 2; index < paths.length; index += 2) {
            const pathInfo = paths[index].split(':');
            const entityId = pathInfo[1];
            // 获取到当前层级的实体
            entity = entityList.get(entityId);
            if (!entity) {
                throw new Error(`找不到主键为${id}的实体`);
            }
            // 获取当前层级实体下的列表属性
            entityList = entity[paths[index + 1]];
        }
        entityList.clear();
        entityList.loadEntities(entities);
    }
    /**
     * 验证实体是否能够添加
     */
    verifyEntityToAdd(entity) {
        if (this.has(entity[this.primaryKey])) {
            throw new Error(`The repository already had an item with the save identity of '${entity[this.primaryKey]}'`);
        }
        return true;
    }
    /**
     * 验证实体是否能移除
     */
    verifyEntityToRemove(identity) {
        if (!this.has(identity)) {
            throw new Error(`The entity with identity of '${identity} dose not exsit.'`);
        }
        return true;
    }
    /**
     * 实体集合变更流
     */
    notifyCollectionChanged(modification) {
        this.collectionChanged.next(modification);
    }
    listenEntityChangeEvent(entity) {
        if (entity) {
            entity.onValueChanged.subscribe((change) => this.changes.next(change));
        }
    }
    //#region 分页
    /**
     * 设置分页大小
     */
    set pageSize(pageSize) {
        if (typeof (pageSize) !== 'number' || pageSize < 0) {
            throw new Error('Invalid parameter:pageSize');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));
        this.paginationInfo = Object.assign({}, original, { pageSize });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取分页大小
     * @description 如果用户未指定分页大小则默认为0，即获取所有数据
     */
    get pageSize() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageSize || 0;
        }
        return 0;
    }
    /**
     * 设置数据总条数
     */
    set totalCount(total) {
        if (typeof (total) !== 'number' || total < 0) {
            throw new Error('Invalid parameter:total');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { total });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取数据总条数
     */
    get totalCount() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.total || 0;
        }
        return 0;
    }
    /**
     * 设置当前页码
     */
    set pageIndex(pageIndex) {
        if (typeof (pageIndex) !== 'number' || pageIndex < 0) {
            throw new Error('Invalid parameter:pageIndex');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { pageIndex });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取当前页码
     */
    get pageIndex() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageIndex || 1;
        }
        return 1;
    }
    /**
     * 更新分页信息
     * @param path 绑定路径
     * @param pageInfo 分页信息
     */
    updatePaginationInfoByPath(path, pageInfo) {
        const original = this.paginationInfo;
        const { pageIndex, pageSize } = pageInfo;
        const total = pageInfo && (pageInfo.totalCount || pageInfo.total) || 0;
        const paginationInfo = Object.assign({}, original, { pageIndex, pageSize, total });
        this.setPaginationConfigByPath(path, paginationInfo);
    }
    /**
     * 根据路径获取分页大小
     * @param path 路径
     */
    getPaginationConfigByPath(path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());
        let config = this.paginationInfo;
        paths.forEach(item => {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    }
    /**
     * 设置分页信息
     * @param path 路径
     * @param value 值，其中总条数key为total
     */
    setPaginationConfigByPath(path, value) {
        const original = JSON.stringify(this.paginationInfo);
        if (!path || path === '/') {
            this.paginationInfo = value;
        }
        else {
            if (!Array.isArray(path)) {
                path = path.toString().match(/[^/[\]]+/g) || [];
            }
            path.slice(0, -1).reduce((prev, current, index) => Object(prev[current]) === prev[current]
                ? prev[current]
                : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]
                    ? []
                    : {}, this.paginationInfo)[path[path.length - 1]] = value;
        }
        if (JSON.stringify(this.paginationInfo) !== original) {
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        }
        return this.paginationInfo;
    }
}
export { EntityCollection };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2NvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L2VudGl0eV9jb2xsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDOUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3hFLDZCQUE2QjtBQUM3Qjs7O0dBR0c7QUFDSCxNQUFNLGdCQUFnQjtJQWtDcEI7O09BRUc7SUFDSCxZQUFZLFVBQWU7UUFDekIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQWEsQ0FBQztRQUMzQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxPQUFPLEVBQWdCLENBQUM7UUFDckQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBZ0IsQ0FBQztRQUMzQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7SUFDeEcsQ0FBQztJQUVEOztPQUVHO0lBQ0ksS0FBSztRQUNWLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7SUFDbEMsQ0FBQztJQUVELElBQVcsY0FBYztRQUN2QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO0lBQzlCLENBQUM7SUFDRDs7O09BR0c7SUFDSSxHQUFHLENBQUMsRUFBVTtRQUNuQixPQUFP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Q0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7U0FDdEc7UUFDRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztDQUVGO0FBRUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBAQXV0aG9yOiBXaXR0XHJcbiAqIEBEYXRlOiAyMDE4LTEwLTAxIDE5OjM2OjUxXHJcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBhYWxpenp3ZWxsXHJcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMDktMDMgMTk6NDY6NDJcclxuICovXHJcbmltcG9ydCB7IFR5cGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTW9kaWZpY2F0aW9uLCBNb2RpZnlUeXBlIH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBFbnRpdHksIEZpZWxkTWV0YWRhdGFVdGlsLCBFbnRpdHlMaXN0IH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLWJpdHdpc2VcclxuLyoqXHJcbiAqIOWunuS9k+mbhuWQiFxyXG4gKiBAdG9kb++8muW6lOivpeeUqEVudGl0eUxpc3Tku6Pmm7/jgIJcclxuICovXHJcbmNsYXNzIEVudGl0eUNvbGxlY3Rpb248VCBleHRlbmRzIEVudGl0eT4ge1xyXG5cclxuICAvKipcclxuICAgKiDlhoXpg6jlrp7kvZNTZXRcclxuICAgKi9cclxuICBwcml2YXRlIGlubmVyRW50aXR5U2V0OiBTZXQ8VD47XHJcblxyXG4gIC8qKlxyXG4gICAqIOWGhemDqOWunuS9k01hcFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJFbnRpdHlNYXA6IE1hcDxzdHJpbmcsIFQ+O1xyXG4gIHB1YmxpYyBjaGFuZ2VzOiBTdWJqZWN0PE1vZGlmaWNhdGlvbj47XHJcblxyXG4gIC8qKlxyXG4gICAqIEVudGl0eembhuWQiOWPmOabtOa1gVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb2xsZWN0aW9uQ2hhbmdlZDogU3ViamVjdDxNb2RpZmljYXRpb24+O1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwdWJsaWMgcmVhZG9ubHkgZW50aXR5VHlwZTogVHlwZTxUPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Li76ZSuXHJcbiAgICovXHJcbiAgcHVibGljIHJlYWRvbmx5IHByaW1hcnlLZXk6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5b2T5YmN5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIHBhZ2luYXRpb25JbmZvOiBhbnk7XHJcblxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihlbnRpdHlUeXBlOiBhbnkpIHtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQgPSBuZXcgU2V0PFQ+KCk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwID0gbmV3IE1hcDxzdHJpbmcsIFQ+KCk7XHJcbiAgICB0aGlzLmNvbGxlY3Rpb25DaGFuZ2VkID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gICAgdGhpcy5lbnRpdHlUeXBlID0gZW50aXR5VHlwZTtcclxuICAgIHRoaXMucHJpbWFyeUtleSA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldFByaW1hcnlLZXkodGhpcy5lbnRpdHlUeXBlKSB8fCBlbnRpdHlUeXBlLnByb3RvdHlwZS5wcmltYXJ5S2V5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5pWw6YePXHJcbiAgICovXHJcbiAgcHVibGljIGNvdW50KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckVudGl0eVNldC5zaXplO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBlbnRpdHlUeXBlTmFtZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmVudGl0eVR5cGUubmFtZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5YyF5ZCr5oyH5a6a5Li76ZSu5YC855qE5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOS4u+mUruWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXMoaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJFbnRpdHlNYXAuaGFzKGlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa4heepuuWFqOmDqOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhcigpIHtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihbXSwgTW9kaWZ5VHlwZS5Mb2FkKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepuuWFqOmDqOWunuS9k1xyXG4gICAqIEBwYXJhbSBpc1Jlc2V0IOaYr+WQpuS4uumHjee9ruWunuS9k+aTjeS9nFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCgpIHtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcclxuICAgIGNvbnN0IG1vZGlmaWNhdGlvbiA9IG5ldyBNb2RpZmljYXRpb24oW10sIE1vZGlmeVR5cGUuTG9hZCk7XHJcbiAgICBtb2RpZmljYXRpb24uaXNSZXNldCA9IHRydWU7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG1vZGlmaWNhdGlvbik7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouS4uuWunuS9k+aVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0FycmF5KCk6IEVudGl0eVtdIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6SlNPTuaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0pTT04oKTogYW55W10ge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMudG9BcnJheSgpO1xyXG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcclxuICAgICAgcmVzdWx0LnB1c2goZW50aXR5LnRvSlNPTigpKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WKoOi9veWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkRW50aXRpZXMoZW50aXRpZXM6IGFueVtdLCBlbnRpdHlDcmVhdGU6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBpdGVtLnVuc3Vic2NyaWJlLm5leHQoKTtcclxuICAgICAgaXRlbS51bnN1YnNjcmliZS5jb21wbGV0ZSgpO1xyXG4gICAgICBpdGVtLnZhbHVlQ2hhbmdlZC5jb21wbGV0ZSgpO1xyXG4gICAgICBpdGVtLmRhdGEgPSB1bmRlZmluZWQ7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcclxuXHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IG1vZGlmaWNhdGlvbiA9IG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXMsIE1vZGlmeVR5cGUuTG9hZCk7XHJcbiAgICBtb2RpZmljYXRpb24uZW50aXR5Q3JlYXRlID0gZW50aXR5Q3JlYXRlO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb24pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOi/veWKoOWunuS9k1xyXG4gICAqIEBwYXJhbSBlbnRpdHkg6KaB6L+95Yqg55qE5a6e5L2TXHJcbiAgICogQHBhcmFtIGlzQ2xvbmVkIOWunuS9k+aYr+WQpuaYr+WFi+mahueahFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRFbnRpdHkoZW50aXR5OiBhbnksIGlzQ2xvbmVkOiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcclxuICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcclxuICAgIGNvbnN0IG1vZGlmeVR5cGUgPSBpc0Nsb25lZCA/IE1vZGlmeVR5cGUuQ2xvbmUgOiBNb2RpZnlUeXBlLkFkZDtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihbZW50aXR5XSwgbW9kaWZ5VHlwZSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlnKjlvZPliY3ooYzliY3miJblkI7mj5LlhaXmlbDmja5cclxuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k1xyXG4gICAqIEBwYXJhbSBwb3NpdGlvbiDkvY3nva5cclxuICAgKi9cclxuICBwdWJsaWMgaW5zZXJ0RW50aXR5KGVudGl0eTogYW55LCBwb3NpdGlvbjogMSB8IC0xKSB7XHJcbiAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XHJcbiAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXR5LCBNb2RpZnlUeXBlLkluc2VydCwgbnVsbCwgbnVsbCwgcG9zaXRpb24pKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5a6e5L2TXHJcbiAgICogQHBhcmFtIGVudGl0eSBlbnRpdHlcclxuICAgKiBAcGFyYW0gZGF0YSDlrp7kvZPmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlRW50aXR5KGVudGl0eTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgIGVudGl0eS5sb2FkKGRhdGEpO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGRhdGEsIE1vZGlmeVR5cGUuVXBkYXRlLCBudWxsLCBudWxsKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+i/veWKoOWunuS9k1xyXG4gICAqIEBwYXJhbSBlbnRpdGllcyDopoHliqDovb3nmoTlrp7kvZPmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYWRkRW50aXRpZXMoZW50aXRpZXM6IGFueVtdKSB7XHJcbiAgICBpZiAoIWVudGl0aWVzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0aWVzVG9BZGQ6IGFueVtdID0gW107XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcclxuICAgICAgZW50aXRpZXNUb0FkZC5wdXNoKGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIGVudGl0aWVzVG9BZGQuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcclxuICAgICAgdGhpcy5saXN0ZW5FbnRpdHlDaGFuZ2VFdmVudChlbnRpdHkpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb0FkZCwgTW9kaWZ5VHlwZS5BZGQpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5re75Yqg5a6e5L2T77yI5LiN5YiH5o2i5b2T5YmN6KGM77yJXHJcbiAgICogQHBhcmFtIGVudGl0aWVzIOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGREYXRhKGVudGl0aWVzOiBhbnlbXSkge1xyXG4gICAgaWYgKCFlbnRpdGllcykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbnRpdGllc1RvQWRkOiBhbnlbXSA9IFtdO1xyXG4gICAgZW50aXRpZXMuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XHJcbiAgICAgIGVudGl0aWVzVG9BZGQucHVzaChlbnRpdHkpO1xyXG4gICAgfSk7XHJcbiAgICBlbnRpdGllc1RvQWRkLmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5hZGQoZW50aXR5KTtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XHJcbiAgICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGVudGl0aWVzVG9BZGQsIE1vZGlmeVR5cGUuQWRkRGF0YSkpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruS4u+mUruWAvOiOt+WPluWunuS9k1xyXG4gICAqL1xyXG4gIGdldEVudGl0eUJ5SWQoaWRlbnRpdHk6IHN0cmluZyk6IGFueSB7XHJcbiAgICBpZiAodGhpcy5pbm5lckVudGl0eU1hcC5oYXMoaWRlbnRpdHkpID09PSBmYWxzZSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuaW5uZXJFbnRpdHlNYXAuZ2V0KGlkZW50aXR5KTtcclxuICAgIHJldHVybiBlbnRpdHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7ot6/lvoTojrflj5blrp7kvZNcclxuICAgKi9cclxuICBnZXRFbnRpdHlCeVBhdGgocGF0aEFycmF5OiBzdHJpbmdbXSk6IGFueSB7XHJcbiAgICBjb25zdCByb290RW50aXR5SWQgPSBwYXRoQXJyYXlbMF0uc3BsaXQoJzonKVsxXTtcclxuICAgIGxldCBwYXJlbnROb2RlOiBhbnkgPSB0aGlzLmdldEVudGl0eUJ5SWQocm9vdEVudGl0eUlkKTtcclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGF0aEFycmF5Lmxlbmd0aCAmJiBwYXJlbnROb2RlOyBpID0gaSArIDEpIHtcclxuICAgICAgY29uc3QgY3VycmVudFBhdGggPSBwYXRoQXJyYXlbaV07XHJcbiAgICAgIGlmICgocGFyZW50Tm9kZSBpbnN0YW5jZW9mIEVudGl0eSkgfHwgKFxyXG4gICAgICAgIHBhcmVudE5vZGUuY29uc3RydWN0b3IgJiZcclxuICAgICAgICBwYXJlbnROb2RlLmNvbnN0cnVjdG9yLnByb3RvdHlwZSAmJlxyXG4gICAgICAgIHBhcmVudE5vZGUuY29uc3RydWN0b3IucHJvdG90eXBlLnR5cGVOYW1lID09PSAnQ29uY3JldGVFbnRpdHlQcm90b3R5cGUnKVxyXG4gICAgICApIHtcclxuICAgICAgICAvLyBAdG9kb++8muW8uuivhuS6huWIq+WGkuWPt1xyXG4gICAgICAgIGlmIChjdXJyZW50UGF0aC5pbmRleE9mKCc6JykgPT09IC0xKSB7XHJcbiAgICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZVtwYXRoQXJyYXlbaV1dO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5nZXQocGF0aEFycmF5W2ldLnNwbGl0KCc6JylbMV0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGFyZW50Tm9kZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogaWQ6MS9hL2lkOjIvY1xyXG4gICAqIEBwYXJhbSBwYXRoQXJyYXkg6Lev5b6E5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGdldEVudGl0aWVzQnlQYXRoKHBhdGhBcnJheTogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IHJvb3RFbnRpdHlJZCA9IHBhdGhBcnJheVswXS5zcGxpdCgnOicpWzFdO1xyXG4gICAgbGV0IGVudGl0eTogYW55ID0gdGhpcy5nZXRFbnRpdHlCeUlkKHJvb3RFbnRpdHlJZCk7XHJcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhdGhBcnJheS5sZW5ndGggJiYgZW50aXR5OyBpICs9IDIpIHtcclxuICAgICAgY29uc3QgcGF0aCA9IHBhdGhBcnJheVtpXTtcclxuICAgICAgZW50aXR5ID0gZW50aXR5W3BhdGhdO1xyXG4gICAgICBpZiAoIShlbnRpdHkgaW5zdGFuY2VvZiBFbnRpdHlMaXN0KSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5qC85byP6ZSZ6K+vJyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKChpICsgMSkgPCBwYXRoQXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBwYXRoQXJyYXlbaSArIDFdLnNwbGl0KCc6JylbMV07XHJcbiAgICAgICAgZW50aXR5ID0gZW50aXR5LmdldChpZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBlbnRpdHk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi/lOWbnuespuWQiOaMh+WumuadoeS7tueahOWunuS9k+mbhuWQiFxyXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUg5p2h5Lu26LCT6K+NXHJcbiAgICovXHJcbiAgZ2V0RW50aXRpZXMocHJlZGljYXRlOiAodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlciwgYXJyYXk6IGFueVtdKSA9PiBhbnkpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBlbnRpdGllczogYW55W10gPSBBcnJheS5mcm9tKHRoaXMuaW5uZXJFbnRpdHlTZXQpO1xyXG4gICAgY29uc3QgbWF0Y2hlZEVudGl0aWVzID0gZW50aXRpZXMuZmlsdGVyKHByZWRpY2F0ZSk7XHJcbiAgICByZXR1cm4gbWF0Y2hlZEVudGl0aWVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YWo6YOo5a6e5L2TXHJcbiAgICovXHJcbiAgZ2V0QWxsRW50aXRpZXMoKTogYW55W10ge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7kuLvplK7lgLzliKDpmaTlr7nlupTlrp7kvZNcclxuICAgKiBAcGFyYW0gaWRlbnRpdHkg5Li76ZSu5YC8XHJcbiAgICovXHJcbiAgcmVtb3ZlRW50aXR5QnlJZChpZGVudGl0eTogc3RyaW5nKTogYW55IHtcclxuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9SZW1vdmUoaWRlbnRpdHkpO1xyXG4gICAgY29uc3QgZW50aXR5VG9SZW1vdmUgPSB0aGlzLmlubmVyRW50aXR5TWFwLmdldChpZGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShpZGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmRlbGV0ZShlbnRpdHlUb1JlbW92ZSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oW2VudGl0eVRvUmVtb3ZlXSwgTW9kaWZ5VHlwZS5SZW1vdmUpKTtcclxuICAgIHJldHVybiBlbnRpdHlUb1JlbW92ZTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUVudGl0aWVzQnlJZHMoaWQ6IHN0cmluZykge1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk56ym5ZCI5p2h5Lu255qE5a6e5L2T6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUVudGl0aWVzKHByZWRpY2F0ZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIsIGFycmF5OiBhbnlbXSkgPT4gYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgZW50aXRpZXNUb1JlbW92ZSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCkuZmlsdGVyKHByZWRpY2F0ZSk7XHJcbiAgICBlbnRpdGllc1RvUmVtb3ZlLmZvckVhY2goZW50aXR5VG9SZW1vdmUgPT4ge1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShlbnRpdHlUb1JlbW92ZVt0aGlzLnByaW1hcnlLZXldKTtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUoZW50aXR5VG9SZW1vdmUpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb1JlbW92ZSwgTW9kaWZ5VHlwZS5SZW1vdmUpKTtcclxuICAgIHJldHVybiBlbnRpdGllc1RvUmVtb3ZlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnp7vpmaTmlbDmja7vvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcclxuICAgKiBAcGFyYW0gcHJlZGljYXRlIOi/h+a7pOWHveaVsFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVEYXRhKHByZWRpY2F0ZTogKHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIsIGFycmF5OiBhbnlbXSkgPT4gYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgZW50aXRpZXNUb1JlbW92ZSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCkuZmlsdGVyKHByZWRpY2F0ZSk7XHJcbiAgICBlbnRpdGllc1RvUmVtb3ZlLmZvckVhY2goZW50aXR5VG9SZW1vdmUgPT4ge1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5TWFwLmRlbGV0ZShlbnRpdHlUb1JlbW92ZVt0aGlzLnByaW1hcnlLZXldKTtcclxuICAgICAgdGhpcy5pbm5lckVudGl0eVNldC5kZWxldGUoZW50aXR5VG9SZW1vdmUpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb1JlbW92ZSwgTW9kaWZ5VHlwZS5SZW1vdmVEYXRhKSk7XHJcbiAgICByZXR1cm4gZW50aXRpZXNUb1JlbW92ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YeN572u5a2Q6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIHBhdGhzIOi3r+W+hFxyXG4gICAqIOi3r+W+hOagvOW8jyBbJ2lkOnByb3ZpbmNlSWQnLCdpZDpjaXR5TURNcycsJ3pvbmVNRE1zJ11cclxuICAgKiBAZGVzY3JpcHRpb24gcGF0aOWPguaVsOagvOW8j1xyXG4gICAqIGBgYGpzb25cclxuICAgKiBbXHJcbiAgICogXCJpZDpiNWVkMjNjYS04OGQ5LTQzNzctOThlYy05MmYzNWMxMzI1ZjFcIixcclxuICAgKiBcImNpdHlNRE1zXCIsXHJcbiAgICogXCJpZDozNzM3MDZhZi02MjJmLTRhZWEtYTAwNi1kZGRiZmZkN2JkYTNcIixcclxuICAgKiBcInpvbmVNRE1zXCJcclxuICAgKiBdXHJcbiAgICogYGBgXHJcbiAgICogQHBhcmFtIGVudGl0aWVzIOWunuS9k+aVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldEVudGl0aWVzKHBhdGhzOiBzdHJpbmdbXSwgZW50aXRpZXM6IGFueVtdKSB7XHJcbiAgICBpZiAocGF0aHNbMF0uaW5kZXhPZignOicpID09PSAtMSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOagvOW8j+mUmeivrycpO1xyXG4gICAgfVxyXG4gICAgLy8g6I635Y+W5Li75a6e5L2TXHJcbiAgICBjb25zdCBpZCA9IHBhdGhzWzBdLnNwbGl0KCc6JylbMV07XHJcbiAgICBsZXQgZW50aXR5OiBhbnkgPSB0aGlzLmlubmVyRW50aXR5TWFwLmdldChpZCk7XHJcbiAgICBsZXQgZW50aXR5TGlzdCA9IGVudGl0eVtwYXRoc1sxXV0gYXMgRW50aXR5TGlzdDxhbnk+O1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGDmib7kuI3liLDkuLvplK7kuLoke2lkfeeahOWunuS9k2ApO1xyXG4gICAgfVxyXG4gICAgZm9yIChsZXQgaW5kZXggPSAyOyBpbmRleCA8IHBhdGhzLmxlbmd0aDsgaW5kZXggKz0gMikge1xyXG4gICAgICBjb25zdCBwYXRoSW5mbyA9IHBhdGhzW2luZGV4XS5zcGxpdCgnOicpO1xyXG4gICAgICBjb25zdCBlbnRpdHlJZCA9IHBhdGhJbmZvWzFdO1xyXG4gICAgICAvLyDojrflj5bliLDlvZPliY3lsYLnuqfnmoTlrp7kvZNcclxuICAgICAgZW50aXR5ID0gZW50aXR5TGlzdC5nZXQoZW50aXR5SWQpO1xyXG4gICAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihg5om+5LiN5Yiw5Li76ZSu5Li6JHtpZH3nmoTlrp7kvZNgKTtcclxuICAgICAgfVxyXG4gICAgICAvLyDojrflj5blvZPliY3lsYLnuqflrp7kvZPkuIvnmoTliJfooajlsZ7mgKdcclxuICAgICAgZW50aXR5TGlzdCA9IGVudGl0eVtwYXRoc1tpbmRleCArIDFdXTtcclxuICAgIH1cclxuICAgIGVudGl0eUxpc3QuY2xlYXIoKTtcclxuICAgIGVudGl0eUxpc3QubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmqjOivgeWunuS9k+aYr+WQpuiDveWkn+a3u+WKoFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5OiBhbnkpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLmhhcyhlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcmVwb3NpdG9yeSBhbHJlYWR5IGhhZCBhbiBpdGVtIHdpdGggdGhlIHNhdmUgaWRlbnRpdHkgb2YgJyR7ZW50aXR5W3RoaXMucHJpbWFyeUtleV19J2ApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpqozor4Hlrp7kvZPmmK/lkKbog73np7vpmaRcclxuICAgKi9cclxuICBwcml2YXRlIHZlcmlmeUVudGl0eVRvUmVtb3ZlKGlkZW50aXR5OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmICghdGhpcy5oYXMoaWRlbnRpdHkpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGVudGl0eSB3aXRoIGlkZW50aXR5IG9mICcke2lkZW50aXR5fSBkb3NlIG5vdCBleHNpdC4nYCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+mbhuWQiOWPmOabtOa1gVxyXG4gICAqL1xyXG4gIHByaXZhdGUgbm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobW9kaWZpY2F0aW9uOiBNb2RpZmljYXRpb24pIHtcclxuICAgIHRoaXMuY29sbGVjdGlvbkNoYW5nZWQubmV4dChtb2RpZmljYXRpb24pO1xyXG4gIH1cclxuICBwcml2YXRlIGxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eTogRW50aXR5KSB7XHJcbiAgICBpZiAoZW50aXR5KSB7XHJcbiAgICAgIGVudGl0eS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoKGNoYW5nZTogTW9kaWZpY2F0aW9uKSA9PiB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vI3JlZ2lvbiDliIbpobVcclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5YiG6aG15aSn5bCPXHJcbiAgICovXHJcbiAgc2V0IHBhZ2VTaXplKHBhZ2VTaXplOiBudW1iZXIpIHtcclxuICAgIGlmICh0eXBlb2YgKHBhZ2VTaXplKSAhPT0gJ251bWJlcicgfHwgcGFnZVNpemUgPCAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXI6cGFnZVNpemUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICAvLyBjb25zdCBlbnRpdHlQYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsW3RoaXMuZW50aXR5VHlwZU5hbWVdLCB7IHBhZ2VTaXplIH0pO1xyXG4gICAgLy8gdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IFt0aGlzLmVudGl0eVR5cGVOYW1lXTogZW50aXR5UGFnaW5hdGlvbkluZm8gfSk7XHJcbiAgICAvLyB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mb1t0aGlzLmVudGl0eVR5cGVOYW1lXSwgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHBhZ2VTaXplIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15aSn5bCPXHJcbiAgICogQGRlc2NyaXB0aW9uIOWmguaenOeUqOaIt+acquaMh+WumuWIhumhteWkp+Wwj+WImem7mOiupOS4ujDvvIzljbPojrflj5bmiYDmnInmlbDmja5cclxuICAgKi9cclxuICBnZXQgcGFnZVNpemUoKTogbnVtYmVyIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZVNpemUgfHwgMDtcclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7mlbDmja7mgLvmnaHmlbBcclxuICAgKi9cclxuICBzZXQgdG90YWxDb3VudCh0b3RhbDogbnVtYmVyKSB7XHJcbiAgICBpZiAodHlwZW9mICh0b3RhbCkgIT09ICdudW1iZXInIHx8IHRvdGFsIDwgMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW1ldGVyOnRvdGFsJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbFt0aGlzLmVudGl0eVR5cGVOYW1lXSwgeyB0b3RhbCB9KTtcclxuICAgIC8vIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBbdGhpcy5lbnRpdHlUeXBlTmFtZV06IGVudGl0eVBhZ2luYXRpb25JbmZvIH0pO1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHRvdGFsIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5pWw5o2u5oC75p2h5pWwXHJcbiAgICovXHJcbiAgZ2V0IHRvdGFsQ291bnQoKTogbnVtYmVyIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8udG90YWwgfHwgMDtcclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7lvZPliY3pobXnoIFcclxuICAgKi9cclxuICBzZXQgcGFnZUluZGV4KHBhZ2VJbmRleDogbnVtYmVyKSB7XHJcbiAgICBpZiAodHlwZW9mIChwYWdlSW5kZXgpICE9PSAnbnVtYmVyJyB8fCBwYWdlSW5kZXggPCAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXI6cGFnZUluZGV4Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbFt0aGlzLmVudGl0eVR5cGVOYW1lXSwgeyBwYWdlSW5kZXggfSk7XHJcbiAgICAvLyB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgW3RoaXMuZW50aXR5VHlwZU5hbWVdOiBlbnRpdHlQYWdpbmF0aW9uSW5mbyB9KTtcclxuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBwYWdlSW5kZXggfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blvZPliY3pobXnoIFcclxuICAgKi9cclxuICBnZXQgcGFnZUluZGV4KCk6IG51bWJlciB7XHJcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VJbmRleCB8fCAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDE7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXRoIOe7keWumui3r+W+hFxyXG4gICAqIEBwYXJhbSBwYWdlSW5mbyDliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlUGFnaW5hdGlvbkluZm9CeVBhdGgocGF0aDogc3RyaW5nLCBwYWdlSW5mbzogeyBwYWdlSW5kZXg6IGFueSwgcGFnZVNpemU6IGFueSwgdG90YWxDb3VudDogYW55LCBbcHJvcDogc3RyaW5nXTogYW55IH0pIHtcclxuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gcGFnZUluZm87XHJcbiAgICBjb25zdCB0b3RhbCA9IHBhZ2VJbmZvICYmIChwYWdlSW5mby50b3RhbENvdW50IHx8IHBhZ2VJbmZvLnRvdGFsKSB8fCAwO1xyXG4gICAgY29uc3QgcGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbCB9KTtcclxuICAgIHRoaXMuc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChwYXRoLCBwYWdpbmF0aW9uSW5mbyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrui3r+W+hOiOt+WPluWIhumhteWkp+Wwj1xyXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogYW55KSB7XHJcbiAgICBpZiAoIXBhdGggfHwgcGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBwYXRoICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOW/hemhu+S4uuWtl+espuS4su+8gScpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGF0aHMgPSBwYXRoLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0udHJpbSgpLmxlbmd0aCA+IDApLm1hcChpdGVtID0+IGl0ZW0udHJpbSgpKTtcclxuICAgIGxldCBjb25maWcgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgcGF0aHMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgaWYgKGNvbmZpZyAmJiBjb25maWcuaGFzT3duUHJvcGVydHkoaXRlbSkpIHtcclxuICAgICAgICBjb25maWcgPSBjb25maWdbaXRlbV07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uZmlnID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gISFjb25maWcgPyBjb25maWcgOiB0eXBlb2YgZGVmYXVsdFZhbHVlICE9PSAndW5kZWZpbmVkJyA/IGRlZmF1bHRWYWx1ZSA6IHVuZGVmaW5lZDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICogQHBhcmFtIHZhbHVlIOWAvO+8jOWFtuS4reaAu+adoeaVsGtleeS4unRvdGFsXHJcbiAgICovXHJcbiAgcHVibGljIHNldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aDogc3RyaW5nIHwgQXJyYXk8YW55PiwgdmFsdWU6IGFueSkge1xyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSBKU09OLnN0cmluZ2lmeSh0aGlzLnBhZ2luYXRpb25JbmZvKTtcclxuICAgIGlmICghcGF0aCB8fCBwYXRoID09PSAnLycpIHtcclxuICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IHZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpKSB7XHJcbiAgICAgICAgcGF0aCA9IHBhdGgudG9TdHJpbmcoKS5tYXRjaCgvW14vW1xcXV0rL2cpIHx8IFtdO1xyXG4gICAgICB9XHJcbiAgICAgIHBhdGguc2xpY2UoMCwgLTEpLnJlZHVjZSgocHJldiwgY3VycmVudCwgaW5kZXgpID0+XHJcbiAgICAgICAgT2JqZWN0KHByZXZbY3VycmVudF0pID09PSBwcmV2W2N1cnJlbnRdXHJcbiAgICAgICAgICA/IHByZXZbY3VycmVudF1cclxuICAgICAgICAgIDogcHJldltjdXJyZW50XSA9IE1hdGguYWJzKHBhdGhbaW5kZXggKyAxXSkgPj4gMCA9PT0gK3BhdGhbaW5kZXggKyAxXVxyXG4gICAgICAgICAgICA/IFtdXHJcbiAgICAgICAgICAgIDoge30sXHJcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbylbcGF0aFtwYXRoLmxlbmd0aCAtIDFdXSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLnBhZ2luYXRpb25JbmZvKSAhPT0gb3JpZ2luYWwpIHtcclxuICAgICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKHRoaXMucGFnaW5hdGlvbkluZm8sIE1vZGlmeVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxufVxyXG5cclxuZXhwb3J0IHsgRW50aXR5Q29sbGVjdGlvbiB9O1xyXG4iXX0=