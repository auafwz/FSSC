/*
 * @Author: Witt
 * @Date: 2018-12-30 17:11:37
 * @Last Modified by: Witt
 * @Last Modified time: 2018-12-30 17:19:01
 */
// tslint:disable: max-line-length
import { Injectable } from '@angular/core';
import { AppContext } from './app_context';
/**
 * FrameContext管理类
 */
class FrameContextManager {
    /**
     * 构造函数
     */
    constructor(appContext) {
        this.frameContextMap = new Map();
        this.frameContextSet = new Set();
        this.appContext = appContext;
    }
    /**
     * 注册FrameContext
     */
    regFrameContext(frameContext) {
        const frameId = frameContext.frameId;
        // 如果存在，先删除
        if (this.frameContextMap.has(frameId) === true) {
            const existedFrameContext = this.frameContextMap.get(frameId);
            this.frameContextMap.delete(frameId);
            this.frameContextSet.delete(existedFrameContext);
        }
        frameContext.index = this.frameContextSet.size;
        this.frameContextMap.set(frameId, frameContext);
        this.frameContextSet.add(frameContext);
    }
    /**
     * 注销组件注册
     */
    unregFrameContext(frameContext) {
        const frameId = frameContext.frameId;
        this.frameContextMap.delete(frameId);
        this.frameContextSet.delete(frameContext);
    }
    /**
     * 获取FrameContextMap
     */
    getFrameContextMap() {
        return this.frameContextMap;
    }
    /**
     * 获取全部FrameContext
     */
    getFrameContexts() {
        return Array.from(this.frameContextSet);
    }
    /**
     * 获取组合表单某个表单的所有frameContext
     * @param namespace 命名空间
     */
    getFrameContextsByNamespace(namespace) {
        return Array.from(this.frameContextSet).filter((frameContext) => frameContext && frameContext.namespace === namespace);
    }
    /**
     * 根据id获取FrameContext
     */
    getFrameContextById(frameId) {
        const targetFrameContext = this.frameContextMap.get(frameId);
        if (targetFrameContext) {
            return targetFrameContext;
        }
        return this.getFrameContextFromAllAppContexts(frameId);
    }
    /**
     * Get the root FrameContext instance
     * @return Return the FrameContext instance whose parent is null, and undefined otherwise.
     */
    getRootFrameContext() {
        const frameContexts = this.getFrameContexts();
        const rootFrameContext = frameContexts.find((frameContext) => {
            return frameContext.parent === null;
        });
        return rootFrameContext;
    }
    /**
     * 遍历所有的AppContext查找指定的
     * @summary
     * 1、老表单中所有的frameId均不重复；
     * 2、现在隔离了AppContxt，在当前AppContext找不到的时候，查找所有AppContext；
     * 3、隔离后，标准的访问方式是通过事件通信，此处仅仅是临时兼容。
     */
    getFrameContextFromAllAppContexts(frameId) {
        if (!this.appContext.appContextManager) {
            return;
        }
        let targetFrameContext;
        const appContexts = this.appContext.appContextManager.getAppContexts();
        appContexts.some((appContext) => {
            const frameContextMap = appContext.frameContextManager.getFrameContextMap();
            if (frameContextMap.has(frameId) === true) {
                targetFrameContext = frameContextMap.get(frameId);
                return true;
            }
            else {
                return false;
            }
        });
        return targetFrameContext;
    }
}
FrameContextManager.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FrameContextManager.ctorParameters = () => [
    { type: AppContext }
];
export { FrameContextManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJhbWVfY29udGV4X21hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9hcHAvZnJhbWVfY29udGV4X21hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFDSCxrQ0FBa0M7QUFDbEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDOztHQUVHO0FBQ0gsTUFDTSxtQkFBbUI7SUFpQnZCOztPQUVHO0lBQ0gsWUFBWSxVQUFzQjtRQUNoQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksR0FBRyxFQUF3QixDQUFDO1FBQ3ZELElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxHQUFHLEVBQWdCLENBQUM7UUFDL0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZUFBZSxDQUFDLFlBQTBCO1FBQy9DLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUM7UUFFckMsV0FBVztRQUNYLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssSUFBSSxFQUFFO1lBQzlDLE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDOUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDckMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQztTQUNsRDtRQUNELFlBQVksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7UUFDL0MsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRztJQUNJLGlCQUFpQixDQUFDLFlBQTBCO1FBQ2pELE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUM7UUFDckMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVEOztPQUVHO0lBQ0ksa0JBQWtCO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUM5QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxnQkFBZ0I7UUFDckIsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksMkJBQTJCLENBQUMsU0FBaUI7UUFDbEQsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUEwQixFQUFFLEVBQUUsQ0FBQyxZQUFZLElBQUksWUFBWSxDQUFDLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQztJQUN2SSxDQUFDO0lBQ0Q7O09BRUc7SUFDSSxtQkFBbUIsQ0FBQyxPQUFlO1FBQ3hDLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0QsSUFBSSxrQkFBa0IsRUFBRTtZQUN0QixPQUFPLGtCQUFrQixDQUFDO1NBQzNCO1FBQ0QsT0FBTyxJQUFJLENBQUMsaUNBQWlDLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUVEOzs7T0FHRztJQUNJLG1CQUFtQjtRQUN4QixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUM5QyxNQUFNLGdCQUFnQixHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUEwQixFQUFFLEVBQUU7WUFDekUsT0FBTyxZQUFZLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sZ0JBQWdCLENBQUM7SUFDMUIsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNLLGlDQUFpQyxDQUFDLE9BQWU7UUFDdkQsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLEVBQUU7WUFDdEMsT0FBTztTQUNSO1FBQ0QsSUFBSSxrQkFBZ0MsQ0FBQztRQUNyQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3ZFLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFzQixFQUFFLEVBQUU7WUFDMUMsTUFBTSxlQUFlLEdBQUcsVUFBVSxDQUFDLG1CQUFtQixDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDNUUsSUFBSSxlQUFlLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksRUFBRTtnQkFDekMsa0JBQWtCLEdBQUcsZUFBZSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDbEQsT0FBTyxJQUFJLENBQUM7YUFDYjtpQkFBTTtnQkFDTCxPQUFPLEtBQUssQ0FBQzthQUNkO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLGtCQUFrQixDQUFDO0lBQzVCLENBQUM7OztZQXZIRixVQUFVOzs7O1lBTEYsVUFBVTs7QUErSG5CLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjogV2l0dFxyXG4gKiBARGF0ZTogMjAxOC0xMi0zMCAxNzoxMTozN1xyXG4gKiBATGFzdCBNb2RpZmllZCBieTogV2l0dFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE4LTEyLTMwIDE3OjE5OjAxXHJcbiAqL1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbWF4LWxpbmUtbGVuZ3RoXHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnLi4vZnJhbWUvaW5kZXgnO1xyXG5pbXBvcnQgeyBBcHBDb250ZXh0IH0gZnJvbSAnLi9hcHBfY29udGV4dCc7XHJcblxyXG4vKipcclxuICogRnJhbWVDb250ZXh0566h55CG57G7XHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIEZyYW1lQ29udGV4dE1hbmFnZXIge1xyXG5cclxuICAvKipcclxuICAgKiBGcmFtZUNvbnRleHTlrZflhbgo5YW85a656ICB6KGo5Y2VKVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZnJhbWVDb250ZXh0TWFwOiBNYXA8c3RyaW5nLCBGcmFtZUNvbnRleHQ+O1xyXG5cclxuICAvKipcclxuICAgKiBGcmFtZUNvbnRleHTpm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIGZyYW1lQ29udGV4dFNldDogU2V0PEZyYW1lQ29udGV4dD47XHJcblxyXG4gIC8qKlxyXG4gICAqIEFwcENvbnRleHRcclxuICAgKi9cclxuICBwcml2YXRlIGFwcENvbnRleHQ6IEFwcENvbnRleHQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKGFwcENvbnRleHQ6IEFwcENvbnRleHQpIHtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0TWFwID0gbmV3IE1hcDxzdHJpbmcsIEZyYW1lQ29udGV4dD4oKTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0U2V0ID0gbmV3IFNldDxGcmFtZUNvbnRleHQ+KCk7XHJcbiAgICB0aGlzLmFwcENvbnRleHQgPSBhcHBDb250ZXh0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5rOo5YaMRnJhbWVDb250ZXh0XHJcbiAgICovXHJcbiAgcHVibGljIHJlZ0ZyYW1lQ29udGV4dChmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCk6IHZvaWQge1xyXG4gICAgY29uc3QgZnJhbWVJZCA9IGZyYW1lQ29udGV4dC5mcmFtZUlkO1xyXG5cclxuICAgIC8vIOWmguaenOWtmOWcqO+8jOWFiOWIoOmZpFxyXG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0TWFwLmhhcyhmcmFtZUlkKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBjb25zdCBleGlzdGVkRnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHRNYXAuZ2V0KGZyYW1lSWQpO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dE1hcC5kZWxldGUoZnJhbWVJZCk7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0U2V0LmRlbGV0ZShleGlzdGVkRnJhbWVDb250ZXh0KTtcclxuICAgIH1cclxuICAgIGZyYW1lQ29udGV4dC5pbmRleCA9IHRoaXMuZnJhbWVDb250ZXh0U2V0LnNpemU7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dE1hcC5zZXQoZnJhbWVJZCwgZnJhbWVDb250ZXh0KTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0U2V0LmFkZChmcmFtZUNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5rOo6ZSA57uE5Lu25rOo5YaMXHJcbiAgICovXHJcbiAgcHVibGljIHVucmVnRnJhbWVDb250ZXh0KGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0KTogdm9pZCB7XHJcbiAgICBjb25zdCBmcmFtZUlkID0gZnJhbWVDb250ZXh0LmZyYW1lSWQ7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dE1hcC5kZWxldGUoZnJhbWVJZCk7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dFNldC5kZWxldGUoZnJhbWVDb250ZXh0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlkZyYW1lQ29udGV4dE1hcFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGcmFtZUNvbnRleHRNYXAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHRNYXA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blhajpg6hGcmFtZUNvbnRleHRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RnJhbWVDb250ZXh0cygpOiBGcmFtZUNvbnRleHRbXSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmZyYW1lQ29udGV4dFNldCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlue7hOWQiOihqOWNleafkOS4quihqOWNleeahOaJgOaciWZyYW1lQ29udGV4dFxyXG4gICAqIEBwYXJhbSBuYW1lc3BhY2Ug5ZG95ZCN56m66Ze0XHJcbiAgICovXHJcbiAgcHVibGljIGdldEZyYW1lQ29udGV4dHNCeU5hbWVzcGFjZShuYW1lc3BhY2U6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5mcmFtZUNvbnRleHRTZXQpLmZpbHRlcigoZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpID0+IGZyYW1lQ29udGV4dCAmJiBmcmFtZUNvbnRleHQubmFtZXNwYWNlID09PSBuYW1lc3BhY2UpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja5pZOiOt+WPlkZyYW1lQ29udGV4dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQ6IHN0cmluZyk6IEZyYW1lQ29udGV4dCB7XHJcbiAgICBjb25zdCB0YXJnZXRGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dE1hcC5nZXQoZnJhbWVJZCk7XHJcbiAgICBpZiAodGFyZ2V0RnJhbWVDb250ZXh0KSB7XHJcbiAgICAgIHJldHVybiB0YXJnZXRGcmFtZUNvbnRleHQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5nZXRGcmFtZUNvbnRleHRGcm9tQWxsQXBwQ29udGV4dHMoZnJhbWVJZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIHJvb3QgRnJhbWVDb250ZXh0IGluc3RhbmNlXHJcbiAgICogQHJldHVybiBSZXR1cm4gdGhlIEZyYW1lQ29udGV4dCBpbnN0YW5jZSB3aG9zZSBwYXJlbnQgaXMgbnVsbCwgYW5kIHVuZGVmaW5lZCBvdGhlcndpc2UuXHJcbiAgICovXHJcbiAgcHVibGljIGdldFJvb3RGcmFtZUNvbnRleHQoKTogRnJhbWVDb250ZXh0IHtcclxuICAgIGNvbnN0IGZyYW1lQ29udGV4dHMgPSB0aGlzLmdldEZyYW1lQ29udGV4dHMoKTtcclxuICAgIGNvbnN0IHJvb3RGcmFtZUNvbnRleHQgPSBmcmFtZUNvbnRleHRzLmZpbmQoKGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0KSA9PiB7XHJcbiAgICAgIHJldHVybiBmcmFtZUNvbnRleHQucGFyZW50ID09PSBudWxsO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcm9vdEZyYW1lQ29udGV4dDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmBjeWOhuaJgOacieeahEFwcENvbnRleHTmn6Xmib7mjIflrprnmoRcclxuICAgKiBAc3VtbWFyeVxyXG4gICAqIDHjgIHogIHooajljZXkuK3miYDmnInnmoRmcmFtZUlk5Z2H5LiN6YeN5aSN77ybXHJcbiAgICogMuOAgeeOsOWcqOmalOemu+S6hkFwcENvbnR4dO+8jOWcqOW9k+WJjUFwcENvbnRleHTmib7kuI3liLDnmoTml7blgJnvvIzmn6Xmib7miYDmnIlBcHBDb250ZXh077ybXHJcbiAgICogM+OAgemalOemu+WQju+8jOagh+WHhueahOiuv+mXruaWueW8j+aYr+mAmui/h+S6i+S7tumAmuS/oe+8jOatpOWkhOS7heS7heaYr+S4tOaXtuWFvOWuueOAglxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RnJhbWVDb250ZXh0RnJvbUFsbEFwcENvbnRleHRzKGZyYW1lSWQ6IHN0cmluZyk6IEZyYW1lQ29udGV4dCB7XHJcbiAgICBpZiAoIXRoaXMuYXBwQ29udGV4dC5hcHBDb250ZXh0TWFuYWdlcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgdGFyZ2V0RnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQ7XHJcbiAgICBjb25zdCBhcHBDb250ZXh0cyA9IHRoaXMuYXBwQ29udGV4dC5hcHBDb250ZXh0TWFuYWdlci5nZXRBcHBDb250ZXh0cygpO1xyXG4gICAgYXBwQ29udGV4dHMuc29tZSgoYXBwQ29udGV4dDogQXBwQ29udGV4dCkgPT4ge1xyXG4gICAgICBjb25zdCBmcmFtZUNvbnRleHRNYXAgPSBhcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0TWFwKCk7XHJcbiAgICAgIGlmIChmcmFtZUNvbnRleHRNYXAuaGFzKGZyYW1lSWQpID09PSB0cnVlKSB7XHJcbiAgICAgICAgdGFyZ2V0RnJhbWVDb250ZXh0ID0gZnJhbWVDb250ZXh0TWFwLmdldChmcmFtZUlkKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRhcmdldEZyYW1lQ29udGV4dDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEZyYW1lQ29udGV4dE1hbmFnZXIgfTtcclxuIl19