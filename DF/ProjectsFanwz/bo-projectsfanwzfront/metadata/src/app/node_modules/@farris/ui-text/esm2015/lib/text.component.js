/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, forwardRef, Input, HostBinding, Output, EventEmitter, Injector, ElementRef, ViewChild, NgZone, HostListener } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { NumberHelperService } from '@farris/ui-common/number';
import { LocaleService } from '@farris/ui-locale';
export class TextComponent {
    /**
     * @param {?} dtHelper
     * @param {?} numberHelper
     * @param {?} injector
     * @param {?} ngzone
     */
    constructor(dtHelper, numberHelper, injector, ngzone) {
        this.dtHelper = dtHelper;
        this.numberHelper = numberHelper;
        this.injector = injector;
        this.ngzone = ngzone;
        this.cls = true;
        this.textChange = new EventEmitter();
        /**
         * 是否为密码输入
         */
        this.isPassword = false;
        // 是否多行文本
        this.isTextArea = false;
        // 是否启用自动尺寸
        this.autoSize = false;
        // 设置高度
        this.height = 0;
        // 是否是日期范围
        this.dateRange = false;
        // 千分位符号
        this.thousand = ',';
        // 小数点处符号
        this.decimal = '.';
        // 货币符号及值展现形式
        this.expression = '%s%v';
        this.textField = 'name';
        this.valueField = 'value';
        this.returnFormat = ''; // 从服务器端取值是格式化后的
        // 日期范围模式下input的显示分割符合
        this.dateRangeDelimiter = '~';
        this.enumDelimiter = ',';
        this._tshowType = 0;
        // 货币符号，默认是RMB
        this.currencySymbol = '￥';
        // 十进制前面填充的符号
        this.filledSymbol = '0';
        // 标签
        this.staticTitle = "";
        // 处理中英文情况， 因为多语言暂时不通过这个属性控制
        this.showTitle = false;
        this.beforeWriteValue = null;
        this.controlChange = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => { });
        this.controlTouch = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => { });
        this.localeService = this.injector.get(LocaleService);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set showType(value) {
        this._tshowType = value;
        // 如果是周
        if (value == 4) {
            this.dateRange = true;
        }
    }
    /**
     * @return {?}
     */
    get showType() {
        return this._tshowType;
    }
    // 普通文本输入值
    /**
     * @param {?} value
     * @return {?}
     */
    set value(value) {
        this.text = this.formatValue(value);
        this.textChange.emit(this.text);
    }
    /**
     * @return {?}
     */
    get value() {
        return this.text;
    }
    /**
     * @param {?} ev
     * @return {?}
     */
    changeTitle(ev) {
        if (!this.isTextArea && !this.isPassword) {
            this.mouseEnterChangeTitle();
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set option(value) {
        this._option = value;
    }
    /**
     * @return {?}
     */
    get option() {
        return this._option;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @private
     * @return {?}
     */
    mouseEnterChangeTitle() {
        if (this.textInnerEl.nativeElement.scrollHeight > this.textInnerEl.nativeElement.clientHeight) {
            this.staticTitle = this.text && this.text.length > 0 ? this.text : this.control;
        }
        else {
            this.staticTitle = '';
        }
    }
    /**
     * 处理多语言，待定
     * @param {?} value
     * @return {?}
     */
    formatLang(value) {
        return value && value[this.currentLanguage] ? value[this.currentLanguage] : '';
    }
    /**
     * C货币
     * D十进制
     * F浮点数
     * N数字，带千分位
     * P百分比
     * @param {?} value
     * @return {?}
     */
    getFormatNumberValue(value) {
        if (!this.format && !this._option) {
            return value.toString();
        }
        if (this._option && this._option.type && this._option.type == 'number') {
            if (this._option.formatter) {
                return this._option.formatter(value);
            }
            else {
                if (this._option.useThousands) {
                    if (this._option.precision != undefined) {
                        this.format = 'n' + this._option.precision;
                    }
                    else {
                        this.format = 'n2';
                    }
                }
                else {
                    if (this._option.precision != undefined) {
                        this.format = 'f' + this._option.precision;
                    }
                    else {
                        this.format = 'f2';
                    }
                }
            }
        }
        /** @type {?} */
        const firstLetter = this.currencyToUpperCase(this.format.substring(0, 1));
        /** @type {?} */
        const precision = Number(this.format.substring(1));
        /** @type {?} */
        let config = {};
        /** @type {?} */
        let result;
        if (!/C|D|F|N|P/g.test(firstLetter)) {
            console.warn(`不支持format为 ${this.format} 类型的数字格式化`);
            return;
        }
        if (this.thousand) {
            Object.assign(config, { thousand: this.thousand });
        }
        if (this.decimal) {
            Object.assign(config, { decimal: this.decimal });
        }
        if (this.expression) {
            Object.assign(config, { format: this.expression });
        }
        switch (firstLetter) {
            case 'C':
                Object.assign(config, { prefix: this.currencySymbol, precision });
                result = this.numberHelper.formatMoney(value, config);
                break;
            case 'D':
                result = this.toDecimal(value, precision);
                break;
            case 'F':
                Object.assign(config, { prefix: '', thousand: '', precision });
                result = this.numberHelper.formatMoney(value, config);
                break;
            case 'N':
                Object.assign(config, { prefix: '', precision });
                result = this.numberHelper.formatMoney(value, config);
                break;
            case 'P':
                result = this.toPercent(value, precision);
                break;
        }
        return result;
    }
    /**
     * @param {?} value 转换成十进制的数字
     * @param {?} precision 十进制数字的长度
     * @return {?}
     */
    toDecimal(value, precision) {
        if (value.toString().indexOf('.') > -1) {
            console.warn('十进制转换仅限整型类型');
            return;
        }
        return (Array(precision).join(this.filledSymbol) + value).slice(-precision);
    }
    /**
     * @param {?} value 转换成百分数的数字
     * @param {?} precision
     * @return {?}
     */
    toPercent(value, precision) {
        return Number(value * 100).toFixed(Number(precision)) + '%';
    }
    /**
     * 将货币符号首字母转换成大写
     * @param {?} value
     * @return {?}
     */
    currencyToUpperCase(value) {
        return value.replace(/[a-z]+/g, (/**
         * @param {?} word
         * @return {?}
         */
        (word) => {
            return word.toUpperCase();
        }));
    }
    /**
     * 处理年，Y=>y, D=>d
     * @param {?} value
     * @return {?}
     */
    dateToUpperCase(value) {
        /** @type {?} */
        let newFormat;
        if (/Y/g.test(value) === true) {
            newFormat = value.replace(/Y/g, 'y');
        }
        else {
            newFormat = value;
        }
        if (/D/g.test(newFormat) === true) {
            newFormat = newFormat.replace(/D/g, 'd');
        }
        return newFormat;
    }
    /**
     * 枚举类型处理
     * @param {?} value
     * @return {?}
     */
    getFormatEnumValue(value) {
        if (value == undefined || value === null || value === '') {
            return '';
        }
        if (this.data && this.data.length) {
            // 可能存在多选枚举，作为分隔符  
            // let curVals = ('' + value).split(',');
            /** @type {?} */
            let curVals = ('' + value).split(this.enumDelimiter);
            /** @type {?} */
            let nameResult = [];
            for (let k = 0; k < curVals.length; k++) {
                /** @type {?} */
                let findObj = this.data.find((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => {
                    return item[this.valueField] == curVals[k];
                }));
                if (findObj) {
                    nameResult.push(findObj[this.textField]);
                }
                else {
                    nameResult.push(curVals[k]);
                }
            }
            if (nameResult.length > 0) {
                // return nameResult.join(',');
                return nameResult.join(this.enumDelimiter);
            }
            return '';
        }
        else {
            return value;
        }
    }
    /**
     * boolean值处理
     * @param {?} value
     * @return {?}
     */
    getFormatCheckBoxValue(value) {
        if (value === true) {
            return this.localeService.getValue('text.yes');
        }
        else if (value === false || value == null || typeof value === 'undefined') {
            return this.localeService.getValue('text.no');
        }
        else {
            return value;
        }
    }
    /**
     * @private
     * @param {?} value
     * @param {?} fmt
     * @param {?=} hourSystem
     * @return {?}
     */
    timeFormatTo(value, fmt, hourSystem = 12) {
    }
    /**
     * @private
     * @param {?} fmt
     * @return {?}
     */
    makeFormater(fmt) {
        return fmt;
    }
    /*
        * 日期格式化
        */
    /**
     * @param {?} value
     * @return {?}
     */
    dateformat(value) {
        /** @type {?} */
        let str;
        if (!this.format) {
            this.format = 'YYYY-MM-DD';
        }
        // 当前值是已经格式化后的日期字符串
        if (this.returnFormat && this.returnFormat != 'yyyy-MM-dd' && typeof value == 'string') {
            value = this.getDateFromFormatedString(value, this.returnFormat);
        }
        //
        if (this.format === 'hh:mm:ss' || this.format === 'HH:mm:ss') {
            // 格式化时间  临时处理
            str = value;
        }
        else {
            // if (this.showTime && value instanceof String) {
            //     str = value;
            // } else {
            //     const formArr = this.format.split(' ');
            //     if (this.showTime && formArr.length < 2) {
            //         formArr.push('HH:mm:ss');
            //         this.format = formArr.join(' ');
            //     }
            //     // 格式化日期
            //     str = this.dtHelper.formatTo(value, this.dateToUpperCase(this.format));
            // }
            str = this.dtHelper.formatTo(value, this.dateToUpperCase(this.format));
        }
        return str;
    }
    /**
     * @private
     * @param {?} dateString
     * @param {?} format
     * @return {?}
     */
    getDateFromFormatedString(dateString, format) {
        /** @type {?} */
        var result = { year: 0, month: 0, day: 0, hour: 0, minite: 0, second: 0 };
        if (dateString) {
            format.replace(/y+|Y+|M+|d+|D+|h+|H+|m+|s+/g, (/**
             * @param {?} m
             * @param {?} a
             * @param {?} b
             * @param {?} c
             * @return {?}
             */
            function (m, a, b, c) {
                dateString.substring(a).replace(/\d+/, (/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) { c = parseInt(d, 10); }));
                if (/y+/i.test(m) && !result.year)
                    result.year = c;
                if (/M+/.test(m) && !result.month)
                    result.month = c;
                if (/d+/i.test(m) && !result.day)
                    result.day = c;
                if (/h+/i.test(m) && !result.hour)
                    result.hour = c;
                if (/m+/.test(m) && !result.minite)
                    result.minite = c;
                if (/s+/.test(m) && !result.second)
                    result.second = c;
            }));
        }
        /** @type {?} */
        var resultDate = new Date(result.year + '/' + result.month + '/' + result.day + ' ' + result.hour + ':' + result.minite + ':' + result.second);
        return resultDate;
    }
    /**
     * 格式化处理
     * @param {?} value
     * @return {?}
     */
    formatValue(value) {
        /** @type {?} */
        let str;
        if (this.currentLanguage) {
            return this.formatLang(value);
        }
        // if (!value) {
        //     return '';
        // }
        if (this.type !== 'boolean' && (value == null || typeof value === 'undefined')) {
            return '';
        }
        switch (this.type) {
            case 'string':
                str = value;
                break;
            case 'date':
            case 'datetime':
                // console.log(this.format);
                if (!this.dateRange) {
                    // if (!this.format) {
                    //     this.format = 'YYYY-MM-DD';
                    // }
                    // if (this.format === 'hh:mm:ss') {
                    //     // 格式化时间  临时处理
                    //     str = value;
                    // } else {
                    //     if (this.showTime) {
                    //         str = value;
                    //     } else {
                    //         // 格式化日期
                    //         str = this.dtHelper.formatTo(value, this.dateToUpperCase(this.format));
                    //     }
                    // }
                    str = this.dateformat(value);
                    // console.log(str);
                }
                else {
                    /** @type {?} */
                    const dateValues = value.split(this.dateRangeDelimiter);
                    /** @type {?} */
                    let dataStr = [];
                    if (dateValues && dateValues.length) {
                        dateValues.forEach((/**
                         * @param {?} date
                         * @return {?}
                         */
                        date => {
                            /** @type {?} */
                            let val = this.dateformat(date);
                            dataStr.push(val);
                        }));
                    }
                    str = dataStr.join(this.dateRangeDelimiter);
                }
                break;
            // case 'dateTime':
            //     str = this.timeFormatTo(value, this.makeFormater(this.format));
            //     break;
            case 'number':
                str = this.getFormatNumberValue(value);
                break;
            case 'enum':
                str = this.getFormatEnumValue(value);
                break;
            case 'boolean':
                str = this.getFormatCheckBoxValue(value);
                break;
            default:
                break; // throw new Error(`暂不支持 ${this.type} 类型`);
        }
        return str;
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    setText2Star(value) {
        if (this.isPassword) {
            /** @type {?} */
            const star = value ? '******' : '';
            this.text = star;
            this.control = star;
            return true;
        }
        return false;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        // lucas 2021-08-27
        if (this.setText2Star(value)) {
            return;
        }
        // xia 2021-03-13
        if (this.beforeWriteValue) {
            /** @type {?} */
            const options = {
                localizationType: this.localizationType,
                showTime: this.showTime,
                ref: this
            };
            /** @type {?} */
            const text = this.beforeWriteValue(value, options);
            if (text !== undefined) {
                this.text = text;
                return;
            }
        }
        this.control = this.formatValue(value);
        this.controlChange(value);
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.controlChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.controlTouch = fn;
    }
}
TextComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-text',
                template: `
        <span #textInner
            [ngClass]="{'f-form-control-text':!isTextArea,'f-form-control-textarea':isTextArea,'f-component-text-auto-size': this.autoSize}"
            [title]="staticTitle" [style.text-align]="textAlign"
            [style.height]="!autoSize&&height>0?height+'px':null" [style.minHeight]="autoSize&&height>0?height+'px':null"
            [style.maxHeight]="autoSize&&maxHeight>0?maxHeight+'px':null">{{text && text.length > 0 ?  text : control}}</span>
    `,
                providers: [{
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => TextComponent)),
                        multi: true,
                    }]
            }] }
];
/** @nocollapse */
TextComponent.ctorParameters = () => [
    { type: DateTimeHelperService },
    { type: NumberHelperService },
    { type: Injector },
    { type: NgZone }
];
TextComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class.f-component-text',] }],
    textInnerEl: [{ type: ViewChild, args: ['textInner', { read: ElementRef },] }],
    textChange: [{ type: Output }],
    isPassword: [{ type: Input }],
    isTextArea: [{ type: Input }],
    autoSize: [{ type: Input }],
    maxHeight: [{ type: Input }],
    height: [{ type: Input }],
    type: [{ type: Input }],
    dateRange: [{ type: Input }],
    format: [{ type: Input }],
    lang: [{ type: Input }],
    data: [{ type: Input }],
    thousand: [{ type: Input }],
    decimal: [{ type: Input }],
    expression: [{ type: Input }],
    currentLanguage: [{ type: Input }],
    showTime: [{ type: Input }],
    textField: [{ type: Input }],
    valueField: [{ type: Input }],
    returnFormat: [{ type: Input }],
    textAlign: [{ type: Input }],
    dateRangeDelimiter: [{ type: Input }],
    enumDelimiter: [{ type: Input }],
    showType: [{ type: Input }],
    localizationType: [{ type: Input }],
    filledSymbol: [{ type: Input }],
    value: [{ type: Input }],
    changeTitle: [{ type: HostListener, args: ['mouseenter', ['$event'],] }],
    showTitle: [{ type: Input }],
    option: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    TextComponent.prototype.cls;
    /** @type {?} */
    TextComponent.prototype.textInnerEl;
    /** @type {?} */
    TextComponent.prototype.textChange;
    /**
     * 是否为密码输入
     * @type {?}
     */
    TextComponent.prototype.isPassword;
    /** @type {?} */
    TextComponent.prototype.isTextArea;
    /** @type {?} */
    TextComponent.prototype.autoSize;
    /** @type {?} */
    TextComponent.prototype.maxHeight;
    /** @type {?} */
    TextComponent.prototype.height;
    /** @type {?} */
    TextComponent.prototype.type;
    /** @type {?} */
    TextComponent.prototype.dateRange;
    /** @type {?} */
    TextComponent.prototype.format;
    /** @type {?} */
    TextComponent.prototype.lang;
    /** @type {?} */
    TextComponent.prototype.data;
    /** @type {?} */
    TextComponent.prototype.thousand;
    /** @type {?} */
    TextComponent.prototype.decimal;
    /** @type {?} */
    TextComponent.prototype.expression;
    /** @type {?} */
    TextComponent.prototype.currentLanguage;
    /** @type {?} */
    TextComponent.prototype.showTime;
    /** @type {?} */
    TextComponent.prototype.textField;
    /** @type {?} */
    TextComponent.prototype.valueField;
    /** @type {?} */
    TextComponent.prototype.returnFormat;
    /** @type {?} */
    TextComponent.prototype.textAlign;
    /** @type {?} */
    TextComponent.prototype.dateRangeDelimiter;
    /** @type {?} */
    TextComponent.prototype.enumDelimiter;
    /**
     * @type {?}
     * @private
     */
    TextComponent.prototype._tshowType;
    /**
     * 国际化类型
     * @type {?}
     */
    TextComponent.prototype.localizationType;
    /** @type {?} */
    TextComponent.prototype.control;
    /** @type {?} */
    TextComponent.prototype.text;
    /** @type {?} */
    TextComponent.prototype.currencySymbol;
    /** @type {?} */
    TextComponent.prototype.filledSymbol;
    /** @type {?} */
    TextComponent.prototype.staticTitle;
    /** @type {?} */
    TextComponent.prototype.showTitle;
    /** @type {?} */
    TextComponent.prototype._option;
    /**
     * @type {?}
     * @private
     */
    TextComponent.prototype.localeService;
    /** @type {?} */
    TextComponent.prototype.beforeWriteValue;
    /**
     * @type {?}
     * @private
     */
    TextComponent.prototype.controlChange;
    /**
     * @type {?}
     * @private
     */
    TextComponent.prototype.controlTouch;
    /**
     * @type {?}
     * @private
     */
    TextComponent.prototype.dtHelper;
    /**
     * @type {?}
     * @private
     */
    TextComponent.prototype.numberHelper;
    /**
     * @type {?}
     * @private
     */
    TextComponent.prototype.injector;
    /** @type {?} */
    TextComponent.prototype.ngzone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXRleHQvIiwic291cmNlcyI6WyJsaWIvdGV4dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQVUsVUFBVSxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQ2xFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFDN0QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQWtCbEQsTUFBTSxPQUFPLGFBQWE7Ozs7Ozs7SUFxR3RCLFlBQ1ksUUFBK0IsRUFDL0IsWUFBaUMsRUFDakMsUUFBa0IsRUFDbkIsTUFBYztRQUhiLGFBQVEsR0FBUixRQUFRLENBQXVCO1FBQy9CLGlCQUFZLEdBQVosWUFBWSxDQUFxQjtRQUNqQyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ25CLFdBQU0sR0FBTixNQUFNLENBQVE7UUF2R2MsUUFBRyxHQUFHLElBQUksQ0FBQztRQUV4QyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7OztRQUV0QyxlQUFVLEdBQUcsS0FBSyxDQUFDOztRQUVuQixlQUFVLEdBQUcsS0FBSyxDQUFDOztRQUVuQixhQUFRLEdBQUcsS0FBSyxDQUFDOztRQUlqQixXQUFNLEdBQUcsQ0FBQyxDQUFDOztRQUlYLGNBQVMsR0FBRyxLQUFLLENBQUM7O1FBUWxCLGFBQVEsR0FBRyxHQUFHLENBQUM7O1FBRWYsWUFBTyxHQUFHLEdBQUcsQ0FBQzs7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b0NBQWlCOztJQUVqQixrQ0FBMkI7O0lBRTNCLGdDQUFROzs7OztJQVNSLHNDQUEyQjs7SUFFM0IseUNBQTREOzs7OztJQUU1RCxzQ0FBcUM7Ozs7O0lBQ3JDLHFDQUFvQzs7Ozs7SUFHaEMsaUNBQXVDOzs7OztJQUN2QyxxQ0FBeUM7Ozs7O0lBQ3pDLGlDQUEwQjs7SUFDMUIsK0JBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCwgT25Jbml0LCBmb3J3YXJkUmVmLCBJbnB1dCwgSG9zdEJpbmRpbmcsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbmplY3RvcixcclxuICAgIFNpbXBsZUNoYW5nZXMsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgTmdab25lLCBIb3N0TGlzdGVuZXJcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBEYXRlVGltZUhlbHBlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9kYXRlJztcclxuaW1wb3J0IHsgTnVtYmVySGVscGVyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL251bWJlcic7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLXRleHQnLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgICAgICA8c3BhbiAjdGV4dElubmVyXHJcbiAgICAgICAgICAgIFtuZ0NsYXNzXT1cInsnZi1mb3JtLWNvbnRyb2wtdGV4dCc6IWlzVGV4dEFyZWEsJ2YtZm9ybS1jb250cm9sLXRleHRhcmVhJzppc1RleHRBcmVhLCdmLWNvbXBvbmVudC10ZXh0LWF1dG8tc2l6ZSc6IHRoaXMuYXV0b1NpemV9XCJcclxuICAgICAgICAgICAgW3RpdGxlXT1cInN0YXRpY1RpdGxlXCIgW3N0eWxlLnRleHQtYWxpZ25dPVwidGV4dEFsaWduXCJcclxuICAgICAgICAgICAgW3N0eWxlLmhlaWdodF09XCIhYXV0b1NpemUmJmhlaWdodD4wP2hlaWdodCsncHgnOm51bGxcIiBbc3R5bGUubWluSGVpZ2h0XT1cImF1dG9TaXplJiZoZWlnaHQ+MD9oZWlnaHQrJ3B4JzpudWxsXCJcclxuICAgICAgICAgICAgW3N0eWxlLm1heEhlaWdodF09XCJhdXRvU2l6ZSYmbWF4SGVpZ2h0PjA/bWF4SGVpZ2h0KydweCc6bnVsbFwiPnt7dGV4dCAmJiB0ZXh0Lmxlbmd0aCA+IDAgPyAgdGV4dCA6IGNvbnRyb2x9fTwvc3Bhbj5cclxuICAgIGAsXHJcbiAgICBzdHlsZXM6IFtdLFxyXG4gICAgcHJvdmlkZXJzOiBbe1xyXG4gICAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFRleHRDb21wb25lbnQpLFxyXG4gICAgICAgIG11bHRpOiB0cnVlLFxyXG4gICAgfV1cclxufSlcclxuZXhwb3J0IGNsYXNzIFRleHRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmYtY29tcG9uZW50LXRleHQnKSBjbHMgPSB0cnVlO1xyXG4gICAgQFZpZXdDaGlsZCgndGV4dElubmVyJywgeyByZWFkOiBFbGVtZW50UmVmIH0pIHRleHRJbm5lckVsOiBFbGVtZW50UmVmO1xyXG4gICAgQE91dHB1dCgpIHRleHRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIC8qKiDmmK/lkKbkuLrlr4bnoIHovpPlhaUgKi9cclxuICAgIEBJbnB1dCgpIGlzUGFzc3dvcmQgPSBmYWxzZTtcclxuICAgIC8vIOaYr+WQpuWkmuihjOaWh+acrFxyXG4gICAgQElucHV0KCkgaXNUZXh0QXJlYSA9IGZhbHNlO1xyXG4gICAgLy8g5piv5ZCm5ZCv55So6Ieq5Yqo5bC65a+4XHJcbiAgICBASW5wdXQoKSBhdXRvU2l6ZSA9IGZhbHNlO1xyXG4gICAgLy8g6K6+572u5pyA5aSn6auY5bqmXHJcbiAgICBASW5wdXQoKSBtYXhIZWlnaHQ6IG51bWJlcjtcclxuICAgIC8vIOiuvue9rumrmOW6plxyXG4gICAgQElucHV0KCkgaGVpZ2h0ID0gMDtcclxuICAgIC8vIOaOp+S7tuexu+Wei1xyXG4gICAgQElucHV0KCkgdHlwZTogc3RyaW5nO1xyXG4gICAgLy8g5piv5ZCm5piv5pel5pyf6IyD5Zu0XHJcbiAgICBASW5wdXQoKSBkYXRlUmFuZ2UgPSBmYWxzZTtcclxuICAgIC8vIOmcgOimgei9rOWMluexu+Wei+agvOW8j+eahOihqOi+vuW8j1xyXG4gICAgQElucHV0KCkgZm9ybWF0OiBhbnk7XHJcbiAgICAvLyDlpJror63oqIBcclxuICAgIEBJbnB1dCgpIGxhbmc6IHN0cmluZztcclxuICAgIC8vIOi9rOaNouexu+Wei+eUqOWIsOeahOaVsOaNrlxyXG4gICAgQElucHV0KCkgZGF0YTogYW55O1xyXG4gICAgLy8g5Y2D5YiG5L2N56ym5Y+3XHJcbiAgICBASW5wdXQoKSB0aG91c2FuZCA9ICcsJztcclxuICAgIC8vIOWwj+aVsOeCueWkhOespuWPt1xyXG4gICAgQElucHV0KCkgZGVjaW1hbCA9ICcuJztcclxuICAgIC8vIOi0p+W4geespuWPt+WPiuWAvOWxleeOsOW9ouW8j1xyXG4gICAgQElucHV0KCkgZXhwcmVzc2lvbiA9ICclcyV2JztcclxuICAgIEBJbnB1dCgpIGN1cnJlbnRMYW5ndWFnZTogc3RyaW5nO1xyXG4gICAgLy8gZm9ybUNvbnRyb2zmmL7npLrnmoTmlofmnKxcclxuICAgIEBJbnB1dCgpIHNob3dUaW1lOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgdGV4dEZpZWxkID0gJ25hbWUnO1xyXG4gICAgQElucHV0KCkgdmFsdWVGaWVsZCA9ICd2YWx1ZSc7XHJcbiAgICBASW5wdXQoKSByZXR1cm5Gb3JtYXQgPSAnJzsgLy8g5LuO5pyN5Yqh5Zmo56uv5Y+W5YC85piv5qC85byP5YyW5ZCO55qEXHJcblxyXG4gICAgLy8g5paH5pys5pa55ZCRXHJcbiAgICBASW5wdXQoKSB0ZXh0QWxpZ247XHJcbiAgICAvLyDml6XmnJ/ojIPlm7TmqKHlvI/kuItpbnB1dOeahOaYvuekuuWIhuWJsuespuWQiFxyXG4gICAgQElucHV0KCkgZGF0ZVJhbmdlRGVsaW1pdGVyID0gJ34nO1xyXG4gICAgQElucHV0KCkgZW51bURlbGltaXRlciA9ICcsJztcclxuICAgIHByaXZhdGUgX3RzaG93VHlwZSA9IDA7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IHNob3dUeXBlKHZhbHVlOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl90c2hvd1R5cGUgPSB2YWx1ZTtcclxuICAgICAgICAvLyDlpoLmnpzmmK/lkahcclxuICAgICAgICBpZiAodmFsdWUgPT0gNCkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGVSYW5nZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHNob3dUeXBlKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RzaG93VHlwZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Zu96ZmF5YyW57G75Z6LXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGxvY2FsaXphdGlvblR5cGU6IHN0cmluZztcclxuICAgIGNvbnRyb2w6IGFueTtcclxuICAgIC8vIOaZrumAmuaWh+acrFxyXG4gICAgdGV4dDogYW55O1xyXG4gICAgLy8g6LSn5biB56ym5Y+377yM6buY6K6k5pivUk1CXHJcbiAgICBjdXJyZW5jeVN5bWJvbCA9ICfvv6UnO1xyXG4gICAgLy8g5Y2B6L+b5Yi25YmN6Z2i5aGr5YWF55qE56ym5Y+3XHJcbiAgICBASW5wdXQoKSBmaWxsZWRTeW1ib2wgPSAnMCc7XHJcbiAgICAvLyDmma7pgJrmlofmnKzovpPlhaXlgLxcclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgdmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMudGV4dCA9IHRoaXMuZm9ybWF0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgIHRoaXMudGV4dENoYW5nZS5lbWl0KHRoaXMudGV4dCk7XHJcbiAgICB9XHJcbiAgICBnZXQgdmFsdWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dDtcclxuICAgIH1cclxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBbJyRldmVudCddKSBjaGFuZ2VUaXRsZShldikge1xyXG4gICAgICAgIGlmICghdGhpcy5pc1RleHRBcmVhICYmICF0aGlzLmlzUGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZUVudGVyQ2hhbmdlVGl0bGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDmoIfnrb5cclxuICAgIHN0YXRpY1RpdGxlID0gXCJcIjtcclxuICAgIC8vIOWkhOeQhuS4reiLseaWh+aDheWGte+8jCDlm6DkuLrlpJror63oqIDmmoLml7bkuI3pgJrov4fov5nkuKrlsZ7mgKfmjqfliLZcclxuICAgIEBJbnB1dCgpIHNob3dUaXRsZSA9IGZhbHNlO1xyXG4gICAgLy/mlbDlgLzmoLzlvI/lj4LmlbBcclxuICAgIF9vcHRpb247XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IG9wdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuX29wdGlvbiA9IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgZ2V0IG9wdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9jYWxlU2VydmljZTogYW55O1xyXG5cclxuICAgIGJlZm9yZVdyaXRlVmFsdWU6ICh2YWw6IGFueSwgb3B0aW9uczogYW55KSA9PiBzdHJpbmcgPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgY29udHJvbENoYW5nZSA9ICh2YWwpID0+IHsgfTtcclxuICAgIHByaXZhdGUgY29udHJvbFRvdWNoID0gKHZhbCkgPT4geyB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgZHRIZWxwZXI6IERhdGVUaW1lSGVscGVyU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIG51bWJlckhlbHBlcjogTnVtYmVySGVscGVyU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwdWJsaWMgbmd6b25lOiBOZ1pvbmVcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG5cclxuICAgIH1cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG5cclxuICAgIH1cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuXHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG1vdXNlRW50ZXJDaGFuZ2VUaXRsZSgpIHtcclxuICAgICAgICBpZiAodGhpcy50ZXh0SW5uZXJFbC5uYXRpdmVFbGVtZW50LnNjcm9sbEhlaWdodCA+IHRoaXMudGV4dElubmVyRWwubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0aWNUaXRsZSA9IHRoaXMudGV4dCAmJiB0aGlzLnRleHQubGVuZ3RoID4gMCA/IHRoaXMudGV4dCA6IHRoaXMuY29udHJvbDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRpY1RpdGxlID0gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5aSE55CG5aSa6K+t6KiA77yM5b6F5a6aXHJcbiAgICAgKi9cclxuICAgIGZvcm1hdExhbmcodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAmJiB2YWx1ZVt0aGlzLmN1cnJlbnRMYW5ndWFnZV0gPyB2YWx1ZVt0aGlzLmN1cnJlbnRMYW5ndWFnZV0gOiAnJztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ+i0p+W4gVxyXG4gICAgICogROWNgei/m+WItlxyXG4gICAgICogRua1rueCueaVsFxyXG4gICAgICogTuaVsOWtl++8jOW4puWNg+WIhuS9jVxyXG4gICAgICogUOeZvuWIhuavlFxyXG4gICAgICovXHJcbiAgICBnZXRGb3JtYXROdW1iZXJWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmZvcm1hdCAmJiAhdGhpcy5fb3B0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5fb3B0aW9uICYmIHRoaXMuX29wdGlvbi50eXBlICYmIHRoaXMuX29wdGlvbi50eXBlID09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb24uZm9ybWF0dGVyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9uLmZvcm1hdHRlcih2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9uLnVzZVRob3VzYW5kcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb24ucHJlY2lzaW9uICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1hdCA9ICduJyArIHRoaXMuX29wdGlvbi5wcmVjaXNpb247XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtYXQgPSAnbjInO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbi5wcmVjaXNpb24gIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybWF0ID0gJ2YnICsgdGhpcy5fb3B0aW9uLnByZWNpc2lvbjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1hdCA9ICdmMic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGZpcnN0TGV0dGVyID0gdGhpcy5jdXJyZW5jeVRvVXBwZXJDYXNlKHRoaXMuZm9ybWF0LnN1YnN0cmluZygwLCAxKSk7XHJcbiAgICAgICAgY29uc3QgcHJlY2lzaW9uID0gTnVtYmVyKHRoaXMuZm9ybWF0LnN1YnN0cmluZygxKSk7XHJcbiAgICAgICAgbGV0IGNvbmZpZyA9IHt9O1xyXG4gICAgICAgIGxldCByZXN1bHQ6IGFueTtcclxuICAgICAgICBpZiAoIS9DfER8RnxOfFAvZy50ZXN0KGZpcnN0TGV0dGVyKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYOS4jeaUr+aMgWZvcm1hdOS4uiAke3RoaXMuZm9ybWF0fSDnsbvlnovnmoTmlbDlrZfmoLzlvI/ljJZgKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy50aG91c2FuZCkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgeyB0aG91c2FuZDogdGhpcy50aG91c2FuZCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGVjaW1hbCkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgeyBkZWNpbWFsOiB0aGlzLmRlY2ltYWwgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb25maWcsIHsgZm9ybWF0OiB0aGlzLmV4cHJlc3Npb24gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAoZmlyc3RMZXR0ZXIpIHtcclxuICAgICAgICAgICAgY2FzZSAnQyc6XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgeyBwcmVmaXg6IHRoaXMuY3VycmVuY3lTeW1ib2wsIHByZWNpc2lvbiB9KTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubnVtYmVySGVscGVyLmZvcm1hdE1vbmV5KHZhbHVlLCBjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ0QnOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy50b0RlY2ltYWwodmFsdWUsIHByZWNpc2lvbik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnRic6XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgeyBwcmVmaXg6ICcnLCB0aG91c2FuZDogJycsIHByZWNpc2lvbiB9KTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubnVtYmVySGVscGVyLmZvcm1hdE1vbmV5KHZhbHVlLCBjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ04nOlxyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihjb25maWcsIHsgcHJlZml4OiAnJywgcHJlY2lzaW9uIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5udW1iZXJIZWxwZXIuZm9ybWF0TW9uZXkodmFsdWUsIGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnUCc6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnRvUGVyY2VudCh2YWx1ZSwgcHJlY2lzaW9uKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHZhbHVlIOi9rOaNouaIkOWNgei/m+WItueahOaVsOWtl1xyXG4gICAgICogQHBhcmFtIHByZWNpc2lvbiDljYHov5vliLbmlbDlrZfnmoTplb/luqZcclxuICAgICAqL1xyXG4gICAgdG9EZWNpbWFsKHZhbHVlOiBhbnksIHByZWNpc2lvbjogYW55KSB7XHJcbiAgICAgICAgaWYgKHZhbHVlLnRvU3RyaW5nKCkuaW5kZXhPZignLicpID4gLTEpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCfljYHov5vliLbovazmjaLku4XpmZDmlbTlnovnsbvlnosnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gKEFycmF5KHByZWNpc2lvbikuam9pbih0aGlzLmZpbGxlZFN5bWJvbCkgKyB2YWx1ZSkuc2xpY2UoLXByZWNpc2lvbik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB2YWx1ZSDovazmjaLmiJDnmb7liIbmlbDnmoTmlbDlrZdcclxuICAgICAqIEBwYXJhbSBkZWNpbWFsIOWwj+aVsOeCueS/neeVmeWHoOS9jVxyXG4gICAgICovXHJcbiAgICB0b1BlcmNlbnQodmFsdWU6IGFueSwgcHJlY2lzaW9uOiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlICogMTAwKS50b0ZpeGVkKE51bWJlcihwcmVjaXNpb24pKSArICclJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhui0p+W4geespuWPt+mmluWtl+avjei9rOaNouaIkOWkp+WGmVxyXG4gICAgICovXHJcbiAgICBjdXJyZW5jeVRvVXBwZXJDYXNlKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvW2Etel0rL2csICh3b3JkOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHdvcmQudG9VcHBlckNhc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWkhOeQhuW5tO+8jFk9PnksIEQ9PmRcclxuICAgICAqL1xyXG4gICAgZGF0ZVRvVXBwZXJDYXNlKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBsZXQgbmV3Rm9ybWF0OiBhbnk7XHJcbiAgICAgICAgaWYgKC9ZL2cudGVzdCh2YWx1ZSkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgbmV3Rm9ybWF0ID0gdmFsdWUucmVwbGFjZSgvWS9nLCAneScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG5ld0Zvcm1hdCA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoL0QvZy50ZXN0KG5ld0Zvcm1hdCkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgbmV3Rm9ybWF0ID0gbmV3Rm9ybWF0LnJlcGxhY2UoL0QvZywgJ2QnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdGb3JtYXQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOaemuS4vuexu+Wei+WkhOeQhlxyXG4gICAgICovXHJcbiAgICBnZXRGb3JtYXRFbnVtVmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSA9PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vIOWPr+iDveWtmOWcqOWkmumAieaemuS4vu+8jOS9nOS4uuWIhumalOespiAgXHJcbiAgICAgICAgICAgIC8vIGxldCBjdXJWYWxzID0gKCcnICsgdmFsdWUpLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgICAgIGxldCBjdXJWYWxzID0gKCcnICsgdmFsdWUpLnNwbGl0KHRoaXMuZW51bURlbGltaXRlcik7XHJcbiAgICAgICAgICAgIGxldCBuYW1lUmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgY3VyVmFscy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpbmRPYmogPSB0aGlzLmRhdGEuZmluZChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVt0aGlzLnZhbHVlRmllbGRdID09IGN1clZhbHNba107XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGlmIChmaW5kT2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZVJlc3VsdC5wdXNoKGZpbmRPYmpbdGhpcy50ZXh0RmllbGRdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWVSZXN1bHQucHVzaChjdXJWYWxzW2tdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobmFtZVJlc3VsdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gbmFtZVJlc3VsdC5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZVJlc3VsdC5qb2luKHRoaXMuZW51bURlbGltaXRlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGJvb2xlYW7lgLzlpITnkIZcclxuICAgICAqL1xyXG4gICAgZ2V0Rm9ybWF0Q2hlY2tCb3hWYWx1ZSh2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCd0ZXh0LnllcycpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IGZhbHNlIHx8IHZhbHVlID09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCd0ZXh0Lm5vJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSB0aW1lRm9ybWF0VG8odmFsdWU6IGFueSwgZm10OiBzdHJpbmcsIGhvdXJTeXN0ZW0gPSAxMikge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1ha2VGb3JtYXRlcihmbXQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGZtdDtcclxuICAgIH1cclxuICAgIC8qXHJcbiAgICAqIOaXpeacn+agvOW8j+WMllxyXG4gICAgKi9cclxuICAgIGRhdGVmb3JtYXQodmFsdWUpIHtcclxuICAgICAgICBsZXQgc3RyO1xyXG4gICAgICAgIGlmICghdGhpcy5mb3JtYXQpIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtYXQgPSAnWVlZWS1NTS1ERCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOW9k+WJjeWAvOaYr+W3sue7j+agvOW8j+WMluWQjueahOaXpeacn+Wtl+espuS4slxyXG4gICAgICAgIGlmICh0aGlzLnJldHVybkZvcm1hdCAmJiB0aGlzLnJldHVybkZvcm1hdCAhPSAneXl5eS1NTS1kZCcgJiYgdHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5nZXREYXRlRnJvbUZvcm1hdGVkU3RyaW5nKHZhbHVlLCB0aGlzLnJldHVybkZvcm1hdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaWYgKHRoaXMuZm9ybWF0ID09PSAnaGg6bW06c3MnIHx8IHRoaXMuZm9ybWF0ID09PSAnSEg6bW06c3MnKSB7XHJcbiAgICAgICAgICAgIC8vIOagvOW8j+WMluaXtumXtCAg5Li05pe25aSE55CGXHJcbiAgICAgICAgICAgIHN0ciA9IHZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLnNob3dUaW1lICYmIHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBzdHIgPSB2YWx1ZTtcclxuICAgICAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IGZvcm1BcnIgPSB0aGlzLmZvcm1hdC5zcGxpdCgnICcpO1xyXG4gICAgICAgICAgICAvLyAgICAgaWYgKHRoaXMuc2hvd1RpbWUgJiYgZm9ybUFyci5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgZm9ybUFyci5wdXNoKCdISDptbTpzcycpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybUFyci5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vICAgICAvLyDmoLzlvI/ljJbml6XmnJ9cclxuICAgICAgICAgICAgLy8gICAgIHN0ciA9IHRoaXMuZHRIZWxwZXIuZm9ybWF0VG8odmFsdWUsIHRoaXMuZGF0ZVRvVXBwZXJDYXNlKHRoaXMuZm9ybWF0KSk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIHN0ciA9IHRoaXMuZHRIZWxwZXIuZm9ybWF0VG8odmFsdWUsIHRoaXMuZGF0ZVRvVXBwZXJDYXNlKHRoaXMuZm9ybWF0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHI7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGdldERhdGVGcm9tRm9ybWF0ZWRTdHJpbmcoZGF0ZVN0cmluZywgZm9ybWF0KSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHsgeWVhcjogMCwgbW9udGg6IDAsIGRheTogMCwgaG91cjogMCwgbWluaXRlOiAwLCBzZWNvbmQ6IDAgfTsgLy8g5b2T54S26L+Z6YeM5Y+v5Lul6buY6K6kMTk3MC0xLTHml6VcclxuICAgICAgICBpZiAoZGF0ZVN0cmluZykge1xyXG4gICAgICAgICAgICBmb3JtYXQucmVwbGFjZSgveSt8WSt8TSt8ZCt8RCt8aCt8SCt8bSt8cysvZywgZnVuY3Rpb24gKG0sIGEsIGIsIGMpIHsvLyDov5nph4zlj6rlgZrkuoblubTmnIjml6UgIOWKoOaXtuWIhuenkuS5n+aYr+WPr+S7peeahFxyXG4gICAgICAgICAgICAgICAgZGF0ZVN0cmluZy5zdWJzdHJpbmcoYSkucmVwbGFjZSgvXFxkKy8sIGZ1bmN0aW9uIChkKSB7IGMgPSBwYXJzZUludChkLCAxMCkgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoL3krL2kudGVzdChtKSAmJiAhcmVzdWx0LnllYXIpIHJlc3VsdC55ZWFyID0gYztcclxuICAgICAgICAgICAgICAgIGlmICgvTSsvLnRlc3QobSkgJiYgIXJlc3VsdC5tb250aCkgcmVzdWx0Lm1vbnRoID0gYztcclxuICAgICAgICAgICAgICAgIGlmICgvZCsvaS50ZXN0KG0pICYmICFyZXN1bHQuZGF5KSByZXN1bHQuZGF5ID0gYztcclxuICAgICAgICAgICAgICAgIGlmICgvaCsvaS50ZXN0KG0pICYmICFyZXN1bHQuaG91cikgcmVzdWx0LmhvdXIgPSBjO1xyXG4gICAgICAgICAgICAgICAgaWYgKC9tKy8udGVzdChtKSAmJiAhcmVzdWx0Lm1pbml0ZSkgcmVzdWx0Lm1pbml0ZSA9IGM7XHJcbiAgICAgICAgICAgICAgICBpZiAoL3MrLy50ZXN0KG0pICYmICFyZXN1bHQuc2Vjb25kKSByZXN1bHQuc2Vjb25kID0gYztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHREYXRlID0gbmV3IERhdGUocmVzdWx0LnllYXIgKyAnLycgKyByZXN1bHQubW9udGggKyAnLycgKyByZXN1bHQuZGF5ICsgJyAnICsgcmVzdWx0LmhvdXIgKyAnOicgKyByZXN1bHQubWluaXRlICsgJzonICsgcmVzdWx0LnNlY29uZCk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdERhdGU7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOagvOW8j+WMluWkhOeQhlxyXG4gICAgICovXHJcbiAgICBmb3JtYXRWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgbGV0IHN0cjogYW55O1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRMYW5ndWFnZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRMYW5nKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIGlmICh0aGlzLnR5cGUgIT09ICdib29sZWFuJyAmJiAodmFsdWUgPT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAodGhpcy50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgICAgICAgICBzdHIgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkYXRlJzpcclxuICAgICAgICAgICAgY2FzZSAnZGF0ZXRpbWUnOlxyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5mb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRhdGVSYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmICghdGhpcy5mb3JtYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5mb3JtYXQgPSAnWVlZWS1NTS1ERCc7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmICh0aGlzLmZvcm1hdCA9PT0gJ2hoOm1tOnNzJykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAvLyDmoLzlvI/ljJbml7bpl7QgIOS4tOaXtuWkhOeQhlxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBzdHIgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBpZiAodGhpcy5zaG93VGltZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgc3RyID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAvLyDmoLzlvI/ljJbml6XmnJ9cclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHN0ciA9IHRoaXMuZHRIZWxwZXIuZm9ybWF0VG8odmFsdWUsIHRoaXMuZGF0ZVRvVXBwZXJDYXNlKHRoaXMuZm9ybWF0KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0ciA9IHRoaXMuZGF0ZWZvcm1hdCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coc3RyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVWYWx1ZXMgPSB2YWx1ZS5zcGxpdCh0aGlzLmRhdGVSYW5nZURlbGltaXRlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkYXRhU3RyID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVWYWx1ZXMgJiYgZGF0ZVZhbHVlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZVZhbHVlcy5mb3JFYWNoKGRhdGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbCA9IHRoaXMuZGF0ZWZvcm1hdChkYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTdHIucHVzaCh2YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyID0gZGF0YVN0ci5qb2luKHRoaXMuZGF0ZVJhbmdlRGVsaW1pdGVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgLy8gY2FzZSAnZGF0ZVRpbWUnOlxyXG4gICAgICAgICAgICAvLyAgICAgc3RyID0gdGhpcy50aW1lRm9ybWF0VG8odmFsdWUsIHRoaXMubWFrZUZvcm1hdGVyKHRoaXMuZm9ybWF0KSk7XHJcbiAgICAgICAgICAgIC8vICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgICAgICAgIHN0ciA9IHRoaXMuZ2V0Rm9ybWF0TnVtYmVyVmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2VudW0nOlxyXG4gICAgICAgICAgICAgICAgc3RyID0gdGhpcy5nZXRGb3JtYXRFbnVtVmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxyXG4gICAgICAgICAgICAgICAgc3RyID0gdGhpcy5nZXRGb3JtYXRDaGVja0JveFZhbHVlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7IC8vIHRocm93IG5ldyBFcnJvcihg5pqC5LiN5pSv5oyBICR7dGhpcy50eXBlfSDnsbvlnotgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzdHI7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRUZXh0MlN0YXIodmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5pc1Bhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXIgPSB2YWx1ZSA/ICcqKioqKionIDogJyc7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IHN0YXI7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbCA9IHN0YXI7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIC8vIGx1Y2FzIDIwMjEtMDgtMjdcclxuICAgICAgICBpZiAodGhpcy5zZXRUZXh0MlN0YXIodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHhpYSAyMDIxLTAzLTEzXHJcbiAgICAgICAgaWYgKHRoaXMuYmVmb3JlV3JpdGVWYWx1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgbG9jYWxpemF0aW9uVHlwZTogdGhpcy5sb2NhbGl6YXRpb25UeXBlLFxyXG4gICAgICAgICAgICAgICAgc2hvd1RpbWU6IHRoaXMuc2hvd1RpbWUsXHJcbiAgICAgICAgICAgICAgICByZWY6IHRoaXNcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgdGV4dCA9IHRoaXMuYmVmb3JlV3JpdGVWYWx1ZSh2YWx1ZSwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIGlmICh0ZXh0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb250cm9sID0gdGhpcy5mb3JtYXRWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sQ2hhbmdlKHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAoKSA9PiB7fSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY29udHJvbENoYW5nZSA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVG91Y2ggPSBmbjtcclxuICAgIH1cclxuXHJcbn1cclxuIl19