/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
export class TreetableService {
    constructor() {
        this.selectionSource = new Subject();
        this.dblClickSource = new Subject();
        this.changeCheckboxStatus = new Subject();
        this.removeNode = new Subject();
        this.insertNode = new Subject();
        this.updateNode = new Subject();
        this.selectionSource$ = this.selectionSource.asObservable();
        this.dblClickSource$ = this.dblClickSource.asObservable();
        this.changeCheckboxStatus$ = this.changeCheckboxStatus.asObservable();
        this.insertNode$ = this.insertNode.asObservable();
        this.removeNode$ = this.removeNode.asObservable();
        this.updateNode$ = this.updateNode.asObservable();
    }
    /**
     * @param {?=} selected
     * @return {?}
     */
    onSelectionChange(selected) {
        this.selectionSource.next(selected);
    }
    /**
     * @param {?} rowNode
     * @return {?}
     */
    onDblClick(rowNode) {
        this.dblClickSource.next(rowNode);
    }
    /**
     * @param {?} rowNode
     * @return {?}
     */
    onChangeCheckboxStatus(rowNode) {
        this.changeCheckboxStatus.next(rowNode);
    }
    /**
     * @param {?} treeNode
     * @param {?=} parent
     * @return {?}
     */
    onInsert(treeNode, parent) {
        this.insertNode.next(treeNode);
    }
    /**
     * @param {?} rowNode
     * @return {?}
     */
    onRemove(rowNode) {
        this.removeNode.next(rowNode);
    }
    /**
     * @param {?} rowNode
     * @return {?}
     */
    onUpdate(rowNode) {
        this.updateNode.next(rowNode);
    }
    /**
     * @param {?} col
     * @param {?} tt
     * @return {?}
     */
    columnIsVisible(col, tt) {
        if (col.visible === undefined) {
            return true;
        }
        if (typeof col.visible === 'function') {
            return col.visible(tt);
        }
        return col.visible;
    }
    /**
     * @param {?} columns
     * @param {?} tt
     * @return {?}
     */
    checkColumnsForGroupHeader(columns, tt) {
        /** @type {?} */
        let _columns = [];
        if (columns && columns.length) {
            _columns = this.getDataColumns(columns);
        }
        return {
            columns: _columns
        };
    }
    /**
     * @private
     * @param {?} cols
     * @param {?} length
     * @return {?}
     */
    getDataFields(cols, length) {
        /** @type {?} */
        let i = 0;
        /** @type {?} */
        let j = 0;
        cols.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            /** @type {?} */
            const colspan = n.colspan || 1;
            if (i + colspan <= length) {
                i += colspan;
                j++;
            }
        }));
        return cols.splice(0, j);
    }
    /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    getDataColumns(cols) {
        if (!cols || !cols.length) {
            return [];
        }
        /** @type {?} */
        let fields = [];
        for (let i = 0; i < cols.length; i++) {
            /** @type {?} */
            let _cols = cols[i];
            if (cols[i] && !cols[i].length) {
                _cols = [...fields];
                fields = [];
            }
            _cols.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (!n.field && n.colspan && n.colspan > 1) {
                    this.getDataFields(cols[i + 1], n.colspan).forEach((/**
                     * @param {?} d
                     * @return {?}
                     */
                    d => {
                        if (!fields.includes((/**
                         * @param {?} f
                         * @return {?}
                         */
                        f => f.field === d.field))) {
                            fields.push(d);
                        }
                    }));
                }
                else {
                    if (!fields.includes((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.field === n.field))) {
                        fields.push(n);
                    }
                }
            }));
        }
        return fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => !n.colspan || n.colspan === 1));
    }
}
TreetableService.decorators = [
    { type: Injectable }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.selectionSource;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.dblClickSource;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.changeCheckboxStatus;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.removeNode;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.insertNode;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.updateNode;
    /** @type {?} */
    TreetableService.prototype.selectionSource$;
    /** @type {?} */
    TreetableService.prototype.dblClickSource$;
    /** @type {?} */
    TreetableService.prototype.changeCheckboxStatus$;
    /** @type {?} */
    TreetableService.prototype.insertNode$;
    /** @type {?} */
    TreetableService.prototype.removeNode$;
    /** @type {?} */
    TreetableService.prototype.updateNode$;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZXRhYmxlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXRyZWV0YWJsZS8iLCJzb3VyY2VzIjpbImxpYi90cmVldGFibGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBTTNDLE1BQU0sT0FBTyxnQkFBZ0I7SUFEN0I7UUFHWSxvQkFBZSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFDaEMsbUJBQWMsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQy9CLHlCQUFvQixHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7UUFDOUMsZUFBVSxHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7UUFDcEMsZUFBVSxHQUFHLElBQUksT0FBTyxFQUFZLENBQUM7UUFDckMsZUFBVSxHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7UUFHNUMscUJBQWdCLEdBQW9CLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDeEUsb0JBQWUsR0FBb0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN0RSwwQkFBcUIsR0FBd0IsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3RGLGdCQUFXLEdBQXlCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDbkUsZ0JBQVcsR0FBd0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNsRSxnQkFBVyxHQUF3QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBMkZ0RSxDQUFDOzs7OztJQXpGRyxpQkFBaUIsQ0FBQyxRQUFxQjtRQUNuQyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN4QyxD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QUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTzs7OztvQkFBQyxDQUFDLENBQUMsRUFBRTt3QkFDbkQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFROzs7O3dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFDLEVBQUU7NEJBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQ2xCO29CQUNMLENBQUMsRUFBQyxDQUFDO2lCQUNOO3FCQUFNO29CQUNILElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUTs7OztvQkFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBQyxFQUFFO3dCQUM1QyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO3FCQUNsQjtpQkFDSjtZQUNMLENBQUMsRUFBQyxDQUFDO1NBQ047UUFDRCxPQUFPLE1BQU0sQ0FBQyxNQUFNOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLEVBQUMsQ0FBQztJQUM3RCxDQUFDOzs7WUF6R0osVUFBVTs7Ozs7OztJQUdQLDJDQUF3Qzs7Ozs7SUFDeEMsMENBQXVDOzs7OztJQUN2QyxnREFBc0Q7Ozs7O0lBQ3RELHNDQUE0Qzs7Ozs7SUFDNUMsc0NBQTZDOzs7OztJQUM3QyxzQ0FBNEM7O0lBRzVDLDRDQUF3RTs7SUFDeEUsMkNBQXNFOztJQUN0RSxpREFBc0Y7O0lBQ3RGLHVDQUFtRTs7SUFDbkUsdUNBQWtFOztJQUNsRSx1Q0FBa0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZmxhdHRlbiB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IFJvd05vZGUsIFRyZWVOb2RlIH0gZnJvbSAnLi90eXBlcy90cmVlbm9kZSc7XHJcbmltcG9ydCB7IFRyZWVUYWJsZUNvbHVtbiB9IGZyb20gJy4vdHlwZXMvdHJlZXRhYmxlLWNvbHVtbic7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBUcmVldGFibGVTZXJ2aWNlIHtcclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdGlvblNvdXJjZSA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIGRibENsaWNrU291cmNlID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgY2hhbmdlQ2hlY2tib3hTdGF0dXMgPSBuZXcgU3ViamVjdDxSb3dOb2RlPigpO1xyXG4gICAgcHJpdmF0ZSByZW1vdmVOb2RlID0gbmV3IFN1YmplY3Q8Um93Tm9kZT4oKTtcclxuICAgIHByaXZhdGUgaW5zZXJ0Tm9kZSA9IG5ldyBTdWJqZWN0PFRyZWVOb2RlPigpO1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVOb2RlID0gbmV3IFN1YmplY3Q8Um93Tm9kZT4oKTtcclxuXHJcblxyXG4gICAgc2VsZWN0aW9uU291cmNlJDogT2JzZXJ2YWJsZTxhbnk+ID0gdGhpcy5zZWxlY3Rpb25Tb3VyY2UuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBkYmxDbGlja1NvdXJjZSQ6IE9ic2VydmFibGU8YW55PiA9IHRoaXMuZGJsQ2xpY2tTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjaGFuZ2VDaGVja2JveFN0YXR1cyQ6IE9ic2VydmFibGU8Um93Tm9kZT4gPSB0aGlzLmNoYW5nZUNoZWNrYm94U3RhdHVzLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgaW5zZXJ0Tm9kZSQ6IE9ic2VydmFibGU8VHJlZU5vZGU+ID0gdGhpcy5pbnNlcnROb2RlLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgcmVtb3ZlTm9kZSQ6IE9ic2VydmFibGU8Um93Tm9kZT4gPSB0aGlzLnJlbW92ZU5vZGUuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB1cGRhdGVOb2RlJDogT2JzZXJ2YWJsZTxSb3dOb2RlPiA9IHRoaXMudXBkYXRlTm9kZS5hc09ic2VydmFibGUoKTtcclxuXHJcbiAgICBvblNlbGVjdGlvbkNoYW5nZShzZWxlY3RlZD86IFRyZWVOb2RlW10pIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvblNvdXJjZS5uZXh0KHNlbGVjdGVkKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkRibENsaWNrKHJvd05vZGU6IFJvd05vZGUpIHtcclxuICAgICAgICB0aGlzLmRibENsaWNrU291cmNlLm5leHQocm93Tm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGFuZ2VDaGVja2JveFN0YXR1cyhyb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VDaGVja2JveFN0YXR1cy5uZXh0KHJvd05vZGUpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uSW5zZXJ0KHRyZWVOb2RlOiBUcmVlTm9kZSwgcGFyZW50PzogVHJlZU5vZGUpIHtcclxuICAgICAgICB0aGlzLmluc2VydE5vZGUubmV4dCh0cmVlTm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25SZW1vdmUocm93Tm9kZTogUm93Tm9kZSkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlTm9kZS5uZXh0KHJvd05vZGUpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVXBkYXRlKHJvd05vZGU6IFJvd05vZGUpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZU5vZGUubmV4dChyb3dOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb2x1bW5Jc1Zpc2libGUoY29sLCB0dCkge1xyXG4gICAgICAgIGlmIChjb2wudmlzaWJsZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGNvbC52aXNpYmxlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2wudmlzaWJsZSh0dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY29sLnZpc2libGU7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tDb2x1bW5zRm9yR3JvdXBIZWFkZXIoY29sdW1uczogYW55LCB0dDogYW55KSB7XHJcbiAgICAgICAgbGV0IF9jb2x1bW5zID0gW107XHJcbiAgICAgICAgaWYgKGNvbHVtbnMgJiYgY29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgX2NvbHVtbnMgPSB0aGlzLmdldERhdGFDb2x1bW5zKGNvbHVtbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjb2x1bW5zOiBfY29sdW1uc1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGF0YUZpZWxkcyhjb2xzLCBsZW5ndGgpIHtcclxuICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgbGV0IGogPSAwO1xyXG4gICAgICAgIGNvbHMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29sc3BhbiA9IG4uY29sc3BhbiB8fCAxO1xyXG4gICAgICAgICAgICBpZiAoaSArIGNvbHNwYW4gPD0gbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpICs9IGNvbHNwYW47XHJcbiAgICAgICAgICAgICAgICBqKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gY29scy5zcGxpY2UoMCwgaik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGF0YUNvbHVtbnMoY29scykge1xyXG4gICAgICAgIGlmICghY29scyB8fCAhY29scy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGZpZWxkcyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgX2NvbHMgPSBjb2xzW2ldO1xyXG4gICAgICAgICAgICBpZiAoY29sc1tpXSAmJiAhY29sc1tpXS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIF9jb2xzID0gWy4uLmZpZWxkc107XHJcbiAgICAgICAgICAgICAgICBmaWVsZHMgPSBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfY29scy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFuLmZpZWxkICYmIG4uY29sc3BhbiAmJiBuLmNvbHNwYW4gPiAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXREYXRhRmllbGRzKGNvbHNbaSArIDFdLCBuLmNvbHNwYW4pLmZvckVhY2goZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRzLmluY2x1ZGVzKGYgPT4gZi5maWVsZCA9PT0gZC5maWVsZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRzLmluY2x1ZGVzKGYgPT4gZi5maWVsZCA9PT0gbi5maWVsZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2gobik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZpZWxkcy5maWx0ZXIobiA9PiAhbi5jb2xzcGFuIHx8IG4uY29sc3BhbiA9PT0gMSk7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==