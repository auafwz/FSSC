/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ElementRef, Renderer2, ChangeDetectorRef, HostBinding, Output, EventEmitter, NgZone } from "@angular/core";
import { ResponseToolbarDropDown, ResponseToolbarItem, ResponseToolbarGroup } from "../model/response-toolbar.model";
import { FResizedDirective } from "../resized/f-resized.directive";
import { Subject, Observable } from "rxjs";
import { debounceTime } from "rxjs/operators";
import { LocaleService } from "@farris/ui-locale";
import ResizeObserver from "resize-observer-polyfill";
export class ResponseToolbarComponent {
    /**
     * @param {?} el
     * @param {?} render
     * @param {?} cd
     * @param {?} localeService
     */
    constructor(el, render, cd, localeService) {
        this.render = render;
        this.cd = cd;
        this.localeService = localeService;
        this.frtCls = true;
        this.prCls = true;
        // 传递点击事件
        this.rtClickEvent = new EventEmitter();
        // 辅助计算宽度数据
        this.auxiliaryDatas = [];
        // 控制父元素滚动的样式
        //  private _dpState = false;
        //
        this.ro = null;
        // 记录容器宽度
        this.containerWidthRecord = 0;
        // 记录变化
        this.needResponseChanges = 0;
        this.referEl = null;
        this.dpState = [false];
        // 用来内部记录
        this._auxiliary = -1;
        this.resizeGroups = [];
        // 记录格式化后的数据
        this.toolbarDatas = [];
        this.distanceThreshold = 20;
        this.isUpdateTBView = false;
        this._stateDatas = new Subject();
        this._btnVisibleDatas = new Subject();
        this.clickThrottleTime = 350;
        this.clickItems = new Subject();
        this.rtSize = "";
        /*强制方向，默认为空值，可以有top、bottom，朝上、朝下。
             * 使用场景：工具栏内部的下拉，需要朝上或者需要朝下展开，统一控制
             */
        this.popDirection = "";
        // right按钮靠右 left按钮靠左
        this.btnAlign = "right";
        this.ngZone = null;
        this._selfEl = el.nativeElement;
        if (el.nativeElement.parentElement) {
            this.referEl = el.nativeElement.parentElement;
        }
    }
    // 内部记录格式化后的初始数据-------------------------暂时不用
    // _toolbarDatas: Array<ResponseToolbarItem | ResponseToolbarDropDown> = [];
    /**
     * @param {?} values
     * @return {?}
     */
    set groups(values) {
        if (values) {
            this.resizeGroups = [];
            values.forEach((/**
             * @param {?} group
             * @return {?}
             */
            group => {
                this.resizeGroups.push(new ResponseToolbarGroup(group.id, group.name));
                // 还没有计算预置排序
            }));
        }
    }
    /**
     * @param {?} values
     * @return {?}
     */
    set datas(values) {
        if (values) {
            this.toolbarDatas = this._formatData(values);
            this.needResponseChanges++;
            // 处理分组数据
            this._reOrganizeResizeGroups();
        }
    }
    // 按钮的禁用状态
    /**
     * @param {?} values
     * @return {?}
     */
    set btnState(values) {
        this._stateDatas = values;
    }
    // 按钮的查看状态
    /**
     * @param {?} values
     * @return {?}
     */
    set btnVisible(values) {
        this._btnVisibleDatas = values;
    }
    /*尺寸：有sm,lg,空值，默认是空值 */
    /**
     * @param {?} btnSize
     * @return {?}
     */
    set buttonSize(btnSize) {
        if (btnSize != this.rtSize) {
            this.rtSize &&
                this.render.removeClass(this._selfEl, "f-response-toolbar-" + this.rtSize);
            this.rtSize = btnSize;
            this.rtSize &&
                this.render.addClass(this._selfEl, "f-response-toolbar-" + this.rtSize);
        }
    }
    /**
     * @return {?}
     */
    get buttonSize() {
        return this.rtSize;
    }
    // 因为旧模板带有这个方法
    /**
     * @return {?}
     */
    ngAfterViewInit() { }
    // 因为旧模板带有这个方法
    /**
     * @return {?}
     */
    ngDoCheck() { }
    /**
     * @return {?}
     */
    ngOnInit() {
        // 去掉overflow之后
        this.render.addClass(this.auxiliaryContainerEl.nativeElement, "response-toolbar-hidden-element");
        // 按钮的禁用状态
        this._stateDatas.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            this.changeState(data);
        }));
        // 按钮的可见状态
        this._btnVisibleDatas.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            this.changeVisible(data);
        }));
        this.observerElement();
        // 拦截点击事件只传递第一次点击事件的处理操作交给parent来处理
        this.clickSubscription = this.clickItems
            .pipe(debounceTime(this.clickThrottleTime))
            .subscribe((/**
         * @param {?} eventDatas
         * @return {?}
         */
        (eventDatas) => {
            this.rtClickEvent.emit(eventDatas);
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.ro) {
            this.ro.unobserve(this.resizedContainerEl.nativeElement);
            this.ro = null;
        }
        if (this.clickSubscription) {
            this.clickSubscription.unsubscribe();
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
        if (this.needResponseChanges > 0) {
            this.needResponseChanges--;
            this.responseResize();
        }
        else if (this.auxiliaryDatas.length > 0) {
            this._calculate(true, this.auxiliaryContainerEl.nativeElement.offsetWidth);
        }
    }
    // 因为旧模板带有这个方法
    /**
     * @param {?} event
     * @return {?}
     */
    onResize(event) { }
    /**
     * 兼容旧模板旧方法
     * 在不存在ngZone的情况下，创建ngZone,然后绑定事件
     * @private
     * @return {?}
     */
    observerElement() {
        if (!this.ngZone) {
            /** @type {?} */
            const moduleInjector = this.cd["_view"].root.ngModule.injector;
            this.ngZone = moduleInjector.get(NgZone, null);
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.ro = new ResizeObserver((/**
             * @param {?} entries
             * @param {?} observer
             * @return {?}
             */
            (entries, observer) => {
                /** @type {?} */
                const tempWidth = entries[0].contentRect.width;
                if (Math.abs(tempWidth - this.containerWidthRecord) >
                    this.distanceThreshold) {
                    this.responseResize();
                    this.containerWidthRecord = tempWidth;
                }
            }));
            this.ro.observe(this.resizedContainerEl.nativeElement);
        }));
    }
    /**
     * 强制转换方向
     * @param {?} selfDefinePL
     * @param {?} defaultPL
     * @return {?}
     */
    getPlacement(selfDefinePL, defaultPL) {
        /** @type {?} */
        let oldDirection = selfDefinePL ? selfDefinePL : defaultPL;
        if (!this.popDirection) {
            return oldDirection;
        }
        /** @type {?} */
        var plRelation = { bottom: "top", top: "bottom" };
        oldDirection = oldDirection == "left" ? "left-bottom" : oldDirection;
        oldDirection = oldDirection == "right" ? "right-bottom" : oldDirection;
        /** @type {?} */
        let newDirection = oldDirection.replace(plRelation[this.popDirection], this.popDirection);
        return newDirection;
    }
    /**
     * 调用此方法的场景
     * 1、界面拖拽自动触发
     * 2、显示调用
     * @return {?}
     */
    responseResize() {
        /** @type {?} */
        const _distance = this._getDistance();
        if (_distance > 0) {
            // 如果分组都已经处理完,再出现滚动条不管
            /** @type {?} */
            const _tempIndex = this._getFirstUnResponsedIndex();
            if (_tempIndex < 0) {
                return;
            }
            // 所有第一层下拉都収折
            this.dpState = [false];
            for (let k = _tempIndex; k < this.resizeGroups.length; k++) {
                /** @type {?} */
                const _tempGroup = this.resizeGroups[k];
                this._auxiliary = k;
                if (_tempGroup.isResponsing()) {
                    this._calculate();
                }
                else {
                    // 如果还未开始处理响应式
                    /** @type {?} */
                    const _tempDP = new ResponseToolbarDropDown({
                        text: _tempGroup.name,
                        id: _tempGroup.id,
                        placement: this.popDirection
                            ? this.popDirection + "-left"
                            : "bottom-left",
                        width: _tempGroup.getWidth()
                    });
                    // 已经处理过宽度
                    if (_tempDP.getWidth()) {
                        this.auxiliaryDatas = [_tempDP];
                        this._calculate(true, _tempDP.getWidth());
                    }
                    else {
                        // 更新辅助数据
                        this.auxiliaryDatas.push(_tempDP);
                        this.cd.detectChanges();
                    }
                }
            }
        }
        else {
            // 寻找最后一个处理响应式的元素
            /** @type {?} */
            const _tempIndex = this._getLastResponseIndex();
            if (_tempIndex < 0) {
                return;
            }
            // 临时存储数据
            /** @type {?} */
            let _tempToolbarDatas = [].concat(this.toolbarDatas);
            // 如果已经开始处理响应式
            for (let k = _tempIndex; k >= 0; k--) {
                /** @type {?} */
                const result = this._restitute(_tempToolbarDatas, k);
                _tempToolbarDatas = [].concat(result["data"]);
                if (!result["continueTo"]) {
                    break;
                }
            }
            // 更新数据
            this.toolbarDatas = [].concat(_tempToolbarDatas);
            // 所有第一层下拉都収折
            this.dpState = [false];
            this.cd.detectChanges();
        }
    }
    // 下拉的展开收起状态
    /**
     * @param {?} state
     * @param {?} id
     * @return {?}
     */
    dpSectionState(state, id) {
        if (state) {
            // 展开状态下
            /** @type {?} */
            let dropdowns = this.resizedContentEl.nativeElement.querySelectorAll("[fDropdown]");
            if (dropdowns && dropdowns.length > 1) {
                for (var k = 0; k < dropdowns.length; k++) {
                    if (dropdowns[k].className.indexOf("show") &&
                        dropdowns[k].id != id) {
                        // dropdowns[k].dispatchEvent(new Event('selfClose'));
                        this.compatibleDispatchEvent(dropdowns[k], "selfClose");
                    }
                }
            }
        }
    }
    /**
     * @private
     * @param {?} eventEl
     * @param {?} eventName
     * @return {?}
     */
    compatibleDispatchEvent(eventEl, eventName) {
        /** @type {?} */
        var event;
        if (typeof Event === "function") {
            event = new Event(eventName);
        }
        else {
            event = document.createEvent("Event");
            event.initEvent(eventName, false, false);
        }
        eventEl.dispatchEvent(event);
    }
    // 修改启用禁用状态
    /**
     * @param {?} values
     * @return {?}
     */
    changeState(values) {
        /** @type {?} */
        const idArray = Object.keys(values);
        idArray.forEach((/**
         * @param {?} id
         * @return {?}
         */
        id => {
            /** @type {?} */
            const state = values[id];
            /** @type {?} */
            const item = this._findItemByID(id, this.toolbarDatas);
            if (item) {
                item["disabled"] = state;
            }
        }));
        this.cd.detectChanges();
    }
    /**
     * 修改显示状态
     * 如果是下拉按钮
     *   判断下面的子是否都隐藏
     * @param {?} values
     * @return {?}
     */
    changeVisible(values) {
        /** @type {?} */
        const idArray = Object.keys(values);
        idArray.forEach((/**
         * @param {?} id
         * @return {?}
         */
        id => {
            /** @type {?} */
            const visible = values[id];
            /** @type {?} */
            const item = this._findItemByID(id, this.toolbarDatas);
            if (item) {
                item["visible"] = visible;
            }
        }));
        // 遍历循环,更新数据
        this.toolbarDatas.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            // 如果是下拉
            if (item["isDP"]) {
                this._checkDropdownVisible(values, item);
            }
        }));
        this.needResponseChanges++;
        // 更新
        //this.cd.markForCheck();
        this.cd.detectChanges();
    }
    /**
     * 如果是下拉按钮
     *   判断下面的子是否都隐藏
     *       A. 如果子都隐藏，那么整个下拉都被隐藏；
     *       B. 如果存在子没有隐藏，而且下拉没有被预置隐藏，下拉按钮显示
     * @private
     * @param {?} outsideVisibleArrays 从组件外传入的可见状态对象
     * @param {?} dropdownItem 下拉元素
     * @return {?}
     */
    _checkDropdownVisible(outsideVisibleArrays, dropdownItem) {
        //如果没有被强制设置状态
        if (!outsideVisibleArrays.hasOwnProperty(dropdownItem["id"])) {
            // 下拉元素不可见，判断是否有可见子元素
            if (!dropdownItem["visible"] &&
                this._hasVisibleItem(dropdownItem["children"], true)) {
                dropdownItem["visible"] = true;
            }
            // 下拉元素是可见，判断是否有子元素都不可见
            if (dropdownItem["visible"] &&
                !this._hasVisibleItem(dropdownItem["children"], true)) {
                dropdownItem["visible"] = false;
            }
        }
        dropdownItem.children.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            if (item["isDP"]) {
                this._checkDropdownVisible(outsideVisibleArrays, item);
            }
        }));
    }
    /**
     * 在待检查数据中心，检查是否存在该可见状态的数据。
     * 如果有返回true,否则返回false
     * @private
     * @param {?} datas 待检查数据
     * @param {?} visible 可见状态
     * @return {?}
     */
    _hasVisibleItem(datas, visible) {
        /** @type {?} */
        const findIndex = datas.findIndex((/**
         * @param {?} childItem
         * @return {?}
         */
        childItem => {
            if (childItem["visible"] == visible) {
                return true;
            }
            return false;
        }));
        if (findIndex > -1) {
            return true;
        }
        return false;
    }
    /**
     * 捕获点击
     * @param {?} ev
     * @return {?}
     */
    clickItem(ev) {
        // 如果是分离的下拉按钮
        if (this.elhasSpecialCls(ev.target, "dropdown-toggle-split")) {
            ev.stopImmediatePropagation();
        }
        // 判断是否点击到需要处理事件的元素上,按钮、下拉按钮
        /** @type {?} */
        var clickEvEl = this.findBtnOrTogglerItemFromClick(ev.target);
        if (clickEvEl) {
            /** @type {?} */
            let tempID = clickEvEl["id"];
            // 修改模板，id调整到下拉整体上
            if (!tempID &&
                this.elhasSpecialCls(clickEvEl["parentNode"], "f-rt-dropdown")) {
                tempID = clickEvEl["parentNode"].id;
            }
            if (tempID) {
                /** @type {?} */
                const tempItem = this._findItemByID(tempID, this.toolbarDatas);
                // 如果元素禁用
                if (tempItem["disabled"]) {
                    // 禁止向上传递
                    ev.stopImmediatePropagation();
                }
                else {
                    this.clickItems.next({
                        id: tempID,
                        text: tempItem["text"],
                        hidden: tempItem["hidden"]
                    });
                }
            }
        }
        else {
            ev.stopImmediatePropagation();
        }
    }
    /**
     * @private
     * @param {?} clickTarget
     * @return {?}
     */
    findBtnOrTogglerItemFromClick(clickTarget) {
        // 父级标签是否是body,是着停止返回集合,反之继续
        if (this.elhasSpecialCls(clickTarget)) {
            return clickTarget;
        }
        else if (clickTarget.parentNode.hasOwnProperty("className") &&
            clickTarget.parentNode.className.indexOf("f-response-content") < 0) {
            /** @type {?} */
            var parentN = clickTarget.parentNode;
            if (this.elhasSpecialCls(parentN)) {
                return parentN;
            }
            else {
                return this.findBtnOrTogglerItemFromClick(parentN);
            }
        }
        // 返回集合,结束
        return null;
    }
    /**
     * @private
     * @param {?} el
     * @param {?=} clsName
     * @return {?}
     */
    elhasSpecialCls(el, clsName = "") {
        if (el) {
            /** @type {?} */
            var classNameList = el.classList;
            /** @type {?} */
            var findCls = false;
            for (var k = 0; k < classNameList.length; k++) {
                if (clsName) {
                    if (classNameList[k] == clsName) {
                        findCls = true;
                        break;
                    }
                }
                else {
                    if (classNameList[k] == "f-rt-btn" ||
                        classNameList[k] == "f-rt-toggle") {
                        findCls = true;
                        break;
                    }
                }
            }
            return findCls;
        }
        return false;
    }
    /**
     * 根据传递的数据重新组建分组
     * ToDo 暂时没有更复杂的分组，否则需要记录分组
     * @private
     * @return {?}
     */
    _reOrganizeResizeGroups() {
        // 处理分组数据
        //  if (this.resizeGroups.length === 0) {
        /** @type {?} */
        let moreText = "更多";
        if (this.localeService) {
            moreText = this.localeService.getValue("responseToolbar.more");
        }
        /** @type {?} */
        const defaultResizeGroup = new ResponseToolbarGroup("toolbar-group-1", moreText);
        for (let i = this.toolbarDatas.length - 1; i >= 0; i--) {
            defaultResizeGroup.setPreset(this.toolbarDatas[i]["id"]);
        }
        this.resizeGroups = [].concat(defaultResizeGroup);
        // this.cd.markForCheck();
        this.cd.detectChanges();
    }
    /**
     * 内容与容器的差值
     * @private
     * @return {?}
     */
    _getDistance() {
        return (this.resizedContentEl.nativeElement.offsetWidth -
            this.resizedContainerEl.nativeElement.offsetWidth);
    }
    /**
     * 根据返回结果判断是否继续
     * @private
     * @param {?} originalData
     * @param {?} groupIndex
     * @return {?}
     */
    _restitute(originalData, groupIndex) {
        /** @type {?} */
        const tempGroup = this.resizeGroups[groupIndex];
        // 滚动条和内容的距离
        /** @type {?} */
        let tempDistance = this._getDistance();
        // 计算最后一个下拉的宽度
        /** @type {?} */
        const tempGroupData = originalData[this._findIndexByID(originalData, tempGroup.id)];
        // 找到还原的位置
        /** @type {?} */
        const tempPresetIndex = [].concat(tempGroup.responsedIndex);
        // 排除原下拉子元素被计算
        for (let j = tempPresetIndex.length - 1; j >= 0; j--) {
            if (tempDistance >= 0) {
                break;
            }
            // 从下拉中移除
            /** @type {?} */
            const tempChildData = tempGroupData.children[0];
            /** @type {?} */
            const specialDistance = j === 0 ? tempGroupData.getWidth() : 0;
            tempDistance =
                tempDistance +
                    (tempChildData.getWidth() ? tempChildData.getWidth() : 0) -
                    specialDistance;
            if (tempDistance >= 0) {
                break;
            }
            else {
                // 更新下拉
                tempGroupData.removeChild();
                // 插入到原位置
                originalData.splice(tempPresetIndex[j], 0, tempChildData);
                // 更新位置
                tempGroup.removeResponsed(j);
                if (j === 0) {
                    originalData.splice(this._findIndexByID(originalData, tempGroup.id), 1);
                }
            }
        }
        return {
            continueTo: tempDistance > 0 ? true : false,
            data: originalData
        };
    }
    /**
     * 开始计算
     * @private
     * @param {?=} auxiliary
     * @param {?=} tGroupWidth
     * @return {?}
     */
    _calculate(auxiliary = false, tGroupWidth = 0) {
        if (this._auxiliary < 0) {
            return;
        }
        // 记录需要修改的下拉
        /** @type {?} */
        let tempDP;
        // 滚动条和内容的距离
        /** @type {?} */
        let tempDistance = this._getDistance() + tGroupWidth;
        // 临时存储数据
        /** @type {?} */
        const tempToolbarDatas = [].concat(this.toolbarDatas);
        /** @type {?} */
        const tempGroup = this.resizeGroups[this._auxiliary];
        if (auxiliary) {
            tempDP = this.auxiliaryDatas.pop();
            tempDP.setWidth(tGroupWidth);
            tempGroup.setWidth(tGroupWidth);
        }
        else {
            tempDP =
                tempToolbarDatas[this._findIndexByID(tempToolbarDatas, tempGroup.id)];
        }
        // 当前剩余隐藏
        for (let j = tempGroup.responsedIndex.length; j < tempGroup.presetId.length; j++) {
            if (tempDistance <= 0) {
                break;
            }
            // 计算在当前数据中的位置，根据这个位置可以找宽度
            /** @type {?} */
            const tempOldIndex = (/** @type {?} */ (this._findIndexByID(this.toolbarDatas, tempGroup.presetId[j])));
            /** @type {?} */
            const tempNewIndex = (/** @type {?} */ (this._findIndexByID(tempToolbarDatas, tempGroup.presetId[j])));
            // 计算按钮宽度
            /** @type {?} */
            let tempWidth = (/** @type {?} */ (this.toolbarDatas[tempOldIndex].getWidth()));
            if (tempWidth === 0) {
                // 按钮宽度未曾被计算过
                tempWidth = this._getWidthFromElementsById(tempGroup.presetId[j]);
                tempToolbarDatas[tempNewIndex].setWidth(tempWidth);
            }
            else if (tempWidth === false) {
                // 按钮被隐藏
                tempWidth = 0;
            }
            tempDP.addChild(tempToolbarDatas[tempNewIndex]);
            // 移除
            tempToolbarDatas.splice(tempNewIndex, 1);
            // 保存位置用于还原
            tempGroup.setResponsed(tempNewIndex);
            tempDistance = tempDistance - tempWidth;
        }
        if (auxiliary && tempDP.hasChild()) {
            // 插入
            tempToolbarDatas.push(tempDP);
        }
        this._auxiliary = -1;
        this.toolbarDatas = [].concat(tempToolbarDatas);
        this.cd.detectChanges();
    }
    /**
     * 根据id找到实际显示元素的宽度
     * @private
     * @param {?} findId
     * @return {?}
     */
    _getWidthFromElementsById(findId) {
        /** @type {?} */
        const parentEl = this.resizedContentEl.nativeElement;
        /** @type {?} */
        const childLen = parentEl.children.length;
        /** @type {?} */
        let result = 0;
        for (var k = 0; k < childLen; k++) {
            if (parentEl.children[k].id === findId) {
                result = parentEl.children[k].offsetWidth;
                break;
            }
        }
        return result;
    }
    /**
     * 格式化数据
     * @private
     * @param {?} datas
     * @param {?=} idPrefix
     * @return {?}
     */
    _formatData(datas, idPrefix = "response") {
        /** @type {?} */
        const result = [];
        datas.forEach((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (item, index) => {
            if (item.isDP) {
                // 如果是下拉
                if (item.hasOwnProperty("children") &&
                    item["children"].length) {
                    /** @type {?} */
                    const children = [].concat(item["children"]);
                    item.children = [];
                    /** @type {?} */
                    const dpItem = new ResponseToolbarDropDown(Object.assign({ id: idPrefix + "_" + index }, item));
                    result.push(dpItem);
                    dpItem.children = this._formatData(children, idPrefix + "_" + index);
                }
                else {
                    result.push(new ResponseToolbarDropDown(Object.assign({ id: idPrefix + "_" + index }, item)));
                }
            }
            else {
                // 非下拉
                result.push(new ResponseToolbarItem(Object.assign({ id: idPrefix + "_" + index }, item)));
            }
        }));
        return result;
    }
    /**
     * 找到第一个未处理完响应式的元素
     * @private
     * @return {?}
     */
    _getFirstUnResponsedIndex() {
        /** @type {?} */
        const tempUnResponsedIndex = this.resizeGroups.findIndex((/**
         * @param {?} group
         * @return {?}
         */
        group => {
            if (group.isResponsed()) {
                return false;
            }
            return true;
        }));
        return tempUnResponsedIndex;
    }
    /**
     * 寻找最后一个处理响应式的元素
     * @private
     * @return {?}
     */
    _getLastResponseIndex() {
        /** @type {?} */
        const tempResponsingIndex = this.resizeGroups.findIndex((/**
         * @param {?} group
         * @return {?}
         */
        group => {
            if (!group.isResponsing()) {
                return true;
            }
            return false;
        }));
        // 所有组元素都已处理完响应式
        if (tempResponsingIndex === -1) {
            return this.resizeGroups.length - 1;
        }
        // 所有组元素都未开始处理响应式
        return tempResponsingIndex > 1 ? tempResponsingIndex - 1 : -1;
    }
    /**
     * 找到group形成的下拉，在数据中的位置
     * @private
     * @param {?} datas
     * @param {?} id
     * @return {?}
     */
    _findIndexByID(datas, id) {
        /** @type {?} */
        const result = datas.findIndex((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (item, index) => {
            if (item["id"] === id) {
                return true;
            }
            return false;
        }));
        return result;
    }
    /**
     * 根据ID寻找Item
     * @private
     * @param {?} id
     * @param {?} data
     * @return {?}
     */
    _findItemByID(id, data) {
        /** @type {?} */
        let tempResult = null;
        /** @type {?} */
        const tempIndex = data.findIndex((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (item, index) => {
            if (item["id"] === id) {
                tempResult = item;
                return true;
            }
            // 如果是下拉，层级下拉
            if (item["isDP"]) {
                /** @type {?} */
                const tempItem = this._findItemByID(id, item["children"]);
                if (tempItem) {
                    tempResult = tempItem;
                    return true;
                }
            }
            return false;
        }));
        return tempResult;
    }
}
ResponseToolbarComponent.decorators = [
    { type: Component, args: [{
                selector: "f-response-toolbar",
                template: "<!-- <div class=\"border bg-primary\" style=\"height:40px;position: relative;\"> -->\r\n<div #auxiliaryContainer class=\"response-toolbar-hidden-element\">\r\n    <ng-container *ngFor=\"let dataItem of auxiliaryDatas\">\r\n        <div class=\"btn-group\" *ngIf=\"dataItem.visible&&dataItem.isDP\" id=\"{{ dataItem.id }}\">\r\n            <button type=\"button\" class=\"btn dropdown-toggle dropdown-toggle-split  f-rt-toggle\"\r\n                [class.f-btn-ml]=\"btnAlign=='right'\" [class.f-btn-mr]=\"btnAlign=='left'\" [ngClass]=\"dataItem.class\" [class.btn-icontext]=\"dataItem.icon&&dataItem.icon.trim()\">\r\n             <i class=\"f-icon\" [ngClass]=\"dataItem.icon&&dataItem.icon.trim()\" *ngIf=\"dataItem.icon&&dataItem.icon.trim()\"></i>{{ dataItem.text }}\r\n            </button>\r\n        </div>\r\n        <button type=\"button\" class=\"btn f-rt-btn\" [class.f-btn-ml]=\"btnAlign=='right'\"\r\n            [class.f-btn-mr]=\"btnAlign=='left'\" [ngClass]=\"dataItem.class\" id=\"{{ dataItem.id }}\"\r\n            *ngIf=\"dataItem.visible&&!dataItem.isDP\" [class.btn-icontext]=\"dataItem.icon&&dataItem.icon.trim()\">\r\n            <i class=\"f-icon\" [ngClass]=\"dataItem.icon&&dataItem.icon.trim()\" *ngIf=\"dataItem.icon&&dataItem.icon.trim()\"></i>{{ dataItem.text }}\r\n        </button>\r\n    </ng-container>\r\n</div>\r\n<div fResized #resizedContainer (resizedEvent)=\"onResize($event)\" class=\"d-flex flex-nowrap\"\r\n    [ngClass]=\"{'justify-content-end':btnAlign=='right','justify-content-start':btnAlign=='left'}\">\r\n    <div class=\"d-inline-block f-response-content\" style=\"white-space: nowrap;\" #resizedContent\r\n        (click)=\"clickItem($event)\">\r\n        <ng-container *ngFor=\"let dataItem of toolbarDatas\">\r\n            <ng-container *ngIf=\"dataItem.visible && dataItem.isDP\">\r\n                <ng-container *ngTemplateOutlet=\"\r\n                        dropdownTmpl;\r\n                        context: { $implicit: dataItem }\r\n                    \"></ng-container>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"dataItem.visible && !dataItem.isDP&&dataItem.tipsEnable\">\r\n                <button type=\"button\" class=\"btn f-rt-btn\"\r\n                    [class.f-btn-ml]=\"btnAlign=='right'\" [class.f-btn-mr]=\"btnAlign=='left'\" id=\"{{ dataItem.id }}\"\r\n                    [ngClass]=\"dataItem.class\" [class.disabled]=\"dataItem.disabled\" [class.btn-icontext]=\"dataItem.icon&&dataItem.icon.trim()\"\r\n                    [farrisTooltip]=\"dataItem.tipsEnable\" [content]=\"dataItem.tipsText\">\r\n                    <i class=\"f-icon\" [ngClass]=\"dataItem.icon&&dataItem.icon.trim()\" *ngIf=\"dataItem.icon&&dataItem.icon.trim()\"></i>{{ dataItem.text }}\r\n                </button>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"dataItem.visible && !dataItem.isDP&&!dataItem.tipsEnable\">\r\n                <button type=\"button\" class=\"btn f-rt-btn\"\r\n                    [class.f-btn-ml]=\"btnAlign=='right'\" [class.f-btn-mr]=\"btnAlign=='left'\" id=\"{{ dataItem.id }}\"\r\n                    [ngClass]=\"dataItem.class\" [class.disabled]=\"dataItem.disabled\"  [class.btn-icontext]=\"dataItem.icon&&dataItem.icon.trim()\">\r\n                    <i class=\"f-icon\" [ngClass]=\"dataItem.icon&&dataItem.icon.trim()\" *ngIf=\"dataItem.icon&&dataItem.icon.trim()\"></i>{{ dataItem.text }}\r\n                </button>\r\n            </ng-container>\r\n        </ng-container>\r\n    </div>\r\n</div>\r\n<!-- </div> -->\r\n\r\n<!--\u7B2C\u4E00\u5C42\u4E0B\u62C9-->\r\n<ng-template #dropdownTmpl let-data>\r\n    <div class=\"btn-group f-rt-dropdown\" id=\"{{ data.id }}\" fDropdown\r\n        [placement]=\"getPlacement(data['placement'],'bottom')\" (dpChangeEvent)=\"dpSectionState($event,data.id)\"\r\n        [rectifyReference]=\"referEl\" [forceState]=\"dpState\" [autoRectify]=\"true\" [class.f-btn-ml]=\"btnAlign=='right'\"\r\n        [class.f-btn-mr]=\"btnAlign=='left'\" [ngClass]=\"data['dropdownCls']\">\r\n        <!--\u542F\u7528\u4E0B\u62C9\u5206\u5F00\u6309\u94AE-->\r\n        <ng-container *ngIf=\"data.split\">\r\n            <ng-container *ngIf=\"data.tipsEnable\">\r\n                <button type=\"button\" class=\"btn f-rt-btn\" [ngClass]=\"data.class\" [class.disabled]=\"data.disabled\"\r\n                    [farrisTooltip]=\"data.tipsEnable\" [content]=\"data.tipsText\" [class.btn-icontext]=\"data.icon&&data.icon.trim()\">\r\n                    <i class=\"f-icon\" [ngClass]=\"data.icon&&data.icon.trim()\" *ngIf=\"data.icon&&data.icon.trim()\"></i>{{ data.text }}\r\n                </button>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"!data.tipsEnable\">\r\n                <button type=\"button\" class=\"btn f-rt-btn\" [ngClass]=\"data.class\" [class.disabled]=\"data.disabled\" [class.btn-icontext]=\"data.icon&&data.icon.trim()\">\r\n                    <i class=\"f-icon\" [ngClass]=\"data.icon&&data.icon.trim()\" *ngIf=\"data.icon&&data.icon.trim()\"></i>{{ data.text }}\r\n                </button>\r\n            </ng-container>\r\n            <button class=\"btn dropdown-toggle dropdown-toggle-split\" [ngClass]=\"data.class\" fDropdownToggle></button>\r\n        </ng-container>\r\n        <!--\u4E0D\u542F\u7528\u4E0B\u62C9\u5206\u5F00\u6309\u94AE-->\r\n        <ng-container *ngIf=\"!data.split&&data.tipsEnable\">\r\n            <button type=\"button\" fDropdownToggle class=\"btn f-rt-toggle\" [farrisTooltip]=\"data.tipsEnable\"\r\n                [content]=\"data.tipsText\" [ngClass]=\"data.class + ' dropdown-toggle'\" [dpDisabled]=\"data.disabled\" [class.btn-icontext]=\"data.icon&&data.icon.trim()\">\r\n                <i class=\"f-icon\" [ngClass]=\"data.icon&&data.icon.trim()\" *ngIf=\"data.icon&&data.icon.trim()\"></i>{{ data.text }}\r\n            </button>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!data.split&&!data.tipsEnable\">\r\n            <button type=\"button\" fDropdownToggle class=\"btn f-rt-toggle\" [ngClass]=\"data.class + ' dropdown-toggle'\"\r\n                [dpDisabled]=\"data.disabled\"  [class.btn-icontext]=\"data.icon&&data.icon.trim()\">\r\n                <i class=\"f-icon\" [ngClass]=\"data.icon&&data.icon.trim()\" *ngIf=\"data.icon&&data.icon.trim()\"></i>{{ data.text }}\r\n            </button>\r\n        </ng-container>\r\n        <ul class=\"dropdown-menu\" fDropdownMenu [ngClass]=\"data.menuCls\" id=\"{{ data.id }}_menu\">\r\n            <ng-container *ngFor=\"let item of data.children\">\r\n                <ng-container *ngIf=\"item.visible && item.isDP\">\r\n                    <ng-container *ngTemplateOutlet=\"\r\n                            dropdownSubTmpl;\r\n                            context: { $implicit: item }\r\n                        \"></ng-container>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"item.visible&&!item.isDP&&item.tipsEnable\">\r\n                    <li class=\"dropdown-item  f-rt-btn\" id=\"{{ item.id }}\" [class.disabled]=\"item.disabled\"\r\n                        [farrisTooltip]=\"item.tipsEnable\" [content]=\"item.tipsText\">\r\n                        {{ item.text }}\r\n                    </li>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"item.visible&&!item.isDP&&!item.tipsEnable\">\r\n                    <li class=\"dropdown-item  f-rt-btn\" id=\"{{ item.id }}\" [class.disabled]=\"item.disabled\">\r\n                        {{ item.text }}\r\n                    </li>\r\n                </ng-container>\r\n            </ng-container>\r\n        </ul>\r\n    </div>\r\n</ng-template>\r\n<!--\u7B2C\u4E8C\u5C42\u4E0B\u62C9-->\r\n<ng-template #dropdownSubTmpl let-subData>\r\n    <li class=\"dropdown-submenu f-rt-dropdown\" fDropdown [isSubDP]=\"true\"\r\n        [placement]=\"getPlacement(subData['placement'],'right')\" [autoRectify]=\"true\" [rectifyReference]=\"referEl\"\r\n        [ngClass]=\"subData['dropdownCls']\" id=\"{{ subData.id }}\">\r\n        <ng-container *ngIf=\"subData.split\">\r\n            <ng-container *ngIf=\"subData.tipsEnable\">\r\n                <span class=\"dropdown-item f-rt-btn\" [class.disabled]=\"subData['disabled']\" [ngClass]=\"subData['class']\"\r\n                    [farrisTooltip]=\"subData.tipsEnable\" [content]=\"subData.tipsText\">{{ subData.text }}</span>\r\n                <span class=\"dropdown-toggle dropdown-toggle-split f-rt-toggle\" fDropdownToggle></span>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"!subData.tipsEnable\">\r\n                <span class=\"dropdown-item f-rt-btn\" [class.disabled]=\"subData['disabled']\"\r\n                    [ngClass]=\"subData['class']\">{{ subData.text }}</span>\r\n                <span class=\"dropdown-toggle dropdown-toggle-split f-rt-toggle\" fDropdownToggle></span>\r\n            </ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!subData.split\">\r\n            <ng-container *ngIf=\"subData.tipsEnable\">\r\n                <span class=\"dropdown-item  dropdown-toggle f-rt-toggle\" [dpDisabled]=\"subData['disabled']\"\r\n                    [farrisTooltip]=\"subData.tipsEnable\" [content]=\"subData.tipsText\" [ngClass]=\"subData['class']\"\r\n                    fDropdownToggle>{{ subData.text }}</span>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"!subData.tipsEnable\">\r\n                <span class=\"dropdown-item  dropdown-toggle f-rt-toggle\" [dpDisabled]=\"subData['disabled']\"\r\n                    [ngClass]=\"subData['class']\" fDropdownToggle>{{ subData.text }}</span>\r\n            </ng-container>\r\n\r\n        </ng-container>\r\n\r\n        <ul class=\"dropdown-menu\" fDropdownMenu [ngClass]=\"subData.menuCls\" id=\"{{ subData.id }}_submenu\">\r\n            <ng-container *ngFor=\"let subItem of subData.children\">\r\n                <ng-container *ngIf=\"subItem.visible && subItem.isDP\">\r\n                    <ng-container *ngTemplateOutlet=\"\r\n                            dropdownSubTmpl;\r\n                            context: { $implicit: subItem }\r\n                        \"></ng-container>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"subItem.visible && !subItem.isDP\">\r\n                    <ng-container *ngIf=\"subItem.tipsEnable\">\r\n                        <li [farrisTooltip]=\"subItem.tipsEnable\" [content]=\"subItem.tipsText\"\r\n                            class=\"dropdown-item f-rt-btn\" id=\"{{ subItem.id }}\" [class.disabled]=\"subItem.disabled\">\r\n                            {{ subItem.text }}\r\n                        </li>\r\n                    </ng-container>\r\n                    <ng-container *ngIf=\"!subItem.tipsEnable\">\r\n                        <li class=\"dropdown-item f-rt-btn\" id=\"{{ subItem.id }}\" [class.disabled]=\"subItem.disabled\">\r\n                            {{ subItem.text }}\r\n                        </li>\r\n                    </ng-container>\r\n                </ng-container>\r\n            </ng-container>\r\n        </ul>\r\n    </li>\r\n</ng-template>",
                styles: [":host .response-toolbar-hidden-element{position:fixed;z-index:200;visibility:hidden;top:-87px}"]
            }] }
];
/** @nocollapse */
ResponseToolbarComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: LocaleService }
];
ResponseToolbarComponent.propDecorators = {
    frtCls: [{ type: HostBinding, args: ["class.f-response-toolbar",] }],
    prCls: [{ type: HostBinding, args: ["class.position-relative",] }],
    resizedContainerEl: [{ type: ViewChild, args: ["resizedContainer",] }],
    auxiliaryContainerEl: [{ type: ViewChild, args: ["auxiliaryContainer",] }],
    resizedContentEl: [{ type: ViewChild, args: ["resizedContent",] }],
    resizedContainerDirective: [{ type: ViewChild, args: ["resizedContainer", { read: FResizedDirective },] }],
    rtClickEvent: [{ type: Output }],
    groups: [{ type: Input }],
    datas: [{ type: Input }],
    btnState: [{ type: Input }],
    btnVisible: [{ type: Input }],
    clickThrottleTime: [{ type: Input }],
    buttonSize: [{ type: Input }],
    popDirection: [{ type: Input }],
    btnAlign: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ResponseToolbarComponent.prototype.frtCls;
    /** @type {?} */
    ResponseToolbarComponent.prototype.prCls;
    /** @type {?} */
    ResponseToolbarComponent.prototype.resizedContainerEl;
    /** @type {?} */
    ResponseToolbarComponent.prototype.auxiliaryContainerEl;
    /** @type {?} */
    ResponseToolbarComponent.prototype.resizedContentEl;
    /** @type {?} */
    ResponseToolbarComponent.prototype.resizedContainerDirective;
    /** @type {?} */
    ResponseToolbarComponent.prototype.rtClickEvent;
    /** @type {?} */
    ResponseToolbarComponent.prototype.auxiliaryDatas;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.containerWidthRecord;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.needResponseChanges;
    /** @type {?} */
    ResponseToolbarComponent.prototype.referEl;
    /** @type {?} */
    ResponseToolbarComponent.prototype.dpState;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype._auxiliary;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype._selfEl;
    /** @type {?} */
    ResponseToolbarComponent.prototype.resizeGroups;
    /** @type {?} */
    ResponseToolbarComponent.prototype.toolbarDatas;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.distanceThreshold;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.isUpdateTBView;
    /** @type {?} */
    ResponseToolbarComponent.prototype._stateDatas;
    /** @type {?} */
    ResponseToolbarComponent.prototype._btnVisibleDatas;
    /** @type {?} */
    ResponseToolbarComponent.prototype.clickThrottleTime;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.clickItems;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.clickSubscription;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.rtSize;
    /** @type {?} */
    ResponseToolbarComponent.prototype.popDirection;
    /** @type {?} */
    ResponseToolbarComponent.prototype.btnAlign;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    ResponseToolbarComponent.prototype.cd;
    /** @type {?} */
    ResponseToolbarComponent.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzcG9uc2UtdG9vbGJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXJlc3BvbnNlLXRvb2xiYXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50L3Jlc3BvbnNlLXRvb2xiYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUVULEtBQUssRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFNBQVMsRUFLVCxpQkFBaUIsRUFDakIsV0FBVyxFQUNYLE1BQU0sRUFDTixZQUFZLEVBQ1osTUFBTSxFQUVULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDSCx1QkFBdUIsRUFDdkIsbUJBQW1CLEVBQ25CLG9CQUFvQixFQUV2QixNQUFNLGlDQUFpQyxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ25FLE9BQU8sRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFpQyxNQUFNLE1BQU0sQ0FBQztBQUMxRSxPQUFPLEVBQWdCLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLGNBQWMsTUFBTSwwQkFBMEIsQ0FBQztBQU90RCxNQUFNLE9BQU8sd0JBQXdCOzs7Ozs7O0lBeUdqQyxZQUNJLEVBQWMsRUFDTixNQUFpQixFQUNqQixFQUFxQixFQUN0QixhQUE0QjtRQUYzQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ3RCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBM0dFLFdBQU0sR0FBRyxJQUFJLENBQUM7UUFDZixVQUFLLEdBQUcsSUFBSSxDQUFDOztRQVlyRCxpQkFBWSxHQUE0QyxJQUFJLFlBQVksRUFFckUsQ0FBQzs7UUFFSixtQkFBYyxHQUFtQyxFQUFFLENBQUM7Ozs7UUFJNUMsT0FB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RDs7Ozs7SUFJcEQsc0NBQXlDOzs7OztJQUV6Qyx3REFBaUM7Ozs7O0lBRWpDLHVEQUFnQzs7SUFDaEMsMkNBQWU7O0lBQ2YsMkNBQWtCOzs7OztJQUVsQiw4Q0FBd0I7Ozs7O0lBQ3hCLDJDQUE2Qjs7SUFDN0IsZ0RBQStDOztJQUUvQyxnREFBd0U7Ozs7O0lBZXhFLHFEQUErQjs7Ozs7SUFDL0Isa0RBQStCOztJQVcvQiwrQ0FBb0Q7O0lBTXBELG9EQUF5RDs7SUFNekQscURBQWlDOzs7OztJQUNqQyw4Q0FBd0M7Ozs7O0lBQ3hDLHFEQUF3Qzs7Ozs7SUFDeEMsMENBQW9COztJQXdCcEIsZ0RBQTJCOztJQUUzQiw0Q0FBNEI7Ozs7O0lBQzVCLDBDQUFzQjs7Ozs7SUFHbEIsMENBQXlCOzs7OztJQUN6QixzQ0FBNkI7O0lBQzdCLGlEQUFtQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsXHJcbiAgICBPbkluaXQsXHJcbiAgICBJbnB1dCxcclxuICAgIFZpZXdDaGlsZCxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBSZW5kZXJlcjIsXHJcbiAgICBBZnRlclZpZXdJbml0LFxyXG4gICAgRG9DaGVjayxcclxuICAgIEFmdGVyVmlld0NoZWNrZWQsXHJcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICAgIENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgSG9zdEJpbmRpbmcsXHJcbiAgICBPdXRwdXQsXHJcbiAgICBFdmVudEVtaXR0ZXIsXHJcbiAgICBOZ1pvbmUsXHJcbiAgICBPbkRlc3Ryb3lcclxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQge1xyXG4gICAgUmVzcG9uc2VUb29sYmFyRHJvcERvd24sXHJcbiAgICBSZXNwb25zZVRvb2xiYXJJdGVtLFxyXG4gICAgUmVzcG9uc2VUb29sYmFyR3JvdXAsXHJcbiAgICBSZXNwb25zZVRvb2xiYXJDbGlja0V2ZW50XHJcbn0gZnJvbSBcIi4uL21vZGVsL3Jlc3BvbnNlLXRvb2xiYXIubW9kZWxcIjtcclxuaW1wb3J0IHsgRlJlc2l6ZWREaXJlY3RpdmUgfSBmcm9tIFwiLi4vcmVzaXplZC9mLXJlc2l6ZWQuZGlyZWN0aXZlXCI7XHJcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiwgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgdGhyb3R0bGVUaW1lLCBkZWJvdW5jZVRpbWUgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWxvY2FsZVwiO1xyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSBcInJlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbFwiO1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiBcImYtcmVzcG9uc2UtdG9vbGJhclwiLFxyXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9yZXNwb25zZS10b29sYmFyLmNvbXBvbmVudC5odG1sXCIsXHJcbiAgICBzdHlsZVVybHM6IFtcIi4vcmVzcG9uc2UtdG9vbGJhci5jb21wb25lbnQuY3NzXCJdLFxyXG4gICAgLy8gY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIFJlc3BvbnNlVG9vbGJhckNvbXBvbmVudFxyXG4gICAgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIERvQ2hlY2ssIEFmdGVyVmlld0NoZWNrZWQsIE9uRGVzdHJveSB7XHJcbiAgICBASG9zdEJpbmRpbmcoXCJjbGFzcy5mLXJlc3BvbnNlLXRvb2xiYXJcIikgZnJ0Q2xzID0gdHJ1ZTtcclxuICAgIEBIb3N0QmluZGluZyhcImNsYXNzLnBvc2l0aW9uLXJlbGF0aXZlXCIpIHByQ2xzID0gdHJ1ZTtcclxuICAgIC8vIOWTjeW6lOW8j+WuueWZqFxyXG4gICAgQFZpZXdDaGlsZChcInJlc2l6ZWRDb250YWluZXJcIikgcmVzaXplZENvbnRhaW5lckVsO1xyXG4gICAgLy8g6L6F5Yqp6K6h566X5a655ZmoXHJcbiAgICBAVmlld0NoaWxkKFwiYXV4aWxpYXJ5Q29udGFpbmVyXCIpIGF1eGlsaWFyeUNvbnRhaW5lckVsO1xyXG4gICAgLy8g5ZON5bqU5byP5YaF5a655a655ZmoXHJcbiAgICBAVmlld0NoaWxkKFwicmVzaXplZENvbnRlbnRcIikgcmVzaXplZENvbnRlbnRFbDtcclxuICAgIC8vXHJcbiAgICBAVmlld0NoaWxkKFwicmVzaXplZENvbnRhaW5lclwiLCB7IHJlYWQ6IEZSZXNpemVkRGlyZWN0aXZlIH0pXHJcbiAgICByZXNpemVkQ29udGFpbmVyRGlyZWN0aXZlOiBGUmVzaXplZERpcmVjdGl2ZTtcclxuICAgIC8vIOS8oOmAkueCueWHu+S6i+S7tlxyXG4gICAgQE91dHB1dCgpXHJcbiAgICBydENsaWNrRXZlbnQ6IEV2ZW50RW1pdHRlcjxSZXNwb25zZVRvb2xiYXJDbGlja0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8XHJcbiAgICAgICAgUmVzcG9uc2VUb29sYmFyQ2xpY2tFdmVudFxyXG4gICAgPigpO1xyXG4gICAgLy8g6L6F5Yqp6K6h566X5a695bqm5pWw5o2uXHJcbiAgICBhdXhpbGlhcnlEYXRhczogQXJyYXk8UmVzcG9uc2VUb29sYmFyRHJvcERvd24+ID0gW107XHJcbiAgICAvLyDmjqfliLbniLblhYPntKDmu5rliqjnmoTmoLflvI9cclxuICAgIC8vICBwcml2YXRlIF9kcFN0YXRlID0gZmFsc2U7XHJcbiAgICAvL1xyXG4gICAgcHJpdmF0ZSBybzogUmVzaXplT2JzZXJ2ZXIgfCBudWxsID0gbnVsbDtcclxuICAgIC8vIOiusOW9leWuueWZqOWuveW6plxyXG4gICAgcHJpdmF0ZSBjb250YWluZXJXaWR0aFJlY29yZCA9IDA7XHJcbiAgICAvLyDorrDlvZXlj5jljJZcclxuICAgIHByaXZhdGUgbmVlZFJlc3BvbnNlQ2hhbmdlcyA9IDA7XHJcbiAgICByZWZlckVsID0gbnVsbDtcclxuICAgIGRwU3RhdGUgPSBbZmFsc2VdO1xyXG4gICAgLy8g55So5p2l5YaF6YOo6K6w5b2VXHJcbiAgICBwcml2YXRlIF9hdXhpbGlhcnkgPSAtMTtcclxuICAgIHByaXZhdGUgX3NlbGZFbDogSFRNTEVsZW1lbnQ7XHJcbiAgICByZXNpemVHcm91cHM6IEFycmF5PFJlc3BvbnNlVG9vbGJhckdyb3VwPiA9IFtdO1xyXG4gICAgLy8g6K6w5b2V5qC85byP5YyW5ZCO55qE5pWw5o2uXHJcbiAgICB0b29sYmFyRGF0YXM6IEFycmF5PFJlc3BvbnNlVG9vbGJhckl0ZW0gfCBSZXNwb25zZVRvb2xiYXJEcm9wRG93bj4gPSBbXTtcclxuICAgIC8vIOWGhemDqOiusOW9leagvOW8j+WMluWQjueahOWIneWni+aVsOaNri0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS3mmoLml7bkuI3nlKhcclxuICAgIC8vIF90b29sYmFyRGF0YXM6IEFycmF5PFJlc3BvbnNlVG9vbGJhckl0ZW0gfCBSZXNwb25zZVRvb2xiYXJEcm9wRG93bj4gPSBbXTtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgZ3JvdXBzKHZhbHVlczogQXJyYXk8UmVzcG9uc2VUb29sYmFyR3JvdXA+KSB7XHJcbiAgICAgICAgaWYgKHZhbHVlcykge1xyXG4gICAgICAgICAgICB0aGlzLnJlc2l6ZUdyb3VwcyA9IFtdO1xyXG4gICAgICAgICAgICB2YWx1ZXMuZm9yRWFjaChncm91cCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZUdyb3Vwcy5wdXNoKFxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBSZXNwb25zZVRvb2xiYXJHcm91cChncm91cC5pZCwgZ3JvdXAubmFtZSlcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAvLyDov5jmsqHmnInorqHnrpfpooTnva7mjpLluo9cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBkaXN0YW5jZVRocmVzaG9sZCA9IDIwO1xyXG4gICAgcHJpdmF0ZSBpc1VwZGF0ZVRCVmlldyA9IGZhbHNlO1xyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgZGF0YXModmFsdWVzOiBBcnJheTxSZXNwb25zZVRvb2xiYXJJdGVtIHwgUmVzcG9uc2VUb29sYmFyRHJvcERvd24+KSB7XHJcbiAgICAgICAgaWYgKHZhbHVlcykge1xyXG4gICAgICAgICAgICB0aGlzLnRvb2xiYXJEYXRhcyA9IHRoaXMuX2Zvcm1hdERhdGEodmFsdWVzKTtcclxuICAgICAgICAgICAgdGhpcy5uZWVkUmVzcG9uc2VDaGFuZ2VzKys7XHJcbiAgICAgICAgICAgIC8vIOWkhOeQhuWIhue7hOaVsOaNrlxyXG4gICAgICAgICAgICB0aGlzLl9yZU9yZ2FuaXplUmVzaXplR3JvdXBzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX3N0YXRlRGF0YXM6IE9ic2VydmFibGU8QXJyYXk8YW55Pj4gPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgLy8g5oyJ6ZKu55qE56aB55So54q25oCBXHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGJ0blN0YXRlKHZhbHVlczogT2JzZXJ2YWJsZTxBcnJheTxhbnk+Pikge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlRGF0YXMgPSB2YWx1ZXM7XHJcbiAgICB9XHJcbiAgICBfYnRuVmlzaWJsZURhdGFzOiBPYnNlcnZhYmxlPEFycmF5PGFueT4+ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIC8vIOaMiemSrueahOafpeeci+eKtuaAgVxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBidG5WaXNpYmxlKHZhbHVlczogT2JzZXJ2YWJsZTxBcnJheTxhbnk+Pikge1xyXG4gICAgICAgIHRoaXMuX2J0blZpc2libGVEYXRhcyA9IHZhbHVlcztcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIGNsaWNrVGhyb3R0bGVUaW1lID0gMzUwO1xyXG4gICAgcHJpdmF0ZSBjbGlja0l0ZW1zID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjbGlja1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBydFNpemUgPSBcIlwiO1xyXG4gICAgLyrlsLrlr7jvvJrmnIlzbSxsZyznqbrlgLzvvIzpu5jorqTmmK/nqbrlgLwgKi9cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgYnV0dG9uU2l6ZShidG5TaXplOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoYnRuU2l6ZSAhPSB0aGlzLnJ0U2l6ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJ0U2l6ZSAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3MoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZkVsLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiZi1yZXNwb25zZS10b29sYmFyLVwiICsgdGhpcy5ydFNpemVcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMucnRTaXplID0gYnRuU2l6ZTtcclxuICAgICAgICAgICAgdGhpcy5ydFNpemUgJiZcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGZFbCxcclxuICAgICAgICAgICAgICAgICAgICBcImYtcmVzcG9uc2UtdG9vbGJhci1cIiArIHRoaXMucnRTaXplXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBidXR0b25TaXplKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnRTaXplO1xyXG4gICAgfVxyXG4gICAgLyrlvLrliLbmlrnlkJHvvIzpu5jorqTkuLrnqbrlgLzvvIzlj6/ku6XmnIl0b3DjgIFib3R0b23vvIzmnJ3kuIrjgIHmnJ3kuIvjgIJcclxuICAgICAqIOS9v+eUqOWcuuaZr++8muW3peWFt+agj+WGhemDqOeahOS4i+aLie+8jOmcgOimgeacneS4iuaIluiAhemcgOimgeacneS4i+WxleW8gO+8jOe7n+S4gOaOp+WItlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBwb3BEaXJlY3Rpb24gPSBcIlwiO1xyXG4gICAgLy8gcmlnaHTmjInpkq7pnaDlj7MgbGVmdOaMiemSrumdoOW3plxyXG4gICAgQElucHV0KCkgYnRuQWxpZ24gPSBcInJpZ2h0XCI7XHJcbiAgICBwcml2YXRlIG5nWm9uZSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgIHB1YmxpYyBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlXHJcbiAgICApIC8vIHByaXZhdGUgbmdab25lOiBOZ1pvbmVcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9zZWxmRWwgPSBlbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIGlmIChlbC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWZlckVsID0gZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIOWboOS4uuaXp+aooeadv+W4puaciei/meS4quaWueazlVxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge31cclxuICAgIC8vIOWboOS4uuaXp+aooeadv+W4puaciei/meS4quaWueazlVxyXG4gICAgbmdEb0NoZWNrKCkge31cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIC8vIOWOu+aOiW92ZXJmbG935LmL5ZCOXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3MoXHJcbiAgICAgICAgICAgIHRoaXMuYXV4aWxpYXJ5Q29udGFpbmVyRWwubmF0aXZlRWxlbWVudCxcclxuICAgICAgICAgICAgXCJyZXNwb25zZS10b29sYmFyLWhpZGRlbi1lbGVtZW50XCJcclxuICAgICAgICApO1xyXG4gICAgICAgIC8vIOaMiemSrueahOemgeeUqOeKtuaAgVxyXG4gICAgICAgIHRoaXMuX3N0YXRlRGF0YXMuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIOaMiemSrueahOWPr+ingeeKtuaAgVxyXG4gICAgICAgIHRoaXMuX2J0blZpc2libGVEYXRhcy5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlVmlzaWJsZShkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyRWxlbWVudCgpO1xyXG4gICAgICAgIC8vIOaLpuaIqueCueWHu+S6i+S7tuWPquS8oOmAkuesrOS4gOasoeeCueWHu+S6i+S7tueahOWkhOeQhuaTjeS9nOS6pOe7mXBhcmVudOadpeWkhOeQhlxyXG4gICAgICAgIHRoaXMuY2xpY2tTdWJzY3JpcHRpb24gPSB0aGlzLmNsaWNrSXRlbXNcclxuICAgICAgICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKHRoaXMuY2xpY2tUaHJvdHRsZVRpbWUpKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChldmVudERhdGFzOiBSZXNwb25zZVRvb2xiYXJDbGlja0V2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJ0Q2xpY2tFdmVudC5lbWl0KGV2ZW50RGF0YXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJvKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm8udW5vYnNlcnZlKHRoaXMucmVzaXplZENvbnRhaW5lckVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnJvID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubmVlZFJlc3BvbnNlQ2hhbmdlcyA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmVlZFJlc3BvbnNlQ2hhbmdlcy0tO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXNwb25zZVJlc2l6ZSgpO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLmF1eGlsaWFyeURhdGFzLmxlbmd0aD4wKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jYWxjdWxhdGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmF1eGlsaWFyeUNvbnRhaW5lckVsLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGhcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIOWboOS4uuaXp+aooeadv+W4puaciei/meS4quaWueazlVxyXG4gICAgb25SZXNpemUoZXZlbnQpIHt9XHJcbiAgICAvKipcclxuICAgICAqIOWFvOWuueaXp+aooeadv+aXp+aWueazlVxyXG4gICAgICog5Zyo5LiN5a2Y5Zyobmdab25l55qE5oOF5Ya15LiL77yM5Yib5bu6bmdab25lLOeEtuWQjue7keWumuS6i+S7tlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG9ic2VydmVyRWxlbWVudCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMubmdab25lKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZHVsZUluamVjdG9yID0gdGhpcy5jZFtcIl92aWV3XCJdLnJvb3QubmdNb2R1bGUuaW5qZWN0b3I7XHJcbiAgICAgICAgICAgIHRoaXMubmdab25lID0gbW9kdWxlSW5qZWN0b3IuZ2V0PE5nWm9uZT4oTmdab25lLCBudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5ybyA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcywgb2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBXaWR0aCA9IGVudHJpZXNbMF0uY29udGVudFJlY3Qud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnModGVtcFdpZHRoIC0gdGhpcy5jb250YWluZXJXaWR0aFJlY29yZCkgPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3RhbmNlVGhyZXNob2xkXHJcbiAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlUmVzaXplKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJXaWR0aFJlY29yZCA9IHRlbXBXaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMucm8ub2JzZXJ2ZSh0aGlzLnJlc2l6ZWRDb250YWluZXJFbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5by65Yi26L2s5o2i5pa55ZCRXHJcbiAgICAgKiBAcGFyYW0gc2VsZkRlZmluZVBMXHJcbiAgICAgKiBAcGFyYW0gZGVmYXVsdFBMXHJcbiAgICAgKi9cclxuICAgIGdldFBsYWNlbWVudChzZWxmRGVmaW5lUEw6IHN0cmluZywgZGVmYXVsdFBMOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBvbGREaXJlY3Rpb24gPSBzZWxmRGVmaW5lUEwgPyBzZWxmRGVmaW5lUEwgOiBkZWZhdWx0UEw7XHJcbiAgICAgICAgaWYgKCF0aGlzLnBvcERpcmVjdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gb2xkRGlyZWN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcGxSZWxhdGlvbiA9IHsgYm90dG9tOiBcInRvcFwiLCB0b3A6IFwiYm90dG9tXCIgfTtcclxuICAgICAgICBvbGREaXJlY3Rpb24gPSBvbGREaXJlY3Rpb24gPT0gXCJsZWZ0XCIgPyBcImxlZnQtYm90dG9tXCIgOiBvbGREaXJlY3Rpb247XHJcbiAgICAgICAgb2xkRGlyZWN0aW9uID0gb2xkRGlyZWN0aW9uID09IFwicmlnaHRcIiA/IFwicmlnaHQtYm90dG9tXCIgOiBvbGREaXJlY3Rpb247XHJcbiAgICAgICAgbGV0IG5ld0RpcmVjdGlvbiA9IG9sZERpcmVjdGlvbi5yZXBsYWNlKFxyXG4gICAgICAgICAgICBwbFJlbGF0aW9uW3RoaXMucG9wRGlyZWN0aW9uXSxcclxuICAgICAgICAgICAgdGhpcy5wb3BEaXJlY3Rpb25cclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBuZXdEaXJlY3Rpb247XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDosIPnlKjmraTmlrnms5XnmoTlnLrmma9cclxuICAgICAqIDHjgIHnlYzpnaLmi5bmi73oh6rliqjop6blj5FcclxuICAgICAqIDLjgIHmmL7npLrosIPnlKhcclxuICAgICAqL1xyXG4gICAgcmVzcG9uc2VSZXNpemUoKSB7XHJcbiAgICAgICAgY29uc3QgX2Rpc3RhbmNlID0gdGhpcy5fZ2V0RGlzdGFuY2UoKTtcclxuICAgICAgICBpZiAoX2Rpc3RhbmNlID4gMCkge1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzliIbnu4Tpg73lt7Lnu4/lpITnkIblrows5YaN5Ye6546w5rua5Yqo5p2h5LiN566hXHJcbiAgICAgICAgICAgIGNvbnN0IF90ZW1wSW5kZXggPSB0aGlzLl9nZXRGaXJzdFVuUmVzcG9uc2VkSW5kZXgoKTtcclxuICAgICAgICAgICAgaWYgKF90ZW1wSW5kZXggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5omA5pyJ56ys5LiA5bGC5LiL5ouJ6YO95Y+O5oqYXHJcbiAgICAgICAgICAgIHRoaXMuZHBTdGF0ZSA9IFtmYWxzZV07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGsgPSBfdGVtcEluZGV4OyBrIDwgdGhpcy5yZXNpemVHcm91cHMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF90ZW1wR3JvdXAgPSB0aGlzLnJlc2l6ZUdyb3Vwc1trXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2F1eGlsaWFyeSA9IGs7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RlbXBHcm91cC5pc1Jlc3BvbnNpbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzov5jmnKrlvIDlp4vlpITnkIblk43lupTlvI9cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfdGVtcERQID0gbmV3IFJlc3BvbnNlVG9vbGJhckRyb3BEb3duKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RlbXBHcm91cC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogX3RlbXBHcm91cC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50OiB0aGlzLnBvcERpcmVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLnBvcERpcmVjdGlvbiArIFwiLWxlZnRcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBcImJvdHRvbS1sZWZ0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBfdGVtcEdyb3VwLmdldFdpZHRoKClcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlt7Lnu4/lpITnkIbov4flrr3luqZcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX3RlbXBEUC5nZXRXaWR0aCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXV4aWxpYXJ5RGF0YXMgPSBbX3RlbXBEUF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZSh0cnVlLCBfdGVtcERQLmdldFdpZHRoKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsOi+heWKqeaVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1eGlsaWFyeURhdGFzLnB1c2goX3RlbXBEUCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOWvu+aJvuacgOWQjuS4gOS4quWkhOeQhuWTjeW6lOW8j+eahOWFg+e0oFxyXG4gICAgICAgICAgICBjb25zdCBfdGVtcEluZGV4ID0gdGhpcy5fZ2V0TGFzdFJlc3BvbnNlSW5kZXgoKTtcclxuICAgICAgICAgICAgaWYgKF90ZW1wSW5kZXggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5Li05pe25a2Y5YKo5pWw5o2uXHJcbiAgICAgICAgICAgIGxldCBfdGVtcFRvb2xiYXJEYXRhcyA9IFtdLmNvbmNhdCh0aGlzLnRvb2xiYXJEYXRhcyk7XHJcbiAgICAgICAgICAgIC8vIOWmguaenOW3sue7j+W8gOWni+WkhOeQhuWTjeW6lOW8j1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrID0gX3RlbXBJbmRleDsgayA+PSAwOyBrLS0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX3Jlc3RpdHV0ZShfdGVtcFRvb2xiYXJEYXRhcywgayk7XHJcbiAgICAgICAgICAgICAgICBfdGVtcFRvb2xiYXJEYXRhcyA9IFtdLmNvbmNhdChyZXN1bHRbXCJkYXRhXCJdKTtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0W1wiY29udGludWVUb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOabtOaWsOaVsOaNrlxyXG4gICAgICAgICAgICB0aGlzLnRvb2xiYXJEYXRhcyA9IFtdLmNvbmNhdChfdGVtcFRvb2xiYXJEYXRhcyk7XHJcbiAgICAgICAgICAgIC8vIOaJgOacieesrOS4gOWxguS4i+aLiemDveWPjuaKmFxyXG4gICAgICAgICAgICB0aGlzLmRwU3RhdGUgPSBbZmFsc2VdO1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDkuIvmi4nnmoTlsZXlvIDmlLbotbfnirbmgIFcclxuICAgIGRwU2VjdGlvblN0YXRlKHN0YXRlOiBib29sZWFuLCBpZCkge1xyXG4gICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAvLyDlsZXlvIDnirbmgIHkuItcclxuICAgICAgICAgICAgbGV0IGRyb3Bkb3ducyA9IHRoaXMucmVzaXplZENvbnRlbnRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXHJcbiAgICAgICAgICAgICAgICBcIltmRHJvcGRvd25dXCJcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKGRyb3Bkb3ducyAmJiBkcm9wZG93bnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBkcm9wZG93bnMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duc1trXS5jbGFzc05hbWUuaW5kZXhPZihcInNob3dcIikgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcGRvd25zW2tdLmlkICE9IGlkXHJcbiAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRyb3Bkb3duc1trXS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnc2VsZkNsb3NlJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBhdGlibGVEaXNwYXRjaEV2ZW50KGRyb3Bkb3duc1trXSwgXCJzZWxmQ2xvc2VcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBjb21wYXRpYmxlRGlzcGF0Y2hFdmVudChldmVudEVsLCBldmVudE5hbWUpIHtcclxuICAgICAgICB2YXIgZXZlbnQ7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBFdmVudCA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgIGV2ZW50ID0gbmV3IEV2ZW50KGV2ZW50TmFtZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudChcIkV2ZW50XCIpO1xyXG4gICAgICAgICAgICBldmVudC5pbml0RXZlbnQoZXZlbnROYW1lLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBldmVudEVsLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xyXG4gICAgfVxyXG4gICAgLy8g5L+u5pS55ZCv55So56aB55So54q25oCBXHJcbiAgICBjaGFuZ2VTdGF0ZSh2YWx1ZXMpIHtcclxuICAgICAgICBjb25zdCBpZEFycmF5ID0gT2JqZWN0LmtleXModmFsdWVzKTtcclxuICAgICAgICBpZEFycmF5LmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHZhbHVlc1tpZF07XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9maW5kSXRlbUJ5SUQoaWQsIHRoaXMudG9vbGJhckRhdGFzKTtcclxuICAgICAgICAgICAgaWYoaXRlbSl7XHJcbiAgICAgICAgICAgICAgICAgaXRlbVtcImRpc2FibGVkXCJdID0gc3RhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5L+u5pS55pi+56S654q25oCBXHJcbiAgICAgKiDlpoLmnpzmmK/kuIvmi4nmjInpkq5cclxuICAgICAqICAg5Yik5pat5LiL6Z2i55qE5a2Q5piv5ZCm6YO96ZqQ6JePXHJcbiAgICAgKiBAcGFyYW0gdmFsdWVzXHJcbiAgICAgKi9cclxuICAgIGNoYW5nZVZpc2libGUodmFsdWVzKSB7XHJcbiAgICAgICAgY29uc3QgaWRBcnJheSA9IE9iamVjdC5rZXlzKHZhbHVlcyk7XHJcbiAgICAgICAgaWRBcnJheS5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmlzaWJsZSA9IHZhbHVlc1tpZF07XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9maW5kSXRlbUJ5SUQoaWQsIHRoaXMudG9vbGJhckRhdGFzKTtcclxuICAgICAgICAgICAgaWYoaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBpdGVtW1widmlzaWJsZVwiXSA9IHZpc2libGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyDpgY3ljoblvqrnjq8s5pu05paw5pWw5o2uXHJcbiAgICAgICAgdGhpcy50b29sYmFyRGF0YXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgLy8g5aaC5p6c5piv5LiL5ouJXHJcbiAgICAgICAgICAgIGlmIChpdGVtW1wiaXNEUFwiXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tEcm9wZG93blZpc2libGUodmFsdWVzLCBpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMubmVlZFJlc3BvbnNlQ2hhbmdlcysrO1xyXG4gICAgICAgIC8vIOabtOaWsFxyXG4gICAgICAgLy90aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWmguaenOaYr+S4i+aLieaMiemSrlxyXG4gICAgICogICDliKTmlq3kuIvpnaLnmoTlrZDmmK/lkKbpg73pmpDol49cclxuICAgICAqICAgICAgIEEuIOWmguaenOWtkOmDvemakOiXj++8jOmCo+S5iOaVtOS4quS4i+aLiemDveiiq+makOiXj++8m1xyXG4gICAgICogICAgICAgQi4g5aaC5p6c5a2Y5Zyo5a2Q5rKh5pyJ6ZqQ6JeP77yM6ICM5LiU5LiL5ouJ5rKh5pyJ6KKr6aKE572u6ZqQ6JeP77yM5LiL5ouJ5oyJ6ZKu5pi+56S6XHJcbiAgICAgKiBAcGFyYW0gb3V0c2lkZVZpc2libGVBcnJheXMg5LuO57uE5Lu25aSW5Lyg5YWl55qE5Y+v6KeB54q25oCB5a+56LGhXHJcbiAgICAgKiBAcGFyYW0gZHJvcGRvd25JdGVtIOS4i+aLieWFg+e0oFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9jaGVja0Ryb3Bkb3duVmlzaWJsZShvdXRzaWRlVmlzaWJsZUFycmF5cywgZHJvcGRvd25JdGVtKTogdm9pZCB7XHJcbiAgICAgICAgLy/lpoLmnpzmsqHmnInooqvlvLrliLborr7nva7nirbmgIFcclxuICAgICAgICBpZiAoIW91dHNpZGVWaXNpYmxlQXJyYXlzLmhhc093blByb3BlcnR5KGRyb3Bkb3duSXRlbVtcImlkXCJdKSkge1xyXG4gICAgICAgICAgICAvLyDkuIvmi4nlhYPntKDkuI3lj6/op4HvvIzliKTmlq3mmK/lkKbmnInlj6/op4HlrZDlhYPntKBcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgIWRyb3Bkb3duSXRlbVtcInZpc2libGVcIl0gJiZcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hhc1Zpc2libGVJdGVtKGRyb3Bkb3duSXRlbVtcImNoaWxkcmVuXCJdLCB0cnVlKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duSXRlbVtcInZpc2libGVcIl0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOS4i+aLieWFg+e0oOaYr+WPr+inge+8jOWIpOaWreaYr+WQpuacieWtkOWFg+e0oOmDveS4jeWPr+ingVxyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bkl0ZW1bXCJ2aXNpYmxlXCJdICYmXHJcbiAgICAgICAgICAgICAgICAhdGhpcy5faGFzVmlzaWJsZUl0ZW0oZHJvcGRvd25JdGVtW1wiY2hpbGRyZW5cIl0sIHRydWUpXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd25JdGVtW1widmlzaWJsZVwiXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRyb3Bkb3duSXRlbS5jaGlsZHJlbi5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbVtcImlzRFBcIl0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrRHJvcGRvd25WaXNpYmxlKG91dHNpZGVWaXNpYmxlQXJyYXlzLCBpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDlnKjlvoXmo4Dmn6XmlbDmja7kuK3lv4PvvIzmo4Dmn6XmmK/lkKblrZjlnKjor6Xlj6/op4HnirbmgIHnmoTmlbDmja7jgIJcclxuICAgICAqIOWmguaenOaciei/lOWbnnRydWUs5ZCm5YiZ6L+U5ZueZmFsc2VcclxuICAgICAqIEBwYXJhbSBkYXRhcyDlvoXmo4Dmn6XmlbDmja5cclxuICAgICAqIEBwYXJhbSB2aXNpYmxlIOWPr+ingeeKtuaAgVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9oYXNWaXNpYmxlSXRlbShkYXRhcywgdmlzaWJsZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IGZpbmRJbmRleCA9IGRhdGFzLmZpbmRJbmRleChjaGlsZEl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRJdGVtW1widmlzaWJsZVwiXSA9PSB2aXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGZpbmRJbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmjZXojrfngrnlh7tcclxuICAgICAqIEBwYXJhbSBldlxyXG4gICAgICovXHJcbiAgICBjbGlja0l0ZW0oZXY6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAvLyDlpoLmnpzmmK/liIbnprvnmoTkuIvmi4nmjInpkq5cclxuICAgICAgICBpZiAodGhpcy5lbGhhc1NwZWNpYWxDbHMoZXYudGFyZ2V0LCBcImRyb3Bkb3duLXRvZ2dsZS1zcGxpdFwiKSkge1xyXG4gICAgICAgICAgICBldi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5Yik5pat5piv5ZCm54K55Ye75Yiw6ZyA6KaB5aSE55CG5LqL5Lu255qE5YWD57Sg5LiKLOaMiemSruOAgeS4i+aLieaMiemSrlxyXG4gICAgICAgIHZhciBjbGlja0V2RWwgPSB0aGlzLmZpbmRCdG5PclRvZ2dsZXJJdGVtRnJvbUNsaWNrKGV2LnRhcmdldCk7XHJcbiAgICAgICAgaWYgKGNsaWNrRXZFbCkge1xyXG4gICAgICAgICAgICBsZXQgdGVtcElEID0gY2xpY2tFdkVsW1wiaWRcIl07XHJcbiAgICAgICAgICAgIC8vIOS/ruaUueaooeadv++8jGlk6LCD5pW05Yiw5LiL5ouJ5pW05L2T5LiKXHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICF0ZW1wSUQgJiZcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxoYXNTcGVjaWFsQ2xzKGNsaWNrRXZFbFtcInBhcmVudE5vZGVcIl0sIFwiZi1ydC1kcm9wZG93blwiKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHRlbXBJRCA9IGNsaWNrRXZFbFtcInBhcmVudE5vZGVcIl0uaWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRlbXBJRCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcEl0ZW0gPSB0aGlzLl9maW5kSXRlbUJ5SUQodGVtcElELCB0aGlzLnRvb2xiYXJEYXRhcyk7XHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzlhYPntKDnpoHnlKhcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1wSXRlbVtcImRpc2FibGVkXCJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g56aB5q2i5ZCR5LiK5Lyg6YCSXHJcbiAgICAgICAgICAgICAgICAgICAgZXYuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpY2tJdGVtcy5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRlbXBJRCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGVtcEl0ZW1bXCJ0ZXh0XCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHRlbXBJdGVtW1wiaGlkZGVuXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBldi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGZpbmRCdG5PclRvZ2dsZXJJdGVtRnJvbUNsaWNrKGNsaWNrVGFyZ2V0KSB7XHJcbiAgICAgICAgLy8g54i257qn5qCH562+5piv5ZCm5pivYm9keSzmmK/nnYDlgZzmraLov5Tlm57pm4blkIgs5Y+N5LmL57un57utXHJcbiAgICAgICAgaWYgKHRoaXMuZWxoYXNTcGVjaWFsQ2xzKGNsaWNrVGFyZ2V0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2xpY2tUYXJnZXQ7XHJcbiAgICAgICAgfSBlbHNlIGlmIChcclxuICAgICAgICAgICAgY2xpY2tUYXJnZXQucGFyZW50Tm9kZS5oYXNPd25Qcm9wZXJ0eShcImNsYXNzTmFtZVwiKSAmJlxyXG4gICAgICAgICAgICBjbGlja1RhcmdldC5wYXJlbnROb2RlLmNsYXNzTmFtZS5pbmRleE9mKFwiZi1yZXNwb25zZS1jb250ZW50XCIpIDwgMFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICB2YXIgcGFyZW50TiA9IGNsaWNrVGFyZ2V0LnBhcmVudE5vZGU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVsaGFzU3BlY2lhbENscyhwYXJlbnROKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudE47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maW5kQnRuT3JUb2dnbGVySXRlbUZyb21DbGljayhwYXJlbnROKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDov5Tlm57pm4blkIgs57uT5p2fXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGVsaGFzU3BlY2lhbENscyhlbCwgY2xzTmFtZSA9IFwiXCIpIHtcclxuICAgICAgICBpZiAoZWwpIHtcclxuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZUxpc3QgPSBlbC5jbGFzc0xpc3Q7XHJcbiAgICAgICAgICAgIHZhciBmaW5kQ2xzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgY2xhc3NOYW1lTGlzdC5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNsc05hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lTGlzdFtrXSA9PSBjbHNOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmRDbHMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lTGlzdFtrXSA9PSBcImYtcnQtYnRuXCIgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lTGlzdFtrXSA9PSBcImYtcnQtdG9nZ2xlXCJcclxuICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmluZENscyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmluZENscztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7kvKDpgJLnmoTmlbDmja7ph43mlrDnu4Tlu7rliIbnu4RcclxuICAgICAqIFRvRG8g5pqC5pe25rKh5pyJ5pu05aSN5p2C55qE5YiG57uE77yM5ZCm5YiZ6ZyA6KaB6K6w5b2V5YiG57uEXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX3JlT3JnYW5pemVSZXNpemVHcm91cHMoKSB7XHJcbiAgICAgICAgLy8g5aSE55CG5YiG57uE5pWw5o2uXHJcbiAgICAgICAgLy8gIGlmICh0aGlzLnJlc2l6ZUdyb3Vwcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBsZXQgbW9yZVRleHQgPSBcIuabtOWkmlwiO1xyXG4gICAgICAgIGlmICh0aGlzLmxvY2FsZVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgbW9yZVRleHQgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoXCJyZXNwb25zZVRvb2xiYXIubW9yZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGVmYXVsdFJlc2l6ZUdyb3VwID0gbmV3IFJlc3BvbnNlVG9vbGJhckdyb3VwKFxyXG4gICAgICAgICAgICBcInRvb2xiYXItZ3JvdXAtMVwiLFxyXG4gICAgICAgICAgICBtb3JlVGV4dFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMudG9vbGJhckRhdGFzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRSZXNpemVHcm91cC5zZXRQcmVzZXQodGhpcy50b29sYmFyRGF0YXNbaV1bXCJpZFwiXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVzaXplR3JvdXBzID0gW10uY29uY2F0KGRlZmF1bHRSZXNpemVHcm91cCk7XHJcbiAgICAgICAvLyB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDlhoXlrrnkuI7lrrnlmajnmoTlt67lgLxcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfZ2V0RGlzdGFuY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgdGhpcy5yZXNpemVkQ29udGVudEVsLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLVxyXG4gICAgICAgICAgICB0aGlzLnJlc2l6ZWRDb250YWluZXJFbC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u6L+U5Zue57uT5p6c5Yik5pat5piv5ZCm57un57utXHJcbiAgICAgKiBAcGFyYW0gZ3JvdXBJbmRleFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9yZXN0aXR1dGUob3JpZ2luYWxEYXRhLCBncm91cEluZGV4KSB7XHJcbiAgICAgICAgY29uc3QgdGVtcEdyb3VwID0gdGhpcy5yZXNpemVHcm91cHNbZ3JvdXBJbmRleF07XHJcbiAgICAgICAgLy8g5rua5Yqo5p2h5ZKM5YaF5a6555qE6Led56a7XHJcbiAgICAgICAgbGV0IHRlbXBEaXN0YW5jZSA9IHRoaXMuX2dldERpc3RhbmNlKCk7XHJcbiAgICAgICAgLy8g6K6h566X5pyA5ZCO5LiA5Liq5LiL5ouJ55qE5a695bqmXHJcbiAgICAgICAgY29uc3QgdGVtcEdyb3VwRGF0YSA9XHJcbiAgICAgICAgICAgIG9yaWdpbmFsRGF0YVt0aGlzLl9maW5kSW5kZXhCeUlEKG9yaWdpbmFsRGF0YSwgdGVtcEdyb3VwLmlkKV07XHJcbiAgICAgICAgLy8g5om+5Yiw6L+Y5Y6f55qE5L2N572uXHJcbiAgICAgICAgY29uc3QgdGVtcFByZXNldEluZGV4ID0gW10uY29uY2F0KHRlbXBHcm91cC5yZXNwb25zZWRJbmRleCk7XHJcbiAgICAgICAgLy8g5o6S6Zmk5Y6f5LiL5ouJ5a2Q5YWD57Sg6KKr6K6h566XXHJcbiAgICAgICAgZm9yIChsZXQgaiA9IHRlbXBQcmVzZXRJbmRleC5sZW5ndGggLSAxOyBqID49IDA7IGotLSkge1xyXG4gICAgICAgICAgICBpZiAodGVtcERpc3RhbmNlID49IDApIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOS7juS4i+aLieS4reenu+mZpFxyXG4gICAgICAgICAgICBjb25zdCB0ZW1wQ2hpbGREYXRhID0gdGVtcEdyb3VwRGF0YS5jaGlsZHJlblswXTtcclxuICAgICAgICAgICAgY29uc3Qgc3BlY2lhbERpc3RhbmNlID0gaiA9PT0gMCA/IHRlbXBHcm91cERhdGEuZ2V0V2lkdGgoKSA6IDA7XHJcblxyXG4gICAgICAgICAgICB0ZW1wRGlzdGFuY2UgPVxyXG4gICAgICAgICAgICAgICAgdGVtcERpc3RhbmNlICtcclxuICAgICAgICAgICAgICAgICh0ZW1wQ2hpbGREYXRhLmdldFdpZHRoKCkgPyB0ZW1wQ2hpbGREYXRhLmdldFdpZHRoKCkgOiAwKSAtXHJcbiAgICAgICAgICAgICAgICBzcGVjaWFsRGlzdGFuY2U7XHJcblxyXG4gICAgICAgICAgICBpZiAodGVtcERpc3RhbmNlID49IDApIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw5LiL5ouJXHJcbiAgICAgICAgICAgICAgICB0ZW1wR3JvdXBEYXRhLnJlbW92ZUNoaWxkKCk7XHJcbiAgICAgICAgICAgICAgICAvLyDmj5LlhaXliLDljp/kvY3nva5cclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRGF0YS5zcGxpY2UodGVtcFByZXNldEluZGV4W2pdLCAwLCB0ZW1wQ2hpbGREYXRhKTtcclxuICAgICAgICAgICAgICAgIC8vIOabtOaWsOS9jee9rlxyXG4gICAgICAgICAgICAgICAgdGVtcEdyb3VwLnJlbW92ZVJlc3BvbnNlZChqKTtcclxuICAgICAgICAgICAgICAgIGlmIChqID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxEYXRhLnNwbGljZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmluZEluZGV4QnlJRChvcmlnaW5hbERhdGEsIHRlbXBHcm91cC5pZCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDFcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlVG86IHRlbXBEaXN0YW5jZSA+IDAgPyB0cnVlIDogZmFsc2UsXHJcbiAgICAgICAgICAgIGRhdGE6IG9yaWdpbmFsRGF0YVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlvIDlp4vorqHnrpdcclxuICAgICAqIEBwYXJhbSBkYXRhc1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9jYWxjdWxhdGUoYXV4aWxpYXJ5OiBib29sZWFuID0gZmFsc2UsIHRHcm91cFdpZHRoOiBudW1iZXIgPSAwKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2F1eGlsaWFyeSA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDorrDlvZXpnIDopoHkv67mlLnnmoTkuIvmi4lcclxuICAgICAgICBsZXQgdGVtcERQO1xyXG4gICAgICAgIC8vIOa7muWKqOadoeWSjOWGheWuueeahOi3neemu1xyXG4gICAgICAgIGxldCB0ZW1wRGlzdGFuY2UgPSB0aGlzLl9nZXREaXN0YW5jZSgpICsgdEdyb3VwV2lkdGg7XHJcbiAgICAgICAgLy8g5Li05pe25a2Y5YKo5pWw5o2uXHJcbiAgICAgICAgY29uc3QgdGVtcFRvb2xiYXJEYXRhcyA9IFtdLmNvbmNhdCh0aGlzLnRvb2xiYXJEYXRhcyk7XHJcbiAgICAgICAgY29uc3QgdGVtcEdyb3VwID0gdGhpcy5yZXNpemVHcm91cHNbdGhpcy5fYXV4aWxpYXJ5XTtcclxuICAgICAgICBpZiAoYXV4aWxpYXJ5KSB7XHJcbiAgICAgICAgICAgIHRlbXBEUCA9IHRoaXMuYXV4aWxpYXJ5RGF0YXMucG9wKCk7XHJcbiAgICAgICAgICAgIHRlbXBEUC5zZXRXaWR0aCh0R3JvdXBXaWR0aCk7XHJcbiAgICAgICAgICAgIHRlbXBHcm91cC5zZXRXaWR0aCh0R3JvdXBXaWR0aCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGVtcERQID1cclxuICAgICAgICAgICAgICAgIHRlbXBUb29sYmFyRGF0YXNbXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmluZEluZGV4QnlJRCh0ZW1wVG9vbGJhckRhdGFzLCB0ZW1wR3JvdXAuaWQpXHJcbiAgICAgICAgICAgICAgICBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlvZPliY3liankvZnpmpDol49cclxuICAgICAgICBmb3IgKFxyXG4gICAgICAgICAgICBsZXQgaiA9IHRlbXBHcm91cC5yZXNwb25zZWRJbmRleC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGogPCB0ZW1wR3JvdXAucHJlc2V0SWQubGVuZ3RoO1xyXG4gICAgICAgICAgICBqKytcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgaWYgKHRlbXBEaXN0YW5jZSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g6K6h566X5Zyo5b2T5YmN5pWw5o2u5Lit55qE5L2N572u77yM5qC55o2u6L+Z5Liq5L2N572u5Y+v5Lul5om+5a695bqmXHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXBPbGRJbmRleCA9IHRoaXMuX2ZpbmRJbmRleEJ5SUQoXHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvb2xiYXJEYXRhcyxcclxuICAgICAgICAgICAgICAgIHRlbXBHcm91cC5wcmVzZXRJZFtqXVxyXG4gICAgICAgICAgICApIGFzIGFueTtcclxuICAgICAgICAgICAgY29uc3QgdGVtcE5ld0luZGV4ID0gdGhpcy5fZmluZEluZGV4QnlJRChcclxuICAgICAgICAgICAgICAgIHRlbXBUb29sYmFyRGF0YXMsXHJcbiAgICAgICAgICAgICAgICB0ZW1wR3JvdXAucHJlc2V0SWRbal1cclxuICAgICAgICAgICAgKSBhcyBhbnk7XHJcblxyXG4gICAgICAgICAgICAvLyDorqHnrpfmjInpkq7lrr3luqZcclxuICAgICAgICAgICAgbGV0IHRlbXBXaWR0aCA9IHRoaXMudG9vbGJhckRhdGFzW3RlbXBPbGRJbmRleF0uZ2V0V2lkdGgoKSBhcyBhbnk7XHJcbiAgICAgICAgICAgIGlmICh0ZW1wV2lkdGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIOaMiemSruWuveW6puacquabvuiiq+iuoeeul+i/h1xyXG4gICAgICAgICAgICAgICAgdGVtcFdpZHRoID0gdGhpcy5fZ2V0V2lkdGhGcm9tRWxlbWVudHNCeUlkKFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBHcm91cC5wcmVzZXRJZFtqXVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIHRlbXBUb29sYmFyRGF0YXNbdGVtcE5ld0luZGV4XS5zZXRXaWR0aCh0ZW1wV2lkdGgpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRlbXBXaWR0aCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vIOaMiemSruiiq+makOiXj1xyXG4gICAgICAgICAgICAgICAgdGVtcFdpZHRoID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGVtcERQLmFkZENoaWxkKHRlbXBUb29sYmFyRGF0YXNbdGVtcE5ld0luZGV4XSk7XHJcbiAgICAgICAgICAgIC8vIOenu+mZpFxyXG4gICAgICAgICAgICB0ZW1wVG9vbGJhckRhdGFzLnNwbGljZSh0ZW1wTmV3SW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAvLyDkv53lrZjkvY3nva7nlKjkuo7ov5jljp9cclxuICAgICAgICAgICAgdGVtcEdyb3VwLnNldFJlc3BvbnNlZCh0ZW1wTmV3SW5kZXgpO1xyXG4gICAgICAgICAgICB0ZW1wRGlzdGFuY2UgPSB0ZW1wRGlzdGFuY2UgLSB0ZW1wV2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhdXhpbGlhcnkgJiYgdGVtcERQLmhhc0NoaWxkKCkpIHtcclxuICAgICAgICAgICAgLy8g5o+S5YWlXHJcbiAgICAgICAgICAgIHRlbXBUb29sYmFyRGF0YXMucHVzaCh0ZW1wRFApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9hdXhpbGlhcnkgPSAtMTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJEYXRhcyA9IFtdLmNvbmNhdCh0ZW1wVG9vbGJhckRhdGFzKTtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNrmlk5om+5Yiw5a6e6ZmF5pi+56S65YWD57Sg55qE5a695bqmXHJcbiAgICAgKiBAcGFyYW0gZmluZElkXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2dldFdpZHRoRnJvbUVsZW1lbnRzQnlJZChmaW5kSWQpOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IHBhcmVudEVsID0gdGhpcy5yZXNpemVkQ29udGVudEVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgY2hpbGRMZW4gPSBwYXJlbnRFbC5jaGlsZHJlbi5sZW5ndGg7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjaGlsZExlbjsgaysrKSB7XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnRFbC5jaGlsZHJlbltrXS5pZCA9PT0gZmluZElkKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBwYXJlbnRFbC5jaGlsZHJlbltrXS5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOagvOW8j+WMluaVsOaNrlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9mb3JtYXREYXRhKGRhdGFzLCBpZFByZWZpeDogc3RyaW5nID0gXCJyZXNwb25zZVwiKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICAgICAgZGF0YXMuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uaXNEUCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5aaC5p6c5piv5LiL5ouJXHJcbiAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5oYXNPd25Qcm9wZXJ0eShcImNoaWxkcmVuXCIpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVtcImNoaWxkcmVuXCJdLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBbXS5jb25jYXQoaXRlbVtcImNoaWxkcmVuXCJdKTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHBJdGVtID0gbmV3IFJlc3BvbnNlVG9vbGJhckRyb3BEb3duKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHsgaWQ6IGlkUHJlZml4ICsgXCJfXCIgKyBpbmRleCB9LCBpdGVtKVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZHBJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICBkcEl0ZW0uY2hpbGRyZW4gPSB0aGlzLl9mb3JtYXREYXRhKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWRQcmVmaXggKyBcIl9cIiArIGluZGV4XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBSZXNwb25zZVRvb2xiYXJEcm9wRG93bihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oeyBpZDogaWRQcmVmaXggKyBcIl9cIiArIGluZGV4IH0sIGl0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g6Z2e5LiL5ouJXHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChcclxuICAgICAgICAgICAgICAgICAgICBuZXcgUmVzcG9uc2VUb29sYmFySXRlbShcclxuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih7IGlkOiBpZFByZWZpeCArIFwiX1wiICsgaW5kZXggfSwgaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOaJvuWIsOesrOS4gOS4quacquWkhOeQhuWujOWTjeW6lOW8j+eahOWFg+e0oFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9nZXRGaXJzdFVuUmVzcG9uc2VkSW5kZXgoKSB7XHJcbiAgICAgICAgY29uc3QgdGVtcFVuUmVzcG9uc2VkSW5kZXggPSB0aGlzLnJlc2l6ZUdyb3Vwcy5maW5kSW5kZXgoZ3JvdXAgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZ3JvdXAuaXNSZXNwb25zZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0ZW1wVW5SZXNwb25zZWRJbmRleDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5a+75om+5pyA5ZCO5LiA5Liq5aSE55CG5ZON5bqU5byP55qE5YWD57SgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2dldExhc3RSZXNwb25zZUluZGV4KCkge1xyXG4gICAgICAgIGNvbnN0IHRlbXBSZXNwb25zaW5nSW5kZXggPSB0aGlzLnJlc2l6ZUdyb3Vwcy5maW5kSW5kZXgoZ3JvdXAgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWdyb3VwLmlzUmVzcG9uc2luZygpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8g5omA5pyJ57uE5YWD57Sg6YO95bey5aSE55CG5a6M5ZON5bqU5byPXHJcbiAgICAgICAgaWYgKHRlbXBSZXNwb25zaW5nSW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlc2l6ZUdyb3Vwcy5sZW5ndGggLSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDmiYDmnInnu4TlhYPntKDpg73mnKrlvIDlp4vlpITnkIblk43lupTlvI9cclxuICAgICAgICByZXR1cm4gdGVtcFJlc3BvbnNpbmdJbmRleCA+IDEgPyB0ZW1wUmVzcG9uc2luZ0luZGV4IC0gMSA6IC0xO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDmib7liLBncm91cOW9ouaIkOeahOS4i+aLie+8jOWcqOaVsOaNruS4reeahOS9jee9rlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9maW5kSW5kZXhCeUlEKFxyXG4gICAgICAgIGRhdGFzOiBBcnJheTxSZXNwb25zZVRvb2xiYXJJdGVtIHwgUmVzcG9uc2VUb29sYmFyRHJvcERvd24+LFxyXG4gICAgICAgIGlkOiBzdHJpbmdcclxuICAgICk6IGFueSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0YXMuZmluZEluZGV4KChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbVtcImlkXCJdID09PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOagueaNrklE5a+75om+SXRlbVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9maW5kSXRlbUJ5SUQoXHJcbiAgICAgICAgaWQ6IHN0cmluZyxcclxuICAgICAgICBkYXRhOiBBcnJheTxSZXNwb25zZVRvb2xiYXJEcm9wRG93biB8IFJlc3BvbnNlVG9vbGJhckl0ZW0+XHJcbiAgICApOiBSZXNwb25zZVRvb2xiYXJEcm9wRG93biB8IFJlc3BvbnNlVG9vbGJhckl0ZW0ge1xyXG4gICAgICAgIGxldCB0ZW1wUmVzdWx0ID0gbnVsbDtcclxuICAgICAgICBjb25zdCB0ZW1wSW5kZXggPSBkYXRhLmZpbmRJbmRleCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGl0ZW1bXCJpZFwiXSA9PT0gaWQpIHtcclxuICAgICAgICAgICAgICAgIHRlbXBSZXN1bHQgPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5aaC5p6c5piv5LiL5ouJ77yM5bGC57qn5LiL5ouJXHJcbiAgICAgICAgICAgIGlmIChpdGVtW1wiaXNEUFwiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcEl0ZW0gPSB0aGlzLl9maW5kSXRlbUJ5SUQoaWQsIGl0ZW1bXCJjaGlsZHJlblwiXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGVtcEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wUmVzdWx0ID0gdGVtcEl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0ZW1wUmVzdWx0O1xyXG4gICAgfVxyXG59XHJcbiJdfQ==