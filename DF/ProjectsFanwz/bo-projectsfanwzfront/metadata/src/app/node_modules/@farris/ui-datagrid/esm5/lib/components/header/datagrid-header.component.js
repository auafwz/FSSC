/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2019-08-06 07:43:53
* @LastEditors: 疯狂秀才(Lucas Huang)
* @LastEditTime: 2019-11-20 20:14:11
* @QQ: 1055818239
* @Version: v0.0.1
*/
import { ComponentFactoryResolver, ViewContainerRef } from '@angular/core';
import { Component, Input, Renderer2, ViewChild, ElementRef, ViewEncapsulation, Injector, ChangeDetectorRef, Directive, Optional, NgZone } from '@angular/core';
import { DatagridService } from '../../services/datagrid.service';
import { SCROLL_X_ACTION, FIXED_LEFT_SHADOW_CLS, SCROLL_X_REACH_START_ACTION, FIXED_RIGHT_SHADOW_CLS, SCROLL_X_REACH_END_ACTION, GRID_FILTER_ROW } from '../../types/constant';
import { DatagridComponent } from '../../datagrid.component';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
var DatagridHeaderComponent = /** @class */ (function () {
    function DatagridHeaderComponent(render2, injector, dg, ngZone) {
        var _this = this;
        this.render2 = render2;
        this.injector = injector;
        this.dg = dg;
        this.ngZone = ngZone;
        this.height = 35;
        this.columns = [];
        this.enableDragColumn = false;
        this.wrapHeader = false;
        this.enableFilterRow = false;
        this.scrollbarMode = 'auto';
        this.ro = null;
        this.rightFixedColumnWidth = 0;
        this.normalColumnWidth = 0;
        this.showOverlay = false;
        this.disableSort = false;
        this.scrollX = 0;
        this.showShadowCls = false;
        this.top = 0;
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.cd = this.injector.get(ChangeDetectorRef);
        this.el = this.injector.get(ElementRef);
        this.dfrs = this.dg.clientFilterService;
        this.dgs.scorll$.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            if (d.type === SCROLL_X_ACTION || d.type === SCROLL_X_REACH_END_ACTION || d.type === SCROLL_X_REACH_START_ACTION) {
                _this.scrollX = d.x;
                _this.render2.setStyle(_this.headerColumnsTable.nativeElement, 'transform', "translate3d(-" + d.x + "px, 0px, 0px)");
                if (!_this.dg.groupRows) {
                    if (_this.fixedLeft) {
                        if (d.x) {
                            _this.render2.addClass(_this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                        }
                        else {
                            _this.render2.removeClass(_this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                        }
                    }
                }
            }
            if (d.type === SCROLL_X_REACH_START_ACTION) {
                if (_this.fixedLeft) {
                    _this.render2.removeClass(_this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                }
            }
        }));
        this.dgs.showFixedShadow.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.fixedRight) {
                _this.setFixedColumnPosition(e.showRightShadow, e.x);
            }
        }));
        this.dgs.disableHeader.subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            _this.showOverlay = flag;
            _this.disableSort = flag;
            _this.cd.detectChanges();
        }));
    }
    Object.defineProperty(DatagridHeaderComponent.prototype, "chkAll", {
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this._chkall = v;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridHeaderComponent.prototype, "fr", {
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val) {
                this.fixedRight = val;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridHeaderComponent.prototype, "rowSpan", {
        // 行号 、 复选框，在多表头下的合并行数
        get: 
        // 行号 、 复选框，在多表头下的合并行数
        /**
         * @return {?}
         */
        function () {
            return this.columns.length + (this.dg.enableFilterRow ? 1 : 0);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridHeaderComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.dgs.checkedRowsTotalChanged$.subscribe((/**
         * @return {?}
         */
        function () {
            if (_this._chkall) {
                /** @type {?} */
                var checkedsCount = _this.dfs.getCurrentPageCheckeds().length;
                /** @type {?} */
                var isCheckAll = _this.dfs.isCheckAll();
                /** @type {?} */
                var isIndeterminate = isCheckAll || !checkedsCount;
                _this._chkall.chk.nativeElement.indeterminate = !isIndeterminate;
                /** @type {?} */
                var _checked = isCheckAll && checkedsCount > 0;
                _this._chkall.updateStatus(_checked);
            }
        }));
        this.dgs.uncheckAll.subscribe((/**
         * @return {?}
         */
        function () {
            if (_this.dg.showAllCheckbox && _this._chkall) {
                _this._chkall.chk.nativeElement.indeterminate = false;
                _this._chkall.chk.nativeElement.checked = false;
            }
        }));
        this.dgs.checkAll.subscribe((/**
         * @return {?}
         */
        function () {
            if (_this._chkall) {
                _this._chkall.chk.nativeElement.checked = true;
            }
        }));
        this.dgs.scrollbarUpdate.subscribe((/**
         * @param {?} ps
         * @return {?}
         */
        function (ps) {
            _this.ps = ps.scrollbarRef;
            _this.rightFixedColumnWidth = _this.getRightFixedColWidth(_this.ps);
            if (_this.fixedRight) {
                _this.setFixedColumnPosition(_this.showShadowCls, 0);
            }
            _this.cd.detectChanges();
        }));
        this.dgs.showGridHeader.subscribe((/**
         * @return {?}
         */
        function () {
            _this.setHeaderPosition();
        }));
        this.dgs.smartFilterBarExpand.subscribe((/**
         * @return {?}
         */
        function () {
            _this.setHeaderPosition();
        }));
        this.rightFixedColumnWidth = this.getRightFixedColWidth(this.ps);
    };
    /**
     * @return {?}
     */
    DatagridHeaderComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.setHeaderPosition();
        }));
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridHeaderComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // if (changes.scrollbarMode && !changes.scrollbarMode.isFirstChange()) {
        //     this.rightFixedColumnWidth = this.getRightFixedColWidth(this.ps);
        //     this.cd.detectChanges();
        // }
        if (changes.columnsGroup && !changes.columnsGroup.isFirstChange()) {
            this.rightFixedColumnWidth = this.getRightFixedColWidth(this.ps);
            this.cd.detectChanges();
        }
    };
    /**
     * @private
     * @param {?=} ps
     * @return {?}
     */
    DatagridHeaderComponent.prototype.getRightFixedColWidth = /**
     * @private
     * @param {?=} ps
     * @return {?}
     */
    function (ps) {
        if (ps === void 0) { ps = null; }
        if (!this.columnsGroup) {
            return 0;
        }
        /** @type {?} */
        var w = this.columnsGroup.rightFixedWidth;
        if (!ps) {
            ps = this.dg.scrollInstance.instance;
        }
        if (ps && ps.scrollbarYActive && this.scrollbarMode === 'allways') {
            return w += this.showShadowCls ? 18 : 0;
        }
        return w;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridHeaderComponent.prototype.setHeaderPosition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var top = 0;
        if ((this.dg.enableFilterRow || this.dg.enableSmartFilter) && this.dg.showFilterBar) {
            top += this.dg.filterBarHeight;
        }
        if (this.dg.showRowGroupPanel) {
            top += this.dg.rowGroupPanelHeight;
        }
        this.top = top;
        this.render2.setStyle(this.el.nativeElement, 'top', top + "px");
    };
    /**
     * @param {?} fixedLeftWidth
     * @return {?}
     */
    DatagridHeaderComponent.prototype.isShowShadow = /**
     * @param {?} fixedLeftWidth
     * @return {?}
     */
    function (fixedLeftWidth) {
        /** @type {?} */
        var dgContainerWidth = this.dg.dgContainer.nativeElement.offsetWidth;
        return dgContainerWidth < this.dg.colGroup.totalWidth;
    };
    /**
     * @param {?} left
     * @param {?} right
     * @param {?} col
     * @param {?=} isdatafield
     * @return {?}
     */
    DatagridHeaderComponent.prototype.isColspan = /**
     * @param {?} left
     * @param {?} right
     * @param {?} col
     * @param {?=} isdatafield
     * @return {?}
     */
    function (left, right, col, isdatafield) {
        if (isdatafield === void 0) { isdatafield = false; }
        if (!left && !right) {
            if (isdatafield) {
                return !col.colspan && (!col.fixed || col.fixed === 'none');
            }
            else {
                return col.colspan && (!col.fixed || col.fixed === 'none');
            }
        }
        else if (left) {
            if (isdatafield) {
                return !col.colspan && col.fixed && col.fixed === 'left';
            }
            else {
                return col.colspan && col.fixed && col.fixed === 'left';
            }
        }
        else if (right) {
            if (isdatafield) {
                return !col.colspan && col.fixed && col.fixed === 'right';
            }
            else {
                return col.colspan && col.fixed && col.fixed === 'right';
            }
        }
    };
    /**
     * @param {?} isShow
     * @param {?} scrollLeft
     * @return {?}
     */
    DatagridHeaderComponent.prototype.setFixedColumnPosition = /**
     * @param {?} isShow
     * @param {?} scrollLeft
     * @return {?}
     */
    function (isShow, scrollLeft) {
        this.showShadowCls = isShow;
        /** @type {?} */
        var method = isShow ? 'addClass' : 'removeClass';
        this.render2[method](this.fixedRight.nativeElement, FIXED_RIGHT_SHADOW_CLS);
        /** @type {?} */
        var realWidth = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth + this.rightFixedColumnWidth;
        /** @type {?} */
        var gridWidth = this.dg.width;
        /** @type {?} */
        var l = this.dg.width - (this.dg.showBorder ? 2 : 0) - this.rightFixedColumnWidth;
        if (gridWidth > realWidth) {
            l = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth;
        }
        this.render2.setStyle(this.fixedRight.nativeElement, 'left', l + 'px');
    };
    /**
     * @param {?} e
     * @param {?} rntd
     * @return {?}
     */
    DatagridHeaderComponent.prototype.onRowNumerColumnDblClick = /**
     * @param {?} e
     * @param {?} rntd
     * @return {?}
     */
    function (e, rntd) {
        /** @type {?} */
        var maxRowNumber = this.dg.getRows().length;
        if (this.dg.pagination) {
            /** @type {?} */
            var pageSize = this.dg.pageSize;
            /** @type {?} */
            var pageIndex = this.dg.pageIndex;
            maxRowNumber = pageSize * pageIndex + pageSize;
        }
        this.dg.longTextArea.nativeElement.innerHTML = maxRowNumber;
        /** @type {?} */
        var w1 = this.dg.longTextArea.nativeElement.offsetWidth;
        /** @type {?} */
        var currentWidth = rntd.offsetWidth;
        if (w1 > currentWidth) {
            this.dg.lineNumberWidth = w1 + 10;
            this.dfs.updateProperty('lineNumberWidth', this.dg.lineNumberWidth);
            this.dfs.resizeColumns();
        }
    };
    /**
     * @param {?} e
     * @param {?} col
     * @return {?}
     */
    DatagridHeaderComponent.prototype.onSortColumnClick = /**
     * @param {?} e
     * @param {?} col
     * @return {?}
     */
    function (e, col) {
        var _this = this;
        if (this.disableSort) {
            return;
        }
        if (!col.sortable) {
            return;
        }
        // 结束编辑
        this.dg.cancelEdit(null);
        /** @type {?} */
        var sortName = this.dg.sortName;
        /** @type {?} */
        var sortOrder = this.dg.sortOrder;
        /** @type {?} */
        var sortFields = [];
        /** @type {?} */
        var sortOrders = [];
        if (sortName) {
            sortFields = sortName.split(',');
            sortOrders = sortOrder.split(',');
        }
        /** @type {?} */
        var colOrder = col.order || 'asc';
        /** @type {?} */
        var newOrder = colOrder;
        /** @type {?} */
        var i = sortFields.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n === col.field; }));
        if (i >= 0) {
            /** @type {?} */
            var _order = sortOrders[i] === 'asc' ? 'desc' : 'asc';
            newOrder = _order;
            // if (this.dg.multiSort && newOrder === 'asc') {
            if (newOrder === 'asc') {
                newOrder = undefined;
                sortFields.splice(i, 1);
                sortOrders.splice(i, 1);
            }
            else {
                sortOrders[i] = _order;
            }
        }
        else {
            if (this.dg.multiSort) {
                sortFields.push(col.field);
                sortOrders.push(colOrder);
            }
            else {
                sortFields = [col.field];
                sortOrders = [colOrder];
            }
        }
        col.order = newOrder;
        this.dg.sortName = sortFields.join(',');
        this.dg.sortOrder = sortOrders.join(',');
        this.dfs.setSortInfo(this.dg.sortName, this.dg.sortOrder);
        this.dg.beforeSortColumn(this.dg.sortName, this.dg.sortOrder, this.dg).subscribe((/**
         * @return {?}
         */
        function () {
            _this.dg.onColumnSorted();
        }));
    };
    DatagridHeaderComponent.decorators = [
        { type: Component, args: [{
                    selector: 'datagrid-header',
                    template: "<!--\r\n * @Author: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:53\r\n * @LastEditors: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @LastEditTime: 2019-11-05 08:53:26\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n -->\r\n <!-- [style.maxWidth.px]=\"col.width - 44\"   =>  style=\"width: 100%\"    -->\r\n<ng-template #filterAndSort let-col>\r\n    <ng-container *ngIf=\"col.filter\">\r\n        <span style=\"width: 100%\" class=\"f-datagrid-header-cell-title\">\r\n            <span class=\"text-danger\" *ngIf=\" col.validators | showStar \">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <ng-container *ngIf=\"col.sortable\">\r\n            <span class=\"f-datagrid-sort\" [class.f-datagrid-filter-sort-asc]=\"col.order === 'asc'\"\r\n                [class.f-datagrid-filter-sort-desc]=\"col.order === 'desc'\"\r\n                [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\" *ngIf=\"col.order\"\r\n                datagrid-smart-filter  [disabled]=\"disableSort\" [column]=\"col\"> </span>\r\n            <span class=\"f-datagrid-sort f-datagrid-filter-sort\" [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\"\r\n                datagrid-smart-filter [disabled]=\"disableSort\" [column]=\"col\" *ngIf=\"!col.order\"></span>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!col.sortable\">\r\n            <span class=\"f-datagrid-sort f-datagrid-filter\" datagrid-smart-filter  [disabled]=\"disableSort\"  [column]=\"col\"></span>\r\n        </ng-container>\r\n    </ng-container>\r\n    <ng-container *ngIf=\"!col.filter\" [ngTemplateOutlet]=\"column_title\" [ngTemplateOutletContext]=\"{$implicit: col}\">\r\n    </ng-container>\r\n\r\n</ng-template>\r\n\r\n\r\n<ng-template #column_title let-col>\r\n    <ng-container *ngIf=\"!col.sortable\">\r\n        <span [style.width.px]=\"col.width - 20\" class=\"f-datagrid-header-cell-title\" *ngIf=\"col.field !== dg.ControlPanelFeild\">\r\n            <span class=\"text-danger\" *ngIf=\" col.validators | showStar \">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <span *ngIf=\"col.field === dg.ControlPanelFeild\" class=\"f-datagrid-header-cell-title\"\r\n            style=\"position: absolute; left: 3px; top: 0; cursor: pointer;\"\r\n            (click)=\"dg.showControlPanel($event)\">\r\n            <span class=\"f-icon f-icon-home-setup\"></span>\r\n        </span>\r\n    </ng-container>\r\n    <ng-container *ngIf=\"col.sortable\">\r\n        <span style=\"width: 100%\"  class=\"f-datagrid-header-cell-title\">\r\n            <span class=\"text-danger\" *ngIf=\" col.validators | showStar \">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <span class=\"f-datagrid-sort\" [class.f-datagrid-sort-asc]=\"col.order === 'asc'\"\r\n            [class.f-datagrid-sort-desc]=\"col.order === 'desc'\"\r\n            [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\"\r\n            (click)=\"onSortColumnClick($event, col)\" *ngIf=\"col.order\"> </span>\r\n        <span class=\"f-datagrid-sort\" [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\"\r\n            (click)=\"onSortColumnClick($event, col)\" *ngIf=\"!col.order\"></span>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n\r\n\r\n<ng-template #column_template let-col let-left=\"left\" let-right=\"right\">\r\n    <ng-container *ngIf=\"isColspan(left, right, col, false) \">\r\n        <td [resize-column]=\"col\" class=\"f-datagrid-header-cell f-datagrid-header-cell-group\" [attr.align]=\"col.halign\"\r\n            [attr.colspan]=\"col.colspan\" [attr.title]=\"col.title\">\r\n            <div class=\"f-datagrid-header-cell-content\" [header-style]=\"col\">\r\n                {{ col.title }}\r\n            </div>\r\n        </td>\r\n    </ng-container>\r\n    <ng-container *ngIf=\"isColspan(left, right, col, true)\">\r\n        <td [resize-column]=\"col\" class=\"f-datagrid-header-cell\" [attr.align]=\"col.halign\" [attr.field]=\"col.field\"\r\n            [attr.rowspan]=\"col.rowspan\" [attr.title]=\"col.title\"\r\n            *ngIf=\"dg.columnIsVisible(col)\"\r\n            [style.display]=\"dg.columnIsVisible(col) ? '': 'none'\"\r\n            [class.f-datagrid-header-cell-sort]=\"col.sortable\"\r\n            [class.smooth-dnd-draggable-wrapper]=\"enableDragColumn && col.field !== dg.ControlPanelFeild \">\r\n            <div class=\"f-datagrid-header-cell-content\" [header-style]=\"col\" [style.width.px]=\"col.width\">\r\n                <span class=\"drag-column-bar f-icon f-icon-more-vertical\" *ngIf=\"col.field !== dg.ControlPanelFeild && enableDragColumn && !dg.editable\"></span>\r\n                <ng-container *ngIf=\"col.headerTemplate\" [ngTemplateOutlet]=\"col.headerTemplate\" [ngTemplateOutletContext]=\"{$implicit: col}\">\r\n                </ng-container>\r\n                <ng-container *ngIf=\"!col.headerTemplate\" [ngTemplateOutlet]=\" !dg.enableSmartFilter ? column_title : filterAndSort \" \r\n                [ngTemplateOutletContext]=\"{$implicit: col}\">\r\n                </ng-container>\r\n            </div>\r\n        </td>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #header_template_inner let-columns let-left=\"left\" let-right=\"right\" let-groupCols=\"groupCols\">\r\n    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"height: 100%\">\r\n        <colgroup>\r\n            <col width=\"36px\" *ngIf=\"dg.showCheckbox && left\">\r\n            <col [width]=\"dg?.lineNumberWidth + 'px'\" *ngIf=\"dg.showLineNumber && left\">\r\n            <ng-container *ngFor=\"let col of groupCols\">\r\n                <col [width]=\"col.width + 'px'\" *ngIf=\"col.width && col.field\">\r\n            </ng-container>\r\n        </colgroup>\r\n        <thead [class.header-wrap]=\"wrapHeader\">\r\n            <tr class=\"f-datagrid-header-row\" *ngFor=\"let cols of columns; index as colsIdx; first as isFirst\"\r\n                [drag-column]=\"enableDragColumn\" [groupName]=\"left?'left': right ? 'right': 'center'\">\r\n                <!-- \u590D\u9009\u6846 -->\r\n                <td *ngIf=\"dg.showCheckbox && isFirst && left\" #chktd\r\n                    class=\"f-datagrid-header-cell f-datagrid-header-checkbox\" \r\n                    [attr.rowspan]=\"rowSpan\" [style.height.px]=\"height\">\r\n                    <div class=\"f-datagrid-header-cell-content\" style=\"width: 36px; text-align: center;overflow:hidden; \" [style.maxHeight.px]=\"height\">\r\n                        <datagrid-header-checkbox #chkAll *ngIf=\"dg.showAllCheckbox && dg.multiSelect\" ></datagrid-header-checkbox>\r\n                    </div>\r\n                </td>\r\n                <!-- \u884C\u53F7 -->\r\n                <td *ngIf=\"dg.showLineNumber && isFirst && left\" #rntd\r\n                    class=\"f-datagrid-header-cell f-datagrid-cell-rownumber\" [attr.rowspan]=\"rowSpan\"\r\n                    [style.height.px]=\"height\"\r\n                    (dblclick)=\"onRowNumerColumnDblClick($event, rntd)\">\r\n                    <div class=\"f-datagrid-header-cell-content\" style=\"padding: 0px;\"  [style.width.px]=\"dg?.lineNumberWidth\">\r\n                        {{ 'datagrid.lineNumberTitle' | locale: dg.lineNumberTitle }}\r\n                    </div>\r\n                </td>\r\n                <ng-container *ngFor=\"let col of cols; last as isLast\">\r\n                    <ng-container\r\n                        *ngTemplateOutlet=\"column_template; context: {$implicit: col, left: left, right: right}\">\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngIf=\"enableFilterRow\" [style.height.px]=\"dg.filterRowHeight\" class=\"f-datagrid-header-row f-datagrid-filter-row\">\r\n                <ng-container filter-row-creator [left]=\"left\" [right]=\"right\"></ng-container>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</ng-template>\r\n\r\n<div class=\"f-datagrid-header\" style=\"width: 100%;\" [style.min-height.px]=\"height\" #header>\r\n    <!--\u5DE6\u4FA7\u56FA\u5B9A\u5217-->\r\n    <div #fixedLeft class=\"f-datagrid-header-fixed-left\"\r\n        *ngIf=\"columnsGroup?.leftFixed && columnsGroup?.leftFixed.length  || dg?.showLineNumber || dg?.showCheckbox \"\r\n        [style.width.px]=\"columnsGroup?.leftFixedWidth\"\r\n        [style.height.px]=\"height\">\r\n        <ng-container *ngTemplateOutlet=\"header_template_inner; context: { $implicit: columns, left: true, right: false,\r\n            groupCols:  columnsGroup?.leftFixed}\">\r\n        </ng-container>\r\n    </div>\r\n\r\n    <!--\u6B63\u5E38\u5217-->\r\n    <div #headerContainer class=\"f-datagrid-header-center\" \r\n        [style.left.px]=\"columnsGroup?.leftFixedWidth\"\r\n        [style.width.px]=\"columnsGroup?.normalWidth\"\r\n        style=\"position: absolute;height: 100%\">\r\n        <ng-container *ngTemplateOutlet=\"header_template_inner; context: {$implicit: columns, left: false, right: false,\r\n            groupCols:  columnsGroup?.normalColumns}\">\r\n        </ng-container>\r\n    </div>\r\n    <!--\u53F3\u4FA7\u56FA\u5B9A\u5217-->\r\n    <div #fixedRight class=\"f-datagrid-header-fixed-right\"\r\n        *ngIf=\"columnsGroup?.rightFixed && columnsGroup?.rightFixed.length\"\r\n        [style.width.px]=\" dg.showBorder?  rightFixedColumnWidth : rightFixedColumnWidth + 1\"\r\n        [style.height.px]=\"height\" style=\"border: 0;\">\r\n        <ng-container *ngTemplateOutlet=\"header_template_inner; context: {$implicit: columns, left: false, right: true,\r\n            groupCols: columnsGroup?.rightFixed}\">\r\n        </ng-container>\r\n    </div>\r\n    <div class=\"filter-row-disabled\"\r\n        style=\"position: absolute;background: rgb(255, 255, 255);width: 100%;z-index: 9;height: 40px; bottom:0;opacity: 0;\"\r\n        [style.left.px]=\"dg.showAllCheckbox ? 36 : 0\" *ngIf=\"showOverlay && dg.enableFilterRow\">\r\n    </div>\r\n</div>",
                    encapsulation: ViewEncapsulation.None,
                    exportAs: 'dgHeader'
                }] }
    ];
    /** @nocollapse */
    DatagridHeaderComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: Injector },
        { type: DatagridComponent, decorators: [{ type: Optional }] },
        { type: NgZone }
    ]; };
    DatagridHeaderComponent.propDecorators = {
        height: [{ type: Input }],
        columns: [{ type: Input }],
        columnsGroup: [{ type: Input }],
        enableDragColumn: [{ type: Input }],
        wrapHeader: [{ type: Input }],
        enableFilterRow: [{ type: Input }],
        scrollbarMode: [{ type: Input }],
        header: [{ type: ViewChild, args: ['header',] }],
        headerColumnsTable: [{ type: ViewChild, args: ['headerContainer',] }],
        fixedLeft: [{ type: ViewChild, args: ['fixedLeft',] }],
        chkAll: [{ type: ViewChild, args: ['chkAll',] }],
        fr: [{ type: ViewChild, args: ['fixedRight',] }]
    };
    return DatagridHeaderComponent;
}());
export { DatagridHeaderComponent };
if (false) {
    /** @type {?} */
    DatagridHeaderComponent.prototype.height;
    /** @type {?} */
    DatagridHeaderComponent.prototype.columns;
    /** @type {?} */
    DatagridHeaderComponent.prototype.columnsGroup;
    /** @type {?} */
    DatagridHeaderComponent.prototype.enableDragColumn;
    /** @type {?} */
    DatagridHeaderComponent.prototype.wrapHeader;
    /** @type {?} */
    DatagridHeaderComponent.prototype.enableFilterRow;
    /** @type {?} */
    DatagridHeaderComponent.prototype.scrollbarMode;
    /** @type {?} */
    DatagridHeaderComponent.prototype.header;
    /** @type {?} */
    DatagridHeaderComponent.prototype.headerColumnsTable;
    /** @type {?} */
    DatagridHeaderComponent.prototype.fixedLeft;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype._chkall;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.fixedRight;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.el;
    /** @type {?} */
    DatagridHeaderComponent.prototype.rightFixedColumnWidth;
    /** @type {?} */
    DatagridHeaderComponent.prototype.normalColumnWidth;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.cd;
    /** @type {?} */
    DatagridHeaderComponent.prototype.showOverlay;
    /** @type {?} */
    DatagridHeaderComponent.prototype.disableSort;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.scrollX;
    /** @type {?} */
    DatagridHeaderComponent.prototype.showShadowCls;
    /** @type {?} */
    DatagridHeaderComponent.prototype.top;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.ps;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.render2;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.injector;
    /** @type {?} */
    DatagridHeaderComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.ngZone;
}
var FilterRowCreateDirective = /** @class */ (function () {
    function FilterRowCreateDirective(vc, injector, dg, ngZone) {
        var _this = this;
        this.vc = vc;
        this.injector = injector;
        this.dg = dg;
        this.ngZone = ngZone;
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.cd = this.injector.get(ChangeDetectorRef);
        this.dfrs = this.dg.clientFilterService;
        this.filterRowType = this.injector.get(GRID_FILTER_ROW, null);
        this.dgs.clearFilter.subscribe((/**
         * @return {?}
         */
        function () {
            if (_this.filterRowRef) {
                _this.filterRowRef.instance.clearFilterValue(false);
            }
        }));
        this.dgs.columnsChanged.subscribe((/**
         * @return {?}
         */
        function () {
            _this.createFilterRow(true);
        }));
        if (this.dfrs) {
            this.dfrs.removeField.subscribe((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                if (_this.filterRowRef && f) {
                    /** @type {?} */
                    var flag = false;
                    /** @type {?} */
                    var _cols = [];
                    if (_this.left) {
                        _cols = _this.dg.colGroup.leftFixed || [];
                    }
                    else if (_this.right) {
                        _cols = _this.dg.colGroup.rightFixed || [];
                    }
                    else {
                        _cols = _this.dg.colGroup.normalColumns || [];
                    }
                    flag = !!_cols.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.field === f; }));
                    if (flag) {
                        _this.filterRowRef.instance.removeField(f);
                    }
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    FilterRowCreateDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.createFilterRow(true);
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    FilterRowCreateDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // if (changes.columnsGroup && !changes.columnsGroup.isFirstChange()) {
        //     this.createFilterRow();
        // }
    };
    /** 过滤行 */
    /**
     * 过滤行
     * @param {?=} rebuild
     * @return {?}
     */
    FilterRowCreateDirective.prototype.createFilterRow = /**
     * 过滤行
     * @param {?=} rebuild
     * @return {?}
     */
    function (rebuild) {
        var _this = this;
        if (rebuild === void 0) { rebuild = false; }
        if (rebuild && this.filterRowRef) {
            this.filterRowRef.destroy();
            this.filterRowRef = null;
        }
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this._createFilterRow();
            if (rebuild) {
                _this.cd.detectChanges();
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    FilterRowCreateDirective.prototype._createFilterRow = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.dg.enableFilterRow) {
            if (!this.filterRowType) {
                return;
            }
            /** @type {?} */
            var columnsData = this.dg.colGroup.normalColumns;
            if (this.left) {
                columnsData = this.dg.colGroup.leftFixed;
            }
            else if (this.right) {
                columnsData = this.dg.colGroup.rightFixed;
            }
            if (!this.filterRowRef && this.vc) {
                /** @type {?} */
                var cf = this.cfr.resolveComponentFactory(this.filterRowType);
                this.filterRowRef = this.vc.createComponent(cf);
                this.filterRowRef.instance.columns = columnsData;
                this.filterRowRef.instance.gridInstance = this.dg;
                this.filterRowRef.instance.conditionChange.subscribe((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    /** @type {?} */
                    var conditions = n || {};
                    _this.dgs.onFilterChanged.emit(conditions);
                }));
            }
        }
    };
    FilterRowCreateDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[filter-row-creator]'
                },] }
    ];
    /** @nocollapse */
    FilterRowCreateDirective.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: Injector },
        { type: DatagridComponent },
        { type: NgZone }
    ]; };
    FilterRowCreateDirective.propDecorators = {
        left: [{ type: Input }],
        right: [{ type: Input }]
    };
    return FilterRowCreateDirective;
}());
export { FilterRowCreateDirective };
if (false) {
    /** @type {?} */
    FilterRowCreateDirective.prototype.left;
    /** @type {?} */
    FilterRowCreateDirective.prototype.right;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.filterRowType;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.filterRowRef;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.vc;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.injector;
    /** @type {?} */
    FilterRowCreateDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtaGVhZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9oZWFkZXIvZGF0YWdyaWQtaGVhZGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFVQSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsZ0JBQWdCLEVBQXdELE1BQU0sZUFBZSxDQUFDO0FBRWpJLE9BQU8sRUFDSCxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUMzQyxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQzdGLE1BQU0sZUFBZSxDQUFDO0FBSXZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNsRSxPQUFPLEVBQUUsZUFBZSxFQUFFLHFCQUFxQixFQUFFLDJCQUEyQixFQUFFLHNCQUFzQixFQUFFLHlCQUF5QixFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9LLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRTdELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBSy9FO0lBeURJLGlDQUNZLE9BQWtCLEVBQVUsUUFBa0IsRUFDbkMsRUFBcUIsRUFBVSxNQUFjO1FBRnBFLGlCQWdEQztRQS9DVyxZQUFPLEdBQVAsT0FBTyxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNuQyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFwRDNELFdBQU0sR0FBRyxFQUFFLENBQUM7UUFDWixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBRWIscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLGVBQVUsR0FBRyxLQUFL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Q2xCLHNDQUE0Qjs7Ozs7SUFBRSw0Q0FBMEI7O0lBQ2hFLHNDQUE0Qjs7Ozs7SUFBRSwwQ0FBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBRdWVyeUxpc3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuLypcclxuKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiogQERhdGU6IDIwMTktMDgtMDYgMDc6NDM6NTNcclxuKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuKiBATGFzdEVkaXRUaW1lOiAyMDE5LTExLTIwIDIwOjE0OjExXHJcbiogQFFROiAxMDU1ODE4MjM5XHJcbiogQFZlcnNpb246IHYwLjAuMVxyXG4qL1xyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBWaWV3Q29udGFpbmVyUmVmLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIENvbXBvbmVudFJlZiwgVmlld0NoaWxkcmVuIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBSZW5kZXJlcjIsIFZpZXdDaGlsZCwgRWxlbWVudFJlZixcclxuICAgIEFmdGVyVmlld0luaXQsIFZpZXdFbmNhcHN1bGF0aW9uLCBJbmplY3RvciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIERpcmVjdGl2ZSwgT3B0aW9uYWwsIE5nWm9uZVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJy4vLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBDb2x1bW5Hcm91cCB9IGZyb20gJy4uLy4uL3R5cGVzL2RhdGEtY29sdW1uJztcclxuaW1wb3J0IHsgRGF0YWdyaWRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQuc2VydmljZSc7XHJcbmltcG9ydCB7IFNDUk9MTF9YX0FDVElPTiwgRklYRURfTEVGVF9TSEFET1dfQ0xTLCBTQ1JPTExfWF9SRUFDSF9TVEFSVF9BQ1RJT04sIEZJWEVEX1JJR0hUX1NIQURPV19DTFMsIFNDUk9MTF9YX1JFQUNIX0VORF9BQ1RJT04sIEdSSURfRklMVEVSX1JPVyB9IGZyb20gJy4uLy4uL3R5cGVzL2NvbnN0YW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEhlYWRlckNoZWNrYm94Q29tcG9uZW50IH0gZnJvbSAnLi4vY2hlY2tib3gvZGF0YWdyaWQtaGVhZGVyLWNoZWNrYm94LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkRmFjYWRlU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlJztcclxuaW1wb3J0IFJlc2l6ZU9ic2VydmVyIGZyb20gJ3Jlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCc7XHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLWZpbHRlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgb2YsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdkYXRhZ3JpZC1oZWFkZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2hlYWRlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gICAgZXhwb3J0QXM6ICdkZ0hlYWRlcidcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkSGVhZGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xyXG4gICAgQElucHV0KCkgaGVpZ2h0ID0gMzU7XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zID0gW107XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zR3JvdXA6IENvbHVtbkdyb3VwO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRHJhZ0NvbHVtbiA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgd3JhcEhlYWRlciA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRmlsdGVyUm93ID0gZmFsc2U7XHJcblxyXG4gICAgQElucHV0KCkgc2Nyb2xsYmFyTW9kZSA9ICdhdXRvJztcclxuXHJcbiAgICBAVmlld0NoaWxkKCdoZWFkZXInKSBoZWFkZXI6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdoZWFkZXJDb250YWluZXInKSBoZWFkZXJDb2x1bW5zVGFibGU6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaXhlZExlZnQnKSBmaXhlZExlZnQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgcHJpdmF0ZSBfY2hrYWxsOiBEYXRhZ3JpZEhlYWRlckNoZWNrYm94Q29tcG9uZW50O1xyXG4gICAgQFZpZXdDaGlsZCgnY2hrQWxsJykgc2V0IGNoa0FsbCh2KSB7XHJcbiAgICAgICAgdGhpcy5fY2hrYWxsID0gdjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZpeGVkUmlnaHQ6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaXhlZFJpZ2h0Jykgc2V0IGZyKHZhbCkge1xyXG4gICAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICAgICAgdGhpcy5maXhlZFJpZ2h0ID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRnczogRGF0YWdyaWRTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBkZnM6IERhdGFncmlkRmFjYWRlU2VydmljZTtcclxuICAgIHByaXZhdGUgcm86IFJlc2l6ZU9ic2VydmVyIHwgbnVsbCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyO1xyXG4gICAgcHJpdmF0ZSBkZnJzOiBEYXRhZ3JpZEZpbHRlclNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmO1xyXG4gICAgcmlnaHRGaXhlZENvbHVtbldpZHRoID0gMDtcclxuICAgIG5vcm1hbENvbHVtbldpZHRoID0gMDtcclxuXHJcbiAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZjtcclxuICAgIHNob3dPdmVybGF5ID0gZmFsc2U7XHJcbiAgICBkaXNhYmxlU29ydCA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBzY3JvbGxYID0gMDtcclxuICAgIHNob3dTaGFkb3dDbHMgPSBmYWxzZTtcclxuXHJcbiAgICB0b3AgPSAwO1xyXG5cclxuICAgIC8vIOihjOWPtyDjgIEg5aSN6YCJ5qGG77yM5Zyo5aSa6KGo5aS05LiL55qE5ZCI5bm26KGM5pWwXHJcbiAgICBnZXQgcm93U3BhbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb2x1bW5zLmxlbmd0aCArICh0aGlzLmRnLmVuYWJsZUZpbHRlclJvdyA/IDEgOiAwKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBwcztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHVibGljIGRnOiBEYXRhZ3JpZENvbXBvbmVudCwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSkge1xyXG4gICAgICAgIHRoaXMuZGZzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRGYWNhZGVTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmRncyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5jZnIgPSB0aGlzLmluamVjdG9yLmdldChDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpO1xyXG4gICAgICAgIHRoaXMuY2QgPSB0aGlzLmluamVjdG9yLmdldChDaGFuZ2VEZXRlY3RvclJlZik7XHJcbiAgICAgICAgdGhpcy5lbCA9IHRoaXMuaW5qZWN0b3IuZ2V0KEVsZW1lbnRSZWYpO1xyXG4gICAgICAgIHRoaXMuZGZycyA9IHRoaXMuZGcuY2xpZW50RmlsdGVyU2VydmljZTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuZGdzLnNjb3JsbCQuc3Vic2NyaWJlKChkOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKGQudHlwZSA9PT0gU0NST0xMX1hfQUNUSU9OIHx8IGQudHlwZSA9PT0gU0NST0xMX1hfUkVBQ0hfRU5EX0FDVElPTiB8fCBkLnR5cGUgPT09IFNDUk9MTF9YX1JFQUNIX1NUQVJUX0FDVElPTikge1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsWCA9IGQueDtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcjIuc2V0U3R5bGUodGhpcy5oZWFkZXJDb2x1bW5zVGFibGUubmF0aXZlRWxlbWVudCwgJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUzZCgtJHtkLnh9cHgsIDBweCwgMHB4KWApO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5ncm91cFJvd3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5maXhlZExlZnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQueCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIyLmFkZENsYXNzKHRoaXMuZml4ZWRMZWZ0Lm5hdGl2ZUVsZW1lbnQsIEZJWEVEX0xFRlRfU0hBRE9XX0NMUyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcjIucmVtb3ZlQ2xhc3ModGhpcy5maXhlZExlZnQubmF0aXZlRWxlbWVudCwgRklYRURfTEVGVF9TSEFET1dfQ0xTKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGQudHlwZSA9PT0gU0NST0xMX1hfUkVBQ0hfU1RBUlRfQUNUSU9OKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maXhlZExlZnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcjIucmVtb3ZlQ2xhc3ModGhpcy5maXhlZExlZnQubmF0aXZlRWxlbWVudCwgRklYRURfTEVGVF9TSEFET1dfQ0xTKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5kZ3Muc2hvd0ZpeGVkU2hhZG93LnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpeGVkUmlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml4ZWRDb2x1bW5Qb3NpdGlvbihlLnNob3dSaWdodFNoYWRvdywgZS54KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5kaXNhYmxlSGVhZGVyLnN1YnNjcmliZSgoZmxhZykgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNob3dPdmVybGF5ID0gZmxhZztcclxuICAgICAgICAgICAgdGhpcy5kaXNhYmxlU29ydCA9IGZsYWc7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGdzLmNoZWNrZWRSb3dzVG90YWxDaGFuZ2VkJC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fY2hrYWxsKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjaGVja2Vkc0NvdW50ID0gdGhpcy5kZnMuZ2V0Q3VycmVudFBhZ2VDaGVja2VkcygpLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2hlY2tBbGwgPSB0aGlzLmRmcy5pc0NoZWNrQWxsKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpc0luZGV0ZXJtaW5hdGUgPSBpc0NoZWNrQWxsIHx8ICFjaGVja2Vkc0NvdW50O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hrYWxsLmNoay5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSAhaXNJbmRldGVybWluYXRlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX2NoZWNrZWQgPSBpc0NoZWNrQWxsICYmIGNoZWNrZWRzQ291bnQgPiAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hrYWxsLnVwZGF0ZVN0YXR1cyhfY2hlY2tlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5kZ3MudW5jaGVja0FsbC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5zaG93QWxsQ2hlY2tib3ggJiYgdGhpcy5fY2hrYWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGthbGwuY2hrLm5hdGl2ZUVsZW1lbnQuaW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hrYWxsLmNoay5uYXRpdmVFbGVtZW50LmNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5jaGVja0FsbC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fY2hrYWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGthbGwuY2hrLm5hdGl2ZUVsZW1lbnQuY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5kZ3Muc2Nyb2xsYmFyVXBkYXRlLnN1YnNjcmliZSgocHM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnBzID0gcHMuc2Nyb2xsYmFyUmVmO1xyXG4gICAgICAgICAgICB0aGlzLnJpZ2h0Rml4ZWRDb2x1bW5XaWR0aCA9IHRoaXMuZ2V0UmlnaHRGaXhlZENvbFdpZHRoKHRoaXMucHMpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZpeGVkQ29sdW1uUG9zaXRpb24odGhpcy5zaG93U2hhZG93Q2xzLCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuZGdzLnNob3dHcmlkSGVhZGVyLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SGVhZGVyUG9zaXRpb24oKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5kZ3Muc21hcnRGaWx0ZXJCYXJFeHBhbmQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRIZWFkZXJQb3NpdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnJpZ2h0Rml4ZWRDb2x1bW5XaWR0aCA9IHRoaXMuZ2V0UmlnaHRGaXhlZENvbFdpZHRoKHRoaXMucHMpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRIZWFkZXJQb3NpdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICAvLyBpZiAoY2hhbmdlcy5zY3JvbGxiYXJNb2RlICYmICFjaGFuZ2VzLnNjcm9sbGJhck1vZGUuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMucmlnaHRGaXhlZENvbHVtbldpZHRoID0gdGhpcy5nZXRSaWdodEZpeGVkQ29sV2lkdGgodGhpcy5wcyk7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMuY29sdW1uc0dyb3VwICYmICFjaGFuZ2VzLmNvbHVtbnNHcm91cC5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGggPSB0aGlzLmdldFJpZ2h0Rml4ZWRDb2xXaWR0aCh0aGlzLnBzKTtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmlnaHRGaXhlZENvbFdpZHRoKHBzID0gbnVsbCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jb2x1bW5zR3JvdXApIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgbGV0IHcgPSB0aGlzLmNvbHVtbnNHcm91cC5yaWdodEZpeGVkV2lkdGg7XHJcblxyXG4gICAgICAgIGlmICghcHMpIHtcclxuICAgICAgICAgICAgcHMgPSB0aGlzLmRnLnNjcm9sbEluc3RhbmNlLmluc3RhbmNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHBzICYmIHBzLnNjcm9sbGJhcllBY3RpdmUgJiYgdGhpcy5zY3JvbGxiYXJNb2RlID09PSAnYWxsd2F5cycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHcgKz0gdGhpcy5zaG93U2hhZG93Q2xzID8gMTggOiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldEhlYWRlclBvc2l0aW9uKCkge1xyXG4gICAgICAgIGxldCB0b3AgPSAwO1xyXG4gICAgICAgIGlmICgodGhpcy5kZy5lbmFibGVGaWx0ZXJSb3cgfHwgdGhpcy5kZy5lbmFibGVTbWFydEZpbHRlcikgJiYgdGhpcy5kZy5zaG93RmlsdGVyQmFyKSB7XHJcbiAgICAgICAgICAgIHRvcCArPSB0aGlzLmRnLmZpbHRlckJhckhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLnNob3dSb3dHcm91cFBhbmVsKSB7XHJcbiAgICAgICAgICAgIHRvcCArPSB0aGlzLmRnLnJvd0dyb3VwUGFuZWxIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnRvcCA9IHRvcDtcclxuICAgICAgICB0aGlzLnJlbmRlcjIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAndG9wJywgYCR7dG9wfXB4YCk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTaG93U2hhZG93KGZpeGVkTGVmdFdpZHRoKSB7XHJcbiAgICAgICAgY29uc3QgZGdDb250YWluZXJXaWR0aCA9IHRoaXMuZGcuZGdDb250YWluZXIubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgICAgICByZXR1cm4gZGdDb250YWluZXJXaWR0aCA8IHRoaXMuZGcuY29sR3JvdXAudG90YWxXaWR0aDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaXNDb2xzcGFuKGxlZnQsIHJpZ2h0LCBjb2wsIGlzZGF0YWZpZWxkID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoIWxlZnQgJiYgIXJpZ2h0KSB7XHJcbiAgICAgICAgICAgIGlmIChpc2RhdGFmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFjb2wuY29sc3BhbiAmJiAoIWNvbC5maXhlZCB8fCBjb2wuZml4ZWQgPT09ICdub25lJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sLmNvbHNwYW4gJiYgKCFjb2wuZml4ZWQgfHwgY29sLmZpeGVkID09PSAnbm9uZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChsZWZ0KSB7XHJcbiAgICAgICAgICAgIGlmIChpc2RhdGFmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFjb2wuY29sc3BhbiAmJiBjb2wuZml4ZWQgJiYgY29sLmZpeGVkID09PSAnbGVmdCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sLmNvbHNwYW4gJiYgY29sLmZpeGVkICYmIGNvbC5maXhlZCA9PT0gJ2xlZnQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChyaWdodCkge1xyXG4gICAgICAgICAgICBpZiAoaXNkYXRhZmllbGQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAhY29sLmNvbHNwYW4gJiYgY29sLmZpeGVkICYmIGNvbC5maXhlZCA9PT0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2wuY29sc3BhbiAmJiBjb2wuZml4ZWQgJiYgY29sLmZpeGVkID09PSAncmlnaHQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEZpeGVkQ29sdW1uUG9zaXRpb24oaXNTaG93LCBzY3JvbGxMZWZ0KSB7XHJcbiAgICAgICAgdGhpcy5zaG93U2hhZG93Q2xzID0gaXNTaG93O1xyXG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IGlzU2hvdyA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnO1xyXG4gICAgICAgIHRoaXMucmVuZGVyMlttZXRob2RdKHRoaXMuZml4ZWRSaWdodC5uYXRpdmVFbGVtZW50LCBGSVhFRF9SSUdIVF9TSEFET1dfQ0xTKTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVhbFdpZHRoID0gdGhpcy5jb2x1bW5zR3JvdXAubGVmdEZpeGVkV2lkdGggKyB0aGlzLmNvbHVtbnNHcm91cC5ub3JtYWxXaWR0aCArIHRoaXMucmlnaHRGaXhlZENvbHVtbldpZHRoO1xyXG4gICAgICAgIGNvbnN0IGdyaWRXaWR0aCA9IHRoaXMuZGcud2lkdGg7XHJcbiAgICAgICAgbGV0IGwgPSB0aGlzLmRnLndpZHRoIC0gKHRoaXMuZGcuc2hvd0JvcmRlciA/IDIgOiAwKSAtIHRoaXMucmlnaHRGaXhlZENvbHVtbldpZHRoO1xyXG4gICAgICAgIGlmIChncmlkV2lkdGggPiByZWFsV2lkdGgpIHtcclxuICAgICAgICAgICAgbCA9IHRoaXMuY29sdW1uc0dyb3VwLmxlZnRGaXhlZFdpZHRoICsgdGhpcy5jb2x1bW5zR3JvdXAubm9ybWFsV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlbmRlcjIuc2V0U3R5bGUodGhpcy5maXhlZFJpZ2h0Lm5hdGl2ZUVsZW1lbnQsICdsZWZ0JywgbCArICdweCcpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUm93TnVtZXJDb2x1bW5EYmxDbGljayhlOiBNb3VzZUV2ZW50LCBybnRkOiBhbnkpIHtcclxuICAgICAgICBsZXQgbWF4Um93TnVtYmVyID0gdGhpcy5kZy5nZXRSb3dzKCkubGVuZ3RoO1xyXG4gICAgICAgIGlmICh0aGlzLmRnLnBhZ2luYXRpb24pIHtcclxuICAgICAgICAgICAgY29uc3QgcGFnZVNpemUgPSB0aGlzLmRnLnBhZ2VTaXplO1xyXG4gICAgICAgICAgICBjb25zdCBwYWdlSW5kZXggPSB0aGlzLmRnLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgbWF4Um93TnVtYmVyID0gcGFnZVNpemUgKiBwYWdlSW5kZXggKyBwYWdlU2l6ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZGcubG9uZ1RleHRBcmVhLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gbWF4Um93TnVtYmVyO1xyXG4gICAgICAgIGNvbnN0IHcxID0gdGhpcy5kZy5sb25nVGV4dEFyZWEubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuXHJcbiAgICAgICAgY29uc3QgY3VycmVudFdpZHRoID0gcm50ZC5vZmZzZXRXaWR0aDtcclxuXHJcbiAgICAgICAgaWYgKHcxID4gY3VycmVudFdpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcubGluZU51bWJlcldpZHRoID0gdzEgKyAxMDtcclxuICAgICAgICAgICAgdGhpcy5kZnMudXBkYXRlUHJvcGVydHkoJ2xpbmVOdW1iZXJXaWR0aCcsIHRoaXMuZGcubGluZU51bWJlcldpZHRoKTtcclxuICAgICAgICAgICAgdGhpcy5kZnMucmVzaXplQ29sdW1ucygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblNvcnRDb2x1bW5DbGljayhlOiBNb3VzZUV2ZW50LCBjb2w6IERhdGFDb2x1bW4pIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNhYmxlU29ydCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWNvbC5zb3J0YWJsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOe7k+adn+e8lui+kVxyXG4gICAgICAgIHRoaXMuZGcuY2FuY2VsRWRpdChudWxsKTtcclxuICAgICAgICBjb25zdCBzb3J0TmFtZSA9IHRoaXMuZGcuc29ydE5hbWU7XHJcbiAgICAgICAgY29uc3Qgc29ydE9yZGVyID0gdGhpcy5kZy5zb3J0T3JkZXI7XHJcbiAgICAgICAgbGV0IHNvcnRGaWVsZHMgPSBbXTtcclxuICAgICAgICBsZXQgc29ydE9yZGVycyA9IFtdO1xyXG4gICAgICAgIGlmIChzb3J0TmFtZSkge1xyXG4gICAgICAgICAgICBzb3J0RmllbGRzID0gc29ydE5hbWUuc3BsaXQoJywnKTtcclxuICAgICAgICAgICAgc29ydE9yZGVycyA9IHNvcnRPcmRlci5zcGxpdCgnLCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29sT3JkZXIgPSBjb2wub3JkZXIgfHwgJ2FzYyc7XHJcbiAgICAgICAgbGV0IG5ld09yZGVyID0gY29sT3JkZXI7XHJcbiAgICAgICAgY29uc3QgaSA9IHNvcnRGaWVsZHMuZmluZEluZGV4KG4gPT4gbiA9PT0gY29sLmZpZWxkKTtcclxuICAgICAgICBpZiAoaSA+PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9vcmRlciA9IHNvcnRPcmRlcnNbaV0gPT09ICdhc2MnID8gJ2Rlc2MnIDogJ2FzYyc7XHJcbiAgICAgICAgICAgIG5ld09yZGVyID0gX29yZGVyO1xyXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5kZy5tdWx0aVNvcnQgJiYgbmV3T3JkZXIgPT09ICdhc2MnKSB7XHJcbiAgICAgICAgICAgIGlmIChuZXdPcmRlciA9PT0gJ2FzYycpIHtcclxuICAgICAgICAgICAgICAgIG5ld09yZGVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgc29ydEZpZWxkcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICBzb3J0T3JkZXJzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcnNbaV0gPSBfb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5tdWx0aVNvcnQpIHtcclxuICAgICAgICAgICAgICAgIHNvcnRGaWVsZHMucHVzaChjb2wuZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVycy5wdXNoKGNvbE9yZGVyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNvcnRGaWVsZHMgPSBbY29sLmZpZWxkXTtcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcnMgPSBbY29sT3JkZXJdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb2wub3JkZXIgPSBuZXdPcmRlcjtcclxuXHJcbiAgICAgICAgdGhpcy5kZy5zb3J0TmFtZSA9IHNvcnRGaWVsZHMuam9pbignLCcpO1xyXG4gICAgICAgIHRoaXMuZGcuc29ydE9yZGVyID0gc29ydE9yZGVycy5qb2luKCcsJyk7XHJcbiAgICAgICAgdGhpcy5kZnMuc2V0U29ydEluZm8odGhpcy5kZy5zb3J0TmFtZSwgdGhpcy5kZy5zb3J0T3JkZXIpO1xyXG5cclxuICAgICAgICB0aGlzLmRnLmJlZm9yZVNvcnRDb2x1bW4odGhpcy5kZy5zb3J0TmFtZSwgdGhpcy5kZy5zb3J0T3JkZXIsIHRoaXMuZGcpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcub25Db2x1bW5Tb3J0ZWQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tmaWx0ZXItcm93LWNyZWF0b3JdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRmlsdGVyUm93Q3JlYXRlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gICAgQElucHV0KCkgbGVmdDogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIHJpZ2h0OiBib29sZWFuO1xyXG5cclxuICAgIHByaXZhdGUgZGdzOiBEYXRhZ3JpZFNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjtcclxuICAgIHByaXZhdGUgZGZyczogRGF0YWdyaWRGaWx0ZXJTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBmaWx0ZXJSb3dUeXBlOiBhbnk7XHJcbiAgICBwcml2YXRlIGZpbHRlclJvd1JlZjogQ29tcG9uZW50UmVmPGFueT47XHJcbiAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZjtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdmM6IFZpZXdDb250YWluZXJSZWYsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsIHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHtcclxuXHJcbiAgICAgICAgdGhpcy5kZnMgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZEZhY2FkZVNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuZGdzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmNmciA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XHJcbiAgICAgICAgdGhpcy5jZCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKTtcclxuICAgICAgICB0aGlzLmRmcnMgPSB0aGlzLmRnLmNsaWVudEZpbHRlclNlcnZpY2U7XHJcblxyXG4gICAgICAgIHRoaXMuZmlsdGVyUm93VHlwZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KEdSSURfRklMVEVSX1JPVywgbnVsbCk7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLmNsZWFyRmlsdGVyLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpbHRlclJvd1JlZikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJSb3dSZWYuaW5zdGFuY2UuY2xlYXJGaWx0ZXJWYWx1ZShmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmRncy5jb2x1bW5zQ2hhbmdlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUZpbHRlclJvdyh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRmcnMpIHtcclxuICAgICAgICAgICAgdGhpcy5kZnJzLnJlbW92ZUZpZWxkLnN1YnNjcmliZSgoZikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZmlsdGVyUm93UmVmICYmIGYpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBfY29scyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxlZnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbHMgPSB0aGlzLmRnLmNvbEdyb3VwLmxlZnRGaXhlZCB8fCBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucmlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbHMgPSB0aGlzLmRnLmNvbEdyb3VwLnJpZ2h0Rml4ZWQgfHwgW107XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbHMgPSB0aGlzLmRnLmNvbEdyb3VwLm5vcm1hbENvbHVtbnMgfHwgW107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gISFfY29scy5maW5kKG4gPT4gbi5maWVsZCA9PT0gZik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJSb3dSZWYuaW5zdGFuY2UucmVtb3ZlRmllbGQoZik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVGaWx0ZXJSb3codHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIC8vIGlmIChjaGFuZ2VzLmNvbHVtbnNHcm91cCAmJiAhY2hhbmdlcy5jb2x1bW5zR3JvdXAuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuY3JlYXRlRmlsdGVyUm93KCk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDov4fmu6TooYwgKi9cclxuICAgIGNyZWF0ZUZpbHRlclJvdyhyZWJ1aWxkID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAocmVidWlsZCAmJiB0aGlzLmZpbHRlclJvd1JlZikge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclJvd1JlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUm93UmVmID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVGaWx0ZXJSb3coKTtcclxuICAgICAgICAgICAgaWYgKHJlYnVpbGQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY3JlYXRlRmlsdGVyUm93KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmVuYWJsZUZpbHRlclJvdykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZmlsdGVyUm93VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgY29sdW1uc0RhdGEgPSB0aGlzLmRnLmNvbEdyb3VwLm5vcm1hbENvbHVtbnM7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxlZnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbHVtbnNEYXRhID0gdGhpcy5kZy5jb2xHcm91cC5sZWZ0Rml4ZWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yaWdodCkge1xyXG4gICAgICAgICAgICAgICAgY29sdW1uc0RhdGEgPSB0aGlzLmRnLmNvbEdyb3VwLnJpZ2h0Rml4ZWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5maWx0ZXJSb3dSZWYgJiYgdGhpcy52Yykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2YgPSB0aGlzLmNmci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0aGlzLmZpbHRlclJvd1R5cGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJSb3dSZWYgPSB0aGlzLnZjLmNyZWF0ZUNvbXBvbmVudChjZik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclJvd1JlZi5pbnN0YW5jZS5jb2x1bW5zID0gY29sdW1uc0RhdGE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclJvd1JlZi5pbnN0YW5jZS5ncmlkSW5zdGFuY2UgPSB0aGlzLmRnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJSb3dSZWYuaW5zdGFuY2UuY29uZGl0aW9uQ2hhbmdlLnN1YnNjcmliZShuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb25zID0gbiB8fCB7fTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRncy5vbkZpbHRlckNoYW5nZWQuZW1pdChjb25kaXRpb25zKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4iXX0=