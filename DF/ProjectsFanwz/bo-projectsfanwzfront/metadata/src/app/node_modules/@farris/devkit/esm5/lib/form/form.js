import * as tslib_1 from "tslib";
// tslint:disable: max-line-length
import { Injectable } from '@angular/core';
import { filter } from 'rxjs/operators';
import { FormControl, FormGroup } from '@angular/forms';
import { BigNumber } from 'bignumber.js';
import { MetadataUtil } from '../metadata/index';
import { ChangeType } from '../binding-data/index';
import { NG_FORM_CONTROL, NG_CHILD_FORM, NG_VALIDATE_FORM } from './decorators';
import { DateUtil } from '../utils/index';
import { ValidationTypes } from '../entity/validator/validation_types';
import { ValidationExecutor } from '../entity/validator/validation_executor';
import * as ValidatorJS from 'validator';
import { DataTypeInfo, RunMode } from '../core';
import { TranslateService } from '../i18n/translate_service';
/**
 * 表单定义
 */
var Form = /** @class */ (function (_super) {
    tslib_1.__extends(Form, _super);
    /**
     * 构造函数
     */
    function Form() {
        var _this = _super.call(this, {}, null, null) || this;
        _this.raisedByValidateEffector = false;
        _this.isShowValidationMsg = false;
        _this.validatorJs = ValidatorJS.default;
        _this.controlIdMap = {};
        _this.cardControls = {};
        _this.isShowPropMap = {};
        return _this;
        // this.excludeRuleTypes = {};
    }
    Object.defineProperty(Form.prototype, "formGroupName", {
        /**
         * 名称
         */
        get: function () {
            return this.ngValidateForm ? this.ngValidateForm.formGroupName : '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "enableValidate", {
        /**
         * 是否启用表单验证
         */
        get: function () {
            return this.ngValidateForm ? this.ngValidateForm.enableValidate : false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Form.prototype, "translateService", {
        get: function () {
            return this.translate;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 将formControl的错误信息更新到cardControl上
     */
    Form.updateErrors = function (propertyName, errorObj, id, value, isGrid) {
        Object.keys(Form.insMap).forEach(function (key) {
            var form = Form.insMap[key];
            if (!form) {
                return;
            }
            if (id) {
                form.setControlValue(propertyName, value);
            }
            if (form.enableValidate) {
                form.isFormValid(propertyName, errorObj, id, isGrid);
            }
        });
    };
    /**
     * 设置dom属性为显示状态
     * @param domPropertyName dom属性
     */
    Form.prototype.setIsShowmap = function (domPropertyName) {
        this.isShowPropMap[domPropertyName] = true;
    };
    Form.prototype.setShowValidationMsg = function (flag) {
        this.raisedByValidateEffector = false;
        this.isShowValidationMsg = flag;
    };
    Form.prototype.setControlValue = function (key, value) {
        var bindingObject = this.bindingData && this.bindingData.getObject() || null;
        if (bindingObject && bindingObject.controlMap) {
            bindingObject.controlMap[key] = this.getGridItemControl(key, value);
        }
    };
    /**
     * 根据dom属性名称获取错误信息
     * @param domPropertyName dom属性名称
     */
    Form.prototype.getCardControlErrors = function (domPropertyName) {
        this.setIsShowmap(domPropertyName);
        return this.cardControls[domPropertyName] && this.cardControls[domPropertyName].errors;
    };
    /**
     * 获取字段校验错误
     * @param domPropertyName
     * @returns
     */
    Form.prototype.getFormControlErrors = function (domPropertyName) {
        return this.cardControls[domPropertyName] && this.cardControls[domPropertyName].errors;
    };
    Form.prototype.getGridControlErrors = function (domPropertyName, id) {
        this.setIsShowmap(domPropertyName);
        return this.controlIdMap[id] && this.controlIdMap[id][domPropertyName] && this.controlIdMap[id][domPropertyName]['errors'];
    };
    Form.prototype.isFormValid = function (propertyName, errorObj, id, isGrid) {
        var _this = this;
        var prefix = '';
        // 如果校验信息是由表达式触发的，不处理
        if (this.raisedByValidateEffector) {
            return;
        }
        if (isGrid === true) {
            // 如果是grid，说明是子表，需要拼接子表frontNodeCode
            var bindingPaths = this.bindingPath.split('/').filter(function (p) { return p; });
            if (bindingPaths.length > 0) {
                prefix = bindingPaths.join('.').concat('.');
            }
        }
        // 界面上绑定的字段名
        var domPropertyName = this.getDomPropertyNameByEntityProp(propertyName, prefix);
        // 传了属性名，但却拿不到dom名称，说明当前组件中没有该字段对应的控件
        if (propertyName && !domPropertyName) {
            return true;
        }
        // 若界面上不存在当前属性（动态列），不进行验证
        if (domPropertyName && !this.isShowPropMap[domPropertyName]) {
            return true;
        }
        var isValid = true;
        var bindingObject = this.bindingData.getObject();
        var currentId = bindingObject.primaryKeyValue;
        var isSubForm = this.bindingPath !== '/';
        var bindingList = this.bindingData.getList();
        // 子表单无数据时，保存时会有一条空数据阻碍验证，所以此处跳过只有一行的情况
        if (isSubForm && bindingList.innerList.size === 0) {
            return true;
        }
        // 无数据时不做校验
        if (!currentId) {
            return true;
        }
        // dataGrid修改时，根据id，创建formControl，并设置错误对象
        if (id && domPropertyName) {
            // if (this.controlIdMap[id] && Object.keys(this.controlIdMap[id]).length === 0) {
            //   this.controlIdMap[id] = {};
            // }
            this.controlIdMap[id] = this.controlIdMap[id] || {};
            this.controlIdMap[id][domPropertyName] = {
                errors: errorObj
            };
        }
        // 将grid的FormControl同步到界面展示用的controlIDMap中
        // const currentBindingObject = bindingList.currentItem as BindingObject;
        var currentBindingObject = bindingObject;
        if (id && id !== currentId) {
            return;
        }
        // 验证全部字段时，清空已有的错误信息
        if (!propertyName && !id) {
            currentBindingObject.controlMap = {};
            this.controlIdMap = {};
            this.cardControls = {};
        }
        Object.keys(this.controls).forEach(function (key) {
            if (_this.isShowPropMap[key] !== true) {
                return;
            }
            // 同步实体错误信息
            if (key === domPropertyName) {
                // 实体验证的信息直接赋值
                if (errorObj && Object.keys(errorObj).length > 0) {
                    // 卡片的错误
                    if (!isGrid) {
                        // 实体层同步过来的错误，目前结构{ruleType:{name:'',value:'',originalErrors:[ValidationError]}}，其中name为校验失败的错误信息
                        // 遍历错误，将validator返回的错误信息国际化
                        Object.keys(errorObj).map(function (validType) {
                            var validationError = errorObj[validType] && errorObj[validType]['error'] || null;
                            if (validationError) {
                                var validateRule = validationError.rule;
                                var ngFormControl = _this.getngFormControlByBinding(validateRule.property);
                                if (ngFormControl) {
                                    validateRule.property = ngFormControl.name;
                                    validateRule.targetId = ngFormControl.id;
                                    validateRule.targetName = _this.formGroupName;
                                    var messageTemplate = ValidationTypes.getMessage(validType);
                                    var invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, validateRule, ngFormControl.name);
                                    errorObj[validType]['name'] = invalidMessage;
                                }
                                // todo: ngFormControl暂时不设置
                                // errorObj['name'] = this.getErrorByRuleType(validType, validateRule, null);
                            }
                        });
                        _this.cardControls[key] = {
                            errors: errorObj
                        };
                    }
                }
                else {
                    _this.cardControls[key] = {};
                }
            }
            if (_this.controls[key] && _this.controls[key].errors && Object.keys(_this.controls[key].errors).length > 0) {
                // 将错误同步到界面展示的位置
                // 认为控件错误只包含错误类型，通过错误类型获取具体的错误信息
                _this.cardControls[key] = {
                    errors: tslib_1.__assign({}, _this.cardControls[key] && _this.cardControls[key].errors, _this.controls[key].errors)
                };
                // 处理只开启前端校验，未在BE上启用必填校验的情况
                if (_this.cardControls) {
                    Object.keys(_this.cardControls).forEach(function (key) {
                        if (_this.cardControls[key] && _this.cardControls[key].errors) {
                            Object.keys(_this.cardControls[key].errors).forEach(function (validType) {
                                if (typeof _this.cardControls[key].errors[validType] !== 'object') {
                                    // 获取对应的校验信息
                                    var validateRules = _this.ngFormControls[key].validRules || [];
                                    var rules = [].concat(validateRules);
                                    var validateRule = rules.find(function (item) { return item.type === validType; });
                                    if (validateRule) {
                                        validateRule.targetName = _this.formGroupName;
                                        var messageTemplate = ValidationTypes.getMessage(validType);
                                        var invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, validateRule, '');
                                        _this.cardControls[key].errors[key] = { value: _this.controls[key] && _this.controls[key].value || '', name: invalidMessage };
                                    }
                                }
                            });
                        }
                    });
                }
                isValid = false;
                return false;
            }
        });
        Object.keys(this.cardControls).forEach(function (key) {
            if (_this.cardControls[key] && _this.cardControls[key].errors && Object.keys(_this.cardControls[key].errors).length > 0) {
                isValid = false;
                return false;
            }
        });
        return isValid;
    };
    /**
     * 更新表单错误信息
     * @param errors 错误消息
     */
    Form.prototype.updateFormErrors = function (errors, forceShow, from) {
        var _this = this;
        if (forceShow === void 0) { forceShow = false; }
        if (from === void 0) { from = ''; }
        if (from && from === 'backend') {
            this.clearBackendError();
        }
        // 原来是否已经显示错误，如果已经显示了则增加，否则替换
        if (this.isShowValidationMsg === true || forceShow === true) {
            this.isShowValidationMsg = true;
            Object.keys(errors).forEach(function (key) {
                if (errors[key].errors && Object.keys(errors[key].errors).length > 0) {
                    _this.cardControls[key] = {
                        errors: tslib_1.__assign({}, _this.cardControls[key] && _this.cardControls[key].errors, errors[key].errors)
                    };
                }
                else {
                    // 移除内存中的错误信息
                    _this.cardControls[key] = {
                        errors: {}
                    };
                    // 重置控件错误信息
                    _this.controls[key].setErrors(null);
                    _this.controls[key].markAsTouched();
                }
            });
        }
    };
    /**
     * 清空后端消息
     */
    Form.prototype.clearBackendError = function () {
        var _this = this;
        Object.keys(this.cardControls).forEach(function (key) {
            var errors = _this.cardControls[key] && _this.cardControls[key].errors || null;
            if (errors) {
                Object.keys(errors).forEach(function (errorType) {
                    if (errorType && errorType.startsWith('backend-message-')) {
                        delete errors[errorType];
                    }
                });
                if (errors && Object.keys(errors).length === 0) {
                    delete _this.cardControls[key].errors;
                }
            }
            else {
                _this.cardControls[key] = {};
            }
        });
    };
    /**
     * 根据实体属性获取ngFormControl
     * @param binding 控件绑定的实体属性名
     */
    Form.prototype.getngFormControlByBinding = function (binding) {
        return Object.values(this.ngFormControls).find(function (ngFormControl) { return ngFormControl.binding && ngFormControl.binding === binding; });
    };
    /**
     * 根据dom属性和校验类型获取错误信息
     * @param domProperty dom属性
     * @param validateRuleType 校验类型
     */
    Form.prototype.getErrorMessage = function (domProperty, validateRuleType) {
        var formControl = this.ngFormControls[domProperty];
        if (formControl) {
            var validRules = formControl.validRules;
            var rules = [];
            if (!Array.isArray(validRules)) {
                rules.push(validRules);
            }
            else {
                rules.push.apply(rules, tslib_1.__spread(validRules));
            }
            var rule = rules.find(function (item) { return item.type === validateRuleType; });
            if (rule) {
                var controlName = formControl.name;
                var messageTemplate = ValidationTypes.getMessage(validateRuleType);
                var message = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, rule, controlName);
                return message;
            }
            return null;
        }
        return null;
    };
    /**
     * 初始化Form
     * @param context 上下文
     */
    Form.prototype.init = function (bindingData, bindingPath, frameContext) {
        this.frameContext = frameContext;
        this.bindingData = bindingData;
        this.bindingPath = bindingPath;
        this.buildForm();
        // @todo: 这种方式做key，如果脚本被压缩，存在风险
        Form.insMap[this.constructor.name] = this;
    };
    /**
     * 构造表单
     */
    Form.prototype.buildForm = function () {
        this.collectMetadatas();
        // this.createChildFormArrays();
        this.createChildForms();
        this.createControls();
    };
    /**
     * 重置表单验证信息
     */
    Form.prototype.resetCardValidMsg = function () {
        var _this = this;
        this.cardControls = {};
        // 剔除 列表中新增后取消,删除的项对应的control信息
        Object.keys(this.controlIdMap).forEach(function (id) {
            if (!_this.bindingData.getList().innerList.map(function (x) { return x.id; }).includes(id)) {
                delete _this.controlIdMap[id];
            }
        });
        this.resetFormControls();
        this.setShowValidationMsg(false);
    };
    /**
     * 更新字段校验规则
     * @param propertyName 属性名
     * @param isRequired 是否必填
     */
    Form.prototype.updateFieldValidateRule = function (propertyName, isRequired) {
        var _this = this;
        var formControl = this.controls[propertyName];
        // 清空全部校验条件
        if (formControl) {
            formControl.clearValidators();
            formControl.markAsUntouched();
            formControl.markAsPristine();
            formControl.setErrors([]);
        }
        // 动态必填场景时生成器不再在formControl上生成必填规则
        // 因此validRules可能为空
        var ngFormControl = this.ngFormControls[propertyName];
        var validateRules = ngFormControl && ngFormControl.validRules || [];
        if (!Array.isArray(validateRules)) {
            validateRules = [validateRules];
        }
        var requiredRuleIndex = validateRules.findIndex(function (validateRule) { return validateRule.type === ValidationTypes.REQUIRED; });
        if (isRequired) {
            // 必填但控件没有必填规则，添加必填规则
            if (requiredRuleIndex == -1) {
                var validateRule = { type: ValidationTypes.REQUIRED, constraints: [true] };
                // 扩展属性，以生成正确的错误提示
                var displayFieldName = ngFormControl && (ngFormControl.name || ngFormControl.defaultI18nValue) || '';
                validateRule.targetId = ngFormControl && ngFormControl.id || null;
                validateRule.targetName = this.formGroupName;
                validateRule.property = displayFieldName;
                validateRule.field = ngFormControl && ngFormControl.binding;
                validateRules.push(validateRule);
            }
        }
        else {
            // 非必填场景，如果有必填规则，移除
            if (requiredRuleIndex !== -1) {
                validateRules.splice(requiredRuleIndex, 1);
            }
        }
        // 整理校验规则
        var validators = [];
        Array.prototype.forEach.call(validateRules, (function (ruleObj) {
            var validateFn = _this.getValidatorByRuleObj(ruleObj, _this.ngFormControls[propertyName]);
            if (validateFn) {
                validators.push(validateFn);
            }
        }));
        this.ngFormControls[propertyName].validRules = validateRules;
        this.controls[propertyName].setValidators(validators);
    };
    Form.prototype.addFieldValidateRule = function (propertyName, message, expressionId, ruleType) {
        var formControl = this.controls[propertyName];
        if (formControl) {
            // 清空全部校验条件
            formControl.setErrors(null);
        }
        var ngFormControl = this.ngFormControls[propertyName];
        var validateRules = this.ngFormControls[propertyName].validRules;
        if (!validateRules) {
            validateRules = [];
        }
        if (!Array.isArray(validateRules)) {
            validateRules = [validateRules];
        }
        var index = validateRules.findIndex(function (rule) { return rule && rule.expressionId === expressionId; });
        if (index !== -1) {
            validateRules.splice(index, 1);
        }
        var bindingPath = this.frameContext.viewModel.bindingPath;
        var bindingPaths = bindingPath.split('/').filter(function (p) { return p; });
        var fieldName = propertyName;
        if (bindingPaths.length !== 0) {
            var prefix = bindingPaths.join('/');
            var binding = ngFormControl.binding || '';
            var property = binding.split('.').join('/');
            fieldName = prefix + "/" + property;
        }
        var context = this.frameContext;
        var validateRule = {
            type: ruleType,
            message: message,
            expressionId: expressionId,
            constraints: [],
            bindingPath: bindingPaths.join('/'),
            eval: function (options) {
                return context.viewModel.expression.validate(expressionId, options);
            }
        };
        validateRules.push(validateRule);
        this.ngFormControls[propertyName].validRules = validateRules;
        // if (this.ngFormControls[propertyName] && validateRules.length > 0) {
        //   const validators: ValidatorFn[] = [];
        //   Array.prototype.forEach.call(validateRules, ((ruleObj: ValidateRule) => {
        //     const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propertyName]);
        //     if (validateFn) {
        //       validators.push(validateFn);
        //     }
        //   }));
        //   this.controls[propertyName].setValidators(validators);
        // }
    };
    /**
     * 根据规则对象生成validator
     * @param ruleObj: ValidateRule
     */
    Form.prototype.getValidatorByRuleObj = function (ruleObj, ngFormControl) {
        var _this = this;
        var type = ruleObj.type, _a = ruleObj.constraints, constraints = _a === void 0 ? [] : _a, _b = ruleObj.message, message = _b === void 0 ? null : _b;
        var displayText = ngFormControl.name || ngFormControl.defaultI18nValue || '';
        var ruleHandlerObj = {
            required: function (control) {
                var value = control.value;
                var isValid = value !== '' && value !== null && value !== undefined && value !== '0001-01-01' && value !== '0001-01-01 00:00:00' && value !== '0001-01-01T00:00:00';
                var parentPaths = _this.bindingPath.split('/').filter(function (p) { return p; });
                var controlPaths = ngFormControl.binding.split('.');
                var paths = parentPaths.concat(controlPaths);
                var propInfo = _this.getPropInfoByPath(paths);
                var isMultiLangInput = propInfo && propInfo.metadataInfo.enableMultiLangInput;
                if (isMultiLangInput) {
                    var currentLanguage = TranslateService.getCurrentLanguage();
                    var currentLangValue = value && value[currentLanguage];
                    isValid = currentLangValue !== '' && currentLangValue !== null && currentLangValue !== undefined && currentLangValue !== '0001-01-01' && currentLangValue !== '0001-01-01 00:00:00' && currentLangValue !== '0001-01-01T00:00:00';
                }
                var messageTemplate = ValidationTypes.getMessage(ValidationTypes.REQUIRED);
                var invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                if (isValid && control.errors && control.errors.required) {
                    // 修复帮助映射早于控件赋值导致汇总错误消息时帮助必填错误未被清空的问题
                    delete control.errors.required;
                    _this.isFormValid(paths.join('.'));
                }
                return isValid ? null : { required: { value: control.value, name: invalidMessage } };
            },
            maxLength: function (control) {
                var isInValid = control.value && control.value.toString().length > constraints[0];
                var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_LENGTH);
                var invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                return isInValid ? { maxLength: { value: control.value, name: invalidMessage } } : null;
            },
            minLength: function (control) {
                var isInValid = control.value && control.value.toString().length < constraints[0];
                var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_LENGTH);
                var invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                return isInValid ? { minLength: { value: control.value, name: invalidMessage } } : null;
            },
            minValue: function (control) {
                var isInValid = false;
                var invalidMessage = '';
                // 这里只做最小值判断，如果用户未输入则不应该做判断
                if (control.value === null || control.value === undefined) {
                    return null;
                }
                if (typeof control.value === 'number' && typeof constraints[0] === 'number') {
                    isInValid = control.value < constraints[0];
                    var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MINVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                    // invalidMessage = `${ngFormControl.name}的值不应小于${constraints[0]}`;
                }
                else if (ngFormControl && ngFormControl.bigNumber === true) {
                    // 大数
                    var minValue = new BigNumber(constraints[0]);
                    var value = new BigNumber(control.value);
                    isInValid = minValue.isGreaterThan(value);
                    var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MINVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                else {
                    var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MIN_DATE);
                    // 假定为日期
                    // 不管控件的值为什么，只要条件不存咋或是null或0或undefined或""，则不对比大小，无意义
                    if (!constraints || constraints.length < 1 || !constraints[0]) {
                        return null;
                    }
                    if (control.value instanceof Date) {
                        isInValid = control.value < new Date(constraints[0]);
                    }
                    else {
                        isInValid = new Date(control.value) < new Date(constraints[0]);
                    }
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                return isInValid ? { minValue: { value: control.value, name: invalidMessage } } : null;
            },
            maxValue: function (control) {
                var isInValid = false;
                var invalidMessage = '';
                if (control.value === null || control.value === undefined) {
                    return null;
                }
                if (typeof control.value === 'number' && typeof constraints[0] === 'number') {
                    isInValid = control.value > constraints[0];
                    var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAXVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                    // invalidMessage = `${ngFormControl.name}的值不应大于${constraints[0]}`;
                }
                else if (ngFormControl && ngFormControl.bigNumber === true) {
                    // 大数
                    var maxValue = new BigNumber(constraints[0]);
                    var value = new BigNumber(control.value);
                    isInValid = maxValue.isLessThan(value);
                    var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAXVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                else {
                    // 假定为日期
                    var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_DATE);
                    if (control.value instanceof Date) {
                        isInValid = control.value > new Date(constraints[0]);
                        // invalidMessage = `${ngFormControl.name}的值不应晚于${constraints[0]}`;
                    }
                    else {
                        isInValid = new Date(control.value) > new Date(constraints[0]);
                        // invalidMessage = `${ngFormControl.name}的值不应早于${constraints[0]}`;
                    }
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                return isInValid ? { maxValue: { value: control.value, name: invalidMessage } } : null;
            },
            exclude: function (control) {
                var isValid = typeof control.value === 'string' && !_this.validatorJs.contains(control.value, constraints[0]);
                var messageTemplate = ValidationTypes.getMessage(ValidationTypes.EXCLUDE);
                var invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                return isValid ? null : { exclude: { value: control.value, name: invalidMessage } };
            },
            matches: function (control) {
                var value = (control.value === null || control.value === undefined) ? '' : control.value.toString();
                var isValid = value === '' ? true : _this.validatorJs.matches(value, constraints[0]);
                var invalidMessage = message;
                if (!invalidMessage) {
                    var messageTemplate = ValidationTypes.getMessage(ValidationTypes.MATCHES);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                return isValid ? null : { matches: { value: control.value, name: invalidMessage } };
            }
        };
        return ruleHandlerObj[type];
    };
    /**
     * 搜集属性装饰器
     */
    Form.prototype.collectMetadatas = function () {
        this.ngValidateForm = this.frameContext.metadata.form ? MetadataUtil.translateMetadataByName(this.frameContext.metadata.form, this.translateService, ['formGroupName']) :
            MetadataUtil.getClassMetadataByNameWithTranslate(this.constructor, NG_VALIDATE_FORM, this.translateService, ['formGroupName']);
        this.ngFormControls = this.collectionFormControlMetadats(this.frameContext.metadata.formControls);
        this.ngChildForms = this.frameContext.metadata.subForms || MetadataUtil.getPropsMetadatasByName(this.constructor, NG_CHILD_FORM);
    };
    Form.prototype.collectionFormControlMetadats = function (preloadMetadata) {
        var _this = this;
        if (preloadMetadata === void 0) { preloadMetadata = null; }
        var metadatas = preloadMetadata ? MetadataUtil.translateMetadataByName(preloadMetadata, this.translateService, ['name']) :
            MetadataUtil.getPropsMetadatasByNameWithTranslate(this.constructor, NG_FORM_CONTROL, this.translateService, ['name']);
        // 向验证规则中附加表单信息，用于显示验证提示。
        if (metadatas) {
            Object.keys(metadatas).forEach(function (propName) {
                var ngFormControl = metadatas[propName];
                var displayFieldName = ngFormControl.name || ngFormControl.defaultI18nValue || '';
                var formControlId = ngFormControl.id;
                if (Array.isArray(ngFormControl.validRules)) {
                    ngFormControl.validRules.forEach(function (validationRule) {
                        validationRule.targetId = formControlId;
                        validationRule.targetName = _this.formGroupName;
                        validationRule.property = displayFieldName;
                        validationRule.field = ngFormControl.binding;
                    });
                }
            });
        }
        return metadatas;
    };
    // 获取grid中每条数据的formControl
    Form.prototype.getGridItemControl = function (propName, value) {
        var _this = this;
        var createControlFromRules = function (propertyName) {
            var validators = [];
            // 设置form中定义的验证规则
            if (_this.ngFormControls[propertyName] && Array.isArray(_this.ngFormControls[propertyName].validRules)) {
                Array.prototype.forEach.call(_this.ngFormControls[propertyName].validRules, (function (ruleObj) {
                    var validateFn = _this.getValidatorByRuleObj(ruleObj, _this.ngFormControls[propertyName]);
                    if (validateFn) {
                        validators.push(validateFn);
                    }
                }));
            }
            return new FormControl(value, { validators: validators, updateOn: 'blur' });
        };
        return createControlFromRules(propName);
    };
    // 根据实体属性名获取界面绑定的属性名
    Form.prototype.getDomPropertyNameByEntityProp = function (propertyName, prefix) {
        var _this = this;
        if (prefix === void 0) { prefix = ''; }
        var domPropertyName = '';
        Object.keys(this.ngFormControls).forEach(function (key) {
            var binding = "" + prefix + _this.ngFormControls[key].binding;
            if (binding === propertyName) {
                domPropertyName = key;
            }
        });
        return domPropertyName;
    };
    /**
     * 创建FormControl
     */
    Form.prototype.createControls = function () {
        var _this = this;
        Object.keys(this.ngFormControls).forEach(function (propName) {
            var ngFormControl = _this.ngFormControls[propName];
            var validators = [];
            // 设置form中定义的验证规则
            if (Array.isArray(_this.ngFormControls[propName].validRules)) {
                Array.prototype.forEach.call(_this.ngFormControls[propName].validRules, (function (ruleObj) {
                    var validateFn = _this.getValidatorByRuleObj(ruleObj, _this.ngFormControls[propName]);
                    if (validateFn) {
                        validators.push(validateFn);
                    }
                }));
            }
            var updateOn = ngFormControl.updateOn ? ngFormControl.updateOn : 'blur';
            var control = new FormControl(null, { validators: validators, updateOn: updateOn });
            if (ngFormControl.binding) {
                _this.setUpBindingDataPipeline(control, ngFormControl.binding, ngFormControl.valueConverter);
            }
            _this.controls[propName] = control;
            _this[propName] = control;
        });
    };
    /**
     * 创建FormGroup
     */
    Form.prototype.createChildForms = function () {
        var _this = this;
        Object.keys(this.ngChildForms).forEach(function (propName) {
            var ngFormGroup = _this.ngChildForms[propName];
            // 构造子Form
            var formGroup = new ngFormGroup.formType();
            formGroup.init(_this.bindingData, _this.bindingPath, _this.frameContext);
            _this.controls[propName] = formGroup;
            _this[propName] = formGroup;
        });
    };
    /*
    * 新增FormControls
     */
    Form.prototype.addControls = function (column, converter) {
        var updateOn = column && column.editor && column.editor.updateOn ? column.editor.updateOn : 'blur';
        var formControl = new FormControl('', { updateOn: updateOn });
        var fieldPath = column.dataField;
        // 日期格式  需要格式化
        // this.setUpBindingDataPipeline(formControl, fieldPath, converter);
        if (column.editor && column.editor.binding) {
            this.setUpBindingDataPipeline(formControl, fieldPath, converter);
            this.controls[column.editor.binding.path] = formControl;
            this[column.editor.binding.path] = formControl;
        }
    };
    /**
     * 搭建control和table之间的通道
     * @param control 控件
     * @param bindingFieldPath 绑定的字段名
     */
    Form.prototype.setUpBindingDataPipeline = function (control, bindingFieldPath, converter) {
        var _this = this;
        if (!this.bindingData) {
            throw Error('当前组件上下文中找不到BindingData，请检查！');
        }
        // 如果converter存在，则写入上下文，Converter中可能会需要从injector中获取当前语言信息
        if (converter) {
            converter['__FRAME_CONTEXT__'] = this.frameContext;
        }
        // 将bindignPath与bindingFieldPath合并
        if (this.bindingPath.length > 1) {
            bindingFieldPath = this.bindingPath.substr(1).replace(/\//g, '.') + '.' + bindingFieldPath;
        }
        var bindingPaths = bindingFieldPath.split('.');
        var propertyName = bindingPaths[bindingPaths.length - 1];
        // 设置初始值
        var initValue = this.getValueFromBindingData(bindingPaths, converter);
        control.setValue(initValue);
        // 设置初始值
        // BindingData => control
        this.bindingData.changes.pipe(filter(function (change) {
            var bindingObject = _this.bindingData.getObject();
            var changePath = change.path.join('.');
            if (change.isUdt) {
                return changePath === bindingFieldPath;
            }
            if (change.type === ChangeType.ValueChanged) {
                // path完全匹配
                return changePath === bindingFieldPath;
            }
            else if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged || change.type === ChangeType.Remove || change.type === ChangeType.Update) {
                // 对于ObjectChanged、SelectionChanged，匹配到父级
                var changePathWithDot = changePath === '' ? changePath : changePath + '.';
                // 主表新增或切换时，重置错误信息
                if (change && change.type === ChangeType.Load) {
                    _this.resetCardValidMsg();
                }
                return bindingFieldPath.indexOf(changePathWithDot) === 0;
            }
            else if (change.type === ChangeType.UpdateErrors) {
                if (changePath === bindingFieldPath) {
                    _this.cardControls[propertyName] = _this.cardControls[propertyName] || {};
                    if (bindingFieldPath && _this.controls[propertyName]) {
                        if (bindingObject.primaryKeyValue === change.id) {
                            _this.cardControls[propertyName].errors = change.errors;
                        }
                        else {
                            // 只更新当前行的错误提示信息，不是当前行的不处理，放到最终的实体校验里面
                            // this.cardControls[propertyName].errors = null;
                            // this.isFormValid(bindingFieldPath);
                        }
                    }
                    // 没有错误时
                    if (!change.path || !bindingFieldPath || !change.errors) {
                        _this.cardControls[propertyName].errors = null;
                        _this.isFormValid(bindingFieldPath);
                    }
                    return false;
                }
            }
            else {
                return false;
            }
        })).subscribe(function (change) {
            var fullEntityProp = propertyName;
            // udt字段展示时需要将父级属性名和自身属性名用'_'连接
            var pathPrefix = '';
            if (change.isUdt) {
                if (change.isGrid) {
                    // grid 将从表主字段去除
                    change.path.shift();
                }
                if (change.path.length) {
                    pathPrefix = change.path.join('.');
                }
                fullEntityProp = pathPrefix;
            }
            var value = _this.bindingData.getValue(bindingPaths, false);
            var newControlValue = converter ? converter.convertFrom(value) : value;
            // 设置FormControl
            var domPropName = _this.getDomPropertyNameByEntityProp(fullEntityProp);
            _this.cardControls[domPropName] = _this.cardControls[domPropName] || {};
            if (change.errors) {
                _this.cardControls[domPropName].errors = change.errors;
            }
            // dataGrid保存时，根据id，创建formControl，并设置错误对象
            if (change.id) {
                if (_this.controlIdMap[change.id] && Object.keys(_this.controlIdMap[change.id]).length === 0) {
                    _this.controlIdMap[change.id] = {};
                }
                _this.controlIdMap[change.id] = _this.controlIdMap[change.id] || {};
                if (change.errors) {
                    _this.controlIdMap[change.id][domPropName] = {
                        errors: change.errors
                    };
                }
            }
            // 如果和控件上的值一样，则不再更新控件的值
            if (JSON.stringify(control.value) === JSON.stringify(newControlValue)) {
                return;
            }
            // 正则判断是否为日期
            control.setValue(newControlValue);
        });
        // control => BindingData
        control.valueChanges.subscribe(function (value) {
            var oldBindingValue = _this.bindingData.getValue(bindingPaths);
            // 如果是日期，比较年月日是否相等，相等则不重新赋值
            if (value && value.constructor && value.constructor.name === 'Date') {
                if (oldBindingValue && converter) {
                    var oldValue = converter.convertFrom(oldBindingValue);
                    if (_this.compareDate(value, oldValue) === true) {
                        return;
                    }
                }
            }
            // 如果是日期，比较年月日是否相等，相等则不重新赋值
            if (_this.isDate(converter) === true) {
                if (DateUtil.isEqual(value, oldBindingValue) === true) {
                    return;
                }
            }
            // 如果和BindingData上的值和控件最新的值一样，则不再更新BindingData
            var newBindingValue = converter ? converter.convertTo(value) : value;
            if (JSON.stringify(oldBindingValue) === JSON.stringify(newBindingValue)) {
                return;
            }
            // if (!this.isFormValid(propertyName, null, null, false)) {
            //   const errors = this.cardControls[propertyName] && this.cardControls[propertyName].errors || {};
            //   this.bindingData.setValue(bindingPaths, newBindingValue, false, true, errors);
            // } else {
            _this.clearBackEndMessages(propertyName);
            var emitEventToView = _this.frameContext.appContext.runMode === RunMode.highSpeed;
            _this.bindingData.setValue(bindingPaths, newBindingValue, emitEventToView, true, null, { frameContext: _this.frameContext });
            //}
        });
    };
    /**
     * 判断是否是日期字段
     * 1、目前没有办法判断一个字段是否是日期，只能根据Converter来判断；
     * 2、Devkit不能依赖KendoBinding，不能直接判断DateConverter；
     * 3、不能使用constructor.name,压缩后name变了；
     * 4、暂时根据format属性来判断，一旦其他Converter有format，则判断失效，暂时没有这种情况
     * @todo
     * 为日期字段添加注解，根据注解来判断
     */
    Form.prototype.isDate = function (converter) {
        var isDateConverter = false;
        // if (converter && converter.constructor && converter.constructor.name === 'DateConverter') {
        //   isDateConverter = true;
        // }
        if (converter && converter.hasOwnProperty('format') === true) {
            isDateConverter = true;
        }
        return isDateConverter;
    };
    /**
     * 比较日期（只比较年月日）
     */
    Form.prototype.compareDate = function (srcDate, dstDate) {
        if (!srcDate || !dstDate) {
            return srcDate === dstDate;
        }
        var isEqual = srcDate.getFullYear() === dstDate.getFullYear()
            && srcDate.getMonth() === dstDate.getMonth()
            && srcDate.getDate() === dstDate.getDate()
            && srcDate.getHours() === dstDate.getHours()
            && srcDate.getMinutes() === dstDate.getMinutes()
            && srcDate.getSeconds() === dstDate.getSeconds();
        return isEqual;
    };
    Form.prototype.getPropInfoByPath = function (path) {
        var entityType = this.frameContext && this.frameContext.repository.entityType || null;
        if (entityType) {
            var dataTypeInfo = new DataTypeInfo(entityType);
            var propInfo = dataTypeInfo.getPropInfoByPath(path);
            return propInfo;
            // const isMultiLangInput = propInfo.metadataInfo.enableMultiLangInput;
        }
        return null;
    };
    /**
     * 从BindingData中获取指定路径的值
     */
    Form.prototype.getValueFromBindingData = function (bindingPaths, converter) {
        var value = this.bindingData.getValue(bindingPaths);
        var converteredValue = converter ? converter.convertFrom(value) : value;
        return converteredValue;
    };
    Form.prototype.getEntityValueChangingListeners = function () {
        var _this = this;
        var listeners = {};
        Object.keys(this.ngFormControls).forEach(function (propName) {
            var ngFormControl = _this.ngFormControls[propName];
            if (ngFormControl.valueChanging) {
                listeners[ngFormControl.binding] = ngFormControl.valueChanging;
            }
        });
        return listeners;
    };
    Form.prototype.getEntityValueChangedListeners = function () {
        var _this = this;
        var listeners = {};
        Object.keys(this.ngFormControls).forEach(function (propName) {
            var ngFormControl = _this.ngFormControls[propName];
            if (ngFormControl.valueChanged) {
                listeners[ngFormControl.binding] = ngFormControl.valueChanged;
            }
        });
        return listeners;
    };
    /**
     * 获取所有的前端验证规则
     * @description
     * 返回的校验规则为Map<string,ValidateRule>,其中key为全路径，从bindingPath开始到实体属性，以/分隔
     */
    Form.prototype.getValidationRules = function () {
        var _this = this;
        var validatoinRules = new Map();
        var parentPath = this.bindingPath;
        if (parentPath.length && parentPath === '/') {
            parentPath = '';
        }
        Object.keys(this.ngFormControls).forEach(function (propName) {
            // const fieldName = `${parentPath}/${propName}`;
            if (_this.isShowPropMap[propName] === true || Object.keys(_this.isShowPropMap).length === 0) {
                var ngFormControl_1 = _this.ngFormControls[propName];
                var displayFieldName_1 = ngFormControl_1.name || ngFormControl_1.defaultI18nValue || '';
                var bindingPathArray = ngFormControl_1.binding ? ngFormControl_1.binding.split('.') : [propName];
                var fieldNameArray = tslib_1.__spread([parentPath], bindingPathArray);
                var fieldName_1 = fieldNameArray.join('/');
                if (Array.isArray(ngFormControl_1.validRules) && ngFormControl_1.validRules.length > 0) {
                    var validationrulesToAdd = tslib_1.__spread(ngFormControl_1.validRules);
                    // if (this.excludeRuleTypes && this.excludeRuleTypes[propName] && this.excludeRuleTypes[propName].length > 0) {
                    //   validationrulesToAdd = ngFormControl.validRules.filter((item) => !this.excludeRuleTypes[propName].includes(item.type));
                    // }
                    validationrulesToAdd.forEach(function (validationRule) {
                        validationRule.targetId = ngFormControl_1.id;
                        validationRule.targetName = _this.formGroupName;
                        validationRule.property = displayFieldName_1;
                        validationRule.field = ngFormControl_1.binding;
                        validationRule.fullPath = fieldName_1;
                        if (_this.frameContext) {
                            validationRule.frameContext = _this.frameContext;
                        }
                    });
                    validatoinRules.set(fieldName_1, validationrulesToAdd);
                }
                else {
                    validatoinRules.set(fieldName_1, [{
                            type: 'setDisplayInfo',
                            targetId: ngFormControl_1.id,
                            targetName: _this.formGroupName,
                            property: displayFieldName_1,
                            fullPath: fieldName_1,
                            frameContext: _this.frameContext
                        }]);
                }
            }
        });
        return validatoinRules;
    };
    Form.prototype.setTranslateService = function (translateService) {
        if (!translateService) {
            return;
        }
        this.translate = translateService;
        ValidationTypes.setCurrentLanguage(translateService.getCurrentLanguage());
    };
    /**
     * 重置控件状态
     */
    Form.prototype.resetFormControls = function () {
        var _this = this;
        if (Object.keys(this.controls).length > 0) {
            Object.keys(this.controls).forEach(function (prop) {
                var formControl = _this.controls[prop];
                formControl.markAsUntouched();
                formControl.markAsPristine();
            });
        }
    };
    Form.prototype.clearBackEndMessages = function (domPropertyName) {
        var _this = this;
        if (domPropertyName) {
            if (this.cardControls[domPropertyName] && this.cardControls[domPropertyName]['errors'] && !!Object.keys(this.cardControls[domPropertyName]['errors']).find(function (item) { return item.startsWith('message-'); })) {
                var messageKeys = Object.keys(this.cardControls[domPropertyName]['errors']).filter(function (item) { return item.startsWith('message-'); });
                var errors_1 = tslib_1.__assign({}, this.cardControls[domPropertyName]['errors']);
                messageKeys.forEach(function (key) { return delete errors_1[key]; });
                this.cardControls[domPropertyName] = { errors: errors_1 };
            }
        }
        else {
            Object.keys(this.cardControls).forEach(function (propertyName) {
                if (_this.cardControls[propertyName] && _this.cardControls[propertyName]['errors'] && !!Object.keys(_this.cardControls[propertyName]['errors']).find(function (item) { return item.startsWith('message-'); })) {
                    var messageKeys = Object.keys(_this.cardControls[propertyName]['errors']).filter(function (item) { return item.startsWith('message-'); });
                    var errors_2 = tslib_1.__assign({}, _this.cardControls[propertyName]['errors']);
                    messageKeys.forEach(function (key) { return delete errors_2[key]; });
                    _this.cardControls[propertyName] = { errors: errors_2 };
                }
            });
        }
    };
    /**
     * 存放所有实例的映射
     */
    Form.insMap = {};
    Form.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    Form.ctorParameters = function () { return []; };
    return Form;
}(FormGroup));
export { Form };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2Zvcm0vZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsa0NBQWtDO0FBQ2xDLE9BQU8sRUFBYyxVQUFVLEVBQVksTUFBTSxlQUFlLENBQUM7QUFFakUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFlLE1BQU0sZ0JBQWdCLENBQUM7QUFDckUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN6QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFakQsT0FBTyxFQUF1QixVQUFVLEVBQWlCLE1BQU0sdUJBQXVCLENBQUM7QUFFdkYsT0FBTyxFQUNMLGVBQWUsRUFDZixhQUFhLEVBQ0csZ0JBQWdCLEVBQ2pDLE1BQU0sY0FBYyxDQUFDO0FBRXRCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUxQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDdkUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDN0UsT0FBTyxLQUFLLFdBQVcsTUFBTSxXQUFXLENBQUM7QUFFekMsT0FBTyxFQUFnQixZQUFZLEVBQUUsT0FBTyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzlELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRTdEOztHQUVHO0FBQ0g7SUFDbUIsZ0NBQVM7SUFvQzFCOztPQUVHO0lBQ0g7UUFBQSxZQUNFLGtCQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBS3RCO1FBc0NPLDhCQUF3QixHQUFHLEtBQUssQ0FBQztRQUNsQyx5QkFBbUIsR0FBRyxLQUFLLENBQUM7UUFTM0IsaUJBQVcsR0FBRyxX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R0F1a0MzQjtBQUVELE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRzbGludDpkaXNhYmxlOiBtYXgtbGluZS1sZW5ndGhcclxuaW1wb3J0IHsgRWxlbWVudFJlZiwgSW5qZWN0YWJsZSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEZvcm1Db250cm9sLCBGb3JtR3JvdXAsIFZhbGlkYXRvckZuIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnO1xyXG5pbXBvcnQgeyBNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi9tZXRhZGF0YS9pbmRleCc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJy4uL2ZyYW1lL2luZGV4JztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEsIENoYW5nZSwgQ2hhbmdlVHlwZSwgQmluZGluZ09iamVjdCB9IGZyb20gJy4uL2JpbmRpbmctZGF0YS9pbmRleCc7XHJcbmltcG9ydCB7IFZhbGlkYXRlUnVsZSwgVmFsaWRhdGlvbiB9IGZyb20gJy4uL2VudGl0eS92YWxpZGF0b3IvdHlwZXMnO1xyXG5pbXBvcnQge1xyXG4gIE5HX0ZPUk1fQ09OVFJPTCwgTmdGb3JtQ29udHJvbCxcclxuICBOR19DSElMRF9GT1JNLCBOZ0NoaWxkRm9ybSxcclxuICBOZ1ZhbGlkYXRlRm9ybSwgTkdfVkFMSURBVEVfRk9STVxyXG59IGZyb20gJy4vZGVjb3JhdG9ycyc7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUNvbnZlcnRlciB9IGZyb20gJy4vY29udHJvbF92YWx1ZV9jb252ZXJ0ZXInO1xyXG5pbXBvcnQgeyBEYXRlVXRpbCB9IGZyb20gJy4uL3V0aWxzL2luZGV4JztcclxuaW1wb3J0IHsgVHJhbnNsYXRlIH0gZnJvbSAnLi4vaTE4bi90cmFuc2xhdGUnO1xyXG5pbXBvcnQgeyBWYWxpZGF0aW9uVHlwZXMgfSBmcm9tICcuLi9lbnRpdHkvdmFsaWRhdG9yL3ZhbGlkYXRpb25fdHlwZXMnO1xyXG5pbXBvcnQgeyBWYWxpZGF0aW9uRXhlY3V0b3IgfSBmcm9tICcuLi9lbnRpdHkvdmFsaWRhdG9yL3ZhbGlkYXRpb25fZXhlY3V0b3InO1xyXG5pbXBvcnQgKiBhcyBWYWxpZGF0b3JKUyBmcm9tICd2YWxpZGF0b3InO1xyXG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3IgfSBmcm9tICcuLi9lbnRpdHknO1xyXG5pbXBvcnQgeyBEYXRhUHJvcEluZm8sIERhdGFUeXBlSW5mbywgUnVuTW9kZSB9IGZyb20gJy4uL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vaTE4bi90cmFuc2xhdGVfc2VydmljZSc7XHJcbmltcG9ydCB7IFJ1bGVUeXBlIH0gZnJvbSAnLi90eXBlcyc7XHJcbi8qKlxyXG4gKiDooajljZXlrprkuYlcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgRm9ybSBleHRlbmRzIEZvcm1Hcm91cCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWtmOaUvuaJgOacieWunuS+i+eahOaYoOWwhFxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbnNNYXA6IHtcclxuICAgIFtmb3JtTmFtZTogc3RyaW5nXTogRm9ybVxyXG4gIH0gPSB7fTtcclxuXHJcbiAgLyoqXHJcbiAgICog5ZCN56ewXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBmb3JtR3JvdXBOYW1lKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubmdWYWxpZGF0ZUZvcm0gPyB0aGlzLm5nVmFsaWRhdGVGb3JtLmZvcm1Hcm91cE5hbWUgOiAnJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWQr+eUqOihqOWNlemqjOivgVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgZW5hYmxlVmFsaWRhdGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZ1ZhbGlkYXRlRm9ybSA/IHRoaXMubmdWYWxpZGF0ZUZvcm0uZW5hYmxlVmFsaWRhdGUgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgdHJhbnNsYXRlU2VydmljZSgpOiBUcmFuc2xhdGUge1xyXG4gICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmjpLpmaTnmoTmoKHpqozop4TliJnnsbvlnotcclxuICAgKi9cclxuICAvLyBwcml2YXRlIGV4Y2x1ZGVSdWxlVHlwZXM6IHsgW3Byb3BlcnR5TmFtZTogc3RyaW5nXTogc3RyaW5nW10gfTtcclxuXHJcbiAgLyoqXHJcbiAgICog5LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0O1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKHt9LCBudWxsLCBudWxsKTtcclxuICAgIHRoaXMuY29udHJvbElkTWFwID0ge307XHJcbiAgICB0aGlzLmNhcmRDb250cm9scyA9IHt9O1xyXG4gICAgdGhpcy5pc1Nob3dQcm9wTWFwID0ge307XHJcbiAgICAvLyB0aGlzLmV4Y2x1ZGVSdWxlVHlwZXMgPSB7fTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGE7XHJcbiAgLyoqXHJcbiAgICog57uR5a6a6Lev5b6EXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGJpbmRpbmdQYXRoOiBzdHJpbmc7XHJcbiAgLyoqXHJcbiAgICogRm9ybeaPj+i/sFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbmdWYWxpZGF0ZUZvcm06IE5nVmFsaWRhdGVGb3JtO1xyXG4gIC8qKlxyXG4gICAqIOe7k+aehOaPj+i/sO+8mkZvcm1Db250cm9sXHJcbiAgICovXHJcbiAgcHVibGljIG5nRm9ybUNvbnRyb2xzOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogTmdGb3JtQ29udHJvbCB9O1xyXG4gIC8qKlxyXG4gICAqIOWFg+aVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBtZXRhRGF0YXM6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnkgfTtcclxuICAvKipcclxuICAgKiDnu5PmnoTmj4/ov7DvvJpGb3JtR3JvdXBcclxuICAgKi9cclxuICBwcml2YXRlIG5nQ2hpbGRGb3JtczogeyBbcHJvcE5hbWU6IHN0cmluZ106IE5nQ2hpbGRGb3JtIH07XHJcbiAgLyoqXHJcbiAgICog5a2Y5pS+5p+Q5p2h5pWw5o2u5LiL55qE5bGe5oCn6ZSZ6K+v5L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb250cm9sSWRNYXA6IHtcclxuICAgIFtpZDogc3RyaW5nXToge1xyXG4gICAgICBbcHJvcE5hbWU6IHN0cmluZ106IG9iamVjdFxyXG4gICAgfVxyXG4gIH07XHJcbiAgLyoqXHJcbiAgICog55So5LqO5a2Y5YKo5bGe5oCn6ZSZ6K+vXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYXJkQ29udHJvbHM6IG9iamVjdDtcclxuICBwcml2YXRlIHJhaXNlZEJ5VmFsaWRhdGVFZmZlY3RvciA9IGZhbHNlO1xyXG4gIHB1YmxpYyBpc1Nob3dWYWxpZGF0aW9uTXNnID0gZmFsc2U7XHJcblxyXG4gIC8vIOWxnuaAp+WcqOmhtemdouS4iuWxleekuueKtuaAgeeahG1hcCxrZXnmmK9odG1s5Lit5L2/55So55qE5bGe5oCn5ZCNXHJcbiAgcHVibGljIGlzU2hvd1Byb3BNYXA6IHtcclxuICAgIFtkb21Qcm9wZXJ0eU5hbWU6IHN0cmluZ106IGJvb2xlYW5cclxuICB9O1xyXG5cclxuICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlO1xyXG5cclxuICBwcml2YXRlIHZhbGlkYXRvckpzID0gVmFsaWRhdG9ySlMuZGVmYXVsdDtcclxuXHJcbiAgLyoqXHJcbiAgICog5bCGZm9ybUNvbnRyb2znmoTplJnor6/kv6Hmga/mm7TmlrDliLBjYXJkQ29udHJvbOS4ilxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cGRhdGVFcnJvcnMocHJvcGVydHlOYW1lLCBlcnJvck9iaiwgaWQsIHZhbHVlPywgaXNHcmlkPykge1xyXG4gICAgT2JqZWN0LmtleXMoRm9ybS5pbnNNYXApLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgY29uc3QgZm9ybSA9IEZvcm0uaW5zTWFwW2tleV07XHJcbiAgICAgIGlmICghZm9ybSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaWQpIHtcclxuICAgICAgICBmb3JtLnNldENvbnRyb2xWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZm9ybS5lbmFibGVWYWxpZGF0ZSkge1xyXG4gICAgICAgIGZvcm0uaXNGb3JtVmFsaWQocHJvcGVydHlOYW1lLCBlcnJvck9iaiwgaWQsIGlzR3JpZCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva5kb23lsZ7mgKfkuLrmmL7npLrnirbmgIFcclxuICAgKiBAcGFyYW0gZG9tUHJvcGVydHlOYW1lIGRvbeWxnuaAp1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRJc1Nob3dtYXAoZG9tUHJvcGVydHlOYW1lOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuaXNTaG93UHJvcE1hcFtkb21Qcm9wZXJ0eU5hbWVdID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRTaG93VmFsaWRhdGlvbk1zZyhmbGFnOiBib29sZWFuKSB7XHJcbiAgICB0aGlzLnJhaXNlZEJ5VmFsaWRhdGVFZmZlY3RvciA9IGZhbHNlO1xyXG4gICAgdGhpcy5pc1Nob3dWYWxpZGF0aW9uTXNnID0gZmxhZztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRDb250cm9sVmFsdWUoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QgPSB0aGlzLmJpbmRpbmdEYXRhICYmIHRoaXMuYmluZGluZ0RhdGEuZ2V0T2JqZWN0KCkgfHwgbnVsbDtcclxuICAgIGlmIChiaW5kaW5nT2JqZWN0ICYmIGJpbmRpbmdPYmplY3QuY29udHJvbE1hcCkge1xyXG4gICAgICBiaW5kaW5nT2JqZWN0LmNvbnRyb2xNYXBba2V5XSA9IHRoaXMuZ2V0R3JpZEl0ZW1Db250cm9sKGtleSwgdmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja5kb23lsZ7mgKflkI3np7Dojrflj5bplJnor6/kv6Hmga9cclxuICAgKiBAcGFyYW0gZG9tUHJvcGVydHlOYW1lIGRvbeWxnuaAp+WQjeensFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDYXJkQ29udHJvbEVycm9ycyhkb21Qcm9wZXJ0eU5hbWU/OiBzdHJpbmcpOiBvYmplY3Qge1xyXG4gICAgdGhpcy5zZXRJc1Nob3dtYXAoZG9tUHJvcGVydHlOYW1lKTtcclxuICAgIHJldHVybiB0aGlzLmNhcmRDb250cm9sc1tkb21Qcm9wZXJ0eU5hbWVdICYmIHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV0uZXJyb3JzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blrZfmrrXmoKHpqozplJnor69cclxuICAgKiBAcGFyYW0gZG9tUHJvcGVydHlOYW1lIFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGb3JtQ29udHJvbEVycm9ycyhkb21Qcm9wZXJ0eU5hbWU/OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLmNhcmRDb250cm9sc1tkb21Qcm9wZXJ0eU5hbWVdICYmIHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV0uZXJyb3JzO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0R3JpZENvbnRyb2xFcnJvcnMoZG9tUHJvcGVydHlOYW1lOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBvYmplY3Qge1xyXG4gICAgdGhpcy5zZXRJc1Nob3dtYXAoZG9tUHJvcGVydHlOYW1lKTtcclxuICAgIHJldHVybiB0aGlzLmNvbnRyb2xJZE1hcFtpZF0gJiYgdGhpcy5jb250cm9sSWRNYXBbaWRdW2RvbVByb3BlcnR5TmFtZV0gJiYgdGhpcy5jb250cm9sSWRNYXBbaWRdW2RvbVByb3BlcnR5TmFtZV1bJ2Vycm9ycyddO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzRm9ybVZhbGlkKHByb3BlcnR5TmFtZT86IHN0cmluZywgZXJyb3JPYmo/OiBvYmplY3QsIGlkPzogc3RyaW5nLCBpc0dyaWQ/OiBib29sZWFuKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgcHJlZml4ID0gJyc7XHJcbiAgICAvLyDlpoLmnpzmoKHpqozkv6Hmga/mmK/nlLHooajovr7lvI/op6blj5HnmoTvvIzkuI3lpITnkIZcclxuICAgIGlmICh0aGlzLnJhaXNlZEJ5VmFsaWRhdGVFZmZlY3Rvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoaXNHcmlkID09PSB0cnVlKSB7XHJcbiAgICAgIC8vIOWmguaenOaYr2dyaWTvvIzor7TmmI7mmK/lrZDooajvvIzpnIDopoHmi7zmjqXlrZDooahmcm9udE5vZGVDb2RlXHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IHRoaXMuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgaWYgKGJpbmRpbmdQYXRocy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcHJlZml4ID0gYmluZGluZ1BhdGhzLmpvaW4oJy4nKS5jb25jYXQoJy4nKTtcclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIC8vIOeVjOmdouS4iue7keWumueahOWtl+auteWQjVxyXG4gICAgY29uc3QgZG9tUHJvcGVydHlOYW1lID0gdGhpcy5nZXREb21Qcm9wZXJ0eU5hbWVCeUVudGl0eVByb3AocHJvcGVydHlOYW1lLCBwcmVmaXgpO1xyXG4gICAgLy8g5Lyg5LqG5bGe5oCn5ZCN77yM5L2G5Y205ou/5LiN5YiwZG9t5ZCN56ew77yM6K+05piO5b2T5YmN57uE5Lu25Lit5rKh5pyJ6K+l5a2X5q615a+55bqU55qE5o6n5Lu2XHJcbiAgICBpZiAocHJvcGVydHlOYW1lICYmICFkb21Qcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICAvLyDoi6XnlYzpnaLkuIrkuI3lrZjlnKjlvZPliY3lsZ7mgKfvvIjliqjmgIHliJfvvInvvIzkuI3ov5vooYzpqozor4FcclxuICAgIGlmIChkb21Qcm9wZXJ0eU5hbWUgJiYgIXRoaXMuaXNTaG93UHJvcE1hcFtkb21Qcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgbGV0IGlzVmFsaWQgPSB0cnVlO1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdCA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0T2JqZWN0KCk7XHJcbiAgICBjb25zdCBjdXJyZW50SWQgPSBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZTtcclxuICAgIGNvbnN0IGlzU3ViRm9ybSA9IHRoaXMuYmluZGluZ1BhdGggIT09ICcvJztcclxuICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRMaXN0KCk7XHJcblxyXG4gICAgLy8g5a2Q6KGo5Y2V5peg5pWw5o2u5pe277yM5L+d5a2Y5pe25Lya5pyJ5LiA5p2h56m65pWw5o2u6Zi756KN6aqM6K+B77yM5omA5Lul5q2k5aSE6Lez6L+H5Y+q5pyJ5LiA6KGM55qE5oOF5Ya1XHJcbiAgICBpZiAoaXNTdWJGb3JtICYmIGJpbmRpbmdMaXN0LmlubmVyTGlzdC5zaXplID09PSAwKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8g5peg5pWw5o2u5pe25LiN5YGa5qCh6aqMXHJcbiAgICBpZiAoIWN1cnJlbnRJZCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIC8vIGRhdGFHcmlk5L+u5pS55pe277yM5qC55o2uaWTvvIzliJvlu7pmb3JtQ29udHJvbO+8jOW5tuiuvue9rumUmeivr+WvueixoVxyXG4gICAgaWYgKGlkICYmIGRvbVByb3BlcnR5TmFtZSkge1xyXG4gICAgICAvLyBpZiAodGhpcy5jb250cm9sSWRNYXBbaWRdICYmIE9iamVjdC5rZXlzKHRoaXMuY29udHJvbElkTWFwW2lkXSkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIC8vICAgdGhpcy5jb250cm9sSWRNYXBbaWRdID0ge307XHJcbiAgICAgIC8vIH1cclxuICAgICAgdGhpcy5jb250cm9sSWRNYXBbaWRdID0gdGhpcy5jb250cm9sSWRNYXBbaWRdIHx8IHt9O1xyXG4gICAgICB0aGlzLmNvbnRyb2xJZE1hcFtpZF1bZG9tUHJvcGVydHlOYW1lXSA9IHtcclxuICAgICAgICBlcnJvcnM6IGVycm9yT2JqXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5bCGZ3JpZOeahEZvcm1Db250cm9s5ZCM5q2l5Yiw55WM6Z2i5bGV56S655So55qEY29udHJvbElETWFw5LitXHJcbiAgICAvLyBjb25zdCBjdXJyZW50QmluZGluZ09iamVjdCA9IGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtIGFzIEJpbmRpbmdPYmplY3Q7XHJcbiAgICBjb25zdCBjdXJyZW50QmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCA9IGJpbmRpbmdPYmplY3Q7XHJcblxyXG4gICAgaWYgKGlkICYmIGlkICE9PSBjdXJyZW50SWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOmqjOivgeWFqOmDqOWtl+auteaXtu+8jOa4heepuuW3suacieeahOmUmeivr+S/oeaBr1xyXG4gICAgaWYgKCFwcm9wZXJ0eU5hbWUgJiYgIWlkKSB7XHJcbiAgICAgIGN1cnJlbnRCaW5kaW5nT2JqZWN0LmNvbnRyb2xNYXAgPSB7fTtcclxuICAgICAgdGhpcy5jb250cm9sSWRNYXAgPSB7fTtcclxuICAgICAgdGhpcy5jYXJkQ29udHJvbHMgPSB7fTtcclxuICAgIH1cclxuICAgIE9iamVjdC5rZXlzKHRoaXMuY29udHJvbHMpLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5pc1Nob3dQcm9wTWFwW2tleV0gIT09IHRydWUpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgLy8g5ZCM5q2l5a6e5L2T6ZSZ6K+v5L+h5oGvXHJcbiAgICAgIGlmIChrZXkgPT09IGRvbVByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgIC8vIOWunuS9k+mqjOivgeeahOS/oeaBr+ebtOaOpei1i+WAvFxyXG4gICAgICAgIGlmIChlcnJvck9iaiAmJiBPYmplY3Qua2V5cyhlcnJvck9iaikubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgLy8g5Y2h54mH55qE6ZSZ6K+vXHJcbiAgICAgICAgICBpZiAoIWlzR3JpZCkge1xyXG4gICAgICAgICAgICAvLyDlrp7kvZPlsYLlkIzmraXov4fmnaXnmoTplJnor6/vvIznm67liY3nu5PmnoR7cnVsZVR5cGU6e25hbWU6JycsdmFsdWU6Jycsb3JpZ2luYWxFcnJvcnM6W1ZhbGlkYXRpb25FcnJvcl19fe+8jOWFtuS4rW5hbWXkuLrmoKHpqozlpLHotKXnmoTplJnor6/kv6Hmga9cclxuICAgICAgICAgICAgLy8g6YGN5Y6G6ZSZ6K+v77yM5bCGdmFsaWRhdG9y6L+U5Zue55qE6ZSZ6K+v5L+h5oGv5Zu96ZmF5YyWXHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGVycm9yT2JqKS5tYXAoKHZhbGlkVHlwZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdmFsaWRhdGlvbkVycm9yOiBWYWxpZGF0aW9uRXJyb3IgPSBlcnJvck9ialt2YWxpZFR5cGVdICYmIGVycm9yT2JqW3ZhbGlkVHlwZV1bJ2Vycm9yJ10gfHwgbnVsbDtcclxuICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0ZVJ1bGU6IFZhbGlkYXRlUnVsZSA9IHZhbGlkYXRpb25FcnJvci5ydWxlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmdGb3JtQ29udHJvbCA9IHRoaXMuZ2V0bmdGb3JtQ29udHJvbEJ5QmluZGluZyh2YWxpZGF0ZVJ1bGUucHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5nRm9ybUNvbnRyb2wpIHtcclxuICAgICAgICAgICAgICAgICAgdmFsaWRhdGVSdWxlLnByb3BlcnR5ID0gbmdGb3JtQ29udHJvbC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0ZVJ1bGUudGFyZ2V0SWQgPSBuZ0Zvcm1Db250cm9sLmlkO1xyXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0ZVJ1bGUudGFyZ2V0TmFtZSA9IHRoaXMuZm9ybUdyb3VwTmFtZTtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UodmFsaWRUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgdmFsaWRhdGVSdWxlLCBuZ0Zvcm1Db250cm9sLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICBlcnJvck9ialt2YWxpZFR5cGVdWyduYW1lJ10gPSBpbnZhbGlkTWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHRvZG86IG5nRm9ybUNvbnRyb2zmmoLml7bkuI3orr7nva5cclxuICAgICAgICAgICAgICAgIC8vIGVycm9yT2JqWyduYW1lJ10gPSB0aGlzLmdldEVycm9yQnlSdWxlVHlwZSh2YWxpZFR5cGUsIHZhbGlkYXRlUnVsZSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNba2V5XSA9IHtcclxuICAgICAgICAgICAgICBlcnJvcnM6IGVycm9yT2JqXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY2FyZENvbnRyb2xzW2tleV0gPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuY29udHJvbHNba2V5XSAmJiB0aGlzLmNvbnRyb2xzW2tleV0uZXJyb3JzICYmIE9iamVjdC5rZXlzKHRoaXMuY29udHJvbHNba2V5XS5lcnJvcnMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyDlsIbplJnor6/lkIzmraXliLDnlYzpnaLlsZXnpLrnmoTkvY3nva5cclxuICAgICAgICAvLyDorqTkuLrmjqfku7bplJnor6/lj6rljIXlkKvplJnor6/nsbvlnovvvIzpgJrov4fplJnor6/nsbvlnovojrflj5blhbfkvZPnmoTplJnor6/kv6Hmga9cclxuICAgICAgICB0aGlzLmNhcmRDb250cm9sc1trZXldID0ge1xyXG4gICAgICAgICAgZXJyb3JzOiB7XHJcbiAgICAgICAgICAgIC4uLnRoaXMuY2FyZENvbnRyb2xzW2tleV0gJiYgdGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnMsXHJcbiAgICAgICAgICAgIC4uLnRoaXMuY29udHJvbHNba2V5XS5lcnJvcnNcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIOWkhOeQhuWPquW8gOWQr+WJjeerr+agoemqjO+8jOacquWcqEJF5LiK5ZCv55So5b+F5aGr5qCh6aqM55qE5oOF5Ya1XHJcbiAgICAgICAgaWYgKHRoaXMuY2FyZENvbnRyb2xzKSB7XHJcbiAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLmNhcmRDb250cm9scykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jYXJkQ29udHJvbHNba2V5XSAmJiB0aGlzLmNhcmRDb250cm9sc1trZXldLmVycm9ycykge1xyXG4gICAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzW2tleV0uZXJyb3JzKS5mb3JFYWNoKHZhbGlkVHlwZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuY2FyZENvbnRyb2xzW2tleV0uZXJyb3JzW3ZhbGlkVHlwZV0gIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIOiOt+WPluWvueW6lOeahOagoemqjOS/oeaBr1xyXG4gICAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0ZVJ1bGVzOiBWYWxpZGF0ZVJ1bGUgfCBWYWxpZGF0ZVJ1bGVbXSA9IHRoaXMubmdGb3JtQ29udHJvbHNba2V5XS52YWxpZFJ1bGVzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICBjb25zdCBydWxlczogVmFsaWRhdGVSdWxlW10gPSBbXS5jb25jYXQodmFsaWRhdGVSdWxlcyk7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRlUnVsZTogVmFsaWRhdGVSdWxlID0gcnVsZXMuZmluZChpdGVtID0+IGl0ZW0udHlwZSA9PT0gdmFsaWRUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlUnVsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlUnVsZS50YXJnZXROYW1lID0gdGhpcy5mb3JtR3JvdXBOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKHZhbGlkVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgdmFsaWRhdGVSdWxlLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnNba2V5XSA9IHsgdmFsdWU6IHRoaXMuY29udHJvbHNba2V5XSAmJiB0aGlzLmNvbnRyb2xzW2tleV0udmFsdWUgfHwgJycsIG5hbWU6IGludmFsaWRNZXNzYWdlIH07XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmtleXModGhpcy5jYXJkQ29udHJvbHMpLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5jYXJkQ29udHJvbHNba2V5XSAmJiB0aGlzLmNhcmRDb250cm9sc1trZXldLmVycm9ycyAmJiBPYmplY3Qua2V5cyh0aGlzLmNhcmRDb250cm9sc1trZXldLmVycm9ycykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGlzVmFsaWQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOihqOWNlemUmeivr+S/oeaBr1xyXG4gICAqIEBwYXJhbSBlcnJvcnMg6ZSZ6K+v5raI5oGvXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUZvcm1FcnJvcnMoZXJyb3JzOiB7IFtkb21Qcm9wZXJ0eU5hbWU6IHN0cmluZ106IHsgZXJyb3JzOiB7IFtydWxlVHlwZTogc3RyaW5nXTogeyBuYW1lOiBzdHJpbmcsIFtwcm9wOiBzdHJpbmddOiBhbnkgfSB9IH0gfSwgZm9yY2VTaG93OiBib29sZWFuID0gZmFsc2UsIGZyb206IHN0cmluZyA9ICcnKSB7XHJcbiAgICBpZiAoZnJvbSAmJiBmcm9tID09PSAnYmFja2VuZCcpIHtcclxuICAgICAgdGhpcy5jbGVhckJhY2tlbmRFcnJvcigpO1xyXG4gICAgfVxyXG4gICAgLy8g5Y6f5p2l5piv5ZCm5bey57uP5pi+56S66ZSZ6K+v77yM5aaC5p6c5bey57uP5pi+56S65LqG5YiZ5aKe5Yqg77yM5ZCm5YiZ5pu/5o2iXHJcbiAgICBpZiAodGhpcy5pc1Nob3dWYWxpZGF0aW9uTXNnID09PSB0cnVlIHx8IGZvcmNlU2hvdyA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLmlzU2hvd1ZhbGlkYXRpb25Nc2cgPSB0cnVlO1xyXG4gICAgICBPYmplY3Qua2V5cyhlcnJvcnMpLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKGVycm9yc1trZXldLmVycm9ycyAmJiBPYmplY3Qua2V5cyhlcnJvcnNba2V5XS5lcnJvcnMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMuY2FyZENvbnRyb2xzW2tleV0gPSB7XHJcbiAgICAgICAgICAgIGVycm9yczoge1xyXG4gICAgICAgICAgICAgIC4uLnRoaXMuY2FyZENvbnRyb2xzW2tleV0gJiYgdGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnMsXHJcbiAgICAgICAgICAgICAgLi4uZXJyb3JzW2tleV0uZXJyb3JzXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIOenu+mZpOWGheWtmOS4reeahOmUmeivr+S/oeaBr1xyXG4gICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNba2V5XSA9IHtcclxuICAgICAgICAgICAgZXJyb3JzOiB7fVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIC8vIOmHjee9ruaOp+S7tumUmeivr+S/oeaBr1xyXG4gICAgICAgICAgdGhpcy5jb250cm9sc1trZXldLnNldEVycm9ycyhudWxsKTtcclxuICAgICAgICAgIHRoaXMuY29udHJvbHNba2V5XS5tYXJrQXNUb3VjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF56m65ZCO56uv5raI5oGvXHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyQmFja2VuZEVycm9yKCkge1xyXG4gICAgT2JqZWN0LmtleXModGhpcy5jYXJkQ29udHJvbHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgY29uc3QgZXJyb3JzID0gdGhpcy5jYXJkQ29udHJvbHNba2V5XSAmJiB0aGlzLmNhcmRDb250cm9sc1trZXldLmVycm9ycyB8fCBudWxsO1xyXG4gICAgICBpZiAoZXJyb3JzKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoZXJyb3JzKS5mb3JFYWNoKGVycm9yVHlwZSA9PiB7XHJcbiAgICAgICAgICBpZiAoZXJyb3JUeXBlICYmIGVycm9yVHlwZS5zdGFydHNXaXRoKCdiYWNrZW5kLW1lc3NhZ2UtJykpIHtcclxuICAgICAgICAgICAgZGVsZXRlIGVycm9yc1tlcnJvclR5cGVdO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChlcnJvcnMgJiYgT2JqZWN0LmtleXMoZXJyb3JzKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhcmRDb250cm9sc1trZXldLmVycm9ycztcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNba2V5XSA9IHt9O1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qC55o2u5a6e5L2T5bGe5oCn6I635Y+WbmdGb3JtQ29udHJvbFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nIOaOp+S7tue7keWumueahOWunuS9k+WxnuaAp+WQjVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0bmdGb3JtQ29udHJvbEJ5QmluZGluZyhiaW5kaW5nOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBPYmplY3QudmFsdWVzKHRoaXMubmdGb3JtQ29udHJvbHMpLmZpbmQoKG5nRm9ybUNvbnRyb2w6IE5nRm9ybUNvbnRyb2wpID0+IG5nRm9ybUNvbnRyb2wuYmluZGluZyAmJiBuZ0Zvcm1Db250cm9sLmJpbmRpbmcgPT09IGJpbmRpbmcpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja5kb23lsZ7mgKflkozmoKHpqoznsbvlnovojrflj5bplJnor6/kv6Hmga9cclxuICAgKiBAcGFyYW0gZG9tUHJvcGVydHkgZG9t5bGe5oCnXHJcbiAgICogQHBhcmFtIHZhbGlkYXRlUnVsZVR5cGUg5qCh6aqM57G75Z6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRFcnJvck1lc3NhZ2UoZG9tUHJvcGVydHk6IHN0cmluZywgdmFsaWRhdGVSdWxlVHlwZTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBmb3JtQ29udHJvbCA9IHRoaXMubmdGb3JtQ29udHJvbHNbZG9tUHJvcGVydHldO1xyXG4gICAgaWYgKGZvcm1Db250cm9sKSB7XHJcbiAgICAgIGNvbnN0IHZhbGlkUnVsZXMgPSBmb3JtQ29udHJvbC52YWxpZFJ1bGVzO1xyXG4gICAgICBjb25zdCBydWxlcyA9IFtdO1xyXG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsaWRSdWxlcykpIHtcclxuICAgICAgICBydWxlcy5wdXNoKHZhbGlkUnVsZXMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJ1bGVzLnB1c2goLi4udmFsaWRSdWxlcyk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcnVsZSA9IHJ1bGVzLmZpbmQoaXRlbSA9PiBpdGVtLnR5cGUgPT09IHZhbGlkYXRlUnVsZVR5cGUpO1xyXG4gICAgICBpZiAocnVsZSkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRyb2xOYW1lID0gZm9ybUNvbnRyb2wubmFtZTtcclxuICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZSh2YWxpZGF0ZVJ1bGVUeXBlKTtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGUsIGNvbnRyb2xOYW1lKTtcclxuICAgICAgICByZXR1cm4gbWVzc2FnZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyWRm9ybVxyXG4gICAqIEBwYXJhbSBjb250ZXh0IOS4iuS4i+aWh1xyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0KGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSwgYmluZGluZ1BhdGg6IHN0cmluZywgZnJhbWVDb250ZXh0PzogRnJhbWVDb250ZXh0KSB7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dCA9IGZyYW1lQ29udGV4dDtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEgPSBiaW5kaW5nRGF0YTtcclxuICAgIHRoaXMuYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aDtcclxuICAgIHRoaXMuYnVpbGRGb3JtKCk7XHJcbiAgICAvLyBAdG9kbzog6L+Z56eN5pa55byP5YGaa2V577yM5aaC5p6c6ISa5pys6KKr5Y6L57yp77yM5a2Y5Zyo6aOO6ZmpXHJcbiAgICBGb3JtLmluc01hcFt0aGlzLmNvbnN0cnVjdG9yLm5hbWVdID0gdGhpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOihqOWNlVxyXG4gICAqL1xyXG4gIHB1YmxpYyBidWlsZEZvcm0oKSB7XHJcbiAgICB0aGlzLmNvbGxlY3RNZXRhZGF0YXMoKTtcclxuICAgIC8vIHRoaXMuY3JlYXRlQ2hpbGRGb3JtQXJyYXlzKCk7XHJcbiAgICB0aGlzLmNyZWF0ZUNoaWxkRm9ybXMoKTtcclxuICAgIHRoaXMuY3JlYXRlQ29udHJvbHMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmHjee9ruihqOWNlemqjOivgeS/oeaBr1xyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldENhcmRWYWxpZE1zZygpOiB2b2lkIHtcclxuICAgIHRoaXMuY2FyZENvbnRyb2xzID0ge307XHJcbiAgICAvLyDliZTpmaQg5YiX6KGo5Lit5paw5aKe5ZCO5Y+W5raILOWIoOmZpOeahOmhueWvueW6lOeahGNvbnRyb2zkv6Hmga9cclxuICAgIE9iamVjdC5rZXlzKHRoaXMuY29udHJvbElkTWFwKS5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgaWYgKCF0aGlzLmJpbmRpbmdEYXRhLmdldExpc3QoKS5pbm5lckxpc3QubWFwKHggPT4geC5pZCkuaW5jbHVkZXMoaWQpKSB7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuY29udHJvbElkTWFwW2lkXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnJlc2V0Rm9ybUNvbnRyb2xzKCk7XHJcbiAgICB0aGlzLnNldFNob3dWYWxpZGF0aW9uTXNnKGZhbHNlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5a2X5q615qCh6aqM6KeE5YiZXHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSDlsZ7mgKflkI1cclxuICAgKiBAcGFyYW0gaXNSZXF1aXJlZCDmmK/lkKblv4XloatcclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlRmllbGRWYWxpZGF0ZVJ1bGUocHJvcGVydHlOYW1lOiBzdHJpbmcsIGlzUmVxdWlyZWQ6IGJvb2xlYW4pIHtcclxuICAgIGNvbnN0IGZvcm1Db250cm9sOiBBYnN0cmFjdENvbnRyb2wgPSB0aGlzLmNvbnRyb2xzW3Byb3BlcnR5TmFtZV07XHJcblxyXG4gICAgLy8g5riF56m65YWo6YOo5qCh6aqM5p2h5Lu2XHJcbiAgICBpZiAoZm9ybUNvbnRyb2wpIHtcclxuICAgICAgZm9ybUNvbnRyb2wuY2xlYXJWYWxpZGF0b3JzKCk7XHJcbiAgICAgIGZvcm1Db250cm9sLm1hcmtBc1VudG91Y2hlZCgpO1xyXG4gICAgICBmb3JtQ29udHJvbC5tYXJrQXNQcmlzdGluZSgpO1xyXG4gICAgICBmb3JtQ29udHJvbC5zZXRFcnJvcnMoW10pO1xyXG4gICAgfVxyXG4gICAgLy8g5Yqo5oCB5b+F5aGr5Zy65pmv5pe255Sf5oiQ5Zmo5LiN5YaN5ZyoZm9ybUNvbnRyb2zkuIrnlJ/miJDlv4Xloavop4TliJlcclxuICAgIC8vIOWboOatpHZhbGlkUnVsZXPlj6/og73kuLrnqbpcclxuICAgIGNvbnN0IG5nRm9ybUNvbnRyb2wgPSB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV07XHJcbiAgICBsZXQgdmFsaWRhdGVSdWxlczogVmFsaWRhdGVSdWxlIHwgVmFsaWRhdGVSdWxlW10gPSBuZ0Zvcm1Db250cm9sICYmIG5nRm9ybUNvbnRyb2wudmFsaWRSdWxlcyB8fCBbXTtcclxuICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWxpZGF0ZVJ1bGVzKSkge1xyXG4gICAgICB2YWxpZGF0ZVJ1bGVzID0gW3ZhbGlkYXRlUnVsZXNdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVxdWlyZWRSdWxlSW5kZXggPSB2YWxpZGF0ZVJ1bGVzLmZpbmRJbmRleCgodmFsaWRhdGVSdWxlOiBWYWxpZGF0ZVJ1bGUpID0+IHZhbGlkYXRlUnVsZS50eXBlID09PSBWYWxpZGF0aW9uVHlwZXMuUkVRVUlSRUQpO1xyXG4gICAgaWYgKGlzUmVxdWlyZWQpIHtcclxuICAgICAgLy8g5b+F5aGr5L2G5o6n5Lu25rKh5pyJ5b+F5aGr6KeE5YiZ77yM5re75Yqg5b+F5aGr6KeE5YiZXHJcbiAgICAgIGlmIChyZXF1aXJlZFJ1bGVJbmRleCA9PSAtMSkge1xyXG5cclxuICAgICAgICBjb25zdCB2YWxpZGF0ZVJ1bGU6IFZhbGlkYXRlUnVsZSA9IHsgdHlwZTogVmFsaWRhdGlvblR5cGVzLlJFUVVJUkVELCBjb25zdHJhaW50czogW3RydWVdIH07XHJcbiAgICAgICAgLy8g5omp5bGV5bGe5oCn77yM5Lul55Sf5oiQ5q2j56Gu55qE6ZSZ6K+v5o+Q56S6XHJcbiAgICAgICAgY29uc3QgZGlzcGxheUZpZWxkTmFtZSA9IG5nRm9ybUNvbnRyb2wgJiYgKG5nRm9ybUNvbnRyb2wubmFtZSB8fCBuZ0Zvcm1Db250cm9sLmRlZmF1bHRJMThuVmFsdWUpIHx8ICcnO1xyXG4gICAgICAgIHZhbGlkYXRlUnVsZS50YXJnZXRJZCA9IG5nRm9ybUNvbnRyb2wgJiYgbmdGb3JtQ29udHJvbC5pZCB8fCBudWxsO1xyXG4gICAgICAgIHZhbGlkYXRlUnVsZS50YXJnZXROYW1lID0gdGhpcy5mb3JtR3JvdXBOYW1lO1xyXG4gICAgICAgIHZhbGlkYXRlUnVsZS5wcm9wZXJ0eSA9IGRpc3BsYXlGaWVsZE5hbWU7XHJcbiAgICAgICAgdmFsaWRhdGVSdWxlLmZpZWxkID0gbmdGb3JtQ29udHJvbCAmJiBuZ0Zvcm1Db250cm9sLmJpbmRpbmc7XHJcbiAgICAgICAgdmFsaWRhdGVSdWxlcy5wdXNoKHZhbGlkYXRlUnVsZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOmdnuW/heWhq+WcuuaZr++8jOWmguaenOacieW/heWhq+inhOWIme+8jOenu+mZpFxyXG4gICAgICBpZiAocmVxdWlyZWRSdWxlSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgdmFsaWRhdGVSdWxlcy5zcGxpY2UocmVxdWlyZWRSdWxlSW5kZXgsIDEpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDmlbTnkIbmoKHpqozop4TliJlcclxuICAgIGNvbnN0IHZhbGlkYXRvcnM6IFZhbGlkYXRvckZuW10gPSBbXTtcclxuICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwodmFsaWRhdGVSdWxlcywgKChydWxlT2JqOiBWYWxpZGF0ZVJ1bGUpID0+IHtcclxuICAgICAgY29uc3QgdmFsaWRhdGVGbiA9IHRoaXMuZ2V0VmFsaWRhdG9yQnlSdWxlT2JqKHJ1bGVPYmosIHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXSk7XHJcbiAgICAgIGlmICh2YWxpZGF0ZUZuKSB7XHJcbiAgICAgICAgdmFsaWRhdG9ycy5wdXNoKHZhbGlkYXRlRm4pO1xyXG4gICAgICB9XHJcbiAgICB9KSk7XHJcbiAgICB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0udmFsaWRSdWxlcyA9IHZhbGlkYXRlUnVsZXM7XHJcbiAgICB0aGlzLmNvbnRyb2xzW3Byb3BlcnR5TmFtZV0uc2V0VmFsaWRhdG9ycyh2YWxpZGF0b3JzKTtcclxuICB9XHJcbiAgcHVibGljIGFkZEZpZWxkVmFsaWRhdGVSdWxlKHByb3BlcnR5TmFtZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIGV4cHJlc3Npb25JZDogc3RyaW5nLCBydWxlVHlwZTogUnVsZVR5cGUpIHtcclxuICAgIGNvbnN0IGZvcm1Db250cm9sOiBBYnN0cmFjdENvbnRyb2wgPSB0aGlzLmNvbnRyb2xzW3Byb3BlcnR5TmFtZV07XHJcbiAgICBpZiAoZm9ybUNvbnRyb2wpIHtcclxuICAgICAgLy8g5riF56m65YWo6YOo5qCh6aqM5p2h5Lu2XHJcbiAgICAgIGZvcm1Db250cm9sLnNldEVycm9ycyhudWxsKTtcclxuICAgIH1cclxuICAgIGNvbnN0IG5nRm9ybUNvbnRyb2wgPSB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV07XHJcbiAgICBsZXQgdmFsaWRhdGVSdWxlcyA9IHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXS52YWxpZFJ1bGVzO1xyXG4gICAgaWYgKCF2YWxpZGF0ZVJ1bGVzKSB7XHJcbiAgICAgIHZhbGlkYXRlUnVsZXMgPSBbXTtcclxuICAgIH1cclxuICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWxpZGF0ZVJ1bGVzKSkge1xyXG4gICAgICB2YWxpZGF0ZVJ1bGVzID0gW3ZhbGlkYXRlUnVsZXNdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaW5kZXggPSB2YWxpZGF0ZVJ1bGVzLmZpbmRJbmRleCgocnVsZTogVmFsaWRhdGVSdWxlKSA9PiBydWxlICYmIHJ1bGUuZXhwcmVzc2lvbklkID09PSBleHByZXNzaW9uSWQpO1xyXG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICB2YWxpZGF0ZVJ1bGVzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICBsZXQgZmllbGROYW1lID0gcHJvcGVydHlOYW1lO1xyXG4gICAgaWYgKGJpbmRpbmdQYXRocy5sZW5ndGggIT09IDApIHtcclxuICAgICAgY29uc3QgcHJlZml4ID0gYmluZGluZ1BhdGhzLmpvaW4oJy8nKTtcclxuICAgICAgY29uc3QgYmluZGluZyA9IG5nRm9ybUNvbnRyb2wuYmluZGluZyB8fCAnJztcclxuICAgICAgY29uc3QgcHJvcGVydHkgPSBiaW5kaW5nLnNwbGl0KCcuJykuam9pbignLycpO1xyXG4gICAgICBmaWVsZE5hbWUgPSBgJHtwcmVmaXh9LyR7cHJvcGVydHl9YDtcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dDtcclxuICAgIGNvbnN0IHZhbGlkYXRlUnVsZTogVmFsaWRhdGVSdWxlID0ge1xyXG4gICAgICB0eXBlOiBydWxlVHlwZSxcclxuICAgICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgICAgZXhwcmVzc2lvbklkOiBleHByZXNzaW9uSWQsXHJcbiAgICAgIGNvbnN0cmFpbnRzOiBbXSxcclxuICAgICAgYmluZGluZ1BhdGg6IGJpbmRpbmdQYXRocy5qb2luKCcvJyksXHJcbiAgICAgIGV2YWw6IGZ1bmN0aW9uIChvcHRpb25zPzogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRleHQudmlld01vZGVsLmV4cHJlc3Npb24udmFsaWRhdGUoZXhwcmVzc2lvbklkLCBvcHRpb25zKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHZhbGlkYXRlUnVsZXMucHVzaCh2YWxpZGF0ZVJ1bGUpO1xyXG4gICAgdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wZXJ0eU5hbWVdLnZhbGlkUnVsZXMgPSB2YWxpZGF0ZVJ1bGVzO1xyXG4gICAgLy8gaWYgKHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXSAmJiB2YWxpZGF0ZVJ1bGVzLmxlbmd0aCA+IDApIHtcclxuICAgIC8vICAgY29uc3QgdmFsaWRhdG9yczogVmFsaWRhdG9yRm5bXSA9IFtdO1xyXG4gICAgLy8gICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKHZhbGlkYXRlUnVsZXMsICgocnVsZU9iajogVmFsaWRhdGVSdWxlKSA9PiB7XHJcbiAgICAvLyAgICAgY29uc3QgdmFsaWRhdGVGbiA9IHRoaXMuZ2V0VmFsaWRhdG9yQnlSdWxlT2JqKHJ1bGVPYmosIHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXSk7XHJcbiAgICAvLyAgICAgaWYgKHZhbGlkYXRlRm4pIHtcclxuICAgIC8vICAgICAgIHZhbGlkYXRvcnMucHVzaCh2YWxpZGF0ZUZuKTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgIH0pKTtcclxuICAgIC8vICAgdGhpcy5jb250cm9sc1twcm9wZXJ0eU5hbWVdLnNldFZhbGlkYXRvcnModmFsaWRhdG9ycyk7XHJcbiAgICAvLyB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNruinhOWImeWvueixoeeUn+aIkHZhbGlkYXRvclxyXG4gICAqIEBwYXJhbSBydWxlT2JqOiBWYWxpZGF0ZVJ1bGVcclxuICAgKi9cclxuICBwcml2YXRlIGdldFZhbGlkYXRvckJ5UnVsZU9iaihydWxlT2JqOiBWYWxpZGF0ZVJ1bGUsIG5nRm9ybUNvbnRyb2w6IE5nRm9ybUNvbnRyb2wpOiBWYWxpZGF0b3JGbiB7XHJcbiAgICBjb25zdCB7IHR5cGUsIGNvbnN0cmFpbnRzID0gW10sIG1lc3NhZ2UgPSBudWxsIH0gPSBydWxlT2JqO1xyXG4gICAgY29uc3QgZGlzcGxheVRleHQgPSBuZ0Zvcm1Db250cm9sLm5hbWUgfHwgbmdGb3JtQ29udHJvbC5kZWZhdWx0STE4blZhbHVlIHx8ICcnO1xyXG4gICAgY29uc3QgcnVsZUhhbmRsZXJPYmogPSB7XHJcbiAgICAgIHJlcXVpcmVkOiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IG51bGwgPT4ge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gY29udHJvbC52YWx1ZTtcclxuICAgICAgICBsZXQgaXNWYWxpZCA9IHZhbHVlICE9PSAnJyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSAnMDAwMS0wMS0wMScgJiYgdmFsdWUgIT09ICcwMDAxLTAxLTAxIDAwOjAwOjAwJyAmJiB2YWx1ZSAhPT0gJzAwMDEtMDEtMDFUMDA6MDA6MDAnO1xyXG4gICAgICAgIGNvbnN0IHBhcmVudFBhdGhzID0gdGhpcy5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgIGNvbnN0IGNvbnRyb2xQYXRocyA9IG5nRm9ybUNvbnRyb2wuYmluZGluZy5zcGxpdCgnLicpO1xyXG4gICAgICAgIGNvbnN0IHBhdGhzID0gcGFyZW50UGF0aHMuY29uY2F0KGNvbnRyb2xQYXRocyk7XHJcbiAgICAgICAgY29uc3QgcHJvcEluZm8gPSB0aGlzLmdldFByb3BJbmZvQnlQYXRoKHBhdGhzKTtcclxuICAgICAgICBjb25zdCBpc011bHRpTGFuZ0lucHV0ID0gcHJvcEluZm8gJiYgcHJvcEluZm8ubWV0YWRhdGFJbmZvLmVuYWJsZU11bHRpTGFuZ0lucHV0O1xyXG4gICAgICAgIGlmIChpc011bHRpTGFuZ0lucHV0KSB7XHJcbiAgICAgICAgICBjb25zdCBjdXJyZW50TGFuZ3VhZ2UgPSBUcmFuc2xhdGVTZXJ2aWNlLmdldEN1cnJlbnRMYW5ndWFnZSgpO1xyXG4gICAgICAgICAgY29uc3QgY3VycmVudExhbmdWYWx1ZSA9IHZhbHVlICYmIHZhbHVlW2N1cnJlbnRMYW5ndWFnZV07XHJcbiAgICAgICAgICBpc1ZhbGlkID0gY3VycmVudExhbmdWYWx1ZSAhPT0gJycgJiYgY3VycmVudExhbmdWYWx1ZSAhPT0gbnVsbCAmJiBjdXJyZW50TGFuZ1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgY3VycmVudExhbmdWYWx1ZSAhPT0gJzAwMDEtMDEtMDEnICYmIGN1cnJlbnRMYW5nVmFsdWUgIT09ICcwMDAxLTAxLTAxIDAwOjAwOjAwJyAmJiBjdXJyZW50TGFuZ1ZhbHVlICE9PSAnMDAwMS0wMS0wMVQwMDowMDowMCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5SRVFVSVJFRCk7XHJcbiAgICAgICAgY29uc3QgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgcnVsZU9iaiwgY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgaWYgKGlzVmFsaWQgJiYgY29udHJvbC5lcnJvcnMgJiYgY29udHJvbC5lcnJvcnMucmVxdWlyZWQpIHtcclxuICAgICAgICAgIC8vIOS/ruWkjeW4ruWKqeaYoOWwhOaXqeS6juaOp+S7tui1i+WAvOWvvOiHtOaxh+aAu+mUmeivr+a2iOaBr+aXtuW4ruWKqeW/heWhq+mUmeivr+acquiiq+a4heepuueahOmXrumimFxyXG4gICAgICAgICAgZGVsZXRlIGNvbnRyb2wuZXJyb3JzLnJlcXVpcmVkO1xyXG4gICAgICAgICAgdGhpcy5pc0Zvcm1WYWxpZChwYXRocy5qb2luKCcuJykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaXNWYWxpZCA/IG51bGwgOiB7IHJlcXVpcmVkOiB7IHZhbHVlOiBjb250cm9sLnZhbHVlLCBuYW1lOiBpbnZhbGlkTWVzc2FnZSB9IH07XHJcbiAgICAgIH0sXHJcbiAgICAgIG1heExlbmd0aDogKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gfCBudWxsID0+IHtcclxuICAgICAgICBjb25zdCBpc0luVmFsaWQgPSBjb250cm9sLnZhbHVlICYmIGNvbnRyb2wudmFsdWUudG9TdHJpbmcoKS5sZW5ndGggPiBjb25zdHJhaW50c1swXTtcclxuICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuTUFYX0xFTkdUSCk7XHJcbiAgICAgICAgY29uc3QgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgcnVsZU9iaiwgY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuIGlzSW5WYWxpZCA/IHsgbWF4TGVuZ3RoOiB7IHZhbHVlOiBjb250cm9sLnZhbHVlLCBuYW1lOiBpbnZhbGlkTWVzc2FnZSB9IH0gOiBudWxsO1xyXG4gICAgICB9LFxyXG4gICAgICBtaW5MZW5ndGg6IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHwgbnVsbCA9PiB7XHJcbiAgICAgICAgY29uc3QgaXNJblZhbGlkID0gY29udHJvbC52YWx1ZSAmJiBjb250cm9sLnZhbHVlLnRvU3RyaW5nKCkubGVuZ3RoIDwgY29uc3RyYWludHNbMF07XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UoVmFsaWRhdGlvblR5cGVzLk1BWF9MRU5HVEgpO1xyXG4gICAgICAgIGNvbnN0IGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIHJldHVybiBpc0luVmFsaWQgPyB7IG1pbkxlbmd0aDogeyB2YWx1ZTogY29udHJvbC52YWx1ZSwgbmFtZTogaW52YWxpZE1lc3NhZ2UgfSB9IDogbnVsbDtcclxuICAgICAgfSxcclxuICAgICAgbWluVmFsdWU6IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHwgbnVsbCA9PiB7XHJcbiAgICAgICAgbGV0IGlzSW5WYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBpbnZhbGlkTWVzc2FnZSA9ICcnO1xyXG4gICAgICAgIC8vIOi/memHjOWPquWBmuacgOWwj+WAvOWIpOaWre+8jOWmguaenOeUqOaIt+acqui+k+WFpeWImeS4jeW6lOivpeWBmuWIpOaWrVxyXG4gICAgICAgIGlmIChjb250cm9sLnZhbHVlID09PSBudWxsIHx8IGNvbnRyb2wudmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgY29udHJvbC52YWx1ZSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGNvbnN0cmFpbnRzWzBdID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgaXNJblZhbGlkID0gY29udHJvbC52YWx1ZSA8IGNvbnN0cmFpbnRzWzBdO1xyXG4gICAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UoVmFsaWRhdGlvblR5cGVzLk1JTlZBTFVFKTtcclxuICAgICAgICAgIGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgICAgLy8gaW52YWxpZE1lc3NhZ2UgPSBgJHtuZ0Zvcm1Db250cm9sLm5hbWV955qE5YC85LiN5bqU5bCP5LqOJHtjb25zdHJhaW50c1swXX1gO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobmdGb3JtQ29udHJvbCAmJiBuZ0Zvcm1Db250cm9sLmJpZ051bWJlciA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgLy8g5aSn5pWwXHJcbiAgICAgICAgICBjb25zdCBtaW5WYWx1ZSA9IG5ldyBCaWdOdW1iZXIoY29uc3RyYWludHNbMF0pO1xyXG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBuZXcgQmlnTnVtYmVyKGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgICAgaXNJblZhbGlkID0gbWluVmFsdWUuaXNHcmVhdGVyVGhhbih2YWx1ZSk7XHJcbiAgICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuTUlOVkFMVUUpO1xyXG4gICAgICAgICAgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgcnVsZU9iaiwgY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5NSU5fREFURSk7XHJcbiAgICAgICAgICAvLyDlgYflrprkuLrml6XmnJ9cclxuICAgICAgICAgIC8vIOS4jeeuoeaOp+S7tueahOWAvOS4uuS7gOS5iO+8jOWPquimgeadoeS7tuS4jeWtmOWSi+aIluaYr251bGzmiJYw5oiWdW5kZWZpbmVk5oiWXCJcIu+8jOWImeS4jeWvueavlOWkp+Wwj++8jOaXoOaEj+S5iVxyXG4gICAgICAgICAgaWYgKCFjb25zdHJhaW50cyB8fCBjb25zdHJhaW50cy5sZW5ndGggPCAxIHx8ICFjb25zdHJhaW50c1swXSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChjb250cm9sLnZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xyXG4gICAgICAgICAgICBpc0luVmFsaWQgPSBjb250cm9sLnZhbHVlIDwgbmV3IERhdGUoY29uc3RyYWludHNbMF0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaXNJblZhbGlkID0gbmV3IERhdGUoY29udHJvbC52YWx1ZSkgPCBuZXcgRGF0ZShjb25zdHJhaW50c1swXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlT2JqLCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlzSW5WYWxpZCA/IHsgbWluVmFsdWU6IHsgdmFsdWU6IGNvbnRyb2wudmFsdWUsIG5hbWU6IGludmFsaWRNZXNzYWdlIH0gfSA6IG51bGw7XHJcbiAgICAgIH0sXHJcbiAgICAgIG1heFZhbHVlOiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IG51bGwgPT4ge1xyXG4gICAgICAgIGxldCBpc0luVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICBsZXQgaW52YWxpZE1lc3NhZ2UgPSAnJztcclxuICAgICAgICBpZiAoY29udHJvbC52YWx1ZSA9PT0gbnVsbCB8fCBjb250cm9sLnZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGNvbnRyb2wudmFsdWUgPT09ICdudW1iZXInICYmIHR5cGVvZiBjb25zdHJhaW50c1swXSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgIGlzSW5WYWxpZCA9IGNvbnRyb2wudmFsdWUgPiBjb25zdHJhaW50c1swXTtcclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5NQVhWQUxVRSk7XHJcbiAgICAgICAgICBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlT2JqLCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICAgIC8vIGludmFsaWRNZXNzYWdlID0gYCR7bmdGb3JtQ29udHJvbC5uYW1lfeeahOWAvOS4jeW6lOWkp+S6jiR7Y29uc3RyYWludHNbMF19YDtcclxuICAgICAgICB9IGVsc2UgaWYgKG5nRm9ybUNvbnRyb2wgJiYgbmdGb3JtQ29udHJvbC5iaWdOdW1iZXIgPT09IHRydWUpIHtcclxuICAgICAgICAgIC8vIOWkp+aVsFxyXG4gICAgICAgICAgY29uc3QgbWF4VmFsdWUgPSBuZXcgQmlnTnVtYmVyKGNvbnN0cmFpbnRzWzBdKTtcclxuICAgICAgICAgIGNvbnN0IHZhbHVlID0gbmV3IEJpZ051bWJlcihjb250cm9sLnZhbHVlKTtcclxuICAgICAgICAgIGlzSW5WYWxpZCA9IG1heFZhbHVlLmlzTGVzc1RoYW4odmFsdWUpO1xyXG4gICAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UoVmFsaWRhdGlvblR5cGVzLk1BWFZBTFVFKTtcclxuICAgICAgICAgIGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyDlgYflrprkuLrml6XmnJ9cclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5NQVhfREFURSk7XHJcbiAgICAgICAgICBpZiAoY29udHJvbC52YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcclxuICAgICAgICAgICAgaXNJblZhbGlkID0gY29udHJvbC52YWx1ZSA+IG5ldyBEYXRlKGNvbnN0cmFpbnRzWzBdKTtcclxuICAgICAgICAgICAgLy8gaW52YWxpZE1lc3NhZ2UgPSBgJHtuZ0Zvcm1Db250cm9sLm5hbWV955qE5YC85LiN5bqU5pma5LqOJHtjb25zdHJhaW50c1swXX1gO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaXNJblZhbGlkID0gbmV3IERhdGUoY29udHJvbC52YWx1ZSkgPiBuZXcgRGF0ZShjb25zdHJhaW50c1swXSk7XHJcbiAgICAgICAgICAgIC8vIGludmFsaWRNZXNzYWdlID0gYCR7bmdGb3JtQ29udHJvbC5uYW1lfeeahOWAvOS4jeW6lOaXqeS6jiR7Y29uc3RyYWludHNbMF19YDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaXNJblZhbGlkID8geyBtYXhWYWx1ZTogeyB2YWx1ZTogY29udHJvbC52YWx1ZSwgbmFtZTogaW52YWxpZE1lc3NhZ2UgfSB9IDogbnVsbDtcclxuICAgICAgfSxcclxuICAgICAgZXhjbHVkZTogKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gfCBudWxsID0+IHtcclxuICAgICAgICBjb25zdCBpc1ZhbGlkID0gdHlwZW9mIGNvbnRyb2wudmFsdWUgPT09ICdzdHJpbmcnICYmICF0aGlzLnZhbGlkYXRvckpzLmNvbnRhaW5zKGNvbnRyb2wudmFsdWUsIGNvbnN0cmFpbnRzWzBdKTtcclxuICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuRVhDTFVERSk7XHJcbiAgICAgICAgY29uc3QgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgcnVsZU9iaiwgY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgPyBudWxsIDogeyBleGNsdWRlOiB7IHZhbHVlOiBjb250cm9sLnZhbHVlLCBuYW1lOiBpbnZhbGlkTWVzc2FnZSB9IH07XHJcbiAgICAgIH0sXHJcbiAgICAgIG1hdGNoZXM6IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHwgbnVsbCA9PiB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSAoY29udHJvbC52YWx1ZSA9PT0gbnVsbCB8fCBjb250cm9sLnZhbHVlID09PSB1bmRlZmluZWQpID8gJycgOiBjb250cm9sLnZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgY29uc3QgaXNWYWxpZCA9IHZhbHVlID09PSAnJyA/IHRydWUgOiB0aGlzLnZhbGlkYXRvckpzLm1hdGNoZXModmFsdWUsIGNvbnN0cmFpbnRzWzBdKTtcclxuICAgICAgICBsZXQgaW52YWxpZE1lc3NhZ2UgPSBtZXNzYWdlO1xyXG4gICAgICAgIGlmICghaW52YWxpZE1lc3NhZ2UpIHtcclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5NQVRDSEVTKTtcclxuICAgICAgICAgIGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgPyBudWxsIDogeyBtYXRjaGVzOiB7IHZhbHVlOiBjb250cm9sLnZhbHVlLCBuYW1lOiBpbnZhbGlkTWVzc2FnZSB9IH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBydWxlSGFuZGxlck9ialt0eXBlXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaQnOmbhuWxnuaAp+ijhemlsOWZqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgY29sbGVjdE1ldGFkYXRhcygpIHtcclxuICAgIHRoaXMubmdWYWxpZGF0ZUZvcm0gPSB0aGlzLmZyYW1lQ29udGV4dC5tZXRhZGF0YS5mb3JtID8gTWV0YWRhdGFVdGlsLnRyYW5zbGF0ZU1ldGFkYXRhQnlOYW1lKHRoaXMuZnJhbWVDb250ZXh0Lm1ldGFkYXRhLmZvcm0sIHRoaXMudHJhbnNsYXRlU2VydmljZSwgWydmb3JtR3JvdXBOYW1lJ10pIDpcclxuICAgICAgTWV0YWRhdGFVdGlsLmdldENsYXNzTWV0YWRhdGFCeU5hbWVXaXRoVHJhbnNsYXRlKHRoaXMuY29uc3RydWN0b3IsIE5HX1ZBTElEQVRFX0ZPUk0sXHJcbiAgICAgICAgdGhpcy50cmFuc2xhdGVTZXJ2aWNlLCBbJ2Zvcm1Hcm91cE5hbWUnXSk7XHJcbiAgICB0aGlzLm5nRm9ybUNvbnRyb2xzID0gdGhpcy5jb2xsZWN0aW9uRm9ybUNvbnRyb2xNZXRhZGF0cyh0aGlzLmZyYW1lQ29udGV4dC5tZXRhZGF0YS5mb3JtQ29udHJvbHMpO1xyXG4gICAgdGhpcy5uZ0NoaWxkRm9ybXMgPSB0aGlzLmZyYW1lQ29udGV4dC5tZXRhZGF0YS5zdWJGb3JtcyB8fCBNZXRhZGF0YVV0aWwuZ2V0UHJvcHNNZXRhZGF0YXNCeU5hbWUodGhpcy5jb25zdHJ1Y3RvciwgTkdfQ0hJTERfRk9STSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNvbGxlY3Rpb25Gb3JtQ29udHJvbE1ldGFkYXRzKHByZWxvYWRNZXRhZGF0YTogeyBbcHJvcE5hbWU6IHN0cmluZ106IE5nRm9ybUNvbnRyb2wgfSA9IG51bGwpOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogTmdGb3JtQ29udHJvbCB9IHtcclxuICAgIGNvbnN0IG1ldGFkYXRhcyA9IHByZWxvYWRNZXRhZGF0YSA/IE1ldGFkYXRhVXRpbC50cmFuc2xhdGVNZXRhZGF0YUJ5TmFtZShwcmVsb2FkTWV0YWRhdGEsIHRoaXMudHJhbnNsYXRlU2VydmljZSwgWyduYW1lJ10pIDpcclxuICAgICAgTWV0YWRhdGFVdGlsLmdldFByb3BzTWV0YWRhdGFzQnlOYW1lV2l0aFRyYW5zbGF0ZSh0aGlzLmNvbnN0cnVjdG9yLCBOR19GT1JNX0NPTlRST0wsIHRoaXMudHJhbnNsYXRlU2VydmljZSwgWyduYW1lJ10pO1xyXG4gICAgLy8g5ZCR6aqM6K+B6KeE5YiZ5Lit6ZmE5Yqg6KGo5Y2V5L+h5oGv77yM55So5LqO5pi+56S66aqM6K+B5o+Q56S644CCXHJcbiAgICBpZiAobWV0YWRhdGFzKSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKG1ldGFkYXRhcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5nRm9ybUNvbnRyb2wgPSBtZXRhZGF0YXNbcHJvcE5hbWVdO1xyXG4gICAgICAgIGNvbnN0IGRpc3BsYXlGaWVsZE5hbWUgPSBuZ0Zvcm1Db250cm9sLm5hbWUgfHwgbmdGb3JtQ29udHJvbC5kZWZhdWx0STE4blZhbHVlIHx8ICcnO1xyXG4gICAgICAgIGNvbnN0IGZvcm1Db250cm9sSWQgPSBuZ0Zvcm1Db250cm9sLmlkO1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KG5nRm9ybUNvbnRyb2wudmFsaWRSdWxlcykpIHtcclxuICAgICAgICAgIG5nRm9ybUNvbnRyb2wudmFsaWRSdWxlcy5mb3JFYWNoKCh2YWxpZGF0aW9uUnVsZTogVmFsaWRhdGVSdWxlKSA9PiB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRpb25SdWxlLnRhcmdldElkID0gZm9ybUNvbnRyb2xJZDtcclxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUudGFyZ2V0TmFtZSA9IHRoaXMuZm9ybUdyb3VwTmFtZTtcclxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUucHJvcGVydHkgPSBkaXNwbGF5RmllbGROYW1lO1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uUnVsZS5maWVsZCA9IG5nRm9ybUNvbnRyb2wuYmluZGluZztcclxuXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG1ldGFkYXRhcztcclxuICB9XHJcblxyXG4gIC8vIOiOt+WPlmdyaWTkuK3mr4/mnaHmlbDmja7nmoRmb3JtQ29udHJvbFxyXG4gIGdldEdyaWRJdGVtQ29udHJvbChwcm9wTmFtZTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgICBjb25zdCBjcmVhdGVDb250cm9sRnJvbVJ1bGVzID0gcHJvcGVydHlOYW1lID0+IHtcclxuICAgICAgY29uc3QgdmFsaWRhdG9ycyA9IFtdO1xyXG4gICAgICAvLyDorr7nva5mb3Jt5Lit5a6a5LmJ55qE6aqM6K+B6KeE5YiZXHJcbiAgICAgIGlmICh0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0gJiYgQXJyYXkuaXNBcnJheSh0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0udmFsaWRSdWxlcykpIHtcclxuICAgICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXS52YWxpZFJ1bGVzLCAoKHJ1bGVPYmopID0+IHtcclxuICAgICAgICAgIGNvbnN0IHZhbGlkYXRlRm4gPSB0aGlzLmdldFZhbGlkYXRvckJ5UnVsZU9iaihydWxlT2JqLCB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0pO1xyXG4gICAgICAgICAgaWYgKHZhbGlkYXRlRm4pIHtcclxuICAgICAgICAgICAgdmFsaWRhdG9ycy5wdXNoKHZhbGlkYXRlRm4pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbmV3IEZvcm1Db250cm9sKHZhbHVlLCB7IHZhbGlkYXRvcnM6IHZhbGlkYXRvcnMsIHVwZGF0ZU9uOiAnYmx1cicgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGNyZWF0ZUNvbnRyb2xGcm9tUnVsZXMocHJvcE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLy8g5qC55o2u5a6e5L2T5bGe5oCn5ZCN6I635Y+W55WM6Z2i57uR5a6a55qE5bGe5oCn5ZCNXHJcbiAgZ2V0RG9tUHJvcGVydHlOYW1lQnlFbnRpdHlQcm9wKHByb3BlcnR5TmFtZTogc3RyaW5nLCBwcmVmaXg6IHN0cmluZyA9ICcnKTogc3RyaW5nIHtcclxuICAgIGxldCBkb21Qcm9wZXJ0eU5hbWUgPSAnJztcclxuICAgIE9iamVjdC5rZXlzKHRoaXMubmdGb3JtQ29udHJvbHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgY29uc3QgYmluZGluZyA9IGAke3ByZWZpeH0ke3RoaXMubmdGb3JtQ29udHJvbHNba2V5XS5iaW5kaW5nfWA7XHJcbiAgICAgIGlmIChiaW5kaW5nID09PSBwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICBkb21Qcm9wZXJ0eU5hbWUgPSBrZXk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGRvbVByb3BlcnR5TmFtZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7ukZvcm1Db250cm9sXHJcbiAgICovXHJcbiAgY3JlYXRlQ29udHJvbHMoKSB7XHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLm5nRm9ybUNvbnRyb2xzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRm9ybUNvbnRyb2wgPSB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgdmFsaWRhdG9yczogVmFsaWRhdG9yRm5bXSA9IFtdO1xyXG5cclxuICAgICAgLy8g6K6+572uZm9ybeS4reWumuS5ieeahOmqjOivgeinhOWImVxyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BOYW1lXS52YWxpZFJ1bGVzKSkge1xyXG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwodGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wTmFtZV0udmFsaWRSdWxlcywgKHJ1bGVPYmogPT4ge1xyXG4gICAgICAgICAgY29uc3QgdmFsaWRhdGVGbiA9IHRoaXMuZ2V0VmFsaWRhdG9yQnlSdWxlT2JqKHJ1bGVPYmosIHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcE5hbWVdKTtcclxuICAgICAgICAgIGlmICh2YWxpZGF0ZUZuKSB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRvcnMucHVzaCh2YWxpZGF0ZUZuKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVwZGF0ZU9uID0gbmdGb3JtQ29udHJvbC51cGRhdGVPbiA/IG5nRm9ybUNvbnRyb2wudXBkYXRlT24gOiAnYmx1cic7XHJcbiAgICAgIGNvbnN0IGNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2wobnVsbCwgeyB2YWxpZGF0b3JzOiB2YWxpZGF0b3JzLCB1cGRhdGVPbjogdXBkYXRlT24gfSk7XHJcbiAgICAgIGlmIChuZ0Zvcm1Db250cm9sLmJpbmRpbmcpIHtcclxuICAgICAgICB0aGlzLnNldFVwQmluZGluZ0RhdGFQaXBlbGluZShjb250cm9sLCBuZ0Zvcm1Db250cm9sLmJpbmRpbmcsIG5nRm9ybUNvbnRyb2wudmFsdWVDb252ZXJ0ZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuY29udHJvbHNbcHJvcE5hbWVdID0gY29udHJvbDtcclxuICAgICAgdGhpc1twcm9wTmFtZV0gPSBjb250cm9sO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7pGb3JtR3JvdXBcclxuICAgKi9cclxuICBjcmVhdGVDaGlsZEZvcm1zKCkge1xyXG4gICAgT2JqZWN0LmtleXModGhpcy5uZ0NoaWxkRm9ybXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdGb3JtR3JvdXAgPSB0aGlzLm5nQ2hpbGRGb3Jtc1twcm9wTmFtZV07XHJcblxyXG4gICAgICAvLyDmnoTpgKDlrZBGb3JtXHJcbiAgICAgIGNvbnN0IGZvcm1Hcm91cCA9IG5ldyBuZ0Zvcm1Hcm91cC5mb3JtVHlwZSgpO1xyXG4gICAgICBmb3JtR3JvdXAuaW5pdCh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmJpbmRpbmdQYXRoLCB0aGlzLmZyYW1lQ29udGV4dCk7XHJcblxyXG4gICAgICB0aGlzLmNvbnRyb2xzW3Byb3BOYW1lXSA9IGZvcm1Hcm91cDtcclxuICAgICAgdGhpc1twcm9wTmFtZV0gPSBmb3JtR3JvdXA7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLypcclxuICAqIOaWsOWinkZvcm1Db250cm9sc1xyXG4gICAqL1xyXG4gIGFkZENvbnRyb2xzKGNvbHVtbjogYW55LCBjb252ZXJ0ZXI/OiBDb250cm9sVmFsdWVDb252ZXJ0ZXIpIHtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVPbiA9IGNvbHVtbiAmJiBjb2x1bW4uZWRpdG9yICYmIGNvbHVtbi5lZGl0b3IudXBkYXRlT24gPyBjb2x1bW4uZWRpdG9yLnVwZGF0ZU9uIDogJ2JsdXInO1xyXG4gICAgY29uc3QgZm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woJycsIHsgdXBkYXRlT246IHVwZGF0ZU9uIH0pO1xyXG4gICAgY29uc3QgZmllbGRQYXRoID0gY29sdW1uLmRhdGFGaWVsZDtcclxuXHJcbiAgICAvLyDml6XmnJ/moLzlvI8gIOmcgOimgeagvOW8j+WMllxyXG4gICAgLy8gdGhpcy5zZXRVcEJpbmRpbmdEYXRhUGlwZWxpbmUoZm9ybUNvbnRyb2wsIGZpZWxkUGF0aCwgY29udmVydGVyKTtcclxuICAgIGlmIChjb2x1bW4uZWRpdG9yICYmIGNvbHVtbi5lZGl0b3IuYmluZGluZykge1xyXG4gICAgICB0aGlzLnNldFVwQmluZGluZ0RhdGFQaXBlbGluZShmb3JtQ29udHJvbCwgZmllbGRQYXRoLCBjb252ZXJ0ZXIpO1xyXG4gICAgICB0aGlzLmNvbnRyb2xzW2NvbHVtbi5lZGl0b3IuYmluZGluZy5wYXRoXSA9IGZvcm1Db250cm9sO1xyXG4gICAgICB0aGlzW2NvbHVtbi5lZGl0b3IuYmluZGluZy5wYXRoXSA9IGZvcm1Db250cm9sO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOaQreW7umNvbnRyb2zlkox0YWJsZeS5i+mXtOeahOmAmumBk1xyXG4gICAqIEBwYXJhbSBjb250cm9sIOaOp+S7tlxyXG4gICAqIEBwYXJhbSBiaW5kaW5nRmllbGRQYXRoIOe7keWumueahOWtl+auteWQjVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0VXBCaW5kaW5nRGF0YVBpcGVsaW5lKGNvbnRyb2w6IEZvcm1Db250cm9sLCBiaW5kaW5nRmllbGRQYXRoLCBjb252ZXJ0ZXI/OiBDb250cm9sVmFsdWVDb252ZXJ0ZXIpIHtcclxuXHJcbiAgICBpZiAoIXRoaXMuYmluZGluZ0RhdGEpIHtcclxuICAgICAgdGhyb3cgRXJyb3IoJ+W9k+WJjee7hOS7tuS4iuS4i+aWh+S4reaJvuS4jeWIsEJpbmRpbmdEYXRh77yM6K+35qOA5p+l77yBJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5aaC5p6cY29udmVydGVy5a2Y5Zyo77yM5YiZ5YaZ5YWl5LiK5LiL5paH77yMQ29udmVydGVy5Lit5Y+v6IO95Lya6ZyA6KaB5LuOaW5qZWN0b3LkuK3ojrflj5blvZPliY3or63oqIDkv6Hmga9cclxuICAgIGlmIChjb252ZXJ0ZXIpIHtcclxuICAgICAgY29udmVydGVyWydfX0ZSQU1FX0NPTlRFWFRfXyddID0gdGhpcy5mcmFtZUNvbnRleHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5bCGYmluZGlnblBhdGjkuI5iaW5kaW5nRmllbGRQYXRo5ZCI5bm2XHJcbiAgICBpZiAodGhpcy5iaW5kaW5nUGF0aC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGJpbmRpbmdGaWVsZFBhdGggPSB0aGlzLmJpbmRpbmdQYXRoLnN1YnN0cigxKS5yZXBsYWNlKC9cXC8vZywgJy4nKSArICcuJyArIGJpbmRpbmdGaWVsZFBhdGg7XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aHM6IHN0cmluZ1tdID0gYmluZGluZ0ZpZWxkUGF0aC5zcGxpdCgnLicpO1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgIC8vIOiuvue9ruWIneWni+WAvFxyXG4gICAgY29uc3QgaW5pdFZhbHVlID0gdGhpcy5nZXRWYWx1ZUZyb21CaW5kaW5nRGF0YShiaW5kaW5nUGF0aHMsIGNvbnZlcnRlcik7XHJcbiAgICBjb250cm9sLnNldFZhbHVlKGluaXRWYWx1ZSk7XHJcblxyXG4gICAgLy8g6K6+572u5Yid5aeL5YC8XHJcblxyXG4gICAgLy8gQmluZGluZ0RhdGEgPT4gY29udHJvbFxyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5jaGFuZ2VzLnBpcGUoZmlsdGVyKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRPYmplY3QoKTtcclxuICAgICAgY29uc3QgY2hhbmdlUGF0aCA9IGNoYW5nZS5wYXRoLmpvaW4oJy4nKTtcclxuICAgICAgaWYgKGNoYW5nZS5pc1VkdCkge1xyXG4gICAgICAgIHJldHVybiBjaGFuZ2VQYXRoID09PSBiaW5kaW5nRmllbGRQYXRoO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgICAvLyBwYXRo5a6M5YWo5Yy56YWNXHJcbiAgICAgICAgcmV0dXJuIGNoYW5nZVBhdGggPT09IGJpbmRpbmdGaWVsZFBhdGg7XHJcbiAgICAgIH0gZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5VcGRhdGUpIHtcclxuICAgICAgICAvLyDlr7nkuo5PYmplY3RDaGFuZ2Vk44CBU2VsZWN0aW9uQ2hhbmdlZO+8jOWMuemFjeWIsOeItue6p1xyXG4gICAgICAgIGNvbnN0IGNoYW5nZVBhdGhXaXRoRG90ID0gY2hhbmdlUGF0aCA9PT0gJycgPyBjaGFuZ2VQYXRoIDogY2hhbmdlUGF0aCArICcuJztcclxuICAgICAgICAvLyDkuLvooajmlrDlop7miJbliIfmjaLml7bvvIzph43nva7plJnor6/kv6Hmga9cclxuICAgICAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQpIHtcclxuICAgICAgICAgIHRoaXMucmVzZXRDYXJkVmFsaWRNc2coKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGJpbmRpbmdGaWVsZFBhdGguaW5kZXhPZihjaGFuZ2VQYXRoV2l0aERvdCkgPT09IDA7XHJcbiAgICAgIH0gZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuVXBkYXRlRXJyb3JzKSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZVBhdGggPT09IGJpbmRpbmdGaWVsZFBhdGgpIHtcclxuICAgICAgICAgIHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV0gPSB0aGlzLmNhcmRDb250cm9sc1twcm9wZXJ0eU5hbWVdIHx8IHt9O1xyXG4gICAgICAgICAgaWYgKGJpbmRpbmdGaWVsZFBhdGggJiYgdGhpcy5jb250cm9sc1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgICAgICAgIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSA9PT0gY2hhbmdlLmlkKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXS5lcnJvcnMgPSBjaGFuZ2UuZXJyb3JzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIC8vIOWPquabtOaWsOW9k+WJjeihjOeahOmUmeivr+aPkOekuuS/oeaBr++8jOS4jeaYr+W9k+WJjeihjOeahOS4jeWkhOeQhu+8jOaUvuWIsOacgOe7iOeahOWunuS9k+agoemqjOmHjOmdolxyXG4gICAgICAgICAgICAgIC8vIHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV0uZXJyb3JzID0gbnVsbDtcclxuICAgICAgICAgICAgICAvLyB0aGlzLmlzRm9ybVZhbGlkKGJpbmRpbmdGaWVsZFBhdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyDmsqHmnInplJnor6/ml7ZcclxuICAgICAgICAgIGlmICghY2hhbmdlLnBhdGggfHwgIWJpbmRpbmdGaWVsZFBhdGggfHwgIWNoYW5nZS5lcnJvcnMpIHtcclxuICAgICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXS5lcnJvcnMgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmlzRm9ybVZhbGlkKGJpbmRpbmdGaWVsZFBhdGgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KSkuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBsZXQgZnVsbEVudGl0eVByb3AgPSBwcm9wZXJ0eU5hbWU7XHJcbiAgICAgIC8vIHVkdOWtl+auteWxleekuuaXtumcgOimgeWwhueItue6p+WxnuaAp+WQjeWSjOiHqui6q+WxnuaAp+WQjeeUqCdfJ+i/nuaOpVxyXG4gICAgICBsZXQgcGF0aFByZWZpeCA9ICcnO1xyXG4gICAgICBpZiAoY2hhbmdlLmlzVWR0KSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZS5pc0dyaWQpIHtcclxuICAgICAgICAgIC8vIGdyaWQg5bCG5LuO6KGo5Li75a2X5q615Y676ZmkXHJcbiAgICAgICAgICBjaGFuZ2UucGF0aC5zaGlmdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2hhbmdlLnBhdGgubGVuZ3RoKSB7XHJcbiAgICAgICAgICBwYXRoUHJlZml4ID0gY2hhbmdlLnBhdGguam9pbignLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdWxsRW50aXR5UHJvcCA9IHBhdGhQcmVmaXg7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShiaW5kaW5nUGF0aHMsIGZhbHNlKTtcclxuICAgICAgY29uc3QgbmV3Q29udHJvbFZhbHVlID0gY29udmVydGVyID8gY29udmVydGVyLmNvbnZlcnRGcm9tKHZhbHVlKSA6IHZhbHVlO1xyXG4gICAgICAvLyDorr7nva5Gb3JtQ29udHJvbFxyXG4gICAgICBjb25zdCBkb21Qcm9wTmFtZSA9IHRoaXMuZ2V0RG9tUHJvcGVydHlOYW1lQnlFbnRpdHlQcm9wKGZ1bGxFbnRpdHlQcm9wKTtcclxuICAgICAgdGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcE5hbWVdID0gdGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcE5hbWVdIHx8IHt9O1xyXG4gICAgICBpZiAoY2hhbmdlLmVycm9ycykge1xyXG4gICAgICAgIHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BOYW1lXS5lcnJvcnMgPSBjaGFuZ2UuZXJyb3JzO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIGRhdGFHcmlk5L+d5a2Y5pe277yM5qC55o2uaWTvvIzliJvlu7pmb3JtQ29udHJvbO+8jOW5tuiuvue9rumUmeivr+WvueixoVxyXG4gICAgICBpZiAoY2hhbmdlLmlkKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udHJvbElkTWFwW2NoYW5nZS5pZF0gJiYgT2JqZWN0LmtleXModGhpcy5jb250cm9sSWRNYXBbY2hhbmdlLmlkXSkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbnRyb2xJZE1hcFtjaGFuZ2UuaWRdID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29udHJvbElkTWFwW2NoYW5nZS5pZF0gPSB0aGlzLmNvbnRyb2xJZE1hcFtjaGFuZ2UuaWRdIHx8IHt9O1xyXG4gICAgICAgIGlmIChjaGFuZ2UuZXJyb3JzKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbnRyb2xJZE1hcFtjaGFuZ2UuaWRdW2RvbVByb3BOYW1lXSA9IHtcclxuICAgICAgICAgICAgZXJyb3JzOiBjaGFuZ2UuZXJyb3JzXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICAvLyDlpoLmnpzlkozmjqfku7bkuIrnmoTlgLzkuIDmoLfvvIzliJnkuI3lho3mm7TmlrDmjqfku7bnmoTlgLxcclxuICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KGNvbnRyb2wudmFsdWUpID09PSBKU09OLnN0cmluZ2lmeShuZXdDb250cm9sVmFsdWUpKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDmraPliJnliKTmlq3mmK/lkKbkuLrml6XmnJ9cclxuICAgICAgY29udHJvbC5zZXRWYWx1ZShuZXdDb250cm9sVmFsdWUpO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGNvbnRyb2wgPT4gQmluZGluZ0RhdGFcclxuICAgIGNvbnRyb2wudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSgodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBvbGRCaW5kaW5nVmFsdWUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGJpbmRpbmdQYXRocyk7XHJcbiAgICAgIC8vIOWmguaenOaYr+aXpeacn++8jOavlOi+g+W5tOaciOaXpeaYr+WQpuebuOetie+8jOebuOetieWImeS4jemHjeaWsOi1i+WAvFxyXG4gICAgICBpZiAodmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IgJiYgdmFsdWUuY29uc3RydWN0b3IubmFtZSA9PT0gJ0RhdGUnKSB7XHJcbiAgICAgICAgaWYgKG9sZEJpbmRpbmdWYWx1ZSAmJiBjb252ZXJ0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IG9sZFZhbHVlID0gY29udmVydGVyLmNvbnZlcnRGcm9tKG9sZEJpbmRpbmdWYWx1ZSk7XHJcbiAgICAgICAgICBpZiAodGhpcy5jb21wYXJlRGF0ZSh2YWx1ZSwgb2xkVmFsdWUpID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOWmguaenOaYr+aXpeacn++8jOavlOi+g+W5tOaciOaXpeaYr+WQpuebuOetie+8jOebuOetieWImeS4jemHjeaWsOi1i+WAvFxyXG4gICAgICBpZiAodGhpcy5pc0RhdGUoY29udmVydGVyKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChEYXRlVXRpbC5pc0VxdWFsKHZhbHVlLCBvbGRCaW5kaW5nVmFsdWUpID09PSB0cnVlKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDlpoLmnpzlkoxCaW5kaW5nRGF0YeS4iueahOWAvOWSjOaOp+S7tuacgOaWsOeahOWAvOS4gOagt++8jOWImeS4jeWGjeabtOaWsEJpbmRpbmdEYXRhXHJcbiAgICAgIGNvbnN0IG5ld0JpbmRpbmdWYWx1ZSA9IGNvbnZlcnRlciA/IGNvbnZlcnRlci5jb252ZXJ0VG8odmFsdWUpIDogdmFsdWU7XHJcbiAgICAgIGlmIChKU09OLnN0cmluZ2lmeShvbGRCaW5kaW5nVmFsdWUpID09PSBKU09OLnN0cmluZ2lmeShuZXdCaW5kaW5nVmFsdWUpKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIGlmICghdGhpcy5pc0Zvcm1WYWxpZChwcm9wZXJ0eU5hbWUsIG51bGwsIG51bGwsIGZhbHNlKSkge1xyXG4gICAgICAvLyAgIGNvbnN0IGVycm9ycyA9IHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV0gJiYgdGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXS5lcnJvcnMgfHwge307XHJcbiAgICAgIC8vICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRWYWx1ZShiaW5kaW5nUGF0aHMsIG5ld0JpbmRpbmdWYWx1ZSwgZmFsc2UsIHRydWUsIGVycm9ycyk7XHJcbiAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY2xlYXJCYWNrRW5kTWVzc2FnZXMocHJvcGVydHlOYW1lKTtcclxuICAgICAgY29uc3QgZW1pdEV2ZW50VG9WaWV3ID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5ydW5Nb2RlID09PSBSdW5Nb2RlLmhpZ2hTcGVlZDtcclxuICAgICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRWYWx1ZShiaW5kaW5nUGF0aHMsIG5ld0JpbmRpbmdWYWx1ZSwgZW1pdEV2ZW50VG9WaWV3LCB0cnVlLCBudWxsLCB7IGZyYW1lQ29udGV4dDogdGhpcy5mcmFtZUNvbnRleHQgfSk7XHJcbiAgICAgIC8vfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKTmlq3mmK/lkKbmmK/ml6XmnJ/lrZfmrrVcclxuICAgKiAx44CB55uu5YmN5rKh5pyJ5Yqe5rOV5Yik5pat5LiA5Liq5a2X5q615piv5ZCm5piv5pel5pyf77yM5Y+q6IO95qC55o2uQ29udmVydGVy5p2l5Yik5pat77ybXHJcbiAgICogMuOAgURldmtpdOS4jeiDveS+nei1lktlbmRvQmluZGluZ++8jOS4jeiDveebtOaOpeWIpOaWrURhdGVDb252ZXJ0ZXLvvJtcclxuICAgKiAz44CB5LiN6IO95L2/55SoY29uc3RydWN0b3IubmFtZSzljovnvKnlkI5uYW1l5Y+Y5LqG77ybXHJcbiAgICogNOOAgeaaguaXtuagueaNrmZvcm1hdOWxnuaAp+adpeWIpOaWre+8jOS4gOaXpuWFtuS7lkNvbnZlcnRlcuaciWZvcm1hdO+8jOWImeWIpOaWreWkseaViO+8jOaaguaXtuayoeaciei/meenjeaDheWGtVxyXG4gICAqIEB0b2RvXHJcbiAgICog5Li65pel5pyf5a2X5q615re75Yqg5rOo6Kej77yM5qC55o2u5rOo6Kej5p2l5Yik5patXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc0RhdGUoY29udmVydGVyOiBDb250cm9sVmFsdWVDb252ZXJ0ZXIpOiBib29sZWFuIHtcclxuICAgIGxldCBpc0RhdGVDb252ZXJ0ZXIgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBpZiAoY29udmVydGVyICYmIGNvbnZlcnRlci5jb25zdHJ1Y3RvciAmJiBjb252ZXJ0ZXIuY29uc3RydWN0b3IubmFtZSA9PT0gJ0RhdGVDb252ZXJ0ZXInKSB7XHJcbiAgICAvLyAgIGlzRGF0ZUNvbnZlcnRlciA9IHRydWU7XHJcbiAgICAvLyB9XHJcbiAgICBpZiAoY29udmVydGVyICYmIGNvbnZlcnRlci5oYXNPd25Qcm9wZXJ0eSgnZm9ybWF0JykgPT09IHRydWUpIHtcclxuICAgICAgaXNEYXRlQ29udmVydGVyID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBpc0RhdGVDb252ZXJ0ZXI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmr5TovoPml6XmnJ/vvIjlj6rmr5TovoPlubTmnIjml6XvvIlcclxuICAgKi9cclxuICBjb21wYXJlRGF0ZShzcmNEYXRlOiBEYXRlLCBkc3REYXRlOiBEYXRlKSB7XHJcbiAgICBpZiAoIXNyY0RhdGUgfHwgIWRzdERhdGUpIHtcclxuICAgICAgcmV0dXJuIHNyY0RhdGUgPT09IGRzdERhdGU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpc0VxdWFsID1cclxuICAgICAgc3JjRGF0ZS5nZXRGdWxsWWVhcigpID09PSBkc3REYXRlLmdldEZ1bGxZZWFyKClcclxuICAgICAgJiYgc3JjRGF0ZS5nZXRNb250aCgpID09PSBkc3REYXRlLmdldE1vbnRoKClcclxuICAgICAgJiYgc3JjRGF0ZS5nZXREYXRlKCkgPT09IGRzdERhdGUuZ2V0RGF0ZSgpXHJcbiAgICAgICYmIHNyY0RhdGUuZ2V0SG91cnMoKSA9PT0gZHN0RGF0ZS5nZXRIb3VycygpXHJcbiAgICAgICYmIHNyY0RhdGUuZ2V0TWludXRlcygpID09PSBkc3REYXRlLmdldE1pbnV0ZXMoKVxyXG4gICAgICAmJiBzcmNEYXRlLmdldFNlY29uZHMoKSA9PT0gZHN0RGF0ZS5nZXRTZWNvbmRzKCk7XHJcbiAgICByZXR1cm4gaXNFcXVhbDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0UHJvcEluZm9CeVBhdGgocGF0aDogQXJyYXk8c3RyaW5nPik6IERhdGFQcm9wSW5mbyB7XHJcbiAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5mcmFtZUNvbnRleHQgJiYgdGhpcy5mcmFtZUNvbnRleHQucmVwb3NpdG9yeS5lbnRpdHlUeXBlIHx8IG51bGw7XHJcbiAgICBpZiAoZW50aXR5VHlwZSkge1xyXG4gICAgICBjb25zdCBkYXRhVHlwZUluZm8gPSBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eVR5cGUpO1xyXG4gICAgICBjb25zdCBwcm9wSW5mbzogRGF0YVByb3BJbmZvID0gZGF0YVR5cGVJbmZvLmdldFByb3BJbmZvQnlQYXRoKHBhdGgpO1xyXG4gICAgICByZXR1cm4gcHJvcEluZm87XHJcbiAgICAgIC8vIGNvbnN0IGlzTXVsdGlMYW5nSW5wdXQgPSBwcm9wSW5mby5tZXRhZGF0YUluZm8uZW5hYmxlTXVsdGlMYW5nSW5wdXQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5LuOQmluZGluZ0RhdGHkuK3ojrflj5bmjIflrprot6/lvoTnmoTlgLxcclxuICAgKi9cclxuICBwcml2YXRlIGdldFZhbHVlRnJvbUJpbmRpbmdEYXRhKGJpbmRpbmdQYXRoczogc3RyaW5nW10sIGNvbnZlcnRlcj86IENvbnRyb2xWYWx1ZUNvbnZlcnRlcikge1xyXG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGJpbmRpbmdQYXRocyk7XHJcbiAgICBjb25zdCBjb252ZXJ0ZXJlZFZhbHVlID0gY29udmVydGVyID8gY29udmVydGVyLmNvbnZlcnRGcm9tKHZhbHVlKSA6IHZhbHVlO1xyXG4gICAgcmV0dXJuIGNvbnZlcnRlcmVkVmFsdWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0RW50aXR5VmFsdWVDaGFuZ2luZ0xpc3RlbmVycygpOiB7IFtwcm9wZXJ0eTogc3RyaW5nXTogc3RyaW5nIH0ge1xyXG4gICAgY29uc3QgbGlzdGVuZXJzID0ge307XHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLm5nRm9ybUNvbnRyb2xzKS5mb3JFYWNoKChwcm9wTmFtZSkgPT4ge1xyXG4gICAgICBjb25zdCBuZ0Zvcm1Db250cm9sID0gdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wTmFtZV07XHJcbiAgICAgIGlmIChuZ0Zvcm1Db250cm9sLnZhbHVlQ2hhbmdpbmcpIHtcclxuICAgICAgICBsaXN0ZW5lcnNbbmdGb3JtQ29udHJvbC5iaW5kaW5nXSA9IG5nRm9ybUNvbnRyb2wudmFsdWVDaGFuZ2luZztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbGlzdGVuZXJzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEVudGl0eVZhbHVlQ2hhbmdlZExpc3RlbmVycygpOiB7IFtwcm9wZXJ0eTogc3RyaW5nXTogc3RyaW5nIH0ge1xyXG4gICAgY29uc3QgbGlzdGVuZXJzID0ge307XHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLm5nRm9ybUNvbnRyb2xzKS5mb3JFYWNoKChwcm9wTmFtZSkgPT4ge1xyXG4gICAgICBjb25zdCBuZ0Zvcm1Db250cm9sID0gdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wTmFtZV07XHJcbiAgICAgIGlmIChuZ0Zvcm1Db250cm9sLnZhbHVlQ2hhbmdlZCkge1xyXG4gICAgICAgIGxpc3RlbmVyc1tuZ0Zvcm1Db250cm9sLmJpbmRpbmddID0gbmdGb3JtQ29udHJvbC52YWx1ZUNoYW5nZWQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGxpc3RlbmVycztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5omA5pyJ55qE5YmN56uv6aqM6K+B6KeE5YiZXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICog6L+U5Zue55qE5qCh6aqM6KeE5YiZ5Li6TWFwPHN0cmluZyxWYWxpZGF0ZVJ1bGU+LOWFtuS4rWtleeS4uuWFqOi3r+W+hO+8jOS7jmJpbmRpbmdQYXRo5byA5aeL5Yiw5a6e5L2T5bGe5oCn77yM5LulL+WIhumalFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRWYWxpZGF0aW9uUnVsZXMoKTogTWFwPHN0cmluZywgVmFsaWRhdGVSdWxlW10+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRvaW5SdWxlcyA9IG5ldyBNYXA8c3RyaW5nLCBWYWxpZGF0ZVJ1bGVbXT4oKTtcclxuICAgIGxldCBwYXJlbnRQYXRoID0gdGhpcy5iaW5kaW5nUGF0aDtcclxuICAgIGlmIChwYXJlbnRQYXRoLmxlbmd0aCAmJiBwYXJlbnRQYXRoID09PSAnLycpIHtcclxuICAgICAgcGFyZW50UGF0aCA9ICcnO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmtleXModGhpcy5uZ0Zvcm1Db250cm9scykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAvLyBjb25zdCBmaWVsZE5hbWUgPSBgJHtwYXJlbnRQYXRofS8ke3Byb3BOYW1lfWA7XHJcblxyXG4gICAgICBpZiAodGhpcy5pc1Nob3dQcm9wTWFwW3Byb3BOYW1lXSA9PT0gdHJ1ZSB8fCBPYmplY3Qua2V5cyh0aGlzLmlzU2hvd1Byb3BNYXApLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGNvbnN0IG5nRm9ybUNvbnRyb2wgPSB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BOYW1lXTtcclxuICAgICAgICBjb25zdCBkaXNwbGF5RmllbGROYW1lID0gbmdGb3JtQ29udHJvbC5uYW1lIHx8IG5nRm9ybUNvbnRyb2wuZGVmYXVsdEkxOG5WYWx1ZSB8fCAnJztcclxuICAgICAgICBjb25zdCBiaW5kaW5nUGF0aEFycmF5ID0gbmdGb3JtQ29udHJvbC5iaW5kaW5nID8gbmdGb3JtQ29udHJvbC5iaW5kaW5nLnNwbGl0KCcuJykgOiBbcHJvcE5hbWVdO1xyXG4gICAgICAgIGNvbnN0IGZpZWxkTmFtZUFycmF5ID0gW3BhcmVudFBhdGgsIC4uLmJpbmRpbmdQYXRoQXJyYXldO1xyXG4gICAgICAgIGNvbnN0IGZpZWxkTmFtZSA9IGZpZWxkTmFtZUFycmF5LmpvaW4oJy8nKTtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShuZ0Zvcm1Db250cm9sLnZhbGlkUnVsZXMpICYmIG5nRm9ybUNvbnRyb2wudmFsaWRSdWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBsZXQgdmFsaWRhdGlvbnJ1bGVzVG9BZGQgPSBbLi4ubmdGb3JtQ29udHJvbC52YWxpZFJ1bGVzXTtcclxuICAgICAgICAgIC8vIGlmICh0aGlzLmV4Y2x1ZGVSdWxlVHlwZXMgJiYgdGhpcy5leGNsdWRlUnVsZVR5cGVzW3Byb3BOYW1lXSAmJiB0aGlzLmV4Y2x1ZGVSdWxlVHlwZXNbcHJvcE5hbWVdLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIC8vICAgdmFsaWRhdGlvbnJ1bGVzVG9BZGQgPSBuZ0Zvcm1Db250cm9sLnZhbGlkUnVsZXMuZmlsdGVyKChpdGVtKSA9PiAhdGhpcy5leGNsdWRlUnVsZVR5cGVzW3Byb3BOYW1lXS5pbmNsdWRlcyhpdGVtLnR5cGUpKTtcclxuICAgICAgICAgIC8vIH1cclxuICAgICAgICAgIHZhbGlkYXRpb25ydWxlc1RvQWRkLmZvckVhY2goKHZhbGlkYXRpb25SdWxlOiBWYWxpZGF0ZVJ1bGUpID0+IHtcclxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUudGFyZ2V0SWQgPSBuZ0Zvcm1Db250cm9sLmlkO1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uUnVsZS50YXJnZXROYW1lID0gdGhpcy5mb3JtR3JvdXBOYW1lO1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uUnVsZS5wcm9wZXJ0eSA9IGRpc3BsYXlGaWVsZE5hbWU7XHJcbiAgICAgICAgICAgIHZhbGlkYXRpb25SdWxlLmZpZWxkID0gbmdGb3JtQ29udHJvbC5iaW5kaW5nO1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uUnVsZS5mdWxsUGF0aCA9IGZpZWxkTmFtZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUuZnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdmFsaWRhdG9pblJ1bGVzLnNldChmaWVsZE5hbWUsIHZhbGlkYXRpb25ydWxlc1RvQWRkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdmFsaWRhdG9pblJ1bGVzLnNldChmaWVsZE5hbWUsIFt7XHJcbiAgICAgICAgICAgIHR5cGU6ICdzZXREaXNwbGF5SW5mbycsXHJcbiAgICAgICAgICAgIHRhcmdldElkOiBuZ0Zvcm1Db250cm9sLmlkLFxyXG4gICAgICAgICAgICB0YXJnZXROYW1lOiB0aGlzLmZvcm1Hcm91cE5hbWUsXHJcbiAgICAgICAgICAgIHByb3BlcnR5OiBkaXNwbGF5RmllbGROYW1lLFxyXG4gICAgICAgICAgICBmdWxsUGF0aDogZmllbGROYW1lLFxyXG4gICAgICAgICAgICBmcmFtZUNvbnRleHQ6IHRoaXMuZnJhbWVDb250ZXh0XHJcbiAgICAgICAgICB9XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB2YWxpZGF0b2luUnVsZXM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0VHJhbnNsYXRlU2VydmljZSh0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGUpIHtcclxuICAgIGlmICghdHJhbnNsYXRlU2VydmljZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnRyYW5zbGF0ZSA9IHRyYW5zbGF0ZVNlcnZpY2U7XHJcbiAgICBWYWxpZGF0aW9uVHlwZXMuc2V0Q3VycmVudExhbmd1YWdlKHRyYW5zbGF0ZVNlcnZpY2UuZ2V0Q3VycmVudExhbmd1YWdlKCkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDph43nva7mjqfku7bnirbmgIFcclxuICAgKi9cclxuICBwcml2YXRlIHJlc2V0Rm9ybUNvbnRyb2xzKCkge1xyXG4gICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuY29udHJvbHMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgT2JqZWN0LmtleXModGhpcy5jb250cm9scykuZm9yRWFjaCgocHJvcCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZvcm1Db250cm9sOiBBYnN0cmFjdENvbnRyb2wgPSB0aGlzLmNvbnRyb2xzW3Byb3BdO1xyXG4gICAgICAgIGZvcm1Db250cm9sLm1hcmtBc1VudG91Y2hlZCgpO1xyXG4gICAgICAgIGZvcm1Db250cm9sLm1hcmtBc1ByaXN0aW5lKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgcHJpdmF0ZSBjbGVhckJhY2tFbmRNZXNzYWdlcyhkb21Qcm9wZXJ0eU5hbWU6IHN0cmluZykge1xyXG4gICAgaWYgKGRvbVByb3BlcnR5TmFtZSkge1xyXG4gICAgICBpZiAodGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcGVydHlOYW1lXSAmJiB0aGlzLmNhcmRDb250cm9sc1tkb21Qcm9wZXJ0eU5hbWVdWydlcnJvcnMnXSAmJiAhIU9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV1bJ2Vycm9ycyddKS5maW5kKGl0ZW0gPT4gaXRlbS5zdGFydHNXaXRoKCdtZXNzYWdlLScpKSkge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VLZXlzID0gT2JqZWN0LmtleXModGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcGVydHlOYW1lXVsnZXJyb3JzJ10pLmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aCgnbWVzc2FnZS0nKSk7XHJcbiAgICAgICAgY29uc3QgZXJyb3JzID0geyAuLi50aGlzLmNhcmRDb250cm9sc1tkb21Qcm9wZXJ0eU5hbWVdWydlcnJvcnMnXSB9O1xyXG4gICAgICAgIG1lc3NhZ2VLZXlzLmZvckVhY2goa2V5ID0+IGRlbGV0ZSBlcnJvcnNba2V5XSk7XHJcbiAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcGVydHlOYW1lXSA9IHsgZXJyb3JzOiBlcnJvcnMgfTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgT2JqZWN0LmtleXModGhpcy5jYXJkQ29udHJvbHMpLmZvckVhY2gocHJvcGVydHlOYW1lID0+IHtcclxuICAgICAgICBpZiAodGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXSAmJiB0aGlzLmNhcmRDb250cm9sc1twcm9wZXJ0eU5hbWVdWydlcnJvcnMnXSAmJiAhIU9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV1bJ2Vycm9ycyddKS5maW5kKGl0ZW0gPT4gaXRlbS5zdGFydHNXaXRoKCdtZXNzYWdlLScpKSkge1xyXG4gICAgICAgICAgY29uc3QgbWVzc2FnZUtleXMgPSBPYmplY3Qua2V5cyh0aGlzLmNhcmRDb250cm9sc1twcm9wZXJ0eU5hbWVdWydlcnJvcnMnXSkuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zdGFydHNXaXRoKCdtZXNzYWdlLScpKTtcclxuICAgICAgICAgIGNvbnN0IGVycm9ycyA9IHsgLi4udGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXVsnZXJyb3JzJ10gfTtcclxuICAgICAgICAgIG1lc3NhZ2VLZXlzLmZvckVhY2goa2V5ID0+IGRlbGV0ZSBlcnJvcnNba2V5XSk7XHJcbiAgICAgICAgICB0aGlzLmNhcmRDb250cm9sc1twcm9wZXJ0eU5hbWVdID0geyBlcnJvcnM6IGVycm9ycyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBGb3JtIH07XHJcbiJdfQ==