/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { FavoriteAction, FAVORITE_FIELD_NAME } from '../lookup-displaytype';
import { cloneDeep } from 'lodash-es';
import { of } from 'rxjs';
import { tap, catchError } from 'rxjs/operators';
var TreeTableEventManager = /** @class */ (function () {
    function TreeTableEventManager(ins) {
        this.ins = ins;
        /**
         * 标识当前数据是否查询结果
         */
        this.IS_SEARCH_RESULT = false;
        this.lookupSelectionSer = this.ins.lookupSelectionSer;
    }
    /**
     * @param {?} search
     * @return {?}
     */
    TreeTableEventManager.prototype.searchTreeData = /**
     * @param {?} search
     * @return {?}
     */
    function (search) {
        var _this_1 = this;
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        // 判断uri 发出search.emit();
        if (this.ins.searching) {
            return;
        }
        else {
            this.ins.searching = true;
        }
        return this.ins.httpMgr.getData({ search: search, sortName: tt.sortName, sortOrder: tt.sortOrder }, 'search').pipe(tap((/**
         * @return {?}
         */
        function () {
            _this_1.ins.searching = false;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            _this_1.ins.searching = false;
            return of(err);
        }))).subscribe((/**
         * @param {?} resData
         * @return {?}
         */
        function (resData) {
            if (resData) {
                _this_1.ins.items = resData.items;
                _this_1.ins.closeLoading();
                tt.clearAll();
                /** @type {?} */
                var treeInfo = _this_1.ins.gridOptions.treeInfo;
                if (!treeInfo['treeDataIsInit']) {
                    if (treeInfo.layerType.toLowerCase() === 'pathcode') {
                        _this_1.ins.items = _this_1.ins.lookupUtils.makeTree(_this_1.ins.items, treeInfo);
                    }
                    else {
                        _this_1.ins.items = _this_1.ins.lookupUtils.makeTreeWithParentID(_this_1.ins.items, '', treeInfo.dataField + "." + treeInfo.parentField, _this_1.ins.idField);
                    }
                }
                /** @type {?} */
                var checkNodes_1 = (/**
                 * @param {?} nodes
                 * @return {?}
                 */
                function (nodes) {
                    if (nodes && nodes.length) {
                        return nodes.map((/**
                         * @param {?} node
                         * @return {?}
                         */
                        function (node) {
                            if (node.hasOwnProperty('addtional')) {
                                node.selectable = !node['addtional'];
                            }
                            if (node.children && node.children.length) {
                                checkNodes_1(node.children);
                            }
                            return node;
                        }));
                    }
                    return nodes;
                });
                /** @type {?} */
                var expandFirstNode_1 = (/**
                 * @param {?} nodes
                 * @return {?}
                 */
                function (nodes) {
                    if (nodes && nodes.length) {
                        return nodes.map((/**
                         * @param {?} node
                         * @return {?}
                         */
                        function (node) {
                            if (node.children && node.children.length) {
                                node.expanded = true;
                                expandFirstNode_1(node.children);
                            }
                            return node;
                        }));
                    }
                    return nodes;
                });
                /** @type {?} */
                var _nodes = checkNodes_1(_this_1.ins.items);
                if (_nodes && _nodes.length && _nodes[0].children && _nodes[0].children.length) {
                    _nodes[0].expanded = true;
                    _nodes[0].children = expandFirstNode_1(_nodes[0].children);
                }
                _this_1.ins.items = _nodes;
                // 加载收藏数据
                if (_this_1.ins.useFavorite) {
                    // 更新数据的收藏状态
                    _this_1.ins.favHelper.updateFavoritesStatus(_this_1.ins.items);
                }
                tt.loadData(_this_1.ins.items);
                // // 展开查询结果。
                // if (search.value && this.ins.items.length) {
                //     tt.toggleExpand(this.ins.items[0], true);
                // }
                tt.resize();
                _this_1.IS_SEARCH_RESULT = true;
                _this_1.ins.selectionMgr.selectCurrentValue();
            }
            _this_1.ins.search.emit(search);
        }));
    };
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    TreeTableEventManager.prototype.getChildren = /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    function (parentPath, parentLayer, searchData) {
        /** @type {?} */
        var uri = this.ins.gridOptions.uri;
        /** @type {?} */
        var search = tslib_1.__assign({ parentLayer: parentLayer, category: 'children' }, searchData);
        if (this.ins.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        var param = {
            searchValue: JSON.stringify(search),
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        if (this.IS_SEARCH_RESULT) {
            param.enableFullTree = false;
            param.loadTreeDataType = 'layerload';
            search.searchValue = '';
            search.searchField = '*';
            param.searchValue = JSON.stringify(search);
        }
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        return this.ins.http.getData(uri, param);
    };
    /**
     * @return {?}
     */
    TreeTableEventManager.prototype.bindTreetableEvent = /**
     * @return {?}
     */
    function () {
        var _this_1 = this;
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.componentRef.instance));
        /** @type {?} */
        var _searchTreeData = (/**
         * @param {?} searchparam
         * @return {?}
         */
        function (searchparam) {
            if (_this_1.ins.remoteSearch) {
                _this_1.ins._searchState = searchparam;
                _this_1.searchTreeData(searchparam);
            }
            else {
                // TODO: 全部加载，前端搜索 需要完善
                // if (this.ins.loadTreeDataType === 'loadall' && tt.searchHandle) {
                //     tt.searchHandle.search(searchparam.field, searchparam.value, 'client');
                // }
                _this_1.ins.search.emit(searchparam);
            }
        });
        /** @type {?} */
        var isLoadAllTreeData = (/**
         * @return {?}
         */
        function () {
            if (_this_1.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'all';
            }
            else {
                return _this_1.ins.loadTreeDataType === 'loadall';
            }
        });
        /** @type {?} */
        var isAsyncLoadTreeData = (/**
         * @return {?}
         */
        function () {
            if (_this_1.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'async';
            }
            else {
                return _this_1.ins.loadTreeDataType === 'layerload';
            }
        });
        tt.dblClickExpand = !this.ins.singleSelect; // 禁用双击展开节点
        tt.allColumnsTitle = this.ins.allColumnsTitle; // this.displayInfo.allColumns;
        tt.idField = this.ins.idField;
        tt.columns = this.ins.columns;
        tt.searchFields = this.ins.gridOptions.searchFields;
        if (this.ins.treeInfo) {
            tt.loadDataType = this.ins.treeInfo.loadDataType;
            tt.virtualized = true;
            this.ins.allData = cloneDeep(this.ins.items);
        }
        if (this.ins.gridOptions.treeInfo) {
            tt.onlySelectLeaf = this.ins.gridOptions.treeInfo.onlySelectLeaf;
            tt.loadDataType = this.ins.gridOptions.treeInfo.loadDataType;
        }
        if (!tt.singleSelect) {
            tt.checkOnSelect = true;
            tt.selectOnCheck = true;
            tt.showCheckbox = true;
            tt.showCheckAll = this.ins.showCheckAll;
            // 启用多选后，同时启用级联选择
            if (this.ins.enableCascade) {
                this.cascadeValueChanged(this.ins.cascadeStatus);
            }
            else {
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
            }
        }
        tt.enableFindText = this.ins.enableFindText;
        // tt.findField = this.textField;
        tt.nodeSelected.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            // if (this.ins.favoritesComponentRef && this.ins.singleSelect) {
            //     const ftt = this.ins.favoritesComponentRef.instance as TreeTableComponent;
            //     ftt.clearSelections();
            // }
            if (_this_1.ins.singleSelect) {
                _this_1.lookupSelectionSer.clearSelections();
            }
            _this_1.lookupSelectionSer.updateSelections([e.node.data]);
            _this_1.ins.checkedChange.emit({ data: [e.node.data], isCheck: true });
        }));
        tt.nodeChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (!_this_1.ins.singleSelect) {
                /** @type {?} */
                var data = null;
                if (e.nodes && e.nodes.length) {
                    data = e.nodes.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data; }));
                    // this.ins.multiSelMgr.updateSelections(e.nodes.map(n => n.data));
                }
                else {
                    if (Array.isArray(e.node)) {
                        data = e.node.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.data; }));
                        // this.ins.multiSelMgr.updateSelections(e.node.map(n => n.data));
                    }
                    else {
                        data = [e.node.data];
                        // this.ins.multiSelMgr.updateSelections([e.node.data]);
                    }
                }
                _this_1.ins.multiSelMgr.updateSelections(data);
                _this_1.ins.checkedChange.emit({ data: data, isCheck: true });
            }
        }));
        tt.nodeUnChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (e && e.node) {
                if (!_this_1.ins.singleSelect) {
                    _this_1.ins.multiSelMgr.remove(e.node.id);
                    // 分层加载，多选，包含下级时，取消勾选 需要将当前节点的所有子级数据也要取消选择，即从已选记录中移除
                    if (tt.loadDataType !== 'all' && _this_1.ins.treeInfo.layerType === 'pathcode' &&
                        (_this_1.ins.cascadeStatus === 'enable' || _this_1.ins.cascadeStatus === 'down')) {
                        if (e.node.children && e.node.children.length) {
                            /** @type {?} */
                            var nodes = e.node.children.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.data; }));
                            _this_1.ins.lookupSelectionSer.updateSelections(nodes, false);
                        }
                        else {
                            /** @type {?} */
                            var pathcode = e.node.data[_this_1.ins.treeInfo.dataField][_this_1.ins.treeInfo.pathField];
                            _this_1.ins.lookupSelectionSer.unselectByPathcode(pathcode);
                        }
                    }
                    if (e.nodes && e.nodes.length) {
                        _this_1.ins.multiSelMgr.remove(e.nodes.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.id; })));
                        _this_1.ins.checkedChange.emit({ data: e.nodes.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n.data; })), isCheck: false });
                    }
                    else {
                        _this_1.ins.checkedChange.emit({ data: [e.node.data], isCheck: false });
                    }
                }
                else {
                    /** @type {?} */
                    var ftt = _this_1.ins.favoritesComponentRef && ((/** @type {?} */ (_this_1.ins.favoritesComponentRef.instance)));
                    if (ftt && ftt.findRowNode(e.node.id)) {
                        ftt.unSelectNode(e.node.id);
                    }
                    _this_1.ins.checkedChange.emit({ data: [e.node.data], isCheck: false });
                }
            }
        }));
        tt.search.subscribe((/**
         * @param {?} searchparam
         * @return {?}
         */
        function (searchparam) {
            if (searchparam.field !== '*' && !searchparam.value) {
                _this_1.ins.messagerService.warning(_this_1.ins.mustWriteSomething);
            }
            else {
                _searchTreeData(searchparam);
            }
        }));
        tt.cellClick.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (e.col.field === FAVORITE_FIELD_NAME) {
                e.event.stopPropagation();
                // tslint:disable-next-line: no-string-literal
                /** @type {?} */
                var classList = e.event.target['classList'];
                if (classList.contains('f-lookup-favorite')) {
                    // classList.toggle('f-icon-star');
                    // classList.toggle('f-icon-star-outline');
                    /** @type {?} */
                    var _this_2 = _this_1.ins;
                    ((/**
                     * @param {?} arr
                     * @return {?}
                     */
                    function each(arr) {
                        if (arr) {
                            arr.forEach((/**
                             * @param {?} item
                             * @return {?}
                             */
                            function (item) {
                                /** @type {?} */
                                var id = _this_2.utils.getValue(_this_2.idField, item.data);
                                if (id === e.node.id) {
                                    item.data[FAVORITE_FIELD_NAME] = !item.data[FAVORITE_FIELD_NAME];
                                    return true;
                                }
                                else if (item.children && item.children.length > 0) {
                                    return each(item.children);
                                }
                                else {
                                    return false;
                                }
                            }));
                        }
                    }))(_this_1.ins.items);
                    tt.loadData(_this_1.ins.items);
                    // 更新收藏数据
                    _this_1.lookupSelectionSer.updateFavoriteData(e.node.data, e.node.data[FAVORITE_FIELD_NAME] ? FavoriteAction.add : FavoriteAction.delete);
                }
            }
        }));
        tt.dblClick.subscribe((/**
         * @param {?} treeNode
         * @return {?}
         */
        function (treeNode) {
            if (_this_1.ins.gridOptions.singleSelect && treeNode.selectable) {
                if (_this_1.ins.okButton) {
                    // this.lookupSelectionSer.select(treeNode.data);
                    // this.ins.okButton.nativeElement.click();
                    _this_1.ins.selectItem(treeNode.data);
                }
            }
        }));
        /** @type {?} */
        var loadAllData = isLoadAllTreeData();
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        function (sort) {
            if (isLoadAllTreeData()) {
                tt.clientSort();
            }
            else {
                var _a = tslib_1.__assign({}, sort), sortName_1 = _a.sortName, sortOrder = _a.sortOrder;
                /** @type {?} */
                var col = _this_1.ins.columns.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === sortName_1; }));
                /** @type {?} */
                var _sortName = col ? col.fieldPath ? col.fieldPath : col.field : sortName_1;
                /** @type {?} */
                var param = Object.assign({ sortName: _sortName, sortOrder: sortOrder }, { search: _this_1.ins._searchState });
                _this_1.ins.httpMgr.getData(param, 'search').subscribe((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) {
                    _this_1.ins.items = d.items;
                    _this_1.ins.closeLoading();
                    tt.clearAll();
                    /** @type {?} */
                    var items = _this_1.ins.checkNodeCanBeSelect(d.items, false);
                    tt.loadData(items);
                    tt.resize();
                }));
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        function () {
            _this_1.ins._searchState = null;
            _this_1.IS_SEARCH_RESULT = false;
            /** @type {?} */
            var _items = _this_1.ins.checkNodeCanBeSelect(_this_1.ins.allData, loadAllData);
            if (!_items || !_items.length) {
                _searchTreeData({ field: '*', value: '' });
            }
            else {
                _this_1.ins.items = _items;
                _this_1.ins.favHelper.updateFavoritesStatus(_this_1.ins.items);
                tt.loadData(_items);
            }
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        function (tn) {
            if (tn.leaf) {
                return;
            }
            if (!tn.children || !tn.children.length) {
                /** @type {?} */
                var treeInfo = _this_1.ins.gridOptions.treeInfo;
                if (isAsyncLoadTreeData() || _this_1.IS_SEARCH_RESULT) {
                    /** @type {?} */
                    var parentPath = '';
                    /** @type {?} */
                    var parentLayer = -1;
                    var _a = tslib_1.__assign({}, tt.searchData), _b = _a.field, field = _b === void 0 ? '*' : _b, _c = _a.value, value = _c === void 0 ? '' : _c;
                    tn['showLoading'] = true;
                    tt.detectChanges();
                    if (treeInfo.layerType === 'parentId') {
                        // 父ID加载方式
                        parentPath = tn['id'];
                    }
                    else {
                        /** @type {?} */
                        var treeInfoField = treeInfo.dataField;
                        if (treeInfoField) {
                            parentPath = tn.data[treeInfoField][treeInfo.pathField];
                            parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                        }
                        else {
                            console.log('未找到分级信息。');
                        }
                    }
                    if (!_this_1.ins.uri) {
                        _this_1.ins.expandTreeNode.emit({
                            instance: tt, node: tn,
                            parentIdOrPath: parentPath, parentLayer: parentLayer, search: { value: value, field: field }
                        });
                        return;
                    }
                    _this_1.getChildren(parentPath, parentLayer, {
                        searchField: field === '*' ? '*' : field,
                        searchValue: value
                    }).subscribe((/**
                     * @param {?} data
                     * @return {?}
                     */
                    function (data) {
                        if (tt) {
                            if (tn && data.items && data.items.length) {
                                if (_this_1.ins.useFavorite) {
                                    // 更新子节点收藏状态
                                    _this_1.ins.favHelper.updateFavoritesStatus(data.items);
                                }
                                /** @type {?} */
                                var nodes = _this_1.ins.checkNodeCanBeSelect(data.items, false);
                                tt.appendChildren(nodes, tn);
                                if (tt.loadDataType !== 'all' && !_this_1.ins.singleSelect && _this_1.ins.isGetAllChidlNodes &&
                                    (_this_1.ins.cascadeStatus === 'enable' || _this_1.ins.cascadeStatus === 'down')) {
                                    /** @type {?} */
                                    var rn = tt.findRowNode(tn.id);
                                    tt.propagateSelectionDown(rn, rn.isChecked);
                                    // 更新选中记录缓存
                                    /** @type {?} */
                                    var _items = data.items.filter((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    function (n) { return !n.addtional; }));
                                    if (_items && _items.length) {
                                        _this_1.ins.lookupSelectionSer.updateSelections(_items.map((/**
                                         * @param {?} n
                                         * @return {?}
                                         */
                                        function (n) { return n.data; })), rn.isChecked);
                                    }
                                }
                            }
                            tn['showLoading'] = false;
                            tt.detectChanges();
                            _this_1.ins.selectionMgr.selectCurrentValue();
                        }
                    }));
                }
            }
            else {
                if (!_this_1.ins.singleSelect && _this_1.ins.enableCascade &&
                    (_this_1.ins.cascadeStatus === 'enable' || _this_1.ins.cascadeStatus === 'down') && _this_1.ins.isGetAllChidlNodes) {
                    /** @type {?} */
                    var rn = tt.findRowNode(tn.id);
                    tt.propagateSelectionDown(rn, rn.isChecked);
                    /** @type {?} */
                    var selectItems = tn.children.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.selectable; })).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return n.data; }));
                    _this_1.ins.lookupSelectionSer.updateSelections(selectItems, rn.isChecked);
                }
                _this_1.ins.selectionMgr.selectCurrentValue();
            }
        }));
        if (loadAllData && this.ins.items) {
            this.ins.treeNodeHelper.updateTreeNodeExpanded(this.ins.items);
        }
        return loadAllData;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    TreeTableEventManager.prototype.cascadeValueChanged = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var val = $event;
        // const tt = this.ins.componentRef.instance as TreeTableComponent;
        /** @type {?} */
        var instanceTyp = this.ins.activeTab === 'datalist' ? 'treetable' : 'fav';
        /** @type {?} */
        var tt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance(instanceTyp)));
        if (!tt) {
            return;
        }
        switch (val) {
            case 'enable':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
            case 'disable':
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
                break;
            case 'up':
                tt.cascadeCheck = true;
                tt.cascadeUp = true;
                tt.cascadeDown = false;
                break;
            case 'down':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = false;
                break;
            default:
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
        }
        this.ins.cascadeStatus = val || 'enable';
    };
    return TreeTableEventManager;
}());
export { TreeTableEventManager };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.lookupSelectionSer;
    /**
     * 标识当前数据是否查询结果
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.IS_SEARCH_RESULT;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZC10cmVldGFibGUtZXZlbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9iaW5kLXRyZWV0YWJsZS1ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSxjQUFjLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU1RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDLE9BQU8sRUFBYyxFQUFFLEVBQVcsTUFBTSxNQUFNLENBQUM7QUFFL0MsT0FBTyxFQUFRLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUl2RDtJQVNJLCtCQUFvQixHQUF3QjtRQUF4QixRQUFHLEdBQUgsR0FBRyxDQUFxQjs7OztRQUhwQyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFJN0IsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUM7SUFDMUQsQ0FBQzs7Ozs7SUFFRCw4Q0FBYzs7OztJQUFkLFVBQWUsTUFBd0M7UUFBdkQsbUJBOEZDOztZQTdGUyxFQUFFLEdBQUcsbUJBQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFzQjtRQUMvRCx5QkFBeUI7UUFDekIsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRTtZQUNwQixPQUFPO1NBQ1Y7YUFBTTtZQUNILElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztTQUM3QjtRQUNELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsTUFBTSxRQUFBLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQyxTQUFTLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQyxJQUFJLENB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RyxJQUFJLENBQUM7Z0JBQ3RCLEVBQUUsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixNQUFNO1lBQ1Y7Z0JBQ0ksRUFBRSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO2dCQUN0QixFQUFFLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDcEIsTUFBTTtTQUNiO1FBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEdBQUcsR0FBRyxJQUFJLFFBQVEsQ0FBQztJQUM3QyxDQUFDO0lBRUwsNEJBQUM7QUFBRCxDQUFDLEFBbmZELElBbWZDOzs7Ozs7O0lBbGZHLG1EQUFtRDs7Ozs7O0lBS25ELGlEQUFpQzs7Ozs7SUFHckIsb0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHJlZVRhYmxlQ29tcG9uZW50LCBUcmVlTm9kZSB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgRmF2b3JpdGVBY3Rpb24sIEZBVk9SSVRFX0ZJRUxEX05BTUUgfSBmcm9tICcuLi9sb29rdXAtZGlzcGxheXR5cGUnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkUmVzdWx0IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyB0YWtlLCB0YXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IExvb2t1cFNlbGVjdGlvblNlcnZpY2UgfSBmcm9tICcuL2xvb2t1cC1zZWxlY3Rpb24uc2VydmljZSc7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFRyZWVUYWJsZUV2ZW50TWFuYWdlciB7XHJcbiAgICBwcml2YXRlIGxvb2t1cFNlbGVjdGlvblNlcjogTG9va3VwU2VsZWN0aW9uU2VydmljZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOagh+ivhuW9k+WJjeaVsOaNruaYr+WQpuafpeivoue7k+aenFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIElTX1NFQVJDSF9SRVNVTFQgPSBmYWxzZTtcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnM6IExvb2t1cEdyaWRDb21wb25lbnQpIHtcclxuICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlciA9IHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlcjtcclxuICAgIH1cclxuXHJcbiAgICBzZWFyY2hUcmVlRGF0YShzZWFyY2g6IHsgZmllbGQ6IHN0cmluZzsgdmFsdWU6IHN0cmluZyB9KSB7XHJcbiAgICAgICAgY29uc3QgdHQgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgIC8vIOWIpOaWrXVyaSDlj5Hlh7pzZWFyY2guZW1pdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy5zZWFyY2hpbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnNlYXJjaGluZyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmlucy5odHRwTWdyLmdldERhdGEoeyBzZWFyY2gsIHNvcnROYW1lOiB0dC5zb3J0TmFtZSwgc29ydE9yZGVyOiB0dC5zb3J0T3JkZXIgfSwgJ3NlYXJjaCcpLnBpcGUoXHJcbiAgICAgICAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWFyY2hpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VhcmNoaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YoZXJyKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZShyZXNEYXRhID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc0RhdGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gcmVzRGF0YS5pdGVtcztcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgdHQuY2xlYXJBbGwoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB0cmVlSW5mbyA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnRyZWVJbmZvO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0cmVlSW5mb1sndHJlZURhdGFJc0luaXQnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmVlSW5mby5sYXllclR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3BhdGhjb2RlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IHRoaXMuaW5zLmxvb2t1cFV0aWxzLm1ha2VUcmVlKHRoaXMuaW5zLml0ZW1zLCB0cmVlSW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSB0aGlzLmlucy5sb29rdXBVdGlscy5tYWtlVHJlZVdpdGhQYXJlbnRJRChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgJHt0cmVlSW5mby5kYXRhRmllbGR9LiR7dHJlZUluZm8ucGFyZW50RmllbGR9YCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmlkRmllbGRcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrTm9kZXMgPSAobm9kZXMpOiBUcmVlTm9kZVtdID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZXMgJiYgbm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBub2Rlcy5tYXAoKG5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNPd25Qcm9wZXJ0eSgnYWRkdGlvbmFsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnNlbGVjdGFibGUgPSAhbm9kZVsnYWRkdGlvbmFsJ107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja05vZGVzKG5vZGUuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXM7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGV4cGFuZEZpcnN0Tm9kZSA9IChub2Rlcyk6IFRyZWVOb2RlW10gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlcyAmJiBub2Rlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVzLm1hcCgobm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5leHBhbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5kRmlyc3ROb2RlKG5vZGUuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXM7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9ub2RlcyA9IGNoZWNrTm9kZXModGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKF9ub2RlcyAmJiBfbm9kZXMubGVuZ3RoICYmIF9ub2Rlc1swXS5jaGlsZHJlbiAmJiBfbm9kZXNbMF0uY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX25vZGVzWzBdLmV4cGFuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBfbm9kZXNbMF0uY2hpbGRyZW4gPSBleHBhbmRGaXJzdE5vZGUoX25vZGVzWzBdLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gX25vZGVzO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvLyDliqDovb3mlLbol4/mlbDmja5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsOaVsOaNrueahOaUtuiXj+eKtuaAgVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmZhdkhlbHBlci51cGRhdGVGYXZvcml0ZXNTdGF0dXModGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHR0LmxvYWREYXRhKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIC8vIC8vIOWxleW8gOafpeivoue7k+aenOOAglxyXG4gICAgICAgICAgICAgICAgLy8gaWYgKHNlYXJjaC52YWx1ZSAmJiB0aGlzLmlucy5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICB0dC50b2dnbGVFeHBhbmQodGhpcy5pbnMuaXRlbXNbMF0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgdHQucmVzaXplKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5JU19TRUFSQ0hfUkVTVUxUID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWxlY3Rpb25NZ3Iuc2VsZWN0Q3VycmVudFZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5zLnNlYXJjaC5lbWl0KHNlYXJjaCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGlsZHJlbihcclxuICAgICAgICBwYXJlbnRQYXRoLFxyXG4gICAgICAgIHBhcmVudExheWVyLFxyXG4gICAgICAgIHNlYXJjaERhdGE6IHsgc2VhcmNoRmllbGQ6IHN0cmluZzsgc2VhcmNoVmFsdWU6IHN0cmluZyB9XHJcbiAgICApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHVyaSA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnVyaTtcclxuICAgICAgICBjb25zdCBzZWFyY2ggPSB7IHBhcmVudExheWVyLCBjYXRlZ29yeTogJ2NoaWxkcmVuJywgLi4uc2VhcmNoRGF0YSB9O1xyXG4gICAgICAgIGlmICh0aGlzLmlucy50cmVlSW5mby5sYXllclR5cGUgPT09ICdwYXJlbnRJZCcpIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRJZCddID0gcGFyZW50UGF0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWFyY2hbJ3BhcmVudFBhdGgnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJhbSA9IHtcclxuICAgICAgICAgICAgc2VhcmNoVmFsdWU6IEpTT04uc3RyaW5naWZ5KHNlYXJjaCksXHJcbiAgICAgICAgICAgIGN1c3RvbURhdGE6IHRoaXMuaW5zLmN1c3RvbURhdGEsXHJcbiAgICAgICAgICAgIGVuYWJsZUZ1bGxUcmVlOiB0aGlzLmlucy5lbmFibGVGdWxsVHJlZSxcclxuICAgICAgICAgICAgbG9hZFRyZWVEYXRhVHlwZTogdGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0aGlzLklTX1NFQVJDSF9SRVNVTFQpIHtcclxuICAgICAgICAgICAgcGFyYW0uZW5hYmxlRnVsbFRyZWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgcGFyYW0ubG9hZFRyZWVEYXRhVHlwZSA9ICdsYXllcmxvYWQnO1xyXG4gICAgICAgICAgICBzZWFyY2guc2VhcmNoVmFsdWUgPSAnJztcclxuICAgICAgICAgICAgc2VhcmNoLnNlYXJjaEZpZWxkID0gJyonO1xyXG4gICAgICAgICAgICBwYXJhbS5zZWFyY2hWYWx1ZSA9IEpTT04uc3RyaW5naWZ5KHNlYXJjaCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuaGVscElkKSB7XHJcbiAgICAgICAgICAgIHBhcmFtWydoZWxwSWQnXSA9IHRoaXMuaW5zLmhlbHBJZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICBpZiAodHQgJiYgdHQuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihwYXJhbSwge1xyXG4gICAgICAgICAgICAgICAgc29ydE5hbWU6IHR0LnNvcnROYW1lLFxyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVyOiB0dC5zb3J0T3JkZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5pbnMuaHR0cC5nZXREYXRhKHVyaSwgcGFyYW0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBiaW5kVHJlZXRhYmxlRXZlbnQoKSB7XHJcbiAgICAgICAgY29uc3QgdHQgPSB0aGlzLmlucy5jb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgIGNvbnN0IF9zZWFyY2hUcmVlRGF0YSA9IChzZWFyY2hwYXJhbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5yZW1vdGVTZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLl9zZWFyY2hTdGF0ZSA9IHNlYXJjaHBhcmFtO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hUcmVlRGF0YShzZWFyY2hwYXJhbSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiDlhajpg6jliqDovb3vvIzliY3nq6/mkJzntKIg6ZyA6KaB5a6M5ZaEXHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2xvYWRhbGwnICYmIHR0LnNlYXJjaEhhbmRsZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHR0LnNlYXJjaEhhbmRsZS5zZWFyY2goc2VhcmNocGFyYW0uZmllbGQsIHNlYXJjaHBhcmFtLnZhbHVlLCAnY2xpZW50Jyk7XHJcbiAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWFyY2guZW1pdChzZWFyY2hwYXJhbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBpc0xvYWRBbGxUcmVlRGF0YSA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHR0LmxvYWREYXRhVHlwZSA9PT0gJ2FsbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2xvYWRhbGwnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgaXNBc3luY0xvYWRUcmVlRGF0YSA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHR0LmxvYWREYXRhVHlwZSA9PT0gJ2FzeW5jJztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlID09PSAnbGF5ZXJsb2FkJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB0dC5kYmxDbGlja0V4cGFuZCA9ICF0aGlzLmlucy5zaW5nbGVTZWxlY3Q7IC8vIOemgeeUqOWPjOWHu+WxleW8gOiKgueCuVxyXG5cclxuICAgICAgICB0dC5hbGxDb2x1bW5zVGl0bGUgPSB0aGlzLmlucy5hbGxDb2x1bW5zVGl0bGU7IC8vIHRoaXMuZGlzcGxheUluZm8uYWxsQ29sdW1ucztcclxuICAgICAgICB0dC5pZEZpZWxkID0gdGhpcy5pbnMuaWRGaWVsZDtcclxuICAgICAgICB0dC5jb2x1bW5zID0gdGhpcy5pbnMuY29sdW1ucztcclxuICAgICAgICB0dC5zZWFyY2hGaWVsZHMgPSB0aGlzLmlucy5ncmlkT3B0aW9ucy5zZWFyY2hGaWVsZHM7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLnRyZWVJbmZvKSB7XHJcbiAgICAgICAgICAgIHR0LmxvYWREYXRhVHlwZSA9IHRoaXMuaW5zLnRyZWVJbmZvLmxvYWREYXRhVHlwZTtcclxuICAgICAgICAgICAgdHQudmlydHVhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5hbGxEYXRhID0gY2xvbmVEZWVwKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mbykge1xyXG4gICAgICAgICAgICB0dC5vbmx5U2VsZWN0TGVhZiA9IHRoaXMuaW5zLmdyaWRPcHRpb25zLnRyZWVJbmZvLm9ubHlTZWxlY3RMZWFmO1xyXG4gICAgICAgICAgICB0dC5sb2FkRGF0YVR5cGUgPSB0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mby5sb2FkRGF0YVR5cGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXR0LnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICB0dC5jaGVja09uU2VsZWN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdHQuc2VsZWN0T25DaGVjayA9IHRydWU7XHJcbiAgICAgICAgICAgIHR0LnNob3dDaGVja2JveCA9IHRydWU7XHJcbiAgICAgICAgICAgIHR0LnNob3dDaGVja0FsbCA9ICB0aGlzLmlucy5zaG93Q2hlY2tBbGw7XHJcbiAgICAgICAgICAgIC8vIOWQr+eUqOWkmumAieWQju+8jOWQjOaXtuWQr+eUqOe6p+iBlOmAieaLqVxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYXNjYWRlVmFsdWVDaGFuZ2VkKHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHR0LmVuYWJsZUZpbmRUZXh0ID0gdGhpcy5pbnMuZW5hYmxlRmluZFRleHQ7XHJcbiAgICAgICAgLy8gdHQuZmluZEZpZWxkID0gdGhpcy50ZXh0RmllbGQ7XHJcbiAgICAgICAgdHQubm9kZVNlbGVjdGVkLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYgJiYgdGhpcy5pbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIC8vICAgICBjb25zdCBmdHQgPSB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAvLyAgICAgZnR0LmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoW2Uubm9kZS5kYXRhXSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLmNoZWNrZWRDaGFuZ2UuZW1pdCh7IGRhdGE6IFtlLm5vZGUuZGF0YV0gLCBpc0NoZWNrOiB0cnVlICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQubm9kZUNoZWNrZWQuc3Vic2NyaWJlKCBlID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlucy5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIGxldCBkYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChlLm5vZGVzICYmIGUubm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGUubm9kZXMubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlucy5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGUubm9kZXMubWFwKG4gPT4gbi5kYXRhKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUubm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGUubm9kZS5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlucy5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGUubm9kZS5tYXAobiA9PiBuLmRhdGEpKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW2Uubm9kZS5kYXRhXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhbZS5ub2RlLmRhdGFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YSwgaXNDaGVjazogdHJ1ZSAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQubm9kZVVuQ2hlY2tlZC5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZSAmJiBlLm5vZGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubXVsdGlTZWxNZ3IucmVtb3ZlKGUubm9kZS5pZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWIhuWxguWKoOi9ve+8jOWkmumAie+8jOWMheWQq+S4i+e6p+aXtu+8jOWPlua2iOWLvumAiSDpnIDopoHlsIblvZPliY3oioLngrnnmoTmiYDmnInlrZDnuqfmlbDmja7kuZ/opoHlj5bmtojpgInmi6nvvIzljbPku47lt7LpgInorrDlvZXkuK3np7vpmaRcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHQubG9hZERhdGFUeXBlICE9PSAnYWxsJyAmJiB0aGlzLmlucy50cmVlSW5mby5sYXllclR5cGUgPT09ICdwYXRoY29kZScgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdlbmFibGUnIHx8IHRoaXMuaW5zLmNhc2NhZGVTdGF0dXMgPT09ICdkb3duJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZS5jaGlsZHJlbiAmJiBlLm5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlcyA9IGUubm9kZS5jaGlsZHJlbi5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMobm9kZXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhjb2RlID0gZS5ub2RlLmRhdGFbdGhpcy5pbnMudHJlZUluZm8uZGF0YUZpZWxkXVt0aGlzLmlucy50cmVlSW5mby5wYXRoRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVuc2VsZWN0QnlQYXRoY29kZShwYXRoY29kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVzICYmIGUubm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm11bHRpU2VsTWdyLnJlbW92ZShlLm5vZGVzLm1hcChuID0+IG4uaWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogZS5ub2Rlcy5tYXAobiA9PiBuLmRhdGEpLCBpc0NoZWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbZS5ub2RlLmRhdGFdLCBpc0NoZWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ0dCA9IHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZiAmJiAodGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZ0dCAmJiBmdHQuZmluZFJvd05vZGUoZS5ub2RlLmlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdHQudW5TZWxlY3ROb2RlKGUubm9kZS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbZS5ub2RlLmRhdGFdLCBpc0NoZWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5zZWFyY2guc3Vic2NyaWJlKHNlYXJjaHBhcmFtID0+IHtcclxuICAgICAgICAgICAgaWYgKHNlYXJjaHBhcmFtLmZpZWxkICE9PSAnKicgJiYgIXNlYXJjaHBhcmFtLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5tZXNzYWdlclNlcnZpY2Uud2FybmluZyh0aGlzLmlucy5tdXN0V3JpdGVTb21ldGhpbmcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3NlYXJjaFRyZWVEYXRhKHNlYXJjaHBhcmFtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5jZWxsQ2xpY2suc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUuY29sLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICBlLmV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxyXG4gICAgICAgICAgICAgICAgY29uc3QgY2xhc3NMaXN0ID0gZS5ldmVudC50YXJnZXRbJ2NsYXNzTGlzdCddO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNsYXNzTGlzdC5jb250YWlucygnZi1sb29rdXAtZmF2b3JpdGUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsYXNzTGlzdC50b2dnbGUoJ2YtaWNvbi1zdGFyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xhc3NMaXN0LnRvZ2dsZSgnZi1pY29uLXN0YXItb3V0bGluZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF90aGlzID0gdGhpcy5pbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiBlYWNoKGFycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnIuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpZCA9IF90aGlzLnV0aWxzLmdldFZhbHVlKF90aGlzLmlkRmllbGQsIGl0ZW0uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09PSBlLm5vZGUuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhW0ZBVk9SSVRFX0ZJRUxEX05BTUVdID0gIWl0ZW0uZGF0YVtGQVZPUklURV9GSUVMRF9OQU1FXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmNoaWxkcmVuICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWFjaChpdGVtLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KSh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQubG9hZERhdGEodGhpcy5pbnMuaXRlbXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDmlLbol4/mlbDmja5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVGYXZvcml0ZURhdGEoIGUubm9kZS5kYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLm5vZGUuZGF0YVtGQVZPUklURV9GSUVMRF9OQU1FXSA/IEZhdm9yaXRlQWN0aW9uLmFkZCA6IEZhdm9yaXRlQWN0aW9uLmRlbGV0ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuZGJsQ2xpY2suc3Vic2NyaWJlKCh0cmVlTm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmdyaWRPcHRpb25zLnNpbmdsZVNlbGVjdCAmJiB0cmVlTm9kZS5zZWxlY3RhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMub2tCdXR0b24pIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci5zZWxlY3QodHJlZU5vZGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMub2tCdXR0b24ubmF0aXZlRWxlbWVudC5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlbGVjdEl0ZW0odHJlZU5vZGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBsb2FkQWxsRGF0YSA9IGlzTG9hZEFsbFRyZWVEYXRhKCk7XHJcbiAgICAgICAgdHQuY29sdW1uU29ydGVkLnN1YnNjcmliZSgoc29ydDogeyBzb3J0TmFtZTogc3RyaW5nOyBzb3J0T3JkZXI6IGFueTsgfSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNMb2FkQWxsVHJlZURhdGEoKSkge1xyXG4gICAgICAgICAgICAgICAgdHQuY2xpZW50U29ydCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBzb3J0TmFtZSwgc29ydE9yZGVyIH0gPSB7IC4uLnNvcnQgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmlucy5jb2x1bW5zLmZpbmQobiA9PiBuLmZpZWxkID09PSBzb3J0TmFtZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfc29ydE5hbWUgPSBjb2wgPyBjb2wuZmllbGRQYXRoID8gY29sLmZpZWxkUGF0aCA6IGNvbC5maWVsZCA6IHNvcnROYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gT2JqZWN0LmFzc2lnbih7IHNvcnROYW1lOiBfc29ydE5hbWUsIHNvcnRPcmRlciB9LCB7IHNlYXJjaDogdGhpcy5pbnMuX3NlYXJjaFN0YXRlIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuaHR0cE1nci5nZXREYXRhKHBhcmFtLCAnc2VhcmNoJykuc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gZC5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5jbGVhckFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5pbnMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QoZC5pdGVtcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHR0LmxvYWREYXRhKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5yZXNpemUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmNsZWFyU2VhcmNoVmFsdWUuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pbnMuX3NlYXJjaFN0YXRlID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5JU19TRUFSQ0hfUkVTVUxUID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGNvbnN0IF9pdGVtcyA9IHRoaXMuaW5zLmNoZWNrTm9kZUNhbkJlU2VsZWN0KHRoaXMuaW5zLmFsbERhdGEsIGxvYWRBbGxEYXRhKTtcclxuICAgICAgICAgICAgaWYgKCFfaXRlbXMgfHwgIV9pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIF9zZWFyY2hUcmVlRGF0YSh7IGZpZWxkOiAnKicsIHZhbHVlOiAnJyB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gX2l0ZW1zO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YShfaXRlbXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmV4cGFuZC5zdWJzY3JpYmUoKHRuOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodG4ubGVhZikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghdG4uY2hpbGRyZW4gfHwgIXRuLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJlZUluZm8gPSB0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mbztcclxuICAgICAgICAgICAgICAgIGlmIChpc0FzeW5jTG9hZFRyZWVEYXRhKCkgfHwgdGhpcy5JU19TRUFSQ0hfUkVTVUxUICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnRQYXRoID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmVudExheWVyID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBmaWVsZCA9ICcqJywgdmFsdWUgPSAnJyB9ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi50dC5zZWFyY2hEYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdG5bJ3Nob3dMb2FkaW5nJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOeItklE5Yqg6L295pa55byPXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGggPSB0blsnaWQnXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmVlSW5mb0ZpZWxkID0gdHJlZUluZm8uZGF0YUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJlZUluZm9GaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ucGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudExheWVyID0gdG4uZGF0YVt0cmVlSW5mb0ZpZWxkXVt0cmVlSW5mby5sYXllckZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmnKrmib7liLDliIbnuqfkv6Hmga/jgIInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlucy51cmkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZXhwYW5kVHJlZU5vZGUuZW1pdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZTogdHQsIG5vZGU6IHRuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SWRPclBhdGg6IHBhcmVudFBhdGgsIHBhcmVudExheWVyLCBzZWFyY2g6IHsgdmFsdWUsIGZpZWxkIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRyZW4ocGFyZW50UGF0aCwgcGFyZW50TGF5ZXIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoRmllbGQ6IGZpZWxkID09PSAnKicgPyAnKicgOiBmaWVsZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoVmFsdWU6IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgfSkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0biAmJiBkYXRhLml0ZW1zICYmIGRhdGEuaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLnVzZUZhdm9yaXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsOWtkOiKgueCueaUtuiXj+eKtuaAgVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5mYXZIZWxwZXIudXBkYXRlRmF2b3JpdGVzU3RhdHVzKGRhdGEuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZXMgPSB0aGlzLmlucy5jaGVja05vZGVDYW5CZVNlbGVjdChkYXRhLml0ZW1zLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LmFwcGVuZENoaWxkcmVuKG5vZGVzLCB0bik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0dC5sb2FkRGF0YVR5cGUgIT09ICdhbGwnICYmICF0aGlzLmlucy5zaW5nbGVTZWxlY3QgJiYgdGhpcy5pbnMuaXNHZXRBbGxDaGlkbE5vZGVzICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmlucy5jYXNjYWRlU3RhdHVzID09PSAnZW5hYmxlJyB8fCB0aGlzLmlucy5jYXNjYWRlU3RhdHVzID09PSAnZG93bicpICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBybiA9IHR0LmZpbmRSb3dOb2RlKHRuLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQucHJvcGFnYXRlU2VsZWN0aW9uRG93bihybiwgcm4uaXNDaGVja2VkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsOmAieS4reiusOW9lee8k+WtmFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBfaXRlbXMgPSBkYXRhLml0ZW1zLmZpbHRlcihuID0+ICFuLmFkZHRpb25hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfaXRlbXMgJiYgX2l0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoX2l0ZW1zLm1hcChuID0+IG4uZGF0YSksIHJuLmlzQ2hlY2tlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0blsnc2hvd0xvYWRpbmcnXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCAmJiB0aGlzLmlucy5lbmFibGVDYXNjYWRlICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmlucy5jYXNjYWRlU3RhdHVzID09PSAnZW5hYmxlJyB8fCB0aGlzLmlucy5jYXNjYWRlU3RhdHVzID09PSAnZG93bicpICYmIHRoaXMuaW5zLmlzR2V0QWxsQ2hpZGxOb2RlcyApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBybiA9IHR0LmZpbmRSb3dOb2RlKHRuLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5wcm9wYWdhdGVTZWxlY3Rpb25Eb3duKHJuLCBybi5pc0NoZWNrZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdEl0ZW1zID0gdG4uY2hpbGRyZW4uZmlsdGVyKG4gPT4gbi5zZWxlY3RhYmxlKS5tYXAobiA9PiBuLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKHNlbGVjdEl0ZW1zLCBybi5pc0NoZWNrZWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChsb2FkQWxsRGF0YSAmJiB0aGlzLmlucy5pdGVtcykge1xyXG4gICAgICAgICAgICB0aGlzLmlucy50cmVlTm9kZUhlbHBlci51cGRhdGVUcmVlTm9kZUV4cGFuZGVkKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGxvYWRBbGxEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2NhZGVWYWx1ZUNoYW5nZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgdmFsID0gJGV2ZW50O1xyXG4gICAgICAgIC8vIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICBjb25zdCBpbnN0YW5jZVR5cCA9IHRoaXMuaW5zLmFjdGl2ZVRhYiA9PT0gJ2RhdGFsaXN0JyA/ICd0cmVldGFibGUnIDogJ2Zhdic7XHJcbiAgICAgICAgY29uc3QgdHQgPSB0aGlzLmlucy5sb29rdXBDbXBNZ3IuZ2V0Q29tcG9uZW50SW5zdGFuY2UoaW5zdGFuY2VUeXApIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuXHJcbiAgICAgICAgaWYgKCF0dCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzd2l0Y2ggKHZhbCkge1xyXG4gICAgICAgICAgICBjYXNlICdlbmFibGUnOlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZGlzYWJsZSc6XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlQ2hlY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlVXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlVXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlucy5jYXNjYWRlU3RhdHVzID0gdmFsIHx8ICdlbmFibGUnO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=