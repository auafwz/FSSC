/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Optional, Injector } from '@angular/core';
/*
 * @Author: 胡玉洋(Yuyang)
 * @Date: 2019-08-29
 * @LastEditors:  胡玉洋(Yuyang)
 * @LastEditTime: 2019-08-29
 * @QQ: 664927877
 * @Version: v0.0.8
 */
import { Component, Input, forwardRef, Output, EventEmitter } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { IdService, CommonUtils } from '@farris/ui-common';
var FarrisCheckboxGroupComponent = /** @class */ (function () {
    function FarrisCheckboxGroupComponent(idSer, inject) {
        this.idSer = idSer;
        this.inject = inject;
        /* radio 数组 */
        this.data = [];
        /* 分隔符 默认逗号*/
        this.separator = ',';
        /* 值类型是否是string */
        this.isStringValue = true;
        this.textField = 'name';
        this.valueField = 'value';
        this.changeValue = new EventEmitter();
        /* checkbox赋值事件 */
        this.setCheckboxData = new EventEmitter();
        this.controlChange = (/**
         * @return {?}
         */
        function () { });
        this.controlTouch = (/**
         * @return {?}
         */
        function () { });
        if (this.inject) {
            this.commonUtils = this.inject.get(CommonUtils);
        }
    }
    /**
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 初始化name
        this.name = this.idSer.generate().replace(/-/g, '_');
        this.setCheckboxData.emit(this);
        // todo 取值可以实现promise
        if (this.loadData) {
            this.loadDataSubscription = this.loadData().subscribe((/**
             * @param {?} res
             * @return {?}
             */
            function (res) { return _this.data = res.data; }));
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.loadDataSubscription) {
            this.loadDataSubscription.unsubscribe();
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype._getText = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.textField, item);
            }
            else {
                return item[this.textField];
            }
        }
        else {
            return '';
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype._getValue = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.valueField, item);
            }
            else {
                return item[this.valueField];
            }
        }
        else {
            return '';
        }
    };
    /* 选中input值 */
    /* 选中input值 */
    /**
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.clickHandler = /* 选中input值 */
    /**
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    function (item, index) {
        /** @type {?} */
        var arrValue = this.transformToArr(this.value) || [];
        /** @type {?} */
        var val = String(this._getValue(item));
        if (!arrValue || !arrValue.length) {
            arrValue.push(val);
        }
        else {
            if (arrValue.some((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item == val; }))) {
                arrValue = arrValue.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n !== val; }));
            }
            else {
                arrValue.push(val);
            }
        }
        // 更新value值
        this.value = this.transformToStr(arrValue);
        // 传值formcontrol
        this.controlChange(this.value);
        this.controlTouch(this.value);
        this.changeValue.emit(this.value);
    };
    /* 被选中 */
    /* 被选中 */
    /**
     * @param {?} item
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.checked = /* 被选中 */
    /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var val = String(this._getValue(item));
        /** @type {?} */
        var checkedValue = this.transformToArr(this.value);
        // 多值
        return checkedValue.some((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item == val; }));
    };
    /* 值到数组值的转换 */
    /* 值到数组值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.transformToArr = /* 值到数组值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (!value) {
            return [];
        }
        if (!this.isStringValue) {
            return value;
        }
        return value.split(this.separator);
    };
    /* 值到字符串值的转换 */
    /* 值到字符串值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.transformToStr = /* 值到字符串值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        /** @type {?} */
        var allVals = this.data.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return _this._getValue(n); }));
        /** @type {?} */
        var r = [];
        allVals.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (value.some((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item == n; }))) {
                r.push(n);
            }
        }));
        if (!this.isStringValue) {
            return r;
        }
        return r.join(this.separator);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.value = value;
    };
    /* change操作值变化  方法重写*/
    /* change操作值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.registerOnChange = /* change操作值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.controlChange = fn;
    };
    /* blur值变化  方法重写*/
    /* blur值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    FarrisCheckboxGroupComponent.prototype.registerOnTouched = /* blur值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.controlTouch = fn;
    };
    FarrisCheckboxGroupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'farris-checkboxgroup',
                    template: "<div class=\"farris-input-wrap\" [class.farris-checkradio-hor]=\"horizontal\">\r\n    <div\r\n        class=\"custom-control custom-checkbox\"\r\n        *ngFor=\"let item of data; let i = index\"\r\n    >\r\n        <input\r\n            #input\r\n            class=\"custom-control-input\"\r\n            [name]=\"name\"\r\n            id=\"{{ 'checkbox_' + name + i }}\"\r\n            type=\"checkbox\"\r\n            [value]=\"_getValue(item)\"\r\n            (click)=\"clickHandler(item, i)\"\r\n            [checked]=\"checked(item)\"\r\n            [disabled]=\"disable\"\r\n            tabindex=\"{{ tabIndex }}\"\r\n        />\r\n        <label\r\n            class=\"custom-control-label\"\r\n            for=\"{{ 'checkbox_' + name + i }}\"\r\n            title=\"{{_getText(item)}}\"\r\n            >{{ _getText(item) }}</label\r\n        >\r\n    </div>\r\n</div>\r\n",
                    providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return FarrisCheckboxGroupComponent; })),
                            multi: true,
                        }],
                    exportAs: 'FarrisCheckboxGroupComponent'
                }] }
    ];
    /** @nocollapse */
    FarrisCheckboxGroupComponent.ctorParameters = function () { return [
        { type: IdService },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    FarrisCheckboxGroupComponent.propDecorators = {
        tabIndex: [{ type: Input, args: ['tab-index',] }],
        data: [{ type: Input }],
        type: [{ type: Input }],
        name: [{ type: Input }],
        horizontal: [{ type: Input }],
        separator: [{ type: Input }],
        disable: [{ type: Input }],
        value: [{ type: Input }],
        isStringValue: [{ type: Input }],
        textField: [{ type: Input }],
        valueField: [{ type: Input }],
        loadData: [{ type: Input }],
        changeValue: [{ type: Output }],
        setCheckboxData: [{ type: Output }]
    };
    return FarrisCheckboxGroupComponent;
}());
export { FarrisCheckboxGroupComponent };
if (false) {
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.tabIndex;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.data;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.type;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.name;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.horizontal;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.separator;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.disable;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.value;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.isStringValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.textField;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.valueField;
    /**
     * 加载数据事件
     * @type {?}
     */
    FarrisCheckboxGroupComponent.prototype.loadData;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.loadDataSubscription;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.changeValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.setCheckboxData;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlChange;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlTouch;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.idSer;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3hncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZvcm1zLyIsInNvdXJjZXMiOlsibGliL2NoZWNrYm94L2NoZWNrYm94Z3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQXVDLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVN4RixPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRixPQUFPLEVBQUUsaUJBQWlCLEVBQXdCLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUkzRDtJQW9ESSxzQ0FBb0IsS0FBZ0IsRUFBc0IsTUFBZ0I7UUFBdEQsVUFBSyxHQUFMLEtBQUssQ0FBVztRQUFzQixXQUFNLEdBQU4sTUFBTSxDQUFVOztRQXJDakUsU0FBSSxHQUFVLEVBQUUsQ0FBQzs7UUFZakIsY0FBUyxHQUFHLEdBQUcsQ0FBQzs7UUFTaEIsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFFckIsY0FBUyxHQUFHLE1BQU0sQ0FBQztRQUNuQixlQUFVLEdBQUcsT0FBTyxDQUFDO1FBTXBCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7UUFHdEMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBa0k1QyxrQkFBYTs7O1FBQXlCLGNBQVEsQ0FBQyxFQUFDO1FBQ2hELGlCQUFZOzs7UUFBeUIsY0FBUSxDQUFDLEVBQUM7UUE5SG5ELElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNiLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDbkQ7SUFDTCxDQUFDOzs7O0lB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QUFLOzRCQUVMLEtBQUs7NkJBQ0wsS0FBSzsyQkFHTCxLQUFLOzhCQUdMLE1BQU07a0NBR04sTUFBTTs7SUFxSVgsbUNBQUM7Q0FBQSxBQXJMRCxJQXFMQztTQTNLWSw0QkFBNEI7OztJQUVyQyxnREFBcUM7O0lBR3JDLDRDQUEwQjs7SUFHMUIsNENBQXNCOztJQUd0Qiw0Q0FBc0I7O0lBR3RCLGtEQUE2Qjs7SUFHN0IsaURBQXlCOztJQUd6QiwrQ0FBMEI7O0lBRzFCLDZDQUFvQjs7SUFHcEIscURBQThCOztJQUU5QixpREFBNEI7O0lBQzVCLGtEQUE4Qjs7Ozs7SUFHOUIsZ0RBQTBEOztJQUMxRCw0REFBbUM7O0lBRW5DLG1EQUFnRDs7SUFHaEQsdURBQW9EOzs7OztJQUVwRCxtREFBaUM7Ozs7O0lBZ0lqQyxxREFBd0Q7Ozs7O0lBQ3hELG9EQUF1RDs7Ozs7SUEvSDNDLDZDQUF3Qjs7Ozs7SUFBRSw4Q0FBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPbkRlc3Ryb3ksIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcywgT3B0aW9uYWwsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOiDoeeOiea0iyhZdXlhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTI5XHJcbiAqIEBMYXN0RWRpdG9yczogIOiDoeeOiea0iyhZdXlhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMDgtMjlcclxuICogQFFROiA2NjQ5Mjc4NzdcclxuICogQFZlcnNpb246IHYwLjAuOFxyXG4gKi9cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgZm9yd2FyZFJlZiwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IElkU2VydmljZSwgQ29tbW9uVXRpbHMgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpcy1jaGVja2JveGdyb3VwJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9jaGVja2JveGdyb3VwLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHByb3ZpZGVyczogW3tcclxuICAgICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGYXJyaXNDaGVja2JveEdyb3VwQ29tcG9uZW50KSxcclxuICAgICAgICBtdWx0aTogdHJ1ZSxcclxuICAgIH1dLFxyXG4gICAgZXhwb3J0QXM6ICdGYXJyaXNDaGVja2JveEdyb3VwQ29tcG9uZW50J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRmFycmlzQ2hlY2tib3hHcm91cENvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuXHJcbiAgICBASW5wdXQoJ3RhYi1pbmRleCcpIHRhYkluZGV4OiBudW1iZXI7XHJcblxyXG4gICAgLyogcmFkaW8g5pWw57uEICovXHJcbiAgICBASW5wdXQoKSBkYXRhOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgIC8qIGNoZWNrYm94IOexu+WeiyAgIOWOn+eUn+aIluiAheaMiemSruexu+WeiyovXHJcbiAgICBASW5wdXQoKSB0eXBlOiBzdHJpbmc7XHJcblxyXG4gICAgLyog5aSN6YCJ5qGGbmFtZSAqL1xyXG4gICAgQElucHV0KCkgbmFtZTogc3RyaW5nO1xyXG5cclxuICAgIC8qIOaYr+WQpuawtOW5s+WIhuW4gyAqL1xyXG4gICAgQElucHV0KCkgaG9yaXpvbnRhbDogYm9vbGVhbjtcclxuXHJcbiAgICAvKiDliIbpmpTnrKYg6buY6K6k6YCX5Y+3Ki9cclxuICAgIEBJbnB1dCgpIHNlcGFyYXRvciA9ICcsJztcclxuXHJcbiAgICAvKiDnpoHnlKggKi9cclxuICAgIEBJbnB1dCgpIGRpc2FibGU6IGJvb2xlYW47XHJcblxyXG4gICAgLyog5aSN6YCJ5qGG57uE55qE5YC8ICovXHJcbiAgICBASW5wdXQoKSB2YWx1ZTogYW55O1xyXG5cclxuICAgIC8qIOWAvOexu+Wei+aYr+WQpuaYr3N0cmluZyAqL1xyXG4gICAgQElucHV0KCkgaXNTdHJpbmdWYWx1ZSA9IHRydWU7XHJcblxyXG4gICAgQElucHV0KCkgdGV4dEZpZWxkID0gJ25hbWUnO1xyXG4gICAgQElucHV0KCkgdmFsdWVGaWVsZCA9ICd2YWx1ZSc7XHJcblxyXG4gICAgLyoqIOWKoOi9veaVsOaNruS6i+S7tiAqL1xyXG4gICAgQElucHV0KCkgbG9hZERhdGE6IChlbXB0eURhdGE/OiBhbnlbXSkgPT4gT2JzZXJ2YWJsZTxhbnk+O1xyXG4gICAgbG9hZERhdGFTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICBAT3V0cHV0KCkgY2hhbmdlVmFsdWUgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgICAvKiBjaGVja2JveOi1i+WAvOS6i+S7tiAqL1xyXG4gICAgQE91dHB1dCgpIHNldENoZWNrYm94RGF0YSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAgIHByaXZhdGUgY29tbW9uVXRpbHM6IENvbW1vblV0aWxzO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaWRTZXI6IElkU2VydmljZSwgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3Q6IEluamVjdG9yKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5qZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbHMgPSB0aGlzLmluamVjdC5nZXQoQ29tbW9uVXRpbHMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICAvLyDliJ3lp4vljJZuYW1lXHJcbiAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5pZFNlci5nZW5lcmF0ZSgpLnJlcGxhY2UoLy0vZywgJ18nKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRDaGVja2JveERhdGEuZW1pdCh0aGlzKTtcclxuICAgICAgICAvLyB0b2RvIOWPluWAvOWPr+S7peWunueOsHByb21pc2VcclxuICAgICAgICBpZiAodGhpcy5sb2FkRGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLmxvYWREYXRhU3Vic2NyaXB0aW9uID0gdGhpcy5sb2FkRGF0YSgpLnN1YnNjcmliZShyZXMgPT4gdGhpcy5kYXRhID0gcmVzLmRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZERhdGFTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkRGF0YVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfZ2V0VGV4dChpdGVtKSB7XHJcbiAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29tbW9uVXRpbHMgJiYgdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUodGhpcy50ZXh0RmllbGQsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bdGhpcy50ZXh0RmllbGRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfZ2V0VmFsdWUoaXRlbSkge1xyXG4gICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbW1vblV0aWxzICYmIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMudmFsdWVGaWVsZCwgaXRlbSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVt0aGlzLnZhbHVlRmllbGRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiDpgInkuK1pbnB1dOWAvCAqL1xyXG4gICAgY2xpY2tIYW5kbGVyKGl0ZW06IGFueSwgaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIGxldCBhcnJWYWx1ZSA9IHRoaXMudHJhbnNmb3JtVG9BcnIodGhpcy52YWx1ZSkgfHwgW107XHJcblxyXG4gICAgICAgIGNvbnN0IHZhbCA9IFN0cmluZyh0aGlzLl9nZXRWYWx1ZShpdGVtKSk7XHJcbiAgICAgICAgaWYgKCFhcnJWYWx1ZSB8fCAhYXJyVmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGFyclZhbHVlLnB1c2godmFsKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoYXJyVmFsdWUuc29tZShpdGVtID0+IGl0ZW0gPT0gdmFsKSkge1xyXG4gICAgICAgICAgICAgICAgYXJyVmFsdWUgPSBhcnJWYWx1ZS5maWx0ZXIobiA9PiBuICE9PSB2YWwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXJyVmFsdWUucHVzaCh2YWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDmm7TmlrB2YWx1ZeWAvFxyXG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnRyYW5zZm9ybVRvU3RyKGFyclZhbHVlKTtcclxuXHJcbiAgICAgICAgLy8g5Lyg5YC8Zm9ybWNvbnRyb2xcclxuICAgICAgICB0aGlzLmNvbnRyb2xDaGFuZ2UodGhpcy52YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVG91Y2godGhpcy52YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VWYWx1ZS5lbWl0KHRoaXMudmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOiiq+mAieS4rSAqL1xyXG4gICAgY2hlY2tlZChpdGVtOiBhbnkpIHtcclxuICAgICAgICBjb25zdCB2YWwgPSBTdHJpbmcodGhpcy5fZ2V0VmFsdWUoaXRlbSkpO1xyXG4gICAgICAgIGNvbnN0IGNoZWNrZWRWYWx1ZSA9IHRoaXMudHJhbnNmb3JtVG9BcnIodGhpcy52YWx1ZSk7XHJcbiAgICAgICAgLy8g5aSa5YC8XHJcbiAgICAgICAgcmV0dXJuIGNoZWNrZWRWYWx1ZS5zb21lKGl0ZW0gPT4gaXRlbSA9PSB2YWwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOWAvOWIsOaVsOe7hOWAvOeahOi9rOaNoiAqL1xyXG4gICAgdHJhbnNmb3JtVG9BcnIodmFsdWU6IGFueSk6IHN0cmluZ1tdIHtcclxuICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzU3RyaW5nVmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZhbHVlLnNwbGl0KHRoaXMuc2VwYXJhdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDlgLzliLDlrZfnrKbkuLLlgLznmoTovazmjaIgKi9cclxuICAgIHRyYW5zZm9ybVRvU3RyKHZhbHVlOiBBcnJheTxzdHJpbmc+KSB7XHJcblxyXG4gICAgICAgIGNvbnN0IGFsbFZhbHMgPSB0aGlzLmRhdGEubWFwKG4gPT4gdGhpcy5fZ2V0VmFsdWUobikpO1xyXG4gICAgICAgIGNvbnN0IHIgPSBbXTtcclxuICAgICAgICBhbGxWYWxzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZS5zb21lKGl0ZW0gPT4gaXRlbSA9PSBuKSkge1xyXG4gICAgICAgICAgICAgICAgci5wdXNoKG4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc1N0cmluZ1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gci5qb2luKHRoaXMuc2VwYXJhdG9yKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIGNoYW5nZeaTjeS9nOWAvOWPmOWMliAg5pa55rOV6YeN5YaZKi9cclxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICgpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xDaGFuZ2UgPSBmbjtcclxuICAgIH1cclxuXHJcbiAgICAvKiBibHVy5YC85Y+Y5YyWICDmlrnms5Xph43lhpkqL1xyXG4gICAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xUb3VjaCA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29udHJvbENoYW5nZTogKHZhbHVlOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7IH07XHJcbiAgICBwcml2YXRlIGNvbnRyb2xUb3VjaDogKHZhbHVlOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7IH07XHJcblxyXG59XHJcbiJdfQ==