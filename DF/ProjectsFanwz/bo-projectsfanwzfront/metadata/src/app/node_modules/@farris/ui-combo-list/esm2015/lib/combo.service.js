/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector } from '@angular/core';
import { BehaviorSubject, Subject, of } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { debounceTime, map, switchMap, catchError, tap, delay } from 'rxjs/operators';
import { LoadingService } from '@farris/ui-loading';
import { LookupUtils, ServerSideToken } from '@farris/ui-lookup';
import { ComboServerSideToken } from './http/ComboHttpService';
export class ComboService {
    /**
     * @param {?} http
     * @param {?} loadingService
     * @param {?} injector
     */
    constructor(http, loadingService, injector) {
        this.http = http;
        this.loadingService = loadingService;
        this.injector = injector;
        this.selections$ = new Subject();
        this.isOpen$ = new BehaviorSubject(false);
        this.data$ = new BehaviorSubject('');
        this.serachValue$ = new Subject();
        this.loadSuccess$ = new Subject();
        this.treeInfo$ = new BehaviorSubject(null);
        this.displayType = 'LIST';
        this.separator = ',';
        this.selectedValues = '';
        this.columns = [];
        this.remoteSearch = true;
        this.panelElement = null;
        this.treeSearchHandler = null;
        // 树帮助加载设置
        this.treeloadconfig = null;
        this._data = [];
        this.serachValue$.pipe(debounceTime(300)).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (!this.remoteSearch) {
                this.filterData(value, this.textField);
            }
            else {
                this.filterDataOnServer(value);
            }
        }));
    }
    /**
     * @return {?}
     */
    get uri() {
        return this._uri;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set uri(val) {
        this._uri = val;
        this.data$.next([]);
    }
    /**
     * @return {?}
     */
    get data() {
        return this._data;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set data(value) {
        this._data = value || [];
        if (Array.isArray(value)) {
            this.data$.next(value);
        }
    }
    /**
     * @return {?}
     */
    injectService() {
        if (this.injector && !this.comboHttp) {
            this.lookupUtils = this.injector.get(LookupUtils, null);
            if (this.displayType.indexOf('LOOKUP') > -1) {
                this.comboHttp = this.injector.get(ServerSideToken, null);
            }
            else {
                this.comboHttp = this.injector.get(ComboServerSideToken, null);
            }
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    toBoolean(value) {
        return value != null && `${value}` !== 'false';
    }
    /**
     * @param {?} data
     * @param {?=} index
     * @param {?=} emitEvent
     * @return {?}
     */
    selectItem(data, index, emitEvent = true) {
        if (!this.multiSelect) {
            this.selections = [];
        }
        if (Array.isArray(data)) {
            data.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (this.selections.findIndex((/**
                 * @param {?} s
                 * @return {?}
                 */
                s => s[this.idField] === n[this.idField])) === -1) {
                    this.selections.push(n);
                }
            }));
        }
        else {
            if (this.selections.findIndex((/**
             * @param {?} s
             * @return {?}
             */
            s => s[this.idField] === data[this.idField])) === -1) {
                this.selections.push(data);
            }
        }
        if (emitEvent) {
            this.selections$.next({ action: 'clicked' });
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    unSelectItem(data) {
        // console.log(data);
        this.selections = this.selections.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            // return item[this.idField] !== data[this.idField];
            return JSON.stringify(item) !== JSON.stringify(data);
        }));
        this.selections$.next({ action: 'clicked' });
    }
    /**
     * @param {?} datas
     * @return {?}
     */
    selectAll(datas) {
        (datas || []).forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (!this.selections.find((/**
             * @param {?} i
             * @return {?}
             */
            i => i[this.idField] === n[this.idField]))) {
                this.selections.push(n);
            }
        }));
        // this.selections = datas;
        this.selections$.next({ action: 'clicked' });
    }
    /**
     * @param {?} datas
     * @return {?}
     */
    unSelectAll(datas) {
        // this.selections = [];
        datas = datas || [];
        this.selections = (this.selections || []).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => datas.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        i => i[this.idField] === n[this.idField])) === -1));
        this.selections$.next({ action: 'clicked' });
    }
    /**
     * @param {?} id
     * @return {?}
     */
    isSelect(id) {
        if (this.selections && this.selections.length) {
            return this.selections.find((/**
             * @param {?} item
             * @return {?}
             */
            item => item[this.idField] === id)) !== undefined;
        }
        return false;
    }
    /**
     * @param {?} data
     * @param {?=} selectValues
     * @param {?=} callback
     * @return {?}
     */
    loadData(data, selectValues = '', callback) {
        if (data) {
            if (selectValues === null || selectValues === undefined) {
                selectValues = '';
            }
            if (typeof selectValues === 'boolean') {
                selectValues = '' + selectValues;
            }
            // this.data$.next(data);
            if (selectValues) {
                /** @type {?} */
                let vals = [(selectValues + '')];
                if (this.multiSelect) {
                    vals = (selectValues + '').split(this.separator);
                }
                /** @type {?} */
                let selectedItems = vals.map((/**
                 * @param {?} val
                 * @return {?}
                 */
                val => {
                    return callback(data, val);
                }));
                selectedItems = selectedItems.filter((/**
                 * @param {?} el
                 * @return {?}
                 */
                el => el));
                this.selections = selectedItems;
            }
            else {
                this.selections = [];
            }
            this.selections$.next({ action: 'initData' });
        }
    }
    /**
     * @param {?} params
     * @return {?}
     */
    filterDataOnServer(params) {
        this.getData(params).subscribe((/**
         * @param {?} r
         * @return {?}
         */
        r => {
            this.closeLoading();
            this.loadingService.clearAll();
            if (r && r.items) {
                switch (this.displayType) {
                    case 'LOOKUPLIST': {
                        this.loadLookUpDataTable(r, true);
                        break;
                    }
                    case 'LOOKUPTREELIST': {
                        this.loadLookUpDataTree(r);
                        break;
                    }
                }
            }
            else {
                this.data$.next([]);
            }
        }));
    }
    // 客户端过滤
    /**
     * @param {?} val
     * @param {?=} field
     * @return {?}
     */
    filterData(val, field = 'text') {
        if (val) {
            /** @type {?} */
            let data = [];
            if (this.displayType === 'LOOKUPLIST' || this.displayType === 'LIST') {
                data = this.data.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => {
                    return String(this.getValueByObj(field, item)).indexOf(val) > -1;
                }));
            }
            // const data = this.data
            //     ? this.data.filter(item => {
            //         if (this.getValueByObj(filed, item)) {
            //             return String(this.getValueByObj(filed, item)).indexOf(val) > -1;
            //         } else if (item.data && this.getValueByObj(filed, item.data)) {
            //             return String(this.getValueByObj(filed, item.data)).indexOf(val) > -1;
            //         }
            //     })
            //     : [];
            this.data$.next(data);
        }
        else {
            this.data$.next(this.data);
        }
    }
    /**
     * @return {?}
     */
    getSelections() {
        return this.selections;
    }
    /**
     * @return {?}
     */
    clearSelections() {
        this.selections = [];
    }
    /**
     * @param {?} prop
     * @param {?=} selections
     * @return {?}
     */
    getValue(prop, selections) {
        selections = selections ? selections : this.selections;
        if (selections && selections.length) {
            /** @type {?} */
            const tmp = selections.map((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                return this.getValueByObj(prop, item);
            }));
            if (tmp && (tmp.length > 1 || tmp.length === 0)) {
                return tmp.join(this.separator);
            }
            else {
                return tmp[0];
            }
        }
        return '';
    }
    /**
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    getValueByObj(field, data) {
        if (!data) {
            return '';
        }
        /** @type {?} */
        let resultVal = '';
        if (field.indexOf('.') === -1) {
            if (data.hasOwnProperty(field)) {
                resultVal = data[field];
            }
            else {
                console.log(`%cError: The %c"${field}"%c is not in `, 'color: #bb0000;font-weight: bold;', 'color: red;font-style: italic', 'color: #bb0000;font-weight: bold;', data);
                resultVal = null;
            }
        }
        else {
            resultVal = field.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            (obj, key) => {
                if (obj) {
                    return obj[key];
                }
                else {
                    console.log(`%cError: The %c"${key}"%c is not in  `, 'color: #bb0000;font-weight: bold', 'color: red;font-style: italic', 'color: #bb0000;font-weight: bold;', obj);
                    return null;
                }
            }), data);
        }
        return resultVal;
    }
    /**
     * @param {?=} params
     * @param {?=} method
     * @param {?=} selectedIds
     * @return {?}
     */
    initData(params = {}, method = 'get', selectedIds = '') {
        switch (this.displayType) {
            case 'TreeList':
            case 'LIST': {
                if (params.data) {
                    params = params.data;
                }
                this.getData(params, method).subscribe((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    if (this.displayType === 'TreeList') {
                        this.loadDataTree(d);
                    }
                    else {
                        this.loadDataTable(d);
                    }
                    this.loadSuccess$.next(true);
                }));
                break;
            }
            case 'LOOKUPLIST':
            case 'LOOKUPTREELIST': {
                this.loadLookupData(params, selectedIds, 'get', this.displayType === 'LOOKUPTREELIST');
                break;
            }
        }
        return this.loadSuccess$;
    }
    /**
     * @private
     * @param {?} params
     * @param {?} selectedIds
     * @param {?=} method
     * @param {?=} isTree
     * @return {?}
     */
    loadLookupData(params, selectedIds, method = 'get', isTree = false) {
        const { data, enableFullTree, loadTreeDataType } = params;
        if (data) {
            params = { customData: data };
        }
        if (this.displayType === 'LOOKUPTREELIST') {
            params.enableFullTree = enableFullTree;
            params.loadTreeDataType = 'loadall'; // loadTreeDataType;
            params.searchValue = '{"category":"all"}';
            this.treeloadconfig = { enableFullTree, loadTreeDataType };
        }
        this.getData(params, method).pipe(switchMap((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (selectedIds) {
                return this.getSelectedItems(selectedIds).pipe(map((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    if (d && d.items) {
                        data.selectedItems = isTree ? d.items.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n.data)) : d.items;
                    }
                    else {
                        if (Array.isArray(d)) {
                            data.selectedItems = (selectedIds + '').split(this.separator).map((/**
                             * @param {?} val
                             * @return {?}
                             */
                            val => {
                                if (isTree) {
                                    return this.treeNodeToFlatData(d, val, this.idField);
                                }
                                else {
                                    return d.find((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    n => n[this.idField] + '' == val || n[this.textField] == val));
                                }
                            }));
                        }
                    }
                    return data;
                })), catchError((/**
                 * @return {?}
                 */
                () => {
                    return of(data);
                })));
            }
            return of(data);
        }))).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            this.loadingService.clearAll();
            if (data) {
                if (isTree) {
                    this.loadLookUpDataTree(data);
                }
                else {
                    this.loadLookUpDataTable(data);
                }
            }
            this.loadSuccess$.next(true);
        }));
    }
    /**
     * @param {?} selIds
     * @return {?}
     */
    getSelectedItems(selIds) {
        /** @type {?} */
        const searchParam = {
            category: 'fav', favoriteIds: ('' + selIds).split(this.separator)
        };
        /** @type {?} */
        const p = { searchValue: JSON.stringify(searchParam), enableFullTree: false, loadTreeDataType: 'default' };
        return this.getData(p);
    }
    /**
     * @param {?=} params
     * @param {?=} method
     * @return {?}
     */
    getData(params = {}, method = 'get') {
        if (this.uri) {
            // this.data = [];
            this.showLoading();
            if (this.comboHttp) {
                if (this.context) {
                    this.comboHttp.context = this.context;
                }
                return this.comboHttp.getData(this.uri, params, method).pipe(tap((/**
                 * @return {?}
                 */
                () => {
                    this.closeLoading();
                })));
            }
            else {
                return this.http.request(method, this.uri, params).pipe(tap((/**
                 * @return {?}
                 */
                () => {
                    this.closeLoading();
                })));
            }
        }
        else {
            if (this.data) {
                return of(this.data).pipe(delay(10));
            }
            else {
                return of([]).pipe(delay(10));
            }
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    loadDataTable(data) {
        if (data instanceof Array) {
            this.data = [...data];
        }
        else {
            this.data = data ? data.returnValue : [];
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            return dataArr.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d[this.idField] + '' == val || d[this.textField] == val));
        }));
        this.closeLoading();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    loadDataTree(data) {
        if (data instanceof Array) {
            this.data = data;
        }
        else {
            this.data = data ? data.returnValue : [];
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            return eachData(dataArr, val, this.idField);
            /**
             * @param {?} paramData
             * @param {?} paramVal
             * @param {?} idField
             * @return {?}
             */
            function eachData(paramData, paramVal, idField) {
                /** @type {?} */
                let rtnData = '';
                paramData.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    if (d.data[idField] == paramVal) {
                        rtnData = d.data;
                        return true;
                    }
                    else if (d.children && d.children.length) {
                        rtnData = eachData(d.children, paramVal, idField);
                    }
                    else {
                        return false;
                    }
                }));
                return rtnData;
            }
        }));
        this.closeLoading();
    }
    /**
     * @param {?} resData
     * @param {?=} sortable
     * @return {?}
     */
    loadLookUpDataTable(resData, sortable = false) {
        this.closeLoading();
        if (typeof resData === 'object') {
            if (resData.returnValue) {
                resData = resData.returnValue;
            }
            if (!sortable && resData.columns) {
                this.columns = resData.columns;
            }
            if (resData.pageInfo) {
                this.pageInfo = resData.pageInfo;
                this.pageInfo.total = resData.total ? resData.total : 0;
            }
            if (resData.items) {
                this.data = resData.items;
            }
            if (resData.selectedItems) {
                this.selections = resData.selectedItems || [];
            }
        }
        if (this.selections) {
            /** @type {?} */
            const ids = this.selections.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.idField])).join(this.separator);
            if (ids !== this.selectedValues) {
                this.selectedValues = ids;
            }
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            /** @type {?} */
            let isMaped = dataArr.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d[this.idField] + '' == val));
            if (this.selections) {
                isMaped = !isMaped ? this.selections.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => d[this.idField] + '' == val)) : isMaped;
            }
            return isMaped;
        }));
    }
    /**
     * @private
     * @param {?} nodes
     * @param {?=} allData
     * @return {?}
     */
    checkNodeCanBeSelect(nodes, allData = true) {
        if (nodes && nodes.length) {
            return nodes.map((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                if (node.hasOwnProperty('addtional')) {
                    node.selectable = !node['addtional'];
                }
                if (node.children && node.children.length) {
                    this.checkNodeCanBeSelect(node.children, allData);
                }
                else {
                    if (allData) {
                        node.leaf = true;
                    }
                }
                return node;
            }));
        }
        return nodes;
    }
    /**
     * @param {?} resData
     * @return {?}
     */
    loadLookUpDataTree(resData) {
        this.closeLoading();
        if (!resData) {
            return;
        }
        if (resData instanceof Array) {
            this.data = resData;
        }
        else {
            if (resData.returnValue) {
                resData = resData.returnValue;
            }
            this.columns = resData.columns;
            this.treeInfo = resData.treeInfo;
            this.treeInfo$.next(this.treeInfo);
            if (resData.selectedItems) {
                this.selections = resData.selectedItems || [];
            }
            if (this.treeInfo && !this.treeInfo['treeDataIsInit']) {
                if (this.treeInfo.layerType.toLowerCase() === 'pathcode') {
                    this.data = this.lookupUtils.makeTree(resData.items, this.treeInfo);
                }
                else {
                    this.data = this.lookupUtils.makeTreeWithParentID(resData.items, '', `${this.treeInfo.dataField}.${this.treeInfo.parentField}`, this.idField);
                }
            }
            else if (resData.items) {
                // this.data = resData.items;
                /** @type {?} */
                const isLoadAllTreeData = (/**
                 * @return {?}
                 */
                () => {
                    if (this.treeloadconfig.loadTreeDataType === 'default') {
                        return this.treeInfo.loadDataType === 'all';
                    }
                    else {
                        return this.treeloadconfig.loadTreeDataType === 'loadall';
                    }
                });
                this.data = this.checkNodeCanBeSelect(resData.items);
            }
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            return this.treeNodeToFlatData(dataArr, val, this.idField);
        }));
    }
    /**
     * @param {?} paramData
     * @param {?} paramVal
     * @param {?} idField
     * @return {?}
     */
    treeNodeToFlatData(paramData, paramVal, idField) {
        /** @type {?} */
        let rtnData = '';
        paramData.find((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            if ((d.data && d.data[idField] == paramVal) || d[idField] == paramVal) {
                rtnData = d.data;
                return true;
            }
            else if (d.children && d.children.length) {
                rtnData = this.treeNodeToFlatData(d.children, paramVal, idField);
                return rtnData ? true : false;
            }
            else {
                return false;
            }
        }));
        return rtnData;
    }
    /**
     * @private
     * @return {?}
     */
    showLoading() {
        this.loading = this.loadingService.show({ container: this.panelElement, delay: 100 });
    }
    /**
     * @return {?}
     */
    closeLoading() {
        if (this.loading) {
            this.loading.close();
            this.loading = null;
        }
    }
}
ComboService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
ComboService.ctorParameters = () => [
    { type: HttpClient },
    { type: LoadingService },
    { type: Injector }
];
if (false) {
    /** @type {?} */
    ComboService.prototype.selections$;
    /** @type {?} */
    ComboService.prototype.isOpen$;
    /** @type {?} */
    ComboService.prototype.data$;
    /** @type {?} */
    ComboService.prototype.serachValue$;
    /** @type {?} */
    ComboService.prototype.loadSuccess$;
    /** @type {?} */
    ComboService.prototype.treeInfo$;
    /** @type {?} */
    ComboService.prototype.selections;
    /** @type {?} */
    ComboService.prototype.idField;
    /** @type {?} */
    ComboService.prototype.valueField;
    /** @type {?} */
    ComboService.prototype.textField;
    /** @type {?} */
    ComboService.prototype.multiSelect;
    /** @type {?} */
    ComboService.prototype.displayType;
    /** @type {?} */
    ComboService.prototype.separator;
    /** @type {?} */
    ComboService.prototype._uri;
    /** @type {?} */
    ComboService.prototype.selectedValues;
    /** @type {?} */
    ComboService.prototype.pageInfo;
    /** @type {?} */
    ComboService.prototype.treeInfo;
    /** @type {?} */
    ComboService.prototype.columns;
    /** @type {?} */
    ComboService.prototype.context;
    /** @type {?} */
    ComboService.prototype.remoteSearch;
    /** @type {?} */
    ComboService.prototype.panelElement;
    /** @type {?} */
    ComboService.prototype.treeSearchHandler;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.treeloadconfig;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype._data;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.lookupUtils;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.comboHttp;
    /** @type {?} */
    ComboService.prototype.http;
    /** @type {?} */
    ComboService.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktY29tYm8tbGlzdC8iLCJzb3VyY2VzIjpbImxpYi9jb21iby5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxZQUFZLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxjQUFjLEVBQW9CLE1BQU0sb0JBQW9CLENBQUM7QUFDdEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsb0JBQW9CLEVBQW9CLE1BQU0seUJBQXlCLENBQUM7QUFJakYsTUFBTSxPQUFPLFlBQVk7Ozs7OztJQXVEckIsWUFBbUIsSUFBZ0IsRUFBUyxjQUE4QixFQUFVLFFBQWtCO1FBQW5GLFNBQUksR0FBSixJQUFJLENBQVk7UUFBUyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBckR0RyxnQkFBVyxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFDakMsWUFBTyxHQUFHLElBQUksZUFBZSxDQUFVLEtBQUssQ0FBQyxDQUFDO1FBQzlDLFVBQUssR0FBRyxJQUFJLGVBQWUsQ0FBTSxFQUFFLENBQUMsQ0FBQztRQUNyQyxpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFDbEMsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzdCLGNBQVMsR0FBRyxJ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QUMsT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDMUYsQ0FBQzs7OztJQUVELFlBQVk7UUFDUixJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDZCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1NBQ3ZCO0lBQ0wsQ0FBQzs7O1lBaGpCSixVQUFVOzs7O1lBUEYsVUFBVTtZQUVWLGNBQWM7WUFKRixRQUFROzs7O0lBWXpCLG1DQUFpQzs7SUFDakMsK0JBQThDOztJQUM5Qyw2QkFBcUM7O0lBQ3JDLG9DQUFrQzs7SUFDbEMsb0NBQTZCOztJQUM3QixpQ0FBMkM7O0lBRTNDLGtDQUEyQjs7SUFDM0IsK0JBQWdCOztJQUNoQixrQ0FBbUI7O0lBQ25CLGlDQUFrQjs7SUFDbEIsbUNBQXFCOztJQUNyQixtQ0FBcUI7O0lBQ3JCLGlDQUFnQjs7SUFHaEIsNEJBQWE7O0lBU2Isc0NBQW9COztJQUNwQixnQ0FBYzs7SUFDZCxnQ0FBYzs7SUFDZCwrQkFBNkI7O0lBQzdCLCtCQUFhOztJQUNiLG9DQUFvQjs7SUFFcEIsb0NBQXlCOztJQUV6Qix5Q0FBOEI7Ozs7O0lBRzlCLHNDQUE4Qjs7Ozs7SUFDOUIsNkJBQW1DOzs7OztJQUNuQywrQkFBa0M7Ozs7O0lBQ2xDLG1DQUFpQzs7Ozs7SUFDakMsaUNBQW9DOztJQVl4Qiw0QkFBdUI7O0lBQUUsc0NBQXFDOzs7OztJQUFFLGdDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgU3ViamVjdCwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBtYXAsIHN3aXRjaE1hcCwgY2F0Y2hFcnJvciwgdGFwLCBkZWxheSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UsIExvYWRpbmdDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xyXG5pbXBvcnQgeyBMb29rdXBVdGlscywgU2VydmVyU2lkZVRva2VuIH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBDb21ib1NlcnZlclNpZGVUb2tlbiwgQ29tYm9IdHRwU2VydmljZSB9IGZyb20gJy4vaHR0cC9Db21ib0h0dHBTZXJ2aWNlJztcclxuaW1wb3J0IHsgTm9ybWFsT2JqZWN0IH0gZnJvbSAnLi9jb21iby5pbnRlcmZhY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQ29tYm9TZXJ2aWNlIHtcclxuXHJcbiAgICBzZWxlY3Rpb25zJCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIGlzT3BlbiQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGZhbHNlKTtcclxuICAgIGRhdGEkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KCcnKTtcclxuICAgIHNlcmFjaFZhbHVlJCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIGxvYWRTdWNjZXNzJCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICB0cmVlSW5mbyQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4obnVsbCk7XHJcblxyXG4gICAgc2VsZWN0aW9uczogTm9ybWFsT2JqZWN0W107XHJcbiAgICBpZEZpZWxkOiBzdHJpbmc7XHJcbiAgICB2YWx1ZUZpZWxkOiBzdHJpbmc7XHJcbiAgICB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIG11bHRpU2VsZWN0OiBib29sZWFuO1xyXG4gICAgZGlzcGxheVR5cGUgPSAnTElTVCc7XHJcbiAgICBzZXBhcmF0b3IgPSAnLCc7XHJcblxyXG5cclxuICAgIF91cmk6IHN0cmluZztcclxuICAgIGdldCB1cmkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VyaTtcclxuICAgIH1cclxuICAgIHNldCB1cmkodmFsOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl91cmkgPSB2YWw7XHJcbiAgICAgICAgdGhpcy5kYXRhJC5uZXh0KFtdKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RlZFZhbHVlcyA9ICcnO1xyXG4gICAgcGFnZUluZm86IGFueTtcclxuICAgIHRyZWVJbmZvOiBhbnk7XHJcbiAgICBjb2x1bW5zOiBOb3JtYWxPYmplY3RbXSA9IFtdO1xyXG4gICAgY29udGV4dDogYW55O1xyXG4gICAgcmVtb3RlU2VhcmNoID0gdHJ1ZTtcclxuXHJcbiAgICBwYW5lbEVsZW1lbnQ6IGFueSA9IG51bGw7XHJcblxyXG4gICAgdHJlZVNlYXJjaEhhbmRsZXI6IGFueSA9IG51bGw7XHJcblxyXG4gICAgLy8g5qCR5biu5Yqp5Yqg6L296K6+572uXHJcbiAgICBwcml2YXRlIHRyZWVsb2FkY29uZmlnID0gbnVsbDtcclxuICAgIHByaXZhdGUgX2RhdGE6IE5vcm1hbE9iamVjdFtdID0gW107XHJcbiAgICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdDb21wb25lbnQ7XHJcbiAgICBwcml2YXRlIGxvb2t1cFV0aWxzOiBMb29rdXBVdGlscztcclxuICAgIHByaXZhdGUgY29tYm9IdHRwOiBDb21ib0h0dHBTZXJ2aWNlO1xyXG4gICAgZ2V0IGRhdGEoKTogTm9ybWFsT2JqZWN0W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhO1xyXG4gICAgfVxyXG4gICAgc2V0IGRhdGEodmFsdWU6IE5vcm1hbE9iamVjdFtdKSB7XHJcbiAgICAgICAgdGhpcy5fZGF0YSA9IHZhbHVlIHx8IFtdO1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEkLm5leHQodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIGh0dHA6IEh0dHBDbGllbnQsIHB1YmxpYyBsb2FkaW5nU2VydmljZTogTG9hZGluZ1NlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5zZXJhY2hWYWx1ZSQucGlwZShkZWJvdW5jZVRpbWUoMzAwKSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnJlbW90ZVNlYXJjaCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJEYXRhKHZhbHVlLCB0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckRhdGFPblNlcnZlcih2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpbmplY3RTZXJ2aWNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmluamVjdG9yICYmICF0aGlzLmNvbWJvSHR0cCkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoTG9va3VwVXRpbHMsIG51bGwpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZS5pbmRleE9mKCdMT09LVVAnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbWJvSHR0cCA9IHRoaXMuaW5qZWN0b3IuZ2V0KFNlcnZlclNpZGVUb2tlbiwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbWJvSHR0cCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbWJvU2VydmVyU2lkZVRva2VuLCBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b0Jvb2xlYW4odmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIGAke3ZhbHVlfWAgIT09ICdmYWxzZSc7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0SXRlbShkYXRhOiBhbnksIGluZGV4PzogbnVtYmVyLCBlbWl0RXZlbnQgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgICAgICAgICBkYXRhLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChzID0+IHNbdGhpcy5pZEZpZWxkXSA9PT0gblt0aGlzLmlkRmllbGRdKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgocyA9PiBzW3RoaXMuaWRGaWVsZF0gPT09IGRhdGFbdGhpcy5pZEZpZWxkXSkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW1pdEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyQubmV4dCh7YWN0aW9uOiAnY2xpY2tlZCd9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RJdGVtKGRhdGE6IGFueSkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IHRoaXMuc2VsZWN0aW9ucy5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIC8vIHJldHVybiBpdGVtW3RoaXMuaWRGaWVsZF0gIT09IGRhdGFbdGhpcy5pZEZpZWxkXTtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGl0ZW0pICE9PSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2NsaWNrZWQnfSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHNlbGVjdEFsbChkYXRhcykge1xyXG4gICAgICAgIChkYXRhcyB8fCBbXSkuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGlvbnMuZmluZChpID0+IGlbdGhpcy5pZEZpZWxkXSA9PT0gblt0aGlzLmlkRmllbGRdKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2gobik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyB0aGlzLnNlbGVjdGlvbnMgPSBkYXRhcztcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2NsaWNrZWQnfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RBbGwoZGF0YXMpIHtcclxuICAgICAgICAvLyB0aGlzLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICBkYXRhcyA9IGRhdGFzIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9ICh0aGlzLnNlbGVjdGlvbnMgfHwgW10pLmZpbHRlcihuID0+IGRhdGFzLmZpbmRJbmRleChpID0+IGlbdGhpcy5pZEZpZWxkXSA9PT0gblt0aGlzLmlkRmllbGRdKSA9PT0gLTEgKTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2NsaWNrZWQnfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTZWxlY3QoaWQ6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMgJiYgdGhpcy5zZWxlY3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zLmZpbmQoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gPT09IGlkKSAhPT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZERhdGEoZGF0YTogYW55LCBzZWxlY3RWYWx1ZXMgPSAnJywgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHNlbGVjdFZhbHVlcyA9PT0gbnVsbCB8fCBzZWxlY3RWYWx1ZXMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0VmFsdWVzID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0VmFsdWVzID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdFZhbHVlcyA9ICcnICsgc2VsZWN0VmFsdWVzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB0aGlzLmRhdGEkLm5leHQoZGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWxzID0gWyhzZWxlY3RWYWx1ZXMgKyAnJyldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxzID0gKHNlbGVjdFZhbHVlcyArICcnKS5zcGxpdCh0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbXMgPSB2YWxzLm1hcCh2YWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhkYXRhLCB2YWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW1zID0gc2VsZWN0ZWRJdGVtcy5maWx0ZXIoZWwgPT4gZWwpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gc2VsZWN0ZWRJdGVtcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyQubmV4dCh7YWN0aW9uOiAnaW5pdERhdGEnfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpbHRlckRhdGFPblNlcnZlcihwYXJhbXMpIHtcclxuICAgICAgICB0aGlzLmdldERhdGEocGFyYW1zKS5zdWJzY3JpYmUociA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcclxuICAgICAgICAgICAgaWYgKHIgJiYgci5pdGVtcykge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLmRpc3BsYXlUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTE9PS1VQTElTVCc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9va1VwRGF0YVRhYmxlKHIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTE9PS1VQVFJFRUxJU1QnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZExvb2tVcERhdGFUcmVlKHIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhJC5uZXh0KFtdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWuouaIt+err+i/h+a7pFxyXG4gICAgZmlsdGVyRGF0YSh2YWw6IHN0cmluZywgZmllbGQ6IGFueSA9ICd0ZXh0Jykge1xyXG4gICAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQTElTVCcgfHwgdGhpcy5kaXNwbGF5VHlwZSA9PT0gJ0xJU1QnKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gdGhpcy5kYXRhLmZpbHRlcihpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHRoaXMuZ2V0VmFsdWVCeU9iaihmaWVsZCwgaXRlbSkpLmluZGV4T2YodmFsKSA+IC0xO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGFcclxuICAgICAgICAgICAgLy8gICAgID8gdGhpcy5kYXRhLmZpbHRlcihpdGVtID0+IHtcclxuICAgICAgICAgICAgLy8gICAgICAgICBpZiAodGhpcy5nZXRWYWx1ZUJ5T2JqKGZpbGVkLCBpdGVtKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHRoaXMuZ2V0VmFsdWVCeU9iaihmaWxlZCwgaXRlbSkpLmluZGV4T2YodmFsKSA+IC0xO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5kYXRhICYmIHRoaXMuZ2V0VmFsdWVCeU9iaihmaWxlZCwgaXRlbS5kYXRhKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHRoaXMuZ2V0VmFsdWVCeU9iaihmaWxlZCwgaXRlbS5kYXRhKSkuaW5kZXhPZih2YWwpID4gLTE7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyAgICAgfSlcclxuICAgICAgICAgICAgLy8gICAgIDogW107XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSQubmV4dChkYXRhKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEkLm5leHQodGhpcy5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldFNlbGVjdGlvbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNlbGVjdGlvbnMoKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmFsdWUocHJvcDogc3RyaW5nLCBzZWxlY3Rpb25zPzogYW55KTogc3RyaW5nIHtcclxuICAgICAgICBzZWxlY3Rpb25zID0gc2VsZWN0aW9ucyA/IHNlbGVjdGlvbnMgOiB0aGlzLnNlbGVjdGlvbnM7XHJcbiAgICAgICAgaWYgKHNlbGVjdGlvbnMgJiYgc2VsZWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgdG1wID0gc2VsZWN0aW9ucy5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZUJ5T2JqKHByb3AsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHRtcCAmJiAodG1wLmxlbmd0aCA+IDEgfHwgdG1wLmxlbmd0aCA9PT0gMCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0bXAuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdG1wWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICBnZXRWYWx1ZUJ5T2JqKGZpZWxkOiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCByZXN1bHRWYWwgPSAnJztcclxuICAgICAgICBpZiAoZmllbGQuaW5kZXhPZignLicpID09PSAtMSkge1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdFZhbCA9IGRhdGFbZmllbGRdO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCVjRXJyb3I6IFRoZSAlY1wiJHtmaWVsZH1cIiVjIGlzIG5vdCBpbiBgLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29sb3I6ICNiYjAwMDA7Zm9udC13ZWlnaHQ6IGJvbGQ7JywgJ2NvbG9yOiByZWQ7Zm9udC1zdHlsZTogaXRhbGljJywgJ2NvbG9yOiAjYmIwMDAwO2ZvbnQtd2VpZ2h0OiBib2xkOycsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0VmFsID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3VsdFZhbCA9IGZpZWxkLnNwbGl0KCcuJykucmVkdWNlKChvYmosIGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpba2V5XTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCVjRXJyb3I6IFRoZSAlY1wiJHtrZXl9XCIlYyBpcyBub3QgaW4gIGAsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2NvbG9yOiAjYmIwMDAwO2ZvbnQtd2VpZ2h0OiBib2xkJywgJ2NvbG9yOiByZWQ7Zm9udC1zdHlsZTogaXRhbGljJywgJ2NvbG9yOiAjYmIwMDAwO2ZvbnQtd2VpZ2h0OiBib2xkOycsIG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0VmFsO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXREYXRhKHBhcmFtczogYW55ID0ge30sIG1ldGhvZCA9ICdnZXQnLCBzZWxlY3RlZElkcyA9ICcnKSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmRpc3BsYXlUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ1RyZWVMaXN0JzpcclxuICAgICAgICAgICAgY2FzZSAnTElTVCc6IHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcy5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXREYXRhKHBhcmFtcywgbWV0aG9kKS5zdWJzY3JpYmUoZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdUcmVlTGlzdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YVRyZWUoZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YVRhYmxlKGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTdWNjZXNzJC5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdMT09LVVBMSVNUJzpcclxuICAgICAgICAgICAgY2FzZSAnTE9PS1VQVFJFRUxJU1QnOiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRMb29rdXBEYXRhKHBhcmFtcywgc2VsZWN0ZWRJZHMsICdnZXQnLCB0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5sb2FkU3VjY2VzcyQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsb2FkTG9va3VwRGF0YShwYXJhbXM6IGFueSwgc2VsZWN0ZWRJZHMsIG1ldGhvZCA9ICdnZXQnLCBpc1RyZWUgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgZW5hYmxlRnVsbFRyZWUsIGxvYWRUcmVlRGF0YVR5cGUgfSA9IHBhcmFtcztcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICBwYXJhbXMgPSB7IGN1c3RvbURhdGE6IGRhdGEgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnKSB7XHJcbiAgICAgICAgICAgIHBhcmFtcy5lbmFibGVGdWxsVHJlZSA9IGVuYWJsZUZ1bGxUcmVlO1xyXG4gICAgICAgICAgICBwYXJhbXMubG9hZFRyZWVEYXRhVHlwZSA9ICdsb2FkYWxsJzsgLy8gbG9hZFRyZWVEYXRhVHlwZTtcclxuICAgICAgICAgICAgcGFyYW1zLnNlYXJjaFZhbHVlID0gJ3tcImNhdGVnb3J5XCI6XCJhbGxcIn0nO1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVsb2FkY29uZmlnID0geyBlbmFibGVGdWxsVHJlZSwgbG9hZFRyZWVEYXRhVHlwZSB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXREYXRhKHBhcmFtcywgbWV0aG9kKS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoIChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTZWxlY3RlZEl0ZW1zKHNlbGVjdGVkSWRzKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXAoZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zZWxlY3RlZEl0ZW1zID0gaXNUcmVlID8gIGQuaXRlbXMubWFwKG4gPT4gbi5kYXRhKSA6IGQuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc2VsZWN0ZWRJdGVtcyA9IChzZWxlY3RlZElkcyArICcnKS5zcGxpdCh0aGlzLnNlcGFyYXRvcikubWFwKHZhbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUcmVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJlZU5vZGVUb0ZsYXREYXRhKGQsIHZhbCwgdGhpcy5pZEZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuZmluZChuID0+IG5bdGhpcy5pZEZpZWxkXSArICcnID09IHZhbCB8fCBuW3RoaXMudGV4dEZpZWxkXSA9PSB2YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YoZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1RyZWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRMb29rVXBEYXRhVHJlZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9va1VwRGF0YVRhYmxlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmxvYWRTdWNjZXNzJC5uZXh0KHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWxlY3RlZEl0ZW1zKHNlbElkcykge1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaFBhcmFtID0ge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogJ2ZhdicsIGZhdm9yaXRlSWRzOiAoJycgKyBzZWxJZHMpLnNwbGl0KHRoaXMuc2VwYXJhdG9yKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgcCA9IHtzZWFyY2hWYWx1ZTogSlNPTi5zdHJpbmdpZnkoc2VhcmNoUGFyYW0pLCAgZW5hYmxlRnVsbFRyZWU6IGZhbHNlLCBsb2FkVHJlZURhdGFUeXBlOiAnZGVmYXVsdCd9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldERhdGEocCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0YShwYXJhbXMgPSB7fSwgbWV0aG9kID0gJ2dldCcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGlmICh0aGlzLnVyaSkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5zaG93TG9hZGluZygpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21ib0h0dHApIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbWJvSHR0cC5jb250ZXh0ID0gdGhpcy5jb250ZXh0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tYm9IdHRwLmdldERhdGEodGhpcy51cmksIHBhcmFtcywgbWV0aG9kKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KG1ldGhvZCwgdGhpcy51cmksIHBhcmFtcykucGlwZShcclxuICAgICAgICAgICAgICAgICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZih0aGlzLmRhdGEpLnBpcGUoZGVsYXkoMTApKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihbXSkucGlwZShkZWxheSgxMCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxvYWREYXRhVGFibGUoZGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBbLi4uZGF0YV07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YSA/IGRhdGEucmV0dXJuVmFsdWUgOiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLmRhdGEsIHRoaXMuc2VsZWN0ZWRWYWx1ZXMsIChkYXRhQXJyLCB2YWwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFBcnIuZmluZChkID0+IGRbdGhpcy5pZEZpZWxkXSArICcnID09IHZhbCB8fCBkW3RoaXMudGV4dEZpZWxkXSA9PSB2YWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZERhdGFUcmVlKGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhID8gZGF0YS5yZXR1cm5WYWx1ZSA6IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvYWREYXRhKHRoaXMuZGF0YSwgdGhpcy5zZWxlY3RlZFZhbHVlcywgKGRhdGFBcnIsIHZhbCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZWFjaERhdGEoZGF0YUFyciwgdmFsLCB0aGlzLmlkRmllbGQpO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBlYWNoRGF0YShwYXJhbURhdGEsIHBhcmFtVmFsLCBpZEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcnRuRGF0YTogYW55ID0gJyc7XHJcbiAgICAgICAgICAgICAgICBwYXJhbURhdGEuZmluZChkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZC5kYXRhW2lkRmllbGRdID09IHBhcmFtVmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0bkRhdGEgPSBkLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5jaGlsZHJlbiAmJiBkLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydG5EYXRhID0gZWFjaERhdGEoZC5jaGlsZHJlbiwgcGFyYW1WYWwsIGlkRmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5EYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkTG9va1VwRGF0YVRhYmxlKHJlc0RhdGE6IGFueSwgc29ydGFibGUgPSBmYWxzZSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgcmVzRGF0YSA9PT0gJ29iamVjdCcpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNEYXRhLnJldHVyblZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXNEYXRhID0gcmVzRGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFzb3J0YWJsZSAmJiAgcmVzRGF0YS5jb2x1bW5zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbnMgPSByZXNEYXRhLmNvbHVtbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlc0RhdGEucGFnZUluZm8pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnZUluZm8gPSByZXNEYXRhLnBhZ2VJbmZvO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlSW5mby50b3RhbCA9IHJlc0RhdGEudG90YWwgPyByZXNEYXRhLnRvdGFsIDogMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCByZXNEYXRhLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSByZXNEYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzRGF0YS5zZWxlY3RlZEl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSByZXNEYXRhLnNlbGVjdGVkSXRlbXMgfHwgW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgaWRzID0gdGhpcy5zZWxlY3Rpb25zLm1hcChuID0+IG5bdGhpcy5pZEZpZWxkXSkuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgIGlmIChpZHMgIT09IHRoaXMuc2VsZWN0ZWRWYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSBpZHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubG9hZERhdGEodGhpcy5kYXRhLCB0aGlzLnNlbGVjdGVkVmFsdWVzLCAoZGF0YUFyciwgdmFsKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBpc01hcGVkID0gZGF0YUFyci5maW5kKGQgPT4gZFt0aGlzLmlkRmllbGRdICsgJycgPT0gdmFsKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgaXNNYXBlZCA9ICFpc01hcGVkID8gdGhpcy5zZWxlY3Rpb25zLmZpbmQoZCA9PiBkW3RoaXMuaWRGaWVsZF0gKyAnJyA9PSB2YWwpIDogaXNNYXBlZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gaXNNYXBlZDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrTm9kZUNhbkJlU2VsZWN0KG5vZGVzLCBhbGxEYXRhID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChub2RlcyAmJiBub2Rlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5vZGVzLm1hcCgobm9kZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNPd25Qcm9wZXJ0eSgnYWRkdGlvbmFsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnNlbGVjdGFibGUgPSAhbm9kZVsnYWRkdGlvbmFsJ107XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrTm9kZUNhbkJlU2VsZWN0KG5vZGUuY2hpbGRyZW4sIGFsbERhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWxsRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLmxlYWYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2RlcztcclxuICAgIH1cclxuXHJcbiAgICBsb2FkTG9va1VwRGF0YVRyZWUocmVzRGF0YTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZXNEYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChyZXNEYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gcmVzRGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAocmVzRGF0YS5yZXR1cm5WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmVzRGF0YSA9IHJlc0RhdGEucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jb2x1bW5zID0gcmVzRGF0YS5jb2x1bW5zO1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVJbmZvID0gcmVzRGF0YS50cmVlSW5mbztcclxuXHJcbiAgICAgICAgICAgIHRoaXMudHJlZUluZm8kLm5leHQodGhpcy50cmVlSW5mbyk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzRGF0YS5zZWxlY3RlZEl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSByZXNEYXRhLnNlbGVjdGVkSXRlbXMgfHwgW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMudHJlZUluZm8gJiYgIXRoaXMudHJlZUluZm9bJ3RyZWVEYXRhSXNJbml0J10pIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyZWVJbmZvLmxheWVyVHlwZS50b0xvd2VyQ2FzZSgpID09PSAncGF0aGNvZGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5sb29rdXBVdGlscy5tYWtlVHJlZShyZXNEYXRhLml0ZW1zLCB0aGlzLnRyZWVJbmZvKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5sb29rdXBVdGlscy5tYWtlVHJlZVdpdGhQYXJlbnRJRChcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzRGF0YS5pdGVtcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGAke3RoaXMudHJlZUluZm8uZGF0YUZpZWxkfS4ke3RoaXMudHJlZUluZm8ucGFyZW50RmllbGR9YCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pZEZpZWxkXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNEYXRhLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmRhdGEgPSByZXNEYXRhLml0ZW1zO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzTG9hZEFsbFRyZWVEYXRhID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyZWVsb2FkY29uZmlnLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPT09ICdhbGwnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRyZWVsb2FkY29uZmlnLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsb2FkYWxsJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QocmVzRGF0YS5pdGVtcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLmRhdGEsIHRoaXMuc2VsZWN0ZWRWYWx1ZXMsIChkYXRhQXJyLCB2YWwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJlZU5vZGVUb0ZsYXREYXRhKGRhdGFBcnIsIHZhbCwgdGhpcy5pZEZpZWxkKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0cmVlTm9kZVRvRmxhdERhdGEocGFyYW1EYXRhLCBwYXJhbVZhbCwgaWRGaWVsZCkge1xyXG4gICAgICAgIGxldCBydG5EYXRhOiBhbnkgPSAnJztcclxuICAgICAgICBwYXJhbURhdGEuZmluZChkID0+IHtcclxuICAgICAgICAgICAgaWYgKChkLmRhdGEgJiYgZC5kYXRhW2lkRmllbGRdID09IHBhcmFtVmFsKSB8fCBkW2lkRmllbGRdID09IHBhcmFtVmFsKSB7XHJcbiAgICAgICAgICAgICAgICBydG5EYXRhID0gZC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5jaGlsZHJlbiAmJiBkLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcnRuRGF0YSA9IHRoaXMudHJlZU5vZGVUb0ZsYXREYXRhKGQuY2hpbGRyZW4sIHBhcmFtVmFsLCBpZEZpZWxkKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5EYXRhID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJ0bkRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaG93TG9hZGluZygpIHtcclxuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coeyBjb250YWluZXI6IHRoaXMucGFuZWxFbGVtZW50LCBkZWxheTogMTAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlTG9hZGluZygpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=