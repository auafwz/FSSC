/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, ElementRef, Renderer2, ViewContainerRef, ComponentFactoryResolver } from '@angular/core';
import { TooltipComponent } from './tooltip-component/tooltip.component';
export class FarrisTooltipDirective {
    /**
     * @param {?} el
     * @param {?} render
     * @param {?} viewContainerRef
     * @param {?} resolver
     */
    constructor(el, render, viewContainerRef, resolver) {
        this.el = el;
        this.render = render;
        this.viewContainerRef = viewContainerRef;
        this.resolver = resolver;
        this.tooltipEnable = true;
        /* 提示文本 */
        this.text = '';
        // 提示框样式
        this.tipCls = '';
        // 提示框宽度
        this.tipWidth = '';
        /* 位置 */
        this.placement = 'top';
        this.triggerMode = 'hover';
        this.showTip = true;
        // 是否绑定了事件
        this.hasBindEvent = false;
        /* 生成提示组件 */
        this.componentFactory = this.resolver.resolveComponentFactory(TooltipComponent);
    }
    // 5月7日追加这种写法，控制禁用、启用
    // 原来的时候value是空字符串
    /**
     * @param {?} value
     * @return {?}
     */
    set enableTooltip(value) {
        if (typeof value == 'string' && value == '') {
            this.enableOrDisable(true);
        }
        else {
            this.enableOrDisable(value);
        }
    }
    /**
     * @return {?}
     */
    get enableTooltip() {
        return this.tooltipEnable;
    }
    /* 触发方式 */
    /**
     * @param {?} value
     * @return {?}
     */
    set trigger(value) {
        if (value) {
            if (value !== this.triggerMode) {
                this.triggerMode = value;
                this.unbindEvent();
                this.bindEvent();
            }
        }
    }
    /**
     * @return {?}
     */
    get trigger() {
        return this.triggerMode;
    }
    /* 禁用---跟其他控件的属性容易冲突，逐渐废弃。
      * 比如按钮可以设置禁用不触发点击，但想给出点击提示，这样就冲突了
      */
    /**
     * @param {?} value
     * @return {?}
     */
    set disable(value) {
        this.enableOrDisable(!value);
    }
    /**
     * @return {?}
     */
    get disable() {
        return !this.tooltipEnable;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.bindEvent();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.unbindEvent();
        this.removeTooltip();
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    enableOrDisable(value) {
        this.tooltipEnable = value;
        if (this.tooltipEnable) {
            this.bindEvent();
        }
        else {
            this.unbindEvent();
        }
    }
    /**
     * @return {?}
     */
    bindEvent() {
        if (!this.tooltipEnable) {
            return;
        }
        // 是否已绑定事件
        if (this.hasBindEvent) {
            return;
        }
        if (this.trigger === 'click') {
            // 鼠标点击
            this.clickEvent = this.render.listen(this.el.nativeElement, 'click', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                this.appendTooltip();
                this.clickOutEvent = this.render.listen(document, 'click', (/**
                 * @return {?}
                 */
                () => {
                    this.removeTooltip();
                    this.clickOutEvent();
                }));
            }));
        }
        else if (this.trigger === 'focus') {
            // 聚焦
            // @Todo 需要把input等组件和普通组件分开
            this.focusDownEvent = this.render.listen(this.el.nativeElement, 'mousedown', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.preventDefault();
                this.appendTooltip();
            }));
            this.focusUpEvent = this.render.listen(this.el.nativeElement, 'mouseup', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                this.removeTooltip();
            }));
        }
        else {
            // 鼠标移动上去
            this.mouseenterEvent = this.render.listen(this.el.nativeElement, 'mouseenter', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                this.appendTooltip();
            }));
            this.mouseleaveEvent = this.render.listen(this.el.nativeElement, 'mouseleave', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                this.removeTooltip();
            }));
        }
        this.hasBindEvent = true;
    }
    /* 解绑事件 */
    /**
     * @return {?}
     */
    unbindEvent() {
        // 鼠标移上去
        if (this.mouseenterEvent) {
            this.mouseenterEvent();
        }
        if (this.mouseleaveEvent) {
            this.mouseleaveEvent();
        }
        if (this.clickEvent) {
            this.clickEvent();
        }
        if (this.clickOutEvent) {
            this.clickOutEvent();
        }
        if (this.focusDownEvent) {
            this.focusDownEvent();
        }
        if (this.focusUpEvent) {
            this.focusUpEvent();
        }
        this.hasBindEvent = false;
    }
    /* body  移除tooltip */
    /**
     * @return {?}
     */
    removeTooltip() {
        if (this.tooltip) {
            this.render.removeChild(document.body, this.tooltip.el.nativeElement);
            this._componentRef.changeDetectorRef.markForCheck();
            this._componentRef.changeDetectorRef.detectChanges();
            this._componentRef.destroy();
            this.viewContainerRef.clear();
            this.tooltip = null;
            this._componentRef = null;
        }
    }
    /**
     * @private
     * @return {?}
     */
    appendTooltip() {
        if (!this.showTip)
            return;
        this.generateTooltip();
        this.updateViewProps(this.placement, this.content, this.el.nativeElement.getBoundingClientRect());
    }
    /* 更新tooltip组件属性 */
    /**
     * @private
     * @param {?} placement
     * @param {?} content
     * @param {?} hostBoundingClientRect
     * @return {?}
     */
    updateViewProps(placement, content, hostBoundingClientRect) {
        this.tooltip.placement = placement;
        this.tooltip.content = content;
        this.tooltip.hostBoundingClientRect = hostBoundingClientRect;
        this.tooltip.tipCls = this.tipCls;
        this.tooltip.tipWidth = this.tipWidth;
        this._componentRef.changeDetectorRef.markForCheck();
        this._componentRef.changeDetectorRef.detectChanges();
    }
    /* 构造tooltip结构 */
    /**
     * @private
     * @return {?}
     */
    generateTooltip() {
        this._componentRef = this.viewContainerRef.createComponent(this.componentFactory);
        this.tooltip = this._componentRef.instance;
        // 父元素中移除  添加到body中
        this.render.removeChild(this.render.parentNode(this.el.nativeElement), this.tooltip.el.nativeElement);
        this.render.appendChild(document.body, this.tooltip.el.nativeElement);
    }
}
FarrisTooltipDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farrisTooltip]'
            },] }
];
/** @nocollapse */
FarrisTooltipDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ViewContainerRef },
    { type: ComponentFactoryResolver }
];
FarrisTooltipDirective.propDecorators = {
    enableTooltip: [{ type: Input, args: ['farrisTooltip',] }],
    text: [{ type: Input }],
    tipCls: [{ type: Input }],
    tipWidth: [{ type: Input }],
    placement: [{ type: Input }],
    trigger: [{ type: Input }],
    disable: [{ type: Input }],
    showTip: [{ type: Input }],
    content: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.tooltipEnable;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype._componentRef;
    /** @type {?} */
    FarrisTooltipDirective.prototype.text;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tipCls;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tipWidth;
    /** @type {?} */
    FarrisTooltipDirective.prototype.placement;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.triggerMode;
    /** @type {?} */
    FarrisTooltipDirective.prototype.showTip;
    /** @type {?} */
    FarrisTooltipDirective.prototype.content;
    /** @type {?} */
    FarrisTooltipDirective.prototype.mouseenterEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.mouseleaveEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.clickEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.clickOutEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.focusDownEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.focusUpEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.docBody;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.hasBindEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.componentFactory;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tooltipRef;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tooltip;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXRvb2x0aXAvIiwic291cmNlcyI6WyJsaWIvdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDRyxTQUFTLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBaUIsU0FBUyxFQUM1QyxnQkFBZ0IsRUFBRSx3QkFBd0IsRUFDN0QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFJekUsTUFBTSxPQUFPLHNCQUFzQjs7Ozs7OztJQXlFakMsWUFDVSxFQUFjLEVBQ2QsTUFBaUIsRUFDakIsZ0JBQWtDLEVBQ2xDLFFBQWtDO1FBSGxDLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUE1RXBDLGtCQUFhLEdBQVksSUFBSSxDQUFDOztRQWdCN0IsU0FBSSxHQUFHLEVBQUUsQ0FBQzs7UUFFVixXQUFNLEdBQUMsRUFBRSxDQUFDOztRQUVWLGFBQVEsR0FBQyxFQUFFLENBQUM7O1FBRVosY0FBUyxHQUFHLEtBQUssQ0FBQztRQUVuQixnQkFBVyxHQUFHLE9BQU8sQ0FBQztRQTJCckIsWUFBTyxHQUFZLElBQUksQ0FBQzs7UUFjekIsaUJBQVksR0FBRyxLQUFLLENBQUM7O1FBRzdCLHFCQUFnQixHQUF1QyxJQUFJLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFTM0csQ0FBQzs7Ozs7OztJQXpFTCxJQUNJLGFBQWEsQ0FBQyxLQUFVO1FBQzFCLElBQUksT0FBTyxLQUFLLElBQUUsUUFBUSxJQUFFLEtBQUssSUFBSSxFQUFFLEVBQUU7WUFDdkMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENB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S0FBSzt1QkFFTCxLQUFLO3dCQUVMLEtBQUs7c0JBSUwsS0FBSztzQkFpQkwsS0FBSztzQkFRTCxLQUFLO3NCQUlMLEtBQUs7Ozs7Ozs7SUF2RE4sK0NBQXNDOzs7OztJQUN0QywrQ0FBc0Q7O0lBZXRELHNDQUFtQjs7SUFFbkIsd0NBQW1COztJQUVuQiwwQ0FBcUI7O0lBRXJCLDJDQUEyQjs7Ozs7SUFFM0IsNkNBQThCOztJQTJCOUIseUNBQWlDOztJQUlqQyx5Q0FBNEM7O0lBRTVDLGlEQUFxQjs7SUFDckIsaURBQXFCOztJQUNyQiw0Q0FBZ0I7O0lBQ2hCLCtDQUFtQjs7SUFDbkIsZ0RBQW9COztJQUNwQiw4Q0FBa0I7O0lBQ2xCLHlDQUFhOzs7OztJQUViLDhDQUE2Qjs7SUFHN0Isa0RBQStHOztJQUUvRyw0Q0FBZ0I7O0lBQ2hCLHlDQUEwQjs7Ozs7SUFFeEIsb0NBQXNCOzs7OztJQUN0Qix3Q0FBeUI7Ozs7O0lBQ3pCLGtEQUEwQzs7Ozs7SUFDMUMsMENBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBPbkluaXQsIERpcmVjdGl2ZSwgSW5wdXQsIEVsZW1lbnRSZWYsIEFmdGVyVmlld0luaXQsIFJlbmRlcmVyMiwgT25EZXN0cm95LCBUZW1wbGF0ZVJlZixcclxuICBDb21wb25lbnRGYWN0b3J5LCBWaWV3Q29udGFpbmVyUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE5nWm9uZSwgQ29tcG9uZW50UmVmXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRvb2x0aXBDb21wb25lbnQgfSBmcm9tICcuL3Rvb2x0aXAtY29tcG9uZW50L3Rvb2x0aXAuY29tcG9uZW50JztcclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzVG9vbHRpcF0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNUb29sdGlwRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gIHByaXZhdGUgdG9vbHRpcEVuYWJsZTogYm9vbGVhbiA9IHRydWU7XHJcbiAgcHJpdmF0ZSBfY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8VG9vbHRpcENvbXBvbmVudD47XHJcbiAgLy8gNeaciDfml6Xov73liqDov5nnp43lhpnms5XvvIzmjqfliLbnpoHnlKjjgIHlkK/nlKhcclxuICAvLyDljp/mnaXnmoTml7blgJl2YWx1ZeaYr+epuuWtl+espuS4slxyXG4gIEBJbnB1dCgnZmFycmlzVG9vbHRpcCcpXHJcbiAgc2V0IGVuYWJsZVRvb2x0aXAodmFsdWU6IGFueSkge1xyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZT09J3N0cmluZycmJnZhbHVlID09ICcnKSB7XHJcbiAgICAgIHRoaXMuZW5hYmxlT3JEaXNhYmxlKHRydWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5lbmFibGVPckRpc2FibGUodmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICBnZXQgZW5hYmxlVG9vbHRpcCgpIHtcclxuICAgIHJldHVybiB0aGlzLnRvb2x0aXBFbmFibGU7XHJcbiAgfVxyXG4gIC8qIOaPkOekuuaWh+acrCAqL1xyXG4gIEBJbnB1dCgpIHRleHQgPSAnJztcclxuICAvLyDmj5DnpLrmoYbmoLflvI9cclxuICBASW5wdXQoKSB0aXBDbHM9Jyc7XHJcbiAgLy8g5o+Q56S65qGG5a695bqmXHJcbiAgQElucHV0KCkgdGlwV2lkdGg9Jyc7XHJcbiAgLyog5L2N572uICovXHJcbiAgQElucHV0KCkgcGxhY2VtZW50ID0gJ3RvcCc7XHJcblxyXG4gIHByaXZhdGUgdHJpZ2dlck1vZGUgPSAnaG92ZXInO1xyXG4gIC8qIOinpuWPkeaWueW8jyAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHRyaWdnZXIodmFsdWUpIHtcclxuICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICBpZiAodmFsdWUgIT09IHRoaXMudHJpZ2dlck1vZGUpIHtcclxuICAgICAgICB0aGlzLnRyaWdnZXJNb2RlID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy51bmJpbmRFdmVudCgpO1xyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgZ2V0IHRyaWdnZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyTW9kZTtcclxuICB9XHJcblxyXG4gIC8qIOemgeeUqC0tLei3n+WFtuS7luaOp+S7tueahOWxnuaAp+WuueaYk+WGsueqge+8jOmAkOa4kOW6n+W8g+OAglxyXG4gICog5q+U5aaC5oyJ6ZKu5Y+v5Lul6K6+572u56aB55So5LiN6Kem5Y+R54K55Ye777yM5L2G5oOz57uZ5Ye654K55Ye75o+Q56S677yM6L+Z5qC35bCx5Yay56qB5LqGXHJcbiAgKi9cclxuICBASW5wdXQoKVxyXG4gIHNldCBkaXNhYmxlKHZhbHVlKSB7XHJcbiAgICB0aGlzLmVuYWJsZU9yRGlzYWJsZSghdmFsdWUpO1xyXG4gIH1cclxuICBnZXQgZGlzYWJsZSgpIHtcclxuICAgIHJldHVybiAhdGhpcy50b29sdGlwRW5hYmxlO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KCkgc2hvd1RpcDogYm9vbGVhbiA9IHRydWU7XHJcblxyXG5cclxuICAvKiDlhoXlrrnmqKHmnb8gKi9cclxuICBASW5wdXQoKSBjb250ZW50OiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICBtb3VzZWVudGVyRXZlbnQ6IGFueTtcclxuICBtb3VzZWxlYXZlRXZlbnQ6IGFueTtcclxuICBjbGlja0V2ZW50OiBhbnk7XHJcbiAgY2xpY2tPdXRFdmVudDogYW55O1xyXG4gIGZvY3VzRG93bkV2ZW50OiBhbnk7XHJcbiAgZm9jdXNVcEV2ZW50OiBhbnk7XHJcbiAgZG9jQm9keTogYW55O1xyXG4gIC8vIOaYr+WQpue7keWumuS6huS6i+S7tlxyXG4gIHByaXZhdGUgaGFzQmluZEV2ZW50ID0gZmFsc2U7XHJcblxyXG4gIC8qIOeUn+aIkOaPkOekuue7hOS7tiAqL1xyXG4gIGNvbXBvbmVudEZhY3Rvcnk6IENvbXBvbmVudEZhY3Rvcnk8VG9vbHRpcENvbXBvbmVudD4gPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFRvb2x0aXBDb21wb25lbnQpO1xyXG5cclxuICB0b29sdGlwUmVmOiBhbnk7XHJcbiAgdG9vbHRpcDogVG9vbHRpcENvbXBvbmVudDtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgcHJpdmF0ZSB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmJpbmRFdmVudCgpO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG5cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy51bmJpbmRFdmVudCgpO1xyXG4gICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZW5hYmxlT3JEaXNhYmxlKHZhbHVlKSB7XHJcbiAgICB0aGlzLnRvb2x0aXBFbmFibGUgPSB2YWx1ZTtcclxuICAgIGlmICh0aGlzLnRvb2x0aXBFbmFibGUpIHtcclxuICAgICAgdGhpcy5iaW5kRXZlbnQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudW5iaW5kRXZlbnQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGJpbmRFdmVudCgpIHtcclxuICAgIGlmICghdGhpcy50b29sdGlwRW5hYmxlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOaYr+WQpuW3sue7keWumuS6i+S7tlxyXG4gICAgaWYgKHRoaXMuaGFzQmluZEV2ZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnRyaWdnZXIgPT09ICdjbGljaycpIHtcclxuICAgICAgLy8g6byg5qCH54K55Ye7XHJcbiAgICAgIHRoaXMuY2xpY2tFdmVudCA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdjbGljaycsIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmFwcGVuZFRvb2x0aXAoKTtcclxuICAgICAgICB0aGlzLmNsaWNrT3V0RXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4oZG9jdW1lbnQsICdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlVG9vbHRpcCgpO1xyXG4gICAgICAgICAgdGhpcy5jbGlja091dEV2ZW50KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLnRyaWdnZXIgPT09ICdmb2N1cycpIHtcclxuICAgICAgLy8g6IGa54SmXHJcbiAgICAgIC8vIEBUb2RvIOmcgOimgeaKimlucHV0562J57uE5Lu25ZKM5pmu6YCa57uE5Lu25YiG5byAXHJcbiAgICAgIHRoaXMuZm9jdXNEb3duRXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJywgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdGhpcy5hcHBlbmRUb29sdGlwKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLmZvY3VzVXBFdmVudCA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZXVwJywgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMucmVtb3ZlVG9vbHRpcCgpO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOm8oOagh+enu+WKqOS4iuWOu1xyXG4gICAgICB0aGlzLm1vdXNlZW50ZXJFdmVudCA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJywgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMuYXBwZW5kVG9vbHRpcCgpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5tb3VzZWxlYXZlRXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2VsZWF2ZScsIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLnJlbW92ZVRvb2x0aXAoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmhhc0JpbmRFdmVudCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKiDop6Pnu5Hkuovku7YgKi9cclxuICB1bmJpbmRFdmVudCgpIHtcclxuICAgIC8vIOm8oOagh+enu+S4iuWOu1xyXG4gICAgaWYgKHRoaXMubW91c2VlbnRlckV2ZW50KSB7XHJcbiAgICAgIHRoaXMubW91c2VlbnRlckV2ZW50KCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5tb3VzZWxlYXZlRXZlbnQpIHtcclxuICAgICAgdGhpcy5tb3VzZWxlYXZlRXZlbnQoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmNsaWNrRXZlbnQpIHtcclxuICAgICAgdGhpcy5jbGlja0V2ZW50KCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5jbGlja091dEV2ZW50KSB7XHJcbiAgICAgIHRoaXMuY2xpY2tPdXRFdmVudCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZm9jdXNEb3duRXZlbnQpIHtcclxuICAgICAgdGhpcy5mb2N1c0Rvd25FdmVudCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZm9jdXNVcEV2ZW50KSB7XHJcbiAgICAgIHRoaXMuZm9jdXNVcEV2ZW50KCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmhhc0JpbmRFdmVudCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyogYm9keSAg56e76ZmkdG9vbHRpcCAqL1xyXG4gIHJlbW92ZVRvb2x0aXAoKSB7XHJcbiAgICBpZiAodGhpcy50b29sdGlwKSB7XHJcbiAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNoaWxkKGRvY3VtZW50LmJvZHksIHRoaXMudG9vbHRpcC5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgdGhpcy5fY29tcG9uZW50UmVmLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICB0aGlzLl9jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpOyAgICAgIFxyXG4gICAgICB0aGlzLl9jb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICB0aGlzLnZpZXdDb250YWluZXJSZWYuY2xlYXIoKTtcclxuICAgICAgdGhpcy50b29sdGlwID0gbnVsbDtcclxuICAgICAgdGhpcy5fY29tcG9uZW50UmVmPW51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFwcGVuZFRvb2x0aXAoKSB7XHJcbiAgICBpZiAoIXRoaXMuc2hvd1RpcCkgcmV0dXJuO1xyXG4gICAgdGhpcy5nZW5lcmF0ZVRvb2x0aXAoKTtcclxuICAgIHRoaXMudXBkYXRlVmlld1Byb3BzKHRoaXMucGxhY2VtZW50LCB0aGlzLmNvbnRlbnQsIHRoaXMuZWwubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7XHJcbiAgfVxyXG5cclxuICAvKiDmm7TmlrB0b29sdGlw57uE5Lu25bGe5oCnICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVWaWV3UHJvcHMocGxhY2VtZW50OiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyB8IFRlbXBsYXRlUmVmPGFueT4sIGhvc3RCb3VuZGluZ0NsaWVudFJlY3Q6IG9iamVjdCkge1xyXG4gICAgdGhpcy50b29sdGlwLnBsYWNlbWVudCA9IHBsYWNlbWVudDtcclxuICAgIHRoaXMudG9vbHRpcC5jb250ZW50ID0gY29udGVudDtcclxuICAgIHRoaXMudG9vbHRpcC5ob3N0Qm91bmRpbmdDbGllbnRSZWN0ID0gaG9zdEJvdW5kaW5nQ2xpZW50UmVjdDtcclxuICAgIHRoaXMudG9vbHRpcC50aXBDbHM9dGhpcy50aXBDbHM7XHJcbiAgICB0aGlzLnRvb2x0aXAudGlwV2lkdGg9dGhpcy50aXBXaWR0aDtcclxuICAgIHRoaXMuX2NvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcclxuICAgIHRoaXMuX2NvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxuICAvKiDmnoTpgKB0b29sdGlw57uT5p6EICovXHJcbiAgcHJpdmF0ZSBnZW5lcmF0ZVRvb2x0aXAoKSB7ICAgIFxyXG4gICAgdGhpcy5fY29tcG9uZW50UmVmPXRoaXMudmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQodGhpcy5jb21wb25lbnRGYWN0b3J5KVxyXG4gICAgdGhpcy50b29sdGlwID0gIHRoaXMuX2NvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgIC8vIOeItuWFg+e0oOS4reenu+mZpCAg5re75Yqg5YiwYm9keeS4rVxyXG4gICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2hpbGQodGhpcy5yZW5kZXIucGFyZW50Tm9kZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpLCB0aGlzLnRvb2x0aXAuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChkb2N1bWVudC5ib2R5LCB0aGlzLnRvb2x0aXAuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==