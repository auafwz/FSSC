/*
 * @Author: Witt
 * @Date: 2018-10-12 15:37:11
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2019-09-03 19:10:44
 * @todo 待优化问题
 * 1、apiUrl是否应该在基类中，子类中的api如何传递给基类；
 */
import { Injectable } from '@angular/core';
import { DataTypeInfo } from '../core/index';
import { MetadataUtil } from '../metadata/index';
import { createEntity, createEntities } from '../entity/index';
import { EntityCollection } from './entity_collection';
import { PaginationManager } from './pagination_manager';
import { DataChangeHistory } from './data_change_history';
import { SortConditionManager } from './sort_condition_manager';
import { FilterConditionManager } from './filter_condition_manager';
import { UID } from '../misc/uid';
/**
 * 本地仓库
 * @description
 * # Repository
 *
 * Repository负责与后台接口交互并将接口返回的数据转换为Entity集合进行保存。因此Repository有两个重要的职责：后端交互、数据存储。
 * Repository中存储的数据是Entity类型，可以通过API对数据进行修改或删除。由于Repository和BindingData相互监听，对数据仓库的操作最终会通过BindingData更新到界面上。
 *
 * ## 实体操作
 * 实体操作仅对Repository本地已经存在的数据进行操作，不会发送请求。
 *
 * - 通过主键获取实体
 *
 *   ```javascript
 *    this.repository.entityCollection.getEntityById("id");
 *   ```
 *
 * - 删除实体数据
 *
 *   ```javascript
 *   this.repository.entityCollection.removeEntityById("id")
 *   ```
 *
 * - 清空所有实体
 *
 *   ```javascript
 *   this.repository.entityCollection.clear();
 *   ```
 *
 * - 将实体数据转换为json格式
 *
 *   ```javascript
 *   this.repository.entityCollection.toJSON();
 *   ```
 *
 * - 添加实体
 *
 *   ```javascript
 *   this.repository.entityCollection.addEntity(entity:T);
 *   ```
 * - 添加子表实体
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   entityManager.appendEntityByPath("/主实体Id/子表名s",{子表JSON数据});
 *   ```
 * - 批量添加实体
 *
 *   ```javascript
 *   this.repository.entityCollection.addEntities(entities:T[])
 *   ```
 *
 * - 批量添加子表实体
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   const childrenEntities = entityManager.createEntitiesByPath(["主实体Id","子表名s"], entityListData: any[])
 *   entityManager.appendEntitiesByPath(["主实体Id","子表名s"],childrenEntities);
 *   ```
 *
 * - 批量加载实体
 *
 *   ```javascript
 *   this.repository.entityCollection.loadEntities(entities:T[]);
 *   ```
 *
 *   > 加载实体会将本地仓库数据置为加载的实体。
 *
 * - 创建实体
 *
 *   ```javascript
 *   this.repository.buildEntity(JSON数据);
 *   ```
 *
 * - 批量创建实体
 *
 *   ```javascript
 *   this.repository.buildEntities(JSON数据);
 *   ```
 *
 * - 获取子表数据
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   entityManager.getEntityByPath(["主实体Id","子表名","子表id"]);
 *   ```
 *
 *   !> **注意** entityManager属性仅存在于BefRepository类，因此在使用EntityManager时应先将Repository转换为BefRepository
 *
 * - 获取所有子表数据
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   entityManager.getEntitiesByPath(["主实体Id","子表名"]);
 *   ```
 *
 *   > EntityManager不仅可以获取子表数据，同样可以获取主表数据。
 *   >
 *   > ```javascript
 *   > entityManager.getEntitiesByPath(["主实体Id"]);
 *   > ```
 *
 * - 获取实体属性值
 *
 *   ```javascript
 *   const entity = this.repository.entityCollection.getEntityById("id");
 *   cosnt name = entity['name'];
 *   // 或者
 *   const entity: any = this.repository.entityCollection.getEntityById("id");
 *   cosnt name = entity.name;
 *   ```
 *
 * ## 后端交互
 *
 * ​	通过接口操作后端数据，会直接对数据产生影响。
 *
 * - 更新实体数据
 *
 *   ```javascript
 *   this.repository.updateById('id');
 *   ```
 *
 * - 删除实体
 *
 *   ```javascript
 *   this.repository.removeById("id");
 *   ```
 *
 * - 批量删除实体
 *
 *   ```javascript
 *   this.repository.removeByIds(ids:string[])
 *   ```
 *
 * - 删除下级表数据
 *
 *   ```javascript
 *   this.repository.removeByPath(['主表Id','子表名','子表Id'])
 *   ```
 *
 * - 新增主实体
 *
 *   ```javascript
 *   this.repository.append();
 *   ```
 *
 * - 新增子实体
 *
 *   ```javascript
 *   this.repository.appendByPath(['主表id','子表名']);
 *   ```
 *
 * - 加载实体数据
 *
 *   ```javascript
 *   this.repository.getById('id');
 *   ```
 *
 * - 获取主表数据
 *
 *   ```javascript
 *   this.repository.getEntities(filter: any[], sorts: any[], pageSize: number | null, pageIndex: number | null)
 *
 *   ```
 *
 *   > pageSize、pageIndex可以不传。
 *
 * - 获取主表数据（POST方法）
 *
 *   ```javascript
 *   this.repository.filter(filter: any[], sorts: any[], pageSize: number | null, pageIndex: number | null)
 *   ```
 *
 * - 提交指定实体变更到后端
 *
 *   ```javascript
 *   this.repository.updateChangesById("id");
 *   ```
 *
 * - 提交所有变更
 *
 *   ```javascript
 *   this.repository.updateAllChanges();
 *   ```
 *
 * - 应用变更（保存）
 *
 *   ```javascript
 *   this.repository.applyChanges();
 *   ```
 *
 * - 取消变更
 *
 *   ```javascript
 *   this.repository.cancelChanges();
 *   ```
 *
 * - 清除Repository所有变更
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   befRepository.entityManager.clearAllEntityChanges();
 *   ```
 *
 * - 批量新增子表数据
 *   ```javascript
 *   this.repository.batchAppendByPath(path: string, defaultValues: Array<any>);
 *   ```
 *
 *   > path `string`：/主表id/从表前端nodeCode，如果/1/orders
 *   >
 *   > defaultValues `Array<any>`：新增从表时的默认值，数组，元素为对象，key为字段名，value为默认值。
 *
 * - 批量删除子表数据
 *
 *   ```javascript
 *   this.repository.batchRemoveByPath(path: string, ids: string);
 *   ```
 *
 *   > path `string`： /主表id/从表前端nodeCode，如果/1/orders
 *   >
 *   > ids `string` ：要删除的子表数据id，格式为`id1,id2,id3`
 */
export class Repository {
    // #endregion
    /**
     * 构造函数
     */
    constructor() {
        /**
         * 用户分页配置信息
         */
        this.paginationInfo = null;
        this.readMetadata();
        if (this.entityType) {
            this.entityTypeInfo = new DataTypeInfo(this.entityType);
            this.entityCollection = new EntityCollection(this.entityType);
        }
        this.dataChangeHistory = new DataChangeHistory();
        this.sortConditionManager = new SortConditionManager();
        this.filterConditionManager = new FilterConditionManager();
    }
    // #endregion
    // #region get/set方法
    /**
     * 实体主键
     */
    get primaryKey() {
        return this.entityCollection.primaryKey;
    }
    get changes() {
        return this.entityCollection.changes;
    }
    /**
     * 实体变更集合
     */
    get entityCollectionChange() {
        return this.entityCollection.collectionChanged;
    }
    /**
     * 获取名称
     */
    get name() {
        // 1、老表单没有name属性
        // 2、不能使用construcotr.name，压缩脚本会把name改掉，或者压缩成相同的名称（目前发现已知）
        if (!this.innerName) {
            const guid = UID.create();
            this.innerName = `Repository_${guid}`;
        }
        return this.innerName;
    }
    /**
     * 设置名称
     */
    set name(value) {
        this.innerName = value;
    }
    updateEntityType(entityType) {
        this.entityType = entityType;
        this.entityTypeInfo = new DataTypeInfo(this.entityType);
        this.entityCollection = new EntityCollection(this.entityType);
    }
    /**
     * 读取元数据
     */
    readMetadata() {
        const repositoryMetadata = MetadataUtil.getClassMetadataByName(this.constructor, 'NgRepository');
        if (repositoryMetadata) {
            // API地址
            this.apiUri = repositoryMetadata.apiUrl;
            // 实体类型
            this.entityType = repositoryMetadata.entityType;
        }
        // // API地址
        // this.apiUri = repositoryMetadata.apiUrl;
        // // 实体类型
        // this.entityType = repositoryMetadata.entityType;
    }
    /**
     * 初始化分页配置
     * @param config 用户分页配置
     */
    setPaginationConfig(config) {
        this.paginationManager = new PaginationManager(this.entityType, config);
        const { pageSize = 0 } = this.paginationManager.getPaginationConfigByPath('/') || {};
        // tslint:disable-next-line: max-line-length
        this.entityCollection.paginationInfo = Object.assign({ pageSize }, this.paginationManager.pagination, this.entityCollection.paginationInfo);
        // 无需再单独设置一次pageSize，减少一次变更
        // this.entityCollection.pageSize = pageSize;
    }
    /**
     * 重置状态
     */
    reset() {
        this.entityCollection.reset();
    }
    /**
     * 创建实体
     */
    buildEntity(data) {
        const entity = createEntity(this.entityType, data);
        return entity;
    }
    /**
     * 批量创建实体
     */
    buildEntities(listData) {
        const entities = createEntities(this.entityType, listData);
        return entities;
    }
}
Repository.decorators = [
    { type: Injectable }
];
/** @nocollapse */
Repository.ctorParameters = () => [];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL3JlcG9zaXRvcnkvcmVwb3NpdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztHQU9HO0FBRUgsT0FBTyxFQUFRLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUdqRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNqRCxPQUFPLEVBQVUsWUFBWSxFQUFFLGNBQWMsRUFBcUIsTUFBTSxpQkFBaUIsQ0FBQztBQUUxRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWxDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBa09HO0FBRUgsTUFBTSxPQUFnQixVQUFVO0lBZ0c5QixhQUFhO0lBRWI7O09BRUc7SUFDSDtRQWxFQTs7V0FFRztRQUNJ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QUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDNUksMkJBQTJCO1FBQzNCLDZDQUE2QztJQUMvQyxDQUFDO0lBQ0Q7O09BRUc7SUFDSSxLQUFLO1FBQ1YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7T0FFRztJQUNJLFdBQVcsQ0FBQyxJQUFTO1FBQzFCLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBSSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3RELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNJLGFBQWEsQ0FBQyxRQUFlO1FBQ2xDLE1BQU0sUUFBUSxHQUFRLGNBQWMsQ0FBSSxJQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ25FLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7OztZQTdLRixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjogV2l0dFxyXG4gKiBARGF0ZTogMjAxOC0xMC0xMiAxNTozNzoxMVxyXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE5LTA5LTAzIDE5OjEwOjQ0XHJcbiAqIEB0b2RvIOW+heS8mOWMlumXrumimFxyXG4gKiAx44CBYXBpVXJs5piv5ZCm5bqU6K+l5Zyo5Z+657G75Lit77yM5a2Q57G75Lit55qEYXBp5aaC5L2V5Lyg6YCS57uZ5Z+657G777ybXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgVHlwZSwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBEYXRhVHlwZUluZm8gfSBmcm9tICcuLi9jb3JlL2luZGV4JztcclxuaW1wb3J0IHsgTW9kaWZpY2F0aW9uIH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcclxuaW1wb3J0IHsgTWV0YWRhdGFVdGlsIH0gZnJvbSAnLi4vbWV0YWRhdGEvaW5kZXgnO1xyXG5pbXBvcnQgeyBFbnRpdHksIGNyZWF0ZUVudGl0eSwgY3JlYXRlRW50aXRpZXMsIEZpZWxkTWV0YWRhdGFVdGlsIH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcclxuaW1wb3J0IHsgTmdSZXBvc2l0b3J5IH0gZnJvbSAnLi9kZWNvcmF0b3JzJztcclxuaW1wb3J0IHsgRW50aXR5Q29sbGVjdGlvbiB9IGZyb20gJy4vZW50aXR5X2NvbGxlY3Rpb24nO1xyXG5pbXBvcnQgeyBQYWdpbmF0aW9uTWFuYWdlciB9IGZyb20gJy4vcGFnaW5hdGlvbl9tYW5hZ2VyJztcclxuaW1wb3J0IHsgRGF0YUNoYW5nZUhpc3RvcnkgfSBmcm9tICcuL2RhdGFfY2hhbmdlX2hpc3RvcnknO1xyXG5pbXBvcnQgeyBTb3J0Q29uZGl0aW9uTWFuYWdlciB9IGZyb20gJy4vc29ydF9jb25kaXRpb25fbWFuYWdlcic7XHJcbmltcG9ydCB7IEZpbHRlckNvbmRpdGlvbk1hbmFnZXIgfSBmcm9tICcuL2ZpbHRlcl9jb25kaXRpb25fbWFuYWdlcic7XHJcbmltcG9ydCB7IFVJRCB9IGZyb20gJy4uL21pc2MvdWlkJztcclxuXHJcbi8qKlxyXG4gKiDmnKzlnLDku5PlupNcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqICMgUmVwb3NpdG9yeVxyXG4gKiBcclxuICogUmVwb3NpdG9yeei0n+i0o+S4juWQjuWPsOaOpeWPo+S6pOS6kuW5tuWwhuaOpeWPo+i/lOWbnueahOaVsOaNrui9rOaNouS4ukVudGl0eembhuWQiOi/m+ihjOS/neWtmOOAguWboOatpFJlcG9zaXRvcnnmnInkuKTkuKrph43opoHnmoTogYzotKPvvJrlkI7nq6/kuqTkupLjgIHmlbDmja7lrZjlgqjjgIJcclxuICogUmVwb3NpdG9yeeS4reWtmOWCqOeahOaVsOaNruaYr0VudGl0eeexu+Wei++8jOWPr+S7pemAmui/h0FQSeWvueaVsOaNrui/m+ihjOS/ruaUueaIluWIoOmZpOOAgueUseS6jlJlcG9zaXRvcnnlkoxCaW5kaW5nRGF0YeebuOS6kuebkeWQrO+8jOWvueaVsOaNruS7k+W6k+eahOaTjeS9nOacgOe7iOS8mumAmui/h0JpbmRpbmdEYXRh5pu05paw5Yiw55WM6Z2i5LiK44CCXHJcbiAqIFxyXG4gKiAjIyDlrp7kvZPmk43kvZxcclxuICog5a6e5L2T5pON5L2c5LuF5a+5UmVwb3NpdG9yeeacrOWcsOW3sue7j+WtmOWcqOeahOaVsOaNrui/m+ihjOaTjeS9nO+8jOS4jeS8muWPkemAgeivt+axguOAglxyXG4gKiBcclxuICogLSDpgJrov4fkuLvplK7ojrflj5blrp7kvZNcclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKFwiaWRcIik7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOWIoOmZpOWunuS9k+aVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXR5QnlJZChcImlkXCIpXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOa4heepuuaJgOacieWunuS9k1xyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uY2xlYXIoKTtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g5bCG5a6e5L2T5pWw5o2u6L2s5o2i5Li6anNvbuagvOW8j1xyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udG9KU09OKCk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOa3u+WKoOWunuS9k1xyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXR5KGVudGl0eTpUKTtcclxuICogICBgYGBcclxuICogLSDmt7vliqDlrZDooajlrp7kvZNcclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGNvbnN0IGJlZlJlcG9zaXRvcnkgPSB0aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xyXG4gKiAgIGNvbnN0IGVudGl0eU1hbmFnZXIgPSBiZWZSZXBvc2l0b3J5LmVudGl0eU1hbmFnZXI7XHJcbiAqICAgZW50aXR5TWFuYWdlci5hcHBlbmRFbnRpdHlCeVBhdGgoXCIv5Li75a6e5L2TSWQv5a2Q6KGo5ZCNc1wiLHvlrZDooahKU09O5pWw5o2ufSk7XHJcbiAqICAgYGBgXHJcbiAqIC0g5om56YeP5re75Yqg5a6e5L2TXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdGllcyhlbnRpdGllczpUW10pXHJcbiAqICAgYGBgXHJcbiAqICAgXHJcbiAqIC0g5om56YeP5re75Yqg5a2Q6KGo5a6e5L2TXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBjb25zdCBiZWZSZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcclxuICogICBjb25zdCBlbnRpdHlNYW5hZ2VyID0gYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyO1xyXG4gKiAgIGNvbnN0IGNoaWxkcmVuRW50aXRpZXMgPSBlbnRpdHlNYW5hZ2VyLmNyZWF0ZUVudGl0aWVzQnlQYXRoKFtcIuS4u+WunuS9k0lkXCIsXCLlrZDooajlkI1zXCJdLCBlbnRpdHlMaXN0RGF0YTogYW55W10pXHJcbiAqICAgZW50aXR5TWFuYWdlci5hcHBlbmRFbnRpdGllc0J5UGF0aChbXCLkuLvlrp7kvZNJZFwiLFwi5a2Q6KGo5ZCNc1wiXSxjaGlsZHJlbkVudGl0aWVzKTtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g5om56YeP5Yqg6L295a6e5L2TXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoZW50aXRpZXM6VFtdKTtcclxuICogICBgYGBcclxuICogXHJcbiAqICAgPiDliqDovb3lrp7kvZPkvJrlsIbmnKzlnLDku5PlupPmlbDmja7nva7kuLrliqDovb3nmoTlrp7kvZPjgIJcclxuICogXHJcbiAqIC0g5Yib5bu65a6e5L2TXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkoSlNPTuaVsOaNrik7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOaJuemHj+WIm+W7uuWunuS9k1xyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXRpZXMoSlNPTuaVsOaNrik7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOiOt+WPluWtkOihqOaVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XHJcbiAqICAgY29uc3QgZW50aXR5TWFuYWdlciA9IGJlZlJlcG9zaXRvcnkuZW50aXR5TWFuYWdlcjtcclxuICogICBlbnRpdHlNYW5hZ2VyLmdldEVudGl0eUJ5UGF0aChbXCLkuLvlrp7kvZNJZFwiLFwi5a2Q6KGo5ZCNXCIsXCLlrZDooahpZFwiXSk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAgICE+ICoq5rOo5oSPKiogZW50aXR5TWFuYWdlcuWxnuaAp+S7heWtmOWcqOS6jkJlZlJlcG9zaXRvcnnnsbvvvIzlm6DmraTlnKjkvb/nlKhFbnRpdHlNYW5hZ2Vy5pe25bqU5YWI5bCGUmVwb3NpdG9yeei9rOaNouS4ukJlZlJlcG9zaXRvcnlcclxuICogXHJcbiAqIC0g6I635Y+W5omA5pyJ5a2Q6KGo5pWw5o2uXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBjb25zdCBiZWZSZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcclxuICogICBjb25zdCBlbnRpdHlNYW5hZ2VyID0gYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyO1xyXG4gKiAgIGVudGl0eU1hbmFnZXIuZ2V0RW50aXRpZXNCeVBhdGgoW1wi5Li75a6e5L2TSWRcIixcIuWtkOihqOWQjVwiXSk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAgID4gRW50aXR5TWFuYWdlcuS4jeS7heWPr+S7peiOt+WPluWtkOihqOaVsOaNru+8jOWQjOagt+WPr+S7peiOt+WPluS4u+ihqOaVsOaNruOAglxyXG4gKiAgID5cclxuICogICA+IGBgYGphdmFzY3JpcHRcclxuICogICA+IGVudGl0eU1hbmFnZXIuZ2V0RW50aXRpZXNCeVBhdGgoW1wi5Li75a6e5L2TSWRcIl0pO1xyXG4gKiAgID4gYGBgXHJcbiAqICAgXHJcbiAqIC0g6I635Y+W5a6e5L2T5bGe5oCn5YC8XHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKFwiaWRcIik7XHJcbiAqICAgY29zbnQgbmFtZSA9IGVudGl0eVsnbmFtZSddO1xyXG4gKiAgIC8vIOaIluiAhVxyXG4gKiAgIGNvbnN0IGVudGl0eTogYW55ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChcImlkXCIpO1xyXG4gKiAgIGNvc250IG5hbWUgPSBlbnRpdHkubmFtZTtcclxuICogICBgYGBcclxuICogXHJcbiAqICMjIOWQjuerr+S6pOS6klxyXG4gKiBcclxuICog4oCLXHTpgJrov4fmjqXlj6Pmk43kvZzlkI7nq6/mlbDmja7vvIzkvJrnm7TmjqXlr7nmlbDmja7kuqfnlJ/lvbHlk43jgIJcclxuICogXHJcbiAqIC0g5pu05paw5a6e5L2T5pWw5o2uXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkudXBkYXRlQnlJZCgnaWQnKTtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g5Yig6Zmk5a6e5L2TXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkucmVtb3ZlQnlJZChcImlkXCIpO1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDmibnph4/liKDpmaTlrp7kvZNcclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5yZW1vdmVCeUlkcyhpZHM6c3RyaW5nW10pXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOWIoOmZpOS4i+e6p+ihqOaVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LnJlbW92ZUJ5UGF0aChbJ+S4u+ihqElkJywn5a2Q6KGo5ZCNJywn5a2Q6KGoSWQnXSlcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g5paw5aKe5Li75a6e5L2TXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuYXBwZW5kKCk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOaWsOWinuWtkOWunuS9k1xyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmFwcGVuZEJ5UGF0aChbJ+S4u+ihqGlkJywn5a2Q6KGo5ZCNJ10pO1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDliqDovb3lrp7kvZPmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5nZXRCeUlkKCdpZCcpO1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDojrflj5bkuLvooajmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5nZXRFbnRpdGllcyhmaWx0ZXI6IGFueVtdLCBzb3J0czogYW55W10sIHBhZ2VTaXplOiBudW1iZXIgfCBudWxsLCBwYWdlSW5kZXg6IG51bWJlciB8IG51bGwpXHJcbiAqICAgXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAgID4gcGFnZVNpemXjgIFwYWdlSW5kZXjlj6/ku6XkuI3kvKDjgIJcclxuICogXHJcbiAqIC0g6I635Y+W5Li76KGo5pWw5o2u77yIUE9TVOaWueazle+8iVxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmZpbHRlcihmaWx0ZXI6IGFueVtdLCBzb3J0czogYW55W10sIHBhZ2VTaXplOiBudW1iZXIgfCBudWxsLCBwYWdlSW5kZXg6IG51bWJlciB8IG51bGwpXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOaPkOS6pOaMh+WumuWunuS9k+WPmOabtOWIsOWQjuerr1xyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZUNoYW5nZXNCeUlkKFwiaWRcIik7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOaPkOS6pOaJgOacieWPmOabtFxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZUFsbENoYW5nZXMoKTtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g5bqU55So5Y+Y5pu077yI5L+d5a2Y77yJXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuYXBwbHlDaGFuZ2VzKCk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOWPlua2iOWPmOabtFxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmNhbmNlbENoYW5nZXMoKTtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g5riF6ZmkUmVwb3NpdG9yeeaJgOacieWPmOabtFxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XHJcbiAqICAgYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyQWxsRW50aXR5Q2hhbmdlcygpO1xyXG4gKiAgIGBgYFxyXG4gKiAgIFxyXG4gKiAtIOaJuemHj+aWsOWinuWtkOihqOaVsOaNrlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuYmF0Y2hBcHBlbmRCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWVzOiBBcnJheTxhbnk+KTtcclxuICogICBgYGBcclxuICogICBcclxuICogICA+IHBhdGggYHN0cmluZ2DvvJov5Li76KGoaWQv5LuO6KGo5YmN56uvbm9kZUNvZGXvvIzlpoLmnpwvMS9vcmRlcnNcclxuICogICA+XHJcbiAqICAgPiBkZWZhdWx0VmFsdWVzIGBBcnJheTxhbnk+YO+8muaWsOWinuS7juihqOaXtueahOm7mOiupOWAvO+8jOaVsOe7hO+8jOWFg+e0oOS4uuWvueixoe+8jGtleeS4uuWtl+auteWQje+8jHZhbHVl5Li66buY6K6k5YC844CCXHJcbiAqICAgXHJcbiAqIC0g5om56YeP5Yig6Zmk5a2Q6KGo5pWw5o2uXHJcbiAqICAgXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5iYXRjaFJlbW92ZUJ5UGF0aChwYXRoOiBzdHJpbmcsIGlkczogc3RyaW5nKTtcclxuICogICBgYGBcclxuICogICBcclxuICogICA+IHBhdGggYHN0cmluZ2DvvJogL+S4u+ihqGlkL+S7juihqOWJjeerr25vZGVDb2Rl77yM5aaC5p6cLzEvb3JkZXJzXHJcbiAqICAgPlxyXG4gKiAgID4gaWRzIGBzdHJpbmdgIO+8muimgeWIoOmZpOeahOWtkOihqOaVsOaNrmlk77yM5qC85byP5Li6YGlkMSxpZDIsaWQzYFxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUmVwb3NpdG9yeTxUIGV4dGVuZHMgRW50aXR5PiB7XHJcblxyXG4gIC8vICNyZWdpb24g56eB5pyJ5bGe5oCnXHJcblxyXG4gIC8qKlxyXG4gICAqIOWQjeensFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJOYW1lOiBzdHJpbmc7XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiDlhazmnInlsZ7mgKfvvIjlhbHmnInlsZ7mgKfkuI3lupTor6Xnm7TmjqXmmrTpnLLvvIzlvoXljIXoo4XvvIlcclxuXHJcbiAgLyoqXHJcbiAgICogQVBJ5Zyw5Z2AXHJcbiAgICovXHJcbiAgcHVibGljIGFwaVVyaTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwdWJsaWMgZW50aXR5VHlwZTogYW55O1xyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T57G75Z6L5L+h5oGvXHJcbiAgICogQHRvZG/vvJrlrp7kvZPlsYLlupTor6XkuovlhYjkuIDkuKpFbnRpdHlUeXBlSW5mb++8jOW5tue7p+aJv0RhdGFUeXBlSW5mb+OAglxyXG4gICAqL1xyXG4gIHB1YmxpYyBlbnRpdHlUeXBlSW5mbzogRGF0YVR5cGVJbmZvO1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPpm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgZW50aXR5Q29sbGVjdGlvbjogRW50aXR5Q29sbGVjdGlvbjxUPjtcclxuXHJcbiAgLyoqXHJcbiAgICog55So5oi35YiG6aG16YWN572u5L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIHBhZ2luYXRpb25JbmZvOiBhbnkgPSBudWxsO1xyXG5cclxuICAvKipcclxuICAgKiDmlbDmja7lj5jmm7Tljoblj7LvvIjku4Xpkojlr7nkuLvooajlop7liqDjgIHlkITnp43ooajliKDpmaTvvIlcclxuICAgKi9cclxuICBwdWJsaWMgZGF0YUNoYW5nZUhpc3Rvcnk6IERhdGFDaGFuZ2VIaXN0b3J5O1xyXG5cclxuICAvKipcclxuICAgKiDmjpLluo/mnaHku7bnrqHnkIblmahcclxuICAgKi9cclxuICBwdWJsaWMgc29ydENvbmRpdGlvbk1hbmFnZXI6IFNvcnRDb25kaXRpb25NYW5hZ2VyO1xyXG4gIC8qKlxyXG4gICAqIOi/h+a7pOadoeS7tueuoeeQhuWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaWx0ZXJDb25kaXRpb25NYW5hZ2VyOiBGaWx0ZXJDb25kaXRpb25NYW5hZ2VyO1xyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiBnZXQvc2V05pa55rOVXHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S4u+mUrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeUtleSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5wcmltYXJ5S2V5O1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0IGNoYW5nZXMoKTogU3ViamVjdDxNb2RpZmljYXRpb24+IHtcclxuICAgIHJldHVybiB0aGlzLmVudGl0eUNvbGxlY3Rpb24uY2hhbmdlcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Y+Y5pu06ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlbnRpdHlDb2xsZWN0aW9uQ2hhbmdlKCk6IFN1YmplY3Q8TW9kaWZpY2F0aW9uPiB7XHJcbiAgICByZXR1cm4gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNvbGxlY3Rpb25DaGFuZ2VkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5ZCN56ewXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBuYW1lKCk6IHN0cmluZyB7XHJcblxyXG4gICAgLy8gMeOAgeiAgeihqOWNleayoeaciW5hbWXlsZ7mgKdcclxuICAgIC8vIDLjgIHkuI3og73kvb/nlKhjb25zdHJ1Y290ci5uYW1l77yM5Y6L57yp6ISa5pys5Lya5oqKbmFtZeaUueaOie+8jOaIluiAheWOi+e8qeaIkOebuOWQjOeahOWQjeensO+8iOebruWJjeWPkeeOsOW3suefpe+8iVxyXG4gICAgaWYgKCF0aGlzLmlubmVyTmFtZSkge1xyXG4gICAgICBjb25zdCBndWlkID0gVUlELmNyZWF0ZSgpO1xyXG4gICAgICB0aGlzLmlubmVyTmFtZSA9IGBSZXBvc2l0b3J5XyR7Z3VpZH1gO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmlubmVyTmFtZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5ZCN56ewXHJcbiAgICovXHJcbiAgcHVibGljIHNldCBuYW1lKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuaW5uZXJOYW1lID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcGFnaW5hdGlvbk1hbmFnZXI6IFBhZ2luYXRpb25NYW5hZ2VyPFQ+O1xyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5yZWFkTWV0YWRhdGEoKTtcclxuICAgIGlmICh0aGlzLmVudGl0eVR5cGUpIHtcclxuICAgICAgdGhpcy5lbnRpdHlUeXBlSW5mbyA9IG5ldyBEYXRhVHlwZUluZm8odGhpcy5lbnRpdHlUeXBlKTtcclxuICAgICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uID0gbmV3IEVudGl0eUNvbGxlY3Rpb248VD4odGhpcy5lbnRpdHlUeXBlKTtcclxuICAgIH1cclxuICAgIHRoaXMuZGF0YUNoYW5nZUhpc3RvcnkgPSBuZXcgRGF0YUNoYW5nZUhpc3RvcnkoKTtcclxuICAgIHRoaXMuc29ydENvbmRpdGlvbk1hbmFnZXIgPSBuZXcgU29ydENvbmRpdGlvbk1hbmFnZXIoKTtcclxuICAgIHRoaXMuZmlsdGVyQ29uZGl0aW9uTWFuYWdlciA9IG5ldyBGaWx0ZXJDb25kaXRpb25NYW5hZ2VyKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlRW50aXR5VHlwZShlbnRpdHlUeXBlOiBhbnkpIHtcclxuICAgIHRoaXMuZW50aXR5VHlwZSA9IGVudGl0eVR5cGU7XHJcbiAgICB0aGlzLmVudGl0eVR5cGVJbmZvID0gbmV3IERhdGFUeXBlSW5mbyh0aGlzLmVudGl0eVR5cGUpO1xyXG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uID0gbmV3IEVudGl0eUNvbGxlY3Rpb248VD4odGhpcy5lbnRpdHlUeXBlKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiDor7vlj5blhYPmlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIHJlYWRNZXRhZGF0YSgpIHtcclxuICAgIGNvbnN0IHJlcG9zaXRvcnlNZXRhZGF0YTogTmdSZXBvc2l0b3J5ID0gTWV0YWRhdGFVdGlsLmdldENsYXNzTWV0YWRhdGFCeU5hbWUodGhpcy5jb25zdHJ1Y3RvciwgJ05nUmVwb3NpdG9yeScpO1xyXG4gICAgaWYgKHJlcG9zaXRvcnlNZXRhZGF0YSkge1xyXG4gICAgICAvLyBBUEnlnLDlnYBcclxuICAgICAgdGhpcy5hcGlVcmkgPSByZXBvc2l0b3J5TWV0YWRhdGEuYXBpVXJsO1xyXG5cclxuICAgICAgLy8g5a6e5L2T57G75Z6LXHJcbiAgICAgIHRoaXMuZW50aXR5VHlwZSA9IHJlcG9zaXRvcnlNZXRhZGF0YS5lbnRpdHlUeXBlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIC8vIEFQSeWcsOWdgFxyXG4gICAgLy8gdGhpcy5hcGlVcmkgPSByZXBvc2l0b3J5TWV0YWRhdGEuYXBpVXJsO1xyXG5cclxuICAgIC8vIC8vIOWunuS9k+exu+Wei1xyXG4gICAgLy8gdGhpcy5lbnRpdHlUeXBlID0gcmVwb3NpdG9yeU1ldGFkYXRhLmVudGl0eVR5cGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJbliIbpobXphY3nva5cclxuICAgKiBAcGFyYW0gY29uZmlnIOeUqOaIt+WIhumhtemFjee9rlxyXG4gICAqL1xyXG4gIHNldFBhZ2luYXRpb25Db25maWcoY29uZmlnOiBhbnkpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvbk1hbmFnZXIgPSBuZXcgUGFnaW5hdGlvbk1hbmFnZXIodGhpcy5lbnRpdHlUeXBlLCBjb25maWcpO1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMucGFnaW5hdGlvbk1hbmFnZXIuZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aCgnLycpIHx8IHt9O1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcclxuICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oeyBwYWdlU2l6ZSB9LCB0aGlzLnBhZ2luYXRpb25NYW5hZ2VyLnBhZ2luYXRpb24sIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbyk7XHJcbiAgICAvLyDml6DpnIDlho3ljZXni6zorr7nva7kuIDmrKFwYWdlU2l6Ze+8jOWHj+WwkeS4gOasoeWPmOabtFxyXG4gICAgLy8gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnBhZ2VTaXplID0gcGFnZVNpemU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmHjee9rueKtuaAgVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkRW50aXR5KGRhdGE6IGFueSk6IFQge1xyXG4gICAgY29uc3QgZW50aXR5ID0gY3JlYXRlRW50aXR5PFQ+KHRoaXMuZW50aXR5VHlwZSwgZGF0YSk7XHJcbiAgICByZXR1cm4gZW50aXR5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yib5bu65a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkRW50aXRpZXMobGlzdERhdGE6IGFueVtdKTogVFtdIHtcclxuICAgIGNvbnN0IGVudGl0aWVzOiBUW10gPSBjcmVhdGVFbnRpdGllczxUPih0aGlzLmVudGl0eVR5cGUsIGxpc3REYXRhKTtcclxuICAgIHJldHVybiBlbnRpdGllcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWunuS9k+WIl+ihqFxyXG4gICAqIEBwYXJhbSBmaWx0ZXJzICAgIOi/h+a7pOadoeS7tlxyXG4gICAqIEBwYXJhbSBzb3J0cyAgICAgIOaOkuW6j+adoeS7tlxyXG4gICAqIEBwYXJhbSBwYWdpbmF0aW9uIOWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIGFic3RyYWN0IGdldEVudGl0aWVzKGZpbHRlcjogYW55W10sIHNvcnRzOiBhbnlbXSwgcGFnZVNpemU6IG51bWJlciB8IG51bGwsIHBhZ2VJbmRleDogbnVtYmVyIHwgbnVsbCk6IE9ic2VydmFibGU8VFtdPjtcclxuICAvKipcclxuICAgKiDojrflj5blrp7kvZPliJfooahcclxuICAgKiBAcGFyYW0gZmlsdGVyIOi/h+a7pOadoeS7tlxyXG4gICAqIEBwYXJhbSBzb3J0cyDmjpLluo/mnaHku7ZcclxuICAgKiBAcGFyYW0gcGFnZVNpemUg5YiG6aG15aSn5bCPXHJcbiAgICogQHBhcmFtIHBhZ2VJbmRleCDlvZPliY3liIbpobVcclxuICAgKi9cclxuICBhYnN0cmFjdCBmaWx0ZXIoZmlsdGVyPzogYW55W10sIHNvcnRzPzogYW55W10sIHBhZ2VTaXplPzogbnVtYmVyIHwgbnVsbCwgcGFnZUluZGV4PzogbnVtYmVyIHwgbnVsbCk6IE9ic2VydmFibGU8VFtdPjtcclxuICAvKipcclxuICAgKiDojrflj5blrp7kvZPliJfooahcclxuICAgKi9cclxuICBhYnN0cmFjdCBnZXRMaXN0KCk6IE9ic2VydmFibGU8VFtdPjtcclxuICAvKipcclxuICAgKiDmoLnmja5pZOiOt+WPluWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlrp7kvZPmoIfor4ZcclxuICAgKi9cclxuICBhYnN0cmFjdCBnZXRCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+O1xyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk6I635Y+W5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOS4u+WunuS9k2lkXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgZ2V0RW50aXR5QnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPjtcclxuICAvKipcclxuICAgKiDliIbpobXmn6Xor6Lku47ooagv5LuO5LuO6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIHBhdGgg57uR5a6a6Lev5b6EXHJcbiAgICogQHBhcmFtIGlkcyDnu5Hlrprot6/lvoTlr7nlupTnmoTkuLvplK5cclxuICAgKiBAcGFyYW0gZmlsdGVyIOi/h+a7pOadoeS7tlxyXG4gICAqIEBwYXJhbSBzb3J0IOaOkuW6j1xyXG4gICAqL1xyXG4gIGFic3RyYWN0IHF1ZXJ5Q2hpbGQocGF0aHM6IHN0cmluZ1tdLCBwYWdlSW5kZXg6IG51bWJlciwgcGFnZVNpemU6IG51bWJlciwgZmlsdGVyPzogc3RyaW5nLCBzb3J0Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUW10+O1xyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk5pu05paw5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOWunuS9k2lkXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgdXBkYXRlQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPjtcclxuICAvKipcclxuICAgKiDmm7TmlrDlrp7kvZPmlbDmja4o5a2Q6KGo5YiG6aG1KVxyXG4gICAqIEBwYXJhbSBpZCDlrp7kvZPkuLvplK5cclxuICAgKi9cclxuICBhYnN0cmFjdCB1cGRhdGVFbnRpdHlCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+O1xyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuaWsOWunuS9k++8jOWwhuivpeWunuS9k+WKoOi9veWIsOWIl+ihqFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGNyZWF0ZSgpOiBPYnNlcnZhYmxlPGFueT47XHJcblxyXG4gIC8vIC8qKlxyXG4gIC8vICAqIOWIm+W7uuWQjuS7o+WunuS9k++8jOWwhuivpeWunuS9k+WKoOi9veWIsOWQjuS7o+WIl+ihqO+8iOaaguaXoOivpeWcuuaZr++8iVxyXG4gIC8vICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxyXG4gIC8vICAqL1xyXG4gIC8vIGFic3RyYWN0IGNyZWF0ZUJ5UGF0aChwYXRoOiBzdHJpbmcpO1xyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rmlrDlrp7kvZPvvIzlubbov73liqDliLDlrp7kvZPliJfooahcclxuICAgKi9cclxuICBhYnN0cmFjdCBhcHBlbmQoKTogT2JzZXJ2YWJsZTxhbnk+O1xyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rmlrDnmoTlrZDlrp7kvZPvvIzlubbov73liqDliLDlrp7kvZPliJfooahcclxuICAgKiBAcGFyYW0gcGF0aCDlrp7kvZPot6/lvoRcclxuICAgKi9cclxuICBhYnN0cmFjdCBhcHBlbmRCeVBhdGgocGF0aDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOWGjeaMh+WumuS9jee9ruaPkuWFpeaVsOaNrlxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGluc2VydChwb3NpdGlvbjogMSB8IC0xLCBkZWZhdWx0VmFsdWU/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgLyoqXHJcbiAgICog5Zyo5oyH5a6a5a6e5L2T6Lev5b6E5o+S5YWl5a6e5L2TXHJcbiAgICogQHBhcmFtIHBhdGgg5a6e5L2T6Lev5b6EXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgaW5zZXJ0QnlQYXRoKHBhdGg6IHN0cmluZywgcG9zaXRpb246IDEgfCAtMSk6IE9ic2VydmFibGU8YW55PjtcclxuICAvKipcclxuICAgKiDmoLnmja5pZOWIoOmZpOWvueW6lOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlhoXnoIFcclxuICAgKi9cclxuICBhYnN0cmFjdCByZW1vdmVCeUlkKGlkOiBzdHJpbmcsIGlmU2F2ZT86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlkc+aJuemHj+WIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCBpZHNcclxuICAgKiBAcGFyYW0gaWZTYXZlIOaYr+WQpuS/neWtmFxyXG4gICAqIEBkZXByZWNhdGVkIOW3suW6n+W8g++8jOivpeaOpeWPo+S9v+eUqHF1ZXJ5c3RyaW5n5Lyg5Y+C77yM5a2Y5Zyo6LaF6ZW/6Zeu6aKY44CC6K+35L2/55SoYmF0Y2hSZW1vdmXmjqXlj6Pmm7/ku6PjgIJcclxuICAgKi9cclxuICBhYnN0cmFjdCByZW1vdmVCeUlkcyhpZHM6IHN0cmluZ1tdLCBpZlNhdmU/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOagueaNrmlkc+aJuemHj+WIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICogQHBhcmFtIGlmU2F2ZSDmmK/lkKbkv53lrZhcclxuICAgKi9cclxuICBhYnN0cmFjdCBiYXRjaFJlbW92ZShpZHM6IHN0cmluZ1tdLCBpZlNhdmU/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk5Yig6ZmkcGF0aOWvueW6lOeahOWQjuS7o+WunuS9k1xyXG4gICAqL1xyXG4gIGFic3RyYWN0IHJlbW92ZUJ5UGF0aChwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpO1xyXG5cclxuICAvKipcclxuICAgKiDmj5DkuqRpZOWvueW6lOeahOagueWunuS9k+WPmOabtFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IHVwZGF0ZUNoYW5nZXNCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG5cclxuICAvKipcclxuICAgKiDmj5DkuqRwYXRo5a+55bqU55qE5a6e5L2T5Y+Y5pu0XHJcbiAgICovXHJcbiAgYWJzdHJhY3QgdXBkYXRlQ2hhbmdlc0J5UGF0aChwYXRoOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG5cclxuICAvKipcclxuICAgKiDmm7TmlrDmiYDmnInlj5jmm7RcclxuICAgKi9cclxuICBhYnN0cmFjdCB1cGRhdGVBbGxDaGFuZ2VzKCk6IE9ic2VydmFibGU8Ym9vbGVhbj47XHJcblxyXG4gIC8qKlxyXG4gICAqIOW6lOeUqOacjeWKoeWZqOerr+WPmOabtFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGFwcGx5Q2hhbmdlcygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG5cclxuICAvKipcclxuICAgKiDkv53lrZhpZOWvueW6lOaVsOaNrueahOWPmOabtFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGFwcGx5Q2hhbmdlc0J5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj47XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOWPmOabtOmbhlxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGNhbmNlbENoYW5nZXMob3B0aW9ucz86IGFueSk6IE9ic2VydmFibGU8Ym9vbGVhbj47XHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yig6Zmk5a2Q6KGoXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgYmF0Y2hSZW1vdmVCeVBhdGgocGF0aDogc3RyaW5nLCBpZHM6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj47XHJcbiAgLyoqXHJcbiAgICog5om56YeP5paw5aKe5LuO6KGoL+S7juS7juihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBwYXRoIOWunuS9k+e7keWumui3r+W+hO+8jGxpa2UgMS9jaGlsZHMgb3IgMS9jaGlsZHMvMTEvY2hpbGRjaGlsZHNcclxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlcyDpu5jorqTlrp7kvZPmlbDmja7mlbDnu4RcclxuICAgKiBAZGVzY3JpcHRpb24g5ZCO56uv5o6l5Y+j5Y+q5pSv5oyB5om56YeP5paw5aKe5a2Q6KGo77yM5om56YeP5paw5aKe5Li76KGo55uu5YmN5LiN5pSv5oyBXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgYmF0Y2hBcHBlbmRCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWVzOiBBcnJheTxhbnk+KTogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOaJuemHj+aWsOWinuS4u+ihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWVzIOm7mOiupOWunuS9k+aVsOaNruaVsOe7hFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGJhdGNoQXBwZW5kKGRlZmF1bHRWYWx1ZXM6IEFycmF5PGFueT4pOiBPYnNlcnZhYmxlPGFueT47XHJcblxyXG59XHJcbiJdfQ==