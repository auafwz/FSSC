/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isPlatformBrowser } from '@angular/common';
import { Component, ElementRef, forwardRef, Inject, Input, NgZone, PLATFORM_ID, InjectionToken, Optional, Injector, LOCALE_ID, HostBinding, ViewEncapsulation, Renderer2 } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { getTinymce } from './TinyMCE';
import { bindHandlers, isTextarea, mergePlugins, uuid, noop, isNullOrUndefined } from './utils/Utils';
import { Events } from './Events';
import { ScriptLoader } from './utils/ScriptLoader';
import { EditorService } from './editor.service';
import { NavigationEnd, NavigationStart, Router } from '@angular/router';
/** @type {?} */
export const TINYMCE_SCRIPT_SRC = new InjectionToken('TINYMCE_SCRIPT_SRC');
/** @type {?} */
const EDITOR_COMPONENT_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    () => EditorComponent)),
    multi: true
};
export class EditorComponent extends Events {
    /**
     * @param {?} elementRef
     * @param {?} ngZone
     * @param {?} platformId
     * @param {?} injector
     * @param {?=} tinymceScriptSrc
     */
    constructor(elementRef, ngZone, platformId, injector, tinymceScriptSrc) {
        super();
        this.platformId = platformId;
        this.injector = injector;
        this.tinymceScriptSrc = tinymceScriptSrc;
        this.rootClass = 'farris-editor';
        this.localeIds = {
            'en': 'es',
            'zh-CHS': 'zh_CN'
        };
        this.currentLocale = 'zh-CHS';
        this.cloudChannel = '5';
        this.apiKey = 'no-api-key';
        // @Input() public init: Record<string, any> | undefined;
        this.editorId = '';
        this.modelEvents = 'change keyup undo redo';
        this.height = 100;
        this.autoresizeMaxHeight = 800;
        this.showBorder = true;
        this._fontFamilyList = ['Microsoft YaHei', 'Helvetica Neue', 'PingFang SC', 'sans-serif', 'simsun', 'serif', 'SimHei', 'arial', 'helvetica', 'arial black', 'avant garde', 'book antiqua', 'palatino', 'FangSong'];
        this._defaultFontFamily = 'Microsoft YaHei';
        this.onTouchedCallback = noop;
        this.onChangeCallback = noop;
        this.__WEBPAGEURL__ = '';
        this.editorBodyCls = 'mce-content-body';
        this._elementRef = elementRef;
        this.ngZone = ngZone;
        this._render = this.injector.get(Renderer2);
        this.initialise = this.initialise.bind(this);
        if (this.injector) {
            this.currentLocale = this.injector.get(LOCALE_ID);
            this.editorService = this.injector.get(EditorService);
            this.router = this.injector.get(Router, null);
            if (this.router) {
                this.router.events.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => {
                    if (e instanceof NavigationStart) {
                        if (!this.__WEBPAGEURL__) {
                            this.__WEBPAGEURL__ = e.url;
                        }
                    }
                    else if (e instanceof NavigationEnd) {
                        if (this.__WEBPAGEURL__ === e.url && this.editor) {
                            // console.log(this.editor);
                            this.editor.destroy();
                            this.initialise();
                        }
                    }
                }));
            }
        }
    }
    /**
     * @return {?}
     */
    get disabledClass() {
        return this._disabled;
    }
    /**
     * @return {?}
     */
    get readonlyClass() {
        return this._readOnly;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set disabled(val) {
        this._disabled = val;
        if (this._editor && this._editor.initialized) {
            this._editor.setMode(val ? 'readonly' : 'design');
            this.setDivElement(val);
            this.editorBlured();
        }
    }
    /**
     * @return {?}
     */
    get disabled() {
        return this._disabled;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set readOnly(val) {
        this._readOnly = val;
        if (this._editor && this._editor.initialized) {
            this._editor.setMode(val ? 'readonly' : 'design');
            this.setDivElement(val);
            this.editorBlured();
        }
    }
    /**
     * @return {?}
     */
    get readOnly() {
        return this._readOnly;
    }
    /**
     * @return {?}
     */
    get editor() {
        return this._editor;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set fontFamilyList(val) {
        if (val) {
            this._fontFamilyList = val;
        }
    }
    /**
     * @return {?}
     */
    get fontFamilyList() {
        return this._fontFamilyList;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set defaultFontFamily(val) {
        if (val) {
            this._defaultFontFamily = val;
        }
    }
    /**
     * @return {?}
     */
    get defaultFontFamily() {
        return this._defaultFontFamily;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const _this = this;
        this.init = {
            selector: 'textarea',
            menubar: false,
            inline: false,
            // statusbar: false,
            plugins: [
                'advlist autolink lists link image charmap print preview anchor textcolor powerpaste',
                'searchreplace visualblocks code fullscreen',
                'insertdatetime media table image imagetools code help nonbreaking'
            ],
            language: this.localeIds[this.currentLocale],
            // toolbar定义快捷栏的操作, | 用来分隔显示
            toolbar: 'undo redo | formatselect fontsizeselect fontselect | bold italic underline strikethrough forecolor backcolor link | \
        alignleft aligncenter alignright alignjustify | \
        bullist numlist outdent indent table image | removeformat',
            min_height: 100,
            // max_height: 400,
            fontsize_formats: '12px 14px 16px 18px 24px 36px 48px 56px 72px',
            font_formats: '微软雅黑=Microsoft YaHei,Helvetica Neue,PingFang SC,sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;宋体=simsun,serif;仿宋体=FangSong,serif;黑体=SimHei,sans-serif;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;',
            images_upload_url: 'postAcceptor.php',
            images_upload_handler: (/**
             * @param {?} blobInfo
             * @param {?} success
             * @param {?} failure
             * @return {?}
             */
            function (blobInfo, success, failure) {
                if (_this.beforeUpload) {
                    _this.beforeUpload(blobInfo).subscribe((/**
                     * @param {?} res
                     * @return {?}
                     */
                    res => {
                        success(res);
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    error => {
                        failure(error);
                        return;
                    }));
                }
                else {
                    /** @type {?} */
                    const reader = new FileReader();
                    reader.readAsDataURL(blobInfo.blob());
                    reader.onload = (/**
                     * @return {?}
                     */
                    function () {
                        success(this.result);
                    });
                }
            }),
            branding: false,
            readonly: false,
            setup: null,
            end_container_on_empty_block: true,
            powerpaste_word_import: 'propmt',
            powerpaste_html_import: 'propmt',
            powerpaste_allow_local_images: true,
            paste_data_images: true,
            autoresize_min_height: 100,
            autoresize_max_height: 800,
            autoresize_on_init: true,
            autoresize_overflow_padding: 0,
            nonbreaking_force_tab: true,
            default_link_target: '_blank'
        };
    }
    /**
     * @private
     * @return {?}
     */
    editorBlured() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const tinyBody = this._editor.iframeElement.contentWindow.document.getElementsByClassName(this.editorBodyCls);
            if (tinyBody && tinyBody.length) {
                tinyBody[0].blur();
            }
        }), 0);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        if (this._editor && this._editor.initialized) {
            this._editor.setContent(isNullOrUndefined(value) ? '' : value);
            this._divElement.innerHTML = (isNullOrUndefined(value) ? '' : value);
        }
        else {
            this.initialValue = value === null ? undefined : value;
        }
        if (!this.__WEBPAGEURL__ && this.router) {
            this.__WEBPAGEURL__ = this.router.url;
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        if (this._editor) {
            this._editor.setMode(isDisabled ? 'readonly' : 'design');
        }
        else if (isDisabled) {
            this.init = Object.assign({}, this.init, { readonly: true });
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (isPlatformBrowser(this.platformId)) {
            this.editorId = this.editorId || uuid('tiny-angular');
            this.inline =
                typeof this.inline !== 'undefined' ? (typeof this.inline === 'boolean' ? this.inline : true) : this.init && this.init.inline;
            this.createElement();
            this.init.selector = '#' + this.editorId;
            if (getTinymce()) {
                this.initialise();
            }
            else if (this._element && this._element.ownerDocument) {
                ScriptLoader.load(this._element.ownerDocument, this.getScriptSrc(), this.initialise);
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.__WEBPAGEURL__ = '';
        if (this._editor) {
            this._editor.remove();
            this._editor = null;
            this._divElement = null;
        }
    }
    /**
     * @return {?}
     */
    createElement() {
        /** @type {?} */
        const tagName = typeof this.tagName === 'string' ? this.tagName : 'div';
        this._element = document.createElement(this.inline ? tagName : 'textarea');
        this._element.setAttribute('class', 'd-none');
        this._divElement = document.createElement('div');
        if (this.showBorder) {
            this._divElement.className = 'farris-editor-placeholder';
        }
        else {
            this._divElement.className = 'farris-editor-placeholder farris-editor-placeholder-border';
        }
        this._render.setStyle(this._divElement, 'height', this.height + 'px');
        if (this._element) {
            this._element.id = this.editorId;
            if (isTextarea(this._element)) {
                this._element.style.visibility = 'hidden';
            }
            this._elementRef.nativeElement.appendChild(this._element);
            this._elementRef.nativeElement.appendChild(this._divElement);
        }
    }
    /**
     * @return {?}
     */
    initialise() {
        /** @type {?} */
        const finalInit = Object.assign({}, this.init, { target: this._element, inline: this.inline, plugins: mergePlugins(this.init && this.init.plugins, this.plugins), toolbar: this.toolbar || (this.init && this.init.toolbar), height: this.height, autoresize_max_height: this.autoresizeMaxHeight, setup: (/**
             * @param {?} editor
             * @return {?}
             */
            (editor) => {
                this._editor = editor;
                editor.on('init', (/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => {
                    this.initEditor(editor);
                    if (this._readOnly || this._disabled) {
                        this._editor.setMode('readonly');
                    }
                    else {
                        this._editor.setMode('design');
                    }
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.setDivElement(this._readOnly || this._disabled);
                    }), 0);
                }));
                editor.on('PastePostProcess', (/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    this.replaceFontFamily(data.node);
                }));
                bindHandlers(this, editor);
                if (this.init && typeof this.init.setup === 'function') {
                    this.init.setup(editor);
                }
            }) });
        if (isTextarea(this._element)) {
            this._element.style.visibility = '';
        }
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            setTimeout((/**
             * @return {?}
             */
            () => {
                getTinymce().init(finalInit);
            }), 0);
        }));
    }
    /**
     * @private
     * @param {?} readonly
     * @return {?}
     */
    setDivElement(readonly) {
        if (readonly) {
            this._divElement.classList.remove('d-none');
        }
        else {
            this._divElement.classList.add('d-none');
        }
        // if(this._editor && this._editor.initialized){
        //   this._divElement.innerHTML = this._editor.getContent({ format: this.outputFormat });
        // }
    }
    /**
     * @private
     * @return {?}
     */
    getScriptSrc() {
        return isNullOrUndefined(this.tinymceScriptSrc) ?
            `https://cdn.tiny.cloud/1/${this.apiKey}/tinymce/${this.cloudChannel}/tinymce.min.js` :
            this.tinymceScriptSrc;
    }
    /**
     * @private
     * @param {?} editor
     * @return {?}
     */
    initEditor(editor) {
        editor.on('blur', (/**
         * @return {?}
         */
        () => this.ngZone.run((/**
         * @return {?}
         */
        () => this.onTouchedCallback()))));
        editor.on(this.modelEvents, (/**
         * @return {?}
         */
        () => {
            this.ngZone.run((/**
             * @return {?}
             */
            () => {
                this.onChangeCallback(editor.getContent({ format: this.outputFormat }));
                this._divElement.innerHTML = editor.getContent({ format: this.outputFormat });
            }));
            // console.log(editor.getContent({ format: this.outputFormat }));
        }));
        if (typeof this.initialValue === 'string') {
            this.ngZone.run((/**
             * @return {?}
             */
            () => {
                editor.setContent(this.initialValue);
                this._divElement.innerHTML = this.initialValue;
                this.onChangeCallback(editor.getContent({ format: this.outputFormat }));
            }));
        }
    }
    /**
     * @private
     * @param {?} el
     * @return {?}
     */
    replaceFontFamily(el) {
        if (el.children && el.children.length) {
            for (let k = 0; k < el.children.length; k++) {
                this.replaceFontFamily(el.children[k]);
            }
        }
        /** @type {?} */
        let ff = el.style.fontFamily;
        /** @type {?} */
        let face = el.getAttribute('face');
        if (ff) {
            /** @type {?} */
            let fonts = ff.split(',');
            /** @type {?} */
            let r = this.getFontFamilyArray(fonts);
            el.style.fontFamily = r;
        }
        if (face) {
            /** @type {?} */
            let faces = face.split(',');
            /** @type {?} */
            let r = this.getFontFamilyArray(faces);
            el.setAttribute('face', r);
        }
    }
    /**
     * @private
     * @param {?} fonts
     * @param {?=} zcFontArr
     * @return {?}
     */
    getFontFamilyArray(fonts, zcFontArr = this._fontFamilyList) {
        /** @type {?} */
        let ss = [];
        fonts.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (zcFontArr.find((/**
             * @param {?} f
             * @return {?}
             */
            f => f === this.trim(n)))) {
                ss.push(this.trim(n));
            }
        }));
        /** @type {?} */
        let r = ss.join(',');
        if (!r) {
            r = this._defaultFontFamily;
        }
        return r;
    }
    /**
     * @private
     * @param {?} str
     * @return {?}
     */
    trim(str) {
        return str.replace(/^\s*|\s*$/g, '');
    }
}
EditorComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-editor',
                template: '<ng-template></ng-template>',
                providers: [EDITOR_COMPONENT_VALUE_ACCESSOR],
                encapsulation: ViewEncapsulation.None,
                styles: [":host{display:block}.farris-editor .mce-tinymce .mce-toolbar .mce-btn-group>div{white-space:pre-wrap}.farris-editor .mce-tinymce{box-sizing:border-box;box-shadow:none}.farris-editor .mce-panel,.farris-editor .mce-tinymce{border-color:#d8dce6}.farris-editor.farris-editor-disabled .mce-statusbar,.farris-editor.farris-editor-disabled .mce-top-part,.farris-editor.farris-editor-readonly .mce-statusbar,.farris-editor.farris-editor-readonly .mce-top-part{display:none}.farris-editor.farris-editor-disabled .mce-edit-area,.farris-editor.farris-editor-readonly .mce-edit-area{border-top:none}.farris-editor.farris-editor-disabled.farris-editor-border .mce-tinymce,.farris-editor.farris-editor-readonly.farris-editor-border .mce-tinymce{border-width:0 0 1px!important}"]
            }] }
];
/** @nocollapse */
EditorComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: Injector, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [TINYMCE_SCRIPT_SRC,] }] }
];
EditorComponent.propDecorators = {
    rootClass: [{ type: HostBinding, args: ['class',] }],
    disabledClass: [{ type: HostBinding, args: ['class.farris-editor-disabled',] }],
    readonlyClass: [{ type: HostBinding, args: ['class.farris-editor-readonly',] }],
    disabled: [{ type: Input }],
    readOnly: [{ type: Input }],
    cloudChannel: [{ type: Input }],
    apiKey: [{ type: Input }],
    editorId: [{ type: Input }],
    initialValue: [{ type: Input }],
    outputFormat: [{ type: Input }],
    inline: [{ type: Input }],
    tagName: [{ type: Input }],
    plugins: [{ type: Input }],
    toolbar: [{ type: Input }],
    modelEvents: [{ type: Input }],
    height: [{ type: Input }],
    autoresizeMaxHeight: [{ type: Input }],
    showBorder: [{ type: Input }, { type: HostBinding, args: ['class.farris-editor-border',] }],
    fontFamilyList: [{ type: Input }],
    defaultFontFamily: [{ type: Input }],
    beforeUpload: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    EditorComponent.prototype.rootClass;
    /** @type {?} */
    EditorComponent.prototype.ngZone;
    /** @type {?} */
    EditorComponent.prototype.localeIds;
    /** @type {?} */
    EditorComponent.prototype.currentLocale;
    /** @type {?} */
    EditorComponent.prototype.cloudChannel;
    /** @type {?} */
    EditorComponent.prototype.apiKey;
    /** @type {?} */
    EditorComponent.prototype.editorId;
    /** @type {?} */
    EditorComponent.prototype.initialValue;
    /** @type {?} */
    EditorComponent.prototype.outputFormat;
    /** @type {?} */
    EditorComponent.prototype.inline;
    /** @type {?} */
    EditorComponent.prototype.tagName;
    /** @type {?} */
    EditorComponent.prototype.plugins;
    /** @type {?} */
    EditorComponent.prototype.toolbar;
    /** @type {?} */
    EditorComponent.prototype.modelEvents;
    /** @type {?} */
    EditorComponent.prototype.height;
    /** @type {?} */
    EditorComponent.prototype.autoresizeMaxHeight;
    /** @type {?} */
    EditorComponent.prototype.showBorder;
    /** @type {?} */
    EditorComponent.prototype._fontFamilyList;
    /** @type {?} */
    EditorComponent.prototype._defaultFontFamily;
    /** @type {?} */
    EditorComponent.prototype.beforeUpload;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.init;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype._elementRef;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype._element;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype._disabled;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype._readOnly;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype._editor;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype._divElement;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.onTouchedCallback;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.onChangeCallback;
    /** @type {?} */
    EditorComponent.prototype.editorService;
    /** @type {?} */
    EditorComponent.prototype._render;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.__WEBPAGEURL__;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.editorBodyCls;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.platformId;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    EditorComponent.prototype.tinymceScriptSrc;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2VkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFBaUIsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQWEsV0FBVyxFQUFFLGNBQWMsRUFDcEgsUUFBUSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RyxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFekUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN2QyxPQUFPLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0RyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ2xDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakQsT0FBTyxFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7O0FBRXpFLE1BQU0sT0FBTyxrQkFBa0IsR0FBRyxJQUFJLGNBQWMsQ0FBUyxvQkFBb0IsQ0FBQzs7TUFFNUUsK0JBQStCLEdBQUc7SUFDcEMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsR0FBRyxFQUFFLENBQUMsZUFBZSxFQUFDO0lBQzlDLEtBQUssRUFB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Q0wsS0FBSztzQkFDTCxLQUFLO3NCQUNMLEtBQUs7c0JBQ0wsS0FBSzswQkFDTCxLQUFLO3FCQUNMLEtBQUs7a0NBQ0wsS0FBSzt5QkFFTCxLQUFLLFlBQ0wsV0FBVyxTQUFDLDRCQUE0Qjs2QkFFeEMsS0FBSztnQ0FZTCxLQUFLOzJCQVdMLEtBQUs7Ozs7SUF2Rk4sb0NBQWtEOztJQXdDbEQsaUNBQXNCOztJQUN0QixvQ0FHQzs7SUFDRCx3Q0FBeUI7O0lBRXpCLHVDQUFtQzs7SUFDbkMsaUNBQXNDOztJQUV0QyxtQ0FBOEI7O0lBQzlCLHVDQUFpRDs7SUFDakQsdUNBQTBEOztJQUMxRCxpQ0FBNEM7O0lBQzVDLGtDQUE0Qzs7SUFDNUMsa0NBQTRDOztJQUM1QyxrQ0FBdUQ7O0lBQ3ZELHNDQUF1RDs7SUFDdkQsaUNBQTZCOztJQUM3Qiw4Q0FBMEM7O0lBRTFDLHFDQUM2RDs7SUFDN0QsMENBQTZOOztJQVk3Tiw2Q0FBdUM7O0lBWXZDLHVDQUF5RDs7Ozs7SUFFekQsK0JBQWtCOzs7OztJQUNsQixzQ0FBZ0M7Ozs7O0lBQ2hDLG1DQUFzQzs7Ozs7SUFDdEMsb0NBQXVDOzs7OztJQUN2QyxvQ0FBdUM7Ozs7O0lBQ3ZDLGtDQUFxQjs7Ozs7SUFDckIsc0NBQXlDOzs7OztJQUV6Qyw0Q0FBaUM7Ozs7O0lBQ2pDLDJDQUFnQzs7SUFDaEMsd0NBQTZCOztJQUM3QixrQ0FBMEI7Ozs7O0lBRTFCLGlDQUF1Qjs7Ozs7SUFDdkIseUNBQTRCOzs7OztJQUM1Qix3Q0FBMkM7Ozs7O0lBSXZDLHFDQUErQzs7Ozs7SUFDL0MsbUNBQXNDOzs7OztJQUN0QywyQ0FBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgZm9yd2FyZFJlZiwgSW5qZWN0LCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIFBMQVRGT1JNX0lELCBJbmplY3Rpb25Ub2tlbixcclxuICAgIE9wdGlvbmFsLCBJbmplY3RvciwgTE9DQUxFX0lELCBPbkluaXQsIEhvc3RCaW5kaW5nLCBWaWV3RW5jYXBzdWxhdGlvbiwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBnZXRUaW55bWNlIH0gZnJvbSAnLi9UaW55TUNFJztcclxuaW1wb3J0IHsgYmluZEhhbmRsZXJzLCBpc1RleHRhcmVhLCBtZXJnZVBsdWdpbnMsIHV1aWQsIG5vb3AsIGlzTnVsbE9yVW5kZWZpbmVkIH0gZnJvbSAnLi91dGlscy9VdGlscyc7XHJcbmltcG9ydCB7IEV2ZW50cyB9IGZyb20gJy4vRXZlbnRzJztcclxuaW1wb3J0IHsgU2NyaXB0TG9hZGVyIH0gZnJvbSAnLi91dGlscy9TY3JpcHRMb2FkZXInO1xyXG5pbXBvcnQgeyBFZGl0b3JTZXJ2aWNlIH0gZnJvbSAnLi9lZGl0b3Iuc2VydmljZSc7XHJcbmltcG9ydCB7IE5hdmlnYXRpb25FbmQsIE5hdmlnYXRpb25TdGFydCwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuXHJcbmV4cG9ydCBjb25zdCBUSU5ZTUNFX1NDUklQVF9TUkMgPSBuZXcgSW5qZWN0aW9uVG9rZW48c3RyaW5nPignVElOWU1DRV9TQ1JJUFRfU1JDJyk7XHJcblxyXG5jb25zdCBFRElUT1JfQ09NUE9ORU5UX1ZBTFVFX0FDQ0VTU09SID0ge1xyXG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBFZGl0b3JDb21wb25lbnQpLFxyXG4gICAgbXVsdGk6IHRydWVcclxufTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmYXJyaXMtZWRpdG9yJyxcclxuICAgIHRlbXBsYXRlOiAnPG5nLXRlbXBsYXRlPjwvbmctdGVtcGxhdGU+JyxcclxuICAgIHN0eWxlVXJsczogWycuL2VkaXRvci5jb21wb25lbnQuc2NzcyddLFxyXG4gICAgcHJvdmlkZXJzOiBbRURJVE9SX0NPTVBPTkVOVF9WQUxVRV9BQ0NFU1NPUl0sXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBFZGl0b3JDb21wb25lbnQgZXh0ZW5kcyBFdmVudHMgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBPbkRlc3Ryb3kge1xyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIHJvb3RDbGFzcyA9ICdmYXJyaXMtZWRpdG9yJztcclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZmFycmlzLWVkaXRvci1kaXNhYmxlZCcpXHJcbiAgICBnZXQgZGlzYWJsZWRDbGFzcygpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XHJcbiAgICB9XHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZhcnJpcy1lZGl0b3ItcmVhZG9ubHknKVxyXG4gICAgZ2V0IHJlYWRvbmx5Q2xhc3MoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWRPbmx5O1xyXG4gICAgfVxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBkaXNhYmxlZCh2YWwpIHtcclxuICAgICAgICB0aGlzLl9kaXNhYmxlZCA9IHZhbDtcclxuICAgICAgICBpZiAodGhpcy5fZWRpdG9yICYmIHRoaXMuX2VkaXRvci5pbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9lZGl0b3Iuc2V0TW9kZSh2YWwgPyAncmVhZG9ubHknIDogJ2Rlc2lnbicpO1xyXG4gICAgICAgICAgICB0aGlzLnNldERpdkVsZW1lbnQodmFsKTtcclxuICAgICAgICAgICAgdGhpcy5lZGl0b3JCbHVyZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgZGlzYWJsZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgcmVhZE9ubHkodmFsKSB7XHJcbiAgICAgICAgdGhpcy5fcmVhZE9ubHkgPSB2YWw7XHJcbiAgICAgICAgaWYgKHRoaXMuX2VkaXRvciAmJiB0aGlzLl9lZGl0b3IuaW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fZWRpdG9yLnNldE1vZGUodmFsID8gJ3JlYWRvbmx5JyA6ICdkZXNpZ24nKTtcclxuICAgICAgICAgICAgdGhpcy5zZXREaXZFbGVtZW50KHZhbCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yQmx1cmVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCByZWFkT25seSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVhZE9ubHk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGVkaXRvcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZWRpdG9yO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuZ1pvbmU6IE5nWm9uZTtcclxuICAgIGxvY2FsZUlkcyA9IHtcclxuICAgICAgICAnZW4nOiAnZXMnLFxyXG4gICAgICAgICd6aC1DSFMnOiAnemhfQ04nXHJcbiAgICB9XHJcbiAgICBjdXJyZW50TG9jYWxlID0gJ3poLUNIUyc7XHJcblxyXG4gICAgQElucHV0KCkgcHVibGljIGNsb3VkQ2hhbm5lbCA9ICc1JztcclxuICAgIEBJbnB1dCgpIHB1YmxpYyBhcGlLZXkgPSAnbm8tYXBpLWtleSc7XHJcbiAgICAvLyBASW5wdXQoKSBwdWJsaWMgaW5pdDogUmVjb3JkPHN0cmluZywgYW55PiB8IHVuZGVmaW5lZDtcclxuICAgIEBJbnB1dCgpIHB1YmxpYyBlZGl0b3JJZCA9ICcnO1xyXG4gICAgQElucHV0KCkgcHVibGljIGluaXRpYWxWYWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gICAgQElucHV0KCkgcHVibGljIG91dHB1dEZvcm1hdDogJ2h0bWwnIHwgJ3RleHQnIHwgdW5kZWZpbmVkO1xyXG4gICAgQElucHV0KCkgcHVibGljIGlubGluZTogYm9vbGVhbiB8IHVuZGVmaW5lZDtcclxuICAgIEBJbnB1dCgpIHB1YmxpYyB0YWdOYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICBASW5wdXQoKSBwdWJsaWMgcGx1Z2luczogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gICAgQElucHV0KCkgcHVibGljIHRvb2xiYXI6IHN0cmluZyB8IHN0cmluZ1tdIHwgdW5kZWZpbmVkO1xyXG4gICAgQElucHV0KCkgcHVibGljIG1vZGVsRXZlbnRzID0gJ2NoYW5nZSBrZXl1cCB1bmRvIHJlZG8nO1xyXG4gICAgQElucHV0KCkgcHVibGljIGhlaWdodCA9IDEwMDtcclxuICAgIEBJbnB1dCgpIHB1YmxpYyBhdXRvcmVzaXplTWF4SGVpZ2h0ID0gODAwO1xyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZhcnJpcy1lZGl0b3ItYm9yZGVyJykgc2hvd0JvcmRlciA9IHRydWU7XHJcbiAgICBfZm9udEZhbWlseUxpc3Q6IEFycmF5PHN0cmluZz4gPSBbJ01pY3Jvc29mdCBZYUhlaScsICdIZWx2ZXRpY2EgTmV1ZScsICdQaW5nRmFuZyBTQycsICdzYW5zLXNlcmlmJywgJ3NpbXN1bicsICdzZXJpZicsICdTaW1IZWknLCAnYXJpYWwnLCAnaGVsdmV0aWNhJywgJ2FyaWFsIGJsYWNrJywgJ2F2YW50IGdhcmRlJywgJ2Jvb2sgYW50aXF1YScsICdwYWxhdGlubycsICdGYW5nU29uZyddO1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBmb250RmFtaWx5TGlzdCh2YWwpIHtcclxuICAgICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2ZvbnRGYW1pbHlMaXN0ID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgZm9udEZhbWlseUxpc3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZvbnRGYW1pbHlMaXN0O1xyXG4gICAgfVxyXG5cclxuICAgIF9kZWZhdWx0Rm9udEZhbWlseSA9ICdNaWNyb3NvZnQgWWFIZWknO1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBkZWZhdWx0Rm9udEZhbWlseSh2YWwpIHtcclxuICAgICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRGb250RmFtaWx5ID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGVmYXVsdEZvbnRGYW1pbHkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRGb250RmFtaWx5O1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIGJlZm9yZVVwbG9hZDogKGZpbGVPYmo/OiB7fSkgPT4gT2JzZXJ2YWJsZTxhbnk+O1xyXG5cclxuICAgIHByaXZhdGUgaW5pdDogYW55O1xyXG4gICAgcHJpdmF0ZSBfZWxlbWVudFJlZjogRWxlbWVudFJlZjtcclxuICAgIHByaXZhdGUgX2VsZW1lbnQ6IEVsZW1lbnQgfCB1bmRlZmluZWQ7XHJcbiAgICBwcml2YXRlIF9kaXNhYmxlZDogYm9vbGVhbiB8IHVuZGVmaW5lZDtcclxuICAgIHByaXZhdGUgX3JlYWRPbmx5OiBib29sZWFuIHwgdW5kZWZpbmVkO1xyXG4gICAgcHJpdmF0ZSBfZWRpdG9yOiBhbnk7XHJcbiAgICBwcml2YXRlIF9kaXZFbGVtZW50OiBFbGVtZW50IHwgdW5kZWZpbmVkO1xyXG5cclxuICAgIHByaXZhdGUgb25Ub3VjaGVkQ2FsbGJhY2sgPSBub29wO1xyXG4gICAgcHJpdmF0ZSBvbkNoYW5nZUNhbGxiYWNrID0gbm9vcDtcclxuICAgIGVkaXRvclNlcnZpY2U6IEVkaXRvclNlcnZpY2U7XHJcbiAgICBwdWJsaWMgX3JlbmRlcjogUmVuZGVyZXIyO1xyXG5cclxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXI7XHJcbiAgICBwcml2YXRlIF9fV0VCUEFHRVVSTF9fID0gJyc7XHJcbiAgICBwcml2YXRlIGVkaXRvckJvZHlDbHMgPSAnbWNlLWNvbnRlbnQtYm9keSc7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxyXG4gICAgICAgIG5nWm9uZTogTmdab25lLFxyXG4gICAgICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1JZDogT2JqZWN0LFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIEBJbmplY3QoVElOWU1DRV9TQ1JJUFRfU1JDKSBwcml2YXRlIHRpbnltY2VTY3JpcHRTcmM/OiBzdHJpbmdcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudFJlZiA9IGVsZW1lbnRSZWY7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyID0gdGhpcy5pbmplY3Rvci5nZXQoUmVuZGVyZXIyKTtcclxuICAgICAgICB0aGlzLmluaXRpYWxpc2UgPSB0aGlzLmluaXRpYWxpc2UuYmluZCh0aGlzKTtcclxuICAgICAgICBpZiAodGhpcy5pbmplY3Rvcikge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMb2NhbGUgPSB0aGlzLmluamVjdG9yLmdldChMT0NBTEVfSUQpO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvclNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChFZGl0b3JTZXJ2aWNlKTtcclxuXHJcblxyXG4gICAgICAgICAgICB0aGlzLnJvdXRlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJvdXRlciwgbnVsbCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvdXRlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIuZXZlbnRzLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBOYXZpZ2F0aW9uU3RhcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9fV0VCUEFHRVVSTF9fKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fV0VCUEFHRVVSTF9fID0gZS51cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBOYXZpZ2F0aW9uRW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fV0VCUEFHRVVSTF9fID09PSBlLnVybCAmJiB0aGlzLmVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5lZGl0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5pbml0ID0ge1xyXG4gICAgICAgICAgICBzZWxlY3RvcjogJ3RleHRhcmVhJyxcclxuICAgICAgICAgICAgbWVudWJhcjogZmFsc2UsXHJcbiAgICAgICAgICAgIGlubGluZTogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vIHN0YXR1c2JhcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHBsdWdpbnM6IFtcclxuICAgICAgICAgICAgICAgICdhZHZsaXN0IGF1dG9saW5rIGxpc3RzIGxpbmsgaW1hZ2UgY2hhcm1hcCBwcmludCBwcmV2aWV3IGFuY2hvciB0ZXh0Y29sb3IgcG93ZXJwYXN0ZScsXHJcbiAgICAgICAgICAgICAgICAnc2VhcmNocmVwbGFjZSB2aXN1YWxibG9ja3MgY29kZSBmdWxsc2NyZWVuJyxcclxuICAgICAgICAgICAgICAgICdpbnNlcnRkYXRldGltZSBtZWRpYSB0YWJsZSBpbWFnZSBpbWFnZXRvb2xzIGNvZGUgaGVscCBub25icmVha2luZydcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMubG9jYWxlSWRzW3RoaXMuY3VycmVudExvY2FsZV0sXHJcbiAgICAgICAgICAgIC8vIHRvb2xiYXLlrprkuYnlv6vmjbfmoI/nmoTmk43kvZwsIHwg55So5p2l5YiG6ZqU5pi+56S6XHJcbiAgICAgICAgICAgIHRvb2xiYXI6ICd1bmRvIHJlZG8gfCBmb3JtYXRzZWxlY3QgZm9udHNpemVzZWxlY3QgZm9udHNlbGVjdCB8IGJvbGQgaXRhbGljIHVuZGVybGluZSBzdHJpa2V0aHJvdWdoIGZvcmVjb2xvciBiYWNrY29sb3IgbGluayB8IFxcXHJcbiAgICAgICAgYWxpZ25sZWZ0IGFsaWduY2VudGVyIGFsaWducmlnaHQgYWxpZ25qdXN0aWZ5IHwgXFxcclxuICAgICAgICBidWxsaXN0IG51bWxpc3Qgb3V0ZGVudCBpbmRlbnQgdGFibGUgaW1hZ2UgfCByZW1vdmVmb3JtYXQnLFxyXG4gICAgICAgICAgICBtaW5faGVpZ2h0OiAxMDAsXHJcbiAgICAgICAgICAgIC8vIG1heF9oZWlnaHQ6IDQwMCxcclxuICAgICAgICAgICAgZm9udHNpemVfZm9ybWF0czogJzEycHggMTRweCAxNnB4IDE4cHggMjRweCAzNnB4IDQ4cHggNTZweCA3MnB4JyxcclxuICAgICAgICAgICAgZm9udF9mb3JtYXRzOiAn5b6u6L2v6ZuF6buRPU1pY3Jvc29mdCBZYUhlaSxIZWx2ZXRpY2EgTmV1ZSxQaW5nRmFuZyBTQyxzYW5zLXNlcmlmO+iLueaenOiLueaWuT1QaW5nRmFuZyBTQyxNaWNyb3NvZnQgWWFIZWksc2Fucy1zZXJpZjvlrovkvZM9c2ltc3VuLHNlcmlmO+S7v+Wui+S9kz1GYW5nU29uZyxzZXJpZjvpu5HkvZM9U2ltSGVpLHNhbnMtc2VyaWY7QXJpYWw9YXJpYWwsaGVsdmV0aWNhLHNhbnMtc2VyaWY7QXJpYWwgQmxhY2s9YXJpYWwgYmxhY2ssYXZhbnQgZ2FyZGU7Qm9vayBBbnRpcXVhPWJvb2sgYW50aXF1YSxwYWxhdGlubzsnLFxyXG4gICAgICAgICAgICBpbWFnZXNfdXBsb2FkX3VybDogJ3Bvc3RBY2NlcHRvci5waHAnLFxyXG4gICAgICAgICAgICBpbWFnZXNfdXBsb2FkX2hhbmRsZXI6IGZ1bmN0aW9uIChibG9iSW5mbywgc3VjY2VzcywgZmFpbHVyZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmJlZm9yZVVwbG9hZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmJlZm9yZVVwbG9hZChibG9iSW5mbykuc3Vic2NyaWJlKHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmUoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iSW5mby5ibG9iKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3ModGhpcy5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJyYW5kaW5nOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVhZG9ubHk6IGZhbHNlLFxyXG4gICAgICAgICAgICBzZXR1cDogbnVsbCxcclxuICAgICAgICAgICAgZW5kX2NvbnRhaW5lcl9vbl9lbXB0eV9ibG9jazogdHJ1ZSxcclxuICAgICAgICAgICAgcG93ZXJwYXN0ZV93b3JkX2ltcG9ydDogJ3Byb3BtdCcsXHJcbiAgICAgICAgICAgIHBvd2VycGFzdGVfaHRtbF9pbXBvcnQ6ICdwcm9wbXQnLFxyXG4gICAgICAgICAgICBwb3dlcnBhc3RlX2FsbG93X2xvY2FsX2ltYWdlczogdHJ1ZSxcclxuICAgICAgICAgICAgcGFzdGVfZGF0YV9pbWFnZXM6IHRydWUsXHJcbiAgICAgICAgICAgIGF1dG9yZXNpemVfbWluX2hlaWdodDogMTAwLFxyXG4gICAgICAgICAgICBhdXRvcmVzaXplX21heF9oZWlnaHQ6IDgwMCxcclxuICAgICAgICAgICAgYXV0b3Jlc2l6ZV9vbl9pbml0OiB0cnVlLFxyXG4gICAgICAgICAgICBhdXRvcmVzaXplX292ZXJmbG93X3BhZGRpbmc6IDAsXHJcbiAgICAgICAgICAgIG5vbmJyZWFraW5nX2ZvcmNlX3RhYjogdHJ1ZSxcclxuICAgICAgICAgICAgZGVmYXVsdF9saW5rX3RhcmdldDogJ19ibGFuaydcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGVkaXRvckJsdXJlZCgpIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdGlueUJvZHkgPSB0aGlzLl9lZGl0b3IuaWZyYW1lRWxlbWVudC5jb250ZW50V2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGhpcy5lZGl0b3JCb2R5Q2xzKTtcclxuICAgICAgICAgICAgaWYgKHRpbnlCb2R5ICYmIHRpbnlCb2R5Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGlueUJvZHlbMF0uYmx1cigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyB3cml0ZVZhbHVlKHZhbHVlOiBzdHJpbmcgfCBudWxsKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2VkaXRvciAmJiB0aGlzLl9lZGl0b3IuaW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fZWRpdG9yLnNldENvbnRlbnQoaXNOdWxsT3JVbmRlZmluZWQodmFsdWUpID8gJycgOiB2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2RpdkVsZW1lbnQuaW5uZXJIVE1MID0gKGlzTnVsbE9yVW5kZWZpbmVkKHZhbHVlKSA/ICcnIDogdmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbFZhbHVlID0gdmFsdWUgPT09IG51bGwgPyB1bmRlZmluZWQgOiB2YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5fX1dFQlBBR0VVUkxfXyAmJiB0aGlzLnJvdXRlcikge1xyXG4gICAgICAgICAgICB0aGlzLl9fV0VCUEFHRVVSTF9fID0gdGhpcy5yb3V0ZXIudXJsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVnaXN0ZXJPbkNoYW5nZShmbjogKF86IGFueSkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjayA9IGZuO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAodGhpcy5fZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2VkaXRvci5zZXRNb2RlKGlzRGlzYWJsZWQgPyAncmVhZG9ubHknIDogJ2Rlc2lnbicpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaXNEaXNhYmxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXQgPSB7IC4uLnRoaXMuaW5pdCwgcmVhZG9ubHk6IHRydWUgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcklkID0gdGhpcy5lZGl0b3JJZCB8fCB1dWlkKCd0aW55LWFuZ3VsYXInKTtcclxuICAgICAgICAgICAgdGhpcy5pbmxpbmUgPVxyXG4gICAgICAgICAgICAgICAgdHlwZW9mIHRoaXMuaW5saW5lICE9PSAndW5kZWZpbmVkJyA/ICh0eXBlb2YgdGhpcy5pbmxpbmUgPT09ICdib29sZWFuJyA/IHRoaXMuaW5saW5lIDogdHJ1ZSkgOiB0aGlzLmluaXQgJiYgdGhpcy5pbml0LmlubGluZTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdC5zZWxlY3RvciA9ICcjJyArIHRoaXMuZWRpdG9ySWQ7XHJcbiAgICAgICAgICAgIGlmIChnZXRUaW55bWNlKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdGlhbGlzZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2VsZW1lbnQgJiYgdGhpcy5fZWxlbWVudC5vd25lckRvY3VtZW50KSB7XHJcbiAgICAgICAgICAgICAgICBTY3JpcHRMb2FkZXIubG9hZChcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50Lm93bmVyRG9jdW1lbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRTY3JpcHRTcmMoKSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxpc2VcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuX19XRUJQQUdFVVJMX18gPSAnJztcclxuICAgICAgICBpZiAodGhpcy5fZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2VkaXRvci5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5fZWRpdG9yID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5fZGl2RWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjcmVhdGVFbGVtZW50KCkge1xyXG4gICAgICAgIGNvbnN0IHRhZ05hbWUgPSB0eXBlb2YgdGhpcy50YWdOYW1lID09PSAnc3RyaW5nJyA/IHRoaXMudGFnTmFtZSA6ICdkaXYnO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMuaW5saW5lID8gdGFnTmFtZSA6ICd0ZXh0YXJlYScpO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdkLW5vbmUnKTtcclxuICAgICAgICB0aGlzLl9kaXZFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd0JvcmRlcikge1xyXG4gICAgICAgICAgICB0aGlzLl9kaXZFbGVtZW50LmNsYXNzTmFtZSA9ICdmYXJyaXMtZWRpdG9yLXBsYWNlaG9sZGVyJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9kaXZFbGVtZW50LmNsYXNzTmFtZSA9ICdmYXJyaXMtZWRpdG9yLXBsYWNlaG9sZGVyIGZhcnJpcy1lZGl0b3ItcGxhY2Vob2xkZXItYm9yZGVyJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyLnNldFN0eWxlKHRoaXMuX2RpdkVsZW1lbnQsICdoZWlnaHQnLCB0aGlzLmhlaWdodCArICdweCcpO1xyXG4gICAgICAgIGlmICh0aGlzLl9lbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQuaWQgPSB0aGlzLmVkaXRvcklkO1xyXG4gICAgICAgICAgICBpZiAoaXNUZXh0YXJlYSh0aGlzLl9lbGVtZW50KSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX2VsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fZGl2RWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpbml0aWFsaXNlKCkge1xyXG4gICAgICAgIGNvbnN0IGZpbmFsSW5pdCA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy5pbml0LFxyXG4gICAgICAgICAgICB0YXJnZXQ6IHRoaXMuX2VsZW1lbnQsXHJcbiAgICAgICAgICAgIGlubGluZTogdGhpcy5pbmxpbmUsXHJcbiAgICAgICAgICAgIC8vIHJlYWRvbmx5OiB0aGlzLmRpc2FibGVkIHx8IHRoaXMucmVhZE9ubHksXHJcbiAgICAgICAgICAgIHBsdWdpbnM6IG1lcmdlUGx1Z2lucyh0aGlzLmluaXQgJiYgdGhpcy5pbml0LnBsdWdpbnMsIHRoaXMucGx1Z2lucyksXHJcbiAgICAgICAgICAgIHRvb2xiYXI6IHRoaXMudG9vbGJhciB8fCAodGhpcy5pbml0ICYmIHRoaXMuaW5pdC50b29sYmFyKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCxcclxuICAgICAgICAgICAgYXV0b3Jlc2l6ZV9tYXhfaGVpZ2h0OiB0aGlzLmF1dG9yZXNpemVNYXhIZWlnaHQsXHJcbiAgICAgICAgICAgIHNldHVwOiAoZWRpdG9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2VkaXRvciA9IGVkaXRvcjtcclxuICAgICAgICAgICAgICAgIGVkaXRvci5vbignaW5pdCcsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0RWRpdG9yKGVkaXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlYWRPbmx5IHx8IHRoaXMuX2Rpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VkaXRvci5zZXRNb2RlKCdyZWFkb25seScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZWRpdG9yLnNldE1vZGUoJ2Rlc2lnbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXREaXZFbGVtZW50KHRoaXMuX3JlYWRPbmx5IHx8IHRoaXMuX2Rpc2FibGVkKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZWRpdG9yLm9uKCdQYXN0ZVBvc3RQcm9jZXNzJywgKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VGb250RmFtaWx5KGRhdGEubm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJpbmRIYW5kbGVycyh0aGlzLCBlZGl0b3IpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluaXQgJiYgdHlwZW9mIHRoaXMuaW5pdC5zZXR1cCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdC5zZXR1cChlZGl0b3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKGlzVGV4dGFyZWEodGhpcy5fZWxlbWVudCkpIHtcclxuICAgICAgICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZ2V0VGlueW1jZSgpLmluaXQoZmluYWxJbml0KTtcclxuICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXREaXZFbGVtZW50KHJlYWRvbmx5KSB7XHJcbiAgICAgICAgaWYgKHJlYWRvbmx5KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RpdkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZC1ub25lJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fZGl2RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdkLW5vbmUnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYodGhpcy5fZWRpdG9yICYmIHRoaXMuX2VkaXRvci5pbml0aWFsaXplZCl7XHJcbiAgICAgICAgLy8gICB0aGlzLl9kaXZFbGVtZW50LmlubmVySFRNTCA9IHRoaXMuX2VkaXRvci5nZXRDb250ZW50KHsgZm9ybWF0OiB0aGlzLm91dHB1dEZvcm1hdCB9KTtcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRTY3JpcHRTcmMoKSB7XHJcbiAgICAgICAgcmV0dXJuIGlzTnVsbE9yVW5kZWZpbmVkKHRoaXMudGlueW1jZVNjcmlwdFNyYykgP1xyXG4gICAgICAgICAgICBgaHR0cHM6Ly9jZG4udGlueS5jbG91ZC8xLyR7dGhpcy5hcGlLZXl9L3RpbnltY2UvJHt0aGlzLmNsb3VkQ2hhbm5lbH0vdGlueW1jZS5taW4uanNgIDpcclxuICAgICAgICAgICAgdGhpcy50aW55bWNlU2NyaXB0U3JjO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdEVkaXRvcihlZGl0b3I6IGFueSkge1xyXG4gICAgICAgIGVkaXRvci5vbignYmx1cicsICgpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLm9uVG91Y2hlZENhbGxiYWNrKCkpKTtcclxuICAgICAgICBlZGl0b3Iub24odGhpcy5tb2RlbEV2ZW50cywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKGVkaXRvci5nZXRDb250ZW50KHsgZm9ybWF0OiB0aGlzLm91dHB1dEZvcm1hdCB9KSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXZFbGVtZW50LmlubmVySFRNTCA9IGVkaXRvci5nZXRDb250ZW50KHsgZm9ybWF0OiB0aGlzLm91dHB1dEZvcm1hdCB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVkaXRvci5nZXRDb250ZW50KHsgZm9ybWF0OiB0aGlzLm91dHB1dEZvcm1hdCB9KSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmluaXRpYWxWYWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGVkaXRvci5zZXRDb250ZW50KHRoaXMuaW5pdGlhbFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2RpdkVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5pbml0aWFsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soZWRpdG9yLmdldENvbnRlbnQoeyBmb3JtYXQ6IHRoaXMub3V0cHV0Rm9ybWF0IH0pKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVwbGFjZUZvbnRGYW1pbHkoZWwpIHtcclxuICAgICAgICBpZiAoZWwuY2hpbGRyZW4gJiYgZWwuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgZWwuY2hpbGRyZW4ubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZUZvbnRGYW1pbHkoZWwuY2hpbGRyZW5ba10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBmZiA9IGVsLnN0eWxlLmZvbnRGYW1pbHk7XHJcbiAgICAgICAgbGV0IGZhY2UgPSBlbC5nZXRBdHRyaWJ1dGUoJ2ZhY2UnKTtcclxuICAgICAgICBpZiAoZmYpIHtcclxuICAgICAgICAgICAgbGV0IGZvbnRzID0gZmYuc3BsaXQoJywnKTtcclxuICAgICAgICAgICAgbGV0IHIgPSB0aGlzLmdldEZvbnRGYW1pbHlBcnJheShmb250cyk7XHJcbiAgICAgICAgICAgIGVsLnN0eWxlLmZvbnRGYW1pbHkgPSByO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZmFjZSkge1xyXG4gICAgICAgICAgICBsZXQgZmFjZXMgPSBmYWNlLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgICAgIGxldCByID0gdGhpcy5nZXRGb250RmFtaWx5QXJyYXkoZmFjZXMpO1xyXG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2ZhY2UnLCByKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBnZXRGb250RmFtaWx5QXJyYXkoZm9udHMsIHpjRm9udEFyciA9IHRoaXMuX2ZvbnRGYW1pbHlMaXN0KSB7XHJcbiAgICAgICAgbGV0IHNzID0gW107XHJcbiAgICAgICAgZm9udHMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgaWYgKHpjRm9udEFyci5maW5kKGYgPT4gZiA9PT0gdGhpcy50cmltKG4pKSkge1xyXG4gICAgICAgICAgICAgICAgc3MucHVzaCh0aGlzLnRyaW0obikpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGxldCByID0gc3Muam9pbignLCcpO1xyXG4gICAgICAgIGlmICghcikge1xyXG4gICAgICAgICAgICByID0gdGhpcy5fZGVmYXVsdEZvbnRGYW1pbHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdHJpbShzdHIpIHtcclxuICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL15cXHMqfFxccyokL2csICcnKTtcclxuICAgIH1cclxufVxyXG4iXX0=