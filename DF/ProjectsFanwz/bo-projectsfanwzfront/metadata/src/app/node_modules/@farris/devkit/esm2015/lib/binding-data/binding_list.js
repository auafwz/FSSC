/**
 * 绑定列表相关定义
 * @author Witt<jiwt@inspur.com>
 */
// tslint:disable: max-line-length
import { List } from 'immutable';
import { Subject } from 'rxjs';
import { ChangeType } from './changes';
import { BindingObjectFactory } from './binding_object_factory';
import { PropertyUtil } from './property_util';
import { BindingData } from './binding_data';
import { TranslateService } from '../i18n/translate_service';
/**
 * BindingList是一个BindingObject集合
 */
class BindingList {
    /**
     * 构造函数
     */
    constructor(properties) {
        this.__type__ = 'BindingList';
        //#region 分页相关
        /**
         * 分页信息
         */
        this._paginationInfo = null;
        this.properties = properties;
        this.primaryKey = PropertyUtil.getPrimaryKey(properties);
        this.changes = new Subject();
        this.innerList = List();
        this.currentId = null;
    }
    set paginationInfo(sPaginationInfo) {
        this._paginationInfo = sPaginationInfo;
        if (this._paginationInfo === sPaginationInfo) {
            return;
        }
        this.changes.next({
            type: ChangeType.PaginationInfoChange,
            path: [],
            value: this._paginationInfo
        });
    }
    get paginationInfo() {
        return this._paginationInfo;
    }
    /**
     * 获取页码
     */
    get pageIndex() {
        if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageIndex")) {
            return this.paginationInfo.pageIndex;
        }
        return 1;
    }
    /**
     * 获取分页大小
     */
    get pageSize() {
        if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageSize")) {
            return this.paginationInfo.pageSize;
        }
        return 0;
    }
    /**
     * 获取数据总项数
     */
    get total() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.total || this.paginationInfo.totalCount;
        }
        return 0;
    }
    /**
     * 获取跳过的数据条数
     */
    get skip() {
        const pageIndex = this.pageIndex;
        const pageSize = this.pageSize;
        return (pageIndex - 1) * pageSize;
    }
    /**
     * 前台设置分页信息
     * @param skip skip
     * @param take take
     */
    setPaginationInfo(skip, take) {
        this.paginationInfo = Object.assign({}, this.paginationInfo, {
            pageSize: take,
            pageIndex: skip / take + 1
        });
        /*this.changes.next({
          type: ChangeType.PaginationInfoChange,
          path: [],
          value: this.paginationInfo
        });*/
    }
    //#endregion
    /**
     * 当前行对应的绑定对象
     * 如果currentId为null，则创建一个空结构，防止绑定报错；
     */
    get currentItem() {
        const currentItem = this.findById(this.currentId);
        if (!currentItem) {
            if (!this.emptyCurrentItem) {
                this.emptyCurrentItem = BindingObjectFactory.create(this.properties);
            }
            return this.emptyCurrentItem;
        }
        return currentItem;
    }
    /**
     * 绑定对象的数量
     */
    get length() {
        return this.innerList.count();
    }
    /**
     * 添加[Symbol.iterator]，使之能通过for of遍历
     */
    [Symbol.iterator]() {
        const self = this;
        let index = -1;
        const size = this.innerList.size;
        return {
            next: function () {
                index++;
                if (index < size) {
                    return { done: false, value: self.innerList.get(index) };
                }
                return { done: true, value: undefined };
            }
        };
    }
    /**
     * 批量加载绑定对象，加载之前先清空绑定列表，并重置当前行，加载之后将第一行设置为默认当前行。
     * @param objects 要加载绑定对象数组
     */
    load(objects, entityCreate = false) {
        // 重置列表
        this.innerList = this.innerList.clear();
        if (objects.length !== 0) {
            // 加载数据
            objects.forEach((object) => {
                this.add(object);
            });
            // 设置默认当前行
            const currentItem = this.findById(this.currentId);
            if (!currentItem) {
                const firstId = objects[0][this.primaryKey];
                this.setCurrentId(firstId, false, false);
            }
        }
        else {
            this.currentId = null;
        }
        const change = {
            type: ChangeType.Load,
            path: [],
            value: objects
        };
        change.create = entityCreate;
        // 触发事件
        this.changes.next(change);
    }
    /**
     * 批量追加绑定对象，追加之后将最后一个追加的绑定对象设置为当前行。
     * @param objects 要加载绑定对象数组
     */
    append(objects, isCloned = false) {
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach((object) => {
            this.add(object);
        });
        // 当前行为新追加的最后1行
        const lastId = objects[objects.length - 1][this.primaryKey];
        this.setCurrentId(lastId, true, true);
        // 触发事件
        const change = {
            type: ChangeType.Append,
            path: [],
            value: objects
        };
        if (isCloned) {
            change.isCloned = true;
        }
        this.changes.next(change);
    }
    /**
     * 增加数据
     * @param objects 实体
     * @description 增加实体数据，但不切换当前行
     */
    addData(objects) {
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach((object) => {
            this.add(object);
        });
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: objects
        });
    }
    insert(object, position) {
        const currentIndex = this.innerList.findIndex((obj) => obj.primaryKeyValue === this.currentId);
        // 加载BindingObject
        if (position === 1) {
            this.innerList = this.innerList.insert(currentIndex + 1, object);
        }
        else if (position === -1) {
            this.innerList = this.innerList.insert(currentIndex, object);
        }
        else {
            this.innerList = this.innerList.push(object);
        }
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe((change) => {
            this.changes.next(change);
        });
        this.setCurrentId(object.primaryKeyValue, true, true);
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: object
        });
    }
    /**
     * 添加绑定对象，并建立绑定对象和绑定列表之间的关联。
     * @param object 绑定对象
     */
    add(object) {
        this.innerList = this.innerList.push(object);
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe((change) => {
            this.changes.next(change);
        });
    }
    /**
     * 删除主键值数组对应的绑定对象。
     * @param ids 主键值数组
     */
    removeByIds(ids) {
        if (!ids || ids.length === 0) {
            return;
        }
        let nextCurrentId = this.currentId;
        ids.forEach((id) => {
            // 如果当前行被删除，计算下一当前行
            if (id === nextCurrentId) {
                nextCurrentId = this.getCurrentIdBeforeDeleting();
            }
            // 删除对象，找不到时跳过
            const index = this.getIndexById(id);
            if (index === -1) {
                return;
            }
            this.innerList = this.innerList.delete(index);
        });
        // 重新设置当前行
        if (this.innerList.count() === 0) {
            this.currentId = null;
        }
        else {
            this.setCurrentId(nextCurrentId, false, false);
        }
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    }
    /**
     * 删除数据（不切换当前行）
     * @param ids ids
     */
    removeDataByIds(ids) {
        if (!ids || ids.length === 0) {
            return;
        }
        ids.forEach((id) => {
            // 删除对象，找不到时跳过
            const index = this.getIndexById(id);
            if (index === -1) {
                return;
            }
            this.innerList = this.innerList.delete(index);
        });
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    }
    /**
     * 清空
     */
    clear(clearOnly = false) {
        this.innerList.forEach((item) => {
            item.unsubscribe.next();
            item.unsubscribe.complete();
            item.changes.complete();
            item.viewChanges.complete();
            // item.properties =undefined;
        });
        this.innerList = this.innerList.clear();
        this.currentId = null;
        if (!clearOnly) {
            this.changes.next({
                type: ChangeType.Remove,
                path: [],
                value: []
            });
        }
    }
    /**
     * 如果当前行被删除，删除之前重新计算当前行的位置，并返回下一当前行的主键值。
     * - 如果被删除的行是最后1行，则上移1行；
     * - 其他情况，下移1行。
     */
    getCurrentIdBeforeDeleting() {
        let nextIndex = -1;
        const currentIndex = this.getIndexById(this.currentId);
        if (currentIndex === this.length - 1) {
            nextIndex = currentIndex - 1;
        }
        else {
            nextIndex = currentIndex + 1;
        }
        return this.getIdByIndex(nextIndex);
    }
    /**
     * 根据主键值获取对应绑定对象
     * @param   id 要查找的主键值
     * @returns 找到时返回对应BindingObject， 找不到时返回null
     */
    findById(id) {
        let target;
        target = this.innerList.find((item) => {
            return item.getValue(this.primaryKey) === id;
        });
        return target === undefined ? null : target;
    }
    /**
     * 将主键值为id的绑定对象设置为当前行
     * @param  id        要设置的主键值
     * @param  emitEvent 是否发送当前行变更事件
     * @param  force 强制切换
     */
    setCurrentId(id, emitEvent = true, emitGlobalEvent = true, force = false) {
        if (this.currentId === id && !force) {
            return;
        }
        // 不存在时设置为null
        // const currentObj = this.findById(id);
        // if (!currentObj) {
        //   this.currentId = null;
        // } else {
        //   this.currentId = id;
        // }
        // @todo：找不到时按理应该设置为null，目前是直接返回，框架部分功能依赖该特性。
        const currentObj = this.findById(id);
        if (!currentObj && !force) {
            return;
        }
        this.currentId = id;
        // 发出行切换事件
        if (emitEvent === true) {
            this.changes.next({
                type: ChangeType.SelectionChanged,
                path: [],
                value: this.currentItem,
                force
            });
        }
        // 是否发送全局的行切换事件
        if (emitGlobalEvent === true) {
            this.changes.next({
                type: ChangeType.GlobalSelectionChanged,
                path: [],
                value: this.currentItem,
                force
            });
        }
    }
    /**
     * 根据主键值为id的绑定对象的索引
     * @param id 主键值
     * @returns 找到时返回对应的index，找不到时返回-1
     */
    getIndexById(id) {
        return this.innerList.findIndex((obj) => {
            return obj[this.primaryKey] === id;
        });
    }
    /**
     * 根据索引位置获取对应绑定对象的主键值
     * @reutrn 找到时返回对应主键值，找不到返回null
     */
    getIdByIndex(index) {
        if (index < 0 || index > this.length) {
            return null;
        }
        if (this.innerList.has(index) === false) {
            return null;
        }
        const obj = this.innerList.get(index);
        return obj[this.primaryKey];
    }
    /**
     * 转换为BindingObject数组
     */
    toArray() {
        return this.innerList.toArray();
    }
    /**
     * 交互数据位置
     * @param id1 id1
     * @param id2 id2
     */
    swapById(id1, id2) {
        const item1 = this.innerList.find(element => element.primaryKeyValue === id1);
        const item2 = this.innerList.find(element => element.primaryKeyValue === id2);
        this.innerList = this.innerList.map((bindingObject, index) => {
            if (bindingObject.primaryKeyValue === id1) {
                return item2;
            }
            else if (bindingObject.primaryKeyValue === id2) {
                return item1;
            }
            else
                return bindingObject;
        }).toList();
        this.changes.next({
            type: ChangeType.Swap,
            path: []
        });
    }
    /**
     * 转换为JSON对象
     * @returns 普通对象数组
     */
    toJSON(options) {
        const result = [];
        this.innerList.forEach((obj) => {
            result.push(obj.toJSON(options));
        });
        return result;
    }
    /**
     * 获取分页信息
     * @param path 路径
     * @param defaultValue 默认值
     */
    getPaginationConfigByPath(path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());
        let config = this.paginationInfo;
        paths.forEach(item => {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    }
    /**
     * 对bindingList就行排序
     * @param string 排序字段
     * @param directions 排序规则字段
     * @param options 参数
     */
    sortBy(fields, directions, options) {
        if (!fields || fields.length < 1 || !directions || directions.length < 1) {
            throw new Error('sortBy:argument error');
        }
        // 默认升序
        const arrFields = typeof fields === 'string' ? fields.split(',') : fields || [];
        const arrDirections = typeof directions === 'string' ? directions.split(',') : directions || [];
        // 排序字段和排序方式应一致
        if (arrFields.length !== arrDirections.length || arrFields.length < 1) {
            throw new Error('sortBy:fields and directions not match');
        }
        // nage,age,total
        const comparator = (props, orders) => (item1, item2) => {
            return props.reduce((result, prop) => {
                if (result === 0) {
                    const bindingProperty = this.properties.find(item => item.name === prop);
                    let isMultiLangProp = false;
                    if (bindingProperty) {
                        isMultiLangProp = bindingProperty.enableMultiLangInput;
                    }
                    const currentLanguage = TranslateService.getCurrentLanguage();
                    const order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;
                    let item1Value = this.getValue(item1, prop, isMultiLangProp, currentLanguage);
                    let item2Value = this.getValue(item2, prop, isMultiLangProp, currentLanguage);
                    if (item1Value === null || item1Value === undefined) {
                        item1Value = '';
                    }
                    if (item2Value === null || item2Value === undefined) {
                        item2Value = '';
                    }
                    if (typeof item1Value === 'string' && typeof item2Value === 'string') {
                        const localeCompareResult = item1Value.localeCompare(item2Value);
                        result = localeCompareResult * order;
                    }
                    else {
                        if (item1Value > item2Value) {
                            result = order * 1;
                        }
                        if (item1Value < item2Value) {
                            result = order * -1;
                        }
                    }
                }
                return result;
            }, 0);
        };
        this.innerList = this.innerList.sort(comparator(arrFields, arrDirections)).toList();
    }
    getValue(target, propName, isMultiLangProp = false, currentLanguage = 'zh-CHS') {
        if (target instanceof BindingList) {
            target = target.currentItem;
        }
        else if (target instanceof BindingData) {
            target = target.list.currentItem;
        }
        let result = null;
        if (propName.indexOf('.') === -1) {
            result = target[propName];
        }
        else {
            const props = propName.split('.');
            for (const prop of props) {
                target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);
            }
        }
        if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {
            return result[currentLanguage];
        }
        else {
            return result;
        }
    }
}
export { BindingList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19saXN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2JpbmRpbmdfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFFSCxrQ0FBa0M7QUFFbEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNqQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBVSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFHL0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUU3RDs7R0FFRztBQUNILE1BQU0sV0FBVztJQXVJZjs7T0FFRztJQUNILFlBQVksVUFBNkI7UUF6SWxDLGFBQVEsR0FBRyxhQUFhLENBQUM7UUFpQ2hDLGNBQWM7UUFFZDs7V0FFRztRQUNJLG9CQUFlLEdBQVEsSUFBSSxDQUFDO1FBb0dqQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFekQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBVSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxFQUFpQixDQUFDO1FBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO0lBQ3hCLENBQUM7SUF4R0QsSUFBSSxjQUFjLENBQUMsZUFBb0I7UUFDckMsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7UUFDdkMs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QWEsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDdEYsQ0FBQztJQUNPLFFBQVEsQ0FBQyxNQUFXLEVBQUUsUUFBZ0IsRUFBRSxrQkFBMkIsS0FBSyxFQUFFLGtCQUEwQixRQUFRO1FBQ2xILElBQUksTUFBTSxZQUFZLFdBQVcsRUFBRTtZQUNqQyxNQUFNLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztTQUM3QjthQUFNLElBQUksTUFBTSxZQUFZLFdBQVcsRUFBRTtZQUN4QyxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDbEM7UUFDRCxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ2hDLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDM0I7YUFBTTtZQUNMLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEMsS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLLEVBQUU7Z0JBQ3hCLE1BQU0sR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxlQUFlLENBQUMsQ0FBQzthQUNqRjtTQUNGO1FBQ0QsSUFBSSxlQUFlLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLEVBQUU7WUFDdkUsT0FBTyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7U0FDaEM7YUFBTTtZQUNMLE9BQU8sTUFBTSxDQUFDO1NBQ2Y7SUFDSCxDQUFDO0NBQ0Y7QUFFRCxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog57uR5a6a5YiX6KGo55u45YWz5a6a5LmJXHJcbiAqIEBhdXRob3IgV2l0dDxqaXd0QGluc3B1ci5jb20+XHJcbiAqL1xyXG5cclxuLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG5cclxuaW1wb3J0IHsgTGlzdCB9IGZyb20gJ2ltbXV0YWJsZSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdPYmplY3QgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0JztcclxuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5IH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcclxuaW1wb3J0IHsgQmluZGluZ09iamVjdEZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0X2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eVV0aWwgfSBmcm9tICcuL3Byb3BlcnR5X3V0aWwnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4vYmluZGluZ19kYXRhJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJy4uL2kxOG4vdHJhbnNsYXRlX3NlcnZpY2UnO1xyXG5cclxuLyoqXHJcbiAqIEJpbmRpbmdMaXN05piv5LiA5LiqQmluZGluZ09iamVjdOmbhuWQiFxyXG4gKi9cclxuY2xhc3MgQmluZGluZ0xpc3Qge1xyXG4gIHB1YmxpYyBfX3R5cGVfXyA9ICdCaW5kaW5nTGlzdCc7XHJcbiAgLyoqXHJcbiAgICogaW1tdXRhYmxl55qEQmluZGluZ09iamVjdOWIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJMaXN0OiBMaXN0PEJpbmRpbmdPYmplY3Q+O1xyXG5cclxuICBwcml2YXRlIGVtcHR5Q3VycmVudEl0ZW06IEJpbmRpbmdPYmplY3Q7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWFs+iBlOWunuS9k+eahOWxnuaAp+mbhuWQiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog5Li76ZSu5ZCNXHJcbiAgICovXHJcbiAgcHVibGljIHByaW1hcnlLZXk6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog54i25a+56LGhXHJcbiAgICovXHJcbiAgcHVibGljIHBhcmVudDogQmluZGluZ09iamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgICog5Y+Y5pu05rWBXHJcbiAgICovXHJcbiAgcHVibGljIGNoYW5nZXM6IFN1YmplY3Q8Q2hhbmdlPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5b2T5YmN6KGM5a+55bqU55qE57uR5a6a5a+56LGh55qE5YaF56CBXHJcbiAgICovXHJcbiAgcHVibGljIGN1cnJlbnRJZDogc3RyaW5nO1xyXG5cclxuICAvLyNyZWdpb24g5YiG6aG155u45YWzXHJcblxyXG4gIC8qKlxyXG4gICAqIOWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHB1YmxpYyBfcGFnaW5hdGlvbkluZm86IGFueSA9IG51bGw7XHJcblxyXG4gIHNldCBwYWdpbmF0aW9uSW5mbyhzUGFnaW5hdGlvbkluZm86IGFueSkge1xyXG4gICAgdGhpcy5fcGFnaW5hdGlvbkluZm8gPSBzUGFnaW5hdGlvbkluZm87XHJcbiAgICBpZiAodGhpcy5fcGFnaW5hdGlvbkluZm8gPT09IHNQYWdpbmF0aW9uSW5mbykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogdGhpcy5fcGFnaW5hdGlvbkluZm9cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHBhZ2luYXRpb25JbmZvKCk6IGFueSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcGFnaW5hdGlvbkluZm87XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlumhteeggVxyXG4gICAqL1xyXG4gIGdldCBwYWdlSW5kZXgoKSB7XHJcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvICYmIHRoaXMucGFnaW5hdGlvbkluZm8uaGFzT3duUHJvcGVydHkoXCJwYWdlSW5kZXhcIikpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZUluZGV4O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDE7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhumhteWkp+Wwj1xyXG4gICAqL1xyXG4gIGdldCBwYWdlU2l6ZSgpIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8gJiYgdGhpcy5wYWdpbmF0aW9uSW5mby5oYXNPd25Qcm9wZXJ0eShcInBhZ2VTaXplXCIpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VTaXplO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmlbDmja7mgLvpobnmlbBcclxuICAgKi9cclxuICBnZXQgdG90YWwoKSB7XHJcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnRvdGFsIHx8IHRoaXMucGFnaW5hdGlvbkluZm8udG90YWxDb3VudDtcclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bot7Pov4fnmoTmlbDmja7mnaHmlbBcclxuICAgKi9cclxuICBnZXQgc2tpcCgpIHtcclxuICAgIGNvbnN0IHBhZ2VJbmRleCA9IHRoaXMucGFnZUluZGV4O1xyXG4gICAgY29uc3QgcGFnZVNpemUgPSB0aGlzLnBhZ2VTaXplO1xyXG4gICAgcmV0dXJuIChwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YmN5Y+w6K6+572u5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHNraXAgc2tpcFxyXG4gICAqIEBwYXJhbSB0YWtlIHRha2VcclxuICAgKi9cclxuICBwdWJsaWMgc2V0UGFnaW5hdGlvbkluZm8oc2tpcDogbnVtYmVyLCB0YWtlOiBudW1iZXIpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnBhZ2luYXRpb25JbmZvLCB7XHJcbiAgICAgIHBhZ2VTaXplOiB0YWtlLFxyXG4gICAgICBwYWdlSW5kZXg6IHNraXAgLyB0YWtlICsgMVxyXG4gICAgfSk7XHJcbiAgICAvKnRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiB0aGlzLnBhZ2luYXRpb25JbmZvXHJcbiAgICB9KTsqL1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuXHJcblxyXG5cclxuICAvKipcclxuICAgKiDlvZPliY3ooYzlr7nlupTnmoTnu5Hlrprlr7nosaFcclxuICAgKiDlpoLmnpxjdXJyZW50SWTkuLpudWxs77yM5YiZ5Yib5bu65LiA5Liq56m657uT5p6E77yM6Ziy5q2i57uR5a6a5oql6ZSZ77ybXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBjdXJyZW50SXRlbSgpOiBCaW5kaW5nT2JqZWN0IHtcclxuICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gdGhpcy5maW5kQnlJZCh0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICBpZiAoIWN1cnJlbnRJdGVtKSB7XHJcbiAgICAgIGlmICghdGhpcy5lbXB0eUN1cnJlbnRJdGVtKSB7XHJcbiAgICAgICAgdGhpcy5lbXB0eUN1cnJlbnRJdGVtID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlKHRoaXMucHJvcGVydGllcyk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRoaXMuZW1wdHlDdXJyZW50SXRlbTtcclxuICAgIH1cclxuICAgIHJldHVybiBjdXJyZW50SXRlbTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuWvueixoeeahOaVsOmHj1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgbGVuZ3RoKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QuY291bnQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKSB7XHJcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzO1xyXG4gICAgdGhpcy5wcmltYXJ5S2V5ID0gUHJvcGVydHlVdGlsLmdldFByaW1hcnlLZXkocHJvcGVydGllcyk7XHJcblxyXG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8Q2hhbmdlPigpO1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSBMaXN0PEJpbmRpbmdPYmplY3Q+KCk7XHJcbiAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmt7vliqBbU3ltYm9sLml0ZXJhdG9yXe+8jOS9v+S5i+iDvemAmui/h2ZvciBvZumBjeWOhlxyXG4gICAqL1xyXG4gIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBsZXQgaW5kZXggPSAtMTtcclxuICAgIGNvbnN0IHNpemUgPSB0aGlzLmlubmVyTGlzdC5zaXplO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgIGlmIChpbmRleCA8IHNpemUpIHtcclxuICAgICAgICAgIHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogc2VsZi5pbm5lckxpc3QuZ2V0KGluZGV4KSB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlLCB2YWx1ZTogdW5kZWZpbmVkIH07XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/liqDovb3nu5Hlrprlr7nosaHvvIzliqDovb3kuYvliY3lhYjmuIXnqbrnu5HlrprliJfooajvvIzlubbph43nva7lvZPliY3ooYzvvIzliqDovb3kuYvlkI7lsIbnrKzkuIDooYzorr7nva7kuLrpu5jorqTlvZPliY3ooYzjgIJcclxuICAgKiBAcGFyYW0gb2JqZWN0cyDopoHliqDovb3nu5Hlrprlr7nosaHmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgbG9hZChvYmplY3RzOiBCaW5kaW5nT2JqZWN0W10sIGVudGl0eUNyZWF0ZTogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XHJcbiAgICAvLyDph43nva7liJfooahcclxuICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QuY2xlYXIoKTtcclxuICAgIGlmIChvYmplY3RzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAvLyDliqDovb3mlbDmja5cclxuICAgICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3Q6IEJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgICB0aGlzLmFkZChvYmplY3QpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIOiuvue9rum7mOiupOW9k+WJjeihjFxyXG4gICAgICBjb25zdCBjdXJyZW50SXRlbSA9IHRoaXMuZmluZEJ5SWQodGhpcy5jdXJyZW50SWQpO1xyXG4gICAgICBpZiAoIWN1cnJlbnRJdGVtKSB7XHJcbiAgICAgICAgY29uc3QgZmlyc3RJZCA9IG9iamVjdHNbMF1bdGhpcy5wcmltYXJ5S2V5XTtcclxuICAgICAgICB0aGlzLnNldEN1cnJlbnRJZChmaXJzdElkLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBjaGFuZ2U6IENoYW5nZSA9IHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5Mb2FkLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IG9iamVjdHNcclxuICAgIH07XHJcbiAgICBjaGFuZ2UuY3JlYXRlID0gZW50aXR5Q3JlYXRlO1xyXG4gICAgLy8g6Kem5Y+R5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP6L+95Yqg57uR5a6a5a+56LGh77yM6L+95Yqg5LmL5ZCO5bCG5pyA5ZCO5LiA5Liq6L+95Yqg55qE57uR5a6a5a+56LGh6K6+572u5Li65b2T5YmN6KGM44CCXHJcbiAgICogQHBhcmFtIG9iamVjdHMg6KaB5Yqg6L2957uR5a6a5a+56LGh5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGFwcGVuZChvYmplY3RzOiBCaW5kaW5nT2JqZWN0W10sIGlzQ2xvbmVkOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcclxuICAgIGlmIChvYmplY3RzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDliqDovb1CaW5kaW5nT2JqZWN0XHJcbiAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmFkZChvYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICAvLyDlvZPliY3ooYzkuLrmlrDov73liqDnmoTmnIDlkI4x6KGMXHJcbiAgICBjb25zdCBsYXN0SWQgPSBvYmplY3RzW29iamVjdHMubGVuZ3RoIC0gMV1bdGhpcy5wcmltYXJ5S2V5XTtcclxuICAgIHRoaXMuc2V0Q3VycmVudElkKGxhc3RJZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAvLyDop6blj5Hkuovku7ZcclxuICAgIGNvbnN0IGNoYW5nZTogQ2hhbmdlID0ge1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLkFwcGVuZCxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiBvYmplY3RzXHJcbiAgICB9O1xyXG4gICAgaWYgKGlzQ2xvbmVkKSB7XHJcbiAgICAgIGNoYW5nZS5pc0Nsb25lZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlop7liqDmlbDmja5cclxuICAgKiBAcGFyYW0gb2JqZWN0cyDlrp7kvZNcclxuICAgKiBAZGVzY3JpcHRpb24g5aKe5Yqg5a6e5L2T5pWw5o2u77yM5L2G5LiN5YiH5o2i5b2T5YmN6KGMXHJcbiAgICovXHJcbiAgcHVibGljIGFkZERhdGEob2JqZWN0czogQmluZGluZ09iamVjdFtdKTogdm9pZCB7XHJcbiAgICBpZiAob2JqZWN0cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5Yqg6L29QmluZGluZ09iamVjdFxyXG4gICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3Q6IEJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgdGhpcy5hZGQob2JqZWN0KTtcclxuICAgIH0pO1xyXG4gICAgLy8g6Kem5Y+R5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuQXBwZW5kLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IG9iamVjdHNcclxuICAgIH0pO1xyXG4gIH1cclxuICBwdWJsaWMgaW5zZXJ0KG9iamVjdDogQmluZGluZ09iamVjdCwgcG9zaXRpb24/OiAxIHwgLTEpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMuaW5uZXJMaXN0LmZpbmRJbmRleCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiBvYmoucHJpbWFyeUtleVZhbHVlID09PSB0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICAvLyDliqDovb1CaW5kaW5nT2JqZWN0XHJcbiAgICBpZiAocG9zaXRpb24gPT09IDEpIHtcclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5pbnNlcnQoY3VycmVudEluZGV4ICsgMSwgb2JqZWN0KTtcclxuICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT09IC0xKSB7XHJcbiAgICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QuaW5zZXJ0KGN1cnJlbnRJbmRleCwgb2JqZWN0KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QucHVzaChvYmplY3QpO1xyXG4gICAgfVxyXG4gICAgb2JqZWN0LnBhcmVudCA9IHRoaXM7XHJcbiAgICAvLyDnm5HlkKxvYmplY3Tlj5jmm7TvvIzlubbnu6fnu63lkJHkuIrmipvvvIznlLHkuo5saXN05pyJ5b2T5YmN6KGM55qE5qaC5b+177yM5LiN6ZyA6KaB5ZyocGF0aOS4rei/veWKoOi3r+W+hFxyXG4gICAgb2JqZWN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5zZXRDdXJyZW50SWQob2JqZWN0LnByaW1hcnlLZXlWYWx1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcblxyXG4gICAgLy8g6Kem5Y+R5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuQXBwZW5kLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IG9iamVjdFxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoOe7keWumuWvueixoe+8jOW5tuW7uueri+e7keWumuWvueixoeWSjOe7keWumuWIl+ihqOS5i+mXtOeahOWFs+iBlOOAglxyXG4gICAqIEBwYXJhbSBvYmplY3Qg57uR5a6a5a+56LGhXHJcbiAgICovXHJcbiAgcHVibGljIGFkZChvYmplY3Q6IEJpbmRpbmdPYmplY3QpIHtcclxuICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QucHVzaChvYmplY3QpO1xyXG4gICAgb2JqZWN0LnBhcmVudCA9IHRoaXM7XHJcblxyXG4gICAgLy8g55uR5ZCsb2JqZWN05Y+Y5pu077yM5bm257un57ut5ZCR5LiK5oqb77yM55Sx5LqObGlzdOacieW9k+WJjeihjOeahOamguW/te+8jOS4jemcgOimgeWcqHBhdGjkuK3ov73liqDot6/lvoRcclxuICAgIG9iamVjdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5Li76ZSu5YC85pWw57uE5a+55bqU55qE57uR5a6a5a+56LGh44CCXHJcbiAgICogQHBhcmFtIGlkcyDkuLvplK7lgLzmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlJZHMoaWRzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XHJcbiAgICBpZiAoIWlkcyB8fCBpZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbmV4dEN1cnJlbnRJZCA9IHRoaXMuY3VycmVudElkO1xyXG4gICAgaWRzLmZvckVhY2goKGlkOiBzdHJpbmcpID0+IHtcclxuXHJcbiAgICAgIC8vIOWmguaenOW9k+WJjeihjOiiq+WIoOmZpO+8jOiuoeeul+S4i+S4gOW9k+WJjeihjFxyXG4gICAgICBpZiAoaWQgPT09IG5leHRDdXJyZW50SWQpIHtcclxuICAgICAgICBuZXh0Q3VycmVudElkID0gdGhpcy5nZXRDdXJyZW50SWRCZWZvcmVEZWxldGluZygpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDliKDpmaTlr7nosaHvvIzmib7kuI3liLDml7bot7Pov4dcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmdldEluZGV4QnlJZChpZCk7XHJcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5kZWxldGUoaW5kZXgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6YeN5paw6K6+572u5b2T5YmN6KGMXHJcbiAgICBpZiAodGhpcy5pbm5lckxpc3QuY291bnQoKSA9PT0gMCkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNldEN1cnJlbnRJZChuZXh0Q3VycmVudElkLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWHuuWPkeihjOWIoOmZpOS6i+S7tlxyXG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlJlbW92ZSxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiBpZHNcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliKDpmaTmlbDmja7vvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcclxuICAgKiBAcGFyYW0gaWRzIGlkc1xyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVEYXRhQnlJZHMoaWRzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XHJcbiAgICBpZiAoIWlkcyB8fCBpZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZHMuZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAvLyDliKDpmaTlr7nosaHvvIzmib7kuI3liLDml7bot7Pov4dcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmdldEluZGV4QnlJZChpZCk7XHJcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5kZWxldGUoaW5kZXgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5Ye65Y+R6KGM5Yig6Zmk5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IGlkc1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepulxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhcihjbGVhck9ubHk6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgdGhpcy5pbm5lckxpc3QuZm9yRWFjaCgoaXRlbTogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICBpdGVtLnVuc3Vic2NyaWJlLm5leHQoKTtcclxuICAgICAgaXRlbS51bnN1YnNjcmliZS5jb21wbGV0ZSgpO1xyXG4gICAgICBpdGVtLmNoYW5nZXMuY29tcGxldGUoKTtcclxuICAgICAgaXRlbS52aWV3Q2hhbmdlcy5jb21wbGV0ZSgpO1xyXG4gICAgICAvLyBpdGVtLnByb3BlcnRpZXMgPXVuZGVmaW5lZDtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5jbGVhcigpO1xyXG4gICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xyXG4gICAgaWYgKCFjbGVhck9ubHkpIHtcclxuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxyXG4gICAgICAgIHBhdGg6IFtdLFxyXG4gICAgICAgIHZhbHVlOiBbXVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWmguaenOW9k+WJjeihjOiiq+WIoOmZpO+8jOWIoOmZpOS5i+WJjemHjeaWsOiuoeeul+W9k+WJjeihjOeahOS9jee9ru+8jOW5tui/lOWbnuS4i+S4gOW9k+WJjeihjOeahOS4u+mUruWAvOOAglxyXG4gICAqIC0g5aaC5p6c6KKr5Yig6Zmk55qE6KGM5piv5pyA5ZCOMeihjO+8jOWImeS4iuenuzHooYzvvJtcclxuICAgKiAtIOWFtuS7luaDheWGte+8jOS4i+enuzHooYzjgIJcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q3VycmVudElkQmVmb3JlRGVsZXRpbmcoKTogc3RyaW5nIHtcclxuICAgIGxldCBuZXh0SW5kZXggPSAtMTtcclxuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKHRoaXMuY3VycmVudElkKTtcclxuICAgIGlmIChjdXJyZW50SW5kZXggPT09IHRoaXMubGVuZ3RoIC0gMSkge1xyXG4gICAgICBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXggLSAxO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbmV4dEluZGV4ID0gY3VycmVudEluZGV4ICsgMTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdldElkQnlJbmRleChuZXh0SW5kZXgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u5Li76ZSu5YC86I635Y+W5a+55bqU57uR5a6a5a+56LGhXHJcbiAgICogQHBhcmFtICAgaWQg6KaB5p+l5om+55qE5Li76ZSu5YC8XHJcbiAgICogQHJldHVybnMg5om+5Yiw5pe26L+U5Zue5a+55bqUQmluZGluZ09iamVjdO+8jCDmib7kuI3liLDml7bov5Tlm55udWxsXHJcbiAgICovXHJcbiAgcHVibGljIGZpbmRCeUlkKGlkOiBzdHJpbmcpOiBCaW5kaW5nT2JqZWN0IHwgbnVsbCB7XHJcbiAgICBsZXQgdGFyZ2V0OiBCaW5kaW5nT2JqZWN0O1xyXG4gICAgdGFyZ2V0ID0gdGhpcy5pbm5lckxpc3QuZmluZCgoaXRlbSkgPT4ge1xyXG4gICAgICByZXR1cm4gaXRlbS5nZXRWYWx1ZSh0aGlzLnByaW1hcnlLZXkpID09PSBpZDtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRhcmdldCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHRhcmdldDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhuS4u+mUruWAvOS4umlk55qE57uR5a6a5a+56LGh6K6+572u5Li65b2T5YmN6KGMXHJcbiAgICogQHBhcmFtICBpZCAgICAgICAg6KaB6K6+572u55qE5Li76ZSu5YC8XHJcbiAgICogQHBhcmFtICBlbWl0RXZlbnQg5piv5ZCm5Y+R6YCB5b2T5YmN6KGM5Y+Y5pu05LqL5Lu2XHJcbiAgICogQHBhcmFtICBmb3JjZSDlvLrliLbliIfmjaJcclxuICAgKi9cclxuICBwdWJsaWMgc2V0Q3VycmVudElkKGlkOiBzdHJpbmcsIGVtaXRFdmVudDogYm9vbGVhbiA9IHRydWUsIGVtaXRHbG9iYWxFdmVudDogYm9vbGVhbiA9IHRydWUsIGZvcmNlOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmN1cnJlbnRJZCA9PT0gaWQgJiYgIWZvcmNlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyDkuI3lrZjlnKjml7borr7nva7kuLpudWxsXHJcbiAgICAvLyBjb25zdCBjdXJyZW50T2JqID0gdGhpcy5maW5kQnlJZChpZCk7XHJcbiAgICAvLyBpZiAoIWN1cnJlbnRPYmopIHtcclxuICAgIC8vICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xyXG4gICAgLy8gfSBlbHNlIHtcclxuICAgIC8vICAgdGhpcy5jdXJyZW50SWQgPSBpZDtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBAdG9kb++8muaJvuS4jeWIsOaXtuaMieeQhuW6lOivpeiuvue9ruS4um51bGzvvIznm67liY3mmK/nm7TmjqXov5Tlm57vvIzmoYbmnrbpg6jliIblip/og73kvp3otZbor6XnibnmgKfjgIJcclxuICAgIGNvbnN0IGN1cnJlbnRPYmogPSB0aGlzLmZpbmRCeUlkKGlkKTtcclxuICAgIGlmICghY3VycmVudE9iaiAmJiAhZm9yY2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jdXJyZW50SWQgPSBpZDtcclxuXHJcbiAgICAvLyDlj5Hlh7rooYzliIfmjaLkuovku7ZcclxuICAgIGlmIChlbWl0RXZlbnQgPT09IHRydWUpIHtcclxuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICAgIHR5cGU6IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCxcclxuICAgICAgICBwYXRoOiBbXSxcclxuICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50SXRlbSxcclxuICAgICAgICBmb3JjZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmmK/lkKblj5HpgIHlhajlsYDnmoTooYzliIfmjaLkuovku7ZcclxuICAgIGlmIChlbWl0R2xvYmFsRXZlbnQgPT09IHRydWUpIHtcclxuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICAgIHR5cGU6IENoYW5nZVR5cGUuR2xvYmFsU2VsZWN0aW9uQ2hhbmdlZCxcclxuICAgICAgICBwYXRoOiBbXSxcclxuICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50SXRlbSxcclxuICAgICAgICBmb3JjZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruS4u+mUruWAvOS4umlk55qE57uR5a6a5a+56LGh55qE57Si5byVXHJcbiAgICogQHBhcmFtIGlkIOS4u+mUruWAvFxyXG4gICAqIEByZXR1cm5zIOaJvuWIsOaXtui/lOWbnuWvueW6lOeahGluZGV477yM5om+5LiN5Yiw5pe26L+U5ZueLTFcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0SW5kZXhCeUlkKGlkOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJMaXN0LmZpbmRJbmRleCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIHJldHVybiBvYmpbdGhpcy5wcmltYXJ5S2V5XSA9PT0gaWQ7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrue0ouW8leS9jee9ruiOt+WPluWvueW6lOe7keWumuWvueixoeeahOS4u+mUruWAvFxyXG4gICAqIEByZXV0cm4g5om+5Yiw5pe26L+U5Zue5a+55bqU5Li76ZSu5YC877yM5om+5LiN5Yiw6L+U5ZuebnVsbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRJZEJ5SW5kZXgoaW5kZXg6IG51bWJlcik6IHN0cmluZyB7XHJcblxyXG4gICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+IHRoaXMubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmlubmVyTGlzdC5oYXMoaW5kZXgpID09PSBmYWxzZSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IG9iaiA9IHRoaXMuaW5uZXJMaXN0LmdldChpbmRleCk7XHJcbiAgICByZXR1cm4gb2JqW3RoaXMucHJpbWFyeUtleV07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDovazmjaLkuLpCaW5kaW5nT2JqZWN05pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHRvQXJyYXkoKTogQmluZGluZ09iamVjdFtdIHtcclxuICAgIHJldHVybiB0aGlzLmlubmVyTGlzdC50b0FycmF5KCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS6pOS6kuaVsOaNruS9jee9rlxyXG4gICAqIEBwYXJhbSBpZDEgaWQxXHJcbiAgICogQHBhcmFtIGlkMiBpZDJcclxuICAgKi9cclxuICBwdWJsaWMgc3dhcEJ5SWQoaWQxOiBhbnksIGlkMjogYW55KSB7XHJcbiAgICBjb25zdCBpdGVtMSA9IHRoaXMuaW5uZXJMaXN0LmZpbmQoZWxlbWVudCA9PiBlbGVtZW50LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQxKTtcclxuICAgIGNvbnN0IGl0ZW0yID0gdGhpcy5pbm5lckxpc3QuZmluZChlbGVtZW50ID0+IGVsZW1lbnQucHJpbWFyeUtleVZhbHVlID09PSBpZDIpO1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5tYXAoKGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlID09PSBpZDEpIHtcclxuICAgICAgICByZXR1cm4gaXRlbTI7XHJcbiAgICAgIH0gZWxzZSBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMikge1xyXG4gICAgICAgIHJldHVybiBpdGVtMTtcclxuICAgICAgfSBlbHNlIHJldHVybiBiaW5kaW5nT2JqZWN0O1xyXG4gICAgfSkudG9MaXN0KCk7XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuU3dhcCxcclxuICAgICAgcGF0aDogW11cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDovazmjaLkuLpKU09O5a+56LGhXHJcbiAgICogQHJldHVybnMg5pmu6YCa5a+56LGh5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHRvSlNPTihvcHRpb25zPzogYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICB0aGlzLmlubmVyTGlzdC5mb3JFYWNoKChvYmo6IEJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgcmVzdWx0LnB1c2gob2JqLnRvSlNPTihvcHRpb25zKSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcclxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlIOm7mOiupOWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGg6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogYW55KSB7XHJcbiAgICBpZiAoIXBhdGggfHwgcGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBwYXRoICE9PSAnc3RyaW5nJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i3r+W+hOW/hemhu+S4uuWtl+espuS4su+8gScpO1xyXG4gICAgfVxyXG4gICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDEpO1xyXG4gICAgY29uc3QgcGF0aHMgPSBwYXRoLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0udHJpbSgpLmxlbmd0aCA+IDApLm1hcChpdGVtID0+IGl0ZW0udHJpbSgpKTtcclxuICAgIGxldCBjb25maWcgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgcGF0aHMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgaWYgKGNvbmZpZyAmJiBjb25maWcuaGFzT3duUHJvcGVydHkoaXRlbSkpIHtcclxuICAgICAgICBjb25maWcgPSBjb25maWdbaXRlbV07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uZmlnID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gISFjb25maWcgPyBjb25maWcgOiB0eXBlb2YgZGVmYXVsdFZhbHVlICE9PSAndW5kZWZpbmVkJyA/IGRlZmF1bHRWYWx1ZSA6IHVuZGVmaW5lZDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5a+5YmluZGluZ0xpc3TlsLHooYzmjpLluo9cclxuICAgKiBAcGFyYW0gc3RyaW5nIOaOkuW6j+Wtl+autVxyXG4gICAqIEBwYXJhbSBkaXJlY3Rpb25zIOaOkuW6j+inhOWImeWtl+autVxyXG4gICAqIEBwYXJhbSBvcHRpb25zIOWPguaVsFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzb3J0QnkoZmllbGRzOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBkaXJlY3Rpb25zOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogeyBbcHJvcDogc3RyaW5nXTogYW55IH0pIHtcclxuICAgIGlmICghZmllbGRzIHx8IGZpZWxkcy5sZW5ndGggPCAxIHx8ICFkaXJlY3Rpb25zIHx8IGRpcmVjdGlvbnMubGVuZ3RoIDwgMSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NvcnRCeTphcmd1bWVudCBlcnJvcicpO1xyXG4gICAgfVxyXG4gICAgLy8g6buY6K6k5Y2H5bqPXHJcbiAgICBjb25zdCBhcnJGaWVsZHM6IEFycmF5PHN0cmluZz4gPSB0eXBlb2YgZmllbGRzID09PSAnc3RyaW5nJyA/IGZpZWxkcy5zcGxpdCgnLCcpIDogZmllbGRzIHx8IFtdO1xyXG4gICAgY29uc3QgYXJyRGlyZWN0aW9uczogQXJyYXk8c3RyaW5nPiA9IHR5cGVvZiBkaXJlY3Rpb25zID09PSAnc3RyaW5nJyA/IGRpcmVjdGlvbnMuc3BsaXQoJywnKSA6IGRpcmVjdGlvbnMgfHwgW107XHJcbiAgICAvLyDmjpLluo/lrZfmrrXlkozmjpLluo/mlrnlvI/lupTkuIDoh7RcclxuICAgIGlmIChhcnJGaWVsZHMubGVuZ3RoICE9PSBhcnJEaXJlY3Rpb25zLmxlbmd0aCB8fCBhcnJGaWVsZHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NvcnRCeTpmaWVsZHMgYW5kIGRpcmVjdGlvbnMgbm90IG1hdGNoJyk7XHJcbiAgICB9XHJcbiAgICAvLyBuYWdlLGFnZSx0b3RhbFxyXG4gICAgY29uc3QgY29tcGFyYXRvciA9IChwcm9wczogQXJyYXk8c3RyaW5nPiwgb3JkZXJzOiBBcnJheTxzdHJpbmc+KSA9PiAoaXRlbTE6IEJpbmRpbmdPYmplY3QsIGl0ZW0yOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIHJldHVybiBwcm9wcy5yZWR1Y2UoKHJlc3VsdCwgcHJvcCkgPT4ge1xyXG4gICAgICAgIGlmIChyZXN1bHQgPT09IDApIHtcclxuICAgICAgICAgIGNvbnN0IGJpbmRpbmdQcm9wZXJ0eSA9IHRoaXMucHJvcGVydGllcy5maW5kKGl0ZW0gPT4gaXRlbS5uYW1lID09PSBwcm9wKTtcclxuICAgICAgICAgIGxldCBpc011bHRpTGFuZ1Byb3AgPSBmYWxzZTtcclxuICAgICAgICAgIGlmIChiaW5kaW5nUHJvcGVydHkpIHtcclxuICAgICAgICAgICAgaXNNdWx0aUxhbmdQcm9wID0gYmluZGluZ1Byb3BlcnR5LmVuYWJsZU11bHRpTGFuZ0lucHV0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgY3VycmVudExhbmd1YWdlID0gVHJhbnNsYXRlU2VydmljZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcclxuICAgICAgICAgIGNvbnN0IG9yZGVyID0gWydhc2MnXS5pbmNsdWRlcyhvcmRlcnNbcHJvcHMuaW5kZXhPZihwcm9wKV0pID8gMSA6IC0xO1xyXG4gICAgICAgICAgbGV0IGl0ZW0xVmFsdWUgPSB0aGlzLmdldFZhbHVlKGl0ZW0xLCBwcm9wLCBpc011bHRpTGFuZ1Byb3AsIGN1cnJlbnRMYW5ndWFnZSk7XHJcbiAgICAgICAgICBsZXQgaXRlbTJWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaXRlbTIsIHByb3AsIGlzTXVsdGlMYW5nUHJvcCwgY3VycmVudExhbmd1YWdlKTtcclxuXHJcbiAgICAgICAgICBpZiAoaXRlbTFWYWx1ZSA9PT0gbnVsbCB8fCBpdGVtMVZhbHVlID09PSB1bmRlZmluZWQpIHsgaXRlbTFWYWx1ZSA9ICcnOyB9XHJcbiAgICAgICAgICBpZiAoaXRlbTJWYWx1ZSA9PT0gbnVsbCB8fCBpdGVtMlZhbHVlID09PSB1bmRlZmluZWQpIHsgaXRlbTJWYWx1ZSA9ICcnOyB9XHJcblxyXG4gICAgICAgICAgaWYgKHR5cGVvZiBpdGVtMVZhbHVlID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgaXRlbTJWYWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgY29uc3QgbG9jYWxlQ29tcGFyZVJlc3VsdCA9IGl0ZW0xVmFsdWUubG9jYWxlQ29tcGFyZShpdGVtMlZhbHVlKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbG9jYWxlQ29tcGFyZVJlc3VsdCAqIG9yZGVyO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0xVmFsdWUgPiBpdGVtMlZhbHVlKSB7IHJlc3VsdCA9IG9yZGVyICogMTsgfVxyXG4gICAgICAgICAgICBpZiAoaXRlbTFWYWx1ZSA8IGl0ZW0yVmFsdWUpIHsgcmVzdWx0ID0gb3JkZXIgKiAtMTsgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9LCAwKTtcclxuICAgIH07XHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LnNvcnQoY29tcGFyYXRvcihhcnJGaWVsZHMsIGFyckRpcmVjdGlvbnMpKS50b0xpc3QoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXRWYWx1ZSh0YXJnZXQ6IGFueSwgcHJvcE5hbWU6IHN0cmluZywgaXNNdWx0aUxhbmdQcm9wOiBib29sZWFuID0gZmFsc2UsIGN1cnJlbnRMYW5ndWFnZTogc3RyaW5nID0gJ3poLUNIUycpIHtcclxuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBCaW5kaW5nTGlzdCkge1xyXG4gICAgICB0YXJnZXQgPSB0YXJnZXQuY3VycmVudEl0ZW07XHJcbiAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEJpbmRpbmdEYXRhKSB7XHJcbiAgICAgIHRhcmdldCA9IHRhcmdldC5saXN0LmN1cnJlbnRJdGVtO1xyXG4gICAgfVxyXG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XHJcbiAgICBpZiAocHJvcE5hbWUuaW5kZXhPZignLicpID09PSAtMSkge1xyXG4gICAgICByZXN1bHQgPSB0YXJnZXRbcHJvcE5hbWVdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcHJvcHMgPSBwcm9wTmFtZS5zcGxpdCgnLicpO1xyXG4gICAgICBmb3IgKGNvbnN0IHByb3Agb2YgcHJvcHMpIHtcclxuICAgICAgICB0YXJnZXQgPSByZXN1bHQgPSB0aGlzLmdldFZhbHVlKHRhcmdldCwgcHJvcCwgaXNNdWx0aUxhbmdQcm9wLCBjdXJyZW50TGFuZ3VhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoaXNNdWx0aUxhbmdQcm9wICYmIHJlc3VsdCAmJiByZXN1bHQuaGFzT3duUHJvcGVydHkoY3VycmVudExhbmd1YWdlKSkge1xyXG4gICAgICByZXR1cm4gcmVzdWx0W2N1cnJlbnRMYW5ndWFnZV07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmluZGluZ0xpc3QgfTtcclxuIl19