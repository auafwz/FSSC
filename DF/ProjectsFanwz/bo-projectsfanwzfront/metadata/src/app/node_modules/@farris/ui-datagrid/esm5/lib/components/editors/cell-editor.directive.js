/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ColumnFormatService } from '@farris/ui-common/column';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-07-29 08:14:22
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-11 11:38:58
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { DatagridComponent } from './../../datagrid.component';
import { ComponentFactoryResolver, Directive, Input, ViewContainerRef, Inject, forwardRef, ApplicationRef } from '@angular/core';
import { FormGroup, FormBuilder } from '@angular/forms';
var GridCellEditorDirective = /** @class */ (function () {
    function GridCellEditorDirective(resolver, container, app, fb, dg) {
        this.resolver = resolver;
        this.container = container;
        this.app = app;
        this.fb = fb;
        this.dg = dg;
        this.cfs = null;
        this.cfs = this.dg.inject.get(ColumnFormatService);
    }
    /**
     * @return {?}
     */
    GridCellEditorDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.column.editor) {
            this.createCellEditor();
            this.dg.dgs.cellEditorCreated.emit({ editorRef: this.componentRef, column: this.column, cellEditorRef: this });
        }
    };
    /**
     * @return {?}
     */
    GridCellEditorDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.dg.dgs.cellEditorDestory.emit({ editorRef: this.componentRef, column: this.column, cellEditorRef: this });
    };
    /**
     * @private
     * @return {?}
     */
    GridCellEditorDirective.prototype.createCellEditor = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var editorType = this.column.editor.type;
        if (!this.dg.editors[editorType]) {
            console.error("\u627E\u4E0D\u5230\u540D\u79F0\u4E3A " + editorType + " \u5BF9\u5E94\u7684\u7C7B\u3002");
            return;
        }
        /** @type {?} */
        var factory = this.resolver.resolveComponentFactory(this.dg.editors[editorType]);
        this.componentRef = this.container.createComponent(factory);
        // this.app.attachView(this.componentRef.hostView);
        this.componentRef.instance.column = this.column;
        this.componentRef.instance.group = this.group;
        this.componentRef.instance.height = this.height;
        this.componentRef.instance.controlId = (this.dg.id || 'DATAGRID_EDITOR') + '_' + this.column.field;
        this.updateControlValue();
        this.componentRef.changeDetectorRef.markForCheck();
        this.componentRef.changeDetectorRef.detectChanges();
        // this.app.tick();
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this.componentRef.instance.instance) {
                if (editorType === 'lookup') {
                    if (!_this.componentRef.instance.instance.changeDetector.destroyed) {
                        _this.componentRef.instance.instance.changeDetector.detectChanges();
                    }
                    // this.componentRef.instance['bindingData'] = this.rowData;
                }
                // if (editorType === 'textarea') {
                //     const textareaEl = this.componentRef.instance.inputElement;
                //     textareaEl.style.height = textareaEl.closest('tr').style.height;
                // }
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    GridCellEditorDirective.prototype.updateControlValue = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.group) {
            this.group['bindingData'] = this.rowData;
            if (this.group.controls[this.column.field]) {
                // if (this.column.editor.type === 'datepicker') {
                //     const dateRef = this.componentRef.instance.instance;
                //     if (dateRef) {
                //         setTimeout(() => {
                //             const { dateFormat } = dateRef.dateOpts;
                //             const val = this.cfs.format(this.value, this.rowData, {type: 'datetime', options: { format: dateFormat}});
                //             this.group.controls[this.column.field].setValue(val, { emitEvent: true });
                //         });
                //     }
                // } else {
                //     this.group.controls[this.column.field].setValue(this.value, { emitEvent: true });
                // }
                this.group.controls[this.column.field].setValue(this.value, { emitEvent: true });
            }
        }
    };
    /**
     * @return {?}
     */
    GridCellEditorDirective.prototype.hideCover = /**
     * @return {?}
     */
    function () {
        if (this.column.editor && (this.column.editor.type === 'combolist' || this.column.editor.type === 'combo-lookup')) {
            this.componentRef.instance.hide(!1);
        }
    };
    GridCellEditorDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[cell-editor]',
                },] }
    ];
    /** @nocollapse */
    GridCellEditorDirective.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ViewContainerRef },
        { type: ApplicationRef },
        { type: FormBuilder },
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] }
    ]; };
    GridCellEditorDirective.propDecorators = {
        column: [{ type: Input }],
        group: [{ type: Input }],
        rowData: [{ type: Input }],
        value: [{ type: Input }],
        height: [{ type: Input }]
    };
    return GridCellEditorDirective;
}());
export { GridCellEditorDirective };
if (false) {
    /** @type {?} */
    GridCellEditorDirective.prototype.column;
    /** @type {?} */
    GridCellEditorDirective.prototype.group;
    /** @type {?} */
    GridCellEditorDirective.prototype.rowData;
    /** @type {?} */
    GridCellEditorDirective.prototype.value;
    /** @type {?} */
    GridCellEditorDirective.prototype.height;
    /** @type {?} */
    GridCellEditorDirective.prototype.componentRef;
    /**
     * @type {?}
     * @private
     */
    GridCellEditorDirective.prototype.cfs;
    /**
     * @type {?}
     * @private
     */
    GridCellEditorDirective.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    GridCellEditorDirective.prototype.container;
    /**
     * @type {?}
     * @private
     */
    GridCellEditorDirective.prototype.app;
    /**
     * @type {?}
     * @private
     */
    GridCellEditorDirective.prototype.fb;
    /** @type {?} */
    GridCellEditorDirective.prototype.dg;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VsbC1lZGl0b3IuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2VkaXRvcnMvY2VsbC1lZGl0b3IuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7Ozs7Ozs7O0FBUy9ELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQy9ELE9BQU8sRUFDSCx3QkFBd0IsRUFFeEIsU0FBUyxFQUNULEtBQUssRUFFTCxnQkFBZ0IsRUFHaEIsTUFBTSxFQUNOLFVBQVUsRUFDVixjQUFjLEVBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHeEQ7SUFZSSxpQ0FDWSxRQUFrQyxFQUNsQyxTQUEyQixFQUMzQixHQUFtQixFQUNuQixFQUFlLEVBQzZCLEVBQXFCO1FBSmpFLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQzNCLFFBQUcsR0FBSCxHQUFHLENBQWdCO1FBQ25CLE9BQUUsR0FBRixFQUFFLENBQWE7UUFDNkIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFQckUsUUFBRyxHQUF3QixJQUFJLENBQUM7UUFTcEMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztJQUN2RCxDQUFDOzs7O0lBRUQsMENBQVE7OztJQUFSO1FBQ0ksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtZQUNwQixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUV4QixJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FB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SUFHcEMsMkNBQTBDOzs7OztJQUMxQyw0Q0FBbUM7Ozs7O0lBQ25DLHNDQUEyQjs7Ozs7SUFDM0IscUNBQXVCOztJQUN2QixxQ0FBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2x1bW5Gb3JtYXRTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vY29sdW1uJztcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wNy0yOSAwODoxNDoyMlxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xMSAxMTozODo1OFxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICcuLy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7XHJcbiAgICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBDb21wb25lbnRSZWYsXHJcbiAgICBEaXJlY3RpdmUsXHJcbiAgICBJbnB1dCxcclxuICAgIE9uSW5pdCxcclxuICAgIFZpZXdDb250YWluZXJSZWYsXHJcbiAgICBJbmplY3RvcixcclxuICAgIE9uRGVzdHJveSxcclxuICAgIEluamVjdCxcclxuICAgIGZvcndhcmRSZWYsXHJcbiAgICBBcHBsaWNhdGlvblJlZlxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uIH0gZnJvbSAnLi4vLi4vdHlwZXMnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tjZWxsLWVkaXRvcl0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgR3JpZENlbGxFZGl0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoKSBjb2x1bW46IERhdGFDb2x1bW47XHJcbiAgICBASW5wdXQoKSBncm91cDogRm9ybUdyb3VwO1xyXG4gICAgQElucHV0KCkgcm93RGF0YTogYW55O1xyXG4gICAgQElucHV0KCkgdmFsdWU6IGFueTtcclxuICAgIEBJbnB1dCgpIGhlaWdodDogYW55O1xyXG4gICAgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8YW55PjtcclxuICAgIHByaXZhdGUgY2ZzOiBDb2x1bW5Gb3JtYXRTZXJ2aWNlID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBjb250YWluZXI6IFZpZXdDb250YWluZXJSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBhcHA6IEFwcGxpY2F0aW9uUmVmLFxyXG4gICAgICAgIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLFxyXG4gICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBEYXRhZ3JpZENvbXBvbmVudCkpIHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnRcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuY2ZzID0gdGhpcy5kZy5pbmplY3QuZ2V0KENvbHVtbkZvcm1hdFNlcnZpY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDZWxsRWRpdG9yKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRnLmRncy5jZWxsRWRpdG9yQ3JlYXRlZC5lbWl0KHsgZWRpdG9yUmVmOiB0aGlzLmNvbXBvbmVudFJlZiwgY29sdW1uOiB0aGlzLmNvbHVtbiwgY2VsbEVkaXRvclJlZjogdGhpc30pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgIHRoaXMuZGcuZGdzLmNlbGxFZGl0b3JEZXN0b3J5LmVtaXQoeyBlZGl0b3JSZWY6IHRoaXMuY29tcG9uZW50UmVmLCBjb2x1bW46IHRoaXMuY29sdW1uLCBjZWxsRWRpdG9yUmVmOiB0aGlzfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVDZWxsRWRpdG9yKCkge1xyXG5cclxuICAgICAgICBjb25zdCBlZGl0b3JUeXBlID0gdGhpcy5jb2x1bW4uZWRpdG9yLnR5cGU7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZy5lZGl0b3JzW2VkaXRvclR5cGVdKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOaJvuS4jeWIsOWQjeensOS4uiAke2VkaXRvclR5cGV9IOWvueW6lOeahOexu+OAgmApO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShcclxuICAgICAgICAgICAgdGhpcy5kZy5lZGl0b3JzW2VkaXRvclR5cGVdXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudFJlZiA9IHRoaXMuY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcclxuICAgICAgICAvLyB0aGlzLmFwcC5hdHRhY2hWaWV3KHRoaXMuY29tcG9uZW50UmVmLmhvc3RWaWV3KTtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5jb2x1bW4gPSB0aGlzLmNvbHVtbjtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5ncm91cCA9IHRoaXMuZ3JvdXA7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UuY29udHJvbElkID0gKHRoaXMuZGcuaWQgfHwgJ0RBVEFHUklEX0VESVRPUicpICsgJ18nICsgdGhpcy5jb2x1bW4uZmllbGQ7XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFZhbHVlKCk7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIC8vIHRoaXMuYXBwLnRpY2soKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdG9yVHlwZSA9PT0gJ2xvb2t1cCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRlc3Ryb3llZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlWydiaW5kaW5nRGF0YSddID0gdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gaWYgKGVkaXRvclR5cGUgPT09ICd0ZXh0YXJlYScpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCB0ZXh0YXJlYUVsID0gdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UuaW5wdXRFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHRleHRhcmVhRWwuc3R5bGUuaGVpZ2h0ID0gdGV4dGFyZWFFbC5jbG9zZXN0KCd0cicpLnN0eWxlLmhlaWdodDtcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlQ29udHJvbFZhbHVlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmdyb3VwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBbJ2JpbmRpbmdEYXRhJ10gPSB0aGlzLnJvd0RhdGE7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmdyb3VwLmNvbnRyb2xzW3RoaXMuY29sdW1uLmZpZWxkXSkge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuY29sdW1uLmVkaXRvci50eXBlID09PSAnZGF0ZXBpY2tlcicpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBkYXRlUmVmID0gdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKGRhdGVSZWYpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zdCB7IGRhdGVGb3JtYXQgfSA9IGRhdGVSZWYuZGF0ZU9wdHM7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjb25zdCB2YWwgPSB0aGlzLmNmcy5mb3JtYXQodGhpcy52YWx1ZSwgdGhpcy5yb3dEYXRhLCB7dHlwZTogJ2RhdGV0aW1lJywgb3B0aW9uczogeyBmb3JtYXQ6IGRhdGVGb3JtYXR9fSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLmdyb3VwLmNvbnRyb2xzW3RoaXMuY29sdW1uLmZpZWxkXS5zZXRWYWx1ZSh2YWwsIHsgZW1pdEV2ZW50OiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuZ3JvdXAuY29udHJvbHNbdGhpcy5jb2x1bW4uZmllbGRdLnNldFZhbHVlKHRoaXMudmFsdWUsIHsgZW1pdEV2ZW50OiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXAuY29udHJvbHNbdGhpcy5jb2x1bW4uZmllbGRdLnNldFZhbHVlKHRoaXMudmFsdWUsIHsgZW1pdEV2ZW50OiB0cnVlIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGVDb3ZlcigpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4uZWRpdG9yICYmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ2NvbWJvbGlzdCcgfHwgdGhpcy5jb2x1bW4uZWRpdG9yLnR5cGUgPT09ICdjb21iby1sb29rdXAnKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5oaWRlKCExKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19