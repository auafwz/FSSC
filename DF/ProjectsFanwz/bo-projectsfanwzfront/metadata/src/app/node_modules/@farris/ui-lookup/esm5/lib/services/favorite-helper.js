/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { TreeTableComponent } from '@farris/ui-treetable';
import { FavoriteAction, FavoriteIcon, FAVORITE_FIELD_NAME, LookupGridDisplayType } from '../lookup-displaytype';
var FavoriteHelper = /** @class */ (function () {
    function FavoriteHelper(instance) {
        var _this_1 = this;
        this.instance = instance;
        this.favoriteColumnFormatter = (/**
         * @param {?} v
         * @param {?} data
         * @return {?}
         */
        function (v, data) {
            /** @type {?} */
            var f = v ? FavoriteIcon.yes : FavoriteIcon.no;
            if (_this_1.instance.isTree()) {
                /** @type {?} */
                var id = data[_this_1.instance.idField];
                if (id) {
                    /** @type {?} */
                    var tt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                    /** @type {?} */
                    var rn = tt.findRowNode(id);
                    if (rn) {
                        if (rn.node.selectable) {
                            return f;
                        }
                        else {
                            return '';
                        }
                    }
                }
            }
            return f;
        });
        this.lookupSelectionSer = this.instance.lookupSelectionSer;
    }
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoriteColumns = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var columns = this.instance.gridOptions.columns.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var rtn = Object.assign({}, item);
            if (item.field === FAVORITE_FIELD_NAME) {
                rtn.formatter = (/**
                 * @return {?}
                 */
                function () { return FavoriteIcon.delete; });
            }
            return rtn;
        }));
        return columns;
    };
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.initPersonalInfo = /**
     * @return {?}
     */
    function () {
        if (this.instance.personalConfigService) {
            /** @type {?} */
            var controlID = this.instance.el.nativeElement.id || this.instance.controlId;
            if (!controlID) {
                console.log('LookupGrid - 未设置组件id, 收藏功能将不能正常，请设置组件id.');
            }
            /** @type {?} */
            var pcstr = this.getPersonalConfigKey(controlID);
            this.instance.personalConfigService.controlID = controlID;
            this.instance.personalConfigService.personalConfigKey = pcstr;
            /** @type {?} */
            var conf = {
                displayType: this.instance.displayType,
                singleSelect: this.instance.singleSelect,
                idField: this.instance.idField,
                textField: this.instance.textField,
                mapFields: Object.assign({}, this.instance.mapFields || {})
            };
            this.instance.personalConfigService.initPersonalConf(conf);
            // 个性化配置的订阅事件处理
            this.listenPersonalConfigHandler();
        }
    };
    /**
     * @private
     * @param {?} controlID
     * @return {?}
     */
    FavoriteHelper.prototype.getPersonalConfigKey = /**
     * @private
     * @param {?} controlID
     * @return {?}
     */
    function (controlID) {
        // return this.instance.ngControl && this.instance.ngControl.name ? this.instance.ngControl.name : this.instance.mapFields
        //     ? this.instance.mapFields[this.instance.textField]
        //     : '';
        var _this_1 = this;
        if (this.instance.ngControl) {
            if (this.instance.ngControl.name) {
                return this.instance.ngControl.name;
            }
            else {
                if (this.instance.mapFields && this.instance.mapFields.length) {
                    return Object.keys(this.instance.mapFields).map((/**
                     * @param {?} k
                     * @return {?}
                     */
                    function (k) {
                        return _this_1.instance.mapFields[k];
                    })).join('_');
                }
                else {
                    return this.instance.textField;
                }
            }
        }
        else {
            return '';
        }
    };
    /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     */
    /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     * @param {?} cmpRef
     * @return {?}
     */
    FavoriteHelper.prototype.initFavoriteComponentEvent = /**
     * 监听收藏TAB页中相关事件；
     * 数据选中，取消选中，移除收藏，双击事件
     * @param {?} cmpRef
     * @return {?}
     */
    function (cmpRef) {
        var _this_1 = this;
        switch (this.instance.displayType) {
            case LookupGridDisplayType.NavList:
            case LookupGridDisplayType.NavTreeList:
            case LookupGridDisplayType.List: {
                /** @type {?} */
                var fdt_1 = (/** @type {?} */ (cmpRef.instance));
                fdt_1.remoteSort = false;
                fdt_1.selectedRow.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    if (_this_1.instance.singleSelect) {
                        _this_1.lookupSelectionSer.clearSelections();
                    }
                    _this_1.lookupSelectionSer.updateSelections(e.data);
                }));
                fdt_1.unSelectRow.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    _this_1.lookupSelectionSer.unSelect(e.data[_this_1.instance.idField]);
                }));
                if (!fdt_1.singleSelect) {
                    fdt_1.checkAll.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        _this_1.lookupSelectionSer.updateSelections(fdt_1.data, e);
                    }));
                }
                fdt_1.cellClick.subscribe((/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    if (e.col.field === FAVORITE_FIELD_NAME) {
                        e.event.stopPropagation();
                        // tslint:disable-next-line: no-string-literal
                        /** @type {?} */
                        var classList = e.event.target['classList'];
                        if (classList.contains('f-lookup-unfavorite')) {
                            if (_this_1.instance.items) {
                                _this_1.instance.items.forEach((/**
                                 * @param {?} item
                                 * @return {?}
                                 */
                                function (item) {
                                    if (item[_this_1.instance.idField] === e.row[_this_1.instance.idField]) {
                                        item[FAVORITE_FIELD_NAME] = false;
                                    }
                                }));
                                /** @type {?} */
                                var dt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                                if (dt) {
                                    dt.loadData({
                                        pageSize: _this_1.instance.gridOptions.pageSize,
                                        pageIndex: _this_1.instance.gridOptions.pageIndex,
                                        total: _this_1.instance.gridOptions.total,
                                        data: _this_1.instance.gridOptions.items
                                    });
                                }
                            }
                            _this_1.instance.favoriteItems =
                                _this_1.instance.favoriteItems.filter((/**
                                 * @param {?} n
                                 * @return {?}
                                 */
                                function (n) { return n[_this_1.instance.idField] !== e.row[_this_1.instance.idField]; }));
                            _this_1.lookupSelectionSer.updateFavoriteData(e.row, FavoriteAction.delete);
                        }
                    }
                }));
                // 双击事件
                fdt_1.rowDblClick.subscribe((/**
                 * @param {?} rowData
                 * @return {?}
                 */
                function (rowData) {
                    if (_this_1.instance.gridOptions.singleSelect) {
                        _this_1.instance.selectItem(rowData);
                    }
                }));
                break;
            }
            case LookupGridDisplayType.TreeList: {
                if (cmpRef) {
                    /** @type {?} */
                    var ftt = (/** @type {?} */ (cmpRef.instance));
                    ftt.remoteSort = false;
                    ftt.nodeSelected.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (_this_1.instance.singleSelect) {
                            _this_1.lookupSelectionSer.clearSelections();
                        }
                        _this_1.lookupSelectionSer.updateSelections(e.node.data);
                    }));
                    ftt.nodeUnChecked.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (e && e.node && e.node.data && e.node.data.id) {
                            // const tt = this.instance.componentRef.instance as TreeTableComponent;
                            // tt.unSelectNode(e.node.data.id);
                            _this_1.lookupSelectionSer.unSelect(e.node.data.id);
                        }
                    }));
                    ftt.nodeChecked.subscribe((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        if (!_this_1.instance.singleSelect) {
                            if (e.nodes && e.nodes.length) {
                                _this_1.instance.multiSelMgr.updateSelections(e.nodes.map((/**
                                 * @param {?} n
                                 * @return {?}
                                 */
                                function (n) { return n.data; })));
                            }
                            else {
                                if (Array.isArray(e.node)) {
                                    _this_1.instance.multiSelMgr.updateSelections(e.node.map((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    function (n) { return n.data; })));
                                }
                                else {
                                    _this_1.instance.multiSelMgr.updateSelections([e.node.data]);
                                }
                            }
                        }
                    }));
                    ftt.cellClick.subscribe((/**
                     * @param {?} row
                     * @return {?}
                     */
                    function (row) {
                        if (row.col.field === FAVORITE_FIELD_NAME) {
                            row.event.stopPropagation();
                            /** @type {?} */
                            var classList = row.event.target['classList'];
                            if (classList.contains('f-lookup-unfavorite')) {
                                /** @type {?} */
                                var _this_2 = _this_1.instance;
                                ((/**
                                 * @param {?} items
                                 * @return {?}
                                 */
                                function every(items) {
                                    /** @type {?} */
                                    var hasFinish = false;
                                    items.forEach((/**
                                     * @param {?} item
                                     * @return {?}
                                     */
                                    function (item) {
                                        if (hasFinish) {
                                            return;
                                        }
                                        if (item.data[_this_2.idField] === row.node[_this_2.idField]) {
                                            item.data[FAVORITE_FIELD_NAME] = false;
                                            hasFinish = true;
                                        }
                                        else if (item.children && item.children.length > 0) {
                                            every(item.children);
                                        }
                                    }));
                                }))(_this_1.instance.items);
                                /** @type {?} */
                                var tt = (/** @type {?} */ (_this_1.instance.componentRef.instance));
                                tt.loadData(_this_1.instance.items);
                                _this_1.lookupSelectionSer.updateFavoriteData(row.node.data, FavoriteAction.delete);
                            }
                        }
                    }));
                    ftt.dblClick.subscribe((/**
                     * @param {?} treeNode
                     * @return {?}
                     */
                    function (treeNode) {
                        if (_this_1.instance.gridOptions.singleSelect && treeNode.selectable) {
                            if (_this_1.instance.okButton) {
                                _this_1.instance.okButton.nativeElement.click();
                            }
                        }
                    }));
                }
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoritData = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.instance.personalConf) {
            /** @type {?} */
            var favData = this.instance.personalConf.favorite;
            /** @type {?} */
            var _data = (favData && favData[this.instance.localService.localeId]) ? favData[this.instance.localService.localeId] : [];
            return _data;
        }
        return [];
    };
    /**
     * @return {?}
     */
    FavoriteHelper.prototype.getFavoritIds = /**
     * @return {?}
     */
    function () {
        return this.getFavoritData();
    };
    /**
     * @param {?=} data
     * @return {?}
     */
    FavoriteHelper.prototype._loadFavoriteData = /**
     * @param {?=} data
     * @return {?}
     */
    function (data) {
        if (data === void 0) { data = null; }
        /** @type {?} */
        var fdt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
        this.loadFavoriteDatatable(fdt, data);
        fdt.cd.markForCheck();
        this.instance.closeLoading();
    };
    // 加载收藏grid数据
    // 加载收藏grid数据
    /**
     * @param {?=} res
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoritesData = 
    // 加载收藏grid数据
    /**
     * @param {?=} res
     * @return {?}
     */
    function (res) {
        if (res === void 0) { res = null; }
        /** @type {?} */
        var favIds = this.getFavoritIds();
        switch (this.instance.displayType) {
            case LookupGridDisplayType.NavList:
            case LookupGridDisplayType.NavTreeList:
            case LookupGridDisplayType.List: {
                /** @type {?} */
                var fdt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
                if (this.instance.favoriteDataFrom === 'locale') {
                    if (res) {
                        this._loadFavoriteData(res.items);
                    }
                    else {
                        // this.instance.httpMgr.getFavoriteData(favIds).subscribe(resData => {
                        //     if (resData) {
                        //         this._loadFavoriteData(resData.items);
                        //     }
                        //     this.instance.closeLoading();
                        // });
                    }
                }
                else {
                    /** @type {?} */
                    var favData = this.getFavoritData();
                    this.loadFavoriteDatatable(fdt, res ? res.items : favData);
                }
                break;
            }
            case LookupGridDisplayType.TreeList: {
                if (this.instance.favoritesComponentRef && this.instance.favoritesComponentRef.instance instanceof TreeTableComponent) {
                    /** @type {?} */
                    var ftt = (/** @type {?} */ (this.instance.favoritesComponentRef.instance));
                    this.bindFavTreetable(ftt);
                    if (this.instance.favoriteDataFrom === 'locale') {
                        if (res) {
                            this.loadFavoriteForTreeTable(res.items || [], ftt);
                        }
                        else {
                            // this.instance.httpMgr.getFavoriteData(favIds).subscribe(resData => {
                            //     if (resData) {
                            //         const items = resData.items;
                            //         this.loadFavoriteForTreeTable(items, ftt);
                            //     }
                            //     this.instance.closeLoading();
                            // });
                        }
                    }
                    else {
                        if (res) {
                            this.loadFavoriteForTreeTable(res.items, ftt);
                        }
                    }
                }
            }
        }
    };
    /**
     * @private
     * @param {?} fdt
     * @param {?=} data
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoriteDatatable = /**
     * @private
     * @param {?} fdt
     * @param {?=} data
     * @return {?}
     */
    function (fdt, data) {
        if (data !== undefined) {
            this.instance.favoriteItems = data;
        }
        if (fdt.columns && !fdt.columns.length) {
            fdt.columns = this.instance.favoriteColumns;
        }
        fdt.loadData({
            total: 0,
            pageSize: 20,
            pageIndex: 1,
            data: this.instance.favoriteItems
        });
        this.instance.selectionMgr.selectCurrentValue();
        fdt.cd.detectChanges();
    };
    /**
     * @private
     * @param {?} ftt
     * @return {?}
     */
    FavoriteHelper.prototype.bindFavTreetable = /**
     * @private
     * @param {?} ftt
     * @return {?}
     */
    function (ftt) {
        var _this_1 = this;
        ftt.allColumnsTitle = this.instance.allColumnsTitle;
        ftt.idField = this.instance.idField;
        /** @type {?} */
        var columns = this.instance.gridOptions.columns.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var rtn = tslib_1.__assign({}, item);
            if (item.field === FAVORITE_FIELD_NAME) {
                rtn.formatter = (/**
                 * @param {?} v
                 * @param {?} data
                 * @return {?}
                 */
                function (v, data) {
                    /** @type {?} */
                    var favids = _this_1.getFavoritIds();
                    if (favids && favids.length) {
                        /** @type {?} */
                        var index = favids.findIndex((/**
                         * @param {?} el
                         * @return {?}
                         */
                        function (el) { return el === data[_this_1.instance.idField]; }));
                        if (index >= 0) {
                            return FavoriteIcon.delete;
                        }
                    }
                    return '';
                });
            }
            return rtn;
        }));
        this.instance.favoriteColumns = columns;
        ftt.columns = columns;
        if (this.instance.gridOptions.treeInfo) {
            ftt.onlySelectLeaf = this.instance.gridOptions.treeInfo.onlySelectLeaf;
        }
        if (!ftt.singleSelect) {
            ftt.checkOnSelect = true;
            ftt.selectOnCheck = true;
            ftt.showCheckbox = true;
            // 启用多选后，同时启用级联选择
            // 启用多选后，同时启用级联选择
            if (this.instance.enableCascade) {
                this.instance.ttEventMgr.cascadeValueChanged(this.instance.cascadeStatus);
            }
            else {
                ftt.cascadeCheck = false;
                ftt.cascadeDown = false;
                ftt.cascadeUp = false;
            }
        }
    };
    /**
     * @param {?} items
     * @return {?}
     */
    FavoriteHelper.prototype.initFavoriteTreeData = /**
     * @param {?} items
     * @return {?}
     */
    function (items) {
        /** @type {?} */
        var treeInfo = this.instance.gridOptions.treeInfo;
        if (treeInfo && !treeInfo['treeDataIsInit']) {
            if (treeInfo.layerType.toLowerCase() === 'pathcode') {
                items = this.instance.lookupUtils.makeTree(items, treeInfo);
            }
            else {
                items = this.instance.lookupUtils.makeTreeWithParentID(items, '', treeInfo.dataField + "." + treeInfo.parentField, this.instance.idField);
            }
        }
        return this.instance.checkNodeCanBeSelect(items, true);
    };
    /**
     * @param {?} items
     * @param {?} ftt
     * @return {?}
     */
    FavoriteHelper.prototype.loadFavoriteForTreeTable = /**
     * @param {?} items
     * @param {?} ftt
     * @return {?}
     */
    function (items, ftt) {
        items = this.initFavoriteTreeData(items);
        this.instance.favoriteItems = items;
        ftt.loadData(items);
        ftt.expandAll();
        this.instance.selectionMgr.selectCurrentValue();
        return items;
    };
    // 更新列表中的收藏数据标识
    // 更新列表中的收藏数据标识
    /**
     * @param {?} data
     * @return {?}
     */
    FavoriteHelper.prototype.updateFavoritesStatus = 
    // 更新列表中的收藏数据标识
    /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this_1 = this;
        if (!data || !this.instance.useFavorite) {
            return;
        }
        /** @type {?} */
        var favIds = this.getFavoritIds();
        if (favIds && favIds.length) {
            // 处理数据列表中的收藏数据标识
            if (this.instance.displayType !== LookupGridDisplayType.TreeList) {
                data.map((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    if (favIds && favIds.length && favIds.find((/**
                     * @param {?} v
                     * @return {?}
                     */
                    function (v) { return v === item[_this_1.instance.idField]; }))) {
                        item[FAVORITE_FIELD_NAME] = true;
                    }
                }));
            }
            else {
                /** @type {?} */
                var _this_3 = this.instance;
                ((/**
                 * @param {?} _data
                 * @return {?}
                 */
                function each(_data) {
                    _data.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        if (favIds && favIds.length && favIds.find((/**
                         * @param {?} v
                         * @return {?}
                         */
                        function (v) { return v === item.data[_this_3.idField]; }))) {
                            item.data[FAVORITE_FIELD_NAME] = true;
                        }
                        if (item.children && item.children.length > 0) {
                            each(item.children);
                        }
                    }));
                }))(data);
            }
        }
    };
    /**
     * @private
     * @param {?} value
     * @param {?} action
     * @return {?}
     */
    FavoriteHelper.prototype._updateFavorites = /**
     * @private
     * @param {?} value
     * @param {?} action
     * @return {?}
     */
    function (value, action) {
        var _this_1 = this;
        /** @type {?} */
        var localeID = this.instance.localService.localeId;
        this.instance.personalConf.favorite = this.instance.personalConf.favorite || {};
        /** @type {?} */
        var items = value.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return !n['_addtional_']; }));
        /** @type {?} */
        var newVal = items.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n[_this_1.instance.idField]; })).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n !== null && n !== undefined; }));
        // const favIds = this.instance.personalConf.favorite[localeID] || [];
        this.instance.personalConf.favorite[localeID] = newVal;
        return newVal;
    };
    // 收藏数据管理
    // 收藏数据管理
    /**
     * @private
     * @return {?}
     */
    FavoriteHelper.prototype.listenPersonalConfigHandler = 
    // 收藏数据管理
    /**
     * @private
     * @return {?}
     */
    function () {
        var _this_1 = this;
        this.lookupSelectionSer.favoriteItems$.subscribe((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (!_this_1.instance.favoritesComponentRef) {
                return;
            }
            var items = n.items, action = n.action;
            /** @type {?} */
            var favids = _this_1._updateFavorites(items, action);
            _this_1.instance.httpMgr.submitFavoriteData(action);
            if (_this_1.instance.displayType === LookupGridDisplayType.List || _this_1.instance.displayType.includes('NAV')) {
                /** @type {?} */
                var dt = (/** @type {?} */ (_this_1.instance.favoritesComponentRef.instance));
                _this_1.loadFavoriteDatatable(dt, items);
            }
            else if (_this_1.instance.displayType === LookupGridDisplayType.TreeList) {
                /** @type {?} */
                var ftt_1 = (/** @type {?} */ (_this_1.instance.favoritesComponentRef.instance));
                // const favids = items.map(d => d.id);
                _this_1.instance.showLoading();
                _this_1.instance.httpMgr.getData({ favoriteIds: favids }, 'fav').subscribe((/**
                 * @param {?} resData
                 * @return {?}
                 */
                function (resData) {
                    if (resData) {
                        /** @type {?} */
                        var _items = resData.items;
                        _this_1.loadFavoriteForTreeTable(_items, ftt_1);
                    }
                    else {
                        _this_1.instance.favoriteItems = [];
                        ftt_1.loadData([]);
                    }
                    _this_1.instance.closeLoading();
                }));
            }
        }));
    };
    return FavoriteHelper;
}());
export { FavoriteHelper };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FavoriteHelper.prototype.lookupSelectionSer;
    /** @type {?} */
    FavoriteHelper.prototype.favoriteColumnFormatter;
    /**
     * @type {?}
     * @private
     */
    FavoriteHelper.prototype.instance;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2b3JpdGUtaGVscGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1sb29rdXAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZmF2b3JpdGUtaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsbUJBQW1CLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUtqSDtJQUlJLHdCQUFvQixRQUE2QjtRQUFqRCxtQkFFQztRQUZtQixhQUFRLEdBQVIsUUFBUSxDQUFxQjtRQWVqRCw0QkFBdUI7Ozs7O1FBQUcsVUFBQyxDQUFNLEVBQUUsSUFBUzs7Z0JBQ2xDLENBQUMsR0FBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQ2pELElBQUksT0FBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsRUFBRTs7b0JBQ2xCLEVBQUUsR0FBRyxJQUFJLENBQUMsT0FBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7Z0JBQ3RDLElBQUksRUFBRSxFQUFFOzt3QkFDRSxFQUFFLEdBQUcsbUJBQUEsT0FBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFzQjs7d0JBQzlELEVBQUUsR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztvQkFDN0IsSUFBSSxFQUFFLEVBQUU7d0JBQ0osSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTs0QkFDcEIsT0FBTyxDQUFDLENBQUM7eUJBQ1o7NkJBQU07NEJBQ0gsT0FBTyxFQUFFLENBQUM7eUJBQ2I7cUJBQ0o7aUJBQ0o7YUFDSjtZQUNELE9BQU8sQ0FBQyxDQUFDO1FBQ2IsQ0FBQyxFQUFBO1FBL0JHLElBQUksQ0FBQyxrQkFBa0Is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Q2pDLEtBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ3BCO29CQUNELE9BQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLENBQUM7Z0JBQ2pDLENBQUMsRUFBQyxDQUFDO2FBQ047UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7SUFFTCxxQkFBQztBQUFELENBQUMsQUFyZEQsSUFxZEM7Ozs7Ozs7SUFuZEcsNENBQW1EOztJQWlCbkQsaURBaUJDOzs7OztJQWhDVyxrQ0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhdGFibGUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBVc2VyRmF2b3JpdGVEYXRhIH0gZnJvbSAnLi4vaHR0cC9SZW1vdGVQYXJhbXMnO1xyXG5pbXBvcnQgeyBGYXZvcml0ZUFjdGlvbiwgRmF2b3JpdGVJY29uLCBGQVZPUklURV9GSUVMRF9OQU1FLCBMb29rdXBHcmlkRGlzcGxheVR5cGUgfSBmcm9tICcuLi9sb29rdXAtZGlzcGxheXR5cGUnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkUmVzdWx0IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICcuLi9sb29rdXAtZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBMb29rdXBTZWxlY3Rpb25TZXJ2aWNlIH0gZnJvbSAnLi9sb29rdXAtc2VsZWN0aW9uLnNlcnZpY2UnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZhdm9yaXRlSGVscGVyIHtcclxuXHJcbiAgICBwcml2YXRlIGxvb2t1cFNlbGVjdGlvblNlcjogTG9va3VwU2VsZWN0aW9uU2VydmljZTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluc3RhbmNlOiBMb29rdXBHcmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIgPSB0aGlzLmluc3RhbmNlLmxvb2t1cFNlbGVjdGlvblNlcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXRGYXZvcml0ZUNvbHVtbnMoKTogYW55W10ge1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLmNvbHVtbnMubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBydG4gPSBPYmplY3QuYXNzaWduKHt9LCBpdGVtKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uZmllbGQgPT09IEZBVk9SSVRFX0ZJRUxEX05BTUUpIHtcclxuICAgICAgICAgICAgICAgIHJ0bi5mb3JtYXR0ZXIgPSAoKSA9PiBGYXZvcml0ZUljb24uZGVsZXRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBydG47XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGNvbHVtbnM7XHJcbiAgICB9XHJcblxyXG4gICAgZmF2b3JpdGVDb2x1bW5Gb3JtYXR0ZXIgPSAodjogYW55LCBkYXRhOiBhbnkgICkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGYgPSAgdiA/IEZhdm9yaXRlSWNvbi55ZXMgOiBGYXZvcml0ZUljb24ubm87XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuaXNUcmVlKCkpIHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSBkYXRhW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF07XHJcbiAgICAgICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHQgPSB0aGlzLmluc3RhbmNlLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBybiA9IHR0LmZpbmRSb3dOb2RlKGlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChybikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChybi5ub2RlLnNlbGVjdGFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGY7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZjtcclxuICAgIH1cclxuXHJcbiAgICBpbml0UGVyc29uYWxJbmZvKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZmlnU2VydmljZSkge1xyXG4gICAgICAgICAgICBjb25zdCBjb250cm9sSUQgPSB0aGlzLmluc3RhbmNlLmVsLm5hdGl2ZUVsZW1lbnQuaWQgfHwgdGhpcy5pbnN0YW5jZS5jb250cm9sSWQ7XHJcbiAgICAgICAgICAgIGlmICghY29udHJvbElEKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTG9va3VwR3JpZCAtIOacquiuvue9rue7hOS7tmlkLCDmlLbol4/lip/og73lsIbkuI3og73mraPluLjvvIzor7forr7nva7nu4Tku7ZpZC4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBwY3N0ciA9IHRoaXMuZ2V0UGVyc29uYWxDb25maWdLZXkoY29udHJvbElEKTtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmZpZ1NlcnZpY2UuY29udHJvbElEID0gY29udHJvbElEO1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZmlnU2VydmljZS5wZXJzb25hbENvbmZpZ0tleSA9IHBjc3RyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY29uZiA9IHtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlUeXBlOiB0aGlzLmluc3RhbmNlLmRpc3BsYXlUeXBlLFxyXG4gICAgICAgICAgICAgICAgc2luZ2xlU2VsZWN0OiB0aGlzLmluc3RhbmNlLnNpbmdsZVNlbGVjdCxcclxuICAgICAgICAgICAgICAgIGlkRmllbGQ6IHRoaXMuaW5zdGFuY2UuaWRGaWVsZCxcclxuICAgICAgICAgICAgICAgIHRleHRGaWVsZDogdGhpcy5pbnN0YW5jZS50ZXh0RmllbGQsXHJcbiAgICAgICAgICAgICAgICBtYXBGaWVsZHM6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW5zdGFuY2UubWFwRmllbGRzIHx8IHt9KVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5wZXJzb25hbENvbmZpZ1NlcnZpY2UuaW5pdFBlcnNvbmFsQ29uZihjb25mKTtcclxuXHJcbiAgICAgICAgICAgIC8vIOS4quaAp+WMlumFjee9rueahOiuoumYheS6i+S7tuWkhOeQhlxyXG4gICAgICAgICAgICB0aGlzLmxpc3RlblBlcnNvbmFsQ29uZmlnSGFuZGxlcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFBlcnNvbmFsQ29uZmlnS2V5KGNvbnRyb2xJRCkge1xyXG4gICAgICAgIC8vIHJldHVybiB0aGlzLmluc3RhbmNlLm5nQ29udHJvbCAmJiB0aGlzLmluc3RhbmNlLm5nQ29udHJvbC5uYW1lID8gdGhpcy5pbnN0YW5jZS5uZ0NvbnRyb2wubmFtZSA6IHRoaXMuaW5zdGFuY2UubWFwRmllbGRzXHJcbiAgICAgICAgLy8gICAgID8gdGhpcy5pbnN0YW5jZS5tYXBGaWVsZHNbdGhpcy5pbnN0YW5jZS50ZXh0RmllbGRdXHJcbiAgICAgICAgLy8gICAgIDogJyc7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlLm5nQ29udHJvbCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5uZ0NvbnRyb2wubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2UubmdDb250cm9sLm5hbWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5tYXBGaWVsZHMgJiYgdGhpcy5pbnN0YW5jZS5tYXBGaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuaW5zdGFuY2UubWFwRmllbGRzKS5tYXAoayA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlLm1hcEZpZWxkc1trXTtcclxuICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCdfJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlLnRleHRGaWVsZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55uR5ZCs5pS26JePVEFC6aG15Lit55u45YWz5LqL5Lu277ybXHJcbiAgICAgKiDmlbDmja7pgInkuK3vvIzlj5bmtojpgInkuK3vvIznp7vpmaTmlLbol4/vvIzlj4zlh7vkuovku7ZcclxuICAgICAqL1xyXG4gICAgaW5pdEZhdm9yaXRlQ29tcG9uZW50RXZlbnQoY21wUmVmOiBDb21wb25lbnRSZWY8YW55Pikge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5pbnN0YW5jZS5kaXNwbGF5VHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZMaXN0OlxyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5OYXZUcmVlTGlzdDpcclxuICAgICAgICAgICAgY2FzZSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTGlzdDoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmR0ID0gY21wUmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgIGZkdC5yZW1vdGVTb3J0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmZHQuc2VsZWN0ZWRSb3cuc3Vic2NyaWJlKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBmZHQudW5TZWxlY3RSb3cuc3Vic2NyaWJlKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVuU2VsZWN0KGUuZGF0YVt0aGlzLmluc3RhbmNlLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZmR0LnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZkdC5jaGVja0FsbC5zdWJzY3JpYmUoZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoZmR0LmRhdGEsIGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZkdC5jZWxsQ2xpY2suc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5jb2wuZmllbGQgPT09IEZBVk9SSVRFX0ZJRUxEX05BTUUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc0xpc3QgPSBlLmV2ZW50LnRhcmdldFsnY2xhc3NMaXN0J107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ2YtbG9va3VwLXVuZmF2b3JpdGUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLml0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0gPT09IGUucm93W3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bRkFWT1JJVEVfRklFTERfTkFNRV0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuaW5zdGFuY2UuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIERhdGFUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHQubG9hZERhdGEoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMucGFnZVNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMucGFnZUluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMudG90YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLml0ZW1zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmZhdm9yaXRlSXRlbXMgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuZmF2b3JpdGVJdGVtcy5maWx0ZXIobiA9PiBuW3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0gIT09IGUucm93W3RoaXMuaW5zdGFuY2UuaWRGaWVsZF0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZUZhdm9yaXRlRGF0YShlLnJvdywgRmF2b3JpdGVBY3Rpb24uZGVsZXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIOWPjOWHu+S6i+S7tlxyXG4gICAgICAgICAgICAgICAgZmR0LnJvd0RibENsaWNrLnN1YnNjcmliZSgocm93RGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uuc2VsZWN0SXRlbShyb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgTG9va3VwR3JpZERpc3BsYXlUeXBlLlRyZWVMaXN0OiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY21wUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnR0ID0gY21wUmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICBmdHQucmVtb3RlU29ydCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5ub2RlU2VsZWN0ZWQuc3Vic2NyaWJlKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZVNlbGVjdGlvbnMoZS5ub2RlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5ub2RlVW5DaGVja2VkLnN1YnNjcmliZShlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgJiYgZS5ub2RlICYmIGUubm9kZS5kYXRhICYmIGUubm9kZS5kYXRhLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCB0dCA9IHRoaXMuaW5zdGFuY2UuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHR0LnVuU2VsZWN0Tm9kZShlLm5vZGUuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51blNlbGVjdChlLm5vZGUuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZnR0Lm5vZGVDaGVja2VkLnN1YnNjcmliZSggZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnN0YW5jZS5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVzICYmIGUubm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGUubm9kZXMubWFwKG4gPT4gbi5kYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUubm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5tdWx0aVNlbE1nci51cGRhdGVTZWxlY3Rpb25zKGUubm9kZS5tYXAobiA9PiBuLmRhdGEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLm11bHRpU2VsTWdyLnVwZGF0ZVNlbGVjdGlvbnMoW2Uubm9kZS5kYXRhXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZ0dC5jZWxsQ2xpY2suc3Vic2NyaWJlKHJvdyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY29sLmZpZWxkID09PSBGQVZPUklURV9GSUVMRF9OQU1FKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc0xpc3QgPSByb3cuZXZlbnQudGFyZ2V0WydjbGFzc0xpc3QnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ2YtbG9va3VwLXVuZmF2b3JpdGUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IF90aGlzID0gdGhpcy5pbnN0YW5jZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gZXZlcnkoaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGhhc0ZpbmlzaCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0ZpbmlzaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGFbX3RoaXMuaWRGaWVsZF0gPT09IHJvdy5ub2RlW190aGlzLmlkRmllbGRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhW0ZBVk9SSVRFX0ZJRUxEX05BTUVdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzRmluaXNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5jaGlsZHJlbiAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVyeShpdGVtLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkodGhpcy5pbnN0YW5jZS5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHQgPSB0aGlzLmluc3RhbmNlLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQubG9hZERhdGEodGhpcy5pbnN0YW5jZS5pdGVtcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLnVwZGF0ZUZhdm9yaXRlRGF0YShyb3cubm9kZS5kYXRhLCBGYXZvcml0ZUFjdGlvbi5kZWxldGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZnR0LmRibENsaWNrLnN1YnNjcmliZSgodHJlZU5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLnNpbmdsZVNlbGVjdCAmJiB0cmVlTm9kZS5zZWxlY3RhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5va0J1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uub2tCdXR0b24ubmF0aXZlRWxlbWVudC5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0RmF2b3JpdERhdGEoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UucGVyc29uYWxDb25mKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZhdkRhdGEgPSB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZi5mYXZvcml0ZTtcclxuICAgICAgICAgICAgY29uc3QgX2RhdGEgPSAoZmF2RGF0YSAmJiBmYXZEYXRhW3RoaXMuaW5zdGFuY2UubG9jYWxTZXJ2aWNlLmxvY2FsZUlkXSkgPyBmYXZEYXRhW3RoaXMuaW5zdGFuY2UubG9jYWxTZXJ2aWNlLmxvY2FsZUlkXSA6IFtdO1xyXG4gICAgICAgICAgICByZXR1cm4gX2RhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRGYXZvcml0SWRzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEZhdm9yaXREYXRhKCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2xvYWRGYXZvcml0ZURhdGEoZGF0YSA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBmZHQgPSB0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgdGhpcy5sb2FkRmF2b3JpdGVEYXRhdGFibGUoZmR0LCBkYXRhKTtcclxuICAgICAgICBmZHQuY2QubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jbG9zZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDliqDovb3mlLbol49ncmlk5pWw5o2uXHJcbiAgICBsb2FkRmF2b3JpdGVzRGF0YShyZXMgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgZmF2SWRzID0gdGhpcy5nZXRGYXZvcml0SWRzKCk7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmluc3RhbmNlLmRpc3BsYXlUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdkxpc3Q6XHJcbiAgICAgICAgICAgIGNhc2UgTG9va3VwR3JpZERpc3BsYXlUeXBlLk5hdlRyZWVMaXN0OlxyXG4gICAgICAgICAgICBjYXNlIExvb2t1cEdyaWREaXNwbGF5VHlwZS5MaXN0OiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmZHQgPSB0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5mYXZvcml0ZURhdGFGcm9tID09PSAnbG9jYWxlJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZEZhdm9yaXRlRGF0YShyZXMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zdGFuY2UuaHR0cE1nci5nZXRGYXZvcml0ZURhdGEoZmF2SWRzKS5zdWJzY3JpYmUocmVzRGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICBpZiAocmVzRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuX2xvYWRGYXZvcml0ZURhdGEocmVzRGF0YS5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmluc3RhbmNlLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZhdkRhdGEgPSB0aGlzLmdldEZhdm9yaXREYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRmF2b3JpdGVEYXRhdGFibGUoZmR0LCByZXMgPyByZXMuaXRlbXMgOiBmYXZEYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgTG9va3VwR3JpZERpc3BsYXlUeXBlLlRyZWVMaXN0OiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYgJiYgdGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2UgaW5zdGFuY2VvZiBUcmVlVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdHQgPSB0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kRmF2VHJlZXRhYmxlKGZ0dCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmZhdm9yaXRlRGF0YUZyb20gPT09ICdsb2NhbGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEZhdm9yaXRlRm9yVHJlZVRhYmxlKHJlcy5pdGVtcyB8fCBbXSwgZnR0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zdGFuY2UuaHR0cE1nci5nZXRGYXZvcml0ZURhdGEoZmF2SWRzKS5zdWJzY3JpYmUocmVzRGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgaWYgKHJlc0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgY29uc3QgaXRlbXMgPSByZXNEYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLmxvYWRGYXZvcml0ZUZvclRyZWVUYWJsZShpdGVtcywgZnR0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5pbnN0YW5jZS5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRmF2b3JpdGVGb3JUcmVlVGFibGUocmVzLml0ZW1zLCBmdHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9hZEZhdm9yaXRlRGF0YXRhYmxlKGZkdDogRGF0YVRhYmxlQ29tcG9uZW50LCBkYXRhPzogYW55KSB7XHJcbiAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLmZhdm9yaXRlSXRlbXMgPSBkYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGZkdC5jb2x1bW5zICYmICFmZHQuY29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgZmR0LmNvbHVtbnMgPSB0aGlzLmluc3RhbmNlLmZhdm9yaXRlQ29sdW1ucztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZkdC5sb2FkRGF0YSh7XHJcbiAgICAgICAgICAgIHRvdGFsOiAwLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogMjAsXHJcbiAgICAgICAgICAgIHBhZ2VJbmRleDogMSxcclxuICAgICAgICAgICAgZGF0YTogdGhpcy5pbnN0YW5jZS5mYXZvcml0ZUl0ZW1zXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB0aGlzLmluc3RhbmNlLnNlbGVjdGlvbk1nci5zZWxlY3RDdXJyZW50VmFsdWUoKTtcclxuICAgICAgICBmZHQuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGJpbmRGYXZUcmVldGFibGUoZnR0OiBUcmVlVGFibGVDb21wb25lbnQpIHtcclxuICAgICAgICBmdHQuYWxsQ29sdW1uc1RpdGxlID0gdGhpcy5pbnN0YW5jZS5hbGxDb2x1bW5zVGl0bGU7XHJcbiAgICAgICAgZnR0LmlkRmllbGQgPSB0aGlzLmluc3RhbmNlLmlkRmllbGQ7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmluc3RhbmNlLmdyaWRPcHRpb25zLmNvbHVtbnMubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBydG46IGFueSA9IHsgLi4uaXRlbSB9O1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5maWVsZCA9PT0gRkFWT1JJVEVfRklFTERfTkFNRSkge1xyXG4gICAgICAgICAgICAgICAgcnRuLmZvcm1hdHRlciA9ICh2OiBhbnksIGRhdGE6IGFueSk6IGFueSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmF2aWRzID0gdGhpcy5nZXRGYXZvcml0SWRzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhdmlkcyAmJiBmYXZpZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZmF2aWRzLmZpbmRJbmRleChlbCA9PiBlbCA9PT0gZGF0YVt0aGlzLmluc3RhbmNlLmlkRmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYXZvcml0ZUljb24uZGVsZXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJ0bjtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmZhdm9yaXRlQ29sdW1ucyA9IGNvbHVtbnM7XHJcbiAgICAgICAgZnR0LmNvbHVtbnMgPSBjb2x1bW5zO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZ3JpZE9wdGlvbnMudHJlZUluZm8pIHtcclxuICAgICAgICAgICAgZnR0Lm9ubHlTZWxlY3RMZWFmID0gdGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy50cmVlSW5mby5vbmx5U2VsZWN0TGVhZjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghZnR0LnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICBmdHQuY2hlY2tPblNlbGVjdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGZ0dC5zZWxlY3RPbkNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgZnR0LnNob3dDaGVja2JveCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAvLyDlkK/nlKjlpJrpgInlkI7vvIzlkIzml7blkK/nlKjnuqfogZTpgInmi6lcclxuICAgICAgICAgICAgLy8g5ZCv55So5aSa6YCJ5ZCO77yM5ZCM5pe25ZCv55So57qn6IGU6YCJ5oupXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmVuYWJsZUNhc2NhZGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UudHRFdmVudE1nci5jYXNjYWRlVmFsdWVDaGFuZ2VkKHRoaXMuaW5zdGFuY2UuY2FzY2FkZVN0YXR1cyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmdHQuY2FzY2FkZUNoZWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmdHQuY2FzY2FkZURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZ0dC5jYXNjYWRlVXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpbml0RmF2b3JpdGVUcmVlRGF0YShpdGVtcykge1xyXG4gICAgICAgIGNvbnN0IHRyZWVJbmZvID0gdGhpcy5pbnN0YW5jZS5ncmlkT3B0aW9ucy50cmVlSW5mbztcclxuXHJcbiAgICAgICAgaWYgKHRyZWVJbmZvICYmICF0cmVlSW5mb1sndHJlZURhdGFJc0luaXQnXSkge1xyXG4gICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICdwYXRoY29kZScpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5pbnN0YW5jZS5sb29rdXBVdGlscy5tYWtlVHJlZShpdGVtcywgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmluc3RhbmNlLmxvb2t1cFV0aWxzLm1ha2VUcmVlV2l0aFBhcmVudElEKFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLFxyXG4gICAgICAgICAgICAgICAgICAgICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGAke3RyZWVJbmZvLmRhdGFGaWVsZH0uJHt0cmVlSW5mby5wYXJlbnRGaWVsZH1gLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuaWRGaWVsZFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZS5jaGVja05vZGVDYW5CZVNlbGVjdChpdGVtcywgdHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZEZhdm9yaXRlRm9yVHJlZVRhYmxlKGl0ZW1zLCBmdHQ6IGFueSkge1xyXG4gICAgICAgIGl0ZW1zID0gdGhpcy5pbml0RmF2b3JpdGVUcmVlRGF0YShpdGVtcyk7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5mYXZvcml0ZUl0ZW1zID0gaXRlbXM7XHJcbiAgICAgICAgZnR0LmxvYWREYXRhKGl0ZW1zKTtcclxuICAgICAgICBmdHQuZXhwYW5kQWxsKCk7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5zZWxlY3Rpb25NZ3Iuc2VsZWN0Q3VycmVudFZhbHVlKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBpdGVtcztcclxuICAgIH1cclxuXHJcbiAgICAvLyDmm7TmlrDliJfooajkuK3nmoTmlLbol4/mlbDmja7moIfor4ZcclxuICAgIHVwZGF0ZUZhdm9yaXRlc1N0YXR1cyhkYXRhOiBhbnlbXSkge1xyXG5cclxuICAgICAgICBpZiAoIWRhdGEgfHwgIXRoaXMuaW5zdGFuY2UudXNlRmF2b3JpdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZmF2SWRzID0gdGhpcy5nZXRGYXZvcml0SWRzKCk7XHJcblxyXG4gICAgICAgIGlmIChmYXZJZHMgJiYgZmF2SWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAvLyDlpITnkIbmlbDmja7liJfooajkuK3nmoTmlLbol4/mlbDmja7moIfor4ZcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuZGlzcGxheVR5cGUgIT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5UcmVlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgZGF0YS5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhdklkcyAmJiBmYXZJZHMubGVuZ3RoICYmIGZhdklkcy5maW5kKHYgPT4gdiA9PT0gaXRlbVt0aGlzLmluc3RhbmNlLmlkRmllbGRdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtW0ZBVk9SSVRFX0ZJRUxEX05BTUVdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF90aGlzID0gdGhpcy5pbnN0YW5jZTtcclxuICAgICAgICAgICAgICAgIChmdW5jdGlvbiBlYWNoKF9kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhdklkcyAmJiBmYXZJZHMubGVuZ3RoICYmIGZhdklkcy5maW5kKHYgPT4gdiA9PT0gaXRlbS5kYXRhW190aGlzLmlkRmllbGRdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhW0ZBVk9SSVRFX0ZJRUxEX05BTUVdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbiAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVhY2goaXRlbS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pKGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIF91cGRhdGVGYXZvcml0ZXModmFsdWU6IGFueSwgYWN0aW9uKSB7XHJcbiAgICAgICAgY29uc3QgbG9jYWxlSUQgPSB0aGlzLmluc3RhbmNlLmxvY2FsU2VydmljZS5sb2NhbGVJZDtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZi5mYXZvcml0ZSA9IHRoaXMuaW5zdGFuY2UucGVyc29uYWxDb25mLmZhdm9yaXRlIHx8IHt9O1xyXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUuZmlsdGVyKG4gPT4gIW5bJ19hZGR0aW9uYWxfJ10pO1xyXG4gICAgICAgIGNvbnN0IG5ld1ZhbCA9IGl0ZW1zLm1hcChuID0+IG5bdGhpcy5pbnN0YW5jZS5pZEZpZWxkXSkuZmlsdGVyKG4gPT4gbiAhPT0gbnVsbCAmJiBuICE9PSB1bmRlZmluZWQpO1xyXG4gICAgICAgIC8vIGNvbnN0IGZhdklkcyA9IHRoaXMuaW5zdGFuY2UucGVyc29uYWxDb25mLmZhdm9yaXRlW2xvY2FsZUlEXSB8fCBbXTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLnBlcnNvbmFsQ29uZi5mYXZvcml0ZVtsb2NhbGVJRF0gPSBuZXdWYWw7XHJcbiAgICAgICAgcmV0dXJuIG5ld1ZhbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmlLbol4/mlbDmja7nrqHnkIZcclxuICAgIHByaXZhdGUgbGlzdGVuUGVyc29uYWxDb25maWdIYW5kbGVyKCkge1xyXG4gICAgICAgIHRoaXMubG9va3VwU2VsZWN0aW9uU2VyLmZhdm9yaXRlSXRlbXMkLnN1YnNjcmliZShuID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB7IGl0ZW1zLCBhY3Rpb24gfSA9IG47XHJcbiAgICAgICAgICAgIGNvbnN0IGZhdmlkcyA9IHRoaXMuX3VwZGF0ZUZhdm9yaXRlcyhpdGVtcywgYWN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuaHR0cE1nci5zdWJtaXRGYXZvcml0ZURhdGEoYWN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmluc3RhbmNlLmRpc3BsYXlUeXBlID09PSBMb29rdXBHcmlkRGlzcGxheVR5cGUuTGlzdCB8fCB0aGlzLmluc3RhbmNlLmRpc3BsYXlUeXBlLmluY2x1ZGVzKCdOQVYnKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZHQgPSB0aGlzLmluc3RhbmNlLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBEYXRhVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRGYXZvcml0ZURhdGF0YWJsZShkdCwgaXRlbXMpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaW5zdGFuY2UuZGlzcGxheVR5cGUgPT09IExvb2t1cEdyaWREaXNwbGF5VHlwZS5UcmVlTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZnR0ID0gdGhpcy5pbnN0YW5jZS5mYXZvcml0ZXNDb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgZmF2aWRzID0gaXRlbXMubWFwKGQgPT4gZC5pZCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLnNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmh0dHBNZ3IuZ2V0RGF0YSh7IGZhdm9yaXRlSWRzOiBmYXZpZHMgfSwgJ2ZhdicpLnN1YnNjcmliZShyZXNEYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBfaXRlbXMgPSByZXNEYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRGYXZvcml0ZUZvclRyZWVUYWJsZShfaXRlbXMsIGZ0dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5mYXZvcml0ZUl0ZW1zID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ0dC5sb2FkRGF0YShbXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=