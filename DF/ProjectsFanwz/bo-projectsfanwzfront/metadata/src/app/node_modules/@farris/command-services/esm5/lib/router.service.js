/*
 * @Author: Witt
 * @Date: 2018-11-15 15:56:11
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2019-07-09 16:23:04
 */
import { Injectable, Optional } from '@angular/core';
import { Router } from '@angular/router';
import { RouterParamService } from '@farris/devkit';
import { FrameworkService, AppService } from '@gsp-sys/rtf-common';
import { MenuStateService } from './menu-state.service';
import { Subject } from 'rxjs';
import { LanguageService } from './languag.service';
// tslint:disable: no-string-literal
/**
 * 路由服务
 * @scope FormModule
 */
var RouterService = /** @class */ (function () {
    function RouterService(router, routerParamService, frameworkService, appService, menuStateService, languageService) {
        this.router = router;
        this.routerParamService = routerParamService;
        this.frameworkService = frameworkService;
        this.appService = appService;
        this.menuStateService = menuStateService;
        this.languageService = languageService;
        /**
         * 上次切换的TabId
         */
        this.lastSwitchId = null;
        /**
         * 上次关闭的TabId
         */
        this.lastCloseId = null;
        // private menuStateService: MenuStateService = null;
        this.onClosed = null;
        if (!this.menuStateService) {
            this.menuStateService = new MenuStateService();
        }
        if (!this.languageService) {
            this.languageService = LanguageService.getInstance();
        }
        this.onClosed = new Subject();
        this.registerEvent();
    }
    /**
     * 切换路由
     * @param url 菜单ID
     * @param params 路由参数
     */
    RouterService.prototype.route = function (url, params) {
        url = this.router.createUrlTree([url]).toString();
        this.setParams(url, params);
        this.router.navigateByUrl(url);
    };
    /**
     * 注册运行框架事件
     */
    RouterService.prototype.registerEvent = function () {
        var _this = this;
        var menuId = this.getAppId() || this.getFuncId();
        this.frameworkService.eventListner(this.frameworkService.FuncSwitch, function (e) {
            if (!e) {
                return;
            }
            var id = _this.getOriginalId(e.id) || e.tabId;
            var menuState = _this.menuStateService.getMenuState(id);
            if (!!id && menuId === id && !!menuState && menuState.length > 0) {
                _this.formReload();
                _this.lastSwitchId = id;
            }
        });
        this.frameworkService.eventListner(this.frameworkService.FuncClosed, function (e) {
            if (!e) {
                return;
            }
            _this.onClosed.next(e);
            var id = _this.getOriginalId(e.id) || e.tabId;
            if (menuId === id) {
                return;
            }
            var menuState = _this.menuStateService.getMenuState(menuId, id);
            // && id !== this.lastCloseId
            if (!!id && !!menuState && menuState.length > 0) {
                _this.removeMenuState(id);
                _this.formReload();
                _this.lastCloseId = id;
            }
        });
    };
    RouterService.prototype.removeMenuState = function (tabId) {
        if (this['context']) {
            this.menuStateService.removeMenu(tabId);
        }
    };
    /**
     * 获取原始功能id
     * @param id id
     */
    RouterService.prototype.getOriginalId = function (id) {
        if (!id) {
            return id;
        }
        if (id.indexOf('_') !== -1) {
            id = id.split('_')[0];
        }
        return id;
    };
    /**
     * 刷新组件数据
     */
    RouterService.prototype.formReload = function () {
        try {
            this['context']['frameContext']['appContext']['refresh']();
        }
        catch (_a) { }
    };
    /**
     * 打开功能菜单
     * @param funcId 菜单内码
     * @param params 路由参数，形如： { key1: val1, key2: value2 }
     */
    RouterService.prototype.openMenu = function (funcId, params, reload) {
        if (typeof reload === 'undefined' || typeof reload !== 'boolean') {
            reload = false;
        }
        var paramsMap = this.buildParamMap(params);
        var parentMenuId = this.getFuncId() || this.getAppId();
        this.menuStateService.addMenuState(parentMenuId, funcId);
        paramsMap.set('WEB_FORM_ROUTER_PARENT_ID', parentMenuId);
        this.frameworkService.openFuncWithParam(funcId, paramsMap, reload);
    };
    /**
     * 打开应用
     * @param appId 应用内码
     * @param appEntrance 应用入口
     * @param params 路由参数，形如： { key1: val1, key2: value2 }
     */
    RouterService.prototype.openApp = function (appId, appEntrance, params, reload) {
        if (typeof reload === 'undefined' || typeof reload !== 'boolean') {
            reload = false;
        }
        var paramMap = this.buildParamMap(params);
        var parentMenuId = this.getAppId() || this.getFuncId();
        this.menuStateService.addMenuState(parentMenuId, appId);
        paramMap.set('WEB_FORM_ROUTER_PARENT_ID', parentMenuId);
        if (!!this.appService) {
            this.appService.openApp(appId, appEntrance, paramMap, reload);
        }
    };
    /**
     * 构造参数
     */
    RouterService.prototype.buildParamMap = function (params) {
        if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {
            params = {};
        }
        var paramMap = new Map();
        if (typeof params === 'object') {
            params = JSON.stringify(params);
        }
        params = window['encodeURIComponent'](params);
        paramMap.set('WEB_FORM_ROUTE_PARAMS', params);
        return paramMap;
    };
    /**
     * 关闭功能菜单
     */
    RouterService.prototype.closeMenu = function () {
        var funcId = this.getFuncId();
        var appId = this.getAppId();
        var _a = this.findDialog(), isDialogComponent = _a.isDialogComponent, rootComponent = _a.rootComponent;
        if (isDialogComponent) {
            var modalRef = this.get(rootComponent, 'dialogRef');
            modalRef['close']();
            return;
        }
        if (funcId !== null && typeof funcId === 'string' && funcId.length > 0) {
            this.closeFunc(funcId);
        }
        else if (appId !== null && typeof appId === 'string' && appId.length > 0) {
            var appEntrance = this.getAppEntrance();
            this.closeApp(appId, appEntrance);
        }
        else {
            console.error(this.languageService['notSupportMenuType']);
        }
    };
    /**
     * 查找弹窗组件
     */
    RouterService.prototype.findDialog = function () {
        var frameContext = this.get(this, 'context.frameContext');
        var isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);
        var parentFrameContext = this.get(frameContext, 'parent');
        while (parentFrameContext != null && !isDialogComponent) {
            frameContext = this.get(frameContext, 'parent');
            parentFrameContext = this.get(parentFrameContext, 'parent');
            isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);
        }
        var rootComponent = this.get(frameContext, 'frameComponent');
        return { isDialogComponent: isDialogComponent, rootComponent: rootComponent };
    };
    /**
     * loadsh get
     * @param object 对象
     * @param path 路径
     * @param defaultVal 默认值
     */
    RouterService.prototype.get = function (object, path, defaultVal) {
        if (defaultVal === void 0) { defaultVal = null; }
        var PATH = Array.isArray(path)
            ? path
            : path.split('.').filter(function (i) { return i.length; });
        if (!PATH.length) {
            return object === undefined ? defaultVal : object;
        }
        if (object === null || object === undefined || typeof (object[PATH[0]]) === 'undefined') {
            return defaultVal;
        }
        return this.get(object[PATH.shift()], PATH, defaultVal);
    };
    /**
     * 关闭菜单
     * @param funcId 菜单id
     */
    RouterService.prototype.closeFunc = function (funcId) {
        if (!funcId) {
            funcId = this.getFuncId();
        }
        if (!!this.frameworkService) {
            this.frameworkService.closeFunc(funcId).subscribe();
        }
    };
    /**
     * 关闭app
     * @param appId 应用id
     */
    RouterService.prototype.closeApp = function (appId, appEntrance) {
        if (!appId) {
            appId = this.getAppId();
        }
        if (typeof appEntrance === 'undefined') {
            appEntrance = this.getAppEntrance();
        }
        if (!!this.appService) {
            this.appService.closeApp(appId, appEntrance).subscribe();
        }
    };
    /**
     * 设置参数
     * @param params 路由参数
     */
    RouterService.prototype.setParams = function (url, params) {
        var paramsObj;
        if (typeof params === 'string' && params !== '') {
            paramsObj = JSON.parse(params);
        }
        else {
            paramsObj = params || {};
        }
        // 设置路由参数
        this.routerParamService.setParams(url, paramsObj);
    };
    /**
     * 获取funcId
     */
    RouterService.prototype.getFuncId = function () {
        var hash = window.location.hash;
        if (!hash) {
            return null;
        }
        var params = this.decodeURLParams(hash);
        if (params && params.hasOwnProperty('funcId')) {
            return params.funcId;
        }
        else {
            return null;
        }
    };
    /**
     * 获取appId
     */
    RouterService.prototype.getAppId = function () {
        var hash = window.location.hash;
        if (!hash) {
            return null;
        }
        var params = this.decodeURLParams(hash);
        if (params && params.hasOwnProperty('appId')) {
            return params.appId;
        }
        else {
            return null;
        }
    };
    RouterService.prototype.getParentMenuId = function () {
        var hash = window.location.hash;
        if (!hash) {
            return null;
        }
        var params = this.decodeURLParams(hash);
        if (params && params.hasOwnProperty('WEB_FORM_ROUTER_PARENT_ID')) {
            return params.WEB_FORM_ROUTER_PARENT_ID;
        }
        else {
            return null;
        }
    };
    /**
     * 获取应用入口
     */
    RouterService.prototype.getAppEntrance = function () {
        var hash = window.location.hash;
        if (!hash) {
            return null;
        }
        var params = this.decodeURLParams(hash);
        if (params && params.hasOwnProperty('appEntrance')) {
            return params.appEntrance;
        }
        else {
            return null;
        }
    };
    /**
     * 解码参数
     * @param query search|hash
     */
    RouterService.prototype.decodeURLParams = function (query) {
        if (typeof query === 'undefined') {
            query = window.location.hash || window.location.search;
        }
        var hashes = query.slice(query.indexOf('?') + 1).split('&');
        return hashes.reduce(function (params, hash) {
            var _a;
            var split = hash.indexOf('=');
            var key = hash.slice(0, split);
            var val = hash.slice(split + 1);
            return Object.assign(params, (_a = {}, _a[key] = decodeURIComponent(val), _a));
        }, {});
    };
    RouterService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    RouterService.ctorParameters = function () { return [
        { type: Router },
        { type: RouterParamService },
        { type: FrameworkService },
        { type: AppService, decorators: [{ type: Optional }] },
        { type: MenuStateService, decorators: [{ type: Optional }] },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return RouterService;
}());
export { RouterService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvcm91dGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFFSCxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBELG9DQUFvQztBQUNwQzs7O0dBR0c7QUFDSDtJQVlFLHVCQUNVLE1BQWMsRUFDZCxrQkFBc0MsRUFDdEMsZ0JBQWtDLEVBQ3RCLFVBQXNCLEVBQ3RCLGdCQUFrQyxFQUNsQyxlQUFnQztRQUw1QyxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUN0QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ3RCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFoQnREOztXQUVHO1FBQ0ssaUJBQVksR0FBVyxJQUFJLENBQUM7UUFDcEM7O1dBRUc7UUFDSyxnQkFBVyxHQUFXLElBQUksQ0FBQztRQUNuQyxxREFBcUQ7UUFDOUMsYUFBUSxHQUFpQixJQUFJLENBQUM7UUFTbkMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUMxQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO1NBQ2hEO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDekIsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDdEQ7UUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFDbkMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksNkJBQUssR0FBWixVQUFhLEdBQVcsRUFBRSxNQUFXO1FBQ25DLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUNEOztPQUVHO0lBQ0kscUNBQWEsR0FBcEI7UUFBQSxpQkErQkM7UUE5QkMsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNuRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsVUFBQSxDQUFDO1lBQ3BFLElBQUksQ0FBQyxDQUFDLEVBQUU7Z0JBQ04sT0FBTzthQUNSO1lBQ0QsSUFBTSxFQUFFLEdBQUcsS0FBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUMvQyxJQUFNLFNBQVMsR0FBRyxLQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3pELElBQUksQ0FBQyxDQUFDLEVBQUUsSUFBSSxNQUFNLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxTQUFTLElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2hFLEtBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDbEIsS0FBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7YUFDeEI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxVQUFBLENBQUM7WUFDcEUsSUFBSSxDQUFDLENBQUMsRUFBRTtnQkFDTixPQUFPO2FBQ1I7WUFDRCxLQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QixJQUFNLEVBQUUsR0FBRyxLQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQy9DLElBQUksTUFBTSxLQUFLLEVBQUUsRUFBRTtnQkFDakIsT0FBTzthQUNSO1lBQ0QsSUFBTSxTQUFTLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDakUsNkJBQTZCO1lBQzdCLElBQUksQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUMvQyxLQUFJLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN6QixLQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ2xCLEtBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO2FBQ3ZCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sdUNBQWUsR0FBdkIsVUFBd0IsS0FBYTtRQUNuQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUNuQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3pDO0lBQ0gsQ0FBQztJQUNEOzs7T0FHRztJQUNLLHFDQUFhLEdBQXJCLFVBQXNCLEVBQVU7UUFDOUIsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNQLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFDRCxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDMUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdkI7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFDRDs7T0FFRztJQUNLLGtDQUFVLEdBQWxCO1FBQ0UsSUFBSTtZQUNGLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1NBQzVEO1FBQUMsV0FBSyxHQUFHO0lBQ1osQ0FBQztJQUNEOzs7O09BSUc7SUFDSSxnQ0FBUSxHQUFmLFVBQWdCLE1BQWMsRUFBRSxNQUFXLEVBQUUsTUFBZ0I7UUFDM0QsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksT0FBTyxNQUFNLEtBQUssU0FBUyxFQUFFO1lBQ2hFLE1BQU0sR0FBRyxLQUFLLENBQUM7U0FDaEI7UUFDRCxJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdDLElBQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDekQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDekQsU0FBUyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSwrQkFBTyxHQUFkLFVBQWUsS0FBYSxFQUFFLFdBQW1CLEVBQUUsTUFBVyxFQUFFLE1BQWdCO1FBQzlFLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE9BQU8sTUFBTSxLQUFLLFNBQVMsRUFBRTtZQUNoRSxNQUFNLEdBQUcsS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1QyxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ3pELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3hELFFBQVEsQ0FBQyxHQUFHLENBQUMsMkJBQTJCLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNyQixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUMvRDtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLHFDQUFhLEdBQXJCLFVBQXNCLE1BQVc7UUFDL0IsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxLQUFLLElBQUksSUFBSSxDQUFDLE9BQU8sTUFBTSxLQUFLLFFBQVEsSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQ3pHLE1BQU0sR0FBRyxFQUFFLENBQUM7U0FDYjtRQUNELElBQU0sUUFBUSxHQUFHLElBQUksR0FBRyxFQUFlLENBQUM7UUFDeEMsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7WUFDOUIsTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDakM7UUFDRCxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM5QyxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQ7O09BRUc7SUFDSSxpQ0FBUyxHQUFoQjtRQUNFLElBQU0sTUFBTSxHQUFrQixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDL0MsSUFBTSxLQUFLLEdBQWtCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN2QyxJQUFBLHNCQUF3RCxFQUF0RCx3Q0FBaUIsRUFBRSxnQ0FBbUMsQ0FBQztRQUMvRCxJQUFJLGlCQUFpQixFQUFFO1lBQ3JCLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ3RELFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQ3BCLE9BQU87U0FDUjtRQUVELElBQUksTUFBTSxLQUFLLElBQUksSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN4QjthQUFNLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDMUUsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQzFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1NBQ25DO2FBQU07WUFDTCxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO1NBQzNEO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0ssa0NBQVUsR0FBbEI7UUFDRSxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1FBQzFELElBQUksaUJBQWlCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsc0NBQXNDLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFOUYsSUFBSSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMxRCxPQUFPLGtCQUFrQixJQUFJLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQ3ZELFlBQVksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUNoRCxrQkFBa0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzVELGlCQUFpQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLHNDQUFzQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzNGO1FBQ0QsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUMvRCxPQUFPLEVBQUUsaUJBQWlCLG1CQUFBLEVBQUUsYUFBYSxlQUFBLEVBQUUsQ0FBQztJQUU5QyxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSywyQkFBRyxHQUFYLFVBQVksTUFBVyxFQUFFLElBQTRCLEVBQUUsVUFBc0I7UUFBdEIsMkJBQUEsRUFBQSxpQkFBc0I7UUFDM0UsSUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDOUIsQ0FBQyxDQUFDLElBQUk7WUFDTixDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsTUFBTSxFQUFSLENBQVEsQ0FBQyxDQUFDO1FBQzFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2hCLE9BQU8sTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7U0FDbkQ7UUFFRCxJQUFJLE1BQU0sS0FBSyxJQUFJLElBQUksTUFBTSxLQUFLLFNBQVMsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssV0FBVyxFQUFFO1lBQ3ZGLE9BQU8sVUFBVSxDQUFDO1NBQ25CO1FBRUQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVEOzs7T0FHRztJQUNJLGlDQUFTLEdBQWhCLFVBQWlCLE1BQWU7UUFDOUIsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7U0FDM0I7UUFDRCxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDM0IsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztTQUNyRDtJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSSxnQ0FBUSxHQUFmLFVBQWdCLEtBQWMsRUFBRSxXQUFvQjtRQUNsRCxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUN6QjtRQUNELElBQUksT0FBTyxXQUFXLEtBQUssV0FBVyxFQUFFO1lBQ3RDLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDckM7UUFDRCxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxXQUFXLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztTQUMxRDtJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSyxpQ0FBUyxHQUFqQixVQUFrQixHQUFXLEVBQUUsTUFBd0M7UUFDckUsSUFBSSxTQUFTLENBQUM7UUFDZCxJQUFJLE9BQU8sTUFBTSxLQUFLLFFBQVEsSUFBSSxNQUFNLEtBQUssRUFBRSxFQUFFO1lBQy9DLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ2hDO2FBQU07WUFDTCxTQUFTLEdBQUcsTUFBTSxJQUFJLEVBQUUsQ0FBQztTQUMxQjtRQUVELFNBQVM7UUFDVCxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxpQ0FBUyxHQUFqQjtRQUNFLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVCxPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQyxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzdDLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUN0QjthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLGdDQUFRLEdBQWhCO1FBQ0UsSUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNULE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDNUMsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFDO1NBQ3JCO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQztJQUVPLHVDQUFlLEdBQXZCO1FBQ0UsSUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNULE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsMkJBQTJCLENBQUMsRUFBRTtZQUNoRSxPQUFPLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQztTQUN6QzthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7SUFDRDs7T0FFRztJQUNLLHNDQUFjLEdBQXRCO1FBQ0UsSUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNULE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEVBQUU7WUFDbEQsT0FBTyxNQUFNLENBQUMsV0FBVyxDQUFDO1NBQzNCO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQztJQUNEOzs7T0FHRztJQUNLLHVDQUFlLEdBQXZCLFVBQXdCLEtBQWE7UUFDbkMsSUFBSSxPQUFPLEtBQUssS0FBSyxXQUFXLEVBQUU7WUFDaEMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO1NBQ3hEO1FBQ0QsSUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM5RCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBQyxNQUFNLEVBQUUsSUFBSTs7WUFDaEMsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQyxJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNqQyxJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNsQyxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxZQUFJLEdBQUMsR0FBRyxJQUFHLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxNQUFHLENBQUM7UUFDbkUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ1QsQ0FBQzs7Z0JBOVVGLFVBQVU7Ozs7Z0JBWkYsTUFBTTtnQkFDTixrQkFBa0I7Z0JBQ2xCLGdCQUFnQjtnQkFBRSxVQUFVLHVCQTBCaEMsUUFBUTtnQkF6QkosZ0JBQWdCLHVCQTBCcEIsUUFBUTtnQkF4QkosZUFBZSx1QkF5Qm5CLFFBQVE7O0lBNlRiLG9CQUFDO0NBQUEsQUEvVUQsSUErVUM7QUFFRCxPQUFPLEVBQUUsYUFBYSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBAQXV0aG9yOiBXaXR0XHJcbiAqIEBEYXRlOiAyMDE4LTExLTE1IDE1OjU2OjExXHJcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBhYWxpenp3ZWxsXHJcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMDctMDkgMTY6MjM6MDRcclxuICovXHJcblxyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBSb3V0ZXJQYXJhbVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEZyYW1ld29ya1NlcnZpY2UsIEFwcFNlcnZpY2UgfSBmcm9tICdAZ3NwLXN5cy9ydGYtY29tbW9uJztcclxuaW1wb3J0IHsgTWVudVN0YXRlU2VydmljZSB9IGZyb20gJy4vbWVudS1zdGF0ZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuL2xhbmd1YWcuc2VydmljZSc7XHJcblxyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuLyoqXHJcbiAqIOi3r+eUseacjeWKoVxyXG4gKiBAc2NvcGUgRm9ybU1vZHVsZVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBSb3V0ZXJTZXJ2aWNlIHtcclxuICAvKipcclxuICAgKiDkuIrmrKHliIfmjaLnmoRUYWJJZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbGFzdFN3aXRjaElkOiBzdHJpbmcgPSBudWxsO1xyXG4gIC8qKlxyXG4gICAqIOS4iuasoeWFs+mXreeahFRhYklkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBsYXN0Q2xvc2VJZDogc3RyaW5nID0gbnVsbDtcclxuICAvLyBwcml2YXRlIG1lbnVTdGF0ZVNlcnZpY2U6IE1lbnVTdGF0ZVNlcnZpY2UgPSBudWxsO1xyXG4gIHB1YmxpYyBvbkNsb3NlZDogU3ViamVjdDxhbnk+ID0gbnVsbDtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXHJcbiAgICBwcml2YXRlIHJvdXRlclBhcmFtU2VydmljZTogUm91dGVyUGFyYW1TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmcmFtZXdvcmtTZXJ2aWNlOiBGcmFtZXdvcmtTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBhcHBTZXJ2aWNlOiBBcHBTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBtZW51U3RhdGVTZXJ2aWNlOiBNZW51U3RhdGVTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSxcclxuICApIHtcclxuICAgIGlmICghdGhpcy5tZW51U3RhdGVTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMubWVudVN0YXRlU2VydmljZSA9IG5ldyBNZW51U3RhdGVTZXJ2aWNlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMubGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gTGFuZ3VhZ2VTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLm9uQ2xvc2VkID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliIfmjaLot6/nlLFcclxuICAgKiBAcGFyYW0gdXJsIOiPnOWNlUlEXHJcbiAgICogQHBhcmFtIHBhcmFtcyDot6/nlLHlj4LmlbBcclxuICAgKi9cclxuICBwdWJsaWMgcm91dGUodXJsOiBzdHJpbmcsIHBhcmFtczogYW55KSB7XHJcbiAgICB1cmwgPSB0aGlzLnJvdXRlci5jcmVhdGVVcmxUcmVlKFt1cmxdKS50b1N0cmluZygpO1xyXG4gICAgdGhpcy5zZXRQYXJhbXModXJsLCBwYXJhbXMpO1xyXG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybCh1cmwpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDms6jlhozov5DooYzmoYbmnrbkuovku7ZcclxuICAgKi9cclxuICBwdWJsaWMgcmVnaXN0ZXJFdmVudCgpIHtcclxuICAgIGNvbnN0IG1lbnVJZCA9IHRoaXMuZ2V0QXBwSWQoKSB8fCB0aGlzLmdldEZ1bmNJZCgpO1xyXG4gICAgdGhpcy5mcmFtZXdvcmtTZXJ2aWNlLmV2ZW50TGlzdG5lcih0aGlzLmZyYW1ld29ya1NlcnZpY2UuRnVuY1N3aXRjaCwgZSA9PiB7XHJcbiAgICAgIGlmICghZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0T3JpZ2luYWxJZChlLmlkKSB8fCBlLnRhYklkO1xyXG4gICAgICBjb25zdCBtZW51U3RhdGUgPSB0aGlzLm1lbnVTdGF0ZVNlcnZpY2UuZ2V0TWVudVN0YXRlKGlkKTtcclxuICAgICAgaWYgKCEhaWQgJiYgbWVudUlkID09PSBpZCAmJiAhIW1lbnVTdGF0ZSAmJiBtZW51U3RhdGUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHRoaXMuZm9ybVJlbG9hZCgpO1xyXG4gICAgICAgIHRoaXMubGFzdFN3aXRjaElkID0gaWQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuZnJhbWV3b3JrU2VydmljZS5ldmVudExpc3RuZXIodGhpcy5mcmFtZXdvcmtTZXJ2aWNlLkZ1bmNDbG9zZWQsIGUgPT4ge1xyXG4gICAgICBpZiAoIWUpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5vbkNsb3NlZC5uZXh0KGUpO1xyXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0T3JpZ2luYWxJZChlLmlkKSB8fCBlLnRhYklkO1xyXG4gICAgICBpZiAobWVudUlkID09PSBpZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBtZW51U3RhdGUgPSB0aGlzLm1lbnVTdGF0ZVNlcnZpY2UuZ2V0TWVudVN0YXRlKG1lbnVJZCwgaWQpO1xyXG4gICAgICAvLyAmJiBpZCAhPT0gdGhpcy5sYXN0Q2xvc2VJZFxyXG4gICAgICBpZiAoISFpZCAmJiAhIW1lbnVTdGF0ZSAmJiBtZW51U3RhdGUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlTWVudVN0YXRlKGlkKTtcclxuICAgICAgICB0aGlzLmZvcm1SZWxvYWQoKTtcclxuICAgICAgICB0aGlzLmxhc3RDbG9zZUlkID0gaWQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW1vdmVNZW51U3RhdGUodGFiSWQ6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXNbJ2NvbnRleHQnXSkge1xyXG4gICAgICB0aGlzLm1lbnVTdGF0ZVNlcnZpY2UucmVtb3ZlTWVudSh0YWJJZCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWOn+Wni+WKn+iDvWlkXHJcbiAgICogQHBhcmFtIGlkIGlkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRPcmlnaW5hbElkKGlkOiBzdHJpbmcpIHtcclxuICAgIGlmICghaWQpIHtcclxuICAgICAgcmV0dXJuIGlkO1xyXG4gICAgfVxyXG4gICAgaWYgKGlkLmluZGV4T2YoJ18nKSAhPT0gLTEpIHtcclxuICAgICAgaWQgPSBpZC5zcGxpdCgnXycpWzBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliLfmlrDnu4Tku7bmlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIGZvcm1SZWxvYWQoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzWydjb250ZXh0J11bJ2ZyYW1lQ29udGV4dCddWydhcHBDb250ZXh0J11bJ3JlZnJlc2gnXSgpO1xyXG4gICAgfSBjYXRjaHsgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmiZPlvIDlip/og73oj5zljZVcclxuICAgKiBAcGFyYW0gZnVuY0lkIOiPnOWNleWGheeggVxyXG4gICAqIEBwYXJhbSBwYXJhbXMg6Lev55Sx5Y+C5pWw77yM5b2i5aaC77yaIHsga2V5MTogdmFsMSwga2V5MjogdmFsdWUyIH1cclxuICAgKi9cclxuICBwdWJsaWMgb3Blbk1lbnUoZnVuY0lkOiBzdHJpbmcsIHBhcmFtczogYW55LCByZWxvYWQ/OiBib29sZWFuKSB7XHJcbiAgICBpZiAodHlwZW9mIHJlbG9hZCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHJlbG9hZCAhPT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgIHJlbG9hZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyYW1zTWFwID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XHJcbiAgICBjb25zdCBwYXJlbnRNZW51SWQgPSB0aGlzLmdldEZ1bmNJZCgpIHx8IHRoaXMuZ2V0QXBwSWQoKTtcclxuICAgIHRoaXMubWVudVN0YXRlU2VydmljZS5hZGRNZW51U3RhdGUocGFyZW50TWVudUlkLCBmdW5jSWQpO1xyXG4gICAgcGFyYW1zTWFwLnNldCgnV0VCX0ZPUk1fUk9VVEVSX1BBUkVOVF9JRCcsIHBhcmVudE1lbnVJZCk7XHJcbiAgICB0aGlzLmZyYW1ld29ya1NlcnZpY2Uub3BlbkZ1bmNXaXRoUGFyYW0oZnVuY0lkLCBwYXJhbXNNYXAsIHJlbG9hZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDlupTnlKhcclxuICAgKiBAcGFyYW0gYXBwSWQg5bqU55So5YaF56CBXHJcbiAgICogQHBhcmFtIGFwcEVudHJhbmNlIOW6lOeUqOWFpeWPo1xyXG4gICAqIEBwYXJhbSBwYXJhbXMg6Lev55Sx5Y+C5pWw77yM5b2i5aaC77yaIHsga2V5MTogdmFsMSwga2V5MjogdmFsdWUyIH1cclxuICAgKi9cclxuICBwdWJsaWMgb3BlbkFwcChhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCBwYXJhbXM6IGFueSwgcmVsb2FkPzogYm9vbGVhbikge1xyXG4gICAgaWYgKHR5cGVvZiByZWxvYWQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiByZWxvYWQgIT09ICdib29sZWFuJykge1xyXG4gICAgICByZWxvYWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBhcmFtTWFwID0gdGhpcy5idWlsZFBhcmFtTWFwKHBhcmFtcyk7XHJcbiAgICBjb25zdCBwYXJlbnRNZW51SWQgPSB0aGlzLmdldEFwcElkKCkgfHwgdGhpcy5nZXRGdW5jSWQoKTtcclxuICAgIHRoaXMubWVudVN0YXRlU2VydmljZS5hZGRNZW51U3RhdGUocGFyZW50TWVudUlkLCBhcHBJZCk7XHJcbiAgICBwYXJhbU1hcC5zZXQoJ1dFQl9GT1JNX1JPVVRFUl9QQVJFTlRfSUQnLCBwYXJlbnRNZW51SWQpO1xyXG4gICAgaWYgKCEhdGhpcy5hcHBTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMuYXBwU2VydmljZS5vcGVuQXBwKGFwcElkLCBhcHBFbnRyYW5jZSwgcGFyYW1NYXAsIHJlbG9hZCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlj4LmlbBcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkUGFyYW1NYXAocGFyYW1zOiBhbnkpOiBNYXA8c3RyaW5nLCBzdHJpbmc+IHtcclxuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAndW5kZWZpbmVkJyB8fCBwYXJhbXMgPT09IG51bGwgfHwgKHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnICYmIHBhcmFtcy5sZW5ndGggPCAxKSkge1xyXG4gICAgICBwYXJhbXMgPSB7fTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBhcmFtTWFwID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAnb2JqZWN0Jykge1xyXG4gICAgICBwYXJhbXMgPSBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xyXG4gICAgfVxyXG4gICAgcGFyYW1zID0gd2luZG93WydlbmNvZGVVUklDb21wb25lbnQnXShwYXJhbXMpO1xyXG4gICAgcGFyYW1NYXAuc2V0KCdXRUJfRk9STV9ST1VURV9QQVJBTVMnLCBwYXJhbXMpO1xyXG4gICAgcmV0dXJuIHBhcmFtTWFwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YWz6Zet5Yqf6IO96I+c5Y2VXHJcbiAgICovXHJcbiAgcHVibGljIGNsb3NlTWVudSgpIHtcclxuICAgIGNvbnN0IGZ1bmNJZDogc3RyaW5nIHwgbnVsbCA9IHRoaXMuZ2V0RnVuY0lkKCk7XHJcbiAgICBjb25zdCBhcHBJZDogc3RyaW5nIHwgbnVsbCA9IHRoaXMuZ2V0QXBwSWQoKTtcclxuICAgIGNvbnN0IHsgaXNEaWFsb2dDb21wb25lbnQsIHJvb3RDb21wb25lbnQgfSA9IHRoaXMuZmluZERpYWxvZygpO1xyXG4gICAgaWYgKGlzRGlhbG9nQ29tcG9uZW50KSB7XHJcbiAgICAgIGNvbnN0IG1vZGFsUmVmID0gdGhpcy5nZXQocm9vdENvbXBvbmVudCwgJ2RpYWxvZ1JlZicpO1xyXG4gICAgICBtb2RhbFJlZlsnY2xvc2UnXSgpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZ1bmNJZCAhPT0gbnVsbCAmJiB0eXBlb2YgZnVuY0lkID09PSAnc3RyaW5nJyAmJiBmdW5jSWQubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmNsb3NlRnVuYyhmdW5jSWQpO1xyXG4gICAgfSBlbHNlIGlmIChhcHBJZCAhPT0gbnVsbCAmJiB0eXBlb2YgYXBwSWQgPT09ICdzdHJpbmcnICYmIGFwcElkLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgYXBwRW50cmFuY2UgPSB0aGlzLmdldEFwcEVudHJhbmNlKCk7XHJcbiAgICAgIHRoaXMuY2xvc2VBcHAoYXBwSWQsIGFwcEVudHJhbmNlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ25vdFN1cHBvcnRNZW51VHlwZSddKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOafpeaJvuW8ueeql+e7hOS7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZmluZERpYWxvZygpIHtcclxuICAgIGxldCBmcmFtZUNvbnRleHQgPSB0aGlzLmdldCh0aGlzLCAnY29udGV4dC5mcmFtZUNvbnRleHQnKTtcclxuICAgIGxldCBpc0RpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZ2V0KGZyYW1lQ29udGV4dCwgJ2ZyYW1lQ29tcG9uZW50LmlzRGlhbG9nUm9vdENvbXBvbmVudCcsIGZhbHNlKTtcclxuXHJcbiAgICBsZXQgcGFyZW50RnJhbWVDb250ZXh0ID0gdGhpcy5nZXQoZnJhbWVDb250ZXh0LCAncGFyZW50Jyk7XHJcbiAgICB3aGlsZSAocGFyZW50RnJhbWVDb250ZXh0ICE9IG51bGwgJiYgIWlzRGlhbG9nQ29tcG9uZW50KSB7XHJcbiAgICAgIGZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0KGZyYW1lQ29udGV4dCwgJ3BhcmVudCcpO1xyXG4gICAgICBwYXJlbnRGcmFtZUNvbnRleHQgPSB0aGlzLmdldChwYXJlbnRGcmFtZUNvbnRleHQsICdwYXJlbnQnKTtcclxuICAgICAgaXNEaWFsb2dDb21wb25lbnQgPSB0aGlzLmdldChmcmFtZUNvbnRleHQsICdmcmFtZUNvbXBvbmVudC5pc0RpYWxvZ1Jvb3RDb21wb25lbnQnLCBmYWxzZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByb290Q29tcG9uZW50ID0gdGhpcy5nZXQoZnJhbWVDb250ZXh0LCAnZnJhbWVDb21wb25lbnQnKTtcclxuICAgIHJldHVybiB7IGlzRGlhbG9nQ29tcG9uZW50LCByb290Q29tcG9uZW50IH07XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogbG9hZHNoIGdldFxyXG4gICAqIEBwYXJhbSBvYmplY3Qg5a+56LGhXHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWwg6buY6K6k5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQob2JqZWN0OiBhbnksIHBhdGg6IEFycmF5PHN0cmluZz4gfCBzdHJpbmcsIGRlZmF1bHRWYWw6IGFueSA9IG51bGwpIHtcclxuICAgIGNvbnN0IFBBVEggPSBBcnJheS5pc0FycmF5KHBhdGgpXHJcbiAgICAgID8gcGF0aFxyXG4gICAgICA6IHBhdGguc3BsaXQoJy4nKS5maWx0ZXIoaSA9PiBpLmxlbmd0aCk7XHJcbiAgICBpZiAoIVBBVEgubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBvYmplY3QgPT09IHVuZGVmaW5lZCA/IGRlZmF1bHRWYWwgOiBvYmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG9iamVjdCA9PT0gbnVsbCB8fCBvYmplY3QgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgKG9iamVjdFtQQVRIWzBdXSkgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHJldHVybiBkZWZhdWx0VmFsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmdldChvYmplY3RbUEFUSC5zaGlmdCgpXSwgUEFUSCwgZGVmYXVsdFZhbCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlhbPpl63oj5zljZVcclxuICAgKiBAcGFyYW0gZnVuY0lkIOiPnOWNlWlkXHJcbiAgICovXHJcbiAgcHVibGljIGNsb3NlRnVuYyhmdW5jSWQ/OiBzdHJpbmcpIHtcclxuICAgIGlmICghZnVuY0lkKSB7XHJcbiAgICAgIGZ1bmNJZCA9IHRoaXMuZ2V0RnVuY0lkKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoISF0aGlzLmZyYW1ld29ya1NlcnZpY2UpIHtcclxuICAgICAgdGhpcy5mcmFtZXdvcmtTZXJ2aWNlLmNsb3NlRnVuYyhmdW5jSWQpLnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YWz6ZetYXBwXHJcbiAgICogQHBhcmFtIGFwcElkIOW6lOeUqGlkXHJcbiAgICovXHJcbiAgcHVibGljIGNsb3NlQXBwKGFwcElkPzogc3RyaW5nLCBhcHBFbnRyYW5jZT86IHN0cmluZykge1xyXG4gICAgaWYgKCFhcHBJZCkge1xyXG4gICAgICBhcHBJZCA9IHRoaXMuZ2V0QXBwSWQoKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgYXBwRW50cmFuY2UgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGFwcEVudHJhbmNlID0gdGhpcy5nZXRBcHBFbnRyYW5jZSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKCEhdGhpcy5hcHBTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMuYXBwU2VydmljZS5jbG9zZUFwcChhcHBJZCwgYXBwRW50cmFuY2UpLnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5Y+C5pWwXHJcbiAgICogQHBhcmFtIHBhcmFtcyDot6/nlLHlj4LmlbBcclxuICAgKi9cclxuICBwcml2YXRlIHNldFBhcmFtcyh1cmw6IHN0cmluZywgcGFyYW1zOiBzdHJpbmcgfCB7IFtrZXk6IHN0cmluZ106IGFueTsgfSkge1xyXG4gICAgbGV0IHBhcmFtc09iajtcclxuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAnc3RyaW5nJyAmJiBwYXJhbXMgIT09ICcnKSB7XHJcbiAgICAgIHBhcmFtc09iaiA9IEpTT04ucGFyc2UocGFyYW1zKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBhcmFtc09iaiA9IHBhcmFtcyB8fCB7fTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDorr7nva7ot6/nlLHlj4LmlbBcclxuICAgIHRoaXMucm91dGVyUGFyYW1TZXJ2aWNlLnNldFBhcmFtcyh1cmwsIHBhcmFtc09iaik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZmdW5jSWRcclxuICAgKi9cclxuICBwcml2YXRlIGdldEZ1bmNJZCgpIHtcclxuICAgIGNvbnN0IGhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaDtcclxuICAgIGlmICghaGFzaCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMuZGVjb2RlVVJMUGFyYW1zKGhhc2gpO1xyXG4gICAgaWYgKHBhcmFtcyAmJiBwYXJhbXMuaGFzT3duUHJvcGVydHkoJ2Z1bmNJZCcpKSB7XHJcbiAgICAgIHJldHVybiBwYXJhbXMuZnVuY0lkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZhcHBJZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0QXBwSWQoKSB7XHJcbiAgICBjb25zdCBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XHJcbiAgICBpZiAoIWhhc2gpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXJhbXMgPSB0aGlzLmRlY29kZVVSTFBhcmFtcyhoYXNoKTtcclxuICAgIGlmIChwYXJhbXMgJiYgcGFyYW1zLmhhc093blByb3BlcnR5KCdhcHBJZCcpKSB7XHJcbiAgICAgIHJldHVybiBwYXJhbXMuYXBwSWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0UGFyZW50TWVudUlkKCkge1xyXG4gICAgY29uc3QgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xyXG4gICAgaWYgKCFoYXNoKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5kZWNvZGVVUkxQYXJhbXMoaGFzaCk7XHJcbiAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnV0VCX0ZPUk1fUk9VVEVSX1BBUkVOVF9JRCcpKSB7XHJcbiAgICAgIHJldHVybiBwYXJhbXMuV0VCX0ZPUk1fUk9VVEVSX1BBUkVOVF9JRDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blupTnlKjlhaXlj6NcclxuICAgKi9cclxuICBwcml2YXRlIGdldEFwcEVudHJhbmNlKCkge1xyXG4gICAgY29uc3QgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xyXG4gICAgaWYgKCFoYXNoKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5kZWNvZGVVUkxQYXJhbXMoaGFzaCk7XHJcbiAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnYXBwRW50cmFuY2UnKSkge1xyXG4gICAgICByZXR1cm4gcGFyYW1zLmFwcEVudHJhbmNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOino+eggeWPguaVsFxyXG4gICAqIEBwYXJhbSBxdWVyeSBzZWFyY2h8aGFzaFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVjb2RlVVJMUGFyYW1zKHF1ZXJ5OiBzdHJpbmcpOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgaWYgKHR5cGVvZiBxdWVyeSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcXVlcnkgPSB3aW5kb3cubG9jYXRpb24uaGFzaCB8fCB3aW5kb3cubG9jYXRpb24uc2VhcmNoO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaGFzaGVzID0gcXVlcnkuc2xpY2UocXVlcnkuaW5kZXhPZignPycpICsgMSkuc3BsaXQoJyYnKTtcclxuICAgIHJldHVybiBoYXNoZXMucmVkdWNlKChwYXJhbXMsIGhhc2gpID0+IHtcclxuICAgICAgY29uc3Qgc3BsaXQgPSBoYXNoLmluZGV4T2YoJz0nKTtcclxuICAgICAgY29uc3Qga2V5ID0gaGFzaC5zbGljZSgwLCBzcGxpdCk7XHJcbiAgICAgIGNvbnN0IHZhbCA9IGhhc2guc2xpY2Uoc3BsaXQgKyAxKTtcclxuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24ocGFyYW1zLCB7IFtrZXldOiBkZWNvZGVVUklDb21wb25lbnQodmFsKSB9KTtcclxuICAgIH0sIHt9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFJvdXRlclNlcnZpY2UgfTtcclxuIl19