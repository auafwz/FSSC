// tslint:disable: max-line-length member-ordering
/**
 * 绑定数据相关定义
 * @author Witt<jiwt@inspur.com>
 * @todo
 * 1、全局的BindingData和局部的BindingData应该拆成两个类，两个类之间是装饰关系；；
 * 2、为了保持兼容，减少改动量，暂时放在一起，待进一步重构。
 */
import { Injectable } from '@angular/core';
import { ChangeType } from './changes';
import { BindingList } from './binding_list';
import { BindingListFactory } from './binding_list_factory';
import { PropertyUtil } from './property_util';
import { EntityUtil } from './entity_util';
/**
 * 绑定数据
 * @description
 * # BindingData
 *
 * BindingData用于直接和界面绑定，它持有一个不可变的数据集合（BindingList），数据集合中是一个个不可变的数据对象（BindingObject）。
 *
 * ## 更新界面数据
 *
 * ### 接口定义
 *
 * ```javascript
 * //根据paths设置属性值
 * //@param paths 属性路径数组
 * //@param value 属性值
 * //@param emitEventToView 如果设置为true，则发送事件通知订阅它的组件、指令去更新界面，默认为false。
 * //@param emitEventToEntity 如果设置为true，则同步去更新Entity上对应的字段，默认为true。
 * public setValue(paths: string[], value: any, emitEventToView: boolean = false, emitEventToEntity: boolean = true)
 * ```
 *
 * ### 示例
 *
 * - 更新主表数据
 *
 *   ```javascript
 *   bindingData.setValue(['name'],'ESG');
 *   ```
 *
 * - 更新子表数据
 *
 *   ```javascript
 *   bindingData.setValue(['soItems','price'],20);
 *   ```
 *
 * - 更新业务字段数据
 *
 *   ```javascript
 *   bindingData.setValue(['udt','udt_field'],'value');
 *   ```
 *
 * - 仅更新界面数据（不提交变更集）
 *
 *   ```javascript
 *   bindingData.setValue(['name'],'ESG',true,false);
 *   ```
 *
 *   > 注意：
 *   >
 *   > 仅更新界面数据时bindingData必须是对应组件上下文的bindingData。
 *   >
 *   > 更新数据的命令挂载到不同的组件，产生的效果也不相同。如果命令挂到了卡片视图模型，那么可以直接在构件中注入`FrameContext`或`BindingData`并更新数据就可以。但如果命令挂到了非卡片视图 * 模型，则应该先获取到卡片上下文的bindingData。
 *   >
 *   > - 命令挂在卡片视图模型:
 *   >
 *   >   ```javascript
 *   >   const frameContext = this.frameContext.bindingData;
 *   >   frameContext.bindingData.setValue(['name'],'ESG');
 *   >   ```
 *   >
 *   > - 命令挂在非卡片视图模型：
 *   >
 *   >   ```javascript
 *   >   const cardFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('card-frameId');
 *   >   cardFrameContext.bindingData.setValue(['name'],'ESG');
 *   >   ```
 *
 * ## 获取界面数据
 *
 * ### 接口定义
 *
 *   ```javascript
 *   //获取paths对应的属性值
 *   //@param  paths 属性路径数组
 *   //@returns 属性值
 *   public getValue(paths: string[], useInitValue = false)
 *   ```
 *
 * ### 示例
 *
 * - 获取主表数据
 *
 *   ```javascript
 *   bindingData.getValue(['name']) //'ESG'
 *   ```
 *
 * - 获取从表中字段属性
 *
 *   ```javascript
 *   bindingData.getValue(['soItems','price']); // 20
 *   ```
 *
 * - 获取业务字段数据
 *
 *   ```javascript
 *   bindingData.getValue(['udt','udt_field']); // 'value'
 *   ```
 *
 * ## 获取指定BindingObject
 *
 * ### 接口定义
 *
 * ```javascript
 * //通过主键获取对应的bindingObject
 * bindingData.list.findById(id: string): BindingObject;
 * ```
 *
 * ### 示例
 * - 获取某个主实体
 *   ```javascript
 *   bindingData.list.findById("id");
 *   ```
 * - 获取某个实体下子表的所有数据
 *   ```javascript
 *   // 获取主实体
 *   const bindingObject = bindingData.list.findById("id") as BindingObject;
 *   // 获取该实体下的某个子表数据
 *   const bindingList = bindingObject.getValue("soItems") as BindingList;
 *   ```
 *
 * - 获取子表某一行数据
 *
 *   ```javascript
 *   //获取主实体
 *   const bindingObject = bindingData.list.findById("id") as BindingObject;
 *   //获取该实体下的某个子表数据
 *   const bindingList = bindingObject.getValue("soItems") as BindingList;
 *   //子表行数据
 *   const childrenBindingObject = bindingList.findById('子表数据id');
 *   const name = childrenBindingObject.getValue("name"); // 或者childrenBindingObject['name']
 *   ```
 *
 * ## 常见问题
 *
 * ### 赋值或取值时为何不用指定主键？
 *
 *    示例中取值或赋值时并没有指定主键值，这是由于BindingData赋值或取值时都是对当前行就行操作的，所以不需要指定主键。所以在计算&行切换场景下会导致取值或赋值错误，如本来想给第一行的某个字 * 段赋值，结果由于行切换导致把值赋给了其他行。
 *
 *    如果遇到赋值错误的情况可以通过BindingObject赋值或取值。
 *
 * ### 通过bindingData赋值了，界面也刷新了，但保存不上
 *
 *    这种情况多发生在有后端请求的情况下，比如通过bindingData赋值后紧接着有一个后端请求。由于bindingData赋值是异步的（目前是），这就可能导致赋值还没有结束（还没有产生变更）请求就发送 * 了，从而请求中没有对应的变更，请求回来后会默认清空本地变更，从而导致界面上显示数据已经修改，但数据库中数据并未修改。
 *
 *    解决该类问题可以通过实体赋值的方式，给实体赋值是同步的，赋值完成后变更就会产生，这样再发送请求时就可以把变更带到后端。
 */
var BindingData = /** @class */ (function () {
    function BindingData() {
        this.paginationInfo = null;
    }
    Object.defineProperty(BindingData.prototype, "pagingInfo", {
        get: function () {
            return this.paginationInfo;
        },
        set: function (pagingInfo) {
            this.paginationInfo = pagingInfo;
            this.firePagingChangeEvent();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 设置分页信息
     * @param skip 跳过
     * @param take 获取
     * @param bindingPath 路径
     */
    BindingData.prototype.setPagingInfo = function (skip, take, bindingPath) {
        if (bindingPath.length < 1 || bindingPath === '/') {
            this.paginationInfo = Object.assign(this.paginationInfo, { pageSize: take, pageIndex: skip / take + 1 });
        }
        else {
            var pagingInfo = this.paginationInfo || {};
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; }); // .map(item => item.substring(0, item.length - 1));
            var nodeCode = bindingPaths[bindingPaths.length - 1];
            // 去s
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            // 找到父级
            // 获取当前实体上级的主键
            var paths = bindingPaths.slice(0, bindingPaths.length - 1);
            var parentObject = this.getValue(paths);
            if (parentObject && parentObject[parentObject.primaryKey]) {
                // const key = `${nodeCode}_${parentObject[parentObject.primaryKey]}`;
                var key = "" + nodeCode;
                pagingInfo = pagingInfo[key] || {};
                pagingInfo.pageIndex = ((skip / take) || 0) + 1;
                pagingInfo.pageSize = take || 0;
            }
        }
        this.firePagingChangeEvent();
    };
    BindingData.prototype.updatePagingInfo = function (pageInfo, bindingPath) {
        if (bindingPath.length < 1 || bindingPath === '/') {
            this.paginationInfo = Object.assign(this.paginationInfo, pageInfo);
        }
        else {
            var pagingInfo = this.paginationInfo || {};
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; }); // .map(item => item.substring(0, item.length - 1));
            var nodeCode = bindingPaths[bindingPaths.length - 1];
            // 去s
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            pagingInfo[nodeCode] = Object.assign(pagingInfo[nodeCode], pageInfo);
        }
        this.firePagingChangeEvent();
    };
    BindingData.prototype.firePagingChangeEvent = function () {
        this.list.changes.next({
            type: ChangeType.PaginationInfoChange,
            path: this.bindingPath && this.bindingPath.split('/').filter(function (p) { return p; }) || [],
            value: this.paginationInfo
        });
    };
    Object.defineProperty(BindingData.prototype, "changes", {
        /**
         * 变更集
         */
        get: function () {
            return this.list.changes;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 设置值变化执行器工厂
     * @param value 值变化执行器工厂
     */
    BindingData.prototype.setValueChangeInvokerFactory = function (value) {
        this.valueChangeInvokerFactory = value;
    };
    BindingData.prototype.getValudChangeInvokerFactory = function () {
        return this.valueChangeInvokerFactory;
    };
    /**
     * 初始化（已废弃）
     */
    BindingData.prototype.init = function (repository, bindingPath) {
        this.initByRepository(repository, bindingPath);
    };
    /**
     * 根据Repository对BindingData进行初始化
     */
    BindingData.prototype.initByRepository = function (repository, bindingPath) {
        this.bindingPath = bindingPath;
        this.properties = PropertyUtil.getProperties(repository.entityType);
        this.list = BindingListFactory.create(this.properties);
        // 从repository初始化bindingData
        this.pagingInfo = repository.entityCollection.paginationInfo;
        // @todo
        // BindingData不应该知道Repository，加载数据、建立关联关系的过程应该转移到外边
        EntityUtil.loadRepository(repository, this.list);
        this.dataTypeInfo = repository.entityTypeInfo;
        this.extendProperties(this.properties);
    };
    /**
     * 初始化
     */
    BindingData.prototype.initByBindingList = function (bindingList, bindingPath) {
        this.list = bindingList;
        this.bindingPath = bindingPath;
        this.extendProperties(this.list.properties);
    };
    BindingData.prototype.setDataTypeInfo = function (dataTypeInfo) {
        this.dataTypeInfo = dataTypeInfo;
    };
    /**
     * 获取界面数据
     * @param paths 属性路径数组
     * @param useInitValue 是否使用默认值，默认为`false`
     * @returns 属性值
     */
    BindingData.prototype.getValue = function (paths, useInitValue) {
        if (useInitValue === void 0) { useInitValue = false; }
        var target = this.list;
        paths.forEach(function (path) {
            if (target) {
                target = target[path];
            }
        });
        if (useInitValue === true && paths && paths.length > 0) {
            var initValue = this.getInitValueByPaths(paths);
            if (target === undefined && target !== initValue) {
                target = initValue;
            }
        }
        return target;
    };
    /**
     * 该方法可以更新绑定层数据，从而达到更新界面数据的目的，进而更新本地仓库实体数据，产生变更，下次请求时会将变更带到后端并更新后端数据。
     * @param paths 属性路径数组
     * @param value 属性值
     * @param emitEventToView 如果设置为true，则发送事件通知订阅它的组件、指令去更新界面，默认为false。
     * @param emitEventToEntity 如果设置为true，则同步去更新Entity上对应的字段，默认为true。
     * @description
     * ## 示例
     *
     * ### 更新界面数据
     * 使用该方法时只传递path和value参数，其余参数使用默认值。该用法会更新界面数据，同时更新实体数据，实体数据更新时会产生变更，这样在下次请求时会将该变更带到后端，
     * 进而更新后端数据。
     * ```typescript
     * this.frameContext.bindingData.setValue(paths,value);
     * ```
     *
     * ### 仅更新界面数据
     * 有些场景下我们希望只更新界面的数据，不希望对后端数据产生影响，此时除传递paths和value参数外，还需要将emitEventToView设为true，emitEventToEntity设为false，
     * 此时必须使用对应BindingData的setValue方法：
     * ```typescript
     * const tableFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('data-grid-component');
     * tableFrameContext.bindingData.setValue(paths,value,true,false);
     * ```
     * ## 注意事项
     * setValue为异步方法，如果调用该方法后随即发送后端请求，此时实体变更尚未产生，但请求已经发送，变更无法带到后端，导致变更丢失，出现界面上显示数据已经修改，
     * 但后端并未修改的问题。
     * 因此，如果赋值后随即发送请求应该使用实体赋值的方法。
     */
    BindingData.prototype.setValue = function (paths, value, emitEventToView, emitEventToEntity, errors, context) {
        if (emitEventToView === void 0) { emitEventToView = false; }
        if (emitEventToEntity === void 0) { emitEventToEntity = true; }
        if (errors === void 0) { errors = {}; }
        if (!paths || paths.length === 0) {
            throw Error('路径不能为空');
        }
        var parentPaths = paths.slice(0, paths.length - 1);
        var propName = paths[paths.length - 1];
        var parent = this.getValue(parentPaths);
        if (!parent) {
            throw Error('找不到要设置的对象');
        }
        if (parent instanceof BindingData) {
            parent = parent.list.currentItem;
        }
        else if (parent instanceof BindingList) {
            parent = parent.currentItem;
        }
        if (!!this.valueChangeInvokerFactory) {
            parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, this.valueChangeInvokerFactory(paths), context);
        }
        else {
            parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, null, context);
        }
    };
    /**
     * 根据paths清空属性值
     */
    BindingData.prototype.clearValue = function (paths, emitEventToView, emitEventToEntity, context) {
        if (emitEventToView === void 0) { emitEventToView = false; }
        if (emitEventToEntity === void 0) { emitEventToEntity = true; }
        var initValue;
        var propInfo = this.dataTypeInfo.getPropInfoByPath(paths);
        if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {
            initValue = propInfo.metadataInfo.initValue;
        }
        else {
            // 原来的帮助映射中，强行纠正了数值的情况，保持一致
            var oldValue = this.getValue(paths);
            if (typeof oldValue === 'number') {
                initValue = 0;
            }
            else {
                initValue = '';
            }
        }
        this.setValue(paths, initValue, emitEventToView, emitEventToEntity, null, context);
    };
    /**
     * 获取当前列表
     */
    BindingData.prototype.getList = function () {
        if (!this.bindingPath || this.bindingPath === '/') {
            return this.list;
        }
        var bindingPath = this.bindingPath.substr(1);
        var bindingPathArray = bindingPath.split('/').filter(function (part) {
            return part !== '';
        });
        return this.getValue(bindingPathArray);
    };
    /**
     * 获取当前对象
     */
    BindingData.prototype.getObject = function () {
        var bindingList = this.getList();
        return bindingList.currentItem;
    };
    /**
     * 绑定路径（仅路径部分，不包括属性）
     * @param bindingPath 绑定路径
     */
    BindingData.prototype.getPath = function (bindingPath) {
        var _this = this;
        var bindingPaths = bindingPath.filter(function (p) { return p; });
        var path = [this.list.primaryKey + ":" + this.list.currentId];
        bindingPaths.forEach(function (item) {
            path.push(item);
            var list = _this[item];
            if (list) {
                path.push(list.primaryKey + ":" + list.currentId);
            }
        });
        return path;
    };
    /**
     * 清空绑定数据
     */
    BindingData.prototype.reset = function () {
        this.list.clear();
    };
    /**
     * 通过绑定路径获取属性初始值
     * @param paths 绑定路径
     */
    BindingData.prototype.getInitValueByPaths = function (paths) {
        var initValue;
        var propInfo = this.dataTypeInfo && this.dataTypeInfo.getPropInfoByPath(paths) || null;
        if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {
            initValue = propInfo.metadataInfo.initValue;
        }
        return initValue;
    };
    /**
     * 扩展BindingData属性，映射BindingData所持有的绑定列表当前行的属性，减少绑定层级。
     * @param properties 关联实体的属性集合
     */
    BindingData.prototype.extendProperties = function (properties) {
        var _this = this;
        properties.forEach(function (property) {
            var propName = property.name;
            Object.defineProperty(_this, propName, {
                get: function () {
                    return _this.list.currentItem[propName];
                },
                set: function (value) {
                    _this.list.currentItem[propName] = value;
                }
            });
        });
    };
    BindingData.decorators = [
        { type: Injectable }
    ];
    return BindingData;
}());
export { BindingData };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19kYXRhLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2JpbmRpbmdfZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrREFBa0Q7QUFDbEQ7Ozs7OztHQU1HO0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkzQyxPQUFPLEVBQVUsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRS9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkzQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBZ0pHO0FBQ0g7SUFBQTtRQTBCVSxtQkFBYyxHQUFHLElBQUksQ0FBQztJQStSaEMsQ0FBQztJQTdSQyxzQkFBVyxtQ0FBVTthQUtyQjtZQUNFLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUM3QixDQUFDO2FBUEQsVUFBc0IsVUFBZTtZQUNuQyxJQUFJLENBQUMsY0FBYyxHQUFHLFVBQVUsQ0FBQztZQUNqQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUMvQixDQUFDOzs7T0FBQTtJQUtEOzs7OztPQUtHO0lBQ0ksbUNBQWEsR0FBcEIsVUFBcUIsSUFBWSxFQUFFLElBQVksRUFBRSxXQUFtQjtRQUNsRSxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLFdBQVcsS0FBSyxHQUFHLEVBQUU7WUFDakQsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDMUc7YUFBTTtZQUNMLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxjQUFjLElBQUksRUFBRSxDQUFDO1lBQzNDLElBQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQXpCLENBQXlCLENBQUMsQ0FBQyxDQUFDLG9EQUFvRDtZQUNySixJQUFJLFFBQVEsR0FBRyxZQUFZLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNyRCxLQUFLO1lBQ0wsUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDbkQsT0FBTztZQUNQLGNBQWM7WUFDZCxJQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzdELElBQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFrQixDQUFDO1lBQzNELElBQUksWUFBWSxJQUFJLFlBQVksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEVBQUU7Z0JBQ3pELHNFQUFzRTtnQkFDdEUsSUFBTSxHQUFHLEdBQUcsS0FBRyxRQUFVLENBQUM7Z0JBQzFCLFVBQVUsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNuQyxVQUFVLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoRCxVQUFVLENBQUMsUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUM7YUFDakM7U0FDRjtRQUNELElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFDTSxzQ0FBZ0IsR0FBdkIsVUFBd0IsUUFBbUUsRUFBRSxXQUFtQjtRQUM5RyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLFdBQVcsS0FBSyxHQUFHLEVBQUU7WUFDakQsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDcEU7YUFBTTtZQUNMLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxjQUFjLElBQUksRUFBRSxDQUFDO1lBQzNDLElBQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQXpCLENBQXlCLENBQUMsQ0FBQyxDQUFDLG9EQUFvRDtZQUNySixJQUFJLFFBQVEsR0FBRyxZQUFZLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNyRCxLQUFLO1lBQ0wsUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDbkQsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQ3RFO1FBQ0QsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUNPLDJDQUFxQixHQUE3QjtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztZQUNyQixJQUFJLEVBQUUsVUFBVSxDQUFDLG9CQUFvQjtZQUNyQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEVBQUQsQ0FBQyxDQUFDLElBQUksRUFBRTtZQUMxRSxLQUFLLEVBQUUsSUFBSSxDQUFDLGNBQWM7U0FDM0IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUlELHNCQUFXLGdDQUFPO1FBSGxCOztXQUVHO2FBQ0g7WUFDRSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQzNCLENBQUM7OztPQUFBO0lBT0Q7OztPQUdHO0lBQ0ksa0RBQTRCLEdBQW5DLFVBQW9DLEtBQStDO1FBQ2pGLElBQUksQ0FBQyx5QkFBeUIsR0FBRyxLQUFLLENBQUM7SUFDekMsQ0FBQztJQUNNLGtEQUE0QixHQUFuQztRQUNFLE9BQU8sSUFBSSxDQUFDLHlCQUF5QixDQUFDO0lBQ3hDLENBQUM7SUFFRDs7T0FFRztJQUNJLDBCQUFJLEdBQVgsVUFBWSxVQUEyQixFQUFFLFdBQW1CO1FBQzFELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksc0NBQWdCLEdBQXZCLFVBQXdCLFVBQTJCLEVBQUUsV0FBbUI7UUFDdEUsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFFL0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxZQUFZLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsSUFBSSxHQUFHLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdkQsNEJBQTRCO1FBQzVCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FBQztRQUM3RCxRQUFRO1FBQ1IsbURBQW1EO1FBQ25ELFVBQVUsQ0FBQyxjQUFjLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsWUFBWSxHQUFHLFVBQVUsQ0FBQyxjQUFjLENBQUM7UUFFOUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSSx1Q0FBaUIsR0FBeEIsVUFBeUIsV0FBd0IsRUFBRSxXQUFtQjtRQUNwRSxJQUFJLENBQUMsSUFBSSxHQUFHLFdBQVcsQ0FBQztRQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBQ00scUNBQWUsR0FBdEIsVUFBdUIsWUFBMEI7UUFDL0MsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7SUFDbkMsQ0FBQztJQUNEOzs7OztPQUtHO0lBQ0ksOEJBQVEsR0FBZixVQUFnQixLQUFlLEVBQUUsWUFBb0I7UUFBcEIsNkJBQUEsRUFBQSxvQkFBb0I7UUFDbkQsSUFBSSxNQUFNLEdBQVEsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM1QixLQUFLLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBWTtZQUN6QixJQUFJLE1BQU0sRUFBRTtnQkFDVixNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3ZCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLFlBQVksS0FBSyxJQUFJLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3RELElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNsRCxJQUFJLE1BQU0sS0FBSyxTQUFTLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtnQkFDaEQsTUFBTSxHQUFHLFNBQVMsQ0FBQzthQUNwQjtTQUNGO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0EyQkc7SUFDSSw4QkFBUSxHQUFmLFVBQWdCLEtBQWUsRUFBRSxLQUFVLEVBQUUsZUFBZ0MsRUFBRSxpQkFBaUMsRUFBRSxNQUFnQixFQUFFLE9BQWE7UUFBcEcsZ0NBQUEsRUFBQSx1QkFBZ0M7UUFBRSxrQ0FBQSxFQUFBLHdCQUFpQztRQUFFLHVCQUFBLEVBQUEsV0FBZ0I7UUFFaEksSUFBSSxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNoQyxNQUFNLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUN2QjtRQUNELElBQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckQsSUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFekMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1gsTUFBTSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDMUI7UUFDRCxJQUFJLE1BQU0sWUFBWSxXQUFXLEVBQUU7WUFDakMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1NBQ2xDO2FBQU0sSUFBSSxNQUFNLFlBQVksV0FBVyxFQUFFO1lBQ3hDLE1BQU0sR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO1NBQzdCO1FBQ0QsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFO1lBQ3BDLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztTQUM5SDthQUFNO1lBQ0wsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQzdGO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0NBQVUsR0FBakIsVUFBa0IsS0FBZSxFQUFFLGVBQWdDLEVBQUUsaUJBQWlDLEVBQUUsT0FBYTtRQUFsRixnQ0FBQSxFQUFBLHVCQUFnQztRQUFFLGtDQUFBLEVBQUEsd0JBQWlDO1FBQ3BHLElBQUksU0FBYyxDQUFDO1FBQ25CLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUQsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLFlBQVksSUFBSSxRQUFRLENBQUMsWUFBWSxDQUFDLFNBQVMsS0FBSyxTQUFTLEVBQUU7WUFDdEYsU0FBUyxHQUFHLFFBQVEsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDO1NBQzdDO2FBQU07WUFFTCwyQkFBMkI7WUFDM0IsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN0QyxJQUFJLE9BQU8sUUFBUSxLQUFLLFFBQVEsRUFBRTtnQkFDaEMsU0FBUyxHQUFHLENBQUMsQ0FBQzthQUNmO2lCQUFNO2dCQUNMLFNBQVMsR0FBRyxFQUFFLENBQUM7YUFDaEI7U0FDRjtRQUNELElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUUsaUJBQWlCLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFFRDs7T0FFRztJQUNJLDZCQUFPLEdBQWQ7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLEdBQUcsRUFBRTtZQUNqRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDbEI7UUFFRCxJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQyxJQUFNLGdCQUFnQixHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsSUFBWTtZQUNsRSxPQUFPLElBQUksS0FBSyxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSSwrQkFBUyxHQUFoQjtRQUNFLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNuQyxPQUFPLFdBQVcsQ0FBQyxXQUFXLENBQUM7SUFDakMsQ0FBQztJQUNEOzs7T0FHRztJQUNJLDZCQUFPLEdBQWQsVUFBZSxXQUFzQjtRQUFyQyxpQkFZQztRQVhDLElBQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEVBQUQsQ0FBQyxDQUFDLENBQUM7UUFDaEQsSUFBTSxJQUFJLEdBQUcsQ0FBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsU0FBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVcsQ0FBQyxDQUFDO1FBRWhFLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFZO1lBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDaEIsSUFBTSxJQUFJLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBZ0IsQ0FBQztZQUN2QyxJQUFJLElBQUksRUFBRTtnQkFDUixJQUFJLENBQUMsSUFBSSxDQUFJLElBQUksQ0FBQyxVQUFVLFNBQUksSUFBSSxDQUFDLFNBQVcsQ0FBQyxDQUFDO2FBQ25EO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRDs7T0FFRztJQUNJLDJCQUFLLEdBQVo7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFDRDs7O09BR0c7SUFDSyx5Q0FBbUIsR0FBM0IsVUFBNEIsS0FBb0I7UUFDOUMsSUFBSSxTQUFjLENBQUM7UUFDbkIsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN6RixJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsWUFBWSxJQUFJLFFBQVEsQ0FBQyxZQUFZLENBQUMsU0FBUyxLQUFLLFNBQVMsRUFBRTtZQUN0RixTQUFTLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUM7U0FDN0M7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ssc0NBQWdCLEdBQXhCLFVBQXlCLFVBQTZCO1FBQXRELGlCQVlDO1FBWEMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFDLFFBQXlCO1lBQzNDLElBQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDL0IsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFJLEVBQUUsUUFBUSxFQUFFO2dCQUNwQyxHQUFHLEVBQUU7b0JBQ0gsT0FBTyxLQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDekMsQ0FBQztnQkFDRCxHQUFHLEVBQUUsVUFBQyxLQUFVO29CQUNkLEtBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEtBQUssQ0FBQztnQkFDMUMsQ0FBQzthQUNGLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7Z0JBeFRGLFVBQVU7O0lBeVRYLGtCQUFDO0NBQUEsQUF6VEQsSUF5VEM7QUFFRCxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTogbWF4LWxpbmUtbGVuZ3RoIG1lbWJlci1vcmRlcmluZ1xyXG4vKipcclxuICog57uR5a6a5pWw5o2u55u45YWz5a6a5LmJXHJcbiAqIEBhdXRob3IgV2l0dDxqaXd0QGluc3B1ci5jb20+XHJcbiAqIEB0b2RvXHJcbiAqIDHjgIHlhajlsYDnmoRCaW5kaW5nRGF0YeWSjOWxgOmDqOeahEJpbmRpbmdEYXRh5bqU6K+l5ouG5oiQ5Lik5Liq57G777yM5Lik5Liq57G75LmL6Ze05piv6KOF6aWw5YWz57O777yb77ybXHJcbiAqIDLjgIHkuLrkuobkv53mjIHlhbzlrrnvvIzlh4/lsJHmlLnliqjph4/vvIzmmoLml7bmlL7lnKjkuIDotbfvvIzlvoXov5vkuIDmraXph43mnoTjgIJcclxuICovXHJcblxyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRGF0YVR5cGVJbmZvIH0gZnJvbSAnLi4vY29yZS9kYXRhLXR5cGUtaW5mbyc7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3J5L2luZGV4JztcclxuaW1wb3J0IHsgQ2hhbmdlLCBDaGFuZ2VUeXBlIH0gZnJvbSAnLi9jaGFuZ2VzJztcclxuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5IH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcclxuaW1wb3J0IHsgQmluZGluZ0xpc3QgfSBmcm9tICcuL2JpbmRpbmdfbGlzdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0RmFjdG9yeSB9IGZyb20gJy4vYmluZGluZ19saXN0X2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eVV0aWwgfSBmcm9tICcuL3Byb3BlcnR5X3V0aWwnO1xyXG5pbXBvcnQgeyBFbnRpdHlVdGlsIH0gZnJvbSAnLi9lbnRpdHlfdXRpbCc7XHJcbmltcG9ydCB7IEJpbmRpbmdPYmplY3QgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0JztcclxuaW1wb3J0IHsgSW52b2tlT25WYWx1ZUNoYW5nZSB9IGZyb20gJy4vdHlwZXMnO1xyXG5cclxuLyoqXHJcbiAqIOe7keWumuaVsOaNrlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogIyBCaW5kaW5nRGF0YVxyXG4gKiBcclxuICogQmluZGluZ0RhdGHnlKjkuo7nm7TmjqXlkoznlYzpnaLnu5HlrprvvIzlroPmjIHmnInkuIDkuKrkuI3lj6/lj5jnmoTmlbDmja7pm4blkIjvvIhCaW5kaW5nTGlzdO+8ie+8jOaVsOaNrumbhuWQiOS4reaYr+S4gOS4quS4quS4jeWPr+WPmOeahOaVsOaNruWvueixoe+8iEJpbmRpbmdPYmplY3TvvInjgIJcclxuICogXHJcbiAqICMjIOabtOaWsOeVjOmdouaVsOaNrlxyXG4gKiBcclxuICogIyMjIOaOpeWPo+WumuS5iVxyXG4gKiBcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvL+agueaNrnBhdGhz6K6+572u5bGe5oCn5YC8XHJcbiAqIC8vQHBhcmFtIHBhdGhzIOWxnuaAp+i3r+W+hOaVsOe7hFxyXG4gKiAvL0BwYXJhbSB2YWx1ZSDlsZ7mgKflgLxcclxuICogLy9AcGFyYW0gZW1pdEV2ZW50VG9WaWV3IOWmguaenOiuvue9ruS4unRydWXvvIzliJnlj5HpgIHkuovku7bpgJrnn6XorqLpmIXlroPnmoTnu4Tku7bjgIHmjIfku6Tljrvmm7TmlrDnlYzpnaLvvIzpu5jorqTkuLpmYWxzZeOAglxyXG4gKiAvL0BwYXJhbSBlbWl0RXZlbnRUb0VudGl0eSDlpoLmnpzorr7nva7kuLp0cnVl77yM5YiZ5ZCM5q2l5Y675pu05pawRW50aXR55LiK5a+55bqU55qE5a2X5q6177yM6buY6K6k5Li6dHJ1ZeOAglxyXG4gKiBwdWJsaWMgc2V0VmFsdWUocGF0aHM6IHN0cmluZ1tdLCB2YWx1ZTogYW55LCBlbWl0RXZlbnRUb1ZpZXc6IGJvb2xlYW4gPSBmYWxzZSwgZW1pdEV2ZW50VG9FbnRpdHk6IGJvb2xlYW4gPSB0cnVlKVxyXG4gKiBgYGBcclxuICogXHJcbiAqICMjIyDnpLrkvotcclxuICogXHJcbiAqIC0g5pu05paw5Li76KGo5pWw5o2uXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBiaW5kaW5nRGF0YS5zZXRWYWx1ZShbJ25hbWUnXSwnRVNHJyk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOabtOaWsOWtkOihqOaVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuc2V0VmFsdWUoWydzb0l0ZW1zJywncHJpY2UnXSwyMCk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOabtOaWsOS4muWKoeWtl+auteaVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuc2V0VmFsdWUoWyd1ZHQnLCd1ZHRfZmllbGQnXSwndmFsdWUnKTtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g5LuF5pu05paw55WM6Z2i5pWw5o2u77yI5LiN5o+Q5Lqk5Y+Y5pu06ZuG77yJXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBiaW5kaW5nRGF0YS5zZXRWYWx1ZShbJ25hbWUnXSwnRVNHJyx0cnVlLGZhbHNlKTtcclxuICogICBgYGBcclxuICogXHJcbiAqICAgPiDms6jmhI/vvJpcclxuICogICA+XHJcbiAqICAgPiDku4Xmm7TmlrDnlYzpnaLmlbDmja7ml7ZiaW5kaW5nRGF0YeW/hemhu+aYr+WvueW6lOe7hOS7tuS4iuS4i+aWh+eahGJpbmRpbmdEYXRh44CCXHJcbiAqICAgPlxyXG4gKiAgID4g5pu05paw5pWw5o2u55qE5ZG95Luk5oyC6L295Yiw5LiN5ZCM55qE57uE5Lu277yM5Lqn55Sf55qE5pWI5p6c5Lmf5LiN55u45ZCM44CC5aaC5p6c5ZG95Luk5oyC5Yiw5LqG5Y2h54mH6KeG5Zu+5qih5Z6L77yM6YKj5LmI5Y+v5Lul55u05o6l5Zyo5p6E5Lu25Lit5rOo5YWlYEZyYW1lQ29udGV4dGDmiJZgQmluZGluZ0RhdGFg5bm25pu05paw5pWw5o2u5bCx5Y+v5Lul44CC5L2G5aaC5p6c5ZG95Luk5oyC5Yiw5LqG6Z2e5Y2h54mH6KeG5Zu+ICog5qih5Z6L77yM5YiZ5bqU6K+l5YWI6I635Y+W5Yiw5Y2h54mH5LiK5LiL5paH55qEYmluZGluZ0RhdGHjgIJcclxuICogICA+XHJcbiAqICAgPiAtIOWRveS7pOaMguWcqOWNoeeJh+inhuWbvuaooeWeizpcclxuICogICA+XHJcbiAqICAgPiAgIGBgYGphdmFzY3JpcHRcclxuICogICA+ICAgY29uc3QgZnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGE7XHJcbiAqICAgPiAgIGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5zZXRWYWx1ZShbJ25hbWUnXSwnRVNHJyk7XHJcbiAqICAgPiAgIGBgYFxyXG4gKiAgID5cclxuICogICA+IC0g5ZG95Luk5oyC5Zyo6Z2e5Y2h54mH6KeG5Zu+5qih5Z6L77yaXHJcbiAqICAgPlxyXG4gKiAgID4gICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgPiAgIGNvbnN0IGNhcmRGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZCgnY2FyZC1mcmFtZUlkJyk7XHJcbiAqICAgPiAgIGNhcmRGcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuc2V0VmFsdWUoWyduYW1lJ10sJ0VTRycpO1xyXG4gKiAgID4gICBgYGBcclxuICogXHJcbiAqICMjIOiOt+WPlueVjOmdouaVsOaNrlxyXG4gKiBcclxuICogIyMjIOaOpeWPo+WumuS5iVxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgLy/ojrflj5ZwYXRoc+WvueW6lOeahOWxnuaAp+WAvFxyXG4gKiAgIC8vQHBhcmFtICBwYXRocyDlsZ7mgKfot6/lvoTmlbDnu4RcclxuICogICAvL0ByZXR1cm5zIOWxnuaAp+WAvFxyXG4gKiAgIHB1YmxpYyBnZXRWYWx1ZShwYXRoczogc3RyaW5nW10sIHVzZUluaXRWYWx1ZSA9IGZhbHNlKVxyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogIyMjIOekuuS+i1xyXG4gKiBcclxuICogLSDojrflj5bkuLvooajmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLmdldFZhbHVlKFsnbmFtZSddKSAvLydFU0cnXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOiOt+WPluS7juihqOS4reWtl+auteWxnuaAp1xyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuZ2V0VmFsdWUoWydzb0l0ZW1zJywncHJpY2UnXSk7IC8vIDIwXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOiOt+WPluS4muWKoeWtl+auteaVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuZ2V0VmFsdWUoWyd1ZHQnLCd1ZHRfZmllbGQnXSk7IC8vICd2YWx1ZSdcclxuICogICBgYGBcclxuICogXHJcbiAqICMjIOiOt+WPluaMh+WumkJpbmRpbmdPYmplY3RcclxuICogXHJcbiAqICMjIyDmjqXlj6PlrprkuYlcclxuICogXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy/pgJrov4fkuLvplK7ojrflj5blr7nlupTnmoRiaW5kaW5nT2JqZWN0XHJcbiAqIGJpbmRpbmdEYXRhLmxpc3QuZmluZEJ5SWQoaWQ6IHN0cmluZyk6IEJpbmRpbmdPYmplY3Q7XHJcbiAqIGBgYFxyXG4gKiBcclxuICogIyMjIOekuuS+i1xyXG4gKiAtIOiOt+WPluafkOS4quS4u+WunuS9k1xyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBiaW5kaW5nRGF0YS5saXN0LmZpbmRCeUlkKFwiaWRcIik7XHJcbiAqICAgYGBgXHJcbiAqIC0g6I635Y+W5p+Q5Liq5a6e5L2T5LiL5a2Q6KGo55qE5omA5pyJ5pWw5o2uXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIC8vIOiOt+WPluS4u+WunuS9k1xyXG4gKiAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBiaW5kaW5nRGF0YS5saXN0LmZpbmRCeUlkKFwiaWRcIikgYXMgQmluZGluZ09iamVjdDtcclxuICogICAvLyDojrflj5bor6Xlrp7kvZPkuIvnmoTmn5DkuKrlrZDooajmlbDmja5cclxuICogICBjb25zdCBiaW5kaW5nTGlzdCA9IGJpbmRpbmdPYmplY3QuZ2V0VmFsdWUoXCJzb0l0ZW1zXCIpIGFzIEJpbmRpbmdMaXN0O1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDojrflj5blrZDooajmn5DkuIDooYzmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIC8v6I635Y+W5Li75a6e5L2TXHJcbiAqICAgY29uc3QgYmluZGluZ09iamVjdCA9IGJpbmRpbmdEYXRhLmxpc3QuZmluZEJ5SWQoXCJpZFwiKSBhcyBCaW5kaW5nT2JqZWN0O1xyXG4gKiAgIC8v6I635Y+W6K+l5a6e5L2T5LiL55qE5p+Q5Liq5a2Q6KGo5pWw5o2uXHJcbiAqICAgY29uc3QgYmluZGluZ0xpc3QgPSBiaW5kaW5nT2JqZWN0LmdldFZhbHVlKFwic29JdGVtc1wiKSBhcyBCaW5kaW5nTGlzdDtcclxuICogICAvL+WtkOihqOihjOaVsOaNrlxyXG4gKiAgIGNvbnN0IGNoaWxkcmVuQmluZGluZ09iamVjdCA9IGJpbmRpbmdMaXN0LmZpbmRCeUlkKCflrZDooajmlbDmja5pZCcpO1xyXG4gKiAgIGNvbnN0IG5hbWUgPSBjaGlsZHJlbkJpbmRpbmdPYmplY3QuZ2V0VmFsdWUoXCJuYW1lXCIpOyAvLyDmiJbogIVjaGlsZHJlbkJpbmRpbmdPYmplY3RbJ25hbWUnXVxyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogIyMg5bi46KeB6Zeu6aKYXHJcbiAqIFxyXG4gKiAjIyMg6LWL5YC85oiW5Y+W5YC85pe25Li65L2V5LiN55So5oyH5a6a5Li76ZSu77yfXHJcbiAqIFxyXG4gKiAgICDnpLrkvovkuK3lj5blgLzmiJbotYvlgLzml7blubbmsqHmnInmjIflrprkuLvplK7lgLzvvIzov5nmmK/nlLHkuo5CaW5kaW5nRGF0Yei1i+WAvOaIluWPluWAvOaXtumDveaYr+WvueW9k+WJjeihjOWwseihjOaTjeS9nOeahO+8jOaJgOS7peS4jemcgOimgeaMh+WumuS4u+mUruOAguaJgOS7peWcqOiuoeeulybooYzliIfmjaLlnLrmma/kuIvkvJrlr7zoh7Tlj5blgLzmiJbotYvlgLzplJnor6/vvIzlpoLmnKzmnaXmg7Pnu5nnrKzkuIDooYznmoTmn5DkuKrlrZcgKiDmrrXotYvlgLzvvIznu5PmnpznlLHkuo7ooYzliIfmjaLlr7zoh7TmiorlgLzotYvnu5nkuoblhbbku5booYzjgIJcclxuICogXHJcbiAqICAgIOWmguaenOmBh+WIsOi1i+WAvOmUmeivr+eahOaDheWGteWPr+S7pemAmui/h0JpbmRpbmdPYmplY3TotYvlgLzmiJblj5blgLzjgIJcclxuICogXHJcbiAqICMjIyDpgJrov4diaW5kaW5nRGF0Yei1i+WAvOS6hu+8jOeVjOmdouS5n+WIt+aWsOS6hu+8jOS9huS/neWtmOS4jeS4ilxyXG4gKiBcclxuICogICAg6L+Z56eN5oOF5Ya15aSa5Y+R55Sf5Zyo5pyJ5ZCO56uv6K+35rGC55qE5oOF5Ya15LiL77yM5q+U5aaC6YCa6L+HYmluZGluZ0RhdGHotYvlgLzlkI7ntKfmjqXnnYDmnInkuIDkuKrlkI7nq6/or7fmsYLjgILnlLHkuo5iaW5kaW5nRGF0Yei1i+WAvOaYr+W8guatpeeahO+8iOebruWJjeaYr++8ie+8jOi/meWwseWPr+iDveWvvOiHtOi1i+WAvOi/mOayoeaciee7k+adn++8iOi/mOayoeacieS6p+eUn+WPmOabtO+8ieivt+axguWwseWPkemAgSAqIOS6hu+8jOS7juiAjOivt+axguS4reayoeacieWvueW6lOeahOWPmOabtO+8jOivt+axguWbnuadpeWQjuS8mum7mOiupOa4heepuuacrOWcsOWPmOabtO+8jOS7juiAjOWvvOiHtOeVjOmdouS4iuaYvuekuuaVsOaNruW3sue7j+S/ruaUue+8jOS9huaVsOaNruW6k+S4reaVsOaNruW5tuacquS/ruaUueOAglxyXG4gKiBcclxuICogICAg6Kej5Yaz6K+l57G76Zeu6aKY5Y+v5Lul6YCa6L+H5a6e5L2T6LWL5YC855qE5pa55byP77yM57uZ5a6e5L2T6LWL5YC85piv5ZCM5q2l55qE77yM6LWL5YC85a6M5oiQ5ZCO5Y+Y5pu05bCx5Lya5Lqn55Sf77yM6L+Z5qC35YaN5Y+R6YCB6K+35rGC5pe25bCx5Y+v5Lul5oqK5Y+Y5pu05bim5Yiw5ZCO56uv44CCXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIEJpbmRpbmdEYXRhIHtcclxuXHJcbiAgLyoqXHJcbiAgICog5pWw5o2u57G75Z6L5o+P6L+wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkYXRhVHlwZUluZm86IERhdGFUeXBlSW5mbztcclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a6K+l6Lev5b6EXHJcbiAgICovXHJcbiAgcHVibGljIGJpbmRpbmdQYXRoOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPr+e7keWumueahOWxnuaAp+aPj+i/sFxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog6KGM5YiH5o2i5LqL5Lu25pqC5YGc5oqb5Ye6XHJcbiAgICovXHJcbiAgcHVibGljIHJvd1NlbGVjdGVkRXZlbnRTdXNwZW5kOiBib29sZWFuO1xyXG4gIC8qKlxyXG4gICAqIOaVsOaNruWIl+ihqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBsaXN0OiBCaW5kaW5nTGlzdDtcclxuICBwcml2YXRlIHBhZ2luYXRpb25JbmZvID0gbnVsbDtcclxuXHJcbiAgcHVibGljIHNldCBwYWdpbmdJbmZvKHBhZ2luZ0luZm86IGFueSkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IHBhZ2luZ0luZm87XHJcbiAgICB0aGlzLmZpcmVQYWdpbmdDaGFuZ2VFdmVudCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBwYWdpbmdJbmZvKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBza2lwIOi3s+i/h1xyXG4gICAqIEBwYXJhbSB0YWtlIOiOt+WPllxyXG4gICAqIEBwYXJhbSBiaW5kaW5nUGF0aCDot6/lvoRcclxuICAgKi9cclxuICBwdWJsaWMgc2V0UGFnaW5nSW5mbyhza2lwOiBudW1iZXIsIHRha2U6IG51bWJlciwgYmluZGluZ1BhdGg6IHN0cmluZykge1xyXG4gICAgaWYgKGJpbmRpbmdQYXRoLmxlbmd0aCA8IDEgfHwgYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih0aGlzLnBhZ2luYXRpb25JbmZvLCB7IHBhZ2VTaXplOiB0YWtlLCBwYWdlSW5kZXg6IHNraXAgLyB0YWtlICsgMSB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBwYWdpbmdJbmZvID0gdGhpcy5wYWdpbmF0aW9uSW5mbyB8fCB7fTtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3Vic3RyKDEpLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCk7IC8vIC5tYXAoaXRlbSA9PiBpdGVtLnN1YnN0cmluZygwLCBpdGVtLmxlbmd0aCAtIDEpKTtcclxuICAgICAgbGV0IG5vZGVDb2RlID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgICAgLy8g5Y67c1xyXG4gICAgICBub2RlQ29kZSA9IG5vZGVDb2RlLnN1YnN0cigwLCBub2RlQ29kZS5sZW5ndGggLSAxKTtcclxuICAgICAgLy8g5om+5Yiw54i257qnXHJcbiAgICAgIC8vIOiOt+WPluW9k+WJjeWunuS9k+S4iue6p+eahOS4u+mUrlxyXG4gICAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRocy5zbGljZSgwLCBiaW5kaW5nUGF0aHMubGVuZ3RoIC0gMSk7XHJcbiAgICAgIGNvbnN0IHBhcmVudE9iamVjdCA9IHRoaXMuZ2V0VmFsdWUocGF0aHMpIGFzIEJpbmRpbmdPYmplY3Q7XHJcbiAgICAgIGlmIChwYXJlbnRPYmplY3QgJiYgcGFyZW50T2JqZWN0W3BhcmVudE9iamVjdC5wcmltYXJ5S2V5XSkge1xyXG4gICAgICAgIC8vIGNvbnN0IGtleSA9IGAke25vZGVDb2RlfV8ke3BhcmVudE9iamVjdFtwYXJlbnRPYmplY3QucHJpbWFyeUtleV19YDtcclxuICAgICAgICBjb25zdCBrZXkgPSBgJHtub2RlQ29kZX1gO1xyXG4gICAgICAgIHBhZ2luZ0luZm8gPSBwYWdpbmdJbmZvW2tleV0gfHwge307XHJcbiAgICAgICAgcGFnaW5nSW5mby5wYWdlSW5kZXggPSAoKHNraXAgLyB0YWtlKSB8fCAwKSArIDE7XHJcbiAgICAgICAgcGFnaW5nSW5mby5wYWdlU2l6ZSA9IHRha2UgfHwgMDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5maXJlUGFnaW5nQ2hhbmdlRXZlbnQoKTtcclxuICB9XHJcbiAgcHVibGljIHVwZGF0ZVBhZ2luZ0luZm8ocGFnZUluZm86IHsgcGFnZUluZGV4PzogbnVtYmVyLCBwYWdlU2l6ZT86IG51bWJlciwgdG90YWw/OiBudW1iZXIgfSwgYmluZGluZ1BhdGg6IHN0cmluZykge1xyXG4gICAgaWYgKGJpbmRpbmdQYXRoLmxlbmd0aCA8IDEgfHwgYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih0aGlzLnBhZ2luYXRpb25JbmZvLCBwYWdlSW5mbyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsZXQgcGFnaW5nSW5mbyA9IHRoaXMucGFnaW5hdGlvbkluZm8gfHwge307XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnN1YnN0cigxKS5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLmxlbmd0aCA+IDApOyAvLyAubWFwKGl0ZW0gPT4gaXRlbS5zdWJzdHJpbmcoMCwgaXRlbS5sZW5ndGggLSAxKSk7XHJcbiAgICAgIGxldCBub2RlQ29kZSA9IGJpbmRpbmdQYXRoc1tiaW5kaW5nUGF0aHMubGVuZ3RoIC0gMV07XHJcbiAgICAgIC8vIOWOu3NcclxuICAgICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zdWJzdHIoMCwgbm9kZUNvZGUubGVuZ3RoIC0gMSk7XHJcbiAgICAgIHBhZ2luZ0luZm9bbm9kZUNvZGVdID0gT2JqZWN0LmFzc2lnbihwYWdpbmdJbmZvW25vZGVDb2RlXSwgcGFnZUluZm8pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5maXJlUGFnaW5nQ2hhbmdlRXZlbnQoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBmaXJlUGFnaW5nQ2hhbmdlRXZlbnQoKSB7XHJcbiAgICB0aGlzLmxpc3QuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSxcclxuICAgICAgcGF0aDogdGhpcy5iaW5kaW5nUGF0aCAmJiB0aGlzLmJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCkgfHwgW10sXHJcbiAgICAgIHZhbHVlOiB0aGlzLnBhZ2luYXRpb25JbmZvXHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Y+Y5pu06ZuGXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBjaGFuZ2VzKCk6IFN1YmplY3Q8Q2hhbmdlPiB7XHJcbiAgICByZXR1cm4gdGhpcy5saXN0LmNoYW5nZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlgLzlj5jljJbmiafooYzlmajlt6XljoLvvIzmoLnmja7ot6/lvoTkuqfnlJ/miafooYzlmahcclxuICAgKi9cclxuICBwcml2YXRlIHZhbHVlQ2hhbmdlSW52b2tlckZhY3Rvcnk6IChwYXRoczogc3RyaW5nW10pID0+IEludm9rZU9uVmFsdWVDaGFuZ2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWAvOWPmOWMluaJp+ihjOWZqOW3peWOglxyXG4gICAqIEBwYXJhbSB2YWx1ZSDlgLzlj5jljJbmiafooYzlmajlt6XljoJcclxuICAgKi9cclxuICBwdWJsaWMgc2V0VmFsdWVDaGFuZ2VJbnZva2VyRmFjdG9yeSh2YWx1ZTogKHBhdGhzOiBzdHJpbmdbXSkgPT4gSW52b2tlT25WYWx1ZUNoYW5nZSkge1xyXG4gICAgdGhpcy52YWx1ZUNoYW5nZUludm9rZXJGYWN0b3J5ID0gdmFsdWU7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRWYWx1ZENoYW5nZUludm9rZXJGYWN0b3J5KCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVDaGFuZ2VJbnZva2VyRmFjdG9yeTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMlu+8iOW3suW6n+W8g++8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0KHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55PiwgYmluZGluZ1BhdGg6IHN0cmluZykge1xyXG4gICAgdGhpcy5pbml0QnlSZXBvc2l0b3J5KHJlcG9zaXRvcnksIGJpbmRpbmdQYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrlJlcG9zaXRvcnnlr7lCaW5kaW5nRGF0Yei/m+ihjOWIneWni+WMllxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0QnlSZXBvc2l0b3J5KHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55PiwgYmluZGluZ1BhdGg6IHN0cmluZykge1xyXG4gICAgdGhpcy5iaW5kaW5nUGF0aCA9IGJpbmRpbmdQYXRoO1xyXG5cclxuICAgIHRoaXMucHJvcGVydGllcyA9IFByb3BlcnR5VXRpbC5nZXRQcm9wZXJ0aWVzKHJlcG9zaXRvcnkuZW50aXR5VHlwZSk7XHJcbiAgICB0aGlzLmxpc3QgPSBCaW5kaW5nTGlzdEZhY3RvcnkuY3JlYXRlKHRoaXMucHJvcGVydGllcyk7XHJcbiAgICAvLyDku45yZXBvc2l0b3J55Yid5aeL5YyWYmluZGluZ0RhdGFcclxuICAgIHRoaXMucGFnaW5nSW5mbyA9IHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbztcclxuICAgIC8vIEB0b2RvXHJcbiAgICAvLyBCaW5kaW5nRGF0YeS4jeW6lOivpeefpemBk1JlcG9zaXRvcnnvvIzliqDovb3mlbDmja7jgIHlu7rnq4vlhbPogZTlhbPns7vnmoTov4fnqIvlupTor6Xovaznp7vliLDlpJbovrlcclxuICAgIEVudGl0eVV0aWwubG9hZFJlcG9zaXRvcnkocmVwb3NpdG9yeSwgdGhpcy5saXN0KTtcclxuICAgIHRoaXMuZGF0YVR5cGVJbmZvID0gcmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbztcclxuXHJcbiAgICB0aGlzLmV4dGVuZFByb3BlcnRpZXModGhpcy5wcm9wZXJ0aWVzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMllxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0QnlCaW5kaW5nTGlzdChiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QsIGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcclxuICAgIHRoaXMubGlzdCA9IGJpbmRpbmdMaXN0O1xyXG4gICAgdGhpcy5iaW5kaW5nUGF0aCA9IGJpbmRpbmdQYXRoO1xyXG4gICAgdGhpcy5leHRlbmRQcm9wZXJ0aWVzKHRoaXMubGlzdC5wcm9wZXJ0aWVzKTtcclxuICB9XHJcbiAgcHVibGljIHNldERhdGFUeXBlSW5mbyhkYXRhVHlwZUluZm86IERhdGFUeXBlSW5mbykge1xyXG4gICAgdGhpcy5kYXRhVHlwZUluZm8gPSBkYXRhVHlwZUluZm87XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlueVjOmdouaVsOaNrlxyXG4gICAqIEBwYXJhbSBwYXRocyDlsZ7mgKfot6/lvoTmlbDnu4RcclxuICAgKiBAcGFyYW0gdXNlSW5pdFZhbHVlIOaYr+WQpuS9v+eUqOm7mOiupOWAvO+8jOm7mOiupOS4umBmYWxzZWBcclxuICAgKiBAcmV0dXJucyDlsZ7mgKflgLxcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0VmFsdWUocGF0aHM6IHN0cmluZ1tdLCB1c2VJbml0VmFsdWUgPSBmYWxzZSkge1xyXG4gICAgbGV0IHRhcmdldDogYW55ID0gdGhpcy5saXN0O1xyXG4gICAgcGF0aHMuZm9yRWFjaCgocGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgICB0YXJnZXQgPSB0YXJnZXRbcGF0aF07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYgKHVzZUluaXRWYWx1ZSA9PT0gdHJ1ZSAmJiBwYXRocyAmJiBwYXRocy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGluaXRWYWx1ZSA9IHRoaXMuZ2V0SW5pdFZhbHVlQnlQYXRocyhwYXRocyk7XHJcbiAgICAgIGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCAmJiB0YXJnZXQgIT09IGluaXRWYWx1ZSkge1xyXG4gICAgICAgIHRhcmdldCA9IGluaXRWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRhcmdldDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOivpeaWueazleWPr+S7peabtOaWsOe7keWumuWxguaVsOaNru+8jOS7juiAjOi+vuWIsOabtOaWsOeVjOmdouaVsOaNrueahOebrueahO+8jOi/m+iAjOabtOaWsOacrOWcsOS7k+W6k+WunuS9k+aVsOaNru+8jOS6p+eUn+WPmOabtO+8jOS4i+asoeivt+axguaXtuS8muWwhuWPmOabtOW4puWIsOWQjuerr+W5tuabtOaWsOWQjuerr+aVsOaNruOAglxyXG4gICAqIEBwYXJhbSBwYXRocyDlsZ7mgKfot6/lvoTmlbDnu4RcclxuICAgKiBAcGFyYW0gdmFsdWUg5bGe5oCn5YC8XHJcbiAgICogQHBhcmFtIGVtaXRFdmVudFRvVmlldyDlpoLmnpzorr7nva7kuLp0cnVl77yM5YiZ5Y+R6YCB5LqL5Lu26YCa55+l6K6i6ZiF5a6D55qE57uE5Lu244CB5oyH5Luk5Y675pu05paw55WM6Z2i77yM6buY6K6k5Li6ZmFsc2XjgIJcclxuICAgKiBAcGFyYW0gZW1pdEV2ZW50VG9FbnRpdHkg5aaC5p6c6K6+572u5Li6dHJ1Ze+8jOWImeWQjOatpeWOu+abtOaWsEVudGl0eeS4iuWvueW6lOeahOWtl+aute+8jOm7mOiupOS4unRydWXjgIJcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiAjIyDnpLrkvotcclxuICAgKiBcclxuICAgKiAjIyMg5pu05paw55WM6Z2i5pWw5o2uXHJcbiAgICog5L2/55So6K+l5pa55rOV5pe25Y+q5Lyg6YCScGF0aOWSjHZhbHVl5Y+C5pWw77yM5YW25L2Z5Y+C5pWw5L2/55So6buY6K6k5YC844CC6K+l55So5rOV5Lya5pu05paw55WM6Z2i5pWw5o2u77yM5ZCM5pe25pu05paw5a6e5L2T5pWw5o2u77yM5a6e5L2T5pWw5o2u5pu05paw5pe25Lya5Lqn55Sf5Y+Y5pu077yM6L+Z5qC35Zyo5LiL5qyh6K+35rGC5pe25Lya5bCG6K+l5Y+Y5pu05bim5Yiw5ZCO56uv77yMXHJcbiAgICog6L+b6ICM5pu05paw5ZCO56uv5pWw5o2u44CCXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnNldFZhbHVlKHBhdGhzLHZhbHVlKTtcclxuICAgKiBgYGBcclxuICAgKiBcclxuICAgKiAjIyMg5LuF5pu05paw55WM6Z2i5pWw5o2uXHJcbiAgICog5pyJ5Lqb5Zy65pmv5LiL5oiR5Lus5biM5pyb5Y+q5pu05paw55WM6Z2i55qE5pWw5o2u77yM5LiN5biM5pyb5a+55ZCO56uv5pWw5o2u5Lqn55Sf5b2x5ZON77yM5q2k5pe26Zmk5Lyg6YCScGF0aHPlkox2YWx1ZeWPguaVsOWklu+8jOi/mOmcgOimgeWwhmVtaXRFdmVudFRvVmlld+iuvuS4unRydWXvvIxlbWl0RXZlbnRUb0VudGl0eeiuvuS4umZhbHNl77yMXHJcbiAgICog5q2k5pe25b+F6aG75L2/55So5a+55bqUQmluZGluZ0RhdGHnmoRzZXRWYWx1ZeaWueazle+8mlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjb25zdCB0YWJsZUZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKCdkYXRhLWdyaWQtY29tcG9uZW50Jyk7XHJcbiAgICogdGFibGVGcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuc2V0VmFsdWUocGF0aHMsdmFsdWUsdHJ1ZSxmYWxzZSk7XHJcbiAgICogYGBgXHJcbiAgICogIyMg5rOo5oSP5LqL6aG5XHJcbiAgICogc2V0VmFsdWXkuLrlvILmraXmlrnms5XvvIzlpoLmnpzosIPnlKjor6Xmlrnms5XlkI7pmo/ljbPlj5HpgIHlkI7nq6/or7fmsYLvvIzmraTml7blrp7kvZPlj5jmm7TlsJrmnKrkuqfnlJ/vvIzkvYbor7fmsYLlt7Lnu4/lj5HpgIHvvIzlj5jmm7Tml6Dms5XluKbliLDlkI7nq6/vvIzlr7zoh7Tlj5jmm7TkuKLlpLHvvIzlh7rnjrDnlYzpnaLkuIrmmL7npLrmlbDmja7lt7Lnu4/kv67mlLnvvIxcclxuICAgKiDkvYblkI7nq6/lubbmnKrkv67mlLnnmoTpl67popjjgIJcclxuICAgKiDlm6DmraTvvIzlpoLmnpzotYvlgLzlkI7pmo/ljbPlj5HpgIHor7fmsYLlupTor6Xkvb/nlKjlrp7kvZPotYvlgLznmoTmlrnms5XjgIJcclxuICAgKi9cclxuICBwdWJsaWMgc2V0VmFsdWUocGF0aHM6IHN0cmluZ1tdLCB2YWx1ZTogYW55LCBlbWl0RXZlbnRUb1ZpZXc6IGJvb2xlYW4gPSBmYWxzZSwgZW1pdEV2ZW50VG9FbnRpdHk6IGJvb2xlYW4gPSB0cnVlLCBlcnJvcnM6IGFueSA9IHt9LCBjb250ZXh0PzogYW55KSB7XHJcblxyXG4gICAgaWYgKCFwYXRocyB8fCBwYXRocy5sZW5ndGggPT09IDApIHtcclxuICAgICAgdGhyb3cgRXJyb3IoJ+i3r+W+hOS4jeiDveS4uuepuicpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyZW50UGF0aHMgPSBwYXRocy5zbGljZSgwLCBwYXRocy5sZW5ndGggLSAxKTtcclxuICAgIGNvbnN0IHByb3BOYW1lID0gcGF0aHNbcGF0aHMubGVuZ3RoIC0gMV07XHJcblxyXG4gICAgbGV0IHBhcmVudCA9IHRoaXMuZ2V0VmFsdWUocGFyZW50UGF0aHMpO1xyXG4gICAgaWYgKCFwYXJlbnQpIHtcclxuICAgICAgdGhyb3cgRXJyb3IoJ+aJvuS4jeWIsOimgeiuvue9rueahOWvueixoScpO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhcmVudCBpbnN0YW5jZW9mIEJpbmRpbmdEYXRhKSB7XHJcbiAgICAgIHBhcmVudCA9IHBhcmVudC5saXN0LmN1cnJlbnRJdGVtO1xyXG4gICAgfSBlbHNlIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBCaW5kaW5nTGlzdCkge1xyXG4gICAgICBwYXJlbnQgPSBwYXJlbnQuY3VycmVudEl0ZW07XHJcbiAgICB9XHJcbiAgICBpZiAoISF0aGlzLnZhbHVlQ2hhbmdlSW52b2tlckZhY3RvcnkpIHtcclxuICAgICAgcGFyZW50LnNldFZhbHVlKHByb3BOYW1lLCB2YWx1ZSwgZW1pdEV2ZW50VG9WaWV3LCBlbWl0RXZlbnRUb0VudGl0eSwgZXJyb3JzLCB0aGlzLnZhbHVlQ2hhbmdlSW52b2tlckZhY3RvcnkocGF0aHMpLCBjb250ZXh0KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBhcmVudC5zZXRWYWx1ZShwcm9wTmFtZSwgdmFsdWUsIGVtaXRFdmVudFRvVmlldywgZW1pdEV2ZW50VG9FbnRpdHksIGVycm9ycywgbnVsbCwgY29udGV4dCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja5wYXRoc+a4heepuuWxnuaAp+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhclZhbHVlKHBhdGhzOiBzdHJpbmdbXSwgZW1pdEV2ZW50VG9WaWV3OiBib29sZWFuID0gZmFsc2UsIGVtaXRFdmVudFRvRW50aXR5OiBib29sZWFuID0gdHJ1ZSwgY29udGV4dD86IGFueSkge1xyXG4gICAgbGV0IGluaXRWYWx1ZTogYW55O1xyXG4gICAgY29uc3QgcHJvcEluZm8gPSB0aGlzLmRhdGFUeXBlSW5mby5nZXRQcm9wSW5mb0J5UGF0aChwYXRocyk7XHJcbiAgICBpZiAocHJvcEluZm8gJiYgcHJvcEluZm8ubWV0YWRhdGFJbmZvICYmIHByb3BJbmZvLm1ldGFkYXRhSW5mby5pbml0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBpbml0VmFsdWUgPSBwcm9wSW5mby5tZXRhZGF0YUluZm8uaW5pdFZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuXHJcbiAgICAgIC8vIOWOn+adpeeahOW4ruWKqeaYoOWwhOS4re+8jOW8uuihjOe6oOato+S6huaVsOWAvOeahOaDheWGte+8jOS/neaMgeS4gOiHtFxyXG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUocGF0aHMpO1xyXG4gICAgICBpZiAodHlwZW9mIG9sZFZhbHVlID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgIGluaXRWYWx1ZSA9IDA7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaW5pdFZhbHVlID0gJyc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuc2V0VmFsdWUocGF0aHMsIGluaXRWYWx1ZSwgZW1pdEV2ZW50VG9WaWV3LCBlbWl0RXZlbnRUb0VudGl0eSwgbnVsbCwgY29udGV4dCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blvZPliY3liJfooahcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TGlzdCgpIHtcclxuICAgIGlmICghdGhpcy5iaW5kaW5nUGF0aCB8fCB0aGlzLmJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHRoaXMubGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMuYmluZGluZ1BhdGguc3Vic3RyKDEpO1xyXG4gICAgY29uc3QgYmluZGluZ1BhdGhBcnJheSA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKChwYXJ0OiBzdHJpbmcpID0+IHtcclxuICAgICAgcmV0dXJuIHBhcnQgIT09ICcnO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZShiaW5kaW5nUGF0aEFycmF5KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjeWvueixoVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRPYmplY3QoKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nTGlzdCA9IHRoaXMuZ2V0TGlzdCgpO1xyXG4gICAgcmV0dXJuIGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnu5Hlrprot6/lvoTvvIjku4Xot6/lvoTpg6jliIbvvIzkuI3ljIXmi6zlsZ7mgKfvvIlcclxuICAgKiBAcGFyYW0gYmluZGluZ1BhdGgg57uR5a6a6Lev5b6EXHJcbiAgICovXHJcbiAgcHVibGljIGdldFBhdGgoYmluZGluZ1BhdGg/OiBzdHJpbmdbXSkge1xyXG4gICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguZmlsdGVyKHAgPT4gcCk7XHJcbiAgICBjb25zdCBwYXRoID0gW2Ake3RoaXMubGlzdC5wcmltYXJ5S2V5fToke3RoaXMubGlzdC5jdXJyZW50SWR9YF07XHJcblxyXG4gICAgYmluZGluZ1BhdGhzLmZvckVhY2goKGl0ZW06IHN0cmluZykgPT4ge1xyXG4gICAgICBwYXRoLnB1c2goaXRlbSk7XHJcbiAgICAgIGNvbnN0IGxpc3QgPSB0aGlzW2l0ZW1dIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgICBpZiAobGlzdCkge1xyXG4gICAgICAgIHBhdGgucHVzaChgJHtsaXN0LnByaW1hcnlLZXl9OiR7bGlzdC5jdXJyZW50SWR9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHBhdGg7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepuue7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCgpIHtcclxuICAgIHRoaXMubGlzdC5jbGVhcigpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgJrov4fnu5Hlrprot6/lvoTojrflj5blsZ7mgKfliJ3lp4vlgLxcclxuICAgKiBAcGFyYW0gcGF0aHMg57uR5a6a6Lev5b6EXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRJbml0VmFsdWVCeVBhdGhzKHBhdGhzOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICBsZXQgaW5pdFZhbHVlOiBhbnk7XHJcbiAgICBjb25zdCBwcm9wSW5mbyA9IHRoaXMuZGF0YVR5cGVJbmZvICYmIHRoaXMuZGF0YVR5cGVJbmZvLmdldFByb3BJbmZvQnlQYXRoKHBhdGhzKSB8fCBudWxsO1xyXG4gICAgaWYgKHByb3BJbmZvICYmIHByb3BJbmZvLm1ldGFkYXRhSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm8uaW5pdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgaW5pdFZhbHVlID0gcHJvcEluZm8ubWV0YWRhdGFJbmZvLmluaXRWYWx1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBpbml0VmFsdWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJqeWxlUJpbmRpbmdEYXRh5bGe5oCn77yM5pig5bCEQmluZGluZ0RhdGHmiYDmjIHmnInnmoTnu5HlrprliJfooajlvZPliY3ooYznmoTlsZ7mgKfvvIzlh4/lsJHnu5HlrprlsYLnuqfjgIJcclxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDlhbPogZTlrp7kvZPnmoTlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIGV4dGVuZFByb3BlcnRpZXMocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10pIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xyXG4gICAgICBjb25zdCBwcm9wTmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wTmFtZSwge1xyXG4gICAgICAgIGdldDogKCkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMubGlzdC5jdXJyZW50SXRlbVtwcm9wTmFtZV07XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxpc3QuY3VycmVudEl0ZW1bcHJvcE5hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmluZGluZ0RhdGEgfTtcclxuIl19