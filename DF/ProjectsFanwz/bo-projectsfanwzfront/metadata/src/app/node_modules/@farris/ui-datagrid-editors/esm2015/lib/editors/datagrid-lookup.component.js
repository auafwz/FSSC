/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injector } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:41:00
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:00:48
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
import { LookupDefaultOptions } from '../editor-default-options';
import { LookupGridComponent } from '@farris/ui-lookup';
import { RuntimeStateService } from '@farris/ui-common';
export class DatagridLookupComponent extends DatagridBaseEditorDirective {
    /**
     * @param {?} render
     * @param {?} el
     * @param {?} rts
     * @param {?} injector
     */
    constructor(render, el, rts, injector) {
        super(render, el, injector);
        this.rts = rts;
        this.stopPropagation = false;
        this.extInfoFormatter = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (this.options.extInfoFormatter) {
                return this.options.extInfoFormatter({ bindingData: this.dr.rowData, instance: e.instance });
            }
            return '';
        });
        this.rts.state$.subscribe((/**
         * @param {?} state
         * @return {?}
         */
        state => {
            if (state && state.form && state.form.lookup) {
                this.pending = state.form.lookup.pending;
                this.dg.pending = this.pending;
            }
        }));
    }
    /**
     * @param {?} id
     * @return {?}
     */
    set controlId(id) {
        this.instance.controlId = id;
        if (this.instance.uri) {
            this.instance.controlId += '_' + this.instance.uri;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
        this.options = Object.assign({}, LookupDefaultOptions, this.options);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.instance.changeDetector.detectChanges();
        this.inputElement = this.instance.inputGroup.textbox.nativeElement;
        super.ngAfterViewInit();
        if (this.options.loader) {
            this.instance['http'] = { getData: this.options.loader };
        }
        this.instance['host'] = this.dg;
    }
    /**
     * @return {?}
     */
    onDialogClosed() {
        // this.lookup.changeDetector.detectChanges();
    }
    /**
     * @return {?}
     */
    onDialogOpen() {
        this.instance.changeDetector.detectChanges();
    }
    /**
     * @return {?}
     */
    onLoadSuccess() {
        this.instance.changeDetector.detectChanges();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onClear(event) {
        // const rowData = this.instance.selectionMgr.getBindingData();
        // this.instance['defaultMapping'].lookupFieldMap(null, this.instance.mapFields, rowData);
        this.instance.changeDetector.detectChanges();
        if (this.options.clear) {
            this.options.clear();
        }
    }
}
DatagridLookupComponent.decorators = [
    { type: Component, args: [{
                selector: 'grid-editor-lookup',
                template: `
    <div [formGroup]="group" class="f-datagrid-cell-formgroup farris-group-auto">
        <datagrid-tooltip [control]="formControl" [tooltipPosition]="'top-left'" [message]="errorMessage">
            <farris-lookup-grid #lookup style="width: 100%"
                id="{{ controlId }}"
                [formControlName]="column.field"
                [uri]="options.uri"
                [helpId]="options.helpId"
                [displayType]="options.displayType"
                [singleSelect]="options.singleSelect"
                [idField]="options.idField"
                [pageSize]="options.pageSize || 20"
                [pageIndex]="options.pageSize || 1"
                [pagination]="options.pageination"
                [textField]="options.textField"
                [valueField]="options.valueField"
                [title]="options.title"
                [useFavorite]="options.useFavorite"
                [isRecordSize]="options.isRecordSize"
                [useTip]="options.useTip"
                [editable]="options.editable"
                [readonly]="options.readonly"
                [dialogWidth]="options.dialogWidth"
                [dialogHeight]="options.dialogHeight"
                [showMaxButton]="options.showMaxButton"
                [showCloseButton]="options.showCloseButton"
                [resizable]="options.resizable"
                [buttonAlign]="options.buttonAlign"
                [enableClear]="options.enableClear"
                [searchOnServer]="options.searchOnServer"
                [nosearch]="options.nosearch"
                [maxLength]="options.maxLength"
                [mappingFn]="options.mappingFn"
                [mapFields]="options.mapFields"
                [context]="options.context"
                [expandLevel]="options.expandLevel"
                [dictPicking]="options.dictPicking"
                [dictPicked]="options.dictPicked"
                [enableFullTree]="options.enableFullTree"
                [loadTreeDataType]="options.loadTreeDataType"
                [enableCascade]="options.enableCascade"
                [cascadeStatus]="options.cascadeStatus"
                [useExtendInfo]="options.useExtendInfo"
                [extInfoFields]="options.extInfoFields"
                [extInfoFormatter]="options.extInfoFormatter"
                [textAlign]="options.textAlign"
                [loadDataWhenOpen]="options.loadDataWhenOpen"
                [selectFirstInNav]="options.selectFirstInNav"
                [customNavFormatter]="options.customNavFormatter"
                [customFormatter]="options.customFormatter"
                [treeInfo]="options?.treeInfo"
                (dialogClosed)="onDialogClosed()"
                (dialogOpened)="onDialogOpen()"
                (clear)="onClear($event)"
                (loadSuccess)="onLoadSuccess()"
            ></farris-lookup-grid>
        </datagrid-tooltip>
    </div>
    `
            }] }
];
/** @nocollapse */
DatagridLookupComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: RuntimeStateService },
    { type: Injector }
];
DatagridLookupComponent.propDecorators = {
    instance: [{ type: ViewChild, args: ['lookup',] }]
};
if (false) {
    /** @type {?} */
    DatagridLookupComponent.prototype.instance;
    /** @type {?} */
    DatagridLookupComponent.prototype.stopPropagation;
    /** @type {?} */
    DatagridLookupComponent.prototype.extInfoFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridLookupComponent.prototype.rts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtbG9va3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycy8iLCJzb3VyY2VzIjpbImxpYi9lZGl0b3JzL2RhdGFncmlkLWxvb2t1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBcUQsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7QUFTNUYsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwRixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUNoRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQStEeEQsTUFBTSxPQUFPLHVCQUF3QixTQUFRLDJCQUEyQjs7Ozs7OztJQVlwRSxZQUFZLE1BQWlCLEVBQUUsRUFBYyxFQUFVLEdBQXdCLEVBQ25FLFFBQWtCO1FBQzFCLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRnVCLFFBQUcsR0FBSCxHQUFHLENBQXFCO1FBRC9FLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBbUR4QixxQkFBZ0I7Ozs7UUFBRyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3JCLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDL0IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQzthQUNoRztZQUVELE9BQU8sRUFBRSxDQUFDO1FBQ2QsQ0FBQyxFQUFBO1FBckRHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVM7Ozs7UUFBQyxLQUFLLENBQUMsRUFBRTtZQUM5QixJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUMxQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztnQkFDekMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNsQztRQUNMLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7Ozs7SUFqQkQsSUFBSSxTQUFTLENBQUMsRUFBRTtRQUNaLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFO1lBQ25CLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxJQUFJLEdBQUcsR0FBRSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQztTQUNyRDtJQUNMLENBQUM7Ozs7SUFjRCxRQUFRO1FBQ0osS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBRSxFQUFFLEVBQUcsb0JBQW9CLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzNFLENBQUM7Ozs7SUFFRCxlQUFlO1FBQ1gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDN0MsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO1FBQ25FLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUV4QixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUM3RDtRQUVELElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNwQyxDQUFDOzs7O0lBRUQsY0FBYztRQUNWLDhDQUE4QztJQUNsRCxDQUFDOzs7O0lBRUQsWUFBWTtRQUNSLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ2pELENBQUM7Ozs7SUFFRCxhQUFhO1FBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDakQsQ0FBQzs7Ozs7SUFFRCxPQUFPLENBQUMsS0FBaUI7UUFDckIsK0RBQStEO1FBQy9ELDBGQUEwRjtRQUUxRixJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUM3QyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDeEI7SUFDTCxDQUFDOzs7WUExSEosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxvQkFBb0I7Z0JBQzlCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQTBEVDthQUNKOzs7O1lBbEUyQixTQUFTO1lBQUUsVUFBVTtZQUl4QyxtQkFBbUI7WUFiZ0MsUUFBUTs7O3VCQTZFL0QsU0FBUyxTQUFDLFFBQVE7Ozs7SUFBbkIsMkNBQW1EOztJQVVuRCxrREFBd0I7O0lBbUR4QixtREFNQzs7Ozs7SUF4RDhDLHNDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIEFwcGxpY2F0aW9uUmVmLCBJbmplY3QsIGZvcndhcmRSZWYsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMTQgMTE6NDE6MDBcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMTQgMTM6MDA6NDhcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgfSBmcm9tICcuLi9kYXRhZ3JpZC1iYXNlLWVkaXRvci5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBMb29rdXBEZWZhdWx0T3B0aW9ucyB9IGZyb20gJy4uL2VkaXRvci1kZWZhdWx0LW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBSdW50aW1lU3RhdGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZ3JpZC1lZGl0b3ItbG9va3VwJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IFtmb3JtR3JvdXBdPVwiZ3JvdXBcIiBjbGFzcz1cImYtZGF0YWdyaWQtY2VsbC1mb3JtZ3JvdXAgZmFycmlzLWdyb3VwLWF1dG9cIj5cclxuICAgICAgICA8ZGF0YWdyaWQtdG9vbHRpcCBbY29udHJvbF09XCJmb3JtQ29udHJvbFwiIFt0b29sdGlwUG9zaXRpb25dPVwiJ3RvcC1sZWZ0J1wiIFttZXNzYWdlXT1cImVycm9yTWVzc2FnZVwiPlxyXG4gICAgICAgICAgICA8ZmFycmlzLWxvb2t1cC1ncmlkICNsb29rdXAgc3R5bGU9XCJ3aWR0aDogMTAwJVwiXHJcbiAgICAgICAgICAgICAgICBpZD1cInt7IGNvbnRyb2xJZCB9fVwiXHJcbiAgICAgICAgICAgICAgICBbZm9ybUNvbnRyb2xOYW1lXT1cImNvbHVtbi5maWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbdXJpXT1cIm9wdGlvbnMudXJpXCJcclxuICAgICAgICAgICAgICAgIFtoZWxwSWRdPVwib3B0aW9ucy5oZWxwSWRcIlxyXG4gICAgICAgICAgICAgICAgW2Rpc3BsYXlUeXBlXT1cIm9wdGlvbnMuZGlzcGxheVR5cGVcIlxyXG4gICAgICAgICAgICAgICAgW3NpbmdsZVNlbGVjdF09XCJvcHRpb25zLnNpbmdsZVNlbGVjdFwiXHJcbiAgICAgICAgICAgICAgICBbaWRGaWVsZF09XCJvcHRpb25zLmlkRmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2VTaXplXT1cIm9wdGlvbnMucGFnZVNpemUgfHwgMjBcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2VJbmRleF09XCJvcHRpb25zLnBhZ2VTaXplIHx8IDFcIlxyXG4gICAgICAgICAgICAgICAgW3BhZ2luYXRpb25dPVwib3B0aW9ucy5wYWdlaW5hdGlvblwiXHJcbiAgICAgICAgICAgICAgICBbdGV4dEZpZWxkXT1cIm9wdGlvbnMudGV4dEZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFt2YWx1ZUZpZWxkXT1cIm9wdGlvbnMudmFsdWVGaWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbdGl0bGVdPVwib3B0aW9ucy50aXRsZVwiXHJcbiAgICAgICAgICAgICAgICBbdXNlRmF2b3JpdGVdPVwib3B0aW9ucy51c2VGYXZvcml0ZVwiXHJcbiAgICAgICAgICAgICAgICBbaXNSZWNvcmRTaXplXT1cIm9wdGlvbnMuaXNSZWNvcmRTaXplXCJcclxuICAgICAgICAgICAgICAgIFt1c2VUaXBdPVwib3B0aW9ucy51c2VUaXBcIlxyXG4gICAgICAgICAgICAgICAgW2VkaXRhYmxlXT1cIm9wdGlvbnMuZWRpdGFibGVcIlxyXG4gICAgICAgICAgICAgICAgW3JlYWRvbmx5XT1cIm9wdGlvbnMucmVhZG9ubHlcIlxyXG4gICAgICAgICAgICAgICAgW2RpYWxvZ1dpZHRoXT1cIm9wdGlvbnMuZGlhbG9nV2lkdGhcIlxyXG4gICAgICAgICAgICAgICAgW2RpYWxvZ0hlaWdodF09XCJvcHRpb25zLmRpYWxvZ0hlaWdodFwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd01heEJ1dHRvbl09XCJvcHRpb25zLnNob3dNYXhCdXR0b25cIlxyXG4gICAgICAgICAgICAgICAgW3Nob3dDbG9zZUJ1dHRvbl09XCJvcHRpb25zLnNob3dDbG9zZUJ1dHRvblwiXHJcbiAgICAgICAgICAgICAgICBbcmVzaXphYmxlXT1cIm9wdGlvbnMucmVzaXphYmxlXCJcclxuICAgICAgICAgICAgICAgIFtidXR0b25BbGlnbl09XCJvcHRpb25zLmJ1dHRvbkFsaWduXCJcclxuICAgICAgICAgICAgICAgIFtlbmFibGVDbGVhcl09XCJvcHRpb25zLmVuYWJsZUNsZWFyXCJcclxuICAgICAgICAgICAgICAgIFtzZWFyY2hPblNlcnZlcl09XCJvcHRpb25zLnNlYXJjaE9uU2VydmVyXCJcclxuICAgICAgICAgICAgICAgIFtub3NlYXJjaF09XCJvcHRpb25zLm5vc2VhcmNoXCJcclxuICAgICAgICAgICAgICAgIFttYXhMZW5ndGhdPVwib3B0aW9ucy5tYXhMZW5ndGhcIlxyXG4gICAgICAgICAgICAgICAgW21hcHBpbmdGbl09XCJvcHRpb25zLm1hcHBpbmdGblwiXHJcbiAgICAgICAgICAgICAgICBbbWFwRmllbGRzXT1cIm9wdGlvbnMubWFwRmllbGRzXCJcclxuICAgICAgICAgICAgICAgIFtjb250ZXh0XT1cIm9wdGlvbnMuY29udGV4dFwiXHJcbiAgICAgICAgICAgICAgICBbZXhwYW5kTGV2ZWxdPVwib3B0aW9ucy5leHBhbmRMZXZlbFwiXHJcbiAgICAgICAgICAgICAgICBbZGljdFBpY2tpbmddPVwib3B0aW9ucy5kaWN0UGlja2luZ1wiXHJcbiAgICAgICAgICAgICAgICBbZGljdFBpY2tlZF09XCJvcHRpb25zLmRpY3RQaWNrZWRcIlxyXG4gICAgICAgICAgICAgICAgW2VuYWJsZUZ1bGxUcmVlXT1cIm9wdGlvbnMuZW5hYmxlRnVsbFRyZWVcIlxyXG4gICAgICAgICAgICAgICAgW2xvYWRUcmVlRGF0YVR5cGVdPVwib3B0aW9ucy5sb2FkVHJlZURhdGFUeXBlXCJcclxuICAgICAgICAgICAgICAgIFtlbmFibGVDYXNjYWRlXT1cIm9wdGlvbnMuZW5hYmxlQ2FzY2FkZVwiXHJcbiAgICAgICAgICAgICAgICBbY2FzY2FkZVN0YXR1c109XCJvcHRpb25zLmNhc2NhZGVTdGF0dXNcIlxyXG4gICAgICAgICAgICAgICAgW3VzZUV4dGVuZEluZm9dPVwib3B0aW9ucy51c2VFeHRlbmRJbmZvXCJcclxuICAgICAgICAgICAgICAgIFtleHRJbmZvRmllbGRzXT1cIm9wdGlvbnMuZXh0SW5mb0ZpZWxkc1wiXHJcbiAgICAgICAgICAgICAgICBbZXh0SW5mb0Zvcm1hdHRlcl09XCJvcHRpb25zLmV4dEluZm9Gb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgW3RleHRBbGlnbl09XCJvcHRpb25zLnRleHRBbGlnblwiXHJcbiAgICAgICAgICAgICAgICBbbG9hZERhdGFXaGVuT3Blbl09XCJvcHRpb25zLmxvYWREYXRhV2hlbk9wZW5cIlxyXG4gICAgICAgICAgICAgICAgW3NlbGVjdEZpcnN0SW5OYXZdPVwib3B0aW9ucy5zZWxlY3RGaXJzdEluTmF2XCJcclxuICAgICAgICAgICAgICAgIFtjdXN0b21OYXZGb3JtYXR0ZXJdPVwib3B0aW9ucy5jdXN0b21OYXZGb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgW2N1c3RvbUZvcm1hdHRlcl09XCJvcHRpb25zLmN1c3RvbUZvcm1hdHRlclwiXHJcbiAgICAgICAgICAgICAgICBbdHJlZUluZm9dPVwib3B0aW9ucz8udHJlZUluZm9cIlxyXG4gICAgICAgICAgICAgICAgKGRpYWxvZ0Nsb3NlZCk9XCJvbkRpYWxvZ0Nsb3NlZCgpXCJcclxuICAgICAgICAgICAgICAgIChkaWFsb2dPcGVuZWQpPVwib25EaWFsb2dPcGVuKClcIlxyXG4gICAgICAgICAgICAgICAgKGNsZWFyKT1cIm9uQ2xlYXIoJGV2ZW50KVwiXHJcbiAgICAgICAgICAgICAgICAobG9hZFN1Y2Nlc3MpPVwib25Mb2FkU3VjY2VzcygpXCJcclxuICAgICAgICAgICAgPjwvZmFycmlzLWxvb2t1cC1ncmlkPlxyXG4gICAgICAgIDwvZGF0YWdyaWQtdG9vbHRpcD5cclxuICAgIDwvZGl2PlxyXG4gICAgYCxcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkTG9va3VwQ29tcG9uZW50IGV4dGVuZHMgRGF0YWdyaWRCYXNlRWRpdG9yRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBWaWV3Q2hpbGQoJ2xvb2t1cCcpIGluc3RhbmNlOiBMb29rdXBHcmlkQ29tcG9uZW50O1xyXG5cclxuXHJcbiAgICBzZXQgY29udHJvbElkKGlkKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jb250cm9sSWQgPSBpZDtcclxuICAgICAgICBpZiAodGhpcy5pbnN0YW5jZS51cmkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5jb250cm9sSWQgKz0gJ18nKyB0aGlzLmluc3RhbmNlLnVyaTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RvcFByb3BhZ2F0aW9uID0gZmFsc2U7XHJcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXI6IFJlbmRlcmVyMiwgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcnRzOiBSdW50aW1lU3RhdGVTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgc3VwZXIocmVuZGVyLCBlbCwgaW5qZWN0b3IpO1xyXG4gICAgICAgIHRoaXMucnRzLnN0YXRlJC5zdWJzY3JpYmUoc3RhdGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc3RhdGUgJiYgc3RhdGUuZm9ybSAmJiBzdGF0ZS5mb3JtLmxvb2t1cCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nID0gc3RhdGUuZm9ybS5sb29rdXAucGVuZGluZztcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcucGVuZGluZyA9IHRoaXMucGVuZGluZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbigge30gLCBMb29rdXBEZWZhdWx0T3B0aW9ucywgdGhpcy5vcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSB0aGlzLmluc3RhbmNlLmlucHV0R3JvdXAudGV4dGJveC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxvYWRlcikge1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlWydodHRwJ10gPSAgeyBnZXREYXRhOiB0aGlzLm9wdGlvbnMubG9hZGVyIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluc3RhbmNlWydob3N0J10gPSB0aGlzLmRnO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRGlhbG9nQ2xvc2VkKCkge1xyXG4gICAgICAgIC8vIHRoaXMubG9va3VwLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkRpYWxvZ09wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Mb2FkU3VjY2VzcygpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsZWFyKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgLy8gY29uc3Qgcm93RGF0YSA9IHRoaXMuaW5zdGFuY2Uuc2VsZWN0aW9uTWdyLmdldEJpbmRpbmdEYXRhKCk7XHJcbiAgICAgICAgLy8gdGhpcy5pbnN0YW5jZVsnZGVmYXVsdE1hcHBpbmcnXS5sb29rdXBGaWVsZE1hcChudWxsLCB0aGlzLmluc3RhbmNlLm1hcEZpZWxkcywgcm93RGF0YSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2xlYXIpIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmNsZWFyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4dEluZm9Gb3JtYXR0ZXIgPSAoZSkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZXh0SW5mb0Zvcm1hdHRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmV4dEluZm9Gb3JtYXR0ZXIoeyBiaW5kaW5nRGF0YTogdGhpcy5kci5yb3dEYXRhLCBpbnN0YW5jZTogZS5pbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxyXG4iXX0=