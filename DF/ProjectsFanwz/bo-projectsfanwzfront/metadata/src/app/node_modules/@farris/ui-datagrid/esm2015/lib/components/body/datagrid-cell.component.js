/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:53
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-31 09:11:02
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, Output, EventEmitter, ViewChild, ElementRef, ChangeDetectionStrategy, ChangeDetectorRef, ViewContainerRef, Injector, Inject, forwardRef, Renderer2 } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { ColumnFormatService } from '@farris/ui-common/column';
import { Utils } from '../../utils/utils';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { DatagridRowDirective } from './datagrid-row.directive';
import { GridCellEditorDirective } from '../editors/cell-editor.directive';
import { DatagridService } from '../../services/datagrid.service';
import { SafePipe } from './../../utils/safe.pipe';
import { TR_PREFIX } from '../../types/constant';
// <ng-container *ngIf="!isEditing && !column.template">
//     <ng-container *ngIf="column.formatter">
//         <span *ngIf="cellFormatterIsFn" [innerHtml]=" column | formatCellData: rowData | safe: 'html'"></span>
//         <span *ngIf="!cellFormatterIsFn">{{  column | formatCellData: rowData }}</span>
//     </ng-container>
//     <span *ngIf="!column.formatter" [class.grid-cell-nowrap]="dg.nowrap" [class.grid-cell-wrap]="!dg.nowrap">{{  column | formatCellData: rowData }}</span>
// </ng-container>
// <span *ngIf="!isEditing && !column.template" cell-content [class.grid-cell-nowrap]="dg.nowrap" [class.grid-cell-wrap]="!dg.nowrap"
//     [rowData]="rowData" [column]="column" [nowrap]="dg.nowrap"></span>
export class DatagridCellComponent {
    /**
     * @param {?} dg
     * @param {?} dr
     * @param {?} el
     * @param {?} cd
     * @param {?} injector
     * @param {?} colFormatSer
     * @param {?} domSanitizer
     */
    constructor(dg, dr, el, cd, injector, colFormatSer, domSanitizer) {
        this.dg = dg;
        this.dr = dr;
        this.el = el;
        this.cd = cd;
        this.injector = injector;
        this.colFormatSer = colFormatSer;
        this.domSanitizer = domSanitizer;
        this.cls = '';
        this.lastColumn = false;
        // @ViewChild('celltip') celltip: DatagridCellTooltipDirective;
        this._isEditing = false;
        this.controlHeight = 'auto';
        this.isSelected = false;
        this._cellEditorTemplate = null;
        this.cellClick = new EventEmitter();
        this.cellDblClick = new EventEmitter();
        this.cellContext = {};
        this.cellStyler = {};
        this.safePipe = null;
        this.ro = null;
        this.canEdit = (/**
         * @return {?}
         */
        () => this.dg.editable && this.dg.editMode === 'cell' && this.column.editor);
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.safePipe = new SafePipe(this.domSanitizer);
        this.render = this.injector.get(Renderer2);
        // this.cellSubscription = this.dfs.currentCell$.pipe(
        //     filter((cell: CellInfo) => {
        //         return cell && this.column.editor && cell.rowIndex === this.rowIndex && cell.field === this.column.field;
        //     })
        // ).subscribe((cell: CellInfo) => {
        //     if (cell && this.column.editor) {
        //         this.isEditing = cell.isEditing;
        //         cell.cellRef = this;
        //         cell.column = this.column;
        //         if (!this.cd['destroyed']) {
        //             this.cd.detectChanges();
        //         }
        //     }
        // });
    }
    /**
     * @return {?}
     */
    get isEditing() {
        return this._isEditing;
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set isEditing(v) {
        if (this._isEditing === v) {
            return;
        }
        this._isEditing = v;
        if (v) {
            if (!this.dr.form || !Object.keys(this.dr.form.controls).length) {
                this.dr.initFormControl();
            }
            if (this.column.editorTemplate && this.column.editorTemplate.elementRef) {
                this.cellContext.formGroup = this.dr.form;
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    if (this.el) {
                        /** @type {?} */
                        const input = this.el.nativeElement.querySelector('input,textarea');
                        if (input) {
                            input.focus();
                        }
                    }
                }), 10);
            }
        }
        if (this.column.editor && this.column.editor.type === 'textarea') {
            if (!this.dg.nowrap) {
                this.controlHeight = this.dr.el.nativeElement.offsetHeight;
            }
        }
        if (!this.cd['destroyed']) {
            this.cd.detectChanges();
        }
    }
    /**
     * @return {?}
     */
    get cellEditorTemplate() {
        return this._cellEditorTemplate;
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set cellEditorTemplate(v) {
        this._cellEditorTemplate = v;
        if (v) {
            this.dg.dgs.cellEditorCreated.emit({ editorRef: null, column: this.column, cellEditorRef: null, templateRef: v });
        }
    }
    /**
     * @return {?}
     */
    get value() {
        if (this.rowData && this.column && this.column.field) {
            return Utils.getValue(this.column.field, this.rowData);
        }
        return '';
    }
    /**
     * @return {?}
     */
    get formControl() {
        if (this.cellEditor) {
            return this.cellEditor.componentRef.instance.formControl;
        }
        else if (this.column.editorTemplate) {
            return this.dr.form.get(this.column.field);
        }
        return null;
    }
    /**
     * @return {?}
     */
    get verticalAlign() {
        /** @type {?} */
        let va = 'center';
        switch (this.column.valign) {
            case 'top':
                va = 'flex-start';
                break;
            case 'bottom':
                va = 'flex-end';
                break;
            default:
                va = 'center';
                break;
        }
        return va;
    }
    /**
     * @return {?}
     */
    get horizontalAlign() {
        /** @type {?} */
        let ha = 'flex-start';
        if (this.column.align === 'right') {
            ha = 'flex-end';
        }
        else if (this.column.align === 'center') {
            ha = 'center';
        }
        return ha;
    }
    /**
     * @return {?}
     */
    get cellStyle() {
        /** @type {?} */
        const h = this.dg.nowrap ? '' : '100%';
        /** @type {?} */
        const w = this.lastColumn ? (this.column.width - 6) + 'px' : '100%';
        /** @type {?} */
        const style = {
            // height: h,
            width: w
        };
        if (!this.isEditing) {
            return Object.assign(style, {
                'align-items': this.verticalAlign,
                'justify-content': this.horizontalAlign
            });
        }
        else {
            return Object.assign(style, {
                'justify-content': this.horizontalAlign
            });
        }
    }
    /**
     * @return {?}
     */
    get cellFormatterIsFn() {
        return typeof this.column.formatter === 'function' || this.column.formatter.type === 'boolean';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initCellTemplateContext();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.initCellTemplateContext();
            this.buildCustomCellStyle();
            if (this.formControl) {
                /** @type {?} */
                const val = Utils.getValue(this.column.field, this.rowData);
                this.formControl.setValue(val);
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    initCellTemplateContext() {
        this.cellContext = {
            field: this.column.field,
            rowIndex: this.rowIndex,
            rowData: this.rowData,
            column: this.column,
            instance: this,
            formGroup: this.dr.form,
            tools: {
                utils: this.dg.commonUtils,
                format: this.dg.colFormatSer,
                number: this.dg.colFormatSer['numberhelper'],
                date: this.dg.colFormatSer['datehelper']
            },
        };
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.buildCustomCellStyle();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.cellSubscription) {
            this.cellSubscription.unsubscribe();
            this.cellSubscription = null;
        }
        if (this.rowUpdateSubscription) {
            this.rowUpdateSubscription.unsubscribe();
            this.rowUpdateSubscription = null;
        }
    }
    /**
     * @private
     * @param {?=} rowData
     * @return {?}
     */
    buildCustomCellStyle(rowData = null) {
        /** @type {?} */
        const td = this.el.nativeElement.parentNode;
        if (!td.id) {
            td.id = TR_PREFIX + this.dr.rowId + '_' + this.rowIndex + '-' + this.column.field;
        }
        td.id = td.id.replace(/\./g, '_');
        if (this.column.styler) {
            /** @type {?} */
            const _rd = rowData || this.rowData;
            /** @type {?} */
            const cs = this.column.styler(_rd[this.column.field], _rd, this.rowIndex);
            if (cs && Object.keys(cs).length) {
                this.dg.renderCustomStyle(cs, td);
            }
        }
        else {
            this.dg.dgs.removeCssRule('#' + td.id);
        }
    }
    /**
     * @param {?=} val
     * @return {?}
     */
    updateValue(val) {
        if (this.dr.form) {
            // this.rowData = Object.assign(this.rowData, this.dr.form.value);
            Utils.setValue(this.column.field, val, this.rowData);
            // this.rowData = {...this.rowData};
            /** @type {?} */
            const rowid = this.rowData[this.dg.idField];
            /** @type {?} */
            const item = this.dg.data.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.dg.idField] === rowid));
            if (item) {
                Utils.setValue(this.column.field, val, item);
            }
            this.dfs.updateCheckedData(rowid, { [this.column.field]: val });
            if (!this.cd['destroyed']) {
                this.cd.detectChanges();
            }
        }
    }
}
DatagridCellComponent.decorators = [
    { type: Component, args: [{
                selector: 'grid-body-cell',
                template: `
    <div
     [attr.cell-tooltip]="column.showTips && !isEditing" [attr.tipMode]=" column.tipMode || 'auto'"
     [attr.message]="column | tipmsg: rowData"  [attr.position]=" column?.tipOptions?.position || 'top-left'"
     [attr.tipWidth]="column?.tipOptions?.width" [attr.tipHeight]="column?.tipOptions?.height"
     class="f-datagrid-cell-content" #cellContainer
     [ngStyle]="cellStyle"
    >
        <ng-container *ngIf="!isEditing && !column.template">
            <ng-container *ngIf="column.formatter">
                <span class="cell-text-box" *ngIf="cellFormatterIsFn" [innerHtml]=" column | formatCellData: rowData | safe: 'html'"></span>
                <span class="cell-text-box" *ngIf="!cellFormatterIsFn">{{  column | formatCellData: rowData }}</span>
            </ng-container>
            <span *ngIf="!column.formatter" class="cell-text-box" [class.grid-cell-nowrap]="dg.nowrap" [class.grid-cell-wrap]="!dg.nowrap">{{  column | formatCellData: rowData }}</span>
        </ng-container>

        <ng-container #cellTemplate *ngIf="!isEditing && column.template" [ngTemplateOutlet]="column.template" [ngTemplateOutletContext]="{$implicit: cellContext}"></ng-container>
        <ng-container #cellEditorTemplate *ngIf="isEditing && column.editorTemplate" [ngTemplateOutlet]="column.editorTemplate" [ngTemplateOutletContext]="{$implicit: cellContext}"></ng-container>
        <ng-container #editorTemplate *ngIf="isEditing && !column.editorTemplate" cell-editor [height]="controlHeight" [rowData]="rowData" [value]="value" [column]="column" [group]="dr.form"></ng-container>
    </div>
    `,
                changeDetection: ChangeDetectionStrategy.Default
            }] }
];
/** @nocollapse */
DatagridCellComponent.ctorParameters = () => [
    { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                     * @return {?}
                     */
                    () => DatagridComponent)),] }] },
    { type: DatagridRowDirective, decorators: [{ type: Inject, args: [forwardRef((/**
                     * @return {?}
                     */
                    () => DatagridRowDirective)),] }] },
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: Injector },
    { type: ColumnFormatService },
    { type: DomSanitizer }
];
DatagridCellComponent.propDecorators = {
    width: [{ type: Input }],
    height: [{ type: Input }],
    cls: [{ type: Input }],
    column: [{ type: Input }],
    rowData: [{ type: Input }],
    rowIndex: [{ type: Input }],
    lastColumn: [{ type: Input }],
    isEditing: [{ type: Input }],
    isSelected: [{ type: Input }],
    cellContainer: [{ type: ViewChild, args: ['cellContainer',] }],
    cellTemplateVcr: [{ type: ViewChild, args: ['cellTemplate', { read: ViewContainerRef },] }],
    cellEditorTemplate: [{ type: ViewChild, args: ['cellEditorTemplate', { read: ViewContainerRef },] }],
    cellEditor: [{ type: ViewChild, args: [GridCellEditorDirective,] }],
    cellClick: [{ type: Output }],
    cellDblClick: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    DatagridCellComponent.prototype.width;
    /** @type {?} */
    DatagridCellComponent.prototype.height;
    /** @type {?} */
    DatagridCellComponent.prototype.cls;
    /** @type {?} */
    DatagridCellComponent.prototype.column;
    /** @type {?} */
    DatagridCellComponent.prototype.rowData;
    /** @type {?} */
    DatagridCellComponent.prototype.rowIndex;
    /** @type {?} */
    DatagridCellComponent.prototype.lastColumn;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype._isEditing;
    /** @type {?} */
    DatagridCellComponent.prototype.controlHeight;
    /** @type {?} */
    DatagridCellComponent.prototype.isSelected;
    /** @type {?} */
    DatagridCellComponent.prototype.cellContainer;
    /** @type {?} */
    DatagridCellComponent.prototype.cellTemplateVcr;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype._cellEditorTemplate;
    /** @type {?} */
    DatagridCellComponent.prototype.cellEditor;
    /** @type {?} */
    DatagridCellComponent.prototype.cellClick;
    /** @type {?} */
    DatagridCellComponent.prototype.cellDblClick;
    /** @type {?} */
    DatagridCellComponent.prototype.cellContext;
    /** @type {?} */
    DatagridCellComponent.prototype.cellStyler;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.cellSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.rowUpdateSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.safePipe;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.ro;
    /** @type {?} */
    DatagridCellComponent.prototype.canEdit;
    /** @type {?} */
    DatagridCellComponent.prototype.dg;
    /** @type {?} */
    DatagridCellComponent.prototype.dr;
    /** @type {?} */
    DatagridCellComponent.prototype.el;
    /** @type {?} */
    DatagridCellComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.injector;
    /** @type {?} */
    DatagridCellComponent.prototype.colFormatSer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellComponent.prototype.domSanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY2VsbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1jZWxsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFVQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUNuRCxTQUFTLEVBQUUsVUFBVSxFQUFFLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUN4RSxRQUFRLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBZ0MsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzNHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUd6RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUUvRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDMUMsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFaEUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDM0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7Ozs7Ozs7Ozs7QUFxQ2pELE1BQU0sT0FBTyxxQkFBcUI7Ozs7Ozs7Ozs7SUF1SjlCLFlBQ3dELEVBQXFCLEVBQ2xCLEVBQXdCLEVBQ3hFLEVBQWMsRUFBUyxFQUFxQixFQUFVLFFBQWtC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ci9mb3Jtcyc7XHJcblxyXG4vKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTA2IDA3OjQzOjUzXHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTEwLTMxIDA5OjExOjAyXHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkNoYW5nZXMsXHJcbiAgICBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgVmlld0NvbnRhaW5lclJlZixcclxuICAgIE9uRGVzdHJveSwgSW5qZWN0b3IsIEluamVjdCwgZm9yd2FyZFJlZiwgQWZ0ZXJWaWV3SW5pdCwgU2ltcGxlQ2hhbmdlcywgUmVuZGVyZXIyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbmltcG9ydCB7IFN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IENvbHVtbkZvcm1hdFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uIH0gZnJvbSAnLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93RGlyZWN0aXZlIH0gZnJvbSAnLi9kYXRhZ3JpZC1yb3cuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgQ2VsbEluZm8gfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zdGF0ZSc7XHJcbmltcG9ydCB7IEdyaWRDZWxsRWRpdG9yRGlyZWN0aXZlIH0gZnJvbSAnLi4vZWRpdG9ycy9jZWxsLWVkaXRvci5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU2FmZVBpcGUgfSBmcm9tICcuLy4uLy4uL3V0aWxzL3NhZmUucGlwZSc7XHJcbmltcG9ydCB7IFRSX1BSRUZJWCB9IGZyb20gJy4uLy4uL3R5cGVzL2NvbnN0YW50JztcclxuXHJcblxyXG4gICAgIC8vIDxuZy1jb250YWluZXIgKm5nSWY9XCIhaXNFZGl0aW5nICYmICFjb2x1bW4udGVtcGxhdGVcIj5cclxuICAgICAgICAvLyAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImNvbHVtbi5mb3JtYXR0ZXJcIj5cclxuICAgICAgICAvLyAgICAgICAgIDxzcGFuICpuZ0lmPVwiY2VsbEZvcm1hdHRlcklzRm5cIiBbaW5uZXJIdG1sXT1cIiBjb2x1bW4gfCBmb3JtYXRDZWxsRGF0YTogcm93RGF0YSB8IHNhZmU6ICdodG1sJ1wiPjwvc3Bhbj5cclxuICAgICAgICAvLyAgICAgICAgIDxzcGFuICpuZ0lmPVwiIWNlbGxGb3JtYXR0ZXJJc0ZuXCI+e3sgIGNvbHVtbiB8IGZvcm1hdENlbGxEYXRhOiByb3dEYXRhIH19PC9zcGFuPlxyXG4gICAgICAgIC8vICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgICAgICAvLyAgICAgPHNwYW4gKm5nSWY9XCIhY29sdW1uLmZvcm1hdHRlclwiIFtjbGFzcy5ncmlkLWNlbGwtbm93cmFwXT1cImRnLm5vd3JhcFwiIFtjbGFzcy5ncmlkLWNlbGwtd3JhcF09XCIhZGcubm93cmFwXCI+e3sgIGNvbHVtbiB8IGZvcm1hdENlbGxEYXRhOiByb3dEYXRhIH19PC9zcGFuPlxyXG4gICAgICAgIC8vIDwvbmctY29udGFpbmVyPlxyXG4gICAgICAgIC8vIDxzcGFuICpuZ0lmPVwiIWlzRWRpdGluZyAmJiAhY29sdW1uLnRlbXBsYXRlXCIgY2VsbC1jb250ZW50IFtjbGFzcy5ncmlkLWNlbGwtbm93cmFwXT1cImRnLm5vd3JhcFwiIFtjbGFzcy5ncmlkLWNlbGwtd3JhcF09XCIhZGcubm93cmFwXCJcclxuICAgICAgICAvLyAgICAgW3Jvd0RhdGFdPVwicm93RGF0YVwiIFtjb2x1bW5dPVwiY29sdW1uXCIgW25vd3JhcF09XCJkZy5ub3dyYXBcIj48L3NwYW4+XHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdncmlkLWJvZHktY2VsbCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgPGRpdlxyXG4gICAgIFthdHRyLmNlbGwtdG9vbHRpcF09XCJjb2x1bW4uc2hvd1RpcHMgJiYgIWlzRWRpdGluZ1wiIFthdHRyLnRpcE1vZGVdPVwiIGNvbHVtbi50aXBNb2RlIHx8ICdhdXRvJ1wiXHJcbiAgICAgW2F0dHIubWVzc2FnZV09XCJjb2x1bW4gfCB0aXBtc2c6IHJvd0RhdGFcIiAgW2F0dHIucG9zaXRpb25dPVwiIGNvbHVtbj8udGlwT3B0aW9ucz8ucG9zaXRpb24gfHwgJ3RvcC1sZWZ0J1wiXHJcbiAgICAgW2F0dHIudGlwV2lkdGhdPVwiY29sdW1uPy50aXBPcHRpb25zPy53aWR0aFwiIFthdHRyLnRpcEhlaWdodF09XCJjb2x1bW4/LnRpcE9wdGlvbnM/LmhlaWdodFwiXHJcbiAgICAgY2xhc3M9XCJmLWRhdGFncmlkLWNlbGwtY29udGVudFwiICNjZWxsQ29udGFpbmVyXHJcbiAgICAgW25nU3R5bGVdPVwiY2VsbFN0eWxlXCJcclxuICAgID5cclxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWlzRWRpdGluZyAmJiAhY29sdW1uLnRlbXBsYXRlXCI+XHJcbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjb2x1bW4uZm9ybWF0dGVyXCI+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImNlbGwtdGV4dC1ib3hcIiAqbmdJZj1cImNlbGxGb3JtYXR0ZXJJc0ZuXCIgW2lubmVySHRtbF09XCIgY29sdW1uIHwgZm9ybWF0Q2VsbERhdGE6IHJvd0RhdGEgfCBzYWZlOiAnaHRtbCdcIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImNlbGwtdGV4dC1ib3hcIiAqbmdJZj1cIiFjZWxsRm9ybWF0dGVySXNGblwiPnt7ICBjb2x1bW4gfCBmb3JtYXRDZWxsRGF0YTogcm93RGF0YSB9fTwvc3Bhbj5cclxuICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwiIWNvbHVtbi5mb3JtYXR0ZXJcIiBjbGFzcz1cImNlbGwtdGV4dC1ib3hcIiBbY2xhc3MuZ3JpZC1jZWxsLW5vd3JhcF09XCJkZy5ub3dyYXBcIiBbY2xhc3MuZ3JpZC1jZWxsLXdyYXBdPVwiIWRnLm5vd3JhcFwiPnt7ICBjb2x1bW4gfCBmb3JtYXRDZWxsRGF0YTogcm93RGF0YSB9fTwvc3Bhbj5cclxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cclxuXHJcbiAgICAgICAgPG5nLWNvbnRhaW5lciAjY2VsbFRlbXBsYXRlICpuZ0lmPVwiIWlzRWRpdGluZyAmJiBjb2x1bW4udGVtcGxhdGVcIiBbbmdUZW1wbGF0ZU91dGxldF09XCJjb2x1bW4udGVtcGxhdGVcIiBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyRpbXBsaWNpdDogY2VsbENvbnRleHR9XCI+PC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgPG5nLWNvbnRhaW5lciAjY2VsbEVkaXRvclRlbXBsYXRlICpuZ0lmPVwiaXNFZGl0aW5nICYmIGNvbHVtbi5lZGl0b3JUZW1wbGF0ZVwiIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImNvbHVtbi5lZGl0b3JUZW1wbGF0ZVwiIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7JGltcGxpY2l0OiBjZWxsQ29udGV4dH1cIj48L25nLWNvbnRhaW5lcj5cclxuICAgICAgICA8bmctY29udGFpbmVyICNlZGl0b3JUZW1wbGF0ZSAqbmdJZj1cImlzRWRpdGluZyAmJiAhY29sdW1uLmVkaXRvclRlbXBsYXRlXCIgY2VsbC1lZGl0b3IgW2hlaWdodF09XCJjb250cm9sSGVpZ2h0XCIgW3Jvd0RhdGFdPVwicm93RGF0YVwiIFt2YWx1ZV09XCJ2YWx1ZVwiIFtjb2x1bW5dPVwiY29sdW1uXCIgW2dyb3VwXT1cImRyLmZvcm1cIj48L25nLWNvbnRhaW5lcj5cclxuICAgIDwvZGl2PlxyXG4gICAgYCxcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuRGVmYXVsdFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRDZWxsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcyB7XHJcbiAgICBASW5wdXQoKSB3aWR0aDogbnVtYmVyO1xyXG4gICAgQElucHV0KCkgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICBASW5wdXQoKSBjbHMgPSAnJztcclxuICAgIEBJbnB1dCgpIGNvbHVtbjogRGF0YUNvbHVtbjtcclxuICAgIEBJbnB1dCgpIHJvd0RhdGE6IGFueTtcclxuICAgIEBJbnB1dCgpIHJvd0luZGV4OiBudW1iZXI7XHJcbiAgICBASW5wdXQoKSBsYXN0Q29sdW1uID0gZmFsc2U7XHJcbiAgICAvLyBAVmlld0NoaWxkKCdjZWxsdGlwJykgY2VsbHRpcDogRGF0YWdyaWRDZWxsVG9vbHRpcERpcmVjdGl2ZTtcclxuXHJcbiAgICBwcml2YXRlIF9pc0VkaXRpbmcgPSBmYWxzZTtcclxuICAgIGNvbnRyb2xIZWlnaHQgPSAnYXV0byc7XHJcbiAgICBnZXQgaXNFZGl0aW5nKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc0VkaXRpbmc7XHJcbiAgICB9XHJcbiAgICBASW5wdXQoKSBzZXQgaXNFZGl0aW5nKHYpIHtcclxuICAgICAgICBpZiAodGhpcy5faXNFZGl0aW5nID09PSB2KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5faXNFZGl0aW5nID0gdjtcclxuXHJcbiAgICAgICAgaWYgKHYpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRyLmZvcm0gfHwgIU9iamVjdC5rZXlzKHRoaXMuZHIuZm9ybS5jb250cm9scykubGVuZ3RoICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kci5pbml0Rm9ybUNvbnRyb2woKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlICYmIHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlLmVsZW1lbnRSZWYpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2VsbENvbnRleHQuZm9ybUdyb3VwID0gdGhpcy5kci5mb3JtO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCx0ZXh0YXJlYScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCAxMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvciAmJiB0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3RleHRhcmVhJykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcubm93cmFwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xIZWlnaHQgPSB0aGlzLmRyLmVsLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIGlzU2VsZWN0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdjZWxsQ29udGFpbmVyJykgY2VsbENvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2NlbGxUZW1wbGF0ZScsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIGNlbGxUZW1wbGF0ZVZjcjogVmlld0NvbnRhaW5lclJlZjtcclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfY2VsbEVkaXRvclRlbXBsYXRlID0gbnVsbDtcclxuICAgIEBWaWV3Q2hpbGQoJ2NlbGxFZGl0b3JUZW1wbGF0ZScsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pXHJcbiAgICBnZXQgY2VsbEVkaXRvclRlbXBsYXRlKCk6IFZpZXdDb250YWluZXJSZWYge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jZWxsRWRpdG9yVGVtcGxhdGU7XHJcbiAgICB9XHJcbiAgICBzZXQgY2VsbEVkaXRvclRlbXBsYXRlKHYpIHtcclxuICAgICAgICB0aGlzLl9jZWxsRWRpdG9yVGVtcGxhdGUgPSB2O1xyXG4gICAgICAgIGlmICh2KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuZGdzLmNlbGxFZGl0b3JDcmVhdGVkLmVtaXQoeyBlZGl0b3JSZWY6IG51bGwsIGNvbHVtbjogdGhpcy5jb2x1bW4sIGNlbGxFZGl0b3JSZWY6IG51bGwsIHRlbXBsYXRlUmVmOiB2fSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEBWaWV3Q2hpbGQoR3JpZENlbGxFZGl0b3JEaXJlY3RpdmUpIGNlbGxFZGl0b3I7XHJcblxyXG5cclxuICAgIEBPdXRwdXQoKSBjZWxsQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgY2VsbERibENsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIGNlbGxDb250ZXh0OiBhbnkgPSB7fTtcclxuICAgIGdldCB2YWx1ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5yb3dEYXRhICYmIHRoaXMuY29sdW1uICYmIHRoaXMuY29sdW1uLmZpZWxkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBVdGlscy5nZXRWYWx1ZSh0aGlzLmNvbHVtbi5maWVsZCwgdGhpcy5yb3dEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmb3JtQ29udHJvbCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jZWxsRWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmLmluc3RhbmNlLmZvcm1Db250cm9sO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZHIuZm9ybS5nZXQodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdmVydGljYWxBbGlnbigpIHtcclxuICAgICAgICBsZXQgdmEgPSAnY2VudGVyJztcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuY29sdW1uLnZhbGlnbikge1xyXG4gICAgICAgICAgICBjYXNlICd0b3AnOlxyXG4gICAgICAgICAgICAgICAgdmEgPSAnZmxleC1zdGFydCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcclxuICAgICAgICAgICAgICAgIHZhID0gJ2ZsZXgtZW5kJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdmEgPSAnY2VudGVyJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZhO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBob3Jpem9udGFsQWxpZ24oKSB7XHJcbiAgICAgICAgbGV0IGhhID0gJ2ZsZXgtc3RhcnQnO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi5hbGlnbiA9PT0gJ3JpZ2h0Jykge1xyXG4gICAgICAgICAgICBoYSA9ICdmbGV4LWVuZCc7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbHVtbi5hbGlnbiA9PT0gJ2NlbnRlcicpIHtcclxuICAgICAgICAgICAgaGEgPSAnY2VudGVyJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGhhO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjZWxsU3R5bGUoKSB7XHJcbiAgICAgICAgY29uc3QgaCA9IHRoaXMuZGcubm93cmFwID8gJycgOiAnMTAwJSc7XHJcbiAgICAgICAgY29uc3QgdyA9IHRoaXMubGFzdENvbHVtbiA/ICh0aGlzLmNvbHVtbi53aWR0aCAtIDYpICsgJ3B4JyA6ICcxMDAlJztcclxuICAgICAgICBjb25zdCBzdHlsZSA9IHtcclxuICAgICAgICAgICAgLy8gaGVpZ2h0OiBoLFxyXG4gICAgICAgICAgICB3aWR0aDogd1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzRWRpdGluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihzdHlsZSwge1xyXG4gICAgICAgICAgICAgICAgJ2FsaWduLWl0ZW1zJzogdGhpcy52ZXJ0aWNhbEFsaWduLFxyXG4gICAgICAgICAgICAgICAgJ2p1c3RpZnktY29udGVudCc6IHRoaXMuaG9yaXpvbnRhbEFsaWduXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHN0eWxlLCB7XHJcbiAgICAgICAgICAgICAgICAnanVzdGlmeS1jb250ZW50JzogdGhpcy5ob3Jpem9udGFsQWxpZ25cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBjZWxsRm9ybWF0dGVySXNGbigpIHtcclxuICAgICAgICByZXR1cm4gdHlwZW9mIHRoaXMuY29sdW1uLmZvcm1hdHRlciA9PT0gJ2Z1bmN0aW9uJyB8fCB0aGlzLmNvbHVtbi5mb3JtYXR0ZXIudHlwZSA9PT0gJ2Jvb2xlYW4nO1xyXG4gICAgfVxyXG5cclxuICAgIGNlbGxTdHlsZXI6IGFueSA9IHt9O1xyXG5cclxuICAgIHByaXZhdGUgZGZzOiBEYXRhZ3JpZEZhY2FkZVNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGRnczogRGF0YWdyaWRTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBjZWxsU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIHJvd1VwZGF0ZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBzYWZlUGlwZTogU2FmZVBpcGUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMjtcclxuICAgIHByaXZhdGUgcm86IFJlc2l6ZU9ic2VydmVyID0gbnVsbDtcclxuICAgIGNhbkVkaXQgPSAoKSA9PiB0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJyAmJiB0aGlzLmNvbHVtbi5lZGl0b3I7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRDb21wb25lbnQpKSBwdWJsaWMgZGc6IERhdGFncmlkQ29tcG9uZW50LFxyXG4gICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBEYXRhZ3JpZFJvd0RpcmVjdGl2ZSkpIHB1YmxpYyBkcjogRGF0YWdyaWRSb3dEaXJlY3RpdmUsXHJcbiAgICAgICAgcHVibGljIGVsOiBFbGVtZW50UmVmLCBwdWJsaWMgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwdWJsaWMgY29sRm9ybWF0U2VyOiBDb2x1bW5Gb3JtYXRTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgZG9tU2FuaXRpemVyOiBEb21TYW5pdGl6ZXJcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuZGZzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRGYWNhZGVTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmRncyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5zYWZlUGlwZSA9IG5ldyBTYWZlUGlwZSh0aGlzLmRvbVNhbml0aXplcik7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIgPSB0aGlzLmluamVjdG9yLmdldChSZW5kZXJlcjIpO1xyXG5cclxuICAgICAgICAvLyB0aGlzLmNlbGxTdWJzY3JpcHRpb24gPSB0aGlzLmRmcy5jdXJyZW50Q2VsbCQucGlwZShcclxuICAgICAgICAvLyAgICAgZmlsdGVyKChjZWxsOiBDZWxsSW5mbykgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuIGNlbGwgJiYgdGhpcy5jb2x1bW4uZWRpdG9yICYmIGNlbGwucm93SW5kZXggPT09IHRoaXMucm93SW5kZXggJiYgY2VsbC5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQ7XHJcbiAgICAgICAgLy8gICAgIH0pXHJcbiAgICAgICAgLy8gKS5zdWJzY3JpYmUoKGNlbGw6IENlbGxJbmZvKSA9PiB7XHJcbiAgICAgICAgLy8gICAgIGlmIChjZWxsICYmIHRoaXMuY29sdW1uLmVkaXRvcikge1xyXG4gICAgICAgIC8vICAgICAgICAgdGhpcy5pc0VkaXRpbmcgPSBjZWxsLmlzRWRpdGluZztcclxuICAgICAgICAvLyAgICAgICAgIGNlbGwuY2VsbFJlZiA9IHRoaXM7XHJcbiAgICAgICAgLy8gICAgICAgICBjZWxsLmNvbHVtbiA9IHRoaXMuY29sdW1uO1xyXG5cclxuICAgICAgICAvLyAgICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAvLyAgICAgICAgIH1cclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuaW5pdENlbGxUZW1wbGF0ZUNvbnRleHQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLnJvd0RhdGEgJiYgIWNoYW5nZXMucm93RGF0YS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0Q2VsbFRlbXBsYXRlQ29udGV4dCgpO1xyXG4gICAgICAgICAgICB0aGlzLmJ1aWxkQ3VzdG9tQ2VsbFN0eWxlKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5mb3JtQ29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsID0gVXRpbHMuZ2V0VmFsdWUodGhpcy5jb2x1bW4uZmllbGQsIHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sLnNldFZhbHVlKHZhbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0Q2VsbFRlbXBsYXRlQ29udGV4dCgpIHtcclxuICAgICAgICB0aGlzLmNlbGxDb250ZXh0ID0ge1xyXG4gICAgICAgICAgICBmaWVsZDogdGhpcy5jb2x1bW4uZmllbGQsXHJcbiAgICAgICAgICAgIHJvd0luZGV4OiB0aGlzLnJvd0luZGV4LFxyXG4gICAgICAgICAgICByb3dEYXRhOiB0aGlzLnJvd0RhdGEsXHJcbiAgICAgICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW4sXHJcbiAgICAgICAgICAgIGluc3RhbmNlOiB0aGlzLFxyXG4gICAgICAgICAgICBmb3JtR3JvdXA6IHRoaXMuZHIuZm9ybSxcclxuICAgICAgICAgICAgdG9vbHM6IHtcclxuICAgICAgICAgICAgICAgIHV0aWxzOiB0aGlzLmRnLmNvbW1vblV0aWxzLFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmRnLmNvbEZvcm1hdFNlcixcclxuICAgICAgICAgICAgICAgIG51bWJlcjogdGhpcy5kZy5jb2xGb3JtYXRTZXJbJ251bWJlcmhlbHBlciddLFxyXG4gICAgICAgICAgICAgICAgZGF0ZTogdGhpcy5kZy5jb2xGb3JtYXRTZXJbJ2RhdGVoZWxwZXInXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuYnVpbGRDdXN0b21DZWxsU3R5bGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jZWxsU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMucm93VXBkYXRlU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm93VXBkYXRlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMucm93VXBkYXRlU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRDdXN0b21DZWxsU3R5bGUocm93RGF0YSA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCB0ZCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlO1xyXG4gICAgICAgIGlmICghdGQuaWQpIHtcclxuICAgICAgICAgICAgdGQuaWQgPSBUUl9QUkVGSVggKyB0aGlzLmRyLnJvd0lkICsgJ18nICsgdGhpcy5yb3dJbmRleCArICctJyArIHRoaXMuY29sdW1uLmZpZWxkO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0ZC5pZCA9IHRkLmlkLnJlcGxhY2UoL1xcLi9nLCAnXycpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4uc3R5bGVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9yZCA9IHJvd0RhdGEgfHwgdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICBjb25zdCBjcyA9IHRoaXMuY29sdW1uLnN0eWxlcihfcmRbdGhpcy5jb2x1bW4uZmllbGRdLCBfcmQsIHRoaXMucm93SW5kZXgpO1xyXG4gICAgICAgICAgICBpZiAoY3MgJiYgT2JqZWN0LmtleXMoY3MpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5yZW5kZXJDdXN0b21TdHlsZShjcywgdGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5kZ3MucmVtb3ZlQ3NzUnVsZSgnIycgKyB0ZC5pZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVZhbHVlKHZhbD86IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLmRyLmZvcm0pIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5yb3dEYXRhID0gT2JqZWN0LmFzc2lnbih0aGlzLnJvd0RhdGEsIHRoaXMuZHIuZm9ybS52YWx1ZSk7XHJcbiAgICAgICAgICAgIFV0aWxzLnNldFZhbHVlKHRoaXMuY29sdW1uLmZpZWxkLCB2YWwsIHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMucm93RGF0YSA9IHsuLi50aGlzLnJvd0RhdGF9O1xyXG4gICAgICAgICAgICBjb25zdCByb3dpZCA9IHRoaXMucm93RGF0YVt0aGlzLmRnLmlkRmllbGRdO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kZy5kYXRhLmZpbmQobiA9PiBuW3RoaXMuZGcuaWRGaWVsZF0gPT09IHJvd2lkKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIFV0aWxzLnNldFZhbHVlKHRoaXMuY29sdW1uLmZpZWxkLCB2YWwsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRmcy51cGRhdGVDaGVja2VkRGF0YShyb3dpZCwgeyBbdGhpcy5jb2x1bW4uZmllbGRdOiB2YWwgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY2RbJ2Rlc3Ryb3llZCddKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=