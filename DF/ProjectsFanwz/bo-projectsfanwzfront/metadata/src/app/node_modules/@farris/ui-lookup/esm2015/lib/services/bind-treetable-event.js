/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FavoriteAction, FAVORITE_FIELD_NAME } from '../lookup-displaytype';
import { cloneDeep } from 'lodash-es';
import { of } from 'rxjs';
import { tap, catchError } from 'rxjs/operators';
export class TreeTableEventManager {
    /**
     * @param {?} ins
     */
    constructor(ins) {
        this.ins = ins;
        /**
         * 标识当前数据是否查询结果
         */
        this.IS_SEARCH_RESULT = false;
        this.lookupSelectionSer = this.ins.lookupSelectionSer;
    }
    /**
     * @param {?} search
     * @return {?}
     */
    searchTreeData(search) {
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        // 判断uri 发出search.emit();
        if (this.ins.searching) {
            return;
        }
        else {
            this.ins.searching = true;
        }
        return this.ins.httpMgr.getData({ search, sortName: tt.sortName, sortOrder: tt.sortOrder }, 'search').pipe(tap((/**
         * @return {?}
         */
        () => {
            this.ins.searching = false;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.ins.searching = false;
            return of(err);
        }))).subscribe((/**
         * @param {?} resData
         * @return {?}
         */
        resData => {
            if (resData) {
                this.ins.items = resData.items;
                this.ins.closeLoading();
                tt.clearAll();
                /** @type {?} */
                const treeInfo = this.ins.gridOptions.treeInfo;
                if (!treeInfo['treeDataIsInit']) {
                    if (treeInfo.layerType.toLowerCase() === 'pathcode') {
                        this.ins.items = this.ins.lookupUtils.makeTree(this.ins.items, treeInfo);
                    }
                    else {
                        this.ins.items = this.ins.lookupUtils.makeTreeWithParentID(this.ins.items, '', `${treeInfo.dataField}.${treeInfo.parentField}`, this.ins.idField);
                    }
                }
                /** @type {?} */
                const checkNodes = (/**
                 * @param {?} nodes
                 * @return {?}
                 */
                (nodes) => {
                    if (nodes && nodes.length) {
                        return nodes.map((/**
                         * @param {?} node
                         * @return {?}
                         */
                        (node) => {
                            if (node.hasOwnProperty('addtional')) {
                                node.selectable = !node['addtional'];
                            }
                            if (node.children && node.children.length) {
                                checkNodes(node.children);
                            }
                            return node;
                        }));
                    }
                    return nodes;
                });
                /** @type {?} */
                const expandFirstNode = (/**
                 * @param {?} nodes
                 * @return {?}
                 */
                (nodes) => {
                    if (nodes && nodes.length) {
                        return nodes.map((/**
                         * @param {?} node
                         * @return {?}
                         */
                        (node) => {
                            if (node.children && node.children.length) {
                                node.expanded = true;
                                expandFirstNode(node.children);
                            }
                            return node;
                        }));
                    }
                    return nodes;
                });
                /** @type {?} */
                const _nodes = checkNodes(this.ins.items);
                if (_nodes && _nodes.length && _nodes[0].children && _nodes[0].children.length) {
                    _nodes[0].expanded = true;
                    _nodes[0].children = expandFirstNode(_nodes[0].children);
                }
                this.ins.items = _nodes;
                // 加载收藏数据
                if (this.ins.useFavorite) {
                    // 更新数据的收藏状态
                    this.ins.favHelper.updateFavoritesStatus(this.ins.items);
                }
                tt.loadData(this.ins.items);
                // // 展开查询结果。
                // if (search.value && this.ins.items.length) {
                //     tt.toggleExpand(this.ins.items[0], true);
                // }
                tt.resize();
                this.IS_SEARCH_RESULT = true;
                this.ins.selectionMgr.selectCurrentValue();
            }
            this.ins.search.emit(search);
        }));
    }
    /**
     * @private
     * @param {?} parentPath
     * @param {?} parentLayer
     * @param {?} searchData
     * @return {?}
     */
    getChildren(parentPath, parentLayer, searchData) {
        /** @type {?} */
        const uri = this.ins.gridOptions.uri;
        /** @type {?} */
        const search = Object.assign({ parentLayer, category: 'children' }, searchData);
        if (this.ins.treeInfo.layerType === 'parentId') {
            search['parentId'] = parentPath;
        }
        else {
            search['parentPath'] = parentPath;
        }
        /** @type {?} */
        const param = {
            searchValue: JSON.stringify(search),
            customData: this.ins.customData,
            enableFullTree: this.ins.enableFullTree,
            loadTreeDataType: this.ins.loadTreeDataType
        };
        if (this.IS_SEARCH_RESULT) {
            param.enableFullTree = false;
            param.loadTreeDataType = 'layerload';
            search.searchValue = '';
            search.searchField = '*';
            param.searchValue = JSON.stringify(search);
        }
        if (this.ins.helpId) {
            param['helpId'] = this.ins.helpId;
        }
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        if (tt && tt.sortName) {
            Object.assign(param, {
                sortName: tt.sortName,
                sortOrder: tt.sortOrder
            });
        }
        return this.ins.http.getData(uri, param);
    }
    /**
     * @return {?}
     */
    bindTreetableEvent() {
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.componentRef.instance));
        /** @type {?} */
        const _searchTreeData = (/**
         * @param {?} searchparam
         * @return {?}
         */
        (searchparam) => {
            if (this.ins.remoteSearch) {
                this.ins._searchState = searchparam;
                this.searchTreeData(searchparam);
            }
            else {
                // TODO: 全部加载，前端搜索 需要完善
                // if (this.ins.loadTreeDataType === 'loadall' && tt.searchHandle) {
                //     tt.searchHandle.search(searchparam.field, searchparam.value, 'client');
                // }
                this.ins.search.emit(searchparam);
            }
        });
        /** @type {?} */
        const isLoadAllTreeData = (/**
         * @return {?}
         */
        () => {
            if (this.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'all';
            }
            else {
                return this.ins.loadTreeDataType === 'loadall';
            }
        });
        /** @type {?} */
        const isAsyncLoadTreeData = (/**
         * @return {?}
         */
        () => {
            if (this.ins.loadTreeDataType === 'default') {
                return tt.loadDataType === 'async';
            }
            else {
                return this.ins.loadTreeDataType === 'layerload';
            }
        });
        tt.dblClickExpand = !this.ins.singleSelect; // 禁用双击展开节点
        tt.allColumnsTitle = this.ins.allColumnsTitle; // this.displayInfo.allColumns;
        tt.idField = this.ins.idField;
        tt.columns = this.ins.columns;
        tt.searchFields = this.ins.gridOptions.searchFields;
        if (this.ins.treeInfo) {
            tt.loadDataType = this.ins.treeInfo.loadDataType;
            tt.virtualized = true;
            this.ins.allData = cloneDeep(this.ins.items);
        }
        if (this.ins.gridOptions.treeInfo) {
            tt.onlySelectLeaf = this.ins.gridOptions.treeInfo.onlySelectLeaf;
            tt.loadDataType = this.ins.gridOptions.treeInfo.loadDataType;
        }
        if (!tt.singleSelect) {
            tt.checkOnSelect = true;
            tt.selectOnCheck = true;
            tt.showCheckbox = true;
            tt.showCheckAll = this.ins.showCheckAll;
            // 启用多选后，同时启用级联选择
            if (this.ins.enableCascade) {
                this.cascadeValueChanged(this.ins.cascadeStatus);
            }
            else {
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
            }
        }
        tt.enableFindText = this.ins.enableFindText;
        // tt.findField = this.textField;
        tt.nodeSelected.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            // if (this.ins.favoritesComponentRef && this.ins.singleSelect) {
            //     const ftt = this.ins.favoritesComponentRef.instance as TreeTableComponent;
            //     ftt.clearSelections();
            // }
            if (this.ins.singleSelect) {
                this.lookupSelectionSer.clearSelections();
            }
            this.lookupSelectionSer.updateSelections([e.node.data]);
            this.ins.checkedChange.emit({ data: [e.node.data], isCheck: true });
        }));
        tt.nodeChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            if (!this.ins.singleSelect) {
                /** @type {?} */
                let data = null;
                if (e.nodes && e.nodes.length) {
                    data = e.nodes.map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data));
                    // this.ins.multiSelMgr.updateSelections(e.nodes.map(n => n.data));
                }
                else {
                    if (Array.isArray(e.node)) {
                        data = e.node.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n.data));
                        // this.ins.multiSelMgr.updateSelections(e.node.map(n => n.data));
                    }
                    else {
                        data = [e.node.data];
                        // this.ins.multiSelMgr.updateSelections([e.node.data]);
                    }
                }
                this.ins.multiSelMgr.updateSelections(data);
                this.ins.checkedChange.emit({ data, isCheck: true });
            }
        }));
        tt.nodeUnChecked.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e && e.node) {
                if (!this.ins.singleSelect) {
                    this.ins.multiSelMgr.remove(e.node.id);
                    // 分层加载，多选，包含下级时，取消勾选 需要将当前节点的所有子级数据也要取消选择，即从已选记录中移除
                    if (tt.loadDataType !== 'all' && this.ins.treeInfo.layerType === 'pathcode' &&
                        (this.ins.cascadeStatus === 'enable' || this.ins.cascadeStatus === 'down')) {
                        if (e.node.children && e.node.children.length) {
                            /** @type {?} */
                            const nodes = e.node.children.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.data));
                            this.ins.lookupSelectionSer.updateSelections(nodes, false);
                        }
                        else {
                            /** @type {?} */
                            const pathcode = e.node.data[this.ins.treeInfo.dataField][this.ins.treeInfo.pathField];
                            this.ins.lookupSelectionSer.unselectByPathcode(pathcode);
                        }
                    }
                    if (e.nodes && e.nodes.length) {
                        this.ins.multiSelMgr.remove(e.nodes.map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => n.id)));
                        this.ins.checkedChange.emit({ data: e.nodes.map((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n.data)), isCheck: false });
                    }
                    else {
                        this.ins.checkedChange.emit({ data: [e.node.data], isCheck: false });
                    }
                }
                else {
                    /** @type {?} */
                    const ftt = this.ins.favoritesComponentRef && ((/** @type {?} */ (this.ins.favoritesComponentRef.instance)));
                    if (ftt && ftt.findRowNode(e.node.id)) {
                        ftt.unSelectNode(e.node.id);
                    }
                    this.ins.checkedChange.emit({ data: [e.node.data], isCheck: false });
                }
            }
        }));
        tt.search.subscribe((/**
         * @param {?} searchparam
         * @return {?}
         */
        searchparam => {
            if (searchparam.field !== '*' && !searchparam.value) {
                this.ins.messagerService.warning(this.ins.mustWriteSomething);
            }
            else {
                _searchTreeData(searchparam);
            }
        }));
        tt.cellClick.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e.col.field === FAVORITE_FIELD_NAME) {
                e.event.stopPropagation();
                // tslint:disable-next-line: no-string-literal
                /** @type {?} */
                const classList = e.event.target['classList'];
                if (classList.contains('f-lookup-favorite')) {
                    // classList.toggle('f-icon-star');
                    // classList.toggle('f-icon-star-outline');
                    /** @type {?} */
                    const _this = this.ins;
                    ((/**
                     * @param {?} arr
                     * @return {?}
                     */
                    function each(arr) {
                        if (arr) {
                            arr.forEach((/**
                             * @param {?} item
                             * @return {?}
                             */
                            item => {
                                /** @type {?} */
                                const id = _this.utils.getValue(_this.idField, item.data);
                                if (id === e.node.id) {
                                    item.data[FAVORITE_FIELD_NAME] = !item.data[FAVORITE_FIELD_NAME];
                                    return true;
                                }
                                else if (item.children && item.children.length > 0) {
                                    return each(item.children);
                                }
                                else {
                                    return false;
                                }
                            }));
                        }
                    }))(this.ins.items);
                    tt.loadData(this.ins.items);
                    // 更新收藏数据
                    this.lookupSelectionSer.updateFavoriteData(e.node.data, e.node.data[FAVORITE_FIELD_NAME] ? FavoriteAction.add : FavoriteAction.delete);
                }
            }
        }));
        tt.dblClick.subscribe((/**
         * @param {?} treeNode
         * @return {?}
         */
        (treeNode) => {
            if (this.ins.gridOptions.singleSelect && treeNode.selectable) {
                if (this.ins.okButton) {
                    // this.lookupSelectionSer.select(treeNode.data);
                    // this.ins.okButton.nativeElement.click();
                    this.ins.selectItem(treeNode.data);
                }
            }
        }));
        /** @type {?} */
        const loadAllData = isLoadAllTreeData();
        tt.columnSorted.subscribe((/**
         * @param {?} sort
         * @return {?}
         */
        (sort) => {
            if (isLoadAllTreeData()) {
                tt.clientSort();
            }
            else {
                const { sortName, sortOrder } = Object.assign({}, sort);
                /** @type {?} */
                const col = this.ins.columns.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.field === sortName));
                /** @type {?} */
                const _sortName = col ? col.fieldPath ? col.fieldPath : col.field : sortName;
                /** @type {?} */
                const param = Object.assign({ sortName: _sortName, sortOrder }, { search: this.ins._searchState });
                this.ins.httpMgr.getData(param, 'search').subscribe((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    this.ins.items = d.items;
                    this.ins.closeLoading();
                    tt.clearAll();
                    /** @type {?} */
                    const items = this.ins.checkNodeCanBeSelect(d.items, false);
                    tt.loadData(items);
                    tt.resize();
                }));
            }
        }));
        tt.clearSearchValue.subscribe((/**
         * @return {?}
         */
        () => {
            this.ins._searchState = null;
            this.IS_SEARCH_RESULT = false;
            /** @type {?} */
            const _items = this.ins.checkNodeCanBeSelect(this.ins.allData, loadAllData);
            if (!_items || !_items.length) {
                _searchTreeData({ field: '*', value: '' });
            }
            else {
                this.ins.items = _items;
                this.ins.favHelper.updateFavoritesStatus(this.ins.items);
                tt.loadData(_items);
            }
        }));
        tt.expand.subscribe((/**
         * @param {?} tn
         * @return {?}
         */
        (tn) => {
            if (tn.leaf) {
                return;
            }
            if (!tn.children || !tn.children.length) {
                /** @type {?} */
                const treeInfo = this.ins.gridOptions.treeInfo;
                if (isAsyncLoadTreeData() || this.IS_SEARCH_RESULT) {
                    /** @type {?} */
                    let parentPath = '';
                    /** @type {?} */
                    let parentLayer = -1;
                    const { field = '*', value = '' } = Object.assign({}, tt.searchData);
                    tn['showLoading'] = true;
                    tt.detectChanges();
                    if (treeInfo.layerType === 'parentId') {
                        // 父ID加载方式
                        parentPath = tn['id'];
                    }
                    else {
                        /** @type {?} */
                        const treeInfoField = treeInfo.dataField;
                        if (treeInfoField) {
                            parentPath = tn.data[treeInfoField][treeInfo.pathField];
                            parentLayer = tn.data[treeInfoField][treeInfo.layerField];
                        }
                        else {
                            console.log('未找到分级信息。');
                        }
                    }
                    if (!this.ins.uri) {
                        this.ins.expandTreeNode.emit({
                            instance: tt, node: tn,
                            parentIdOrPath: parentPath, parentLayer, search: { value, field }
                        });
                        return;
                    }
                    this.getChildren(parentPath, parentLayer, {
                        searchField: field === '*' ? '*' : field,
                        searchValue: value
                    }).subscribe((/**
                     * @param {?} data
                     * @return {?}
                     */
                    data => {
                        if (tt) {
                            if (tn && data.items && data.items.length) {
                                if (this.ins.useFavorite) {
                                    // 更新子节点收藏状态
                                    this.ins.favHelper.updateFavoritesStatus(data.items);
                                }
                                /** @type {?} */
                                const nodes = this.ins.checkNodeCanBeSelect(data.items, false);
                                tt.appendChildren(nodes, tn);
                                if (tt.loadDataType !== 'all' && !this.ins.singleSelect && this.ins.isGetAllChidlNodes &&
                                    (this.ins.cascadeStatus === 'enable' || this.ins.cascadeStatus === 'down')) {
                                    /** @type {?} */
                                    const rn = tt.findRowNode(tn.id);
                                    tt.propagateSelectionDown(rn, rn.isChecked);
                                    // 更新选中记录缓存
                                    /** @type {?} */
                                    const _items = data.items.filter((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    n => !n.addtional));
                                    if (_items && _items.length) {
                                        this.ins.lookupSelectionSer.updateSelections(_items.map((/**
                                         * @param {?} n
                                         * @return {?}
                                         */
                                        n => n.data)), rn.isChecked);
                                    }
                                }
                            }
                            tn['showLoading'] = false;
                            tt.detectChanges();
                            this.ins.selectionMgr.selectCurrentValue();
                        }
                    }));
                }
            }
            else {
                if (!this.ins.singleSelect && this.ins.enableCascade &&
                    (this.ins.cascadeStatus === 'enable' || this.ins.cascadeStatus === 'down') && this.ins.isGetAllChidlNodes) {
                    /** @type {?} */
                    const rn = tt.findRowNode(tn.id);
                    tt.propagateSelectionDown(rn, rn.isChecked);
                    /** @type {?} */
                    const selectItems = tn.children.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.selectable)).map((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.data));
                    this.ins.lookupSelectionSer.updateSelections(selectItems, rn.isChecked);
                }
                this.ins.selectionMgr.selectCurrentValue();
            }
        }));
        if (loadAllData && this.ins.items) {
            this.ins.treeNodeHelper.updateTreeNodeExpanded(this.ins.items);
        }
        return loadAllData;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    cascadeValueChanged($event) {
        /** @type {?} */
        const val = $event;
        // const tt = this.ins.componentRef.instance as TreeTableComponent;
        /** @type {?} */
        const instanceTyp = this.ins.activeTab === 'datalist' ? 'treetable' : 'fav';
        /** @type {?} */
        const tt = (/** @type {?} */ (this.ins.lookupCmpMgr.getComponentInstance(instanceTyp)));
        if (!tt) {
            return;
        }
        switch (val) {
            case 'enable':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
            case 'disable':
                tt.cascadeCheck = false;
                tt.cascadeDown = false;
                tt.cascadeUp = false;
                break;
            case 'up':
                tt.cascadeCheck = true;
                tt.cascadeUp = true;
                tt.cascadeDown = false;
                break;
            case 'down':
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = false;
                break;
            default:
                tt.cascadeCheck = true;
                tt.cascadeDown = true;
                tt.cascadeUp = true;
                break;
        }
        this.ins.cascadeStatus = val || 'enable';
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.lookupSelectionSer;
    /**
     * 标识当前数据是否查询结果
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.IS_SEARCH_RESULT;
    /**
     * @type {?}
     * @private
     */
    TreeTableEventManager.prototype.ins;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZC10cmVldGFibGUtZXZlbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvb2t1cC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9iaW5kLXRyZWV0YWJsZS1ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLGNBQWMsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTVFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFjLEVBQUUsRUFBVyxNQUFNLE1BQU0sQ0FBQztBQUUvQyxPQUFPLEVBQVEsR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSXZELE1BQU0sT0FBTyxxQkFBcUI7Ozs7SUFTOUIsWUFBb0IsR0FBd0I7UUFBeEIsUUFBRyxHQUFILEdBQUcsQ0FBcUI7Ozs7UUFIcEMscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBSTdCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDO0lBQzFELENBQUM7Ozs7O0lBRUQsY0FBYyxDQUFDLE1BQXdDOztjQUM3QyxFQUFFLEdBQUcsbUJBQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFzQjtRQUMvRCx5QkFBeUI7UUFDekIsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRTtZQUNwQixPQUFPO1NBQ1Y7YUFBTTtZQUNILElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztTQUM3QjtRQUNELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUMsU0FBUyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUN0RyxHQUFH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QUFHLElBQUksQ0FBQztnQkFDdkIsRUFBRSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7Z0JBQ3RCLEVBQUUsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixNQUFNO1lBQ1Y7Z0JBQ0ksRUFBRSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO2dCQUN0QixFQUFFLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDcEIsTUFBTTtTQUNiO1FBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEdBQUcsR0FBRyxJQUFJLFFBQVEsQ0FBQztJQUM3QyxDQUFDO0NBRUo7Ozs7OztJQWxmRyxtREFBbUQ7Ozs7OztJQUtuRCxpREFBaUM7Ozs7O0lBR3JCLG9DQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyZWVUYWJsZUNvbXBvbmVudCwgVHJlZU5vZGUgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IEZhdm9yaXRlQWN0aW9uLCBGQVZPUklURV9GSUVMRF9OQU1FIH0gZnJvbSAnLi4vbG9va3VwLWRpc3BsYXl0eXBlJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZFJlc3VsdCB9IGZyb20gJy4uL2xvb2t1cC1ncmlkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vbG9va3VwLWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgdGFrZSwgdGFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBMb29rdXBTZWxlY3Rpb25TZXJ2aWNlIH0gZnJvbSAnLi9sb29rdXAtc2VsZWN0aW9uLnNlcnZpY2UnO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBUcmVlVGFibGVFdmVudE1hbmFnZXIge1xyXG4gICAgcHJpdmF0ZSBsb29rdXBTZWxlY3Rpb25TZXI6IExvb2t1cFNlbGVjdGlvblNlcnZpY2U7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoIfor4blvZPliY3mlbDmja7mmK/lkKbmn6Xor6Lnu5PmnpxcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBJU19TRUFSQ0hfUkVTVUxUID0gZmFsc2U7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5zOiBMb29rdXBHcmlkQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIgPSB0aGlzLmlucy5sb29rdXBTZWxlY3Rpb25TZXI7XHJcbiAgICB9XHJcblxyXG4gICAgc2VhcmNoVHJlZURhdGEoc2VhcmNoOiB7IGZpZWxkOiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfSkge1xyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAvLyDliKTmlq11cmkg5Y+R5Ye6c2VhcmNoLmVtaXQoKTtcclxuICAgICAgICBpZiAodGhpcy5pbnMuc2VhcmNoaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmlucy5zZWFyY2hpbmcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5pbnMuaHR0cE1nci5nZXREYXRhKHsgc2VhcmNoLCBzb3J0TmFtZTogdHQuc29ydE5hbWUsIHNvcnRPcmRlcjogdHQuc29ydE9yZGVyIH0sICdzZWFyY2gnKS5waXBlKFxyXG4gICAgICAgICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VhcmNoaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlYXJjaGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVycik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUocmVzRGF0YSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXNEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IHJlc0RhdGEuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgIHR0LmNsZWFyQWxsKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJlZUluZm8gPSB0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mbztcclxuICAgICAgICAgICAgICAgIGlmICghdHJlZUluZm9bJ3RyZWVEYXRhSXNJbml0J10pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJlZUluZm8ubGF5ZXJUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICdwYXRoY29kZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuaXRlbXMgPSB0aGlzLmlucy5sb29rdXBVdGlscy5tYWtlVHJlZSh0aGlzLmlucy5pdGVtcywgdHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLml0ZW1zID0gdGhpcy5pbnMubG9va3VwVXRpbHMubWFrZVRyZWVXaXRoUGFyZW50SUQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7dHJlZUluZm8uZGF0YUZpZWxkfS4ke3RyZWVJbmZvLnBhcmVudEZpZWxkfWAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5pZEZpZWxkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjaGVja05vZGVzID0gKG5vZGVzKTogVHJlZU5vZGVbXSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGVzICYmIG5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXMubWFwKChub2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuaGFzT3duUHJvcGVydHkoJ2FkZHRpb25hbCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5zZWxlY3RhYmxlID0gIW5vZGVbJ2FkZHRpb25hbCddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tOb2Rlcyhub2RlLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVzO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBleHBhbmRGaXJzdE5vZGUgPSAobm9kZXMpOiBUcmVlTm9kZVtdID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZXMgJiYgbm9kZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBub2Rlcy5tYXAoKG5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGFuZEZpcnN0Tm9kZShub2RlLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVzO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBfbm9kZXMgPSBjaGVja05vZGVzKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIGlmIChfbm9kZXMgJiYgX25vZGVzLmxlbmd0aCAmJiBfbm9kZXNbMF0uY2hpbGRyZW4gJiYgX25vZGVzWzBdLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9ub2Rlc1swXS5leHBhbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX25vZGVzWzBdLmNoaWxkcmVuID0gZXhwYW5kRmlyc3ROb2RlKF9ub2Rlc1swXS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IF9ub2RlcztcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5Yqg6L295pS26JeP5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnMudXNlRmF2b3JpdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDmlbDmja7nmoTmlLbol4/nirbmgIFcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5mYXZIZWxwZXIudXBkYXRlRmF2b3JpdGVzU3RhdHVzKHRoaXMuaW5zLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YSh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAvLyAvLyDlsZXlvIDmn6Xor6Lnu5PmnpzjgIJcclxuICAgICAgICAgICAgICAgIC8vIGlmIChzZWFyY2gudmFsdWUgJiYgdGhpcy5pbnMuaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdHQudG9nZ2xlRXhwYW5kKHRoaXMuaW5zLml0ZW1zWzBdLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIHR0LnJlc2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuSVNfU0VBUkNIX1JFU1VMVCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VsZWN0aW9uTWdyLnNlbGVjdEN1cnJlbnRWYWx1ZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlucy5zZWFyY2guZW1pdChzZWFyY2gpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2hpbGRyZW4oXHJcbiAgICAgICAgcGFyZW50UGF0aCxcclxuICAgICAgICBwYXJlbnRMYXllcixcclxuICAgICAgICBzZWFyY2hEYXRhOiB7IHNlYXJjaEZpZWxkOiBzdHJpbmc7IHNlYXJjaFZhbHVlOiBzdHJpbmcgfVxyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCB1cmkgPSB0aGlzLmlucy5ncmlkT3B0aW9ucy51cmk7XHJcbiAgICAgICAgY29uc3Qgc2VhcmNoID0geyBwYXJlbnRMYXllciwgY2F0ZWdvcnk6ICdjaGlsZHJlbicsIC4uLnNlYXJjaERhdGEgfTtcclxuICAgICAgICBpZiAodGhpcy5pbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGFyZW50SWQnKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFsncGFyZW50SWQnXSA9IHBhcmVudFBhdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VhcmNoWydwYXJlbnRQYXRoJ10gPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFZhbHVlOiBKU09OLnN0cmluZ2lmeShzZWFyY2gpLFxyXG4gICAgICAgICAgICBjdXN0b21EYXRhOiB0aGlzLmlucy5jdXN0b21EYXRhLFxyXG4gICAgICAgICAgICBlbmFibGVGdWxsVHJlZTogdGhpcy5pbnMuZW5hYmxlRnVsbFRyZWUsXHJcbiAgICAgICAgICAgIGxvYWRUcmVlRGF0YVR5cGU6IHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5JU19TRUFSQ0hfUkVTVUxUKSB7XHJcbiAgICAgICAgICAgIHBhcmFtLmVuYWJsZUZ1bGxUcmVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHBhcmFtLmxvYWRUcmVlRGF0YVR5cGUgPSAnbGF5ZXJsb2FkJztcclxuICAgICAgICAgICAgc2VhcmNoLnNlYXJjaFZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgIHNlYXJjaC5zZWFyY2hGaWVsZCA9ICcqJztcclxuICAgICAgICAgICAgcGFyYW0uc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzZWFyY2gpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5zLmhlbHBJZCkge1xyXG4gICAgICAgICAgICBwYXJhbVsnaGVscElkJ10gPSB0aGlzLmlucy5oZWxwSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgaWYgKHR0ICYmIHR0LnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGFyYW0sIHtcclxuICAgICAgICAgICAgICAgIHNvcnROYW1lOiB0dC5zb3J0TmFtZSxcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcjogdHQuc29ydE9yZGVyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmh0dHAuZ2V0RGF0YSh1cmksIHBhcmFtKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgYmluZFRyZWV0YWJsZUV2ZW50KCkge1xyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICBjb25zdCBfc2VhcmNoVHJlZURhdGEgPSAoc2VhcmNocGFyYW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMucmVtb3RlU2VhcmNoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5fc2VhcmNoU3RhdGUgPSBzZWFyY2hwYXJhbTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoVHJlZURhdGEoc2VhcmNocGFyYW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzog5YWo6YOo5Yqg6L2977yM5YmN56uv5pCc57SiIOmcgOimgeWujOWWhFxyXG4gICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsb2FkYWxsJyAmJiB0dC5zZWFyY2hIYW5kbGUpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICB0dC5zZWFyY2hIYW5kbGUuc2VhcmNoKHNlYXJjaHBhcmFtLmZpZWxkLCBzZWFyY2hwYXJhbS52YWx1ZSwgJ2NsaWVudCcpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMuc2VhcmNoLmVtaXQoc2VhcmNocGFyYW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgaXNMb2FkQWxsVHJlZURhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0dC5sb2FkRGF0YVR5cGUgPT09ICdhbGwnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsb2FkYWxsJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IGlzQXN5bmNMb2FkVHJlZURhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5sb2FkVHJlZURhdGFUeXBlID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0dC5sb2FkRGF0YVR5cGUgPT09ICdhc3luYyc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnMubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2xheWVybG9hZCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdHQuZGJsQ2xpY2tFeHBhbmQgPSAhdGhpcy5pbnMuc2luZ2xlU2VsZWN0OyAvLyDnpoHnlKjlj4zlh7vlsZXlvIDoioLngrlcclxuXHJcbiAgICAgICAgdHQuYWxsQ29sdW1uc1RpdGxlID0gdGhpcy5pbnMuYWxsQ29sdW1uc1RpdGxlOyAvLyB0aGlzLmRpc3BsYXlJbmZvLmFsbENvbHVtbnM7XHJcbiAgICAgICAgdHQuaWRGaWVsZCA9IHRoaXMuaW5zLmlkRmllbGQ7XHJcbiAgICAgICAgdHQuY29sdW1ucyA9IHRoaXMuaW5zLmNvbHVtbnM7XHJcbiAgICAgICAgdHQuc2VhcmNoRmllbGRzID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMuc2VhcmNoRmllbGRzO1xyXG4gICAgICAgIGlmICh0aGlzLmlucy50cmVlSW5mbykge1xyXG4gICAgICAgICAgICB0dC5sb2FkRGF0YVR5cGUgPSB0aGlzLmlucy50cmVlSW5mby5sb2FkRGF0YVR5cGU7XHJcbiAgICAgICAgICAgIHR0LnZpcnR1YWxpemVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5pbnMuYWxsRGF0YSA9IGNsb25lRGVlcCh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnMuZ3JpZE9wdGlvbnMudHJlZUluZm8pIHtcclxuICAgICAgICAgICAgdHQub25seVNlbGVjdExlYWYgPSB0aGlzLmlucy5ncmlkT3B0aW9ucy50cmVlSW5mby5vbmx5U2VsZWN0TGVhZjtcclxuICAgICAgICAgICAgdHQubG9hZERhdGFUeXBlID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMudHJlZUluZm8ubG9hZERhdGFUeXBlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0dC5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgdHQuY2hlY2tPblNlbGVjdCA9IHRydWU7XHJcbiAgICAgICAgICAgIHR0LnNlbGVjdE9uQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICB0dC5zaG93Q2hlY2tib3ggPSB0cnVlO1xyXG4gICAgICAgICAgICB0dC5zaG93Q2hlY2tBbGwgPSAgdGhpcy5pbnMuc2hvd0NoZWNrQWxsO1xyXG4gICAgICAgICAgICAvLyDlkK/nlKjlpJrpgInlkI7vvIzlkIzml7blkK/nlKjnuqfogZTpgInmi6lcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5zLmVuYWJsZUNhc2NhZGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FzY2FkZVZhbHVlQ2hhbmdlZCh0aGlzLmlucy5jYXNjYWRlU3RhdHVzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0dC5lbmFibGVGaW5kVGV4dCA9IHRoaXMuaW5zLmVuYWJsZUZpbmRUZXh0O1xyXG4gICAgICAgIC8vIHR0LmZpbmRGaWVsZCA9IHRoaXMudGV4dEZpZWxkO1xyXG4gICAgICAgIHR0Lm5vZGVTZWxlY3RlZC5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmICYmIHRoaXMuaW5zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAvLyAgICAgY29uc3QgZnR0ID0gdGhpcy5pbnMuZmF2b3JpdGVzQ29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgLy8gICAgIGZ0dC5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci5jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKFtlLm5vZGUuZGF0YV0pO1xyXG4gICAgICAgICAgICB0aGlzLmlucy5jaGVja2VkQ2hhbmdlLmVtaXQoeyBkYXRhOiBbZS5ub2RlLmRhdGFdICwgaXNDaGVjazogdHJ1ZSAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0Lm5vZGVDaGVja2VkLnN1YnNjcmliZSggZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pbnMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5ub2RlcyAmJiBlLm5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBlLm5vZGVzLm1hcChuID0+IG4uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhlLm5vZGVzLm1hcChuID0+IG4uZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlLm5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBlLm5vZGUubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnMubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhlLm5vZGUubWFwKG4gPT4gbi5kYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFtlLm5vZGUuZGF0YV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zLm11bHRpU2VsTWdyLnVwZGF0ZVNlbGVjdGlvbnMoW2Uubm9kZS5kYXRhXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMubXVsdGlTZWxNZ3IudXBkYXRlU2VsZWN0aW9ucyhkYXRhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNoZWNrZWRDaGFuZ2UuZW1pdCh7IGRhdGEsIGlzQ2hlY2s6IHRydWUgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0Lm5vZGVVbkNoZWNrZWQuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUgJiYgZS5ub2RlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5zLnNpbmdsZVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLm11bHRpU2VsTWdyLnJlbW92ZShlLm5vZGUuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyDliIblsYLliqDovb3vvIzlpJrpgInvvIzljIXlkKvkuIvnuqfml7bvvIzlj5bmtojli77pgIkg6ZyA6KaB5bCG5b2T5YmN6IqC54K555qE5omA5pyJ5a2Q57qn5pWw5o2u5Lmf6KaB5Y+W5raI6YCJ5oup77yM5Y2z5LuO5bey6YCJ6K6w5b2V5Lit56e76ZmkXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR0LmxvYWREYXRhVHlwZSAhPT0gJ2FsbCcgJiYgdGhpcy5pbnMudHJlZUluZm8ubGF5ZXJUeXBlID09PSAncGF0aGNvZGUnICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmlucy5jYXNjYWRlU3RhdHVzID09PSAnZW5hYmxlJyB8fCB0aGlzLmlucy5jYXNjYWRlU3RhdHVzID09PSAnZG93bicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGUuY2hpbGRyZW4gJiYgZS5ub2RlLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZXMgPSBlLm5vZGUuY2hpbGRyZW4ubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKG5vZGVzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoY29kZSA9IGUubm9kZS5kYXRhW3RoaXMuaW5zLnRyZWVJbmZvLmRhdGFGaWVsZF1bdGhpcy5pbnMudHJlZUluZm8ucGF0aEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci51bnNlbGVjdEJ5UGF0aGNvZGUocGF0aGNvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5ub2RlcyAmJiBlLm5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5tdWx0aVNlbE1nci5yZW1vdmUoZS5ub2Rlcy5tYXAobiA9PiBuLmlkKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmNoZWNrZWRDaGFuZ2UuZW1pdCh7IGRhdGE6IGUubm9kZXMubWFwKG4gPT4gbi5kYXRhKSwgaXNDaGVjazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogW2Uubm9kZS5kYXRhXSwgaXNDaGVjazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdHQgPSB0aGlzLmlucy5mYXZvcml0ZXNDb21wb25lbnRSZWYgJiYgKHRoaXMuaW5zLmZhdm9yaXRlc0NvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmdHQgJiYgZnR0LmZpbmRSb3dOb2RlKGUubm9kZS5pZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnR0LnVuU2VsZWN0Tm9kZShlLm5vZGUuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2hlY2tlZENoYW5nZS5lbWl0KHsgZGF0YTogW2Uubm9kZS5kYXRhXSwgaXNDaGVjazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuc2VhcmNoLnN1YnNjcmliZShzZWFyY2hwYXJhbSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hwYXJhbS5maWVsZCAhPT0gJyonICYmICFzZWFyY2hwYXJhbS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnMubWVzc2FnZXJTZXJ2aWNlLndhcm5pbmcodGhpcy5pbnMubXVzdFdyaXRlU29tZXRoaW5nKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9zZWFyY2hUcmVlRGF0YShzZWFyY2hwYXJhbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdHQuY2VsbENsaWNrLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlLmNvbC5maWVsZCA9PT0gRkFWT1JJVEVfRklFTERfTkFNRSkge1xyXG4gICAgICAgICAgICAgICAgZS5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzTGlzdCA9IGUuZXZlbnQudGFyZ2V0WydjbGFzc0xpc3QnXTtcclxuICAgICAgICAgICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ2YtbG9va3VwLWZhdm9yaXRlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjbGFzc0xpc3QudG9nZ2xlKCdmLWljb24tc3RhcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsYXNzTGlzdC50b2dnbGUoJ2YtaWNvbi1zdGFyLW91dGxpbmUnKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXMuaW5zO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gZWFjaChhcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaWQgPSBfdGhpcy51dGlscy5nZXRWYWx1ZShfdGhpcy5pZEZpZWxkLCBpdGVtLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PT0gZS5ub2RlLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVtGQVZPUklURV9GSUVMRF9OQU1FXSA9ICFpdGVtLmRhdGFbRkFWT1JJVEVfRklFTERfTkFNRV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5jaGlsZHJlbiAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVhY2goaXRlbS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSkodGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHR0LmxvYWREYXRhKHRoaXMuaW5zLml0ZW1zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5pu05paw5pS26JeP5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlRmF2b3JpdGVEYXRhKCBlLm5vZGUuZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5ub2RlLmRhdGFbRkFWT1JJVEVfRklFTERfTkFNRV0gPyBGYXZvcml0ZUFjdGlvbi5hZGQgOiBGYXZvcml0ZUFjdGlvbi5kZWxldGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHR0LmRibENsaWNrLnN1YnNjcmliZSgodHJlZU5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlucy5ncmlkT3B0aW9ucy5zaW5nbGVTZWxlY3QgJiYgdHJlZU5vZGUuc2VsZWN0YWJsZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5zLm9rQnV0dG9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb29rdXBTZWxlY3Rpb25TZXIuc2VsZWN0KHRyZWVOb2RlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaW5zLm9rQnV0dG9uLm5hdGl2ZUVsZW1lbnQuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5zZWxlY3RJdGVtKHRyZWVOb2RlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgbG9hZEFsbERhdGEgPSBpc0xvYWRBbGxUcmVlRGF0YSgpO1xyXG4gICAgICAgIHR0LmNvbHVtblNvcnRlZC5zdWJzY3JpYmUoKHNvcnQ6IHsgc29ydE5hbWU6IHN0cmluZzsgc29ydE9yZGVyOiBhbnk7IH0pID0+IHtcclxuICAgICAgICAgICAgaWYgKGlzTG9hZEFsbFRyZWVEYXRhKCkpIHtcclxuICAgICAgICAgICAgICAgIHR0LmNsaWVudFNvcnQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgc29ydE5hbWUsIHNvcnRPcmRlciB9ID0geyAuLi5zb3J0IH07XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgY29sID0gdGhpcy5pbnMuY29sdW1ucy5maW5kKG4gPT4gbi5maWVsZCA9PT0gc29ydE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX3NvcnROYW1lID0gY29sID8gY29sLmZpZWxkUGF0aCA/IGNvbC5maWVsZFBhdGggOiBjb2wuZmllbGQgOiBzb3J0TmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbSA9IE9iamVjdC5hc3NpZ24oeyBzb3J0TmFtZTogX3NvcnROYW1lLCBzb3J0T3JkZXIgfSwgeyBzZWFyY2g6IHRoaXMuaW5zLl9zZWFyY2hTdGF0ZSB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmh0dHBNZ3IuZ2V0RGF0YShwYXJhbSwgJ3NlYXJjaCcpLnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IGQuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQuY2xlYXJBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuaW5zLmNoZWNrTm9kZUNhbkJlU2VsZWN0KGQuaXRlbXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5sb2FkRGF0YShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQucmVzaXplKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5jbGVhclNlYXJjaFZhbHVlLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zLl9zZWFyY2hTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuSVNfU0VBUkNIX1JFU1VMVCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBjb25zdCBfaXRlbXMgPSB0aGlzLmlucy5jaGVja05vZGVDYW5CZVNlbGVjdCh0aGlzLmlucy5hbGxEYXRhLCBsb2FkQWxsRGF0YSk7XHJcbiAgICAgICAgICAgIGlmICghX2l0ZW1zIHx8ICFfaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBfc2VhcmNoVHJlZURhdGEoeyBmaWVsZDogJyonLCB2YWx1ZTogJycgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucy5pdGVtcyA9IF9pdGVtcztcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLmZhdkhlbHBlci51cGRhdGVGYXZvcml0ZXNTdGF0dXModGhpcy5pbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgdHQubG9hZERhdGEoX2l0ZW1zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0dC5leHBhbmQuc3Vic2NyaWJlKCh0bjogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRuLmxlYWYpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXRuLmNoaWxkcmVuIHx8ICF0bi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyZWVJbmZvID0gdGhpcy5pbnMuZ3JpZE9wdGlvbnMudHJlZUluZm87XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNBc3luY0xvYWRUcmVlRGF0YSgpIHx8IHRoaXMuSVNfU0VBUkNIX1JFU1VMVCApIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcGFyZW50UGF0aCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnRMYXllciA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZmllbGQgPSAnKicsIHZhbHVlID0gJycgfSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLi4udHQuc2VhcmNoRGF0YVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRuWydzaG93TG9hZGluZyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0dC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvLmxheWVyVHlwZSA9PT0gJ3BhcmVudElkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDniLZJROWKoOi9veaWueW8j1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gdG5bJ2lkJ107XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJlZUluZm9GaWVsZCA9IHRyZWVJbmZvLmRhdGFGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVJbmZvRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGggPSB0bi5kYXRhW3RyZWVJbmZvRmllbGRdW3RyZWVJbmZvLnBhdGhGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRMYXllciA9IHRuLmRhdGFbdHJlZUluZm9GaWVsZF1bdHJlZUluZm8ubGF5ZXJGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5pyq5om+5Yiw5YiG57qn5L+h5oGv44CCJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnMudXJpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmV4cGFuZFRyZWVOb2RlLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2U6IHR0LCBub2RlOiB0bixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudElkT3JQYXRoOiBwYXJlbnRQYXRoLCBwYXJlbnRMYXllciwgc2VhcmNoOiB7IHZhbHVlLCBmaWVsZCB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkcmVuKHBhcmVudFBhdGgsIHBhcmVudExheWVyLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkOiBmaWVsZCA9PT0gJyonID8gJyonIDogZmllbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFZhbHVlOiB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG4gJiYgZGF0YS5pdGVtcyAmJiBkYXRhLml0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucy51c2VGYXZvcml0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDlrZDoioLngrnmlLbol4/nirbmgIFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnMuZmF2SGVscGVyLnVwZGF0ZUZhdm9yaXRlc1N0YXR1cyhkYXRhLml0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5pbnMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QoZGF0YS5pdGVtcywgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5hcHBlbmRDaGlsZHJlbihub2RlcywgdG4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHQubG9hZERhdGFUeXBlICE9PSAnYWxsJyAmJiAhdGhpcy5pbnMuc2luZ2xlU2VsZWN0ICYmIHRoaXMuaW5zLmlzR2V0QWxsQ2hpZGxOb2RlcyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2VuYWJsZScgfHwgdGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2Rvd24nKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm4gPSB0dC5maW5kUm93Tm9kZSh0bi5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LnByb3BhZ2F0ZVNlbGVjdGlvbkRvd24ocm4sIHJuLmlzQ2hlY2tlZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDpgInkuK3orrDlvZXnvJPlrZhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgX2l0ZW1zID0gZGF0YS5pdGVtcy5maWx0ZXIobiA9PiAhbi5hZGR0aW9uYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2l0ZW1zICYmIF9pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLmxvb2t1cFNlbGVjdGlvblNlci51cGRhdGVTZWxlY3Rpb25zKF9pdGVtcy5tYXAobiA9PiBuLmRhdGEpLCBybi5pc0NoZWNrZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG5bJ3Nob3dMb2FkaW5nJ10gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlbGVjdGlvbk1nci5zZWxlY3RDdXJyZW50VmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlucy5zaW5nbGVTZWxlY3QgJiYgdGhpcy5pbnMuZW5hYmxlQ2FzY2FkZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2VuYWJsZScgfHwgdGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9PT0gJ2Rvd24nKSAmJiB0aGlzLmlucy5pc0dldEFsbENoaWRsTm9kZXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm4gPSB0dC5maW5kUm93Tm9kZSh0bi5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHQucHJvcGFnYXRlU2VsZWN0aW9uRG93bihybiwgcm4uaXNDaGVja2VkKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RJdGVtcyA9IHRuLmNoaWxkcmVuLmZpbHRlcihuID0+IG4uc2VsZWN0YWJsZSkubWFwKG4gPT4gbi5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlucy5sb29rdXBTZWxlY3Rpb25TZXIudXBkYXRlU2VsZWN0aW9ucyhzZWxlY3RJdGVtcywgcm4uaXNDaGVja2VkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuaW5zLnNlbGVjdGlvbk1nci5zZWxlY3RDdXJyZW50VmFsdWUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAobG9hZEFsbERhdGEgJiYgdGhpcy5pbnMuaXRlbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5pbnMudHJlZU5vZGVIZWxwZXIudXBkYXRlVHJlZU5vZGVFeHBhbmRlZCh0aGlzLmlucy5pdGVtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBsb2FkQWxsRGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBjYXNjYWRlVmFsdWVDaGFuZ2VkKCRldmVudCkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9ICRldmVudDtcclxuICAgICAgICAvLyBjb25zdCB0dCA9IHRoaXMuaW5zLmNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2VUeXAgPSB0aGlzLmlucy5hY3RpdmVUYWIgPT09ICdkYXRhbGlzdCcgPyAndHJlZXRhYmxlJyA6ICdmYXYnO1xyXG4gICAgICAgIGNvbnN0IHR0ID0gdGhpcy5pbnMubG9va3VwQ21wTWdyLmdldENvbXBvbmVudEluc3RhbmNlKGluc3RhbmNlVHlwKSBhcyBUcmVlVGFibGVDb21wb25lbnQ7XHJcblxyXG4gICAgICAgIGlmICghdHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoICh2YWwpIHtcclxuICAgICAgICAgICAgY2FzZSAnZW5hYmxlJzpcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVDaGVjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlVXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGUnOlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZUNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHR0LmNhc2NhZGVVcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0dC5jYXNjYWRlQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZURvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHQuY2FzY2FkZVVwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbnMuY2FzY2FkZVN0YXR1cyA9IHZhbCB8fCAnZW5hYmxlJztcclxuICAgIH1cclxuXHJcbn1cclxuIl19