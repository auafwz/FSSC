import { Injectable, Optional } from '@angular/core';
import { LoadingService } from '@farris/ui-loading';
import { HideEventService } from './hide-event.service';
import { AppContext } from '@farris/devkit';
// tslint:disable: no-string-literal
/**
 * 加载提示Helper
 * 1、包装@farris/ui的LoadingService；
 * 2、提供针对表单的快捷方法；
 */
var FormLoadingService = /** @class */ (function () {
    /**
     * 强制显示，不能隐藏
     */
    /**
     * 构造函数
     * 注入@farris/ui的LoadingService
     */
    function FormLoadingService(loadingService, hideEventService, applicationContext) {
        var _this = this;
        this.loadingService = loadingService;
        this.hideEventService = hideEventService;
        this.applicationContext = applicationContext;
        /**
         * 延迟loading定时器
         */
        this.loadingTimerIds = [];
        if (hideEventService) {
            this.hideEventService.hideEvent.subscribe(function (result) {
                _this.hide();
            });
        }
        this.registerService();
    }
    FormLoadingService.prototype.setSuspend = function (flag) {
        FormLoadingService.isSuspend = flag;
    };
    /**
     * 显示加载中
     */
    FormLoadingService.prototype.show = function (configOrMessage) {
        if (FormLoadingService.isSuspend === true) {
            return;
        }
        if (this.loadingCmp) {
            this.loadingCmp.close();
            this.loadingCmp = null;
        }
        var loadingConfig = this.buildLoadingConfig(configOrMessage);
        this.loadingCmp = this.loadingService.show(loadingConfig);
        return this.loadingCmp;
    };
    /**
     * 延迟显示Loading
     */
    FormLoadingService.prototype.showLoadingWithDelay = function (delayTime, configOrMessage) {
        var _this = this;
        // this.show(configOrMessage);
        var timerId = setTimeout(function () {
            _this.show(configOrMessage);
        }, delayTime);
        this.loadingTimerIds.push(timerId);
        return timerId;
    };
    /**
     * 隐藏延迟的Loading
     */
    FormLoadingService.prototype.hideDelayLoading = function (timerIdToClear) {
        this.clearLoadingTimer(timerIdToClear);
        this.hide();
    };
    /**
     * 构造LoadingConfig
     * @param configOrMessage 配置对象或消息字符串
     */
    FormLoadingService.prototype.buildLoadingConfig = function (configOrMessage) {
        var loadingConfig;
        if (!!configOrMessage) {
            if (typeof configOrMessage === 'object') {
                loadingConfig = configOrMessage;
            }
            else {
                loadingConfig = { 'message': configOrMessage };
            }
        }
        else {
            loadingConfig = {};
        }
        if (!loadingConfig.hasOwnProperty('delay')) {
            loadingConfig.delay = 0;
        }
        return loadingConfig;
    };
    /**
     * 关闭所有loading
     */
    FormLoadingService.prototype.clearAll = function () {
        FormLoadingService.isSuspend = false;
        this.loadingService.clearAll();
        this.loadingCmp = null;
        this.clearAllLoadingTimers();
    };
    /**
     * 清空Loading定时器
     */
    FormLoadingService.prototype.clearLoadingTimer = function (timerIdToClear) {
        clearTimeout(timerIdToClear);
        this.loadingTimerIds = this.loadingTimerIds.filter(function (timerId) {
            return timerId !== timerIdToClear;
        });
    };
    /**
     * 清空所有Loading定时器
     */
    FormLoadingService.prototype.clearAllLoadingTimers = function () {
        var _this = this;
        this.loadingTimerIds.forEach(function (timerId) {
            _this.clearLoadingTimer(timerId);
        });
    };
    /**
     * 隐藏加载中
     */
    FormLoadingService.prototype.hide = function () {
        if (!this.loadingCmp) {
            return;
        }
        if (FormLoadingService.isSuspend === true) {
            return;
        }
        this.loadingCmp.close();
        this.loadingCmp = null;
    };
    /**
     * 注册所有的LoadingService实例
     */
    FormLoadingService.prototype.registerService = function () {
        var services = window['DEVKIT_LOADING_SERVICE'] || [];
        services.push(this);
        window['DEVKIT_LOADING_SERVICE'] = services;
    };
    FormLoadingService.isSuspend = false;
    FormLoadingService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FormLoadingService.ctorParameters = function () { return [
        { type: LoadingService },
        { type: HideEventService, decorators: [{ type: Optional }] },
        { type: AppContext, decorators: [{ type: Optional }] }
    ]; };
    return FormLoadingService;
}());
export { FormLoadingService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1sb2FkaW5nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZm9ybS1sb2FkaW5nL2Zvcm0tbG9hZGluZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQVksUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxjQUFjLEVBQW1DLE1BQU0sb0JBQW9CLENBQUM7QUFDckYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLG9DQUFvQztBQUNwQzs7OztHQUlHO0FBQ0g7SUFhRTs7T0FFRztJQUVIOzs7T0FHRztJQUNILDRCQUNVLGNBQThCLEVBQ2xCLGdCQUFrQyxFQUNsQyxrQkFBOEI7UUFIcEQsaUJBY0M7UUFiUyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDbEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQVk7UUFoQnBEOztXQUVHO1FBQ0ssb0JBQWUsR0FBVSxFQUFFLENBQUM7UUFlbEMsSUFBSSxnQkFBZ0IsRUFBRTtZQUNwQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FDdkMsVUFBQSxNQUFNO2dCQUNKLEtBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNkLENBQUMsQ0FDRixDQUFDO1NBQ0g7UUFDRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFFekIsQ0FBQztJQUNNLHVDQUFVLEdBQWpCLFVBQWtCLElBQWE7UUFDN0Isa0JBQWtCLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztJQUN0QyxDQUFDO0lBQ0Q7O09BRUc7SUFDSSxpQ0FBSSxHQUFYLFVBQVksZUFBcUI7UUFDL0IsSUFBSSxrQkFB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QUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7T0FFRztJQUNLLDRDQUFlLEdBQXZCO1FBQ0UsSUFBTSxRQUFRLEdBQVUsTUFBTSxDQUFDLHdCQUF3QixDQUFDLElBQUksRUFBRSxDQUFDO1FBQy9ELFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsTUFBTSxDQUFDLHdCQUF3QixDQUFDLEdBQUcsUUFBUSxDQUFDO0lBQzlDLENBQUM7SUFqSmMsNEJBQVMsR0FBRyxLQUFLLENBQUM7O2dCQUZsQyxVQUFVOzs7O2dCQVRGLGNBQWM7Z0JBQ2QsZ0JBQWdCLHVCQStCcEIsUUFBUTtnQkE5QkosVUFBVSx1QkErQmQsUUFBUTs7SUE0SGIseUJBQUM7Q0FBQSxBQXBKRCxJQW9KQztBQUdELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgU2tpcFNlbGYsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlLCBMb2FkaW5nQ29uZmlnLCBMb2FkaW5nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgSGlkZUV2ZW50U2VydmljZSB9IGZyb20gJy4vaGlkZS1ldmVudC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQXBwQ29udGV4dCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXHJcbi8qKlxyXG4gKiDliqDovb3mj5DnpLpIZWxwZXJcclxuICogMeOAgeWMheijhUBmYXJyaXMvdWnnmoRMb2FkaW5nU2VydmljZe+8m1xyXG4gKiAy44CB5o+Q5L6b6ZKI5a+56KGo5Y2V55qE5b+r5o235pa55rOV77ybXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIEZvcm1Mb2FkaW5nU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgaXNTdXNwZW5kID0gZmFsc2U7XHJcbiAgLyoqXHJcbiAgICog5Yqg6L295Lit57uE5Lu25a6e5L6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBsb2FkaW5nQ21wOiBMb2FkaW5nQ29tcG9uZW50O1xyXG5cclxuICAvKipcclxuICAgKiDlu7bov59sb2FkaW5n5a6a5pe25ZmoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBsb2FkaW5nVGltZXJJZHM6IGFueVtdID0gW107XHJcblxyXG4gIC8qKlxyXG4gICAqIOW8uuWItuaYvuekuu+8jOS4jeiDvemakOiXj1xyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKiDms6jlhaVAZmFycmlzL3Vp55qETG9hZGluZ1NlcnZpY2VcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbG9hZGluZ1NlcnZpY2U6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBoaWRlRXZlbnRTZXJ2aWNlOiBIaWRlRXZlbnRTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBhcHBsaWNhdGlvbkNvbnRleHQ6IEFwcENvbnRleHQsXHJcbiAgKSB7XHJcbiAgICBpZiAoaGlkZUV2ZW50U2VydmljZSkge1xyXG4gICAgICB0aGlzLmhpZGVFdmVudFNlcnZpY2UuaGlkZUV2ZW50LnN1YnNjcmliZShcclxuICAgICAgICByZXN1bHQgPT4ge1xyXG4gICAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZWdpc3RlclNlcnZpY2UoKTtcclxuXHJcbiAgfVxyXG4gIHB1YmxpYyBzZXRTdXNwZW5kKGZsYWc6IGJvb2xlYW4pIHtcclxuICAgIEZvcm1Mb2FkaW5nU2VydmljZS5pc1N1c3BlbmQgPSBmbGFnO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmmL7npLrliqDovb3kuK1cclxuICAgKi9cclxuICBwdWJsaWMgc2hvdyhjb25maWdPck1lc3NhZ2U/OiBhbnkpOiBMb2FkaW5nQ29tcG9uZW50IHtcclxuICAgIGlmIChGb3JtTG9hZGluZ1NlcnZpY2UuaXNTdXNwZW5kID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmxvYWRpbmdDbXApIHtcclxuICAgICAgdGhpcy5sb2FkaW5nQ21wLmNsb3NlKCk7XHJcbiAgICAgIHRoaXMubG9hZGluZ0NtcCA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbG9hZGluZ0NvbmZpZyA9IHRoaXMuYnVpbGRMb2FkaW5nQ29uZmlnKGNvbmZpZ09yTWVzc2FnZSk7XHJcbiAgICB0aGlzLmxvYWRpbmdDbXAgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3cobG9hZGluZ0NvbmZpZyk7XHJcbiAgICByZXR1cm4gdGhpcy5sb2FkaW5nQ21wO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bu26L+f5pi+56S6TG9hZGluZ1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzaG93TG9hZGluZ1dpdGhEZWxheShkZWxheVRpbWU6IG51bWJlciwgY29uZmlnT3JNZXNzYWdlPzogYW55KTogYW55IHtcclxuICAgIC8vIHRoaXMuc2hvdyhjb25maWdPck1lc3NhZ2UpO1xyXG4gICAgY29uc3QgdGltZXJJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLnNob3coY29uZmlnT3JNZXNzYWdlKTtcclxuICAgIH0sIGRlbGF5VGltZSk7XHJcbiAgICB0aGlzLmxvYWRpbmdUaW1lcklkcy5wdXNoKHRpbWVySWQpO1xyXG4gICAgcmV0dXJuIHRpbWVySWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpmpDol4/lu7bov5/nmoRMb2FkaW5nXHJcbiAgICovXHJcbiAgcHVibGljIGhpZGVEZWxheUxvYWRpbmcodGltZXJJZFRvQ2xlYXI6IGFueSkge1xyXG4gICAgdGhpcy5jbGVhckxvYWRpbmdUaW1lcih0aW1lcklkVG9DbGVhcik7XHJcbiAgICB0aGlzLmhpZGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoExvYWRpbmdDb25maWdcclxuICAgKiBAcGFyYW0gY29uZmlnT3JNZXNzYWdlIOmFjee9ruWvueixoeaIlua2iOaBr+Wtl+espuS4slxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRMb2FkaW5nQ29uZmlnKGNvbmZpZ09yTWVzc2FnZTogYW55KTogTG9hZGluZ0NvbmZpZyB7XHJcbiAgICBsZXQgbG9hZGluZ0NvbmZpZzogTG9hZGluZ0NvbmZpZztcclxuICAgIGlmICghIWNvbmZpZ09yTWVzc2FnZSkge1xyXG4gICAgICBpZiAodHlwZW9mIGNvbmZpZ09yTWVzc2FnZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBsb2FkaW5nQ29uZmlnID0gY29uZmlnT3JNZXNzYWdlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxvYWRpbmdDb25maWcgPSB7ICdtZXNzYWdlJzogY29uZmlnT3JNZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxvYWRpbmdDb25maWcgPSB7fTtcclxuICAgIH1cclxuICAgIGlmICghbG9hZGluZ0NvbmZpZy5oYXNPd25Qcm9wZXJ0eSgnZGVsYXknKSkge1xyXG4gICAgICBsb2FkaW5nQ29uZmlnLmRlbGF5ID0gMDtcclxuICAgIH1cclxuICAgIHJldHVybiBsb2FkaW5nQ29uZmlnO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YWz6Zet5omA5pyJbG9hZGluZ1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhckFsbCgpIHtcclxuICAgIEZvcm1Mb2FkaW5nU2VydmljZS5pc1N1c3BlbmQgPSBmYWxzZTtcclxuICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcclxuICAgIHRoaXMubG9hZGluZ0NtcCA9IG51bGw7XHJcbiAgICB0aGlzLmNsZWFyQWxsTG9hZGluZ1RpbWVycygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5riF56m6TG9hZGluZ+WumuaXtuWZqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2xlYXJMb2FkaW5nVGltZXIodGltZXJJZFRvQ2xlYXI6IGFueSkge1xyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVySWRUb0NsZWFyKTtcclxuICAgIHRoaXMubG9hZGluZ1RpbWVySWRzID0gdGhpcy5sb2FkaW5nVGltZXJJZHMuZmlsdGVyKCh0aW1lcklkOiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIHRpbWVySWQgIT09IHRpbWVySWRUb0NsZWFyO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmuIXnqbrmiYDmnIlMb2FkaW5n5a6a5pe25ZmoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjbGVhckFsbExvYWRpbmdUaW1lcnMoKSB7XHJcbiAgICB0aGlzLmxvYWRpbmdUaW1lcklkcy5mb3JFYWNoKCh0aW1lcklkOiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5jbGVhckxvYWRpbmdUaW1lcih0aW1lcklkKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6ZqQ6JeP5Yqg6L295LitXHJcbiAgICovXHJcbiAgcHVibGljIGhpZGUoKSB7XHJcbiAgICBpZiAoIXRoaXMubG9hZGluZ0NtcCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoRm9ybUxvYWRpbmdTZXJ2aWNlLmlzU3VzcGVuZCA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmxvYWRpbmdDbXAuY2xvc2UoKTtcclxuICAgIHRoaXMubG9hZGluZ0NtcCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDms6jlhozmiYDmnInnmoRMb2FkaW5nU2VydmljZeWunuS+i1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVnaXN0ZXJTZXJ2aWNlKCkge1xyXG4gICAgY29uc3Qgc2VydmljZXM6IGFueVtdID0gd2luZG93WydERVZLSVRfTE9BRElOR19TRVJWSUNFJ10gfHwgW107XHJcbiAgICBzZXJ2aWNlcy5wdXNoKHRoaXMpO1xyXG4gICAgd2luZG93WydERVZLSVRfTE9BRElOR19TRVJWSUNFJ10gPSBzZXJ2aWNlcztcclxuICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgeyBGb3JtTG9hZGluZ1NlcnZpY2UgfTtcclxuIl19