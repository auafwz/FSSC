/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, ViewEncapsulation } from '@angular/core';
import { PaginationControlsComponent } from '@farris/ui-pagination';
import { DiscussionListService } from './discussion-list.service';
export class DiscussionListComponent {
    /**
     * @param {?} discussionListService
     */
    constructor(discussionListService) {
        this.discussionListService = discussionListService;
        // @Input() personnelsPrimaryKey: string = 'userId';
        this.personnelsDisplayKey = 'userName';
        /**
         * 是否支持分页
         */
        this.supportPaging = true;
        /**总页数 */
        // @Input() pageSize:number;
        /**
         * 当前页码
         */
        this.pageIndex = 1;
        /**每页显示条数选项 */
        // private _pageList = [10,20,30,50];
        // get pageList() {
        //     return this._pageList;
        // }
        // @Input() set pageList(val) {
        //     this._pageList = val;
        //     if (this.pager) {
        //         this.pager.setPageList(val);
        //     }
        // }
        /**
         * 总条数
         */
        this._total = 0;
        /**
         * 每页显示个数
         */
        this._pageSize = 10;
        /**当前页数 */
        // private _pageIndex = 1;
        // get pageIndex() {
        //     return this._pageIndex;
        // }
        // @Input() set pageIndex(val) {
        //   if(val){
        //     this._pageIndex = val;
        //     this.initPaginationOptions();
        //   }
        // }
        /**总条数 */
        // @Input() total = 0;
        /**
         * 评论数据
         */
        this.innerDiscussionData = [];
        this._discussionData = [];
        this.replyMessage = new EventEmitter();
        // 分页事件
        this.pageChanged = new EventEmitter();
        this.pageSizeChanged = new EventEmitter();
        /**
         * 附件预览
         */
        this.filePreview = new EventEmitter();
        /**
         * 附件下载
         */
        this.fileDownload = new EventEmitter();
        this.labels = {
            previousLabel: ' ',
            nextLabel: ' '
        };
        this.directionLinks = true;
        this.maxSize = 7;
        this.responsive = true;
        this.autoHide = false;
    }
    /**
     * @return {?}
     */
    get total() {
        return this._total;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set total(val) {
        this._total = val;
        // this.paginationOptions.totalItems = val;
        this.initPaginationOptions();
        // if(val){
        //   this.initPaginationOptions();
        // }
    }
    /**
     * @return {?}
     */
    get pageSize() {
        return this._pageSize;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set pageSize(val) {
        this._pageSize = val;
        // this.paginationOptions.itemsPerPage = val;
        this.initPaginationOptions();
        //if(val){
        //this.initPaginationOptions();
        //}
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set discussionData(val) {
        if (val) {
            this._discussionData = val;
            this.innerDiscussionData = val;
        }
    }
    /**
     * @return {?}
     */
    get discussionData() {
        return this._discussionData;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // this.paginationOptions = {
        //   id: 'Farris-discussion-Pagination',
        //   itemsPerPage: this.pageSize,
        //   currentPage: this.pageIndex,
        //   // pageList: this.pageList,
        //   totalItems: this.total
        // };
        this.initPaginationOptions();
        /**监听指令得到的数据 */
        this.discussionListService.getData().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data && !this._discussionData.length) {
                this.innerDiscussionData = data;
            }
        }));
    }
    /**
     * @return {?}
     */
    initPaginationOptions() {
        this.paginationOptions = {
            id: 'Farris-discussion-Pagination',
            itemsPerPage: this._pageSize,
            currentPage: this.pageIndex,
            // pageList: this.pageList,
            totalItems: this._total
        };
    }
    /**
     * 点击回复留言
     * @param {?} item
     * @return {?}
     */
    reply(item) {
        this.replyMessage.emit(item);
    }
    /**
     * 页码变化
     * @param {?} page
     * @return {?}
     */
    onPageChange(page) {
        if (this.pageIndex !== page.pageIndex) {
            this.pageIndex = page.pageIndex;
            this.paginationOptions.currentPage = page.pageIndex;
            this.pageChanged.emit({ pageInfo: page });
        }
    }
    /**
     * 每页显示条数变化
     * @param {?} pageSize
     * @return {?}
     */
    onPageSizeChange(pageSize) {
        if (this.pageSize !== pageSize && this.total) {
            this.paginationOptions.itemsPerPage = pageSize;
            this.pageSize = pageSize;
            /** @type {?} */
            const total = this.total;
            /** @type {?} */
            let pageLength = Math.floor(total / pageSize);
            if (total % pageSize > 0) {
                pageLength += 1;
            }
            if (pageLength && this.pageIndex > pageLength) {
                this.pageIndex = pageLength;
                this.paginationOptions.currentPage = this.pageIndex;
            }
            this.pageSizeChanged.emit({ pageInfo: { pageIndex: this.pageIndex, pageSize: pageSize } });
        }
    }
    /**
     * 附件预览
     * @param {?} info
     * @return {?}
     */
    filePreviewEventHandler(info) {
        this.filePreview.emit(info);
    }
    /**
     * 附件下载
     * @param {?} info
     * @return {?}
     */
    fileDownloadEventHandler(info) {
        this.fileDownload.emit(info);
    }
    /**
     * 占位头像文字
     * @param {?} item
     * @return {?}
     */
    getAvatar(item) {
        if (item && item[this.personnelsDisplayKey]) {
            /** @type {?} */
            let str = item[this.personnelsDisplayKey];
            return str.substring(str.length - 2, str.length);
        }
        else {
            return '';
        }
    }
}
DiscussionListComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-discussion-list',
                template: "<div class=\"f-discussion-group-content\">\r\n    <div class=\"f-discussion-group-content-item\" *ngFor=\"let item of (supportPaging ? (innerDiscussionData | paginate: paginationOptions) : innerDiscussionData)\">\r\n        <div class=\"discussion-item-avatar\">\r\n            <img [src]=\"item.imgData\" alt=\"\" class=\"discussion-item-avatar-img\" *ngIf=\"item.imgData\">\r\n            <div class=\"discussion-item-avatar-tip\" *ngIf=\"!item.imgData\" [innerHTML]=\"getAvatar(item)\"></div>\r\n        </div>\r\n        <div class=\"discussion-item-inner\">\r\n            <div class=\"discussion-item-username\">\r\n                {{item[personnelsDisplayKey]}}\r\n            </div>\r\n            <div class=\"discussion-item-text\">\r\n                <span class=\"discussion-item-text-message\" [innerHTML]=\"item.text | safeHtml\"></span>\r\n                <!-- <span class=\"discussion-item-text-about\" *ngIf=\"item.messageAbout\">@{{item.messageAbout}}</span> -->\r\n            </div>\r\n            <div class=\"discussion-item-text-reply\" *ngIf=\"item.parentData\">\r\n                <span class=\"discussion-item-text-reply-title\">\r\n                    {{ 'discussionGroup.reply' | locale }}\r\n                    <span class=\"discussion-item-text-reply-name\">{{item.parentData[personnelsDisplayKey]}}</span>\uFF1A\r\n                </span>\r\n                <span class=\"discussion-item-text-reply-content\" [innerHTML]=\"item.parentData.text | safeHtml\">\r\n                </span>\r\n            </div>\r\n            <!-- \u9644\u4EF6\u5217\u8868 <div class=\"discussion-item-files\" *ngIf=\"item.attachFiles && item.attachFiles.length\">\r\n                <f-file-preview class=\"d-flex flex-wrap\" [itemCls]=\"'demo-view-item'\" [fileInfos]=\"item.attachFiles\"\r\n                    (filePreviewEvent)=\"filePreviewEventHandler($event)\" (fileDownloadEvent)=\"fileDownloadEventHandler($event)\"\r\n                    #filePreview>\r\n                    <ng-template filePreviewListTypeTemplate let-data let-readonly=\"readonly\">\r\n                        <div class=\"ffilepreview--item-detail\">\r\n                            <div class=\"ffilepreview--item-icon\">\r\n                                <span class=\"ffilepreview--filetype-icon\" [ngClass]=\"filePreview.getFileTypeClassName(data.name)\"></span>\r\n                            </div>\r\n                            <div class=\"ffilepreview--item-content\">\r\n                                <a class=\"item-content--title\" [title]=\"data.name\"\r\n                                    (click)=\"filePreview.filePreviewHandler($event,data)\">{{data.name}}</a>\r\n                                <div class=\"item-content--toolbar f-text-light\">\r\n                                    <button class=\"btn btn-link\" (click)=\"filePreview.filePreviewHandler($event,data)\">\r\n                                    <span class=\"f-icon f-icon-preview\"></span>\u9884\u89C8\r\n                                    </button>\r\n                                    <button class=\"btn btn-link\" (click)=\"filePreview.fileDownloadHandler($event,data)\">\r\n                                    <span class=\"f-icon f-icon-download\"></span>\u4E0B\u8F7D\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </ng-template>\r\n                </f-file-preview>\r\n            </div> -->\r\n            <div class=\"discussion-item-footer\">\r\n                <div class=\"discussion-item-time\">\r\n                    <span class=\"discussion-item-time-text\">{{item.commentDate | date:'yyyy-MM-dd HH:mm'}}</span>\r\n                </div>\r\n                <div class=\"discussion-item-btns\">\r\n                    <span class=\"discussion-item-btns-start\" (click)=\"reply(item)\">\r\n                        <span class=\"f-icon f-icon-message\"></span>\r\n                        <span class=\"discussion-item-btns-start-text\">\r\n                            {{ 'discussionGroup.reply' | locale }}\r\n                        </span>\r\n                    </span>\r\n                    <!-- <span class=\"discussion-item-btns-new\">\r\n                        <span class=\"f-icon f-icon-star-outline\"></span>\r\n                    </span> -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"f-discussion-group-footer\" *ngIf=\"supportPaging\">\r\n        <pagination-controls #pager \r\n            [id]=\"paginationOptions.id\" \r\n            [maxSize]=\"maxSize\" \r\n            [directionLinks]=\"directionLinks\"\r\n            [autoHide]=\"autoHide\" \r\n            [responsive]=\"responsive\" \r\n            [previousLabel]=\"labels.previousLabel\"\r\n            [nextLabel]=\"labels.nextLabel\"\r\n            (pageChange)=\"onPageChange($event)\"\r\n            (pageSizeChange)=\"onPageSizeChange($event)\"\r\n            [showPageList]=\"false\"\r\n        >\r\n        </pagination-controls>\r\n    </div>\r\n</div>",
                encapsulation: ViewEncapsulation.None,
                styles: [".f-discussion-group-content-item{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;margin-bottom:14px}.f-discussion-group-content-item .discussion-item-avatar{width:32px;height:32px;margin-right:10px;overflow:hidden;cursor:pointer;flex-shrink:0}.f-discussion-group-content-item .discussion-item-avatar-img{display:block;width:32px;height:32px;border-radius:50%}.f-discussion-group-content-item .discussion-item-avatar-tip{width:32px;height:32px;font-size:12px;color:#fff;text-align:center;line-height:32px;border-radius:50%;background-color:#4796ff}.f-discussion-group-content-item .discussion-item-inner{flex-shrink:1;-webkit-box-flex:1;flex-grow:1;flex-basis:0;padding-bottom:14px;border-bottom:1px solid #e3e3e3;overflow:hidden}.f-discussion-group-content-item .discussion-item-inner .discussion-item-username{margin-bottom:4px;font-size:16px;color:rgba(0,0,0,.85)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text{font-size:14px;color:rgba(0,0,0,.75)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text .discussion-item-text-message{word-break:break-all}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text .discussion-item-text-message a{color:#3487e3!important}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply{margin-top:11px;padding:6px 8px;font-size:0;background:#f5f5f5;border-radius:2px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-content,.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-title{font-size:14px;color:rgba(0,0,0,.75);line-height:20px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-title .discussion-item-text-reply-name{color:#3487e3}.f-discussion-group-content-item .discussion-item-inner .discussion-item-text-reply-content{word-break:break-all}.f-discussion-group-content-item .discussion-item-inner .discussion-item-files{margin-top:11px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-files .ffilepreview--filetype-icon{width:40px;height:40px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer{margin-top:10px;padding-right:20px;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-time{font-size:14px;color:#b1b6c2}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;position:relative;cursor:pointer}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .f-icon{color:rgba(0,0,0,.45);font-size:16px}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .f-icon::before{vertical-align:bottom}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start .discussion-item-btns-start-text{margin-left:14px;font-size:14px;color:rgba(0,0,0,.45)}.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start:hover .discussion-item-btns-start-text,.f-discussion-group-content-item .discussion-item-inner .discussion-item-footer .discussion-item-btns .discussion-item-btns-start:hover .f-icon{color:#3487e3}.f-discussion-group-content-item:last-child .discussion-item-inner{border-bottom:none}"]
            }] }
];
/** @nocollapse */
DiscussionListComponent.ctorParameters = () => [
    { type: DiscussionListService }
];
DiscussionListComponent.propDecorators = {
    personnelsDisplayKey: [{ type: Input }],
    supportPaging: [{ type: Input }],
    pageIndex: [{ type: Input }],
    total: [{ type: Input }],
    pageSize: [{ type: Input }],
    discussionData: [{ type: Input }],
    replyMessage: [{ type: Output }],
    pageChanged: [{ type: Output }],
    pageSizeChanged: [{ type: Output }],
    filePreview: [{ type: Output }],
    fileDownload: [{ type: Output }],
    pager: [{ type: ViewChild, args: ['pager',] }]
};
if (false) {
    /** @type {?} */
    DiscussionListComponent.prototype.personnelsDisplayKey;
    /**
     * 是否支持分页
     * @type {?}
     */
    DiscussionListComponent.prototype.supportPaging;
    /**
     * 当前页码
     * @type {?}
     */
    DiscussionListComponent.prototype.pageIndex;
    /**
     * 总条数
     * @type {?}
     * @private
     */
    DiscussionListComponent.prototype._total;
    /**
     * 每页显示个数
     * @type {?}
     * @private
     */
    DiscussionListComponent.prototype._pageSize;
    /**
     * 评论数据
     * @type {?}
     */
    DiscussionListComponent.prototype.innerDiscussionData;
    /** @type {?} */
    DiscussionListComponent.prototype._discussionData;
    /** @type {?} */
    DiscussionListComponent.prototype.replyMessage;
    /** @type {?} */
    DiscussionListComponent.prototype.pageChanged;
    /** @type {?} */
    DiscussionListComponent.prototype.pageSizeChanged;
    /**
     * 附件预览
     * @type {?}
     */
    DiscussionListComponent.prototype.filePreview;
    /**
     * 附件下载
     * @type {?}
     */
    DiscussionListComponent.prototype.fileDownload;
    /** @type {?} */
    DiscussionListComponent.prototype.labels;
    /** @type {?} */
    DiscussionListComponent.prototype.directionLinks;
    /** @type {?} */
    DiscussionListComponent.prototype.maxSize;
    /** @type {?} */
    DiscussionListComponent.prototype.responsive;
    /** @type {?} */
    DiscussionListComponent.prototype.autoHide;
    /** @type {?} */
    DiscussionListComponent.prototype.paginationOptions;
    /** @type {?} */
    DiscussionListComponent.prototype.pager;
    /**
     * @type {?}
     * @private
     */
    DiscussionListComponent.prototype.discussionListService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzY3Vzc2lvbi1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGlzY3Vzc2lvbi1ncm91cC8iLCJzb3VyY2VzIjpbImxpYi9kaXNjdXNzaW9uLWxpc3QvZGlzY3Vzc2lvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0csT0FBTyxFQUFFLDJCQUEyQixFQUFzQixNQUFNLHVCQUF1QixDQUFDO0FBQ3hGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBUWxFLE1BQU0sT0FBTyx1QkFBdUI7Ozs7SUE2RmhDLFlBQXFCLHFCQUEyQztRQUEzQywwQkFBcUIsR0FBckIscUJBQXFCLENBQXNCOztRQTNGdkQseUJBQW9CLEdBQVcsVUFBVSxDQUFDOzs7O1FBRzFDLGtCQUFhLEdBQVcsSUFBSSxDQUFDOzs7Ozs7UUFJN0IsY0FBUyxHQUFVLENBQUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7O1FBYXRCLFdBQU0sR0FBRyxDQUFDLENBQUM7Ozs7UUFhWCxjQUFTLEdBQUcsRUFBRSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztRQTBCdkIsd0JBQW1CLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLG9CQUFlLEdBQUcsRUFBRSxDQUFDO1FBV1gsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztRQUVsQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOzs7O1FBR3JDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7OztRQUVqQyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDckMsV0FBTSxHQUFRO1lBQ2pCLGFBQWEsRUFB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RztZQUNBLE9BQU8sRUFBRSxDQUFDO1NBQ2I7SUFDSCxDQUFDOzs7WUE5S0osU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSx3QkFBd0I7Z0JBQ2xDLHloS0FBOEM7Z0JBRTlDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOzthQUN0Qzs7OztZQVBRLHFCQUFxQjs7O21DQVV6QixLQUFLOzRCQUdMLEtBQUs7d0JBSUwsS0FBSztvQkFpQkwsS0FBSzt1QkFhTCxLQUFLOzZCQXdCTCxLQUFLOzJCQVVMLE1BQU07MEJBRU4sTUFBTTs4QkFDTixNQUFNOzBCQUdOLE1BQU07MkJBRU4sTUFBTTtvQkFVTixTQUFTLFNBQUMsT0FBTzs7OztJQXpGbEIsdURBQW1EOzs7OztJQUduRCxnREFBc0M7Ozs7O0lBSXRDLDRDQUE4Qjs7Ozs7O0lBYTlCLHlDQUFtQjs7Ozs7O0lBYW5CLDRDQUF1Qjs7Ozs7SUEwQnZCLHNEQUF5Qjs7SUFDekIsa0RBQXFCOztJQVdyQiwrQ0FBNEM7O0lBRTVDLDhDQUEyQzs7SUFDM0Msa0RBQStDOzs7OztJQUcvQyw4Q0FBMkM7Ozs7O0lBRTNDLCtDQUE0Qzs7SUFDNUMseUNBR0U7O0lBQ0YsaURBQTZCOztJQUM3QiwwQ0FBbUI7O0lBQ25CLDZDQUF5Qjs7SUFDekIsMkNBQXdCOztJQUN4QixvREFBc0M7O0lBQ3RDLHdDQUF1RDs7Ozs7SUFFMUMsd0RBQW1EIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBQYWdpbmF0aW9uQ29udHJvbHNDb21wb25lbnQsIFBhZ2luYXRpb25JbnN0YW5jZSB9IGZyb20gJ0BmYXJyaXMvdWktcGFnaW5hdGlvbic7XHJcbmltcG9ydCB7IERpc2N1c3Npb25MaXN0U2VydmljZSB9IGZyb20gJy4vZGlzY3Vzc2lvbi1saXN0LnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdmYXJyaXMtZGlzY3Vzc2lvbi1saXN0JyxcclxuICB0ZW1wbGF0ZVVybDonLi9kaXNjdXNzaW9uLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczpbJy4vZGlzY3Vzc2lvbi1saXN0LmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGlzY3Vzc2lvbkxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLy8gQElucHV0KCkgcGVyc29ubmVsc1ByaW1hcnlLZXk6IHN0cmluZyA9ICd1c2VySWQnO1xyXG4gICAgQElucHV0KCkgcGVyc29ubmVsc0Rpc3BsYXlLZXk6IHN0cmluZyA9ICd1c2VyTmFtZSc7XHJcblxyXG4gICAgLyoq5piv5ZCm5pSv5oyB5YiG6aG1ICovXHJcbiAgICBASW5wdXQoKSBzdXBwb3J0UGFnaW5nOmJvb2xlYW4gPSB0cnVlO1xyXG4gICAgLyoq5oC76aG15pWwICovXHJcbiAgICAvLyBASW5wdXQoKSBwYWdlU2l6ZTpudW1iZXI7XHJcbiAgICAvKirlvZPliY3pobXnoIEgKi9cclxuICAgIEBJbnB1dCgpIHBhZ2VJbmRleDpudW1iZXIgPSAxO1xyXG4gICAgLyoq5q+P6aG15pi+56S65p2h5pWw6YCJ6aG5ICovXHJcbiAgICAvLyBwcml2YXRlIF9wYWdlTGlzdCA9IFsxMCwyMCwzMCw1MF07XHJcbiAgICAvLyBnZXQgcGFnZUxpc3QoKSB7XHJcbiAgICAvLyAgICAgcmV0dXJuIHRoaXMuX3BhZ2VMaXN0O1xyXG4gICAgLy8gfVxyXG4gICAgLy8gQElucHV0KCkgc2V0IHBhZ2VMaXN0KHZhbCkge1xyXG4gICAgLy8gICAgIHRoaXMuX3BhZ2VMaXN0ID0gdmFsO1xyXG4gICAgLy8gICAgIGlmICh0aGlzLnBhZ2VyKSB7XHJcbiAgICAvLyAgICAgICAgIHRoaXMucGFnZXIuc2V0UGFnZUxpc3QodmFsKTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyB9XHJcbiAgICAvKirmgLvmnaHmlbAgKi9cclxuICAgIHByaXZhdGUgX3RvdGFsID0gMDtcclxuICAgIGdldCB0b3RhbCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdG90YWw7XHJcbiAgICB9XHJcbiAgICBASW5wdXQoKSBzZXQgdG90YWwodmFsKSB7XHJcbiAgICAgIHRoaXMuX3RvdGFsID0gdmFsO1xyXG4gICAgICAvLyB0aGlzLnBhZ2luYXRpb25PcHRpb25zLnRvdGFsSXRlbXMgPSB2YWw7XHJcbiAgICAgIHRoaXMuaW5pdFBhZ2luYXRpb25PcHRpb25zKCk7XHJcbiAgICAgIC8vIGlmKHZhbCl7XHJcbiAgICAgIC8vICAgdGhpcy5pbml0UGFnaW5hdGlvbk9wdGlvbnMoKTtcclxuICAgICAgLy8gfVxyXG4gICAgfVxyXG4gICAgLyoq5q+P6aG15pi+56S65Liq5pWwICovXHJcbiAgICBwcml2YXRlIF9wYWdlU2l6ZSA9IDEwO1xyXG4gICAgZ2V0IHBhZ2VTaXplKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYWdlU2l6ZTtcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIHNldCBwYWdlU2l6ZSh2YWwpIHtcclxuICAgICAgdGhpcy5fcGFnZVNpemUgPSB2YWw7XHJcbiAgICAgIC8vIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuaXRlbXNQZXJQYWdlID0gdmFsO1xyXG4gICAgICB0aGlzLmluaXRQYWdpbmF0aW9uT3B0aW9ucygpO1xyXG4gICAgICAvL2lmKHZhbCl7XHJcbiAgICAgICAgLy90aGlzLmluaXRQYWdpbmF0aW9uT3B0aW9ucygpO1xyXG4gICAgICAvL31cclxuICAgIH1cclxuICAgIC8qKuW9k+WJjemhteaVsCAqL1xyXG4gICAgLy8gcHJpdmF0ZSBfcGFnZUluZGV4ID0gMTtcclxuICAgIC8vIGdldCBwYWdlSW5kZXgoKSB7XHJcbiAgICAvLyAgICAgcmV0dXJuIHRoaXMuX3BhZ2VJbmRleDtcclxuICAgIC8vIH1cclxuICAgIC8vIEBJbnB1dCgpIHNldCBwYWdlSW5kZXgodmFsKSB7XHJcbiAgICAvLyAgIGlmKHZhbCl7XHJcbiAgICAvLyAgICAgdGhpcy5fcGFnZUluZGV4ID0gdmFsO1xyXG4gICAgLy8gICAgIHRoaXMuaW5pdFBhZ2luYXRpb25PcHRpb25zKCk7XHJcbiAgICAvLyAgIH1cclxuICAgIC8vIH1cclxuICAgIC8qKuaAu+adoeaVsCAqL1xyXG4gICAgLy8gQElucHV0KCkgdG90YWwgPSAwO1xyXG4gICAgLyoq6K+E6K665pWw5o2uICovXHJcbiAgICBpbm5lckRpc2N1c3Npb25EYXRhID0gW107XHJcbiAgICBfZGlzY3Vzc2lvbkRhdGEgPSBbXTtcclxuICAgIEBJbnB1dCgpIFxyXG4gICAgc2V0IGRpc2N1c3Npb25EYXRhKHZhbCkge1xyXG4gICAgICBpZih2YWwpe1xyXG4gICAgICAgIHRoaXMuX2Rpc2N1c3Npb25EYXRhID0gdmFsO1xyXG4gICAgICAgIHRoaXMuaW5uZXJEaXNjdXNzaW9uRGF0YSA9IHZhbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IGRpc2N1c3Npb25EYXRhKCl7XHJcbiAgICAgIHJldHVybiB0aGlzLl9kaXNjdXNzaW9uRGF0YTtcclxuICAgIH1cclxuICAgIEBPdXRwdXQoKSByZXBseU1lc3NhZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvLyDliIbpobXkuovku7ZcclxuICAgIEBPdXRwdXQoKSBwYWdlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBwYWdlU2l6ZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgLyoq6ZmE5Lu26aKE6KeIICovXHJcbiAgICBAT3V0cHV0KCkgZmlsZVByZXZpZXcgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKirpmYTku7bkuIvovb0gKi9cclxuICAgIEBPdXRwdXQoKSBmaWxlRG93bmxvYWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBwdWJsaWMgbGFiZWxzOiBhbnkgPSB7XHJcbiAgICAgICAgcHJldmlvdXNMYWJlbDogJyAnLFxyXG4gICAgICAgIG5leHRMYWJlbDogJyAnXHJcbiAgICB9O1xyXG4gICAgcHVibGljIGRpcmVjdGlvbkxpbmtzID0gdHJ1ZTtcclxuICAgIHB1YmxpYyBtYXhTaXplID0gNztcclxuICAgIHB1YmxpYyByZXNwb25zaXZlID0gdHJ1ZTtcclxuICAgIHB1YmxpYyBhdXRvSGlkZSA9IGZhbHNlO1xyXG4gICAgcGFnaW5hdGlvbk9wdGlvbnM6IFBhZ2luYXRpb25JbnN0YW5jZTtcclxuICAgIEBWaWV3Q2hpbGQoJ3BhZ2VyJykgcGFnZXI6IFBhZ2luYXRpb25Db250cm9sc0NvbXBvbmVudDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvciggcHJpdmF0ZSBkaXNjdXNzaW9uTGlzdFNlcnZpY2U6RGlzY3Vzc2lvbkxpc3RTZXJ2aWNlICkgeyB9XHJcbiAgICBuZ09uSW5pdCgpe1xyXG4gICAgICAvLyB0aGlzLnBhZ2luYXRpb25PcHRpb25zID0ge1xyXG4gICAgICAvLyAgIGlkOiAnRmFycmlzLWRpc2N1c3Npb24tUGFnaW5hdGlvbicsXHJcbiAgICAgIC8vICAgaXRlbXNQZXJQYWdlOiB0aGlzLnBhZ2VTaXplLFxyXG4gICAgICAvLyAgIGN1cnJlbnRQYWdlOiB0aGlzLnBhZ2VJbmRleCxcclxuICAgICAgLy8gICAvLyBwYWdlTGlzdDogdGhpcy5wYWdlTGlzdCxcclxuICAgICAgLy8gICB0b3RhbEl0ZW1zOiB0aGlzLnRvdGFsXHJcbiAgICAgIC8vIH07XHJcbiAgICAgIHRoaXMuaW5pdFBhZ2luYXRpb25PcHRpb25zKCk7XHJcbiAgICAgIC8qKuebkeWQrOaMh+S7pOW+l+WIsOeahOaVsOaNriAqL1xyXG4gICAgICB0aGlzLmRpc2N1c3Npb25MaXN0U2VydmljZS5nZXREYXRhKCkuc3Vic2NyaWJlKChkYXRhOmFueSk6IHZvaWQgPT4ge1xyXG4gICAgICAgIGlmKGRhdGEgJiYgIXRoaXMuX2Rpc2N1c3Npb25EYXRhLmxlbmd0aCl7XHJcbiAgICAgICAgICB0aGlzLmlubmVyRGlzY3Vzc2lvbkRhdGEgPSBkYXRhO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpbml0UGFnaW5hdGlvbk9wdGlvbnMoKXtcclxuICAgICAgdGhpcy5wYWdpbmF0aW9uT3B0aW9ucyA9IHtcclxuICAgICAgICBpZDogJ0ZhcnJpcy1kaXNjdXNzaW9uLVBhZ2luYXRpb24nLFxyXG4gICAgICAgIGl0ZW1zUGVyUGFnZTogdGhpcy5fcGFnZVNpemUsXHJcbiAgICAgICAgY3VycmVudFBhZ2U6IHRoaXMucGFnZUluZGV4LFxyXG4gICAgICAgIC8vIHBhZ2VMaXN0OiB0aGlzLnBhZ2VMaXN0LFxyXG4gICAgICAgIHRvdGFsSXRlbXM6IHRoaXMuX3RvdGFsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKirngrnlh7vlm57lpI3nlZnoqIAgKi9cclxuICAgIHJlcGx5KGl0ZW0pe1xyXG4gICAgICB0aGlzLnJlcGx5TWVzc2FnZS5lbWl0KGl0ZW0pO1xyXG4gICAgfVxyXG4gICAgLyoq6aG156CB5Y+Y5YyWICovXHJcbiAgICBvblBhZ2VDaGFuZ2UocGFnZTogeyBwYWdlSW5kZXg6IG51bWJlciwgcGFnZVNpemU6IG51bWJlciB9KSB7XHJcbiAgICAgIGlmICh0aGlzLnBhZ2VJbmRleCAhPT0gcGFnZS5wYWdlSW5kZXgpIHtcclxuICAgICAgICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZS5wYWdlSW5kZXg7XHJcbiAgICAgICAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLmN1cnJlbnRQYWdlID0gcGFnZS5wYWdlSW5kZXg7XHJcbiAgICAgICAgICB0aGlzLnBhZ2VDaGFuZ2VkLmVtaXQoeyBwYWdlSW5mbzogcGFnZSB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoq5q+P6aG15pi+56S65p2h5pWw5Y+Y5YyWICovXHJcbiAgICBvblBhZ2VTaXplQ2hhbmdlKHBhZ2VTaXplOiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5wYWdlU2l6ZSAhPT0gcGFnZVNpemUgJiYgdGhpcy50b3RhbCkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLml0ZW1zUGVyUGFnZSA9IHBhZ2VTaXplO1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2VTaXplID0gcGFnZVNpemU7XHJcbiAgXHJcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gdGhpcy50b3RhbDtcclxuICAgICAgICAgICAgbGV0IHBhZ2VMZW5ndGggPSBNYXRoLmZsb29yKHRvdGFsIC8gcGFnZVNpemUpO1xyXG4gICAgICAgICAgICBpZiAodG90YWwgJSBwYWdlU2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgIHBhZ2VMZW5ndGggKz0gMTtcclxuICAgICAgICAgICAgfVxyXG4gIFxyXG4gICAgICAgICAgICBpZiAocGFnZUxlbmd0aCAmJiB0aGlzLnBhZ2VJbmRleCA+IHBhZ2VMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuY3VycmVudFBhZ2UgPSB0aGlzLnBhZ2VJbmRleDtcclxuICAgICAgICAgICAgfVxyXG4gIFxyXG4gICAgICAgICAgICB0aGlzLnBhZ2VTaXplQ2hhbmdlZC5lbWl0KHsgcGFnZUluZm86IHsgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwgcGFnZVNpemU6IHBhZ2VTaXplIH0gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoq6ZmE5Lu26aKE6KeIICovXHJcbiAgICBmaWxlUHJldmlld0V2ZW50SGFuZGxlcihpbmZvKSB7XHJcbiAgICAgIHRoaXMuZmlsZVByZXZpZXcuZW1pdChpbmZvKTtcclxuICAgIH1cclxuICAgIC8qKumZhOS7tuS4i+i9vSAqL1xyXG4gICAgZmlsZURvd25sb2FkRXZlbnRIYW5kbGVyKGluZm8pIHtcclxuICAgICAgdGhpcy5maWxlRG93bmxvYWQuZW1pdChpbmZvKTtcclxuICAgIH1cclxuICAgIC8qKuWNoOS9jeWktOWDj+aWh+WtlyAqL1xyXG4gICAgZ2V0QXZhdGFyKGl0ZW0pe1xyXG4gICAgICBpZihpdGVtICYmIGl0ZW1bdGhpcy5wZXJzb25uZWxzRGlzcGxheUtleV0pe1xyXG4gICAgICAgIGxldCBzdHIgPSBpdGVtW3RoaXMucGVyc29ubmVsc0Rpc3BsYXlLZXldO1xyXG4gICAgICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKHN0ci5sZW5ndGgtMixzdHIubGVuZ3RoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNle1xyXG4gICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgXHJcbn0iXX0=