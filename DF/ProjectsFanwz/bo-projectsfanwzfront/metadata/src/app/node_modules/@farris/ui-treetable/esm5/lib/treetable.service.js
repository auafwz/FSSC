/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
var TreetableService = /** @class */ (function () {
    function TreetableService() {
        this.selectionSource = new Subject();
        this.dblClickSource = new Subject();
        this.changeCheckboxStatus = new Subject();
        this.removeNode = new Subject();
        this.insertNode = new Subject();
        this.updateNode = new Subject();
        this.selectionSource$ = this.selectionSource.asObservable();
        this.dblClickSource$ = this.dblClickSource.asObservable();
        this.changeCheckboxStatus$ = this.changeCheckboxStatus.asObservable();
        this.insertNode$ = this.insertNode.asObservable();
        this.removeNode$ = this.removeNode.asObservable();
        this.updateNode$ = this.updateNode.asObservable();
    }
    /**
     * @param {?=} selected
     * @return {?}
     */
    TreetableService.prototype.onSelectionChange = /**
     * @param {?=} selected
     * @return {?}
     */
    function (selected) {
        this.selectionSource.next(selected);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onDblClick = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.dblClickSource.next(rowNode);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onChangeCheckboxStatus = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.changeCheckboxStatus.next(rowNode);
    };
    /**
     * @param {?} treeNode
     * @param {?=} parent
     * @return {?}
     */
    TreetableService.prototype.onInsert = /**
     * @param {?} treeNode
     * @param {?=} parent
     * @return {?}
     */
    function (treeNode, parent) {
        this.insertNode.next(treeNode);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onRemove = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.removeNode.next(rowNode);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onUpdate = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.updateNode.next(rowNode);
    };
    /**
     * @param {?} col
     * @param {?} tt
     * @return {?}
     */
    TreetableService.prototype.columnIsVisible = /**
     * @param {?} col
     * @param {?} tt
     * @return {?}
     */
    function (col, tt) {
        if (col.visible === undefined) {
            return true;
        }
        if (typeof col.visible === 'function') {
            return col.visible(tt);
        }
        return col.visible;
    };
    /**
     * @param {?} columns
     * @param {?} tt
     * @return {?}
     */
    TreetableService.prototype.checkColumnsForGroupHeader = /**
     * @param {?} columns
     * @param {?} tt
     * @return {?}
     */
    function (columns, tt) {
        /** @type {?} */
        var _columns = [];
        if (columns && columns.length) {
            _columns = this.getDataColumns(columns);
        }
        return {
            columns: _columns
        };
    };
    /**
     * @private
     * @param {?} cols
     * @param {?} length
     * @return {?}
     */
    TreetableService.prototype.getDataFields = /**
     * @private
     * @param {?} cols
     * @param {?} length
     * @return {?}
     */
    function (cols, length) {
        /** @type {?} */
        var i = 0;
        /** @type {?} */
        var j = 0;
        cols.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var colspan = n.colspan || 1;
            if (i + colspan <= length) {
                i += colspan;
                j++;
            }
        }));
        return cols.splice(0, j);
    };
    /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    TreetableService.prototype.getDataColumns = /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    function (cols) {
        var _this = this;
        if (!cols || !cols.length) {
            return [];
        }
        /** @type {?} */
        var fields = [];
        var _loop_1 = function (i) {
            /** @type {?} */
            var _cols = cols[i];
            if (cols[i] && !cols[i].length) {
                _cols = tslib_1.__spread(fields);
                fields = [];
            }
            _cols.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                if (!n.field && n.colspan && n.colspan > 1) {
                    _this.getDataFields(cols[i + 1], n.colspan).forEach((/**
                     * @param {?} d
                     * @return {?}
                     */
                    function (d) {
                        if (!fields.includes((/**
                         * @param {?} f
                         * @return {?}
                         */
                        function (f) { return f.field === d.field; }))) {
                            fields.push(d);
                        }
                    }));
                }
                else {
                    if (!fields.includes((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f.field === n.field; }))) {
                        fields.push(n);
                    }
                }
            }));
        };
        for (var i = 0; i < cols.length; i++) {
            _loop_1(i);
        }
        return fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return !n.colspan || n.colspan === 1; }));
    };
    TreetableService.decorators = [
        { type: Injectable }
    ];
    return TreetableService;
}());
export { TreetableService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.selectionSource;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.dblClickSource;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.changeCheckboxStatus;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.removeNode;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.insertNode;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.updateNode;
    /** @type {?} */
    TreetableService.prototype.selectionSource$;
    /** @type {?} */
    TreetableService.prototype.dblClickSource$;
    /** @type {?} */
    TreetableService.prototype.changeCheckboxStatus$;
    /** @type {?} */
    TreetableService.prototype.insertNode$;
    /** @type {?} */
    TreetableService.prototype.removeNode$;
    /** @type {?} */
    TreetableService.prototype.updateNode$;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZXRhYmxlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXRyZWV0YWJsZS8iLCJzb3VyY2VzIjpbImxpYi90cmVldGFibGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUszQztJQUFBO1FBR1ksb0JBQWUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ2hDLG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUMvQix5QkFBb0IsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBQzlDLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBQ3BDLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBWSxDQUFDO1FBQ3JDLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBRzVDLHFCQUFnQixHQUFvQixJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3hFLG9CQUFlLEdBQW9CLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDdEUsMEJBQXFCLEdBQXdCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN0RixnQkFBVyxHQUF5QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ25FLGdCQUFXLEdBQXdCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDbEUsZ0JBQVcsR0FBd0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQTJGdEUsQ0FBQzs7Ozs7SUF6RkcsNENBQWlCOzs7O0lBQWpCLFVBQWtCLFFBQXFCO1FBQ25DLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7Ozs7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SUFDdEUsaURBQXNGOztJQUN0Rix1Q0FBbUU7O0lBQ25FLHVDQUFrRTs7SUFDbEUsdUNBQWtFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGZsYXR0ZW4gfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBSb3dOb2RlLCBUcmVlTm9kZSB9IGZyb20gJy4vdHlwZXMvdHJlZW5vZGUnO1xyXG5pbXBvcnQgeyBUcmVlVGFibGVDb2x1bW4gfSBmcm9tICcuL3R5cGVzL3RyZWV0YWJsZS1jb2x1bW4nO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgVHJlZXRhYmxlU2VydmljZSB7XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3Rpb25Tb3VyY2UgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBkYmxDbGlja1NvdXJjZSA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIGNoYW5nZUNoZWNrYm94U3RhdHVzID0gbmV3IFN1YmplY3Q8Um93Tm9kZT4oKTtcclxuICAgIHByaXZhdGUgcmVtb3ZlTm9kZSA9IG5ldyBTdWJqZWN0PFJvd05vZGU+KCk7XHJcbiAgICBwcml2YXRlIGluc2VydE5vZGUgPSBuZXcgU3ViamVjdDxUcmVlTm9kZT4oKTtcclxuICAgIHByaXZhdGUgdXBkYXRlTm9kZSA9IG5ldyBTdWJqZWN0PFJvd05vZGU+KCk7XHJcblxyXG5cclxuICAgIHNlbGVjdGlvblNvdXJjZSQ6IE9ic2VydmFibGU8YW55PiA9IHRoaXMuc2VsZWN0aW9uU291cmNlLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgZGJsQ2xpY2tTb3VyY2UkOiBPYnNlcnZhYmxlPGFueT4gPSB0aGlzLmRibENsaWNrU291cmNlLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY2hhbmdlQ2hlY2tib3hTdGF0dXMkOiBPYnNlcnZhYmxlPFJvd05vZGU+ID0gdGhpcy5jaGFuZ2VDaGVja2JveFN0YXR1cy5hc09ic2VydmFibGUoKTtcclxuICAgIGluc2VydE5vZGUkOiBPYnNlcnZhYmxlPFRyZWVOb2RlPiA9IHRoaXMuaW5zZXJ0Tm9kZS5hc09ic2VydmFibGUoKTtcclxuICAgIHJlbW92ZU5vZGUkOiBPYnNlcnZhYmxlPFJvd05vZGU+ID0gdGhpcy5yZW1vdmVOb2RlLmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgdXBkYXRlTm9kZSQ6IE9ic2VydmFibGU8Um93Tm9kZT4gPSB0aGlzLnVwZGF0ZU5vZGUuYXNPYnNlcnZhYmxlKCk7XHJcblxyXG4gICAgb25TZWxlY3Rpb25DaGFuZ2Uoc2VsZWN0ZWQ/OiBUcmVlTm9kZVtdKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25Tb3VyY2UubmV4dChzZWxlY3RlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25EYmxDbGljayhyb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgdGhpcy5kYmxDbGlja1NvdXJjZS5uZXh0KHJvd05vZGUpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hhbmdlQ2hlY2tib3hTdGF0dXMocm93Tm9kZTogUm93Tm9kZSkge1xyXG4gICAgICAgIHRoaXMuY2hhbmdlQ2hlY2tib3hTdGF0dXMubmV4dChyb3dOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkluc2VydCh0cmVlTm9kZTogVHJlZU5vZGUsIHBhcmVudD86IFRyZWVOb2RlKSB7XHJcbiAgICAgICAgdGhpcy5pbnNlcnROb2RlLm5leHQodHJlZU5vZGUpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUmVtb3ZlKHJvd05vZGU6IFJvd05vZGUpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZU5vZGUubmV4dChyb3dOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBvblVwZGF0ZShyb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVOb2RlLm5leHQocm93Tm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29sdW1uSXNWaXNpYmxlKGNvbCwgdHQpIHtcclxuICAgICAgICBpZiAoY29sLnZpc2libGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjb2wudmlzaWJsZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm4gY29sLnZpc2libGUodHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbC52aXNpYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrQ29sdW1uc0Zvckdyb3VwSGVhZGVyKGNvbHVtbnM6IGFueSwgdHQ6IGFueSkge1xyXG4gICAgICAgIGxldCBfY29sdW1ucyA9IFtdO1xyXG4gICAgICAgIGlmIChjb2x1bW5zICYmIGNvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIF9jb2x1bW5zID0gdGhpcy5nZXREYXRhQ29sdW1ucyhjb2x1bW5zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY29sdW1uczogX2NvbHVtbnNcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldERhdGFGaWVsZHMoY29scywgbGVuZ3RoKSB7XHJcbiAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgIGxldCBqID0gMDtcclxuICAgICAgICBjb2xzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHNwYW4gPSBuLmNvbHNwYW4gfHwgMTtcclxuICAgICAgICAgICAgaWYgKGkgKyBjb2xzcGFuIDw9IGxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaSArPSBjb2xzcGFuO1xyXG4gICAgICAgICAgICAgICAgaisrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGNvbHMuc3BsaWNlKDAsIGopO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldERhdGFDb2x1bW5zKGNvbHMpIHtcclxuICAgICAgICBpZiAoIWNvbHMgfHwgIWNvbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBmaWVsZHMgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IF9jb2xzID0gY29sc1tpXTtcclxuICAgICAgICAgICAgaWYgKGNvbHNbaV0gJiYgIWNvbHNbaV0ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBfY29scyA9IFsuLi5maWVsZHNdO1xyXG4gICAgICAgICAgICAgICAgZmllbGRzID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX2NvbHMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghbi5maWVsZCAmJiBuLmNvbHNwYW4gJiYgbi5jb2xzcGFuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0RGF0YUZpZWxkcyhjb2xzW2kgKyAxXSwgbi5jb2xzcGFuKS5mb3JFYWNoKGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpZWxkcy5pbmNsdWRlcyhmID0+IGYuZmllbGQgPT09IGQuZmllbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpZWxkcy5pbmNsdWRlcyhmID0+IGYuZmllbGQgPT09IG4uZmllbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmaWVsZHMuZmlsdGVyKG4gPT4gIW4uY29sc3BhbiB8fCBuLmNvbHNwYW4gPT09IDEpO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=