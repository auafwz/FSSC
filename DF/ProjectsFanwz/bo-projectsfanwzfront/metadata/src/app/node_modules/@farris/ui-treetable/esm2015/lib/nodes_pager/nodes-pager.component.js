/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { TreeTableComponent } from './../treetable.component';
import { Component, Input, Injector, ChangeDetectorRef, EventEmitter, Output } from '@angular/core';
import { filter } from 'rxjs/operators';
import { BehaviorSubject } from 'rxjs';
export class TreetableNodesPagerComponent {
    /**
     * @param {?} tt
     * @param {?} cd
     * @param {?} injector
     */
    constructor(tt, cd, injector) {
        this.tt = tt;
        this.cd = cd;
        this.injector = injector;
        this.pageChange = new EventEmitter();
        this.showPager = new BehaviorSubject(false);
        this.pagerInfo = null;
        if (this.tt) {
            this.tt.expand.pipe(filter((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                return node.id === this.context.node.id && node.pagination && node.children.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => !n.__childs_loading__)).length;
            }))).subscribe((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                this.pagerInfo = Object.assign({}, node.pagination);
                this.showPager.next(true);
            }));
            this.tt.appendNew.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                /** @type {?} */
                const node = e.parent;
                if (node.id === this.context.node.id && node.pagination) {
                    this.pagerInfo = Object.assign({}, node.pagination);
                    this.showPager.next(true);
                }
            }));
            this.tt.collapse.subscribe((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                if (node.id === this.context.node.id) {
                    this.showPager.next(false);
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.setPagerInfo();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.context && !changes.context.isFirstChange()) {
            this.setPagerInfo();
        }
    }
    /**
     * @private
     * @return {?}
     */
    setPagerInfo() {
        if (this.context) {
            const { node } = this.context;
            if (node && node.pagination) {
                this.pagerInfo = Object.assign({}, node.pagination);
                this.showPager.next(node.expanded && node.pagination);
            }
        }
    }
    /**
     * @return {?}
     */
    getPagerCount() {
        const { pageSize, total } = this.pagerInfo;
        if (!total) {
            return 0;
        }
        else {
            return Math.ceil(total / pageSize);
        }
    }
    /**
     * @return {?}
     */
    isFirstPager() {
        return this.pagerInfo.pageIndex === 1;
    }
    /**
     * @return {?}
     */
    isLastPager() {
        return this.pagerInfo.pageIndex === this.getPagerCount();
    }
    /**
     * Go to the previous page
     * @param {?} $event
     * @return {?}
     */
    previous($event) {
        $event.stopPropagation();
        this.setCurrent(this.pagerInfo.pageIndex - 1, this.pagerInfo.pageSize);
    }
    /**
     * Go to the next page
     * @param {?} $event
     * @return {?}
     */
    next($event) {
        $event.stopPropagation();
        this.setCurrent(this.pagerInfo.pageIndex + 1, this.pagerInfo.pageSize);
    }
    /**
     * @param {?} page
     * @param {?=} pageSize
     * @param {?=} $event
     * @return {?}
     */
    setCurrent(page, pageSize, $event) {
        if ($event) {
            $event.stopPropagation();
        }
        this.pageChange.emit({ pageIndex: page, pageSize, node: this.context.node, context: this.context });
    }
}
TreetableNodesPagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'nodes-pager',
                template: "\r\n<div style=\"padding: 3px 0;\" *ngIf=\"showPager | async\">\r\n    <ul class=\"treetable-nodes-pagerbar d-flex\">\r\n        <li class=\"pageinfo\">{{ pagerInfo.pageIndex }} / {{ getPagerCount() }}</li>\r\n        <li class=\"pager-btn prev\" [class.disabled]=\"isFirstPager()\" (click)=\"previous($event)\" title=\"{{ 'pagination.previous'|locale: '\u4E0A\u4E00\u9875' }}\">\r\n            <span class=\"f-icon f-icon-arrow-chevron-left\"></span>\r\n        </li>\r\n        <li class=\"pager-btn next\"  [class.disabled]=\"isLastPager()\" (click)=\"next($event)\" title=\"{{ 'pagination.next'|locale: '\u4E0B\u4E00\u9875' }}\">\r\n            <span class=\"f-icon f-icon-arrow-chevron-right\"></span>\r\n        </li>\r\n    </ul>\r\n\r\n</div>",
                styles: [`
        .treetable-nodes-pagerbar { height: 22px; line-height: 22px; list-style: none}
        .treetable-nodes-pagerbar li { float: left; box-sizing: border-box; }
        .treetable-nodes-pagerbar .pager-btn {
            width: 22px;
            height: 22px;
            text-align: center;
            border: 1px solid #ccc;
            background: rgb(248 249 250);
            cursor: pointer;
        }
        .treetable-nodes-pagerbar .pager-btn:hover {
            background: white;
        }
        .treetable-nodes-pagerbar .pageinfo {padding: 0 5px; font-weight: 400;}
        .treetable-nodes-pagerbar .prev {}
        .treetable-nodes-pagerbar .next {
            border-left: 0;
        }

        .pager-btn.disabled{
            color: rgb(204 204 204);
            pointer-events: none;
        }
        `]
            }] }
];
/** @nocollapse */
TreetableNodesPagerComponent.ctorParameters = () => [
    { type: TreeTableComponent },
    { type: ChangeDetectorRef },
    { type: Injector }
];
TreetableNodesPagerComponent.propDecorators = {
    context: [{ type: Input }],
    pageChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.context;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pageChange;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.showPager;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pagerInfo;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.tt;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZXMtcGFnZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS10cmVldGFibGUvIiwic291cmNlcyI6WyJsaWIvbm9kZXNfcGFnZXIvbm9kZXMtcGFnZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBcUMsTUFBTSxlQUFlLENBQUM7QUFFL0ksT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFpQ3ZDLE1BQU0sT0FBTyw0QkFBNEI7Ozs7OztJQVFyQyxZQUFvQixFQUFzQixFQUFXLEVBQXFCLEVBQVUsUUFBa0I7UUFBbEYsT0FBRSxHQUFGLEVBQUUsQ0FBb0I7UUFBVyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFMNUYsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFMUMsY0FBUyxHQUFHLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZDLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFHYixJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDVCxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ2YsTUFBTTs7OztZQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7Z0JBQ2pCLE9BQU8sSUFBSSxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU07Ozs7Z0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FB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QUksQ0FBQyxNQUFXO1FBQ1osTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0UsQ0FBQzs7Ozs7OztJQUVELFVBQVUsQ0FBQyxJQUFZLEVBQUUsUUFBaUIsRUFBRSxNQUFZO1FBQ3BELElBQUksTUFBTSxFQUFFO1lBQ1IsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQzVCO1FBRUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQ3hHLENBQUM7OztZQXJJSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGFBQWE7Z0JBQ3ZCLDB2QkFBMkM7eUJBRXZDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7U0F3QkM7YUFFUjs7OztZQXBDUSxrQkFBa0I7WUFDa0IsaUJBQWlCO1lBQTNCLFFBQVE7OztzQkFxQ3RDLEtBQUs7eUJBRUwsTUFBTTs7OztJQUZQLCtDQUFzQjs7SUFFdEIsa0RBQTBDOztJQUUxQyxpREFBdUM7O0lBQ3ZDLGlEQUFpQjs7Ozs7SUFFTCwwQ0FBOEI7Ozs7O0lBQUcsMENBQTZCOzs7OztJQUFFLGdEQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJy4vLi4vdHJlZXRhYmxlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgSW5qZWN0b3IsIENoYW5nZURldGVjdG9yUmVmLCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBEb0NoZWNrIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyZWVOb2RlIH0gZnJvbSAnLi4vdHlwZXMvdHJlZW5vZGUnO1xyXG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ25vZGVzLXBhZ2VyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9ub2Rlcy1wYWdlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgXHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciB7IGhlaWdodDogMjJweDsgbGluZS1oZWlnaHQ6IDIycHg7IGxpc3Qtc3R5bGU6IG5vbmV9XHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciBsaSB7IGZsb2F0OiBsZWZ0OyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9XHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciAucGFnZXItYnRuIHtcclxuICAgICAgICAgICAgd2lkdGg6IDIycHg7XHJcbiAgICAgICAgICAgIGhlaWdodDogMjJweDtcclxuICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xyXG4gICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjO1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2IoMjQ4IDI0OSAyNTApO1xyXG4gICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgLnBhZ2VyLWJ0bjpob3ZlciB7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIC5wYWdlaW5mbyB7cGFkZGluZzogMCA1cHg7IGZvbnQtd2VpZ2h0OiA0MDA7fVxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgLnByZXYge31cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIC5uZXh0IHtcclxuICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAucGFnZXItYnRuLmRpc2FibGVke1xyXG4gICAgICAgICAgICBjb2xvcjogcmdiKDIwNCAyMDQgMjA0KTtcclxuICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGBcclxuICAgIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFRyZWV0YWJsZU5vZGVzUGFnZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgICBASW5wdXQoKSBjb250ZXh0OiBhbnk7XHJcblxyXG4gICAgQE91dHB1dCgpIHBhZ2VDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgc2hvd1BhZ2VyID0gbmV3IEJlaGF2aW9yU3ViamVjdChmYWxzZSk7XHJcbiAgICBwYWdlckluZm8gPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHQ6IFRyZWVUYWJsZUNvbXBvbmVudCwgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIGlmICh0aGlzLnR0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudHQuZXhwYW5kLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXIoKG5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmlkID09PSB0aGlzLmNvbnRleHQubm9kZS5pZCAmJiBub2RlLnBhZ2luYXRpb24gJiYgbm9kZS5jaGlsZHJlbi5maWx0ZXIobiA9PiAhbi5fX2NoaWxkc19sb2FkaW5nX18pLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgKG5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlckluZm8gPSB7Li4ubm9kZS5wYWdpbmF0aW9ufTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dQYWdlci5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50dC5hcHBlbmROZXcuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBlLnBhcmVudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gdGhpcy5jb250ZXh0Lm5vZGUuaWQgJiYgbm9kZS5wYWdpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZXJJbmZvID0gey4uLm5vZGUucGFnaW5hdGlvbn07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1BhZ2VyLm5leHQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50dC5jb2xsYXBzZS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAobm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gdGhpcy5jb250ZXh0Lm5vZGUuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93UGFnZXIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldFBhZ2VySW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5jb250ZXh0ICYmICFjaGFuZ2VzLmNvbnRleHQuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UGFnZXJJbmZvKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UGFnZXJJbmZvKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRleHQpIHtcclxuICAgICAgICAgICAgY29uc3QgeyBub2RlIH0gPSB0aGlzLmNvbnRleHQ7XHJcbiAgICAgICAgICAgIGlmIChub2RlICYmIG5vZGUucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlckluZm8gPSB7IC4uLm5vZGUucGFnaW5hdGlvbiB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93UGFnZXIubmV4dChcclxuICAgICAgICAgICAgICAgICAgICBub2RlLmV4cGFuZGVkICYmIG5vZGUucGFnaW5hdGlvblxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRQYWdlckNvdW50KCkge1xyXG4gICAgICAgIGNvbnN0IHsgcGFnZVNpemUsIHRvdGFsIH0gPSB0aGlzLnBhZ2VySW5mbztcclxuICAgICAgICBpZiAoIXRvdGFsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwodG90YWwgLyBwYWdlU2l6ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlzRmlyc3RQYWdlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYWdlckluZm8ucGFnZUluZGV4ID09PSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlzTGFzdFBhZ2VyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhZ2VySW5mby5wYWdlSW5kZXggPT09IHRoaXMuZ2V0UGFnZXJDb3VudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR28gdG8gdGhlIHByZXZpb3VzIHBhZ2VcclxuICAgICAqL1xyXG4gICAgcHJldmlvdXMoJGV2ZW50OiBhbnkpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5zZXRDdXJyZW50KHRoaXMucGFnZXJJbmZvLnBhZ2VJbmRleCAtIDEsIHRoaXMucGFnZXJJbmZvLnBhZ2VTaXplKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEdvIHRvIHRoZSBuZXh0IHBhZ2VcclxuICAgICAqL1xyXG4gICAgbmV4dCgkZXZlbnQ6IGFueSkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLnNldEN1cnJlbnQodGhpcy5wYWdlckluZm8ucGFnZUluZGV4ICsgMSwgdGhpcy5wYWdlckluZm8ucGFnZVNpemUpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEN1cnJlbnQocGFnZTogbnVtYmVyLCBwYWdlU2l6ZT86IG51bWJlciwgJGV2ZW50PzogYW55KSB7XHJcbiAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnBhZ2VDaGFuZ2UuZW1pdCh7IHBhZ2VJbmRleDogcGFnZSwgcGFnZVNpemUsIG5vZGU6IHRoaXMuY29udGV4dC5ub2RlLCBjb250ZXh0OiB0aGlzLmNvbnRleHQgfSk7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==