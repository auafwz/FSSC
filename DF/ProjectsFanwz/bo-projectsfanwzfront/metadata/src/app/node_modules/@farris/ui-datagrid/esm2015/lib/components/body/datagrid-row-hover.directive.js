/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-26 17:17:32
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Directive, Input, NgZone, Renderer2, ElementRef, Inject, forwardRef, ChangeDetectorRef } from '@angular/core';
import { DatagridBodyComponent } from './datagrid-body.component';
import { DatagridComponent } from './../../datagrid.component';
import { Utils } from './../../utils/utils';
export class DatagridRowHoverDirective {
    /**
     * @param {?} dg
     * @param {?} dgb
     * @param {?} cd
     * @param {?} el
     * @param {?} zone
     * @param {?} render
     */
    constructor(dg, dgb, cd, el, zone, render) {
        this.dg = dg;
        this.dgb = dgb;
        this.cd = cd;
        this.el = el;
        this.zone = zone;
        this.render = render;
        this._mouseenter = null;
        this._mouseleave = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.dg.rowHover) {
            this.zone.runOutsideAngular((/**
             * @return {?}
             */
            () => {
                this._mouseenter = Utils.on(this.el.nativeElement, 'mouseenter', this.onmouseenter.bind(this), { target: '.f-datagrid-body-row', options: { capture: true } });
                this._mouseleave = Utils.on(this.el.nativeElement, 'mouseleave', this.onmouseleave.bind(this), { target: '.f-datagrid-body-row', options: { capture: true } });
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this._mouseenter) {
            this._mouseenter();
        }
        if (this._mouseleave) {
            this._mouseleave();
        }
    }
    // @HostListener('mouseenter')
    /**
     * @param {?} event
     * @return {?}
     */
    onmouseenter(event) {
        this.setRowHoverCls(event);
    }
    // @HostListener('mouseleave')
    /**
     * @param {?} event
     * @return {?}
     */
    onmouseleave(event) {
        this.setRowHoverCls(event, false);
    }
    /**
     * @param {?} event
     * @param {?=} hover
     * @return {?}
     */
    setRowHoverCls(event, hover = true) {
        if (!this.dg.rowHover) {
            return;
        }
        if (!event.target.matches('.f-datagrid-body-row')) {
            return;
        }
        this.rowIndex = event.target.getAttribute('index');
        /** @type {?} */
        const leftTableCls = 'f-datagrid-body-fixed-left';
        /** @type {?} */
        const rightTableCls = 'f-datagrid-body-fixed-right';
        /** @type {?} */
        const centerTableCls = 'f-datagrid-body-center';
        /** @type {?} */
        const body = this.dg.el.nativeElement.querySelector('.f-datagrid-body');
        if (!body) {
            return;
        }
        /** @type {?} */
        const leftTableDom = body.querySelector(`.${leftTableCls}`);
        /** @type {?} */
        const rightTableDom = body.querySelector(`.${rightTableCls}`);
        /** @type {?} */
        const centerTableDom = body.querySelector(`.${centerTableCls}`);
        /** @type {?} */
        const method = hover ? 'addClass' : 'removeClass';
        /** @type {?} */
        const trSelector = `tr[index="${this.rowIndex}"]`;
        /** @type {?} */
        const dom = this.el.nativeElement.closest('div');
        if (dom && dom.className) {
            /** @type {?} */
            const trDom = centerTableDom.querySelector(trSelector);
            if (!trDom) {
                return;
            }
            if (trDom.className.indexOf('f-datagrid-disable-row') > -1) {
                return;
            }
            /** @type {?} */
            let ltr = null;
            /** @type {?} */
            let rtr = null;
            if (rightTableDom) {
                rtr = rightTableDom.querySelector(trSelector);
            }
            if (leftTableDom) {
                ltr = leftTableDom.querySelector(trSelector);
            }
            if (leftTableDom && ltr) {
                this.render[method](ltr, this.dg.hoverRowCls);
            }
            if (rightTableDom && rtr) {
                this.render[method](rtr, this.dg.hoverRowCls);
            }
            this.render[method](trDom, this.dg.hoverRowCls);
        }
    }
}
DatagridRowHoverDirective.decorators = [
    { type: Directive, args: [{
                selector: '[row-hover]',
                exportAs: 'rowHover'
            },] }
];
/** @nocollapse */
DatagridRowHoverDirective.ctorParameters = () => [
    { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                     * @return {?}
                     */
                    () => DatagridComponent)),] }] },
    { type: DatagridBodyComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                     * @return {?}
                     */
                    () => DatagridBodyComponent)),] }] },
    { type: ChangeDetectorRef },
    { type: ElementRef },
    { type: NgZone },
    { type: Renderer2 }
];
DatagridRowHoverDirective.propDecorators = {
    rowIndex: [{ type: Input }],
    rowData: [{ type: Input, args: ['row-hover',] }]
};
if (false) {
    /** @type {?} */
    DatagridRowHoverDirective.prototype.rowIndex;
    /** @type {?} */
    DatagridRowHoverDirective.prototype.rowData;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype._mouseenter;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype._mouseleave;
    /** @type {?} */
    DatagridRowHoverDirective.prototype.dg;
    /** @type {?} */
    DatagridRowHoverDirective.prototype.dgb;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.render;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtcm93LWhvdmVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9ib2R5L2RhdGFncmlkLXJvdy1ob3Zlci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBU0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQWEsTUFBTSxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBZ0IsTUFBTSxlQUFlLENBQUM7QUFDeEosT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBSzVDLE1BQU0sT0FBTyx5QkFBeUI7Ozs7Ozs7OztJQVFsQyxZQUN3RCxFQUFxQixFQUNqQixHQUEwQixFQUMxRSxFQUFxQixFQUNyQixFQUFjLEVBQVUsSUFBWSxFQUFVLE1BQWlCO1FBSG5CLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ2pCLFFBQUcsR0FBSCxHQUFHLENBQXVCO1FBQzFFLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ3JCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFRO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQVBuRSxnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztJQU8zQixDQUFDOzs7O0lBRUQsUUFBUTtRQUNKLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUU7WUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUI7OztZQUFFLEdBQUcsRUFBRTtnQkFDOUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxL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Ozs7SUFDN0IsdUNBQXNCOzs7OztJQUFFLHlDQUFvQjs7Ozs7SUFBRSwyQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0MzowN1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0wOS0yNiAxNzoxNzozMlxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgTmdab25lLCBPbkluaXQsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgT25EZXN0cm95LCBJbmplY3QsIGZvcndhcmRSZWYsIENoYW5nZURldGVjdG9yUmVmLCBIb3N0TGlzdGVuZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4vLi4vLi4vdXRpbHMvdXRpbHMnO1xyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW3Jvdy1ob3Zlcl0nLFxyXG4gICAgZXhwb3J0QXM6ICdyb3dIb3ZlcidcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkUm93SG92ZXJEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcblxyXG4gICAgQElucHV0KCkgcm93SW5kZXg6IG51bWJlcjtcclxuICAgIEBJbnB1dCgncm93LWhvdmVyJykgcm93RGF0YTogYW55O1xyXG5cclxuICAgIHByaXZhdGUgX21vdXNlZW50ZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfbW91c2VsZWF2ZSA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IERhdGFncmlkQ29tcG9uZW50KSkgcHVibGljIGRnOiBEYXRhZ3JpZENvbXBvbmVudCxcclxuICAgICAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRCb2R5Q29tcG9uZW50KSkgcHVibGljIGRnYjogRGF0YWdyaWRCb2R5Q29tcG9uZW50LFxyXG4gICAgICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgem9uZTogTmdab25lLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcucm93SG92ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZWVudGVyID0gVXRpbHMub24odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2VlbnRlcicsIHRoaXMub25tb3VzZWVudGVyLmJpbmQodGhpcyksIHsgdGFyZ2V0OiAnLmYtZGF0YWdyaWQtYm9keS1yb3cnLCBvcHRpb25zOiB7IGNhcHR1cmU6IHRydWUgfX0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbW91c2VsZWF2ZSA9IFV0aWxzLm9uKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ21vdXNlbGVhdmUnLCB0aGlzLm9ubW91c2VsZWF2ZS5iaW5kKHRoaXMpLCB7IHRhcmdldDogJy5mLWRhdGFncmlkLWJvZHktcm93Jywgb3B0aW9uczogeyBjYXB0dXJlOiB0cnVlIH19KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWVudGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlZW50ZXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWxlYXZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlbGVhdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQEhvc3RMaXN0ZW5lcignbW91c2VlbnRlcicpXHJcbiAgICBvbm1vdXNlZW50ZXIoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLnNldFJvd0hvdmVyQ2xzKGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBASG9zdExpc3RlbmVyKCdtb3VzZWxlYXZlJylcclxuICAgIG9ubW91c2VsZWF2ZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuc2V0Um93SG92ZXJDbHMoZXZlbnQsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRSb3dIb3ZlckNscyhldmVudCwgaG92ZXIgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLnJvd0hvdmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghZXZlbnQudGFyZ2V0Lm1hdGNoZXMoJy5mLWRhdGFncmlkLWJvZHktcm93JykpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yb3dJbmRleCA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2luZGV4Jyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxlZnRUYWJsZUNscyA9ICdmLWRhdGFncmlkLWJvZHktZml4ZWQtbGVmdCc7XHJcbiAgICAgICAgY29uc3QgcmlnaHRUYWJsZUNscyA9ICdmLWRhdGFncmlkLWJvZHktZml4ZWQtcmlnaHQnO1xyXG4gICAgICAgIGNvbnN0IGNlbnRlclRhYmxlQ2xzID0gJ2YtZGF0YWdyaWQtYm9keS1jZW50ZXInO1xyXG5cclxuICAgICAgICBjb25zdCBib2R5ID0gdGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mLWRhdGFncmlkLWJvZHknKTtcclxuXHJcbiAgICAgICAgaWYgKCFib2R5KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGxlZnRUYWJsZURvbSA9IGJvZHkucXVlcnlTZWxlY3RvcihgLiR7bGVmdFRhYmxlQ2xzfWApO1xyXG4gICAgICAgIGNvbnN0IHJpZ2h0VGFibGVEb20gPSBib2R5LnF1ZXJ5U2VsZWN0b3IoYC4ke3JpZ2h0VGFibGVDbHN9YCk7XHJcbiAgICAgICAgY29uc3QgY2VudGVyVGFibGVEb20gPSBib2R5LnF1ZXJ5U2VsZWN0b3IoYC4ke2NlbnRlclRhYmxlQ2xzfWApO1xyXG5cclxuICAgICAgICBjb25zdCBtZXRob2QgPSBob3ZlciA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnO1xyXG4gICAgICAgIGNvbnN0IHRyU2VsZWN0b3IgPSBgdHJbaW5kZXg9XCIke3RoaXMucm93SW5kZXh9XCJdYDtcclxuICAgICAgICBjb25zdCBkb20gPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xvc2VzdCgnZGl2Jyk7XHJcbiAgICAgICAgaWYgKGRvbSAmJiBkb20uY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyRG9tID0gY2VudGVyVGFibGVEb20ucXVlcnlTZWxlY3Rvcih0clNlbGVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdHJEb20pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRyRG9tLmNsYXNzTmFtZS5pbmRleE9mKCdmLWRhdGFncmlkLWRpc2FibGUtcm93JykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBsdHIgPSBudWxsO1xyXG4gICAgICAgICAgICBsZXQgcnRyID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHJpZ2h0VGFibGVEb20pIHtcclxuICAgICAgICAgICAgICAgIHJ0ciA9IHJpZ2h0VGFibGVEb20ucXVlcnlTZWxlY3Rvcih0clNlbGVjdG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobGVmdFRhYmxlRG9tKSB7XHJcbiAgICAgICAgICAgICAgICBsdHIgPSBsZWZ0VGFibGVEb20ucXVlcnlTZWxlY3Rvcih0clNlbGVjdG9yKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGxlZnRUYWJsZURvbSAmJiBsdHIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyW21ldGhvZF0obHRyLCB0aGlzLmRnLmhvdmVyUm93Q2xzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmlnaHRUYWJsZURvbSAmJiBydHIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyW21ldGhvZF0ocnRyLCB0aGlzLmRnLmhvdmVyUm93Q2xzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJbbWV0aG9kXSh0ckRvbSwgdGhpcy5kZy5ob3ZlclJvd0Nscyk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuIl19