/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { tooltips } from './tooltip-list';
import { getScrollParent } from './utils/scrollInfo';
/** @type {?} */
const tooltipStyles = {
    minWidth: '70px',
    position: 'absolute',
    padding: '4px 8px',
    textAlign: 'center',
    backgroundColor: 'rgba(0,0,0,0.7)',
    color: '#fff',
    cursor: 'default',
    borderRadius: '4px',
    fontSize: '12px',
    top: '-9999px',
    visibility: 'hidden',
    'z-index': '9999'
};
export class Tooltip {
    /**
     * @param {?} quill
     * @param {?} ngZone
     */
    constructor(quill, ngZone) {
        this.ngZone = ngZone;
        this.quill = quill;
        this.toolbar = quill.getModule('toolbar');
        this.buttons = null;
        this.selectors = null;
        this.tip = null;
        this.timeout = null;
        this.mouseenterHandler = null;
        this.mouseleaveHandler = null;
        /** @type {?} */
        const toolbarElement = this.toolbar.container;
        if (toolbarElement) {
            // 添加处理事件
            this.buttons = toolbarElement.querySelectorAll('button');
            this.selectors = toolbarElement.querySelectorAll('.ql-picker');
            for (let el of this.buttons) {
                this.addHandler(el);
            }
            for (let el of this.selectors) {
                this.addHandler(el);
            }
            // 创建tooltip
            this.createTooltip();
            // 滚动元素增加handler
            this.scrollElm = getScrollParent(toolbarElement);
            this.scrollElm.addEventListener('scroll', this.mouseleaveHandler);
        }
    }
    /**
     * @return {?}
     */
    createTooltip() {
        this.tip = document.createElement('div');
        this.tip.classList.add('quill-tooltip');
        Object.assign(this.tip.style, tooltipStyles);
        document.body.appendChild(this.tip);
    }
    /**
     * @param {?} el
     * @return {?}
     */
    addHandler(el) {
        this.mouseenterHandler = (/**
         * @return {?}
         */
        () => {
            // this.ngZone.runOutsideAngular(() => {
            //     this.timeout = setTimeout(() => {
            //         this.showTooltip(el);
            //     }, 100);
            // });
            this.timeout = setTimeout((/**
             * @return {?}
             */
            () => {
                this.showTooltip(el);
            }), 100);
        });
        this.mouseleaveHandler = (/**
         * @return {?}
         */
        () => {
            if (this.timeout) {
                // this.ngZone.runOutsideAngular(() => {
                //     clearTimeout(this.timeout);
                // });
                clearTimeout(this.timeout);
            }
            this.hideTooltip();
        });
        // if (this.ngZone && this.ngZone.runOutsideAngular) {
        //     this.ngZone.runOutsideAngular(() => {
        //         el.addEventListener('mouseenter', this.mouseenterHandler);
        //         el.addEventListener('mouseleave', this.mouseleaveHandler);
        //     });
        // }
        el.addEventListener('mouseenter', this.mouseenterHandler);
        el.addEventListener('mouseleave', this.mouseleaveHandler);
    }
    /**
     * @param {?} el
     * @return {?}
     */
    showTooltip(el) {
        // let format = el.className.replace('ql-', '')
        /** @type {?} */
        const format = [].find
            .call(el.classList, (/**
         * @param {?} className
         * @return {?}
         */
        className => {
            return className.indexOf('ql-') === 0;
        }))
            .replace('ql-', '');
        if (tooltips[format]) {
            /** @type {?} */
            const tool = tooltips[format];
            if (typeof tool === 'string') {
                this.tip.textContent = tool;
            }
            else {
                /** @type {?} */
                const value = el.value || '';
                if (value != null && tool[value]) {
                    this.tip.textContent = tool[value];
                }
            }
            /** @type {?} */
            const elRect = el.getBoundingClientRect();
            /** @type {?} */
            const tipRect = this.tip.getBoundingClientRect();
            /** @type {?} */
            const body = document.documentElement || document.body;
            /** @type {?} */
            const bodyRect = {
                width: body.scrollWidth,
                height: body.scrollHeight,
                scrollTop: body.scrollTop,
                scrollLeft: body.scrollLeft
            };
            /** @type {?} */
            const offset = 3;
            Object.assign(this.tip.style, {
                top: elRect.top - elRect.height - offset + bodyRect.scrollTop + 'px',
                left: elRect.left - (tipRect.width - elRect.width) / 2 + bodyRect.scrollLeft + 'px',
                visibility: 'visible'
            });
        }
    }
    /**
     * @return {?}
     */
    hideTooltip() {
        Object.assign(this.tip.style, {
            top: '-9999px',
            visibility: 'hidden'
        });
    }
    /**
     * @return {?}
     */
    onDestroy() {
        console.warn('ondestroy');
        this.destroyTooltip();
        if (this.buttons) {
            for (let el of this.buttons) {
                this.removeHandler(el);
            }
        }
        if (this.selectors) {
            for (let el of this.selectors) {
                this.removeHandler(el);
            }
        }
        if (this.scrollElm) {
            this.scrollElm.removeEventListener('scroll', this.mouseleaveHandler);
        }
    }
    /**
     * @return {?}
     */
    destroyTooltip() {
        if (this.tip.parentNode) {
            this.tip.parentNode.removeChild(this.tip);
        }
    }
    /**
     * @param {?} el
     * @return {?}
     */
    removeHandler(el) {
        el.removeEventListener('mouseenter', this.mouseenterHandler);
        el.removeEventListener('mouseleave', this.mouseleaveHandler);
    }
}
if (false) {
    /** @type {?} */
    Tooltip.prototype.quill;
    /** @type {?} */
    Tooltip.prototype.toolbar;
    /** @type {?} */
    Tooltip.prototype.buttons;
    /** @type {?} */
    Tooltip.prototype.tip;
    /** @type {?} */
    Tooltip.prototype.selectors;
    /** @type {?} */
    Tooltip.prototype.mouseenterHandler;
    /** @type {?} */
    Tooltip.prototype.mouseleaveHandler;
    /** @type {?} */
    Tooltip.prototype.timeout;
    /** @type {?} */
    Tooltip.prototype.scrollElm;
    /**
     * @type {?}
     * @private
     */
    Tooltip.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWh0bWwtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3Rvb2wtdGlwLW1vZHVsZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7TUFDL0MsYUFBYSxHQUFHO0lBQ2xCLFFBQVEsRUFBRSxNQUFNO0lBQ2hCLFFBQVEsRUFBRSxVQUFVO0lBQ3BCLE9BQU8sRUFBRSxTQUFTO0lBQ2xCLFNBQVMsRUFBRSxRQUFRO0lBQ25CLGVBQWUsRUFBRSxpQkFBaUI7SUFDbEMsS0FBSyxFQUFFLE1BQU07SUFDYixNQUFNLEVBQUUsU0FBUztJQUNqQixZQUFZLEVBQUUsS0FBSztJQUNuQixRQUFRLEVBQUUsTUFBTTtJQUNoQixHQUFHLEVBQUUsU0FBUztJQUNkLFVBQVUsRUFBRSxRQUFRO0lBQ3BCLFNBQVMsRUFBRSxNQUFNO0NBQ3BCO0FBQ0QsTUFBTSxPQUFPLE9BQU87Ozs7O0lBVWhCLFlBQVksS0FBSyxFQUFVLE1BQWM7UUFBZCxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ3JDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNwQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNwQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQzlCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7O2NB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SSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDakUsQ0FBQztDQUNKOzs7SUFoSkcsd0JBQVc7O0lBQ1gsMEJBQWE7O0lBQ2IsMEJBQWE7O0lBQ2Isc0JBQVM7O0lBQ1QsNEJBQWU7O0lBQ2Ysb0NBQXVCOztJQUN2QixvQ0FBdUI7O0lBQ3ZCLDBCQUFhOztJQUNiLDRCQUFlOzs7OztJQUNJLHlCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyB0b29sdGlwcyB9IGZyb20gJy4vdG9vbHRpcC1saXN0JztcclxuaW1wb3J0IHsgZ2V0U2Nyb2xsUGFyZW50IH0gZnJvbSAnLi91dGlscy9zY3JvbGxJbmZvJztcclxuY29uc3QgdG9vbHRpcFN0eWxlcyA9IHtcclxuICAgIG1pbldpZHRoOiAnNzBweCcsXHJcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcclxuICAgIHBhZGRpbmc6ICc0cHggOHB4JyxcclxuICAgIHRleHRBbGlnbjogJ2NlbnRlcicsXHJcbiAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDAsMCwwLDAuNyknLFxyXG4gICAgY29sb3I6ICcjZmZmJyxcclxuICAgIGN1cnNvcjogJ2RlZmF1bHQnLFxyXG4gICAgYm9yZGVyUmFkaXVzOiAnNHB4JyxcclxuICAgIGZvbnRTaXplOiAnMTJweCcsXHJcbiAgICB0b3A6ICctOTk5OXB4JyxcclxuICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxyXG4gICAgJ3otaW5kZXgnOiAnOTk5OSdcclxufTtcclxuZXhwb3J0IGNsYXNzIFRvb2x0aXAge1xyXG4gICAgcXVpbGw6IGFueTtcclxuICAgIHRvb2xiYXI6IGFueTtcclxuICAgIGJ1dHRvbnM6IGFueTtcclxuICAgIHRpcDogYW55O1xyXG4gICAgc2VsZWN0b3JzOiBhbnk7XHJcbiAgICBtb3VzZWVudGVySGFuZGxlcjogYW55O1xyXG4gICAgbW91c2VsZWF2ZUhhbmRsZXI6IGFueTtcclxuICAgIHRpbWVvdXQ6IGFueTtcclxuICAgIHNjcm9sbEVsbTogYW55O1xyXG4gICAgY29uc3RydWN0b3IocXVpbGwsIHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHtcclxuICAgICAgICB0aGlzLnF1aWxsID0gcXVpbGw7XHJcbiAgICAgICAgdGhpcy50b29sYmFyID0gcXVpbGwuZ2V0TW9kdWxlKCd0b29sYmFyJyk7XHJcbiAgICAgICAgdGhpcy5idXR0b25zID0gbnVsbDtcclxuICAgICAgICB0aGlzLnNlbGVjdG9ycyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50aXAgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudGltZW91dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5tb3VzZWVudGVySGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5tb3VzZWxlYXZlSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgY29uc3QgdG9vbGJhckVsZW1lbnQgPSB0aGlzLnRvb2xiYXIuY29udGFpbmVyO1xyXG4gICAgICAgIGlmICh0b29sYmFyRWxlbWVudCkge1xyXG4gICAgICAgICAgICAvLyDmt7vliqDlpITnkIbkuovku7ZcclxuICAgICAgICAgICAgdGhpcy5idXR0b25zID0gdG9vbGJhckVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0b3JzID0gdG9vbGJhckVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnFsLXBpY2tlcicpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBlbCBvZiB0aGlzLmJ1dHRvbnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkSGFuZGxlcihlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChsZXQgZWwgb2YgdGhpcy5zZWxlY3RvcnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkSGFuZGxlcihlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5Yib5bu6dG9vbHRpcFxyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRvb2x0aXAoKTtcclxuICAgICAgICAgICAgLy8g5rua5Yqo5YWD57Sg5aKe5YqgaGFuZGxlclxyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbEVsbSA9IGdldFNjcm9sbFBhcmVudCh0b29sYmFyRWxlbWVudCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsRWxtLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMubW91c2VsZWF2ZUhhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVUb29sdGlwKCkge1xyXG4gICAgICAgIHRoaXMudGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdGhpcy50aXAuY2xhc3NMaXN0LmFkZCgncXVpbGwtdG9vbHRpcCcpO1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy50aXAuc3R5bGUsIHRvb2x0aXBTdHlsZXMpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy50aXApO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEhhbmRsZXIoZWwpIHtcclxuICAgICAgICB0aGlzLm1vdXNlZW50ZXJIYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLnNob3dUb29sdGlwKGVsKTtcclxuICAgICAgICAgICAgLy8gICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd1Rvb2x0aXAoZWwpO1xyXG4gICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5tb3VzZWxlYXZlSGFuZGxlciA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudGltZW91dCkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpO1xyXG4gICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmhpZGVUb29sdGlwKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyBpZiAodGhpcy5uZ1pvbmUgJiYgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIHRoaXMubW91c2VlbnRlckhhbmRsZXIpO1xyXG4gICAgICAgIC8vICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHRoaXMubW91c2VsZWF2ZUhhbmRsZXIpO1xyXG4gICAgICAgIC8vICAgICB9KTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIHRoaXMubW91c2VlbnRlckhhbmRsZXIpO1xyXG4gICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCB0aGlzLm1vdXNlbGVhdmVIYW5kbGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93VG9vbHRpcChlbCkge1xyXG4gICAgICAgIC8vIGxldCBmb3JtYXQgPSBlbC5jbGFzc05hbWUucmVwbGFjZSgncWwtJywgJycpXHJcbiAgICAgICAgY29uc3QgZm9ybWF0ID0gW10uZmluZFxyXG4gICAgICAgICAgICAuY2FsbChlbC5jbGFzc0xpc3QsIGNsYXNzTmFtZSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xhc3NOYW1lLmluZGV4T2YoJ3FsLScpID09PSAwO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAucmVwbGFjZSgncWwtJywgJycpO1xyXG4gICAgICAgIGlmICh0b29sdGlwc1tmb3JtYXRdKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvb2wgPSB0b29sdGlwc1tmb3JtYXRdO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRvb2wgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpcC50ZXh0Q29udGVudCA9IHRvb2w7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGVsLnZhbHVlIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdG9vbFt2YWx1ZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpcC50ZXh0Q29udGVudCA9IHRvb2xbdmFsdWVdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGVsUmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICBjb25zdCB0aXBSZWN0ID0gdGhpcy50aXAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgfHwgZG9jdW1lbnQuYm9keTtcclxuICAgICAgICAgICAgY29uc3QgYm9keVJlY3QgPSB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogYm9keS5zY3JvbGxXaWR0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogYm9keS5zY3JvbGxIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IGJvZHkuc2Nyb2xsVG9wLFxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogYm9keS5zY3JvbGxMZWZ0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IDM7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy50aXAuc3R5bGUsIHtcclxuICAgICAgICAgICAgICAgIHRvcDogZWxSZWN0LnRvcCAtIGVsUmVjdC5oZWlnaHQgLSBvZmZzZXQgKyBib2R5UmVjdC5zY3JvbGxUb3AgKyAncHgnLFxyXG4gICAgICAgICAgICAgICAgbGVmdDogZWxSZWN0LmxlZnQgLSAodGlwUmVjdC53aWR0aCAtIGVsUmVjdC53aWR0aCkgLyAyICsgYm9keVJlY3Quc2Nyb2xsTGVmdCArICdweCcsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGVUb29sdGlwKCkge1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy50aXAuc3R5bGUsIHtcclxuICAgICAgICAgICAgdG9wOiAnLTk5OTlweCcsXHJcbiAgICAgICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25EZXN0cm95KCkge1xyXG4gICAgICAgIGNvbnNvbGUud2Fybignb25kZXN0cm95Jyk7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95VG9vbHRpcCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmJ1dHRvbnMpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgZWwgb2YgdGhpcy5idXR0b25zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUhhbmRsZXIoZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdG9ycykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBlbCBvZiB0aGlzLnNlbGVjdG9ycykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVIYW5kbGVyKGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5zY3JvbGxFbG0pIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxFbG0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5tb3VzZWxlYXZlSGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3lUb29sdGlwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRpcC5wYXJlbnROb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGlwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy50aXApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVIYW5kbGVyKGVsKSB7XHJcbiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIHRoaXMubW91c2VlbnRlckhhbmRsZXIpO1xyXG4gICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCB0aGlzLm1vdXNlbGVhdmVIYW5kbGVyKTtcclxuICAgIH1cclxufVxyXG4iXX0=