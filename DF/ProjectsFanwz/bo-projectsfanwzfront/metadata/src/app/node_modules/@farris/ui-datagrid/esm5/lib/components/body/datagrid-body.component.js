/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { delay, debounceTime } from 'rxjs/operators';
import { of } from 'rxjs';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-12 07:47:12
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-26 10:21:25
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, ViewChild, Renderer2, ElementRef, ChangeDetectorRef, ChangeDetectionStrategy, NgZone, Injector, Optional, ApplicationRef, Output, EventEmitter } from '@angular/core';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { ScrollbarDirective } from '../../scrollbar/scrollbar.directive';
import { SCROLL_X_ACTION, SCROLL_Y_ACTION, SCROLL_X_REACH_START_ACTION, TR_PREFIX } from '../../types/constant';
import { DatagridService } from '../../services/datagrid.service';
import { DatagridComponent } from '../../datagrid.component';
import { FormatCellDataPipe } from '../../utils/format-cell-data.pipe';
import { ColumnFormatService } from '@farris/ui-common/column';
var DatagridBodyComponent = /** @class */ (function () {
    function DatagridBodyComponent(injector, app, dg, cd, el) {
        var _this = this;
        this.injector = injector;
        this.app = app;
        this.dg = dg;
        this.cd = cd;
        this.el = el;
        // 自动高度时，禁用纵向滚动条
        this.psConfig = { swipeEasing: false, minScrollbarLength: 15, handlers: ['click-rail', 'drag-thumb', 'wheel', 'touch'], suppressScrollY: this.dg.autoHeight };
        this.scrollTop = 0;
        this.scrollLeft = 0;
        this.deltaTopHeight = 0;
        // wheelHeight = 0;
        this.wheelWidth = 0;
        this._fixedRightScrollLeft = 0;
        this.maxScrollLeft = 0;
        this.showRightShadow = false;
        this.footerHeight = 0;
        // 虚拟加载
        this.topHideHeight = 0;
        this.bottomHideHeight = 0;
        this.startRowIndex = 0;
        this.dataChange = new EventEmitter();
        this.scrollBarMode = 'auto';
        this.checkedRows = [];
        this.visibleContextMenus = [];
        this.currentRowId = undefined;
        this._hoverRowIndex = -1;
        this.subscriptions = [];
        this.minRowBuffer = 3;
        this.vScrollDir = 1;
        this.rowsCache = {};
        this.lastRenderedScrollTop = 0;
        this.lastRenderedScrollLeft = 0;
        this.prevScrollTop = 0;
        this.prevScrollLeft = 0;
        this.rows = [];
        this.blankTopHeight = 0;
        this.blankBottomHeight = 0;
        this.cellContentFormatter = null;
        // 当启用多选且允许多选中，列表不能编辑时，取选中后禁止触发body 的click 事件
        this.__triggerBodyClickEvent = true;
        this.onBeforeShowContextMenu = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            // row_1_fixedleft  row_1  row_1_fixedright
            var contextMenuDom = e.contextMenuDom, event = e.event;
            if (event.target.closest('.datagrid-editor')) {
                return of({ show: false });
            }
            /** @type {?} */
            var rowID = event.target.id;
            if (contextMenuDom) {
                // 排除分组行、分组合计行
                if (contextMenuDom.className.indexOf('f-datagrid-group-row') === -1 && contextMenuDom.className.indexOf('f-datagrid-group-footer') === -1) {
                    rowID = contextMenuDom.id.replace('row_', '').replace('_fixedleft', '').replace('_fixedright', '');
                    /** @type {?} */
                    var rowData = _this.dfs.findRow(rowID);
                    /** @type {?} */
                    var focusTargetWidth = _this.viewportW > _this.totalWidth ? _this.totalWidth : _this.viewportW;
                    return of({ show: true, data: { data: rowData.data, grid: _this.dg }, focusTargetWidth: focusTargetWidth });
                }
            }
            return of({ show: false });
        });
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.ngZone = this.injector.get(NgZone);
        this.render = this.injector.get(Renderer2);
        /** @type {?} */
        var columnFormatService = this.injector.get(ColumnFormatService);
        this.cellContentFormatter = new FormatCellDataPipe(columnFormatService, this.injector);
    }
    Object.defineProperty(DatagridBodyComponent.prototype, "fixedRightScrollLeft", {
        get: /**
         * @return {?}
         */
        function () {
            return this._fixedRightScrollLeft;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            // this._fixedRightScrollLeft = this.dg.scrollBarShowMode === 'allways' ?  val - 18 : val;
            this._fixedRightScrollLeft = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridBodyComponent.prototype, "hoverRowIndex", {
        get: /**
         * @return {?}
         */
        function () {
            return this._hoverRowIndex;
        },
        set: /**
         * @param {?} rowIdx
         * @return {?}
         */
        function (rowIdx) {
            this._hoverRowIndex = rowIdx;
            this.cd.detectChanges();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridBodyComponent.prototype, "selectedRows", {
        get: /**
         * @return {?}
         */
        function () {
            return this.dg.selections;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridBodyComponent.prototype, "scrollbarXHeight", {
        //////////////////////////////////////////////////////////////////////////
        get: 
        //////////////////////////////////////////////////////////////////////////
        /**
         * @return {?}
         */
        function () {
            if (this.dg && this.ps && this.ps.instance) {
                /** @type {?} */
                var h = this.dg.scrollBarShowMode === 'allways' && this.ps.instance['scrollbarXActive'] ? 22 : 0;
                if (this.ps.instance['scrollbarYActive'] && h) {
                    return h + 18;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridBodyComponent.prototype, "scrollbarYWidth", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.dg && this.ps && this.ps.instance) {
                return this.dg.scrollBarShowMode === 'allways' && this.ps.instance['scrollbarYActive'] && this.showRightShadow ? 18 : 0;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridBodyComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.listenSubjects();
        this.dg.scrollInstance = this.ps;
        /** @type {?} */
        var s1 = this.dgs.showGridHeader.subscribe((/**
         * @param {?} headerHeight
         * @return {?}
         */
        function (headerHeight) {
            _this.updateContainerSize(headerHeight);
        }));
        this.subscriptions.push(s1);
        /** @type {?} */
        var s10 = this.dgs.footerPositionChanged.subscribe((/**
         * @return {?}
         */
        function () {
            _this.updateContainerSize();
        }));
        this.subscriptions.push(s10);
        /** @type {?} */
        var s2 = this.dgs.rowHeightChanged.subscribe((/**
         * @return {?}
         */
        function () {
            _this.cd.detectChanges();
        }));
        this.subscriptions.push(s2);
        /** @type {?} */
        var s3 = this.dfs.clientSort$.subscribe((/**
         * @return {?}
         */
        function () {
            _this.checkScrollbarPosition(true);
            _this.cd.detectChanges();
            // this.dg.columnSorted.emit();
        }));
        this.subscriptions.push(s3);
        /** @type {?} */
        var s5 = this.dg.dgs.columnsChanged.pipe(delay(100)).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (e && e.scrollToLeft) {
                _this.ps.elementRef.nativeElement.scrollTo(0, 0);
                _this.ps.scrollToLeft(0, 100);
            }
        }));
        this.subscriptions.push(s5);
        this.viewScrollContainer.nativeElement.addEventListener('click', this.onMouseClick.bind(this));
    };
    /**
     * @private
     * @param {?=} headerHeight
     * @return {?}
     */
    DatagridBodyComponent.prototype.updateContainerSize = /**
     * @private
     * @param {?=} headerHeight
     * @return {?}
     */
    function (headerHeight) {
        /** @type {?} */
        var hh = headerHeight || this.dg.realHeaderHeight;
        this.setPositionTop(hh);
        this.height = this.dg.height - this.top;
        this.bodyStyle = this.getBodyStyle();
        this.cd.detectChanges();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridBodyComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.data && !changes.data.isFirstChange()) {
            this.bodyStyle = this.getBodyStyle();
            this.dfs.setCurrentPageData(changes.data.currentValue);
            this.onDataChanged();
        }
        if (changes.footerHeight !== undefined && !changes.footerHeight.isFirstChange()) {
            this.bodyStyle = this.getBodyStyle();
        }
        if (changes.scrollBarMode !== undefined && !changes.scrollBarMode.isFirstChange()) {
            if (this.ps && this.ps.instance && this.scrollBarMode === 'allways' && this.ps.instance.scrollbarYActive) {
                this.rightFixedWidth += this.showRightShadow ? 18 : 0;
            }
            else {
                this.rightFixedWidth = this.columnsGroup.rightFixedWidth;
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridBodyComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroySubscriptions();
    };
    /**
     * @return {?}
     */
    DatagridBodyComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    DatagridBodyComponent.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @private
     * @param {?} headerHeight
     * @return {?}
     */
    DatagridBodyComponent.prototype.setPositionTop = /**
     * @private
     * @param {?} headerHeight
     * @return {?}
     */
    function (headerHeight) {
        this.top = headerHeight;
        if ((this.dg.enableFilterRow || this.dg.enableSmartFilter) && this.dg.showFilterBar) {
            this.top += this.dg.filterBarHeight;
        }
        if (this.dg.showRowGroupPanel) {
            this.top += this.dg.rowGroupPanelHeight;
        }
        if (this.dg.showFooter && (this.dg.footerPosition === 'top' || this.dg.footerPosition === 'both')) {
            this.top += this.dg.footerHeight;
        }
    };
    /**
     * @private
     * @param {?=} toTop
     * @return {?}
     */
    DatagridBodyComponent.prototype.checkScrollbarPosition = /**
     * @private
     * @param {?=} toTop
     * @return {?}
     */
    function (toTop) {
        if (toTop === void 0) { toTop = false; }
        if (!this.dg.data || !this.dg.data.length) {
            return;
        }
        /** @type {?} */
        var scrollBar = this.ps.instance;
        /** @type {?} */
        var scrollElRef = this.ps.elementRef.nativeElement;
        // scrollBar.update();
        /** @type {?} */
        var lastScrollLeft = scrollBar ? scrollBar.lastScrollLeft : 0;
        /** @type {?} */
        var lastScrollTop = scrollBar ? scrollBar.lastScrollTop : 0;
        // const lastScrollLeft = this.scrollLeft;
        // const lastScrollTop = this.scrollTop;
        /** @type {?} */
        var scrollTop = scrollElRef.scrollTop;
        /** @type {?} */
        var scrollLeft = scrollElRef.scrollLeft;
        if (!toTop) {
            if (scrollTop != lastScrollTop) {
                this.ps.scrollToTop(lastScrollTop);
                this.dgs.onScrollMove(lastScrollTop, SCROLL_Y_ACTION);
            }
        }
        else {
            this.ps.scrollToTop();
            this.dgs.onScrollMove(lastScrollTop, SCROLL_Y_ACTION);
        }
        this.scrollLeft = lastScrollLeft;
        if (scrollLeft != lastScrollLeft) {
            this.ps.scrollToX(lastScrollLeft);
            this.dgs.onScrollMove(lastScrollLeft, SCROLL_X_ACTION);
        }
        else {
            if (lastScrollLeft) {
                this.dgs.onScrollMove(lastScrollLeft, SCROLL_X_ACTION);
            }
        }
    };
    /**
     * 数据发生变化，重新加载数据时执行
     * 重置滚动条位置
     */
    /**
     * 数据发生变化，重新加载数据时执行
     * 重置滚动条位置
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.onDataChanged = /**
     * 数据发生变化，重新加载数据时执行
     * 重置滚动条位置
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.dg.setPagerHeight();
        this.viewportH = this.getViewPortHeight();
        this.bodyStyle = this.getBodyStyle();
        /**
         * update:
         * node_modules\perfect-scrollbar\types\perfect-scrollbar.d.ts
         * lastScrollTop: number
         */
        if (this.ps && this.ps.instance && !this.dg.isEditing() && !this.dg.clientFilterChanged && !this.dg.autoHeight) {
            this.scrollTop = 0;
            this.lastRenderedScrollTop = 0;
            this.ps.scrollToTop();
            this.scrollLeft = 0;
            this.ps.scrollToLeft();
        }
        this.rowsCache = {};
        /** @type {?} */
        var keepscrollPos = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var scrollInfo = _this.dg.dfs.getState().scrollInfo;
            if (scrollInfo) {
                if (scrollInfo.y) {
                    _this.scrollTop = scrollInfo.y;
                    _this.dg.scrollInstance.scrollToY(scrollInfo.y);
                    _this.dgs.onScrollMove(scrollInfo.y, SCROLL_Y_ACTION);
                }
                if (scrollInfo.x) {
                    _this.scrollLeft = scrollInfo.x;
                    _this.dg.scrollInstance.scrollToX(scrollInfo.x);
                    _this.dg.dgs.onScrollMove(scrollInfo.x, SCROLL_X_ACTION);
                }
            }
        });
        if (!this.dg.nowrap || this.dg.autoHeight) {
            this.renderData(false);
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.updateRowHeight();
            }), 100);
        }
        else {
            keepscrollPos();
            this.renderData(false);
            this.ps.update();
        }
        this.dg.initSelectOrChecked();
        this.dg.clientFilterChanged = false;
        this.dataChange.emit(this.data);
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.destroySubscriptions = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.subscriptions && this.subscriptions.length) {
            this.subscriptions.forEach((/**
             * @param {?} sub
             * @return {?}
             */
            function (sub) {
                if (sub) {
                    sub.unsubscribe();
                    sub = null;
                }
            }));
            this.subscriptions = [];
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.listenSubjects = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.destroySubscriptions();
        this.gridSizeSubscribe = this.dfs.gridSize$.pipe(debounceTime(50)).subscribe((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            if (state) {
                _this.dg.setPagerHeight();
                /** @type {?} */
                var hh = _this.dg.setHeaderHeight();
                _this.setPositionTop(hh);
                _this.height = state.height - _this.top;
                _this.width = Math.floor(state.width);
                _this.rowHeight = state.rowHeight;
                if (_this.dg.showBorder) {
                    _this.width -= 2;
                }
                _this.viewportW = _this.width;
                _this.viewportH = _this.getViewPortHeight();
                _this.canvasHeight = _this.getCanvasHeight();
                _this.ngZone.runOutsideAngular((/**
                 * @return {?}
                 */
                function () {
                    _this.checkScrollbarPosition();
                    _this.updateColumnSize(state.columnsGroup);
                    _this.cd.detectChanges();
                    _this.scrollLeft = _this.ps.elementRef.nativeElement.scrollLeft;
                    _this.maxScrollLeft = _this.colsWidth + _this.leftFixedWidth;
                    // grid 容器宽度
                    /** @type {?} */
                    var dgContainerWidth = _this.dg.dgContainer.nativeElement.offsetWidth;
                    // 所有列宽之和
                    /** @type {?} */
                    var allColsWidth = Math.floor(_this.columnsGroup.totalWidth);
                    // 右侧固定列的位置
                    _this.fixedRightScrollLeft = _this.width - _this.rightFixedWidth + _this.scrollLeft;
                    _this.bodyStyle = _this.getBodyStyle();
                    if (dgContainerWidth > allColsWidth || dgContainerWidth === allColsWidth) {
                        _this.showRightShadow = false;
                        _this.fixedRightScrollLeft = _this.maxScrollLeft;
                    }
                    else {
                        _this.showRightShadow = true;
                    }
                    _this.renderData(false);
                    if (!_this.dg.nowrap || _this.dg.autoHeight) {
                        /** @type {?} */
                        var _timer = null;
                        if (_timer) {
                            _timer.clearTimeout();
                        }
                        _timer = setTimeout((/**
                         * @return {?}
                         */
                        function () {
                            _this.updateRowHeight();
                            _this.ps.update();
                        }), 100);
                    }
                    else {
                        if (!_this.cd['destroyed']) {
                            _this.ps.update();
                            _this.cd.detectChanges();
                        }
                    }
                    // this.ps.update();
                    _this.dgs.showFixedShadow.emit({ showRightShadow: _this.showRightShadow, x: _this.fixedRightScrollLeft });
                }));
                if (_this.scrollBarMode === 'allways') {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.updateColumnSize(_this.columnsGroup);
                        _this.dgs.scrollbarUpdate.emit({ scrollbarRef: _this.ps.instance });
                    }), 50);
                }
            }
        }));
        this.subscriptions.push(this.gridSizeSubscribe);
        this.columnResizeSubscribe = this.dfs.columnResize$.subscribe((/**
         * @param {?} cg
         * @return {?}
         */
        function (cg) {
            _this.updateColumnSize(cg);
            _this.cd.detectChanges();
        }));
        this.subscriptions.push(this.columnResizeSubscribe);
        this.dgs.setSelecedRow.subscribe((/**
         * @param {?} r
         * @return {?}
         */
        function (r) {
            if (r && r.selected) {
                _this.currentRowId = r.id;
            }
            else {
                _this.currentRowId = undefined;
            }
        }));
        this.selectRowSubscribe = this.dfs.selectRow$.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            if (row) {
                _this.currentRowId = row.id;
                // 20210817 方向键移动后刷新视图状态
                _this.cd.detectChanges();
            }
        }));
        this.subscriptions.push(this.selectRowSubscribe);
        this.unselectRowSubscribe = this.dfs.unSelectRow$.subscribe((/**
         * @param {?} prevRow
         * @return {?}
         */
        function (prevRow) {
            if (prevRow && prevRow.id === _this.currentRowId) {
                _this.currentRowId = undefined;
                _this.dg.selectedRow = null;
            }
            if (!_this.dg.editable && _this.dg.multiSelect) {
                _this.__triggerBodyClickEvent = _this.dg.selectionMode === 'default';
            }
            _this.cd.detectChanges();
        }));
        this.subscriptions.push(this.unselectRowSubscribe);
        this.selectAllSubscribe = this.dfs.selectAll$.subscribe((/**
         * @param {?} rows
         * @return {?}
         */
        function (rows) {
            _this.dg.selectAll.emit(rows);
            _this.cd.detectChanges();
        }));
        this.subscriptions.push(this.selectAllSubscribe);
        this.checkRowSubscribe = this.dfs.checkRow$.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            _this.dg.checked.emit(row);
            _this.checkedRowsChanged();
            // this.cd.detectChanges();
        }));
        this.subscriptions.push(this.checkRowSubscribe);
        this.clearSelectionsSubscribe = this.dfs.clearSelections$.subscribe((/**
         * @return {?}
         */
        function () {
            _this.currentRowId = undefined;
            if (_this.dg.checkOnSelect) {
                _this.checkedRowsChanged();
            }
            _this.dg.unSelectAll.emit();
        }));
        this.subscriptions.push(this.clearSelectionsSubscribe);
        this.uncheckRowSubscribe = this.dfs.unCheckRow$.subscribe((/**
         * @param {?} prevRow
         * @return {?}
         */
        function (prevRow) {
            _this.dg.unChecked.emit(prevRow);
            _this.checkedRowsChanged();
            // this.cd.detectChanges();
        }));
        this.subscriptions.push(this.uncheckRowSubscribe);
        this.checkAllSubscribe = this.dfs.checkAll$.subscribe((/**
         * @param {?} rows
         * @return {?}
         */
        function (rows) {
            _this.dg.checkAll.emit(rows);
            _this.checkedRowsChanged();
            // this.cd.detectChanges();
        }));
        this.subscriptions.push(this.checkAllSubscribe);
        this.clearCheckedsSubscribe = this.dfs.clearCheckeds$.subscribe((/**
         * @param {?} rows
         * @return {?}
         */
        function (rows) {
            if (_this.dg.selectOnCheck) {
                _this.currentRowId = undefined;
            }
            _this.dg.unCheckAll.emit(rows);
            _this.checkedRowsChanged();
            _this.cd.detectChanges();
        }));
        this.subscriptions.push(this.clearCheckedsSubscribe);
        this.subscriptions.push(this.dgs.setScrollbarPosition.subscribe((/**
         * @return {?}
         */
        function () {
            _this.checkScrollbarPosition();
            _this.updateScrollPosition(_this.scrollLeft);
        })));
        this.dgs.columnResized.pipe(delay(100)).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (!_this.dg.nowrap ||
                (_this.dg.currentCell && _this.dg.currentCell.isEditing && _this.dg.currentCell.column &&
                    _this.dg.currentCell.column.editor && _this.dg.currentCell.column.editor.type === 'textarea')) {
                /** @type {?} */
                var trdoms = _this.dg.dgContainer.nativeElement.querySelectorAll('.f-datagrid-body-row:not(f-datagrid-footer-row)');
                trdoms.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.style.height = 'auto'; }));
                /** @type {?} */
                var trID = '';
                if (e) {
                    /** @type {?} */
                    var rowId = e.id;
                    trID = TR_PREFIX + rowId;
                }
                _this.updateRowHeight(trID);
                // trdoms.forEach(n => n.style.height = '');
            }
            if (_this.dg.headerWrap) {
                _this.dg.setHeaderHeight();
                _this.dfs.columnResizeEnd();
            }
        }));
        this.dgs.cellContentWrapChanged.pipe(delay(100)).subscribe((/**
         * @return {?}
         */
        function () {
            _this.updateRowHeight();
        }));
        this.dg.dfs.rowUpdate$.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            if (row && row.data) {
                _this.buildCustomCellStyle(row);
            }
        }));
    };
    /**
     * @private
     * @param {?} row
     * @return {?}
     */
    DatagridBodyComponent.prototype.buildCustomCellStyle = /**
     * @private
     * @param {?} row
     * @return {?}
     */
    function (row) {
        var _this = this;
        /** @type {?} */
        var rightTrs = [];
        /** @type {?} */
        var leftTrs = [];
        if (this.fixedRightEl) {
            rightTrs = this.fixedRightEl.nativeElement.querySelectorAll('tr');
        }
        if (this.fixedLeftEl) {
            leftTrs = this.fixedLeftEl.nativeElement.querySelectorAll('.fixed-left-row');
        }
        /** @type {?} */
        var trs = this.mainArea.nativeElement.querySelectorAll('tr.f-datagrid-body-row');
        /** @type {?} */
        var updateCellStyle = (/**
         * @param {?} arr
         * @param {?} col
         * @param {?} style
         * @return {?}
         */
        function (arr, col, style) {
            if (arr.length) {
                /** @type {?} */
                var td = arr[row.index].querySelector("[field=\"" + col.field + "\"]");
                if (td) {
                    _this.dg.renderCustomStyle(style, td);
                }
            }
        });
        this.dg.flatColumns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        function (col) {
            if (col.styler) {
                /** @type {?} */
                var _rd = row.data;
                /** @type {?} */
                var cs = col.styler(_rd[col.field], _rd, row.index);
                if (cs && Object.keys(cs).length) {
                    updateCellStyle(leftTrs, col, cs);
                    updateCellStyle(rightTrs, col, cs);
                    updateCellStyle(trs, col, cs);
                }
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.checkedRowsChanged = /**
     * @private
     * @return {?}
     */
    function () {
        this.dgs.onCheckedRowsCountChange();
        /** @type {?} */
        var checkedRows = this.dg.checkeds;
        this.dg.checkValues = checkedRows.map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return r.id; }));
        this.dg.checkValuesChange.emit(this.dg.checkValues);
        this.dg.checkedChange.emit(checkedRows);
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.getTrDomHeight = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var list = [];
        /** @type {?} */
        var rightTrs = [];
        /** @type {?} */
        var leftTrs = [];
        /** @type {?} */
        var trdoms = [];
        if (this.fixedRightEl) {
            rightTrs = this.fixedRightEl.nativeElement.querySelectorAll('tr');
        }
        if (this.fixedLeftEl) {
            leftTrs = this.fixedLeftEl.nativeElement.querySelectorAll('.fixed-left-row');
        }
        if (this.mainArea) {
            trdoms = this.mainArea.nativeElement.querySelectorAll('tr.f-datagrid-body-row');
        }
        trdoms.forEach((/**
         * @param {?} tr
         * @param {?} i
         * @return {?}
         */
        function (tr, i) {
            /** @type {?} */
            var t1 = 0;
            /** @type {?} */
            var t2 = Math.ceil(tr.offsetHeight);
            /** @type {?} */
            var t3 = 0;
            if (leftTrs && leftTrs.length) {
                t1 = Math.ceil(leftTrs[i].offsetHeight);
            }
            if (rightTrs && rightTrs.length) {
                t3 = Math.ceil(rightTrs[i].offsetHeight);
            }
            /** @type {?} */
            var _h = Math.max(t1, t2, t3, _this.dg.rowHeight);
            list.push(_h);
        }));
        return list;
    };
    /** 允许数据折行时，计算行号的行高 */
    /**
     * 允许数据折行时，计算行号的行高
     * @param {?=} trDomId
     * @return {?}
     */
    DatagridBodyComponent.prototype.updateRowHeight = /**
     * 允许数据折行时，计算行号的行高
     * @param {?=} trDomId
     * @return {?}
     */
    function (trDomId) {
        var _this = this;
        if (trDomId === void 0) { trDomId = null; }
        if (!this.mainArea) {
            return;
        }
        /** @type {?} */
        var dgBody = this.el.nativeElement.querySelector('div.f-datagrid-body');
        if (dgBody) {
            if (!this.dg.nowrap || this.dg.autoHeight) {
                this.render.addClass(dgBody, 'data-wrap');
            }
            else {
                this.render.removeClass(dgBody, 'data-wrap');
            }
        }
        /** @type {?} */
        var cssTextArr = [];
        if (!trDomId) {
            this.rows.forEach((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            function (r, i) {
                /** @type {?} */
                var rowId = _this.dfs.primaryId(r);
                /** @type {?} */
                var trID = TR_PREFIX + rowId;
                /** @type {?} */
                var leftTrId = trID + '_fixedleft';
                /** @type {?} */
                var rightTrId = trID + '_fixedright';
                if (!_this.dg.nowrap || _this.dg.autoHeight) {
                    /** @type {?} */
                    var list = _this.getTrDomHeight();
                    /** @type {?} */
                    var h = list[i];
                    cssTextArr.push(_this.dg.customStyleKey() + " .f-datagrid-body.data-wrap #" + leftTrId + "{ height: " + h + "px }");
                    cssTextArr.push(_this.dg.customStyleKey() + " .f-datagrid-body.data-wrap #" + trID + "{ height: " + h + "px }");
                    cssTextArr.push(_this.dg.customStyleKey() + " .f-datagrid-body.data-wrap #" + rightTrId + "{ height: " + h + "px }");
                }
                else {
                    // cssTextArr.push(`${this.dg.customStyleKey()} .f-datagrid-body #${leftTrId}{ height: ${list[i]}px }`);
                    // cssTextArr.push(`${this.dg.customStyleKey()} .f-datagrid-body #${trID}{ height: ${list[i]}px }`);
                    // cssTextArr.push(`${this.dg.customStyleKey()} .f-datagrid-body #${rightTrId}{ height: ${list[i]}px }`);
                    /** @type {?} */
                    var key1 = _this.dg.customStyleKey() + " .f-datagrid-body #" + leftTrId;
                    /** @type {?} */
                    var key2 = _this.dg.customStyleKey() + " .f-datagrid-body #" + trID;
                    /** @type {?} */
                    var key3 = _this.dg.customStyleKey() + " .f-datagrid-body #" + rightTrId;
                    _this.dgs.removeCssRule(key1);
                    _this.dgs.removeCssRule(key2);
                    _this.dgs.removeCssRule(key3);
                }
            }));
            this.dgs.appendCssRules(cssTextArr);
        }
        else {
            cssTextArr = [];
            /** @type {?} */
            var domSel = '#' + trDomId;
            /** @type {?} */
            var _arr = [];
            if (this.fixedRightEl) {
                /** @type {?} */
                var rtr = this.fixedRightEl.nativeElement.querySelector(domSel);
                if (rtr) {
                    _arr.push(Math.ceil(rtr.offsetHeight));
                }
            }
            if (this.fixedLeftEl) {
                /** @type {?} */
                var ltr = this.fixedLeftEl.nativeElement.querySelector(domSel);
                if (ltr) {
                    _arr.push(Math.ceil(ltr.offsetHeight));
                }
            }
            if (this.mainArea) {
                /** @type {?} */
                var tr = this.mainArea.nativeElement.querySelector(domSel);
                if (tr) {
                    _arr.push(Math.ceil(tr.offsetHeight));
                }
            }
            /** @type {?} */
            var _h = Math.max.apply(Math, tslib_1.__spread(_arr));
            /** @type {?} */
            var leftTrId = trDomId + '_fixedleft';
            /** @type {?} */
            var rightTrId = trDomId + '_fixedright';
            if (!this.dg.nowrap || this.dg.autoHeight) {
                cssTextArr.push(this.dg.customStyleKey() + " .f-datagrid-body.data-wrap #" + leftTrId + "{ height: " + _h + "px;}");
                cssTextArr.push(this.dg.customStyleKey() + " .f-datagrid-body.data-wrap #" + trDomId + "{ height: " + _h + "px;}");
                cssTextArr.push(this.dg.customStyleKey() + " .f-datagrid-body.data-wrap #" + rightTrId + "{ height: " + _h + "px;}");
            }
            else {
                cssTextArr.push(this.dg.customStyleKey() + " .f-datagrid-body #" + leftTrId + "{ height: " + _h + "px }");
                cssTextArr.push(this.dg.customStyleKey() + " .f-datagrid-body #" + trDomId + "{ height: " + _h + "px }");
                cssTextArr.push(this.dg.customStyleKey() + " .f-datagrid-body #" + rightTrId + "{ height: " + _h + "px }");
            }
            this.dgs.appendCssRules(cssTextArr);
        }
        this.updateCanvasHeight();
        // 移除height: auto
        /** @type {?} */
        var trdoms = this.dg.dgContainer.nativeElement.querySelectorAll('.f-datagrid-body-row:not(f-datagrid-footer-row)');
        trdoms.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.style.height = ''; }));
        if (!this.cd['destroyed']) {
            this.cd.detectChanges();
        }
    };
    /**
     * @private
     * @param {?} cg
     * @return {?}
     */
    DatagridBodyComponent.prototype.updateColumnSize = /**
     * @private
     * @param {?} cg
     * @return {?}
     */
    function (cg) {
        if (cg) {
            this.columnsGroup = cg;
            this.leftFixedWidth = this.columnsGroup.leftFixedWidth;
            this.rightFixedWidth = this.columnsGroup.rightFixedWidth;
            if (this.ps && this.ps.instance && this.dg.scrollBarShowMode === 'allways' && this.ps.instance.scrollbarYActive) {
                this.rightFixedWidth += this.showRightShadow ? 18 : 0;
            }
            this.colsWidth = this.columnsGroup.normalWidth; // + (this.showRightShadow ? 18 : 0);
            this.totalWidth = this.columnsGroup.totalWidth;
            if (this.scrollBarMode === 'allways' && !this.rightRowsCmp && !this.dg.useControlPanel) {
                this.totalWidth += 18;
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.getBodyStyle = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var h = this.getViewPortHeight();
        if (!this.data.length) {
            if (this.dg.autoHeight) {
                h = this.dg.emptyDataHeight;
            }
            if (this.dg.footerData && this.dg.showFooter) {
                /** @type {?} */
                var fd = this.dg.footerData;
                if (this.dg.footerData.subscribe) {
                    fd = this.dg.footerData['value'];
                }
                if (fd && Array.isArray(fd) && fd.length) {
                    h = h - this.dg.footerHeight;
                }
            }
        }
        else {
            if (this.dg.showFooter && this.dg.footerPosition === 'both') {
                h = h - this.dg.footerHeight;
            }
        }
        return {
            height: Math.floor(h) + "px"
        };
    };
    /**
     * @private
     * @param {?} scrollLeft
     * @return {?}
     */
    DatagridBodyComponent.prototype.updateScrollPosition = /**
     * @private
     * @param {?} scrollLeft
     * @return {?}
     */
    function (scrollLeft) {
        this.scrollLeft = scrollLeft;
        this.fixedRightScrollLeft = this.scrollLeft + this.width - this.rightFixedWidth;
        if (this.fixedRightScrollLeft === this.maxScrollLeft || this.fixedRightScrollLeft > this.maxScrollLeft) {
            this.fixedRightScrollLeft = this.maxScrollLeft;
            this.showRightShadow = false;
        }
        else {
            this.showRightShadow = true;
        }
        if (this.fixedLeftEl) {
            this.render.setStyle(this.fixedLeftEl.nativeElement, 'transform', "translate3d(" + this.scrollLeft + "px, 0px, 0px)");
        }
        if (this.fixedRightEl) {
            this.render.setStyle(this.fixedRightEl.nativeElement, 'transform', "translate3d(" + this.fixedRightScrollLeft + "px, 0px, 0px)");
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridBodyComponent.prototype.onScrollToX = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var x = $event.target.scrollLeft;
        this.updateScrollPosition(x);
        // this.cd.detectChanges();
        this.dgs.onScrollMove(x, SCROLL_X_ACTION);
        this.dgs.showFixedShadow.emit({ showRightShadow: this.showRightShadow, x: this.fixedRightScrollLeft });
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridBodyComponent.prototype.onScrollToY = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var y = $event.target.scrollTop;
        if (this.dg.virtualized) {
            this.handleScroll();
        }
        this.scrollTop = y;
        this.dg.scrollY.emit(y);
        this.dgs.onScrollMove(y, SCROLL_Y_ACTION);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridBodyComponent.prototype.onPsXReachStart = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var x = $event.target.scrollLeft;
        this.updateScrollPosition(x);
        this.dgs.onScrollMove(x, SCROLL_X_REACH_START_ACTION);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridBodyComponent.prototype.onPsXReachEnd = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.showRightShadow = false;
        // const x = $event.target.scrollLeft;
        // this.updateScrollPosition(x);
        // this.cd.detectChanges();
        // // this.dgs.onShowFixedShadow(this.showRightShadow);
        // this.dgs.onScrollMove(x, SCROLL_X_REACH_END_ACTION);
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridBodyComponent.prototype.isChecked = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData) {
            return this.dfs.isRowChecked(rowData[this.dg.idField]);
        }
        else {
            return false;
        }
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridBodyComponent.prototype.isSelected = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData) {
            return this.dfs.isRowSelected(rowData[this.dg.idField]);
        }
        return false;
    };
    /**
     * @param {?} row
     * @param {?=} open
     * @return {?}
     */
    DatagridBodyComponent.prototype.toggleGroupRow = /**
     * @param {?} row
     * @param {?=} open
     * @return {?}
     */
    function (row, open) {
        if (open === void 0) { open = true; }
        row.expanded = open;
        this.ps.update();
    };
    /** =================================== 分 ====== 隔 ====== 线 =================================== */
    /** 获取可视区域高度 */
    /** =================================== 分 ====== 隔 ====== 线 =================================== */
    /**
     * 获取可视区域高度
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.getViewPortHeight = /** =================================== 分 ====== 隔 ====== 线 =================================== */
    /**
     * 获取可视区域高度
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var viewPortHeight = this.dg.height;
        if (this.dg.showHeader) {
            viewPortHeight = viewPortHeight - this.dg.realHeaderHeight;
        }
        if ((this.dg.enableFilterRow || this.dg.enableSmartFilter) && this.dg.showFilterBar) {
            viewPortHeight -= this.dg.filterBarHeight;
        }
        if (this.dg.showRowGroupPanel) {
            viewPortHeight -= this.dg.rowGroupPanelHeight;
        }
        if (this.dg.showFooter && this.data.length) {
            viewPortHeight = viewPortHeight - this.dg.footerHeight;
        }
        if (this.dg.pagination) {
            viewPortHeight = viewPortHeight - this.dg.pagerHeight - 2;
        }
        if (this.dg.showBorder) {
            viewPortHeight -= 2;
        }
        this.viewportH = viewPortHeight;
        return viewPortHeight;
    };
    // 不折行时，所有数据的高度
    // 不折行时，所有数据的高度
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.allRowsHeight = 
    // 不折行时，所有数据的高度
    /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var rowHeightpatch = 1;
        // this.dg.autoHeight ? 2 : 1;
        /** @type {?} */
        var rowHeight = this.dg.rowHeight + rowHeightpatch;
        /** @type {?} */
        var itemsCount = 0;
        if (this.dg.groupSummaryPosition === 'inGroupRow') {
            itemsCount = this.data.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !n['__group_footer__']; })).length;
        }
        else {
            itemsCount = this.data.length;
        }
        /** @type {?} */
        var h = itemsCount * rowHeight;
        if (this.dg.autoHeight) {
            h += itemsCount;
        }
        else {
            h += 2;
        }
        return h;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.getCanvasHeight = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var canvasHeight = 0;
        if (!this.data || !this.data.length) {
            this.canvasHeight = 0;
            return 0;
        }
        if (this.dg.nowrap) {
            canvasHeight = this.allRowsHeight();
        }
        else {
            canvasHeight = this.getTrDomHeight().reduce((/**
             * @param {?} r
             * @param {?} c
             * @return {?}
             */
            function (r, c) { return r + c; }), 0);
        }
        if (!canvasHeight) {
            canvasHeight = this.viewportH;
        }
        this.canvasHeight = canvasHeight;
        return canvasHeight;
    };
    /**
     * @return {?}
     */
    DatagridBodyComponent.prototype.updateCanvasHeight = /**
     * @return {?}
     */
    function () {
        this.canvasHeight = this.getCanvasHeight();
    };
    /**
     * @private
     * @param {?} y
     * @return {?}
     */
    DatagridBodyComponent.prototype.getRowFromPosition = /**
     * @private
     * @param {?} y
     * @return {?}
     */
    function (y) {
        return Math.floor(y / (this.dg.rowHeight + 1));
    };
    /**
     * @param {?=} viewportTop
     * @param {?=} viewportLeft
     * @return {?}
     */
    DatagridBodyComponent.prototype.getVisibleRange = /**
     * @param {?=} viewportTop
     * @param {?=} viewportLeft
     * @return {?}
     */
    function (viewportTop, viewportLeft) {
        if (viewportTop == null) {
            viewportTop = this.scrollTop;
        }
        if (viewportLeft == null) {
            viewportLeft = this.scrollLeft;
        }
        return {
            top: this.getRowFromPosition(viewportTop),
            bottom: this.getRowFromPosition(viewportTop + this.viewportH) + 1,
            leftPx: viewportLeft,
            rightPx: viewportLeft + this.viewportW
        };
    };
    /**
     * @private
     * @param {?=} viewportTop
     * @param {?=} viewportLeft
     * @return {?}
     */
    DatagridBodyComponent.prototype.getRenderedRange = /**
     * @private
     * @param {?=} viewportTop
     * @param {?=} viewportLeft
     * @return {?}
     */
    function (viewportTop, viewportLeft) {
        /** @type {?} */
        var range = this.getVisibleRange(viewportTop, viewportLeft);
        /** @type {?} */
        var buffer = Math.round(this.viewportH / (this.dg.rowHeight + 1));
        /** @type {?} */
        var minBuffer = this.minRowBuffer;
        if (this.vScrollDir == -1) {
            range.top -= buffer;
            range.bottom += minBuffer;
        }
        else if (this.vScrollDir == 1) {
            range.top -= minBuffer;
            range.bottom += buffer;
        }
        else {
            range.top -= minBuffer;
            range.bottom += minBuffer;
        }
        range.top = Math.max(0, range.top);
        range.bottom = Math.min(this.data.length - 1, range.bottom);
        range.leftPx -= this.viewportW;
        range.rightPx += this.viewportW;
        range.leftPx = Math.max(0, range.leftPx);
        range.rightPx = Math.min(this.canvasWidth, range.rightPx);
        return range;
    };
    /**
     * @private
     * @param {?} range
     * @return {?}
     */
    DatagridBodyComponent.prototype.renderRows = /**
     * @private
     * @param {?} range
     * @return {?}
     */
    function (range) {
        var _this = this;
        /** @type {?} */
        var rows = [];
        /** @type {?} */
        var dataLength = this.data.length;
        for (var i = range.top; i <= range.bottom; i++) {
            if (this.rowsCache[i] || (i == dataLength)) {
                continue;
            }
            rows.push(i);
            // Create an entry right away so that appendRowHtml() can
            // start populatating it.
            this.rowsCache[i] = {
                rowNode: null,
                // ColSpans of rendered cells (by column idx).
                // Can also be used for checking whether a cell has been rendered.
                cellColSpans: [],
                // Cell nodes (by column idx).  Lazy-populated by ensureCellNodesInRowsCache().
                cellNodesByColumnIdx: [],
                // Column indices of cell nodes that have been rendered, but not yet indexed in
                // cellNodesByColumnIdx.  These are in the same order as cell nodes added at the
                // end of the row.
                cellRenderQueue: []
            };
        }
        for (var i = 0, ii = rows.length; i < ii; i++) {
            this.rowsCache[rows[i]].rowNode = this.data[rows[i]];
        }
        return Object.keys(this.rowsCache).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return _this.rowsCache[n].rowNode; }));
    };
    /**
     * @private
     * @param {?} row
     * @return {?}
     */
    DatagridBodyComponent.prototype.removeRowFromCache = /**
     * @private
     * @param {?} row
     * @return {?}
     */
    function (row) {
        /** @type {?} */
        var cacheEntry = this.rowsCache[row];
        if (!cacheEntry) {
            return;
        }
        delete this.rowsCache[row];
    };
    /**
     * @private
     * @param {?} rangeToKeep
     * @return {?}
     */
    DatagridBodyComponent.prototype.cleanupRows = /**
     * @private
     * @param {?} rangeToKeep
     * @return {?}
     */
    function (rangeToKeep) {
        for (var i in this.rowsCache) {
            if (i < rangeToKeep.top || i > rangeToKeep.bottom) {
                this.removeRowFromCache(i);
            }
        }
    };
    /**
     * @private
     * @param {?=} detectchanges
     * @return {?}
     */
    DatagridBodyComponent.prototype.renderData = /**
     * @private
     * @param {?=} detectchanges
     * @return {?}
     */
    function (detectchanges) {
        if (detectchanges === void 0) { detectchanges = true; }
        this.canvasHeight = this.getCanvasHeight();
        if (!this.dg.virtualized || this.dg.autoHeight) {
            this.rows = this.data;
        }
        else {
            /** @type {?} */
            var visible = this.getVisibleRange();
            /** @type {?} */
            var rendered = this.getRenderedRange();
            // remove rows no longer in the viewport
            this.cleanupRows(rendered);
            // render missing rows
            this.rows = this.renderRows(rendered);
            this.startRowIndex = rendered.top;
            this.blankTopHeight = this.startRowIndex * (this.dg.rowHeight + 1);
            this.blankBottomHeight = this.canvasHeight - this.blankTopHeight - (this.rows.length * (this.dg.rowHeight + 1));
            this.lastRenderedScrollTop = this.scrollTop;
            this.lastRenderedScrollLeft = this.scrollLeft;
            if (detectchanges) {
                this.cd.detectChanges();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype.handleScroll = /**
     * @private
     * @return {?}
     */
    function () {
        this.scrollTop = this.ps.elementRef.nativeElement.scrollTop;
        this.scrollLeft = this.ps.elementRef.nativeElement.scrollLeft;
        return this._handleScroll();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridBodyComponent.prototype._handleScroll = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var viewportContainer = this.viewScrollContainer.nativeElement;
        /** @type {?} */
        var maxScrollDistanceY = viewportContainer.scrollHeight - viewportContainer.clientHeight;
        /** @type {?} */
        var maxScrollDistanceX = viewportContainer.scrollWidth - viewportContainer.clientWidth;
        // Protect against erroneous clientHeight/Width greater than scrollHeight/Width.
        // Sometimes seen in Chrome.
        maxScrollDistanceY = Math.max(0, maxScrollDistanceY);
        maxScrollDistanceX = Math.max(0, maxScrollDistanceX);
        // Ceiling the max scroll values
        if (this.scrollTop > maxScrollDistanceY) {
            this.scrollTop = maxScrollDistanceY;
        }
        if (this.scrollLeft > maxScrollDistanceX) {
            this.scrollLeft = maxScrollDistanceX;
        }
        /** @type {?} */
        var vScrollDist = Math.abs(this.scrollTop - this.prevScrollTop);
        /** @type {?} */
        var hScrollDist = Math.abs(this.scrollLeft - this.prevScrollLeft);
        if (hScrollDist) {
            this.prevScrollLeft = this.scrollLeft;
            // $viewportScrollContainerX[0].scrollLeft = scrollLeft;
            // if (hasFrozenColumns()) {
            //     if (hasFrozenRows) {
            //         $viewportTopR[0].scrollLeft = scrollLeft;
            //     }
            // } else {
            //     if (hasFrozenRows) {
            //         $viewportTopL[0].scrollLeft = scrollLeft;
            //     }
            // }
        }
        if (vScrollDist) {
            this.vScrollDir = this.prevScrollTop < this.scrollTop ? 1 : -1;
            this.prevScrollTop = this.scrollTop;
            // if (hasFrozenColumns()) {
            //     if (hasFrozenRows && !options.frozenBottom) {
            //         $viewportBottomL[0].scrollTop = scrollTop;
            //     } else {
            //         $viewportTopL[0].scrollTop = scrollTop;
            //     }
            // }
            // switch virtual pages if needed
            if (vScrollDist < this.viewportH) {
                this._scrollTo(this.scrollTop);
            }
        }
        if (hScrollDist || vScrollDist) {
            /** @type {?} */
            var dx = Math.abs(this.lastRenderedScrollLeft - this.scrollLeft);
            /** @type {?} */
            var dy = Math.abs(this.lastRenderedScrollTop - this.scrollTop);
            if (dx > 20 || dy > 20) {
                // if rendering is forced or scrolling is small enough to be "easy", just render
                if (dy < this.viewportH && dx < this.viewportW) {
                    this.renderData();
                }
                else {
                    this.renderData();
                }
            }
        }
        if (hScrollDist || vScrollDist) {
            return true;
        }
        return false;
    };
    /**
     * @private
     * @param {?} y
     * @return {?}
     */
    DatagridBodyComponent.prototype._scrollTo = /**
     * @private
     * @param {?} y
     * @return {?}
     */
    function (y) {
        /** @type {?} */
        var $viewportScrollContainerY = this.viewScrollContainer.nativeElement;
        y = Math.max(y, 0);
        y = Math.min(y, this.canvasHeight - this.viewportH);
        /** @type {?} */
        var newScrollTop = y;
        if (this.prevScrollTop != newScrollTop) {
            this.vScrollDir = (this.prevScrollTop < newScrollTop) ? 1 : -1;
            this.lastRenderedScrollTop = (this.scrollTop = this.prevScrollTop = newScrollTop);
            // if (hasFrozenColumns()) {
            //     $viewportTopL[0].scrollTop = newScrollTop;
            // }
            // if (hasFrozenRows) {
            //     $viewportBottomL[0].scrollTop = $viewportBottomR[0].scrollTop = newScrollTop;
            // }
            // $viewportScrollContainerY.scrollTop = newScrollTop;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridBodyComponent.prototype.onMouseClick = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        // document.body.click();
        /** @type {?} */
        var target = (/** @type {?} */ ($event.target));
        if (target.nodeName === 'TEXTAREA' || target.nodeName === 'INPUT') {
            return;
        }
        /** @type {?} */
        var td = target;
        if (target.nodeName !== 'TD') {
            td = target.closest('TD');
        }
        if (!this.dg.editable && this.__triggerBodyClickEvent) {
            // 解决超链点击事件，要先执行选中行
            if (td && td.selectCell) {
                $event.stopPropagation();
                td.selectCell($event, td); // 按理说可以删除的，但不敢动哦o(≧口≦)o
            }
            return;
        }
        if (this.dg.editMode === 'row') {
            return;
        }
        if (td) {
            // 行禁用时
            if (this.dg.disableRow && td.gridCellData) {
                var _a = td.gridCellData, rowData = _a.rowData, rowIndex = _a.rowIndex;
                if (this.dg.disableRow(rowData, rowIndex)) {
                    return;
                }
            }
            if (this.dg.editable && this.dg.editMode === 'cell' && td.edit) {
                td.edit($event);
            }
            else {
                if (td.selectCell) {
                    $event.stopPropagation();
                    td.closeEdit();
                    td.selectCell($event, td);
                }
            }
        }
    };
    DatagridBodyComponent.decorators = [
        { type: Component, args: [{
                    selector: 'datagrid-body',
                    template: "<!--\r\n * @Author: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:07\r\n * @LastEditors: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @LastEditTime: 2019-11-26 08:20:46\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n -->\r\n\r\n<ng-container  *ngIf=\"!data || !data.length\">\r\n    <div *ngIf=\"!dg.emptyTemplate\" class=\"d-flex flex-column f-datagrid-norecords\" style=\"position:absolute; margin:0;left: 0; z-index: 1;justify-content: center; align-items: center;\" [ngStyle]=\"bodyStyle\" [style.top.px]=\"top\" [style.width.px]=\"viewportW\" >\r\n        <div class=\"f-datagrid-norecords-content\" style=\"margin: 0;width: 100%;position: relative; top: 0\">\r\n            {{ 'datagrid.emptyMessage' | locale }}\r\n        </div>\r\n    </div>\r\n    <div class=\"f-datagrid-body\" [ngStyle]=\"bodyStyle\" [style.top.px]=\"top\" [style.width.px]=\"viewportW\" style=\"z-index: 1;\"  *ngIf=\"dg.emptyTemplate\">\r\n        <ng-container #emptyTemplate [ngTemplateOutlet]=\"dg.emptyTemplate\" ></ng-container>\r\n    </div>\r\n</ng-container>\r\n<div  class=\"f-datagrid-body\" [ngStyle]=\"bodyStyle\" [style.top.px]=\"top\" [style.width.px]=\"viewportW\" \r\n[farris-context-menus]=\"contextMenuItems\" [disabled]=\"!dg.enableContextMenu\" [activeDomName]=\"'tr'\" [beforeShowContextMenu]=\"onBeforeShowContextMenu\"\r\n[menuClass]=\"'f-datagrid-context-menu'\">\r\n\r\n    <div #viewScrollContainer [scrollbar]=\"psConfig\" #ps=\"ngxScrollbar\"\r\n        class=\"ps f-datagrid-body-wheel-area\" \r\n        [ngStyle]=\"bodyStyle\" style=\"width: 100%;\"\r\n        (psXReachEnd)=\"onPsXReachEnd($event)\"\r\n        (psScrollY)=\"onScrollToY($event)\"\r\n        (psScrollX)=\"onScrollToX($event)\" (psXReachStart)=\"onPsXReachStart($event)\"\r\n        [style.paddingBottom.px]=\"scrollbarXHeight\"\r\n        [style.paddingRight.px]=\"scrollbarYWidth\">\r\n       \r\n        <div class=\"f-datagrid-norecords\"  [auto-height]=\"dg.autoHeight\" [wheelHeight]=\"dg.emptyDataHeight || 240\" style=\"height: 100%\" [style.width.px]=\"canvasWidth - 2\"  *ngIf=\"!data || !data.length\">\r\n            <!-- <div *ngIf=\"!dg.emptyTemplate\" class=\"f-datagrid-norecords-content\" style=\"width: 100%\" >{{ 'datagrid.emptyMessage' | locale }}</div>\r\n            <ng-container #emptyTemplate *ngIf=\"dg.emptyTemplate\" [ngTemplateOutlet]=\"dg.emptyTemplate\" ></ng-container> -->\r\n        </div>\r\n\r\n        <div [style.display]=\"dg.flatColumns?.length ? '': 'none'\"  *ngIf=\"data && data.length\"\r\n            class=\"f-datagrid-bg\" [auto-height]=\"dg.autoHeight\" [wheelHeight]=\"canvasHeight\"\r\n            [style.height.px]=\"canvasHeight\" [style.width.px]=\"totalWidth\" >\r\n            \r\n                <div #blankTop hidefocus style=\"width: 100%\" [style.height.px]=\"blankTopHeight\"></div>\r\n                \r\n                <div #fixedLeft class=\"f-datagrid-table f-datagrid-body-fixed-left\"  [class.f-datagrid-fixed-left-shadow]=\"!!scrollLeft && !dg.groupRows\"\r\n                    *ngIf=\"dg.showLineNumber || dg.showCheckbox || (columnsGroup?.leftFixed && columnsGroup?.leftFixed.length)\"  [style.width.px]=\"leftFixedWidth\" \r\n                    [style.transform]=\"'translate3d('+ scrollLeft +'px, 0px, 0px)'\">\r\n\r\n                    <fixed-left-rows [columns]=\"columnsGroup?.leftFixed\" [checkedRows]=\"checkedRows\" [selectedRows]=\"selectedRows\" [data]=\"rows\"></fixed-left-rows>\r\n                </div>\r\n\r\n                <div #fixedRight class=\"f-datagrid-table f-datagrid-body-fixed-right\" [style.width.px]=\"rightFixedWidth\" \r\n                    *ngIf=\"columnsGroup?.rightFixed && columnsGroup?.rightFixed.length\"\r\n                    [class.f-datagrid-fixed-right-shadow]=\"showRightShadow\" \r\n                    style=\"border: 0\"\r\n                    [style.transform]=\"'translate3d('+ fixedRightScrollLeft +'px, 0px, 0px)'\">\r\n                    \r\n                    <datagrid-rows #rightRows [fixedRight]=\"true\" [startRowIndex]=\"startRowIndex\" [columns]=\"columnsGroup?.rightFixed\" [data]=\"rows\"></datagrid-rows>\r\n                </div>\r\n\r\n                <div #main [style.width.px]=\"colsWidth\" style=\"position: relative;\" [style.left.px]=\"leftFixedWidth\" class=\"f-datagrid-table f-datagrid-body-center\">\r\n                    <datagrid-rows #mainRows  [startRowIndex]=\"startRowIndex\" [columns]=\"columnsGroup?.normalColumns\" [data]=\"rows\"></datagrid-rows>\r\n                </div>\r\n\r\n                <div hidefocus style=\"width: 100%\" [style.height.px]=\"blankBottomHeight\"></div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>",
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    DatagridBodyComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ApplicationRef },
        { type: DatagridComponent, decorators: [{ type: Optional }] },
        { type: ChangeDetectorRef },
        { type: ElementRef }
    ]; };
    DatagridBodyComponent.propDecorators = {
        footerHeight: [{ type: Input }],
        canvasWidth: [{ type: Input }],
        columnsGroup: [{ type: Input }],
        topHideHeight: [{ type: Input }],
        bottomHideHeight: [{ type: Input }],
        startRowIndex: [{ type: Input }],
        data: [{ type: Input }],
        dataChange: [{ type: Output }],
        scrollBarMode: [{ type: Input }],
        contextMenuItems: [{ type: Input }],
        checkedRows: [{ type: Input }],
        ps: [{ type: ViewChild, args: ['ps',] }],
        tableRowsCmp: [{ type: ViewChild, args: ['mainRows',] }],
        rightRowsCmp: [{ type: ViewChild, args: ['rightRows',] }],
        fixedLeftEl: [{ type: ViewChild, args: ['fixedLeft',] }],
        fixedRightEl: [{ type: ViewChild, args: ['fixedRight',] }],
        mainArea: [{ type: ViewChild, args: ['main',] }],
        viewScrollContainer: [{ type: ViewChild, args: ['viewScrollContainer',] }]
    };
    return DatagridBodyComponent;
}());
export { DatagridBodyComponent };
if (false) {
    /** @type {?} */
    DatagridBodyComponent.prototype.psConfig;
    /** @type {?} */
    DatagridBodyComponent.prototype.top;
    /** @type {?} */
    DatagridBodyComponent.prototype.height;
    /** @type {?} */
    DatagridBodyComponent.prototype.width;
    /** @type {?} */
    DatagridBodyComponent.prototype.colsWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.totalWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.leftFixedWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.rightFixedWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.rowHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.bodyStyle;
    /** @type {?} */
    DatagridBodyComponent.prototype.scrollTop;
    /** @type {?} */
    DatagridBodyComponent.prototype.scrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.deltaTopHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.wheelWidth;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._fixedRightScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.maxScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.showRightShadow;
    /** @type {?} */
    DatagridBodyComponent.prototype.footerHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.canvasWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.columnsGroup;
    /** @type {?} */
    DatagridBodyComponent.prototype.topHideHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.bottomHideHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.startRowIndex;
    /** @type {?} */
    DatagridBodyComponent.prototype.data;
    /** @type {?} */
    DatagridBodyComponent.prototype.dataChange;
    /** @type {?} */
    DatagridBodyComponent.prototype.scrollBarMode;
    /** @type {?} */
    DatagridBodyComponent.prototype.contextMenuItems;
    /** @type {?} */
    DatagridBodyComponent.prototype.checkedRows;
    /** @type {?} */
    DatagridBodyComponent.prototype.ps;
    /** @type {?} */
    DatagridBodyComponent.prototype.tableRowsCmp;
    /** @type {?} */
    DatagridBodyComponent.prototype.rightRowsCmp;
    /** @type {?} */
    DatagridBodyComponent.prototype.fixedLeftEl;
    /** @type {?} */
    DatagridBodyComponent.prototype.fixedRightEl;
    /** @type {?} */
    DatagridBodyComponent.prototype.mainArea;
    /** @type {?} */
    DatagridBodyComponent.prototype.viewScrollContainer;
    /** @type {?} */
    DatagridBodyComponent.prototype.visibleContextMenus;
    /** @type {?} */
    DatagridBodyComponent.prototype.currentRowId;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._hoverRowIndex;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.gridSizeSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.columnResizeSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.onDataSourceChangeSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.selectRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.unselectRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.selectAllSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.checkRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.clearSelectionsSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.checkAllSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.uncheckRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.clearCheckedsSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.subscriptions;
    /** @type {?} */
    DatagridBodyComponent.prototype.dfs;
    /** @type {?} */
    DatagridBodyComponent.prototype.dgs;
    /** @type {?} */
    DatagridBodyComponent.prototype.ngZone;
    /** @type {?} */
    DatagridBodyComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.viewportH;
    /** @type {?} */
    DatagridBodyComponent.prototype.viewportW;
    /** @type {?} */
    DatagridBodyComponent.prototype.canvasHeight;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.minRowBuffer;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.vScrollDir;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.rowsCache;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.lastRenderedScrollTop;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.lastRenderedScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.prevScrollTop;
    /** @type {?} */
    DatagridBodyComponent.prototype.prevScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.rows;
    /** @type {?} */
    DatagridBodyComponent.prototype.blankTopHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.blankBottomHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.cellContentFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.__triggerBodyClickEvent;
    /** @type {?} */
    DatagridBodyComponent.prototype.onBeforeShowContextMenu;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.app;
    /** @type {?} */
    DatagridBodyComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtYm9keS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBb0IsS0FBSyxFQUFFLFlBQVksRUFBTyxNQUFNLGdCQUFnQixDQUFDO0FBQzVFLE9BQU8sRUFBMEIsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7Ozs7Ozs7QUFTbEQsT0FBTyxFQUNILFNBQVMsRUFBVSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFDOUMsVUFBVSxFQUFhLGlCQUFpQixFQUNkLHVCQUF1QixFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQXNCLFFBQVEsRUFBRSxjQUFjLEVBQWdCLE1BQU0sRUFBRSxZQUFZLEVBQ3hKLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBR3pFLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLDJCQUEyQixFQUE2QixTQUFTLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMzSSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDbEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDdkUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFL0Q7SUFrSUksK0JBQ1ksUUFBa0IsRUFDbEIsR0FBbUIsRUFDUixFQUFxQixFQUNoQyxFQUFxQixFQUFVLEVBQWM7UUFKekQsaUJBYUM7UUFaVyxhQUFRLEdBQVIsUUFBUSxDQUFV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clxuaW1wb3J0IHsgZmlyc3QsIHN3aXRjaE1hcCwgZGVsYXksIGRlYm91bmNlVGltZSwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24sIGludGVydmFsLCBvZiB9IGZyb20gJ3J4anMnO1xyXG4vKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTEyIDA3OjQ3OjEyXHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTExLTI2IDEwOjIxOjI1XHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBWaWV3Q2hpbGQsIFJlbmRlcmVyMixcclxuICAgIEVsZW1lbnRSZWYsIE9uRGVzdHJveSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEFmdGVyVmlld0luaXQsIEFmdGVyVmlld0NoZWNrZWQsXHJcbiAgICBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBOZ1pvbmUsIEluamVjdG9yLCBmb3J3YXJkUmVmLCBJbmplY3QsIE9wdGlvbmFsLCBBcHBsaWNhdGlvblJlZiwgSG9zdExpc3RlbmVyLCBPdXRwdXQsIEV2ZW50RW1pdHRlclxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTY3JvbGxiYXJEaXJlY3RpdmUgfSBmcm9tICcuLi8uLi9zY3JvbGxiYXIvc2Nyb2xsYmFyLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IENvbHVtbkdyb3VwIH0gZnJvbSAnLi4vLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBTZWxlY3RlZFJvdywgRGF0YVJlc3VsdCwgUk9XX0lOREVYX0ZJRUxELCBJU19HUk9VUF9ST1dfRklFTEQsIEdST1VQX1JPV19GSUVMRCwgSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRCB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0YXRlJztcclxuaW1wb3J0IHsgU0NST0xMX1hfQUNUSU9OLCBTQ1JPTExfWV9BQ1RJT04sIFNDUk9MTF9YX1JFQUNIX1NUQVJUX0FDVElPTiwgU0NST0xMX1hfUkVBQ0hfRU5EX0FDVElPTiwgVFJfUFJFRklYIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBGb3JtYXRDZWxsRGF0YVBpcGUgfSBmcm9tICcuLi8uLi91dGlscy9mb3JtYXQtY2VsbC1kYXRhLnBpcGUnO1xyXG5pbXBvcnQgeyBDb2x1bW5Gb3JtYXRTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vY29sdW1uJztcclxuaW1wb3J0IHsgQ29udGV4dE1lbnVJdGVtIH0gZnJvbSAnQGZhcnJpcy91aS1jb250ZXh0LW1lbnUnO1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZGF0YWdyaWQtYm9keScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vYm9keS5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRCb2R5Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCB7XHJcbiAgICAvLyDoh6rliqjpq5jluqbml7bvvIznpoHnlKjnurXlkJHmu5rliqjmnaFcclxuICAgIHBzQ29uZmlnID0geyBzd2lwZUVhc2luZzogZmFsc2UsIG1pblNjcm9sbGJhckxlbmd0aDogMTUsIGhhbmRsZXJzOiBbJ2NsaWNrLXJhaWwnLCAnZHJhZy10aHVtYicsICd3aGVlbCcsICd0b3VjaCddLCBzdXBwcmVzc1Njcm9sbFk6IHRoaXMuZGcuYXV0b0hlaWdodCB9O1xyXG5cclxuICAgIHRvcDogbnVtYmVyO1xyXG4gICAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICB3aWR0aDogbnVtYmVyO1xyXG4gICAgY29sc1dpZHRoOiBudW1iZXI7XHJcbiAgICB0b3RhbFdpZHRoOiBudW1iZXI7XHJcbiAgICBsZWZ0Rml4ZWRXaWR0aDogbnVtYmVyO1xyXG4gICAgcmlnaHRGaXhlZFdpZHRoOiBudW1iZXI7XHJcbiAgICByb3dIZWlnaHQ6IG51bWJlcjtcclxuICAgIGJvZHlTdHlsZTogYW55O1xyXG4gICAgc2Nyb2xsVG9wID0gMDtcclxuICAgIHNjcm9sbExlZnQgPSAwO1xyXG4gICAgZGVsdGFUb3BIZWlnaHQgPSAwO1xyXG4gICAgLy8gd2hlZWxIZWlnaHQgPSAwO1xyXG4gICAgd2hlZWxXaWR0aCA9IDA7XHJcbiAgICBwcml2YXRlIF9maXhlZFJpZ2h0U2Nyb2xsTGVmdCA9IDA7XHJcbiAgICBnZXQgZml4ZWRSaWdodFNjcm9sbExlZnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpeGVkUmlnaHRTY3JvbGxMZWZ0O1xyXG4gICAgfVxyXG4gICAgc2V0IGZpeGVkUmlnaHRTY3JvbGxMZWZ0KHZhbCkge1xyXG4gICAgICAgIC8vIHRoaXMuX2ZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdGhpcy5kZy5zY3JvbGxCYXJTaG93TW9kZSA9PT0gJ2FsbHdheXMnID8gIHZhbCAtIDE4IDogdmFsO1xyXG4gICAgICAgIHRoaXMuX2ZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdmFsO1xyXG4gICAgfVxyXG5cclxuICAgIG1heFNjcm9sbExlZnQgPSAwO1xyXG4gICAgc2hvd1JpZ2h0U2hhZG93ID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBmb290ZXJIZWlnaHQgPSAwO1xyXG4gICAgQElucHV0KCkgY2FudmFzV2lkdGg7XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zR3JvdXA6IENvbHVtbkdyb3VwO1xyXG4gICAgLy8g6Jma5ouf5Yqg6L29XHJcbiAgICBASW5wdXQoKSB0b3BIaWRlSGVpZ2h0ID0gMDtcclxuICAgIEBJbnB1dCgpIGJvdHRvbUhpZGVIZWlnaHQgPSAwO1xyXG5cclxuICAgIEBJbnB1dCgpIHN0YXJ0Um93SW5kZXggPSAwO1xyXG4gICAgQElucHV0KCkgZGF0YTogYW55O1xyXG5cclxuICAgIEBPdXRwdXQoKSBkYXRhQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBJbnB1dCgpIHNjcm9sbEJhck1vZGUgPSAnYXV0byc7XHJcbiAgICBASW5wdXQoKSBjb250ZXh0TWVudUl0ZW1zOiBDb250ZXh0TWVudUl0ZW1bXTtcclxuXHJcbiAgICBASW5wdXQoKSBjaGVja2VkUm93cyA9IFtdO1xyXG4gICAgQFZpZXdDaGlsZCgncHMnKSBwcz86IFNjcm9sbGJhckRpcmVjdGl2ZTtcclxuICAgIEBWaWV3Q2hpbGQoJ21haW5Sb3dzJykgdGFibGVSb3dzQ21wOiBhbnk7XHJcbiAgICBAVmlld0NoaWxkKCdyaWdodFJvd3MnKSByaWdodFJvd3NDbXA6IGFueTtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpeGVkTGVmdCcpIGZpeGVkTGVmdEVsOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZml4ZWRSaWdodCcpIGZpeGVkUmlnaHRFbDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ21haW4nKSBtYWluQXJlYTogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ3ZpZXdTY3JvbGxDb250YWluZXInKSB2aWV3U2Nyb2xsQ29udGFpbmVyOiBFbGVtZW50UmVmO1xyXG5cclxuXHJcbiAgICB2aXNpYmxlQ29udGV4dE1lbnVzID0gW107XHJcblxyXG4gICAgY3VycmVudFJvd0lkID0gdW5kZWZpbmVkO1xyXG5cclxuICAgIHByaXZhdGUgX2hvdmVyUm93SW5kZXggPSAtMTtcclxuICAgIGdldCBob3ZlclJvd0luZGV4KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hvdmVyUm93SW5kZXg7XHJcbiAgICB9XHJcbiAgICBzZXQgaG92ZXJSb3dJbmRleChyb3dJZHg6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX2hvdmVyUm93SW5kZXggPSByb3dJZHg7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNlbGVjdGVkUm93cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZy5zZWxlY3Rpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ3JpZFNpemVTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgY29sdW1uUmVzaXplU3Vic2NyaWJlOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIG9uRGF0YVNvdXJjZUNoYW5nZVN1YnNjcmliZTogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RSb3dTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgdW5zZWxlY3RSb3dTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgc2VsZWN0QWxsU3Vic2NyaWJlOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIGNoZWNrUm93U3Vic2NyaWJlOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIGNsZWFyU2VsZWN0aW9uc1N1YnNjcmliZTogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBjaGVja0FsbFN1YnNjcmliZTogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSB1bmNoZWNrUm93U3Vic2NyaWJlOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIGNsZWFyQ2hlY2tlZHNTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICBwcml2YXRlIHN1YnNjcmlwdGlvbnMgPSBbXTtcclxuXHJcbiAgICBwdWJsaWMgZGZzOiBEYXRhZ3JpZEZhY2FkZVNlcnZpY2U7XHJcbiAgICBwdWJsaWMgZGdzOiBEYXRhZ3JpZFNlcnZpY2U7XHJcbiAgICBwdWJsaWMgbmdab25lOiBOZ1pvbmU7XHJcbiAgICBwdWJsaWMgcmVuZGVyOiBSZW5kZXJlcjI7XHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICBwcml2YXRlIHZpZXdwb3J0SDtcclxuICAgIHZpZXdwb3J0VztcclxuICAgIGNhbnZhc0hlaWdodDtcclxuICAgIHByaXZhdGUgbWluUm93QnVmZmVyID0gMztcclxuICAgIHByaXZhdGUgdlNjcm9sbERpciA9IDE7XHJcbiAgICBwcml2YXRlIHJvd3NDYWNoZSA9IHt9O1xyXG4gICAgcHJpdmF0ZSBsYXN0UmVuZGVyZWRTY3JvbGxUb3AgPSAwO1xyXG4gICAgcHJpdmF0ZSBsYXN0UmVuZGVyZWRTY3JvbGxMZWZ0ID0gMDtcclxuICAgIHByZXZTY3JvbGxUb3AgPSAwO1xyXG4gICAgcHJldlNjcm9sbExlZnQgPSAwO1xyXG4gICAgcm93cyA9IFtdO1xyXG4gICAgYmxhbmtUb3BIZWlnaHQgPSAwO1xyXG4gICAgYmxhbmtCb3R0b21IZWlnaHQgPSAwO1xyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbiAgICBnZXQgc2Nyb2xsYmFyWEhlaWdodCgpIHtcclxuICAgICAgICBpZiAodGhpcy5kZyAmJiB0aGlzLnBzICYmIHRoaXMucHMuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgaCA9IHRoaXMuZGcuc2Nyb2xsQmFyU2hvd01vZGUgPT09ICdhbGx3YXlzJyAmJiB0aGlzLnBzLmluc3RhbmNlWydzY3JvbGxiYXJYQWN0aXZlJ10gPyAyMiA6IDA7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBzLmluc3RhbmNlWydzY3JvbGxiYXJZQWN0aXZlJ10gJiYgaCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGggKyAxODtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBzY3JvbGxiYXJZV2lkdGgoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcgJiYgdGhpcy5wcyAmJiB0aGlzLnBzLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRnLnNjcm9sbEJhclNob3dNb2RlID09PSAnYWxsd2F5cycgJiYgdGhpcy5wcy5pbnN0YW5jZVsnc2Nyb2xsYmFyWUFjdGl2ZSddICYmIHRoaXMuc2hvd1JpZ2h0U2hhZG93ID8gMTggOiAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjZWxsQ29udGVudEZvcm1hdHRlcjogRm9ybWF0Q2VsbERhdGFQaXBlID0gbnVsbDtcclxuXHJcbiAgICAvLyDlvZPlkK/nlKjlpJrpgInkuJTlhYHorrjlpJrpgInkuK3vvIzliJfooajkuI3og73nvJbovpHml7bvvIzlj5bpgInkuK3lkI7npoHmraLop6blj5Fib2R5IOeahGNsaWNrIOS6i+S7tlxyXG4gICAgcHJpdmF0ZSBfX3RyaWdnZXJCb2R5Q2xpY2tFdmVudCA9IHRydWU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSBhcHA6IEFwcGxpY2F0aW9uUmVmLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsXHJcbiAgICAgICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWZcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuZGZzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRGYWNhZGVTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmRncyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyID0gdGhpcy5pbmplY3Rvci5nZXQoUmVuZGVyZXIyKTtcclxuXHJcbiAgICAgICAgY29uc3QgY29sdW1uRm9ybWF0U2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbHVtbkZvcm1hdFNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuY2VsbENvbnRlbnRGb3JtYXR0ZXIgPSBuZXcgRm9ybWF0Q2VsbERhdGFQaXBlKGNvbHVtbkZvcm1hdFNlcnZpY2UsIHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG5cclxuICAgICAgICB0aGlzLmxpc3RlblN1YmplY3RzKCk7XHJcbiAgICAgICAgdGhpcy5kZy5zY3JvbGxJbnN0YW5jZSA9IHRoaXMucHM7XHJcbiAgICAgICAgY29uc3QgczEgPSB0aGlzLmRncy5zaG93R3JpZEhlYWRlci5zdWJzY3JpYmUoaGVhZGVySGVpZ2h0ID0+IHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVDb250YWluZXJTaXplKGhlYWRlckhlaWdodCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goczEpO1xyXG5cclxuICAgICAgICBjb25zdCBzMTAgPSB0aGlzLmRncy5mb290ZXJQb3NpdGlvbkNoYW5nZWQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVDb250YWluZXJTaXplKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goczEwKTtcclxuXHJcbiAgICAgICAgY29uc3QgczIgPSB0aGlzLmRncy5yb3dIZWlnaHRDaGFuZ2VkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMyKTtcclxuXHJcbiAgICAgICAgY29uc3QgczMgPSB0aGlzLmRmcy5jbGllbnRTb3J0JC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrU2Nyb2xsYmFyUG9zaXRpb24odHJ1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRnLmNvbHVtblNvcnRlZC5lbWl0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goczMpO1xyXG5cclxuICAgICAgICBjb25zdCBzNSA9IHRoaXMuZGcuZGdzLmNvbHVtbnNDaGFuZ2VkLnBpcGUoXHJcbiAgICAgICAgICAgIGRlbGF5KDEwMClcclxuICAgICAgICApLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlICYmIGUuc2Nyb2xsVG9MZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxUbygwLCAwKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucHMuc2Nyb2xsVG9MZWZ0KDAsIDEwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzNSk7XHJcbiAgICAgICAgdGhpcy52aWV3U2Nyb2xsQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uTW91c2VDbGljay5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUNvbnRhaW5lclNpemUoaGVhZGVySGVpZ2h0PzogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaGggPSBoZWFkZXJIZWlnaHQgfHwgdGhpcy5kZy5yZWFsSGVhZGVySGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25Ub3AoaGgpO1xyXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5kZy5oZWlnaHQgLSB0aGlzLnRvcDtcclxuICAgICAgICB0aGlzLmJvZHlTdHlsZSA9IHRoaXMuZ2V0Qm9keVN0eWxlKCk7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmRhdGEgJiYgIWNoYW5nZXMuZGF0YS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5ib2R5U3R5bGUgPSB0aGlzLmdldEJvZHlTdHlsZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmRmcy5zZXRDdXJyZW50UGFnZURhdGEoY2hhbmdlcy5kYXRhLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMub25EYXRhQ2hhbmdlZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMuZm9vdGVySGVpZ2h0ICE9PSB1bmRlZmluZWQgJiYgIWNoYW5nZXMuZm9vdGVySGVpZ2h0LmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLmJvZHlTdHlsZSA9IHRoaXMuZ2V0Qm9keVN0eWxlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY2hhbmdlcy5zY3JvbGxCYXJNb2RlICE9PSB1bmRlZmluZWQgJiYgIWNoYW5nZXMuc2Nyb2xsQmFyTW9kZS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHMgJiYgdGhpcy5wcy5pbnN0YW5jZSAmJiB0aGlzLnNjcm9sbEJhck1vZGUgPT09ICdhbGx3YXlzJyAmJiB0aGlzLnBzLmluc3RhbmNlLnNjcm9sbGJhcllBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmlnaHRGaXhlZFdpZHRoICs9IHRoaXMuc2hvd1JpZ2h0U2hhZG93ID8gMTggOiAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodEZpeGVkV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC5yaWdodEZpeGVkV2lkdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95U3Vic2NyaXB0aW9ucygpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRQb3NpdGlvblRvcChoZWFkZXJIZWlnaHQ6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMudG9wID0gaGVhZGVySGVpZ2h0O1xyXG4gICAgICAgIGlmICgodGhpcy5kZy5lbmFibGVGaWx0ZXJSb3cgfHwgdGhpcy5kZy5lbmFibGVTbWFydEZpbHRlcikgJiYgdGhpcy5kZy5zaG93RmlsdGVyQmFyKSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9wICs9IHRoaXMuZGcuZmlsdGVyQmFySGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2hvd1Jvd0dyb3VwUGFuZWwpIHtcclxuICAgICAgICAgICAgdGhpcy50b3AgKz0gdGhpcy5kZy5yb3dHcm91cFBhbmVsSGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0Zvb3RlciAmJiAodGhpcy5kZy5mb290ZXJQb3NpdGlvbiA9PT0gJ3RvcCcgfHwgdGhpcy5kZy5mb290ZXJQb3NpdGlvbiA9PT0gJ2JvdGgnKSkge1xyXG4gICAgICAgICAgICB0aGlzLnRvcCArPSB0aGlzLmRnLmZvb3RlckhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja1Njcm9sbGJhclBvc2l0aW9uKHRvVG9wID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcuZGF0YSB8fCAhdGhpcy5kZy5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHNjcm9sbEJhcjogYW55ID0gdGhpcy5wcy5pbnN0YW5jZTtcclxuICAgICAgICBjb25zdCBzY3JvbGxFbFJlZiA9IHRoaXMucHMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIC8vIHNjcm9sbEJhci51cGRhdGUoKTtcclxuICAgICAgICBjb25zdCBsYXN0U2Nyb2xsTGVmdCA9IHNjcm9sbEJhciA/IHNjcm9sbEJhci5sYXN0U2Nyb2xsTGVmdCA6IDA7XHJcbiAgICAgICAgY29uc3QgbGFzdFNjcm9sbFRvcCA9IHNjcm9sbEJhciA/IHNjcm9sbEJhci5sYXN0U2Nyb2xsVG9wIDogMDtcclxuXHJcbiAgICAgICAgLy8gY29uc3QgbGFzdFNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XHJcbiAgICAgICAgLy8gY29uc3QgbGFzdFNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xyXG5cclxuICAgICAgICBjb25zdCBzY3JvbGxUb3AgPSBzY3JvbGxFbFJlZi5zY3JvbGxUb3A7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsTGVmdCA9IHNjcm9sbEVsUmVmLnNjcm9sbExlZnQ7XHJcblxyXG4gICAgICAgIGlmICghdG9Ub3ApIHtcclxuICAgICAgICAgICAgaWYgKHNjcm9sbFRvcCAhPSBsYXN0U2Nyb2xsVG9wKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBzLnNjcm9sbFRvVG9wKGxhc3RTY3JvbGxUb3ApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25TY3JvbGxNb3ZlKGxhc3RTY3JvbGxUb3AsIFNDUk9MTF9ZX0FDVElPTik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBzLnNjcm9sbFRvVG9wKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZShsYXN0U2Nyb2xsVG9wLCBTQ1JPTExfWV9BQ1RJT04pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zY3JvbGxMZWZ0ID0gbGFzdFNjcm9sbExlZnQ7XHJcbiAgICAgICAgaWYgKHNjcm9sbExlZnQgIT0gbGFzdFNjcm9sbExlZnQpIHtcclxuICAgICAgICAgICAgdGhpcy5wcy5zY3JvbGxUb1gobGFzdFNjcm9sbExlZnQpO1xyXG4gICAgICAgICAgICB0aGlzLmRncy5vblNjcm9sbE1vdmUobGFzdFNjcm9sbExlZnQsIFNDUk9MTF9YX0FDVElPTik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGxhc3RTY3JvbGxMZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRncy5vblNjcm9sbE1vdmUobGFzdFNjcm9sbExlZnQsIFNDUk9MTF9YX0FDVElPTik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmlbDmja7lj5HnlJ/lj5jljJbvvIzph43mlrDliqDovb3mlbDmja7ml7bmiafooYxcclxuICAgICAqIOmHjee9rua7muWKqOadoeS9jee9rlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG9uRGF0YUNoYW5nZWQoKSB7XHJcbiAgICAgICAgdGhpcy5kZy5zZXRQYWdlckhlaWdodCgpO1xyXG4gICAgICAgIHRoaXMudmlld3BvcnRIID0gdGhpcy5nZXRWaWV3UG9ydEhlaWdodCgpO1xyXG4gICAgICAgIHRoaXMuYm9keVN0eWxlID0gdGhpcy5nZXRCb2R5U3R5bGUoKTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogdXBkYXRlOlxyXG4gICAgICAgICAqIG5vZGVfbW9kdWxlc1xccGVyZmVjdC1zY3JvbGxiYXJcXHR5cGVzXFxwZXJmZWN0LXNjcm9sbGJhci5kLnRzXHJcbiAgICAgICAgICogbGFzdFNjcm9sbFRvcDogbnVtYmVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgaWYgKHRoaXMucHMgJiYgdGhpcy5wcy5pbnN0YW5jZSAmJiAhdGhpcy5kZy5pc0VkaXRpbmcoKSAmJiAhdGhpcy5kZy5jbGllbnRGaWx0ZXJDaGFuZ2VkICYmICF0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZW5kZXJlZFNjcm9sbFRvcCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMucHMuc2Nyb2xsVG9Ub3AoKTtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxMZWZ0ID0gMDtcclxuICAgICAgICAgICAgdGhpcy5wcy5zY3JvbGxUb0xlZnQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucm93c0NhY2hlID0ge307XHJcbiAgICAgICAgY29uc3Qga2VlcHNjcm9sbFBvcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc2Nyb2xsSW5mbyA9IHRoaXMuZGcuZGZzLmdldFN0YXRlKCkuc2Nyb2xsSW5mbztcclxuICAgICAgICAgICAgaWYgKHNjcm9sbEluZm8pIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY3JvbGxJbmZvLnkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IHNjcm9sbEluZm8ueTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLnNjcm9sbEluc3RhbmNlLnNjcm9sbFRvWShzY3JvbGxJbmZvLnkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZShzY3JvbGxJbmZvLnksIFNDUk9MTF9ZX0FDVElPTik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjcm9sbEluZm8ueCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9IHNjcm9sbEluZm8ueDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLnNjcm9sbEluc3RhbmNlLnNjcm9sbFRvWChzY3JvbGxJbmZvLngpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuZGdzLm9uU2Nyb2xsTW92ZShzY3JvbGxJbmZvLngsIFNDUk9MTF9YX0FDVElPTik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcubm93cmFwIHx8IHRoaXMuZGcuYXV0b0hlaWdodCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckRhdGEoZmFsc2UpO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm93SGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAga2VlcHNjcm9sbFBvcygpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckRhdGEoZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLnBzLnVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRnLmluaXRTZWxlY3RPckNoZWNrZWQoKTtcclxuICAgICAgICB0aGlzLmRnLmNsaWVudEZpbHRlckNoYW5nZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRhdGFDaGFuZ2UuZW1pdCh0aGlzLmRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZGVzdHJveVN1YnNjcmlwdGlvbnMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9ucyAmJiB0aGlzLnN1YnNjcmlwdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKChzdWI6IFN1YnNjcmlwdGlvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1Yikge1xyXG4gICAgICAgICAgICAgICAgICAgIHN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHN1YiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbGlzdGVuU3ViamVjdHMoKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95U3Vic2NyaXB0aW9ucygpO1xyXG5cclxuICAgICAgICB0aGlzLmdyaWRTaXplU3Vic2NyaWJlID0gdGhpcy5kZnMuZ3JpZFNpemUkLnBpcGUoXHJcbiAgICAgICAgICAgIGRlYm91bmNlVGltZSg1MClcclxuICAgICAgICApLnN1YnNjcmliZShzdGF0ZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5zZXRQYWdlckhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGggPSB0aGlzLmRnLnNldEhlYWRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblRvcChoaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBzdGF0ZS5oZWlnaHQgLSB0aGlzLnRvcDtcclxuICAgICAgICAgICAgICAgIHRoaXMud2lkdGggPSBNYXRoLmZsb29yKHN0YXRlLndpZHRoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucm93SGVpZ2h0ID0gc3RhdGUucm93SGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNob3dCb3JkZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLndpZHRoIC09IDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3cG9ydFcgPSB0aGlzLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3cG9ydEggPSB0aGlzLmdldFZpZXdQb3J0SGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc0hlaWdodCA9IHRoaXMuZ2V0Q2FudmFzSGVpZ2h0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrU2Nyb2xsYmFyUG9zaXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb2x1bW5TaXplKHN0YXRlLmNvbHVtbnNHcm91cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9IHRoaXMucHMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWF4U2Nyb2xsTGVmdCA9IHRoaXMuY29sc1dpZHRoICsgdGhpcy5sZWZ0Rml4ZWRXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAvLyBncmlkIOWuueWZqOWuveW6plxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRnQ29udGFpbmVyV2lkdGggPSB0aGlzLmRnLmRnQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5omA5pyJ5YiX5a695LmL5ZKMXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxsQ29sc1dpZHRoID0gTWF0aC5mbG9vcih0aGlzLmNvbHVtbnNHcm91cC50b3RhbFdpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlj7Pkvqflm7rlrprliJfnmoTkvY3nva5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdGhpcy53aWR0aCAtIHRoaXMucmlnaHRGaXhlZFdpZHRoICsgdGhpcy5zY3JvbGxMZWZ0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvZHlTdHlsZSA9IHRoaXMuZ2V0Qm9keVN0eWxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRnQ29udGFpbmVyV2lkdGggPiBhbGxDb2xzV2lkdGggfHwgZGdDb250YWluZXJXaWR0aCA9PT0gYWxsQ29sc1dpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JpZ2h0U2hhZG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZml4ZWRSaWdodFNjcm9sbExlZnQgPSB0aGlzLm1heFNjcm9sbExlZnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93UmlnaHRTaGFkb3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJEYXRhKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGcubm93cmFwIHx8IHRoaXMuZGcuYXV0b0hlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgX3RpbWVyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aW1lcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RpbWVyLmNsZWFyVGltZW91dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm93SGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHMudXBkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnBzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLnNob3dGaXhlZFNoYWRvdy5lbWl0KHsgc2hvd1JpZ2h0U2hhZG93OiB0aGlzLnNob3dSaWdodFNoYWRvdywgeDogdGhpcy5maXhlZFJpZ2h0U2Nyb2xsTGVmdCB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjcm9sbEJhck1vZGUgPT09ICdhbGx3YXlzJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbHVtblNpemUodGhpcy5jb2x1bW5zR3JvdXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRncy5zY3JvbGxiYXJVcGRhdGUuZW1pdCh7IHNjcm9sbGJhclJlZjogdGhpcy5wcy5pbnN0YW5jZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5ncmlkU2l6ZVN1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMuY29sdW1uUmVzaXplU3Vic2NyaWJlID0gdGhpcy5kZnMuY29sdW1uUmVzaXplJC5zdWJzY3JpYmUoKGNnOiBDb2x1bW5Hcm91cCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbHVtblNpemUoY2cpO1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmNvbHVtblJlc2l6ZVN1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLnNldFNlbGVjZWRSb3cuc3Vic2NyaWJlKChyOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHIgJiYgci5zZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Um93SWQgPSByLmlkO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Um93SWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNlbGVjdFJvd1N1YnNjcmliZSA9IHRoaXMuZGZzLnNlbGVjdFJvdyQuc3Vic2NyaWJlKChyb3c6IFNlbGVjdGVkUm93KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyb3cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFJvd0lkID0gcm93LmlkO1xyXG4gICAgICAgICAgICAgICAgLy8gMjAyMTA4MTcg5pa55ZCR6ZSu56e75Yqo5ZCO5Yi35paw6KeG5Zu+54q25oCBXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuc2VsZWN0Um93U3Vic2NyaWJlKTtcclxuXHJcbiAgICAgICAgdGhpcy51bnNlbGVjdFJvd1N1YnNjcmliZSA9IHRoaXMuZGZzLnVuU2VsZWN0Um93JC5zdWJzY3JpYmUoKHByZXZSb3c6IFNlbGVjdGVkUm93KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChwcmV2Um93ICYmIHByZXZSb3cuaWQgPT09IHRoaXMuY3VycmVudFJvd0lkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRSb3dJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuZWRpdGFibGUgJiYgdGhpcy5kZy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fX3RyaWdnZXJCb2R5Q2xpY2tFdmVudCA9IHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLnVuc2VsZWN0Um93U3Vic2NyaWJlKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZWxlY3RBbGxTdWJzY3JpYmUgPSB0aGlzLmRmcy5zZWxlY3RBbGwkLnN1YnNjcmliZSgocm93czogU2VsZWN0ZWRSb3dbXSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRnLnNlbGVjdEFsbC5lbWl0KHJvd3MpO1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLnNlbGVjdEFsbFN1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMuY2hlY2tSb3dTdWJzY3JpYmUgPSB0aGlzLmRmcy5jaGVja1JvdyQuc3Vic2NyaWJlKChyb3c6IFNlbGVjdGVkUm93KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY2hlY2tlZC5lbWl0KHJvdyk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFJvd3NDaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuY2hlY2tSb3dTdWJzY3JpYmUpO1xyXG5cclxuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uc1N1YnNjcmliZSA9IHRoaXMuZGZzLmNsZWFyU2VsZWN0aW9ucyQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Um93SWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmNoZWNrT25TZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZFJvd3NDaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5kZy51blNlbGVjdEFsbC5lbWl0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5jbGVhclNlbGVjdGlvbnNTdWJzY3JpYmUpO1xyXG5cclxuICAgICAgICB0aGlzLnVuY2hlY2tSb3dTdWJzY3JpYmUgPSB0aGlzLmRmcy51bkNoZWNrUm93JC5zdWJzY3JpYmUoKHByZXZSb3c6IFNlbGVjdGVkUm93KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcudW5DaGVja2VkLmVtaXQocHJldlJvdyk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFJvd3NDaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMudW5jaGVja1Jvd1N1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMuY2hlY2tBbGxTdWJzY3JpYmUgPSB0aGlzLmRmcy5jaGVja0FsbCQuc3Vic2NyaWJlKChyb3dzOiBTZWxlY3RlZFJvd1tdKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY2hlY2tBbGwuZW1pdChyb3dzKTtcclxuICAgICAgICAgICAgdGhpcy5jaGVja2VkUm93c0NoYW5nZWQoKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5jaGVja0FsbFN1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMuY2xlYXJDaGVja2Vkc1N1YnNjcmliZSA9IHRoaXMuZGZzLmNsZWFyQ2hlY2tlZHMkLnN1YnNjcmliZSgocm93czogU2VsZWN0ZWRSb3dbXSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RPbkNoZWNrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRSb3dJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmRnLnVuQ2hlY2tBbGwuZW1pdChyb3dzKTtcclxuICAgICAgICAgICAgdGhpcy5jaGVja2VkUm93c0NoYW5nZWQoKTtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5jbGVhckNoZWNrZWRzU3Vic2NyaWJlKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5kZ3Muc2V0U2Nyb2xsYmFyUG9zaXRpb24uc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja1Njcm9sbGJhclBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2Nyb2xsUG9zaXRpb24odGhpcy5zY3JvbGxMZWZ0KTtcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLmNvbHVtblJlc2l6ZWQucGlwZShcclxuICAgICAgICAgICAgZGVsYXkoMTAwKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLm5vd3JhcCB8fFxyXG4gICAgICAgICAgICAgICAgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5pc0VkaXRpbmcgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5jb2x1bW4gJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNvbHVtbi5lZGl0b3IgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5jb2x1bW4uZWRpdG9yLnR5cGUgPT09ICd0ZXh0YXJlYScpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0cmRvbXMgPSB0aGlzLmRnLmRnQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmYtZGF0YWdyaWQtYm9keS1yb3c6bm90KGYtZGF0YWdyaWQtZm9vdGVyLXJvdyknKTtcclxuICAgICAgICAgICAgICAgIHRyZG9tcy5mb3JFYWNoKG4gPT4gbi5zdHlsZS5oZWlnaHQgPSAnYXV0bycpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB0cklEID0gJyc7XHJcbiAgICAgICAgICAgICAgICBpZiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd0lkID0gZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICB0cklEID0gVFJfUFJFRklYICsgcm93SWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVSb3dIZWlnaHQodHJJRCk7XHJcbiAgICAgICAgICAgICAgICAvLyB0cmRvbXMuZm9yRWFjaChuID0+IG4uc3R5bGUuaGVpZ2h0ID0gJycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5oZWFkZXJXcmFwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnNldEhlYWRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMuY29sdW1uUmVzaXplRW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLmNlbGxDb250ZW50V3JhcENoYW5nZWQucGlwZShcclxuICAgICAgICAgICAgZGVsYXkoMTAwKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVSb3dIZWlnaHQoKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuZGcuZGZzLnJvd1VwZGF0ZSQuc3Vic2NyaWJlKChyb3c6IHsgaW5kZXg6IG51bWJlciwgZGF0YTogYW55IH0pID0+IHtcclxuICAgICAgICAgICAgaWYgKHJvdyAmJiByb3cuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZEN1c3RvbUNlbGxTdHlsZShyb3cpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEN1c3RvbUNlbGxTdHlsZShyb3c6IHsgaW5kZXg6IG51bWJlciwgZGF0YTogYW55IH0pIHtcclxuXHJcbiAgICAgICAgbGV0IHJpZ2h0VHJzID0gW107XHJcbiAgICAgICAgbGV0IGxlZnRUcnMgPSBbXTtcclxuICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0RWwpIHtcclxuICAgICAgICAgICAgcmlnaHRUcnMgPSB0aGlzLmZpeGVkUmlnaHRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5maXhlZExlZnRFbCkge1xyXG4gICAgICAgICAgICBsZWZ0VHJzID0gdGhpcy5maXhlZExlZnRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maXhlZC1sZWZ0LXJvdycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHJzID0gdGhpcy5tYWluQXJlYS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyLmYtZGF0YWdyaWQtYm9keS1yb3cnKTtcclxuXHJcbiAgICAgICAgY29uc3QgdXBkYXRlQ2VsbFN0eWxlID0gKGFyciwgY29sLCBzdHlsZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGQgPSBhcnJbcm93LmluZGV4XS5xdWVyeVNlbGVjdG9yKGBbZmllbGQ9XCIke2NvbC5maWVsZH1cIl1gKTtcclxuICAgICAgICAgICAgICAgIGlmICh0ZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcucmVuZGVyQ3VzdG9tU3R5bGUoc3R5bGUsIHRkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZGcuZmxhdENvbHVtbnMuZm9yRWFjaChjb2wgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY29sLnN0eWxlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX3JkID0gcm93LmRhdGE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjcyA9IGNvbC5zdHlsZXIoX3JkW2NvbC5maWVsZF0sIF9yZCwgcm93LmluZGV4KTtcclxuICAgICAgICAgICAgICAgIGlmIChjcyAmJiBPYmplY3Qua2V5cyhjcykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2VsbFN0eWxlKGxlZnRUcnMsIGNvbCwgY3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNlbGxTdHlsZShyaWdodFRycywgY29sLCBjcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2VsbFN0eWxlKHRycywgY29sLCBjcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrZWRSb3dzQ2hhbmdlZCgpIHtcclxuICAgICAgICB0aGlzLmRncy5vbkNoZWNrZWRSb3dzQ291bnRDaGFuZ2UoKTtcclxuICAgICAgICBjb25zdCBjaGVja2VkUm93cyA9IHRoaXMuZGcuY2hlY2tlZHM7XHJcbiAgICAgICAgdGhpcy5kZy5jaGVja1ZhbHVlcyA9IGNoZWNrZWRSb3dzLm1hcChyID0+IHIuaWQpO1xyXG4gICAgICAgIHRoaXMuZGcuY2hlY2tWYWx1ZXNDaGFuZ2UuZW1pdCh0aGlzLmRnLmNoZWNrVmFsdWVzKTtcclxuICAgICAgICB0aGlzLmRnLmNoZWNrZWRDaGFuZ2UuZW1pdChjaGVja2VkUm93cyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRUckRvbUhlaWdodCgpIHtcclxuICAgICAgICBjb25zdCBsaXN0ID0gW107XHJcbiAgICAgICAgbGV0IHJpZ2h0VHJzID0gW107XHJcbiAgICAgICAgbGV0IGxlZnRUcnMgPSBbXTtcclxuICAgICAgICBsZXQgdHJkb21zID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuZml4ZWRSaWdodEVsKSB7XHJcbiAgICAgICAgICAgIHJpZ2h0VHJzID0gdGhpcy5maXhlZFJpZ2h0RWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0cicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZml4ZWRMZWZ0RWwpIHtcclxuICAgICAgICAgICAgbGVmdFRycyA9IHRoaXMuZml4ZWRMZWZ0RWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZml4ZWQtbGVmdC1yb3cnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1haW5BcmVhKSB7XHJcbiAgICAgICAgICAgIHRyZG9tcyA9IHRoaXMubWFpbkFyZWEubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0ci5mLWRhdGFncmlkLWJvZHktcm93Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyZG9tcy5mb3JFYWNoKCh0ciwgaSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdDEgPSAwO1xyXG4gICAgICAgICAgICBjb25zdCB0MiA9IE1hdGguY2VpbCh0ci5vZmZzZXRIZWlnaHQpO1xyXG4gICAgICAgICAgICBsZXQgdDMgPSAwO1xyXG4gICAgICAgICAgICBpZiAobGVmdFRycyAmJiBsZWZ0VHJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdDEgPSBNYXRoLmNlaWwobGVmdFRyc1tpXS5vZmZzZXRIZWlnaHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocmlnaHRUcnMgJiYgcmlnaHRUcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0MyA9IE1hdGguY2VpbChyaWdodFRyc1tpXS5vZmZzZXRIZWlnaHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBfaCA9IE1hdGgubWF4KHQxLCB0MiwgdDMsIHRoaXMuZGcucm93SGVpZ2h0KTtcclxuICAgICAgICAgICAgbGlzdC5wdXNoKF9oKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gbGlzdDtcclxuICAgIH1cclxuICAgIC8qKiDlhYHorrjmlbDmja7mipjooYzml7bvvIzorqHnrpfooYzlj7fnmoTooYzpq5ggKi9cclxuICAgIHVwZGF0ZVJvd0hlaWdodCh0ckRvbUlkID0gbnVsbCkge1xyXG4gICAgICAgIGlmICghdGhpcy5tYWluQXJlYSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkZ0JvZHkgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2LmYtZGF0YWdyaWQtYm9keScpO1xyXG4gICAgICAgIGlmIChkZ0JvZHkpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLm5vd3JhcCB8fCB0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKGRnQm9keSwgJ2RhdGEtd3JhcCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3MoZGdCb2R5LCAnZGF0YS13cmFwJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjc3NUZXh0QXJyID0gW107XHJcblxyXG4gICAgICAgIGlmICghdHJEb21JZCkge1xyXG4gICAgICAgICAgICB0aGlzLnJvd3MuZm9yRWFjaCgociwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93SWQgPSB0aGlzLmRmcy5wcmltYXJ5SWQocik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0cklEID0gVFJfUFJFRklYICsgcm93SWQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsZWZ0VHJJZCA9IHRySUQgKyAnX2ZpeGVkbGVmdCc7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByaWdodFRySWQgPSB0cklEICsgJ19maXhlZHJpZ2h0JztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGcubm93cmFwIHx8IHRoaXMuZGcuYXV0b0hlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpc3QgPSB0aGlzLmdldFRyRG9tSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaCA9IGxpc3RbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNzc1RleHRBcnIucHVzaChgJHt0aGlzLmRnLmN1c3RvbVN0eWxlS2V5KCl9IC5mLWRhdGFncmlkLWJvZHkuZGF0YS13cmFwICMke2xlZnRUcklkfXsgaGVpZ2h0OiAke2h9cHggfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNzc1RleHRBcnIucHVzaChgJHt0aGlzLmRnLmN1c3RvbVN0eWxlS2V5KCl9IC5mLWRhdGFncmlkLWJvZHkuZGF0YS13cmFwICMke3RySUR9eyBoZWlnaHQ6ICR7aH1weCB9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3NzVGV4dEFyci5wdXNoKGAke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0gLmYtZGF0YWdyaWQtYm9keS5kYXRhLXdyYXAgIyR7cmlnaHRUcklkfXsgaGVpZ2h0OiAke2h9cHggfWApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjc3NUZXh0QXJyLnB1c2goYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1ib2R5ICMke2xlZnRUcklkfXsgaGVpZ2h0OiAke2xpc3RbaV19cHggfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNzc1RleHRBcnIucHVzaChgJHt0aGlzLmRnLmN1c3RvbVN0eWxlS2V5KCl9IC5mLWRhdGFncmlkLWJvZHkgIyR7dHJJRH17IGhlaWdodDogJHtsaXN0W2ldfXB4IH1gKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjc3NUZXh0QXJyLnB1c2goYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1ib2R5ICMke3JpZ2h0VHJJZH17IGhlaWdodDogJHtsaXN0W2ldfXB4IH1gKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkxID0gYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1ib2R5ICMke2xlZnRUcklkfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5MiA9IGAke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0gLmYtZGF0YWdyaWQtYm9keSAjJHt0cklEfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5MyA9IGAke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0gLmYtZGF0YWdyaWQtYm9keSAjJHtyaWdodFRySWR9YDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3MucmVtb3ZlQ3NzUnVsZShrZXkxKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRncy5yZW1vdmVDc3NSdWxlKGtleTIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLnJlbW92ZUNzc1J1bGUoa2V5Myk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGdzLmFwcGVuZENzc1J1bGVzKGNzc1RleHRBcnIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNzc1RleHRBcnIgPSBbXTtcclxuICAgICAgICAgICAgY29uc3QgZG9tU2VsID0gJyMnICsgdHJEb21JZDtcclxuICAgICAgICAgICAgY29uc3QgX2FyciA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0RWwpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJ0ciA9IHRoaXMuZml4ZWRSaWdodEVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3Rvcihkb21TZWwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJ0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9hcnIucHVzaChNYXRoLmNlaWwocnRyLm9mZnNldEhlaWdodCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5maXhlZExlZnRFbCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbHRyID0gdGhpcy5maXhlZExlZnRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoZG9tU2VsKTtcclxuICAgICAgICAgICAgICAgIGlmIChsdHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBfYXJyLnB1c2goTWF0aC5jZWlsKGx0ci5vZmZzZXRIZWlnaHQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMubWFpbkFyZWEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gdGhpcy5tYWluQXJlYS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoZG9tU2VsKTtcclxuICAgICAgICAgICAgICAgIGlmICh0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9hcnIucHVzaChNYXRoLmNlaWwodHIub2Zmc2V0SGVpZ2h0KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IF9oID0gTWF0aC5tYXgoLi4uX2Fycik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBsZWZ0VHJJZCA9IHRyRG9tSWQgKyAnX2ZpeGVkbGVmdCc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0VHJJZCA9IHRyRG9tSWQgKyAnX2ZpeGVkcmlnaHQnO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcubm93cmFwIHx8IHRoaXMuZGcuYXV0b0hlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgY3NzVGV4dEFyci5wdXNoKGAke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0gLmYtZGF0YWdyaWQtYm9keS5kYXRhLXdyYXAgIyR7bGVmdFRySWR9eyBoZWlnaHQ6ICR7X2h9cHg7fWApO1xyXG4gICAgICAgICAgICAgICAgY3NzVGV4dEFyci5wdXNoKGAke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0gLmYtZGF0YWdyaWQtYm9keS5kYXRhLXdyYXAgIyR7dHJEb21JZH17IGhlaWdodDogJHtfaH1weDt9YCk7XHJcbiAgICAgICAgICAgICAgICBjc3NUZXh0QXJyLnB1c2goYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1ib2R5LmRhdGEtd3JhcCAjJHtyaWdodFRySWR9eyBoZWlnaHQ6ICR7X2h9cHg7fWApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY3NzVGV4dEFyci5wdXNoKGAke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0gLmYtZGF0YWdyaWQtYm9keSAjJHtsZWZ0VHJJZH17IGhlaWdodDogJHtfaH1weCB9YCk7XHJcbiAgICAgICAgICAgICAgICBjc3NUZXh0QXJyLnB1c2goYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1ib2R5ICMke3RyRG9tSWR9eyBoZWlnaHQ6ICR7X2h9cHggfWApO1xyXG4gICAgICAgICAgICAgICAgY3NzVGV4dEFyci5wdXNoKGAke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0gLmYtZGF0YWdyaWQtYm9keSAjJHtyaWdodFRySWR9eyBoZWlnaHQ6ICR7X2h9cHggfWApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRncy5hcHBlbmRDc3NSdWxlcyhjc3NUZXh0QXJyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XHJcblxyXG4gICAgICAgIC8vIOenu+mZpGhlaWdodDogYXV0b1xyXG4gICAgICAgIGNvbnN0IHRyZG9tcyA9IHRoaXMuZGcuZGdDb250YWluZXIubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZi1kYXRhZ3JpZC1ib2R5LXJvdzpub3QoZi1kYXRhZ3JpZC1mb290ZXItcm93KScpO1xyXG4gICAgICAgIHRyZG9tcy5mb3JFYWNoKG4gPT4gbi5zdHlsZS5oZWlnaHQgPSAnJyk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUNvbHVtblNpemUoY2c6IENvbHVtbkdyb3VwKSB7XHJcbiAgICAgICAgaWYgKGNnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sdW1uc0dyb3VwID0gY2c7XHJcbiAgICAgICAgICAgIHRoaXMubGVmdEZpeGVkV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC5sZWZ0Rml4ZWRXaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5yaWdodEZpeGVkV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC5yaWdodEZpeGVkV2lkdGg7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5wcyAmJiB0aGlzLnBzLmluc3RhbmNlICYmIHRoaXMuZGcuc2Nyb2xsQmFyU2hvd01vZGUgPT09ICdhbGx3YXlzJyAmJiB0aGlzLnBzLmluc3RhbmNlLnNjcm9sbGJhcllBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmlnaHRGaXhlZFdpZHRoICs9IHRoaXMuc2hvd1JpZ2h0U2hhZG93ID8gMTggOiAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbHNXaWR0aCA9IHRoaXMuY29sdW1uc0dyb3VwLm5vcm1hbFdpZHRoOyAvLyArICh0aGlzLnNob3dSaWdodFNoYWRvdyA/IDE4IDogMCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnRvdGFsV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC50b3RhbFdpZHRoO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxCYXJNb2RlID09PSAnYWxsd2F5cycgJiYgIXRoaXMucmlnaHRSb3dzQ21wICYmICF0aGlzLmRnLnVzZUNvbnRyb2xQYW5lbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50b3RhbFdpZHRoICs9IDE4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Qm9keVN0eWxlKCkge1xyXG4gICAgICAgIGxldCBoID0gdGhpcy5nZXRWaWV3UG9ydEhlaWdodCgpO1xyXG4gICAgICAgIGlmICghdGhpcy5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5hdXRvSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICBoID0gdGhpcy5kZy5lbXB0eURhdGFIZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmZvb3RlckRhdGEgJiYgdGhpcy5kZy5zaG93Rm9vdGVyKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmQgPSB0aGlzLmRnLmZvb3RlckRhdGE7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5mb290ZXJEYXRhLnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZkID0gdGhpcy5kZy5mb290ZXJEYXRhWyd2YWx1ZSddO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChmZCAmJiBBcnJheS5pc0FycmF5KGZkKSAmJiBmZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBoID0gaCAtIHRoaXMuZGcuZm9vdGVySGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0Zvb3RlciAmJiB0aGlzLmRnLmZvb3RlclBvc2l0aW9uID09PSAnYm90aCcpIHtcclxuICAgICAgICAgICAgICAgIGggPSBoIC0gdGhpcy5kZy5mb290ZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaGVpZ2h0OiBgJHtNYXRoLmZsb29yKGgpfXB4YFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVTY3JvbGxQb3NpdGlvbihzY3JvbGxMZWZ0OiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSBzY3JvbGxMZWZ0O1xyXG5cclxuICAgICAgICB0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0ICsgdGhpcy53aWR0aCAtIHRoaXMucmlnaHRGaXhlZFdpZHRoO1xyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0ID09PSB0aGlzLm1heFNjcm9sbExlZnQgfHwgdGhpcy5maXhlZFJpZ2h0U2Nyb2xsTGVmdCA+IHRoaXMubWF4U2Nyb2xsTGVmdCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdGhpcy5tYXhTY3JvbGxMZWZ0O1xyXG4gICAgICAgICAgICB0aGlzLnNob3dSaWdodFNoYWRvdyA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1JpZ2h0U2hhZG93ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkTGVmdEVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZml4ZWRMZWZ0RWwubmF0aXZlRWxlbWVudCwgJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUzZCgke3RoaXMuc2Nyb2xsTGVmdH1weCwgMHB4LCAwcHgpYCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0RWwpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5maXhlZFJpZ2h0RWwubmF0aXZlRWxlbWVudCwgJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUzZCgke3RoaXMuZml4ZWRSaWdodFNjcm9sbExlZnR9cHgsIDBweCwgMHB4KWApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblNjcm9sbFRvWCgkZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHggPSAkZXZlbnQudGFyZ2V0LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTY3JvbGxQb3NpdGlvbih4KTtcclxuICAgICAgICAvLyB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB0aGlzLmRncy5vblNjcm9sbE1vdmUoeCwgU0NST0xMX1hfQUNUSU9OKTtcclxuICAgICAgICB0aGlzLmRncy5zaG93Rml4ZWRTaGFkb3cuZW1pdCh7IHNob3dSaWdodFNoYWRvdzogdGhpcy5zaG93UmlnaHRTaGFkb3csIHg6IHRoaXMuZml4ZWRSaWdodFNjcm9sbExlZnQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TY3JvbGxUb1koJGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBjb25zdCB5ID0gJGV2ZW50LnRhcmdldC5zY3JvbGxUb3A7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLnZpcnR1YWxpemVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlU2Nyb2xsKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IHk7XHJcblxyXG4gICAgICAgIHRoaXMuZGcuc2Nyb2xsWS5lbWl0KHkpO1xyXG4gICAgICAgIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZSh5LCBTQ1JPTExfWV9BQ1RJT04pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUHNYUmVhY2hTdGFydCgkZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHggPSAkZXZlbnQudGFyZ2V0LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTY3JvbGxQb3NpdGlvbih4KTtcclxuICAgICAgICB0aGlzLmRncy5vblNjcm9sbE1vdmUoeCwgU0NST0xMX1hfUkVBQ0hfU1RBUlRfQUNUSU9OKTtcclxuICAgIH1cclxuXHJcbiAgICBvblBzWFJlYWNoRW5kKCRldmVudDogYW55KSB7XHJcbiAgICAgICAgdGhpcy5zaG93UmlnaHRTaGFkb3cgPSBmYWxzZTtcclxuICAgICAgICAvLyBjb25zdCB4ID0gJGV2ZW50LnRhcmdldC5zY3JvbGxMZWZ0O1xyXG4gICAgICAgIC8vIHRoaXMudXBkYXRlU2Nyb2xsUG9zaXRpb24oeCk7XHJcbiAgICAgICAgLy8gdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgLy8gLy8gdGhpcy5kZ3Mub25TaG93Rml4ZWRTaGFkb3codGhpcy5zaG93UmlnaHRTaGFkb3cpO1xyXG4gICAgICAgIC8vIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZSh4LCBTQ1JPTExfWF9SRUFDSF9FTkRfQUNUSU9OKTtcclxuICAgIH1cclxuXHJcbiAgICBpc0NoZWNrZWQocm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKHJvd0RhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGZzLmlzUm93Q2hlY2tlZChyb3dEYXRhW3RoaXMuZGcuaWRGaWVsZF0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNTZWxlY3RlZChyb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAocm93RGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZnMuaXNSb3dTZWxlY3RlZChyb3dEYXRhW3RoaXMuZGcuaWRGaWVsZF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlR3JvdXBSb3cocm93LCBvcGVuID0gdHJ1ZSkge1xyXG4gICAgICAgIHJvdy5leHBhbmRlZCA9IG9wZW47XHJcbiAgICAgICAgdGhpcy5wcy51cGRhdGUoKTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8qKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDliIYgPT09PT09IOmalCA9PT09PT0g57q/ID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXHJcblxyXG4gICAgLyoqIOiOt+WPluWPr+inhuWMuuWfn+mrmOW6piAqL1xyXG4gICAgcHJpdmF0ZSBnZXRWaWV3UG9ydEhlaWdodCgpIHtcclxuICAgICAgICBsZXQgdmlld1BvcnRIZWlnaHQgPSB0aGlzLmRnLmhlaWdodDtcclxuICAgICAgICBpZiAodGhpcy5kZy5zaG93SGVhZGVyKSB7XHJcbiAgICAgICAgICAgIHZpZXdQb3J0SGVpZ2h0ID0gdmlld1BvcnRIZWlnaHQgLSB0aGlzLmRnLnJlYWxIZWFkZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoKHRoaXMuZGcuZW5hYmxlRmlsdGVyUm93IHx8IHRoaXMuZGcuZW5hYmxlU21hcnRGaWx0ZXIpICYmIHRoaXMuZGcuc2hvd0ZpbHRlckJhcikge1xyXG4gICAgICAgICAgICB2aWV3UG9ydEhlaWdodCAtPSB0aGlzLmRnLmZpbHRlckJhckhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLnNob3dSb3dHcm91cFBhbmVsKSB7XHJcbiAgICAgICAgICAgIHZpZXdQb3J0SGVpZ2h0IC09IHRoaXMuZGcucm93R3JvdXBQYW5lbEhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLnNob3dGb290ZXIgJiYgdGhpcy5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB2aWV3UG9ydEhlaWdodCA9IHZpZXdQb3J0SGVpZ2h0IC0gdGhpcy5kZy5mb290ZXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5wYWdpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgIHZpZXdQb3J0SGVpZ2h0ID0gdmlld1BvcnRIZWlnaHQgLSB0aGlzLmRnLnBhZ2VySGVpZ2h0IC0gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLnNob3dCb3JkZXIpIHtcclxuICAgICAgICAgICAgdmlld1BvcnRIZWlnaHQgLT0gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudmlld3BvcnRIID0gdmlld1BvcnRIZWlnaHQ7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdQb3J0SGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOS4jeaKmOihjOaXtu+8jOaJgOacieaVsOaNrueahOmrmOW6plxyXG4gICAgcHJpdmF0ZSBhbGxSb3dzSGVpZ2h0KCkge1xyXG4gICAgICAgIGNvbnN0IHJvd0hlaWdodHBhdGNoID0gMTsgIC8vIHRoaXMuZGcuYXV0b0hlaWdodCA/IDIgOiAxO1xyXG4gICAgICAgIGNvbnN0IHJvd0hlaWdodCA9IHRoaXMuZGcucm93SGVpZ2h0ICsgcm93SGVpZ2h0cGF0Y2g7XHJcblxyXG4gICAgICAgIGxldCBpdGVtc0NvdW50ID0gMDtcclxuICAgICAgICBpZiAodGhpcy5kZy5ncm91cFN1bW1hcnlQb3NpdGlvbiA9PT0gJ2luR3JvdXBSb3cnKSB7XHJcbiAgICAgICAgICAgIGl0ZW1zQ291bnQgPSB0aGlzLmRhdGEuZmlsdGVyKG4gPT4gIW5bJ19fZ3JvdXBfZm9vdGVyX18nXSkubGVuZ3RoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGl0ZW1zQ291bnQgPSB0aGlzLmRhdGEubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGggPSBpdGVtc0NvdW50ICogcm93SGVpZ2h0O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5hdXRvSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGggKz0gaXRlbXNDb3VudDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBoICs9IDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENhbnZhc0hlaWdodCgpIHtcclxuICAgICAgICBsZXQgY2FudmFzSGVpZ2h0ID0gMDtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRhdGEgfHwgIXRoaXMuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXNIZWlnaHQgPSAwO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLm5vd3JhcCkge1xyXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0aGlzLmFsbFJvd3NIZWlnaHQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0aGlzLmdldFRyRG9tSGVpZ2h0KCkucmVkdWNlKChyLCBjKSA9PiByICsgYywgMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWNhbnZhc0hlaWdodCkge1xyXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0aGlzLnZpZXdwb3J0SDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2FudmFzSGVpZ2h0ID0gY2FudmFzSGVpZ2h0O1xyXG4gICAgICAgIHJldHVybiBjYW52YXNIZWlnaHQ7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlQ2FudmFzSGVpZ2h0KCkge1xyXG4gICAgICAgIHRoaXMuY2FudmFzSGVpZ2h0ID0gdGhpcy5nZXRDYW52YXNIZWlnaHQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSb3dGcm9tUG9zaXRpb24oeSkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKHkgLyAodGhpcy5kZy5yb3dIZWlnaHQgKyAxKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmlzaWJsZVJhbmdlKHZpZXdwb3J0VG9wPzogbnVtYmVyLCB2aWV3cG9ydExlZnQ/OiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodmlld3BvcnRUb3AgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2aWV3cG9ydFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmlld3BvcnRMZWZ0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgdmlld3BvcnRMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdG9wOiB0aGlzLmdldFJvd0Zyb21Qb3NpdGlvbih2aWV3cG9ydFRvcCksXHJcbiAgICAgICAgICAgIGJvdHRvbTogdGhpcy5nZXRSb3dGcm9tUG9zaXRpb24odmlld3BvcnRUb3AgKyB0aGlzLnZpZXdwb3J0SCkgKyAxLFxyXG4gICAgICAgICAgICBsZWZ0UHg6IHZpZXdwb3J0TGVmdCxcclxuICAgICAgICAgICAgcmlnaHRQeDogdmlld3BvcnRMZWZ0ICsgdGhpcy52aWV3cG9ydFdcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmVuZGVyZWRSYW5nZSh2aWV3cG9ydFRvcD86IG51bWJlciwgdmlld3BvcnRMZWZ0PzogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgcmFuZ2UgPSB0aGlzLmdldFZpc2libGVSYW5nZSh2aWV3cG9ydFRvcCwgdmlld3BvcnRMZWZ0KTtcclxuICAgICAgICBjb25zdCBidWZmZXIgPSBNYXRoLnJvdW5kKHRoaXMudmlld3BvcnRIIC8gKHRoaXMuZGcucm93SGVpZ2h0ICsgMSkpO1xyXG4gICAgICAgIGNvbnN0IG1pbkJ1ZmZlciA9IHRoaXMubWluUm93QnVmZmVyO1xyXG5cclxuICAgICAgICBpZiAodGhpcy52U2Nyb2xsRGlyID09IC0xKSB7XHJcbiAgICAgICAgICAgIHJhbmdlLnRvcCAtPSBidWZmZXI7XHJcbiAgICAgICAgICAgIHJhbmdlLmJvdHRvbSArPSBtaW5CdWZmZXI7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZTY3JvbGxEaXIgPT0gMSkge1xyXG4gICAgICAgICAgICByYW5nZS50b3AgLT0gbWluQnVmZmVyO1xyXG4gICAgICAgICAgICByYW5nZS5ib3R0b20gKz0gYnVmZmVyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJhbmdlLnRvcCAtPSBtaW5CdWZmZXI7XHJcbiAgICAgICAgICAgIHJhbmdlLmJvdHRvbSArPSBtaW5CdWZmZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByYW5nZS50b3AgPSBNYXRoLm1heCgwLCByYW5nZS50b3ApO1xyXG4gICAgICAgIHJhbmdlLmJvdHRvbSA9IE1hdGgubWluKHRoaXMuZGF0YS5sZW5ndGggLSAxLCByYW5nZS5ib3R0b20pO1xyXG5cclxuICAgICAgICByYW5nZS5sZWZ0UHggLT0gdGhpcy52aWV3cG9ydFc7XHJcbiAgICAgICAgcmFuZ2UucmlnaHRQeCArPSB0aGlzLnZpZXdwb3J0VztcclxuXHJcbiAgICAgICAgcmFuZ2UubGVmdFB4ID0gTWF0aC5tYXgoMCwgcmFuZ2UubGVmdFB4KTtcclxuICAgICAgICByYW5nZS5yaWdodFB4ID0gTWF0aC5taW4odGhpcy5jYW52YXNXaWR0aCwgcmFuZ2UucmlnaHRQeCk7XHJcblxyXG4gICAgICAgIHJldHVybiByYW5nZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbmRlclJvd3MocmFuZ2UpIHtcclxuICAgICAgICBjb25zdCByb3dzID0gW107XHJcbiAgICAgICAgY29uc3QgZGF0YUxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGg7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSByYW5nZS50b3A7IGkgPD0gcmFuZ2UuYm90dG9tOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucm93c0NhY2hlW2ldIHx8IChpID09IGRhdGFMZW5ndGgpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByb3dzLnB1c2goaSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgYW4gZW50cnkgcmlnaHQgYXdheSBzbyB0aGF0IGFwcGVuZFJvd0h0bWwoKSBjYW5cclxuICAgICAgICAgICAgLy8gc3RhcnQgcG9wdWxhdGF0aW5nIGl0LlxyXG4gICAgICAgICAgICB0aGlzLnJvd3NDYWNoZVtpXSA9IHtcclxuICAgICAgICAgICAgICAgIHJvd05vZGU6IG51bGwsXHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29sU3BhbnMgb2YgcmVuZGVyZWQgY2VsbHMgKGJ5IGNvbHVtbiBpZHgpLlxyXG4gICAgICAgICAgICAgICAgLy8gQ2FuIGFsc28gYmUgdXNlZCBmb3IgY2hlY2tpbmcgd2hldGhlciBhIGNlbGwgaGFzIGJlZW4gcmVuZGVyZWQuXHJcbiAgICAgICAgICAgICAgICBjZWxsQ29sU3BhbnM6IFtdLFxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENlbGwgbm9kZXMgKGJ5IGNvbHVtbiBpZHgpLiAgTGF6eS1wb3B1bGF0ZWQgYnkgZW5zdXJlQ2VsbE5vZGVzSW5Sb3dzQ2FjaGUoKS5cclxuICAgICAgICAgICAgICAgIGNlbGxOb2Rlc0J5Q29sdW1uSWR4OiBbXSxcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb2x1bW4gaW5kaWNlcyBvZiBjZWxsIG5vZGVzIHRoYXQgaGF2ZSBiZWVuIHJlbmRlcmVkLCBidXQgbm90IHlldCBpbmRleGVkIGluXHJcbiAgICAgICAgICAgICAgICAvLyBjZWxsTm9kZXNCeUNvbHVtbklkeC4gIFRoZXNlIGFyZSBpbiB0aGUgc2FtZSBvcmRlciBhcyBjZWxsIG5vZGVzIGFkZGVkIGF0IHRoZVxyXG4gICAgICAgICAgICAgICAgLy8gZW5kIG9mIHRoZSByb3cuXHJcbiAgICAgICAgICAgICAgICBjZWxsUmVuZGVyUXVldWU6IFtdXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSByb3dzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5yb3dzQ2FjaGVbcm93c1tpXV0ucm93Tm9kZSA9IHRoaXMuZGF0YVtyb3dzW2ldXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLnJvd3NDYWNoZSkubWFwKG4gPT4gdGhpcy5yb3dzQ2FjaGVbbl0ucm93Tm9kZSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlUm93RnJvbUNhY2hlKHJvdykge1xyXG4gICAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSB0aGlzLnJvd3NDYWNoZVtyb3ddO1xyXG4gICAgICAgIGlmICghY2FjaGVFbnRyeSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkZWxldGUgdGhpcy5yb3dzQ2FjaGVbcm93XTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsZWFudXBSb3dzKHJhbmdlVG9LZWVwKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBpIGluIHRoaXMucm93c0NhY2hlKSB7XHJcbiAgICAgICAgICAgIGlmIChpIDwgcmFuZ2VUb0tlZXAudG9wIHx8IGkgPiByYW5nZVRvS2VlcC5ib3R0b20pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlUm93RnJvbUNhY2hlKGkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVuZGVyRGF0YShkZXRlY3RjaGFuZ2VzID0gdHJ1ZSkge1xyXG4gICAgICAgIHRoaXMuY2FudmFzSGVpZ2h0ID0gdGhpcy5nZXRDYW52YXNIZWlnaHQoKTtcclxuICAgICAgICBpZiAoIXRoaXMuZGcudmlydHVhbGl6ZWQgfHwgdGhpcy5kZy5hdXRvSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMucm93cyA9IHRoaXMuZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCB2aXNpYmxlID0gdGhpcy5nZXRWaXNpYmxlUmFuZ2UoKTtcclxuICAgICAgICAgICAgY29uc3QgcmVuZGVyZWQgPSB0aGlzLmdldFJlbmRlcmVkUmFuZ2UoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlbW92ZSByb3dzIG5vIGxvbmdlciBpbiB0aGUgdmlld3BvcnRcclxuICAgICAgICAgICAgdGhpcy5jbGVhbnVwUm93cyhyZW5kZXJlZCk7XHJcblxyXG4gICAgICAgICAgICAvLyByZW5kZXIgbWlzc2luZyByb3dzXHJcbiAgICAgICAgICAgIHRoaXMucm93cyA9IHRoaXMucmVuZGVyUm93cyhyZW5kZXJlZCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnRSb3dJbmRleCA9IHJlbmRlcmVkLnRvcDtcclxuICAgICAgICAgICAgdGhpcy5ibGFua1RvcEhlaWdodCA9IHRoaXMuc3RhcnRSb3dJbmRleCAqICh0aGlzLmRnLnJvd0hlaWdodCArIDEpO1xyXG4gICAgICAgICAgICB0aGlzLmJsYW5rQm90dG9tSGVpZ2h0ID0gdGhpcy5jYW52YXNIZWlnaHQgLSB0aGlzLmJsYW5rVG9wSGVpZ2h0IC0gKHRoaXMucm93cy5sZW5ndGggKiAodGhpcy5kZy5yb3dIZWlnaHQgKyAxKSk7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdFJlbmRlcmVkU2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdFJlbmRlcmVkU2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcclxuICAgICAgICAgICAgaWYgKGRldGVjdGNoYW5nZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaGFuZGxlU2Nyb2xsKCkge1xyXG4gICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gdGhpcy5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsVG9wO1xyXG4gICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9IHRoaXMucHMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVNjcm9sbCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2hhbmRsZVNjcm9sbCgpIHtcclxuICAgICAgICBjb25zdCB2aWV3cG9ydENvbnRhaW5lciA9IHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIGxldCBtYXhTY3JvbGxEaXN0YW5jZVkgPSB2aWV3cG9ydENvbnRhaW5lci5zY3JvbGxIZWlnaHQgLSB2aWV3cG9ydENvbnRhaW5lci5jbGllbnRIZWlnaHQ7XHJcbiAgICAgICAgbGV0IG1heFNjcm9sbERpc3RhbmNlWCA9IHZpZXdwb3J0Q29udGFpbmVyLnNjcm9sbFdpZHRoIC0gdmlld3BvcnRDb250YWluZXIuY2xpZW50V2lkdGg7XHJcblxyXG4gICAgICAgIC8vIFByb3RlY3QgYWdhaW5zdCBlcnJvbmVvdXMgY2xpZW50SGVpZ2h0L1dpZHRoIGdyZWF0ZXIgdGhhbiBzY3JvbGxIZWlnaHQvV2lkdGguXHJcbiAgICAgICAgLy8gU29tZXRpbWVzIHNlZW4gaW4gQ2hyb21lLlxyXG4gICAgICAgIG1heFNjcm9sbERpc3RhbmNlWSA9IE1hdGgubWF4KDAsIG1heFNjcm9sbERpc3RhbmNlWSk7XHJcbiAgICAgICAgbWF4U2Nyb2xsRGlzdGFuY2VYID0gTWF0aC5tYXgoMCwgbWF4U2Nyb2xsRGlzdGFuY2VYKTtcclxuXHJcbiAgICAgICAgLy8gQ2VpbGluZyB0aGUgbWF4IHNjcm9sbCB2YWx1ZXNcclxuICAgICAgICBpZiAodGhpcy5zY3JvbGxUb3AgPiBtYXhTY3JvbGxEaXN0YW5jZVkpIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSBtYXhTY3JvbGxEaXN0YW5jZVk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNjcm9sbExlZnQgPiBtYXhTY3JvbGxEaXN0YW5jZVgpIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxMZWZ0ID0gbWF4U2Nyb2xsRGlzdGFuY2VYO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdlNjcm9sbERpc3QgPSBNYXRoLmFicyh0aGlzLnNjcm9sbFRvcCAtIHRoaXMucHJldlNjcm9sbFRvcCk7XHJcbiAgICAgICAgY29uc3QgaFNjcm9sbERpc3QgPSBNYXRoLmFicyh0aGlzLnNjcm9sbExlZnQgLSB0aGlzLnByZXZTY3JvbGxMZWZ0KTtcclxuXHJcbiAgICAgICAgaWYgKGhTY3JvbGxEaXN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJldlNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XHJcblxyXG4gICAgICAgICAgICAvLyAkdmlld3BvcnRTY3JvbGxDb250YWluZXJYWzBdLnNjcm9sbExlZnQgPSBzY3JvbGxMZWZ0O1xyXG4gICAgICAgICAgICAvLyBpZiAoaGFzRnJvemVuQ29sdW1ucygpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAoaGFzRnJvemVuUm93cykge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICR2aWV3cG9ydFRvcFJbMF0uc2Nyb2xsTGVmdCA9IHNjcm9sbExlZnQ7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAoaGFzRnJvemVuUm93cykge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICR2aWV3cG9ydFRvcExbMF0uc2Nyb2xsTGVmdCA9IHNjcm9sbExlZnQ7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh2U2Nyb2xsRGlzdCkge1xyXG4gICAgICAgICAgICB0aGlzLnZTY3JvbGxEaXIgPSB0aGlzLnByZXZTY3JvbGxUb3AgPCB0aGlzLnNjcm9sbFRvcCA/IDEgOiAtMTtcclxuICAgICAgICAgICAgdGhpcy5wcmV2U2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiAoaGFzRnJvemVuQ29sdW1ucygpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAoaGFzRnJvemVuUm93cyAmJiAhb3B0aW9ucy5mcm96ZW5Cb3R0b20pIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAkdmlld3BvcnRCb3R0b21MWzBdLnNjcm9sbFRvcCA9IHNjcm9sbFRvcDtcclxuICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgJHZpZXdwb3J0VG9wTFswXS5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHN3aXRjaCB2aXJ0dWFsIHBhZ2VzIGlmIG5lZWRlZFxyXG4gICAgICAgICAgICBpZiAodlNjcm9sbERpc3QgPCB0aGlzLnZpZXdwb3J0SCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2Nyb2xsVG8odGhpcy5zY3JvbGxUb3ApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaFNjcm9sbERpc3QgfHwgdlNjcm9sbERpc3QpIHtcclxuICAgICAgICAgICAgY29uc3QgZHggPSBNYXRoLmFicyh0aGlzLmxhc3RSZW5kZXJlZFNjcm9sbExlZnQgLSB0aGlzLnNjcm9sbExlZnQpO1xyXG4gICAgICAgICAgICBjb25zdCBkeSA9IE1hdGguYWJzKHRoaXMubGFzdFJlbmRlcmVkU2Nyb2xsVG9wIC0gdGhpcy5zY3JvbGxUb3ApO1xyXG4gICAgICAgICAgICBpZiAoZHggPiAyMCB8fCBkeSA+IDIwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiByZW5kZXJpbmcgaXMgZm9yY2VkIG9yIHNjcm9sbGluZyBpcyBzbWFsbCBlbm91Z2ggdG8gYmUgXCJlYXN5XCIsIGp1c3QgcmVuZGVyXHJcbiAgICAgICAgICAgICAgICBpZiAoZHkgPCB0aGlzLnZpZXdwb3J0SCAmJiBkeCA8IHRoaXMudmlld3BvcnRXKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaFNjcm9sbERpc3QgfHwgdlNjcm9sbERpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9zY3JvbGxUbyh5KSB7XHJcbiAgICAgICAgY29uc3QgJHZpZXdwb3J0U2Nyb2xsQ29udGFpbmVyWSA9IHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIHkgPSBNYXRoLm1heCh5LCAwKTtcclxuICAgICAgICB5ID0gTWF0aC5taW4oeSwgdGhpcy5jYW52YXNIZWlnaHQgLSB0aGlzLnZpZXdwb3J0SCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1Njcm9sbFRvcCA9IHk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnByZXZTY3JvbGxUb3AgIT0gbmV3U2Nyb2xsVG9wKSB7XHJcbiAgICAgICAgICAgIHRoaXMudlNjcm9sbERpciA9ICh0aGlzLnByZXZTY3JvbGxUb3AgPCBuZXdTY3JvbGxUb3ApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZW5kZXJlZFNjcm9sbFRvcCA9ICh0aGlzLnNjcm9sbFRvcCA9IHRoaXMucHJldlNjcm9sbFRvcCA9IG5ld1Njcm9sbFRvcCk7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiAoaGFzRnJvemVuQ29sdW1ucygpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAkdmlld3BvcnRUb3BMWzBdLnNjcm9sbFRvcCA9IG5ld1Njcm9sbFRvcDtcclxuICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAgICAgLy8gaWYgKGhhc0Zyb3plblJvd3MpIHtcclxuICAgICAgICAgICAgLy8gICAgICR2aWV3cG9ydEJvdHRvbUxbMF0uc2Nyb2xsVG9wID0gJHZpZXdwb3J0Qm90dG9tUlswXS5zY3JvbGxUb3AgPSBuZXdTY3JvbGxUb3A7XHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIC8vICR2aWV3cG9ydFNjcm9sbENvbnRhaW5lclkuc2Nyb2xsVG9wID0gbmV3U2Nyb2xsVG9wO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbk1vdXNlQ2xpY2soJGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5jbGljaygpO1xyXG4gICAgICAgIGNvbnN0IHRhcmdldCA9ICRldmVudC50YXJnZXQgYXMgYW55O1xyXG5cclxuICAgICAgICBpZiAodGFyZ2V0Lm5vZGVOYW1lID09PSAnVEVYVEFSRUEnIHx8IHRhcmdldC5ub2RlTmFtZSA9PT0gJ0lOUFVUJyApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGxldCB0ZCA9IHRhcmdldDtcclxuICAgICAgICBpZiAodGFyZ2V0Lm5vZGVOYW1lICE9PSAnVEQnKSB7XHJcbiAgICAgICAgICAgIHRkID0gdGFyZ2V0LmNsb3Nlc3QoJ1REJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuZWRpdGFibGUgJiYgdGhpcy5fX3RyaWdnZXJCb2R5Q2xpY2tFdmVudCkge1xyXG4gICAgICAgICAgICAvLyDop6PlhrPotoXpk77ngrnlh7vkuovku7bvvIzopoHlhYjmiafooYzpgInkuK3ooYxcclxuICAgICAgICAgICAgaWYgKHRkICYmIHRkLnNlbGVjdENlbGwgKSB7XHJcbiAgICAgICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0ZC5zZWxlY3RDZWxsKCRldmVudCwgdGQpOyAgLy8g5oyJ55CG6K+05Y+v5Lul5Yig6Zmk55qE77yM5L2G5LiN5pWi5Yqo5ZOmbyjiiaflj6PiiaYpb1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmVkaXRNb2RlID09PSAncm93Jykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKHRkKSB7XHJcbiAgICAgICAgICAgIC8vIOihjOemgeeUqOaXtlxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlUm93ICYmIHRkLmdyaWRDZWxsRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyByb3dEYXRhLCByb3dJbmRleCB9ID0gdGQuZ3JpZENlbGxEYXRhO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZVJvdyhyb3dEYXRhLCByb3dJbmRleCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJyAmJiB0ZC5lZGl0KSB7XHJcbiAgICAgICAgICAgICAgICB0ZC5lZGl0KCRldmVudCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGQuc2VsZWN0Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZC5jbG9zZUVkaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZC5zZWxlY3RDZWxsKCRldmVudCwgdGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBvbkJlZm9yZVNob3dDb250ZXh0TWVudSA9IChlOiBhbnkpID0+IHtcclxuICAgICAgICAvLyByb3dfMV9maXhlZGxlZnQgIHJvd18xICByb3dfMV9maXhlZHJpZ2h0XHJcbiAgICAgICAgY29uc3QgeyBjb250ZXh0TWVudURvbSwgZXZlbnQgfSA9IGU7XHJcblxyXG4gICAgICAgIGlmIChldmVudC50YXJnZXQuY2xvc2VzdCgnLmRhdGFncmlkLWVkaXRvcicpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih7c2hvdzogZmFsc2V9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBsZXQgcm93SUQgPSBldmVudC50YXJnZXQuaWQ7XHJcblxyXG4gICAgICAgIGlmIChjb250ZXh0TWVudURvbSkge1xyXG4gICAgICAgICAgICAvLyDmjpLpmaTliIbnu4TooYzjgIHliIbnu4TlkIjorqHooYxcclxuICAgICAgICAgICAgaWYgKGNvbnRleHRNZW51RG9tLmNsYXNzTmFtZS5pbmRleE9mKCdmLWRhdGFncmlkLWdyb3VwLXJvdycpID09PSAtMSAmJiBjb250ZXh0TWVudURvbS5jbGFzc05hbWUuaW5kZXhPZignZi1kYXRhZ3JpZC1ncm91cC1mb290ZXInKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJvd0lEID0gY29udGV4dE1lbnVEb20uaWQucmVwbGFjZSgncm93XycsICcnKS5yZXBsYWNlKCdfZml4ZWRsZWZ0JywgJycpLnJlcGxhY2UoJ19maXhlZHJpZ2h0JywgJycpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93RGF0YSA9IHRoaXMuZGZzLmZpbmRSb3cocm93SUQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9jdXNUYXJnZXRXaWR0aCA9IHRoaXMudmlld3BvcnRXID4gdGhpcy50b3RhbFdpZHRoID8gdGhpcy50b3RhbFdpZHRoIDogdGhpcy52aWV3cG9ydFc7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YoeyBzaG93OiB0cnVlLCBkYXRhOiB7IGRhdGE6IHJvd0RhdGEuZGF0YSwgZ3JpZDogdGhpcy5kZ30sIGZvY3VzVGFyZ2V0V2lkdGggfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9mKHsgc2hvdzogZmFsc2UgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19