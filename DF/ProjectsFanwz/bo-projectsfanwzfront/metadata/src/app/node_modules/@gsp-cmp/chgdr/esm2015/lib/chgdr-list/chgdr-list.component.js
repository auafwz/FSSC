/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Injector, Input } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { NotifyService } from '@farris/ui-notify';
import { ChgdrService } from '../service/chgdr.service';
import { ChangeDataQueryParam } from '../model/change-data-query-param';
import { ChangeDataQueryResult } from '../model/change-data-query-result';
import { ErrorUtil } from '../util/error.util';
import { TimeUtil } from '../util/time.util';
export class ChgdrListComponent {
    /**
     * @param {?} chgdrService
     * @param {?} messageService
     * @param {?} notifyService
     * @param {?} injector
     */
    constructor(chgdrService, messageService, notifyService, injector) {
        this.chgdrService = chgdrService;
        this.messageService = messageService;
        this.notifyService = notifyService;
        this.injector = injector;
        this.baseCls = true;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        let chgdrs = new ChangeDataQueryResult();
        chgdrs.total = 0;
        chgdrs.pageSize = 20;
        chgdrs.pageIndex = 1;
        chgdrs.headers = [];
        this.chgdrs = chgdrs;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (!this.changeTimeStart && !this.changeTimeEnd) {
            //未录入变更时间范围，则查询最近一周的
            this.changeTimeEnd = TimeUtil.getEndTimeInDay(new Date());
            this.changeTimeStart = TimeUtil.getStartTimeInDay(new Date(new Date().getTime() - 7 * 24 * 60 * 60 * 1000));
        }
        else if (!this.changeTimeEnd) {
            //如果未设置截至时间，则与开始时间相同
            this.changeTimeEnd = TimeUtil.getEndTimeInDay(this.changeTimeStart);
        }
        else if (!this.changeTimeStart) {
            //如果未设置开始时间，则与截至时间相同
            this.changeTimeStart = TimeUtil.getEndTimeInDay(this.changeTimeEnd);
        }
        if (!!this.entityId) {
            /** @type {?} */
            let param = this.buildQueryParam();
            this.doQuery(param);
        }
    }
    /**
     * @return {?}
     */
    query() {
        /** @type {?} */
        let param = this.buildQueryParam();
        this.doQuery(param);
    }
    /**
     * @private
     * @return {?}
     */
    buildQueryParam() {
        /** @type {?} */
        let param = new ChangeDataQueryParam();
        param.pageIndex = 1;
        param.pageSize = 20;
        param.entityId = this.entityId;
        param.dataId = this.dataId;
        param.changeTimeStart = this.changeTimeStart;
        param.changeTimeEnd = this.changeTimeEnd;
        return param;
    }
    /**
     * @private
     * @param {?} param
     * @return {?}
     */
    doQuery(param) {
        this.chgdrService.queryChangeDataHeader(param).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            this.currentQueryParam = param;
            this.chgdrs = data;
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            console.error("查询业务变更日志出错", error);
            this.messageService.error("查询业务变更日志出错：" + ErrorUtil.getErrorMessage(error));
        }));
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onPageChanged($event) {
        if (!$event) {
            return;
        }
        if ($event.pageIndex) {
            this.currentQueryParam.pageIndex = $event.pageIndex;
        }
        if ($event.pageSize) {
            this.currentQueryParam.pageSize = $event.pageSize;
        }
        this.doQuery(this.currentQueryParam);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onPageSizeChanged($event) {
        this.currentQueryParam.pageSize = $event;
        this.doQuery(this.currentQueryParam);
    }
}
ChgdrListComponent.decorators = [
    { type: Component, args: [{
                selector: 'chgdr-list',
                template: "<div class=\"farris-form farris-form-controls-inline\" style=\"background: #fff;\">\n  <form class=\"f-section-formgroup\" style=\"padding-top: 10px;\">\n    <div class=\"f-section-formgroup-inputs\">\n      <div class=\"col-12 row\">\n        <div class=\"farris-group-wrap col-5\">\n          <div class=\"form-group farris-form-group\">\n            <label class=\"col-form-label\">\n              <span class=\"farris-label-info text-danger\">*</span><span class=\"farris-label-text\">\u5F00\u59CB\u65F6\u95F4</span>\n            </label>\n            <div class=\"farris-input-wrap\">\n              <farris-datepicker [(ngModel)]=\"changeTimeStart\" name=\"changeTimeStart\"></farris-datepicker>\n            </div>\n          </div>\n        </div>\n        <div class=\"farris-group-wrap col-5\">\n          <div class=\"form-group farris-form-group\">\n            <label class=\"col-form-label\">\n              <span class=\"farris-label-info text-danger\">*</span><span class=\"farris-label-text\">\u7ED3\u675F\u65F6\u95F4</span>\n            </label>\n            <div class=\"farris-input-wrap\">\n              <farris-datepicker [(ngModel)]=\"changeTimeEnd\" name=\"changeTimeEnd\"></farris-datepicker>\n            </div>\n          </div>\n        </div>\n        <div class=\"farris-group-wrap col-2\">\n          <div class=\"form-group farris-form-group\">\n            <label class=\"col-form-label\">\n              <button class=\"btn btn-primary mr-2\" (click)=\"query()\">\u67E5\u8BE2</button>\n            </label>\n            <div class=\"farris-input-wrap\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n\n<lib-chgdr-header-datagrid\n  [chgdrs]=\"chgdrs\" \n  (pageChanged)=\"onPageChanged($event)\" \n  (pageSizeChanged)=\"onPageSizeChanged($event)\"\n  [showDataId]=\"false\"\n></lib-chgdr-header-datagrid>\n\n<!-- <div class=\"f-utils-fill\">\n  <farris-datagrid #chgdrGrid idField=\"id\" [columns]=\"columns\" [data]=\"chgdrs.headers\"\n  showLineNumber=\"true\" [fit]=\"true\" [fitColumns]=\"true\" \n  [pagination]=\"true\" [pageSize]=\"20\" [showPageList]=\"false\" [pageIndex]=\"chgdrs.pageIndex\" [total]=\"chgdrs.total\"\n  (pageChanged)=\"onPageChanged($event)\" (pageSizeChanged)=\"onPageSizeChanged($event)\"\n  >\n  </farris-datagrid>\n  <ng-template #opCell let-ctx>\n    <a href=\"javascript: void(0);\" (click)=\"showChangeDetail(ctx)\">\u53D8\u66F4\u8BE6\u60C5</a>\n  </ng-template>\n</div> -->\n\n<!-- \u67E5\u770B\u53D8\u66F4\u65E5\u5FD7\u7684\u5F39\u7A97 -->\n<!-- <farris-dialog #chgdrInfoDialog\n  title=\"\u53D8\u66F4\u65E5\u5FD7\u8BE6\u60C5\"\n  [width]=\"1100\"\n  [height]=\"600\"\n  [showMaxButton]=\"true\"\n  [resizable]=\"true\"\n  [showButtons]=\"false\"\n>\n  <chgdr-data-viewer [data]=\"currentChgdrData\"></chgdr-data-viewer>\n</farris-dialog> -->",
                styles: [""]
            }] }
];
/** @nocollapse */
ChgdrListComponent.ctorParameters = () => [
    { type: ChgdrService },
    { type: MessagerService },
    { type: NotifyService },
    { type: Injector }
];
ChgdrListComponent.propDecorators = {
    baseCls: [{ type: HostBinding, args: ['class.f-utils-fill-flex-column',] }],
    entityId: [{ type: Input }],
    dataId: [{ type: Input }],
    changeTimeStart: [{ type: Input }],
    changeTimeEnd: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ChgdrListComponent.prototype.baseCls;
    /** @type {?} */
    ChgdrListComponent.prototype.entityId;
    /** @type {?} */
    ChgdrListComponent.prototype.dataId;
    /** @type {?} */
    ChgdrListComponent.prototype.changeTimeStart;
    /** @type {?} */
    ChgdrListComponent.prototype.changeTimeEnd;
    /**
     * @type {?}
     * @private
     */
    ChgdrListComponent.prototype.currentQueryParam;
    /** @type {?} */
    ChgdrListComponent.prototype.chgdrs;
    /**
     * @type {?}
     * @private
     */
    ChgdrListComponent.prototype.chgdrService;
    /**
     * @type {?}
     * @private
     */
    ChgdrListComponent.prototype.messageService;
    /**
     * @type {?}
     * @private
     */
    ChgdrListComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    ChgdrListComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hnZHItbGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWNtcC9jaGdkci8iLCJzb3VyY2VzIjpbImxpYi9jaGdkci1saXN0L2NoZ2RyLWxpc3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUE0RCxNQUFNLGVBQWUsQ0FBQztBQUVsSSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUV4RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUUxRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDL0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBTzdDLE1BQU0sT0FBTyxrQkFBa0I7Ozs7Ozs7SUFtQjdCLFlBQW9CLFlBQTBCLEVBQ3BDLGNBQStCLEVBQy9CLGFBQTRCLEVBQzVCLFFBQWtCO1FBSFIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDcEMsbUJBQWMsR0FBZCxjQUFjLENBQWlCO1FBQy9CLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFyQm1CLFlBQU8sR0FBRyxJQUFJLENBQUM7SUFxQjlCLENBQUM7Ozs7SUFFakMsUUFBUTs7WUFDRixNQUFNLEdBQUcsSUFBSSxxQkFBcUIsRUFBRTtRQUN4QyxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNyQixNQUFNLENB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UUFDRCxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDbkIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO1NBQ25EO1FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN2QyxDQUFDOzs7OztJQUVELGlCQUFpQixDQUFDLE1BQU07UUFDdEIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUM7UUFDekMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN2QyxDQUFDOzs7WUFuR0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxZQUFZO2dCQUN0QiwrekZBQTBDOzthQUUzQzs7OztZQVpRLFlBQVk7WUFGWixlQUFlO1lBQ2YsYUFBYTtZQUhXLFFBQVE7OztzQkFrQnRDLFdBQVcsU0FBQyxnQ0FBZ0M7dUJBRTVDLEtBQUs7cUJBR0wsS0FBSzs4QkFHTCxLQUFLOzRCQUdMLEtBQUs7Ozs7SUFYTixxQ0FBOEQ7O0lBRTlELHNDQUVpQjs7SUFDakIsb0NBRWU7O0lBQ2YsNkNBRXNCOztJQUN0QiwyQ0FFb0I7Ozs7O0lBRXBCLCtDQUFnRDs7SUFDaEQsb0NBQThCOzs7OztJQUVsQiwwQ0FBa0M7Ozs7O0lBQzVDLDRDQUF1Qzs7Ozs7SUFDdkMsMkNBQW9DOzs7OztJQUNwQyxzQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEhvc3RCaW5kaW5nLCBJbmplY3RvciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBTaW1wbGVDaGFuZ2VzLCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEaWFsb2dDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRpYWxvZyc7XG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XG5pbXBvcnQgeyBDaGdkclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2NoZ2RyLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2hhbmdlRGF0YUhlYWRlciB9IGZyb20gJy4uL21vZGVsL2NoYW5nZS1kYXRhLWhlYWRlcic7XG5pbXBvcnQgeyBDaGFuZ2VEYXRhUXVlcnlQYXJhbSB9IGZyb20gJy4uL21vZGVsL2NoYW5nZS1kYXRhLXF1ZXJ5LXBhcmFtJztcbmltcG9ydCB7IENoYW5nZURhdGFRdWVyeVJlc3VsdCB9IGZyb20gJy4uL21vZGVsL2NoYW5nZS1kYXRhLXF1ZXJ5LXJlc3VsdCc7XG5pbXBvcnQgeyBPcGVyYXRlVHlwZSB9IGZyb20gJy4uL21vZGVsL29wZXJhdGUtdHlwZSc7XG5pbXBvcnQgeyBFcnJvclV0aWwgfSBmcm9tICcuLi91dGlsL2Vycm9yLnV0aWwnO1xuaW1wb3J0IHsgVGltZVV0aWwgfSBmcm9tICcuLi91dGlsL3RpbWUudXRpbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2NoZ2RyLWxpc3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vY2hnZHItbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NoZ2RyLWxpc3QuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIENoZ2RyTGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5mLXV0aWxzLWZpbGwtZmxleC1jb2x1bW4nKSBiYXNlQ2xzID0gdHJ1ZTtcblxuICBASW5wdXQoKVxuICAvKiog5Lia5Yqh5a6e5L2TSUQgKi9cbiAgZW50aXR5SWQ6IHN0cmluZztcbiAgQElucHV0KClcbiAgLyoqIOaVsOaNrklEICovXG4gIGRhdGFJZDogc3RyaW5nO1xuICBASW5wdXQoKVxuICAvKiog5Y+Y5pu05pe26Ze0Lei1t+WniyAqL1xuICBjaGFuZ2VUaW1lU3RhcnQ6IERhdGU7XG4gIEBJbnB1dCgpXG4gIC8qKiDlj5jmm7Tml7bpl7Qt57uT5p2fICovXG4gIGNoYW5nZVRpbWVFbmQ6IERhdGU7XG5cbiAgcHJpdmF0ZSBjdXJyZW50UXVlcnlQYXJhbTogQ2hhbmdlRGF0YVF1ZXJ5UGFyYW07XG4gIGNoZ2RyczogQ2hhbmdlRGF0YVF1ZXJ5UmVzdWx0O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2hnZHJTZXJ2aWNlOiBDaGdkclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBtZXNzYWdlU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZSxcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcikgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgbGV0IGNoZ2RycyA9IG5ldyBDaGFuZ2VEYXRhUXVlcnlSZXN1bHQoKTtcbiAgICBjaGdkcnMudG90YWwgPSAwO1xuICAgIGNoZ2Rycy5wYWdlU2l6ZSA9IDIwO1xuICAgIGNoZ2Rycy5wYWdlSW5kZXggPSAxO1xuICAgIGNoZ2Rycy5oZWFkZXJzID0gW107XG4gICAgdGhpcy5jaGdkcnMgPSBjaGdkcnM7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNoYW5nZVRpbWVTdGFydCAmJiAhdGhpcy5jaGFuZ2VUaW1lRW5kKSB7XG4gICAgICAvL+acquW9leWFpeWPmOabtOaXtumXtOiMg+WbtO+8jOWImeafpeivouacgOi/keS4gOWRqOeahFxuICAgICAgdGhpcy5jaGFuZ2VUaW1lRW5kID0gVGltZVV0aWwuZ2V0RW5kVGltZUluRGF5KG5ldyBEYXRlKCkpO1xuICAgICAgdGhpcy5jaGFuZ2VUaW1lU3RhcnQgPSBUaW1lVXRpbC5nZXRTdGFydFRpbWVJbkRheShuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7XG4gICAgfSBlbHNlIGlmICghdGhpcy5jaGFuZ2VUaW1lRW5kKSB7XG4gICAgICAvL+WmguaenOacquiuvue9ruaIquiHs+aXtumXtO+8jOWImeS4juW8gOWni+aXtumXtOebuOWQjFxuICAgICAgdGhpcy5jaGFuZ2VUaW1lRW5kID0gVGltZVV0aWwuZ2V0RW5kVGltZUluRGF5KHRoaXMuY2hhbmdlVGltZVN0YXJ0KTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLmNoYW5nZVRpbWVTdGFydCkge1xuICAgICAgLy/lpoLmnpzmnKrorr7nva7lvIDlp4vml7bpl7TvvIzliJnkuI7miKroh7Pml7bpl7Tnm7jlkIxcbiAgICAgIHRoaXMuY2hhbmdlVGltZVN0YXJ0ID0gVGltZVV0aWwuZ2V0RW5kVGltZUluRGF5KHRoaXMuY2hhbmdlVGltZUVuZCk7XG4gICAgfVxuICAgIGlmICghIXRoaXMuZW50aXR5SWQpIHtcbiAgICAgIGxldCBwYXJhbSA9IHRoaXMuYnVpbGRRdWVyeVBhcmFtKCk7XG4gICAgICB0aGlzLmRvUXVlcnkocGFyYW0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBxdWVyeSgpe1xuICAgIGxldCBwYXJhbSA9IHRoaXMuYnVpbGRRdWVyeVBhcmFtKCk7XG4gICAgdGhpcy5kb1F1ZXJ5KHBhcmFtKTtcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRRdWVyeVBhcmFtKCkge1xuICAgIGxldCBwYXJhbSA9IG5ldyBDaGFuZ2VEYXRhUXVlcnlQYXJhbSgpO1xuICAgIHBhcmFtLnBhZ2VJbmRleCA9IDE7XG4gICAgcGFyYW0ucGFnZVNpemUgPSAyMDtcbiAgICBwYXJhbS5lbnRpdHlJZCA9IHRoaXMuZW50aXR5SWQ7XG4gICAgcGFyYW0uZGF0YUlkID0gdGhpcy5kYXRhSWQ7XG4gICAgcGFyYW0uY2hhbmdlVGltZVN0YXJ0ID0gdGhpcy5jaGFuZ2VUaW1lU3RhcnQ7XG4gICAgcGFyYW0uY2hhbmdlVGltZUVuZCA9IHRoaXMuY2hhbmdlVGltZUVuZDtcbiAgICByZXR1cm4gcGFyYW07XG4gIH1cblxuICBwcml2YXRlIGRvUXVlcnkocGFyYW0pIHtcbiAgICB0aGlzLmNoZ2RyU2VydmljZS5xdWVyeUNoYW5nZURhdGFIZWFkZXIocGFyYW0pLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgIHRoaXMuY3VycmVudFF1ZXJ5UGFyYW0gPSBwYXJhbTtcbiAgICAgIHRoaXMuY2hnZHJzID0gZGF0YTtcbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi5p+l6K+i5Lia5Yqh5Y+Y5pu05pel5b+X5Ye66ZSZXCIsIGVycm9yKTtcbiAgICAgIHRoaXMubWVzc2FnZVNlcnZpY2UuZXJyb3IoXCLmn6Xor6LkuJrliqHlj5jmm7Tml6Xlv5flh7rplJnvvJpcIiArIEVycm9yVXRpbC5nZXRFcnJvck1lc3NhZ2UoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9uUGFnZUNoYW5nZWQoJGV2ZW50KSB7XG4gICAgaWYgKCEkZXZlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoJGV2ZW50LnBhZ2VJbmRleCkge1xuICAgICAgdGhpcy5jdXJyZW50UXVlcnlQYXJhbS5wYWdlSW5kZXggPSAkZXZlbnQucGFnZUluZGV4O1xuICAgIH1cbiAgICBpZiAoJGV2ZW50LnBhZ2VTaXplKSB7XG4gICAgICB0aGlzLmN1cnJlbnRRdWVyeVBhcmFtLnBhZ2VTaXplID0gJGV2ZW50LnBhZ2VTaXplO1xuICAgIH1cbiAgICB0aGlzLmRvUXVlcnkodGhpcy5jdXJyZW50UXVlcnlQYXJhbSk7XG4gIH1cblxuICBvblBhZ2VTaXplQ2hhbmdlZCgkZXZlbnQpIHtcbiAgICB0aGlzLmN1cnJlbnRRdWVyeVBhcmFtLnBhZ2VTaXplID0gJGV2ZW50O1xuICAgIHRoaXMuZG9RdWVyeSh0aGlzLmN1cnJlbnRRdWVyeVBhcmFtKTtcbiAgfVxufVxuIl19