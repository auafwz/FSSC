/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { format } from 'date-fns';
import { GSPElementDataType, GSPElementObjectType } from '@gsp-bef/gsp-cm-metadata';
export class ChgdrConfigHandler {
    /**
     * @param {?} be
     * @param {?} entityConfigs
     */
    constructor(be, entityConfigs) {
        this.entityCodeMap = new Map();
        this.entityFieldMap = new Map();
        this.entityFieldShowOrderMap = new Map();
        this.entityFieldParentMap = new Map();
        this.entityFieldConfigMap = new Map();
        //初始化所有BE对象信息
        this.be = be;
        if (!!be) {
            /** @type {?} */
            let mainObject = be.MainObject;
            this.updateEntityMap(mainObject, this.entityCodeMap, this.entityFieldMap);
        }
        //初始化配置信息
        this.entityConfigs = entityConfigs || [];
        this.updateEntityConfigs();
        //更新显示顺序
        this.updateShowIndex();
    }
    /**
     * 更新显示顺序号
     * @private
     * @return {?}
     */
    updateShowIndex() {
        /** @type {?} */
        let entityFieldShowOrderMap = new Map();
        //首先用BE字段顺序赋予初始顺序，避免配置中无顺序号造成显示错乱
        this.entityFieldMap.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            entityFieldShowOrderMap.set(key, entityFieldShowOrderMap.size);
        }));
        //然后用配置顺序替代初始顺序
        this.entityFieldConfigMap.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            if (value.showIndex !== undefined && value.showIndex !== null) {
                entityFieldShowOrderMap.set(key, value.showIndex);
            }
        }));
        this.entityFieldShowOrderMap = entityFieldShowOrderMap;
    }
    /**
     * 更新配置信息的相关数据
     * @private
     * @return {?}
     */
    updateEntityConfigs() {
        /** @type {?} */
        let fieldConfigMap = new Map();
        this.entityConfigs.forEach((/**
         * @param {?} entityConfig
         * @return {?}
         */
        entityConfig => {
            /** @type {?} */
            let tabCode = entityConfig.tabCode;
            (entityConfig.fields || []).forEach((/**
             * @param {?} field
             * @return {?}
             */
            field => {
                /** @type {?} */
                let fieldLabel = field.fieldLabelId;
                /** @type {?} */
                let key = tabCode + "#" + fieldLabel;
                fieldConfigMap.set(key, field);
            }));
        }));
        this.entityFieldConfigMap = fieldConfigMap;
    }
    /**
     * @private
     * @param {?} entity
     * @param {?} entityCodeMap
     * @param {?} entityFieldMap
     * @return {?}
     */
    updateEntityMap(entity, entityCodeMap, entityFieldMap) {
        if (!entity) {
            return;
        }
        entityCodeMap.set(entity.Code, entity);
        //实体对象的字段信息
        entity.ContainElements.forEach((/**
         * @param {?} ele
         * @return {?}
         */
        ele => {
            this.updateEntityFieldMap(entity, ele, null, entityFieldMap);
        }));
        //处理子节点信息
        /** @type {?} */
        let children = entity.ContainChildObjects;
        if (!children || !children.length) {
            return;
        }
        children.forEach((/**
         * @param {?} childEntity
         * @return {?}
         */
        childEntity => {
            this.updateEntityMap(childEntity, entityCodeMap, entityFieldMap);
        }));
    }
    /**
     * 更新BE节点的指定字段信息，如果该字段是关联字段，同时更新其带出字段
     * @private
     * @param {?} entity
     * @param {?} element
     * @param {?} parentElement
     * @param {?} entityFieldMap
     * @return {?}
     */
    updateEntityFieldMap(entity, element, parentElement, entityFieldMap) {
        /** @type {?} */
        let key = entity.Code + "#" + element.LabelID;
        entityFieldMap.set(key, element);
        if (parentElement) {
            this.entityFieldParentMap.set(key, parentElement);
        }
        /** @type {?} */
        const childAssociations = element.ChildAssociations;
        if (!!childAssociations && childAssociations.length > 0) {
            childAssociations.forEach((/**
             * @param {?} childAssociation
             * @return {?}
             */
            childAssociation => {
                /** @type {?} */
                const refElementCollection = childAssociation.RefElementCollection;
                if (!!refElementCollection && refElementCollection.length > 0) {
                    refElementCollection.forEach((/**
                     * @param {?} rele
                     * @return {?}
                     */
                    rele => {
                        this.updateEntityFieldMap(entity, rele, element, entityFieldMap);
                    }));
                }
            }));
        }
    }
    /**
     * @param {?} items
     * @param {?} entityCode
     * @param {?} fieldLabelIdFunc
     * @return {?}
     */
    sort(items, entityCode, fieldLabelIdFunc) {
        items.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            /** @type {?} */
            const aKey = entityCode + "#" + fieldLabelIdFunc(a);
            /** @type {?} */
            const bKey = entityCode + "#" + fieldLabelIdFunc(b);
            if (!this.entityFieldShowOrderMap.has(aKey) && !this.entityFieldShowOrderMap.has(bKey)) {
                //如果双方均无顺序号，则按照自然排序
                return aKey.localeCompare(bKey);
            }
            else if (!this.entityFieldShowOrderMap.has(aKey)) {
                //如果有一方无顺序号，则无顺序号的靠后
                return -1;
            }
            else if (!this.entityFieldShowOrderMap.has(bKey)) {
                //如果有一方无顺序号，则无顺序号的靠后
                return 1;
            }
            else {
                //如果两方都有顺序号，则按照顺序号排序
                /** @type {?} */
                const aOrder = this.entityFieldShowOrderMap.get(aKey);
                /** @type {?} */
                const bOrder = this.entityFieldShowOrderMap.get(bKey);
                return aOrder - bOrder;
            }
        }));
    }
    /**
     * 格式化主对象节点中字段的值
     * @param {?} originalValue
     * @param {?} fieldLabelId
     * @return {?}
     */
    formatMainObjectFieldValue(originalValue, fieldLabelId) {
        /** @type {?} */
        let entityCode = this.getMainObjectCode();
        return this.formatFieldValue(originalValue, entityCode, fieldLabelId);
    }
    /**
     * 格式化字段值
     * @param {?} originalValue
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    formatFieldValue(originalValue, entityCode, fieldLabelId) {
        /** @type {?} */
        let element = this.getElement(entityCode, fieldLabelId);
        if (!element) {
            console.error("未找到业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】");
            return originalValue;
        }
        if (!element) {
            return originalValue;
        }
        try {
            //处理历史遗留的数字格式
            if ((element.MDataType == GSPElementDataType.Decimal || element.MDataType == GSPElementDataType.Integer)
                && originalValue && originalValue.toLowerCase().includes("e")) {
                //如果字段是数字类型，且是科学计数法格式
                //转为十进制格式显示
                /** @type {?} */
                let num = Number(originalValue);
                if (isNaN(num)) {
                    console.log("业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】的值不是有效的数字格式：" + originalValue);
                    return originalValue;
                }
                else {
                    /** @type {?} */
                    let result = this.toNonExponential(num);
                    return result;
                }
            }
            //处理布尔值类型
            if (element.MDataType == GSPElementDataType.Boolean) {
                //注意：new Boolean("false") == true
                if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    return originalValue;
                }
                else if (originalValue.toLowerCase() == "false") {
                    return "否";
                }
                else if (originalValue.toLowerCase() == "true") {
                    return "是";
                }
                else {
                    return originalValue;
                }
            }
            //处理日期格式
            if (element.MDataType == GSPElementDataType.Date) {
                if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    //不包含值，直接返回原始值
                    return originalValue;
                }
                else {
                    /** @type {?} */
                    let date = new Date(originalValue);
                    /** @type {?} */
                    let str = format(date, "yyyy-MM-dd");
                    return str;
                }
            }
            //处理日期时间格式
            if (element.MDataType == GSPElementDataType.DateTime) {
                if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    //不包含值，直接返回原始值
                    return originalValue;
                }
                else {
                    /** @type {?} */
                    let date = new Date(originalValue);
                    /** @type {?} */
                    let str = format(date, "yyyy-MM-dd HH:mm:ss");
                    return str;
                }
            }
            //处理枚举格式
            if (element.ObjectType == GSPElementObjectType.Enum) {
                /** @type {?} */
                let enumValues = element.ContainEnumValues || [];
                /** @type {?} */
                let enumValue = enumValues.find((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item.Value == originalValue));
                if (enumValue) {
                    return enumValue.Name;
                }
                else if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    //如果找不到对应的枚举项，并且原始值为空，说明未赋值，不报错
                    return originalValue;
                }
                else {
                    //打印异常
                    console.log("业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】的值未找到匹配的枚举项：" + originalValue);
                    return originalValue;
                }
            }
            return originalValue;
        }
        catch (error) {
            console.error("业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】的值【" + originalValue + "】格式化出错：", error);
            return originalValue;
        }
    }
    /**
     * JavaScript中科学计数法转化为数值字符串形式。
     * 以下两种情况，JavaScript 会自动将数值转为科学计数法表示
     * (1) 小于1且小数点后面带有6个0以上的浮点数值：
     * (2) 整数位数字多于21位：
     * 首先看看整数位数字多于21位的情况，其实这个一般不会碰到，整数位数字多于21位已经超出了 JavaScript 精确整数范围。
     * 这个方法用于处理小数问题
     * from：https://www.cnblogs.com/xianfengzhike/p/9939029.html
     * @private
     * @param {?} num
     * @return {?}
     */
    toNonExponential(num) {
        /** @type {?} */
        var m = num.toExponential().match(/\d(?:\.(\d*))?e([+-]\d+)/);
        return num.toFixed(Math.max(0, (m[1] || '').length - m[2]));
    }
    /**
     * @return {?}
     */
    getBeName() {
        return this.be ? this.be.Name : null;
    }
    /**
     * @return {?}
     */
    getMainObjectCode() {
        return this.be && this.be.MainObject ? this.be.MainObject.Code : null;
    }
    /**
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    getElement(entityCode, fieldLabelId) {
        /** @type {?} */
        let key = entityCode + "#" + fieldLabelId;
        return this.entityFieldMap.get(key);
    }
    /**
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    getParentElement(entityCode, fieldLabelId) {
        /** @type {?} */
        let key = entityCode + "#" + fieldLabelId;
        return this.entityFieldParentMap.get(key);
    }
    /**
     * @param {?} entityCode
     * @return {?}
     */
    getEntityNameOrDefault(entityCode) {
        /** @type {?} */
        let entity = this.entityCodeMap.get(entityCode);
        return !!entity ? entity.Name : entityCode;
    }
    /**
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    getEntityFieldNameOrDefault(entityCode, fieldLabelId) {
        /** @type {?} */
        let key = entityCode + "#" + fieldLabelId;
        /** @type {?} */
        let fieldConfig = this.entityFieldConfigMap.get(key);
        if (fieldConfig && fieldConfig.fieldName && fieldConfig.fieldName != "") {
            //优先返回配置的名称
            return fieldConfig.fieldName;
        }
        //如果不存在配置名称，则返回BE字段名称
        /** @type {?} */
        let ele = this.entityFieldMap.get(key);
        return !!ele ? ele.Name : fieldLabelId;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.be;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityCodeMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldShowOrderMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldParentMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityConfigs;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldConfigMap;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hnZHItY29uZmlnLWhhbmRsZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWNtcC9jaGdkci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2NoZ2RyLWNvbmZpZy1oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQVcsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRTNDLE9BQU8sRUFBeUUsa0JBQWtCLEVBQUUsb0JBQW9CLEVBQWdCLE1BQU0sMEJBQTBCLENBQUM7QUFRekssTUFBTSxPQUFPLGtCQUFrQjs7Ozs7SUFVM0IsWUFBbUIsRUFBcUIsRUFBRSxhQUFtQztRQVJyRSxrQkFBYSxHQUFrQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3pELG1CQUFjLEdBQW1DLElBQUksR0FBRyxFQUFFLENBQUM7UUFDM0QsNEJBQXVCLEdBQXdCLElBQUksR0FBRyxFQUFFLENBQUM7UUFDekQseUJBQW9CLEdBQW1DLElBQUksR0FBRyxFQUFFLENBQUM7UUFHakUseUJBQW9CLEdBQW1DLElBQUksR0FBRyxFQUFFLENBQUM7UUFHckUsYUFBYTtRQUNiLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFOztnQkFDRixVQUFVLEdBQUcsRUFBRSxDQUFDLFVBQVU7WUFDOUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7U0FDN0U7UUFFRCxTQUFTO1FBQ1QsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLElBQUksRUFBRSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBRTNCLFFBQVE7UUFDUixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDM0IsQ0FBQzs7Ozs7O0lBR08sZUFBZTs7WUFDZix1QkFBdUIsR0FBd0IsSUFBSSxHQUFHLEVBQUU7UUFDNUQsaUNB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QUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7UUFDdEMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7SUFDM0MsQ0FBQztDQUNKOzs7Ozs7SUF2UUcsZ0NBQThCOzs7OztJQUM5QiwyQ0FBaUU7Ozs7O0lBQ2pFLDRDQUFtRTs7Ozs7SUFDbkUscURBQWlFOzs7OztJQUNqRSxrREFBeUU7Ozs7O0lBRXpFLDJDQUE0Qzs7Ozs7SUFDNUMsa0RBQXlFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNUb2RheSwgZm9ybWF0IH0gZnJvbSAnZGF0ZS1mbnMnO1xyXG5pbXBvcnQgeyBHU1BCdXNpbmVzc0VudGl0eSB9IGZyb20gJ0Bnc3AtYmVmL2dzcC1iZS1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IElHU1BDb21tb25PYmplY3QsIElHU1BDb21tb25FbGVtZW50LCBHU1BBc3NvY2lhdGlvbiwgR1NQQ29tbW9uRWxlbWVudCwgR1NQRWxlbWVudERhdGFUeXBlLCBHU1BFbGVtZW50T2JqZWN0VHlwZSwgR1NQRW51bVZhbHVlIH0gZnJvbSAnQGdzcC1iZWYvZ3NwLWNtLW1ldGFkYXRhJztcclxuaW1wb3J0IHsgQ2hhbmdlRGF0YUhlYWRlciB9IGZyb20gJy4uL21vZGVsL2NoYW5nZS1kYXRhLWhlYWRlcic7XHJcbmltcG9ydCB7IENoYW5nZURhdGFSb3cgfSBmcm9tICcuLi9tb2RlbC9jaGFuZ2UtZGF0YS1yb3cnO1xyXG5pbXBvcnQgeyBNYXBVdGlsIH0gZnJvbSAnLi4vdXRpbC9tYXAudXRpbCc7XHJcbmltcG9ydCB7IENoZ2RyRGF0YSwgQ2hnZHJEYXRhUm93Tm9kZSwgQ2hhbmdlQ29sdW1uSXRlbSwgQ2hnZHJEYXRhRW50aXR5Tm9kZSwgRGF0YUNvZGVGaWVsZCB9IGZyb20gJy4uL2NoZ2RyLWRhdGEtdmlld2VyL2NoZ2RyLWRhdGEnO1xyXG5pbXBvcnQgeyBDaGdMb2dDb25maWdFbnRpdHkgfSBmcm9tICcuLi9tb2RlbC9jaGdkci1jb25maWctZW50aXR5JztcclxuaW1wb3J0IHsgQ2hnTG9nQ29uZmlnRmllbGQgfSBmcm9tICcuLi9tb2RlbC9jaGdkci1jb25maWctZmllbGQnO1xyXG5cclxuZXhwb3J0IGNsYXNzIENoZ2RyQ29uZmlnSGFuZGxlciB7XHJcbiAgICBwcml2YXRlIGJlOiBHU1BCdXNpbmVzc0VudGl0eTtcclxuICAgIHByaXZhdGUgZW50aXR5Q29kZU1hcDogTWFwPHN0cmluZywgSUdTUENvbW1vbk9iamVjdD4gPSBuZXcgTWFwKCk7XHJcbiAgICBwcml2YXRlIGVudGl0eUZpZWxkTWFwOiBNYXA8c3RyaW5nLCBJR1NQQ29tbW9uRWxlbWVudD4gPSBuZXcgTWFwKCk7XHJcbiAgICBwcml2YXRlIGVudGl0eUZpZWxkU2hvd09yZGVyTWFwOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcCgpO1xyXG4gICAgcHJpdmF0ZSBlbnRpdHlGaWVsZFBhcmVudE1hcDogTWFwPHN0cmluZywgSUdTUENvbW1vbkVsZW1lbnQ+ID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIHByaXZhdGUgZW50aXR5Q29uZmlnczogQ2hnTG9nQ29uZmlnRW50aXR5W107XHJcbiAgICBwcml2YXRlIGVudGl0eUZpZWxkQ29uZmlnTWFwOiBNYXA8c3RyaW5nLCBDaGdMb2dDb25maWdGaWVsZD4gPSBuZXcgTWFwKCk7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKGJlOiBHU1BCdXNpbmVzc0VudGl0eSwgZW50aXR5Q29uZmlnczogQ2hnTG9nQ29uZmlnRW50aXR5W10pIHtcclxuICAgICAgICAvL+WIneWni+WMluaJgOaciUJF5a+56LGh5L+h5oGvXHJcbiAgICAgICAgdGhpcy5iZSA9IGJlO1xyXG4gICAgICAgIGlmICghIWJlKSB7XHJcbiAgICAgICAgICAgIGxldCBtYWluT2JqZWN0ID0gYmUuTWFpbk9iamVjdDtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVFbnRpdHlNYXAobWFpbk9iamVjdCwgdGhpcy5lbnRpdHlDb2RlTWFwLCB0aGlzLmVudGl0eUZpZWxkTWFwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8v5Yid5aeL5YyW6YWN572u5L+h5oGvXHJcbiAgICAgICAgdGhpcy5lbnRpdHlDb25maWdzID0gZW50aXR5Q29uZmlncyB8fCBbXTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUVudGl0eUNvbmZpZ3MoKTtcclxuXHJcbiAgICAgICAgLy/mm7TmlrDmmL7npLrpobrluo9cclxuICAgICAgICB0aGlzLnVwZGF0ZVNob3dJbmRleCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrDmmL7npLrpobrluo/lj7cgKi9cclxuICAgIHByaXZhdGUgdXBkYXRlU2hvd0luZGV4KCkge1xyXG4gICAgICAgIGxldCBlbnRpdHlGaWVsZFNob3dPcmRlck1hcDogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcclxuICAgICAgICAvL+mmluWFiOeUqEJF5a2X5q616aG65bqP6LWL5LqI5Yid5aeL6aG65bqP77yM6YG/5YWN6YWN572u5Lit5peg6aG65bqP5Y+36YCg5oiQ5pi+56S66ZSZ5LmxXHJcbiAgICAgICAgdGhpcy5lbnRpdHlGaWVsZE1hcC5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGVudGl0eUZpZWxkU2hvd09yZGVyTWFwLnNldChrZXksIGVudGl0eUZpZWxkU2hvd09yZGVyTWFwLnNpemUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8v54S25ZCO55So6YWN572u6aG65bqP5pu/5Luj5Yid5aeL6aG65bqPXHJcbiAgICAgICAgdGhpcy5lbnRpdHlGaWVsZENvbmZpZ01hcC5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZS5zaG93SW5kZXggIT09IHVuZGVmaW5lZCAmJiB2YWx1ZS5zaG93SW5kZXggIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGVudGl0eUZpZWxkU2hvd09yZGVyTWFwLnNldChrZXksIHZhbHVlLnNob3dJbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICB0aGlzLmVudGl0eUZpZWxkU2hvd09yZGVyTWFwID0gZW50aXR5RmllbGRTaG93T3JkZXJNYXA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOabtOaWsOmFjee9ruS/oeaBr+eahOebuOWFs+aVsOaNriAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVFbnRpdHlDb25maWdzKCkge1xyXG4gICAgICAgIGxldCBmaWVsZENvbmZpZ01hcDogTWFwPHN0cmluZywgQ2hnTG9nQ29uZmlnRmllbGQ+ID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuZW50aXR5Q29uZmlncy5mb3JFYWNoKGVudGl0eUNvbmZpZyA9PiB7XHJcbiAgICAgICAgICAgIGxldCB0YWJDb2RlID0gZW50aXR5Q29uZmlnLnRhYkNvZGU7XHJcbiAgICAgICAgICAgIChlbnRpdHlDb25maWcuZmllbGRzIHx8IFtdKS5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBmaWVsZExhYmVsID0gZmllbGQuZmllbGRMYWJlbElkO1xyXG4gICAgICAgICAgICAgICAgbGV0IGtleSA9IHRhYkNvZGUgKyBcIiNcIiArIGZpZWxkTGFiZWw7XHJcbiAgICAgICAgICAgICAgICBmaWVsZENvbmZpZ01hcC5zZXQoa2V5LCBmaWVsZCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5lbnRpdHlGaWVsZENvbmZpZ01hcCA9IGZpZWxkQ29uZmlnTWFwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlRW50aXR5TWFwKGVudGl0eTogSUdTUENvbW1vbk9iamVjdCwgZW50aXR5Q29kZU1hcDogTWFwPHN0cmluZywgSUdTUENvbW1vbk9iamVjdD4sIGVudGl0eUZpZWxkTWFwOiBNYXA8c3RyaW5nLCBJR1NQQ29tbW9uRWxlbWVudD4pIHtcclxuICAgICAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVudGl0eUNvZGVNYXAuc2V0KGVudGl0eS5Db2RlLCBlbnRpdHkpO1xyXG5cclxuICAgICAgICAvL+WunuS9k+WvueixoeeahOWtl+auteS/oeaBr1xyXG4gICAgICAgIGVudGl0eS5Db250YWluRWxlbWVudHMuZm9yRWFjaChlbGUgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUVudGl0eUZpZWxkTWFwKGVudGl0eSwgZWxlLCBudWxsLCBlbnRpdHlGaWVsZE1hcCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgLy/lpITnkIblrZDoioLngrnkv6Hmga9cclxuICAgICAgICBsZXQgY2hpbGRyZW46IElHU1BDb21tb25PYmplY3RbXSA9IGVudGl0eS5Db250YWluQ2hpbGRPYmplY3RzO1xyXG4gICAgICAgIGlmICghY2hpbGRyZW4gfHwgIWNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGNoaWxkRW50aXR5ID0+IHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVFbnRpdHlNYXAoY2hpbGRFbnRpdHksIGVudGl0eUNvZGVNYXAsIGVudGl0eUZpZWxkTWFwKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrBCReiKgueCueeahOaMh+WumuWtl+auteS/oeaBr++8jOWmguaenOivpeWtl+auteaYr+WFs+iBlOWtl+aute+8jOWQjOaXtuabtOaWsOWFtuW4puWHuuWtl+autSAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVFbnRpdHlGaWVsZE1hcChlbnRpdHk6IElHU1BDb21tb25PYmplY3QsIGVsZW1lbnQ6IElHU1BDb21tb25FbGVtZW50LCBwYXJlbnRFbGVtZW50OiBJR1NQQ29tbW9uRWxlbWVudCwgZW50aXR5RmllbGRNYXA6IE1hcDxzdHJpbmcsIElHU1BDb21tb25FbGVtZW50Pik6IHZvaWQge1xyXG4gICAgICAgIGxldCBrZXkgPSBlbnRpdHkuQ29kZSArIFwiI1wiICsgZWxlbWVudC5MYWJlbElEO1xyXG4gICAgICAgIGVudGl0eUZpZWxkTWFwLnNldChrZXksIGVsZW1lbnQpO1xyXG4gICAgICAgIGlmIChwYXJlbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5RmllbGRQYXJlbnRNYXAuc2V0KGtleSwgcGFyZW50RWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjaGlsZEFzc29jaWF0aW9uczogR1NQQXNzb2NpYXRpb25bXSA9IGVsZW1lbnQuQ2hpbGRBc3NvY2lhdGlvbnM7XHJcbiAgICAgICAgaWYgKCEhY2hpbGRBc3NvY2lhdGlvbnMgJiYgY2hpbGRBc3NvY2lhdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjaGlsZEFzc29jaWF0aW9ucy5mb3JFYWNoKGNoaWxkQXNzb2NpYXRpb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVmRWxlbWVudENvbGxlY3Rpb246IEdTUENvbW1vbkVsZW1lbnRbXSA9IGNoaWxkQXNzb2NpYXRpb24uUmVmRWxlbWVudENvbGxlY3Rpb247XHJcbiAgICAgICAgICAgICAgICBpZiAoISFyZWZFbGVtZW50Q29sbGVjdGlvbiAmJiByZWZFbGVtZW50Q29sbGVjdGlvbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVmRWxlbWVudENvbGxlY3Rpb24uZm9yRWFjaChyZWxlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFbnRpdHlGaWVsZE1hcChlbnRpdHksIHJlbGUsIGVsZW1lbnQsIGVudGl0eUZpZWxkTWFwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNvcnQoaXRlbXM6IGFueVtdLCBlbnRpdHlDb2RlOiBzdHJpbmcsIGZpZWxkTGFiZWxJZEZ1bmM6IChpdGVtOiBhbnkpID0+IHN0cmluZykge1xyXG4gICAgICAgIGl0ZW1zLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYUtleSA9IGVudGl0eUNvZGUgKyBcIiNcIiArIGZpZWxkTGFiZWxJZEZ1bmMoYSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJLZXkgPSBlbnRpdHlDb2RlICsgXCIjXCIgKyBmaWVsZExhYmVsSWRGdW5jKGIpO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZW50aXR5RmllbGRTaG93T3JkZXJNYXAuaGFzKGFLZXkpICYmICF0aGlzLmVudGl0eUZpZWxkU2hvd09yZGVyTWFwLmhhcyhiS2V5KSkge1xyXG4gICAgICAgICAgICAgICAgLy/lpoLmnpzlj4zmlrnlnYfml6Dpobrluo/lj7fvvIzliJnmjInnhafoh6rnhLbmjpLluo9cclxuICAgICAgICAgICAgICAgIHJldHVybiBhS2V5LmxvY2FsZUNvbXBhcmUoYktleSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuZW50aXR5RmllbGRTaG93T3JkZXJNYXAuaGFzKGFLZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAvL+WmguaenOacieS4gOaWueaXoOmhuuW6j+WPt++8jOWImeaXoOmhuuW6j+WPt+eahOmdoOWQjlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmVudGl0eUZpZWxkU2hvd09yZGVyTWFwLmhhcyhiS2V5KSkge1xyXG4gICAgICAgICAgICAgICAgLy/lpoLmnpzmnInkuIDmlrnml6Dpobrluo/lj7fvvIzliJnml6Dpobrluo/lj7fnmoTpnaDlkI5cclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy/lpoLmnpzkuKTmlrnpg73mnInpobrluo/lj7fvvIzliJnmjInnhafpobrluo/lj7fmjpLluo9cclxuICAgICAgICAgICAgICAgIGNvbnN0IGFPcmRlciA9IHRoaXMuZW50aXR5RmllbGRTaG93T3JkZXJNYXAuZ2V0KGFLZXkpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYk9yZGVyID0gdGhpcy5lbnRpdHlGaWVsZFNob3dPcmRlck1hcC5nZXQoYktleSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYU9yZGVyIC0gYk9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOagvOW8j+WMluS4u+WvueixoeiKgueCueS4reWtl+auteeahOWAvCAqL1xyXG4gICAgcHVibGljIGZvcm1hdE1haW5PYmplY3RGaWVsZFZhbHVlKG9yaWdpbmFsVmFsdWU6IHN0cmluZywgZmllbGRMYWJlbElkOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgZW50aXR5Q29kZSA9IHRoaXMuZ2V0TWFpbk9iamVjdENvZGUoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRGaWVsZFZhbHVlKG9yaWdpbmFsVmFsdWUsIGVudGl0eUNvZGUsIGZpZWxkTGFiZWxJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOagvOW8j+WMluWtl+auteWAvCAqL1xyXG4gICAgcHVibGljIGZvcm1hdEZpZWxkVmFsdWUob3JpZ2luYWxWYWx1ZTogc3RyaW5nLCBlbnRpdHlDb2RlOiBzdHJpbmcsIGZpZWxkTGFiZWxJZDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgZWxlbWVudDogSUdTUENvbW1vbkVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQoZW50aXR5Q29kZSwgZmllbGRMYWJlbElkKTtcclxuICAgICAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIuacquaJvuWIsOS4muWKoeWunuS9k+OAkFwiICsgdGhpcy5iZS5JRCArIFwiLVwiICsgdGhpcy5iZS5OYW1lICsgXCLjgJHoioLngrnjgJBcIiArIGVudGl0eUNvZGUgKyBcIuOAkeeahOWtl+auteOAkFwiICsgZmllbGRMYWJlbElkICsgXCLjgJFcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvL+WkhOeQhuWOhuWPsumBl+eVmeeahOaVsOWtl+agvOW8j1xyXG4gICAgICAgICAgICBpZiAoKGVsZW1lbnQuTURhdGFUeXBlID09IEdTUEVsZW1lbnREYXRhVHlwZS5EZWNpbWFsIHx8IGVsZW1lbnQuTURhdGFUeXBlID09IEdTUEVsZW1lbnREYXRhVHlwZS5JbnRlZ2VyKVxyXG4gICAgICAgICAgICAgICAgJiYgb3JpZ2luYWxWYWx1ZSAmJiBvcmlnaW5hbFZhbHVlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAvL+WmguaenOWtl+auteaYr+aVsOWtl+exu+Wei++8jOS4lOaYr+enkeWtpuiuoeaVsOazleagvOW8j1xyXG4gICAgICAgICAgICAgICAgLy/ovazkuLrljYHov5vliLbmoLzlvI/mmL7npLpcclxuICAgICAgICAgICAgICAgIGxldCBudW0gPSBOdW1iZXIob3JpZ2luYWxWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4obnVtKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5Lia5Yqh5a6e5L2T44CQXCIgKyB0aGlzLmJlLklEICsgXCItXCIgKyB0aGlzLmJlLk5hbWUgKyBcIuOAkeiKgueCueOAkFwiICsgZW50aXR5Q29kZSArIFwi44CR55qE5a2X5q6144CQXCIgKyBmaWVsZExhYmVsSWQgKyBcIuOAkeeahOWAvOS4jeaYr+acieaViOeahOaVsOWtl+agvOW8j++8mlwiICsgb3JpZ2luYWxWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSB0aGlzLnRvTm9uRXhwb25lbnRpYWwobnVtKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL+WkhOeQhuW4g+WwlOWAvOexu+Wei1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5NRGF0YVR5cGUgPT0gR1NQRWxlbWVudERhdGFUeXBlLkJvb2xlYW4pIHtcclxuICAgICAgICAgICAgICAgIC8v5rOo5oSP77yabmV3IEJvb2xlYW4oXCJmYWxzZVwiKSA9PSB0cnVlXHJcbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxWYWx1ZSA9PT0gbnVsbCB8fCBvcmlnaW5hbFZhbHVlID09PSB1bmRlZmluZWQgfHwgb3JpZ2luYWxWYWx1ZS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcmlnaW5hbFZhbHVlLnRvTG93ZXJDYXNlKCkgPT0gXCJmYWxzZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwi5ZCmXCI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9yaWdpbmFsVmFsdWUudG9Mb3dlckNhc2UoKSA9PSBcInRydWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIuaYr1wiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy/lpITnkIbml6XmnJ/moLzlvI9cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuTURhdGFUeXBlID09IEdTUEVsZW1lbnREYXRhVHlwZS5EYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxWYWx1ZSA9PT0gbnVsbCB8fCBvcmlnaW5hbFZhbHVlID09PSB1bmRlZmluZWQgfHwgb3JpZ2luYWxWYWx1ZS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5LiN5YyF5ZCr5YC877yM55u05o6l6L+U5Zue5Y6f5aeL5YC8XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUob3JpZ2luYWxWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0ciA9IGZvcm1hdChkYXRlLCBcInl5eXktTU0tZGRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy/lpITnkIbml6XmnJ/ml7bpl7TmoLzlvI9cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuTURhdGFUeXBlID09IEdTUEVsZW1lbnREYXRhVHlwZS5EYXRlVGltZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsVmFsdWUgPT09IG51bGwgfHwgb3JpZ2luYWxWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IG9yaWdpbmFsVmFsdWUubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAvL+S4jeWMheWQq+WAvO+8jOebtOaOpei/lOWbnuWOn+Wni+WAvFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKG9yaWdpbmFsVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdHIgPSBmb3JtYXQoZGF0ZSwgXCJ5eXl5LU1NLWRkIEhIOm1tOnNzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8v5aSE55CG5p6a5Li+5qC85byPXHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50Lk9iamVjdFR5cGUgPT0gR1NQRWxlbWVudE9iamVjdFR5cGUuRW51bSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGVudW1WYWx1ZXM6IEdTUEVudW1WYWx1ZVtdID0gZWxlbWVudC5Db250YWluRW51bVZhbHVlcyB8fCBbXTtcclxuICAgICAgICAgICAgICAgIGxldCBlbnVtVmFsdWUgPSBlbnVtVmFsdWVzLmZpbmQoaXRlbSA9PiBpdGVtLlZhbHVlID09IG9yaWdpbmFsVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudW1WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbnVtVmFsdWUuTmFtZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3JpZ2luYWxWYWx1ZSA9PT0gbnVsbCB8fCBvcmlnaW5hbFZhbHVlID09PSB1bmRlZmluZWQgfHwgb3JpZ2luYWxWYWx1ZS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c5om+5LiN5Yiw5a+55bqU55qE5p6a5Li+6aG577yM5bm25LiU5Y6f5aeL5YC85Li656m677yM6K+05piO5pyq6LWL5YC877yM5LiN5oql6ZSZXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5omT5Y2w5byC5bi4XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLkuJrliqHlrp7kvZPjgJBcIiArIHRoaXMuYmUuSUQgKyBcIi1cIiArIHRoaXMuYmUuTmFtZSArIFwi44CR6IqC54K544CQXCIgKyBlbnRpdHlDb2RlICsgXCLjgJHnmoTlrZfmrrXjgJBcIiArIGZpZWxkTGFiZWxJZCArIFwi44CR55qE5YC85pyq5om+5Yiw5Yy56YWN55qE5p6a5Li+6aG577yaXCIgKyBvcmlnaW5hbFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIuS4muWKoeWunuS9k+OAkFwiICsgdGhpcy5iZS5JRCArIFwiLVwiICsgdGhpcy5iZS5OYW1lICsgXCLjgJHoioLngrnjgJBcIiArIGVudGl0eUNvZGUgKyBcIuOAkeeahOWtl+auteOAkFwiICsgZmllbGRMYWJlbElkICsgXCLjgJHnmoTlgLzjgJBcIiArIG9yaWdpbmFsVmFsdWUgKyBcIuOAkeagvOW8j+WMluWHuumUme+8mlwiLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8qKiBKYXZhU2NyaXB05Lit56eR5a2m6K6h5pWw5rOV6L2s5YyW5Li65pWw5YC85a2X56ym5Liy5b2i5byP44CCXHJcbiAgICAgKiDku6XkuIvkuKTnp43mg4XlhrXvvIxKYXZhU2NyaXB0IOS8muiHquWKqOWwhuaVsOWAvOi9rOS4uuenkeWtpuiuoeaVsOazleihqOekulxyXG4gICAgICogKDEpIOWwj+S6jjHkuJTlsI/mlbDngrnlkI7pnaLluKbmnIk25LiqMOS7peS4iueahOa1rueCueaVsOWAvO+8mlxyXG4gICAgICogKDIpIOaVtOaVsOS9jeaVsOWtl+WkmuS6jjIx5L2N77yaXHJcbiAgICAgKiDpppblhYjnnIvnnIvmlbTmlbDkvY3mlbDlrZflpJrkuo4yMeS9jeeahOaDheWGte+8jOWFtuWunui/meS4quS4gOiIrOS4jeS8mueisOWIsO+8jOaVtOaVsOS9jeaVsOWtl+WkmuS6jjIx5L2N5bey57uP6LaF5Ye65LqGIEphdmFTY3JpcHQg57K+56Gu5pW05pWw6IyD5Zu044CCXHJcbiAgICAgKiDov5nkuKrmlrnms5XnlKjkuo7lpITnkIblsI/mlbDpl67pophcclxuICAgICAqIGZyb23vvJpodHRwczovL3d3dy5jbmJsb2dzLmNvbS94aWFuZmVuZ3poaWtlL3AvOTkzOTAyOS5odG1sICovXHJcbiAgICBwcml2YXRlIHRvTm9uRXhwb25lbnRpYWwobnVtKSB7XHJcbiAgICAgICAgdmFyIG0gPSBudW0udG9FeHBvbmVudGlhbCgpLm1hdGNoKC9cXGQoPzpcXC4oXFxkKikpP2UoWystXVxcZCspLyk7XHJcbiAgICAgICAgcmV0dXJuIG51bS50b0ZpeGVkKE1hdGgubWF4KDAsIChtWzFdIHx8ICcnKS5sZW5ndGggLSBtWzJdKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEJlTmFtZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJlID8gdGhpcy5iZS5OYW1lIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0TWFpbk9iamVjdENvZGUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5iZSAmJiB0aGlzLmJlLk1haW5PYmplY3QgPyB0aGlzLmJlLk1haW5PYmplY3QuQ29kZSA6IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEVsZW1lbnQoZW50aXR5Q29kZTogc3RyaW5nLCBmaWVsZExhYmVsSWQ6IHN0cmluZyk6IElHU1BDb21tb25FbGVtZW50IHtcclxuICAgICAgICBsZXQga2V5ID0gZW50aXR5Q29kZSArIFwiI1wiICsgZmllbGRMYWJlbElkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudGl0eUZpZWxkTWFwLmdldChrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRQYXJlbnRFbGVtZW50KGVudGl0eUNvZGU6IHN0cmluZywgZmllbGRMYWJlbElkOiBzdHJpbmcpOiBJR1NQQ29tbW9uRWxlbWVudCB7XHJcbiAgICAgICAgbGV0IGtleSA9IGVudGl0eUNvZGUgKyBcIiNcIiArIGZpZWxkTGFiZWxJZDtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbnRpdHlGaWVsZFBhcmVudE1hcC5nZXQoa2V5KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RW50aXR5TmFtZU9yRGVmYXVsdChlbnRpdHlDb2RlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgZW50aXR5ID0gdGhpcy5lbnRpdHlDb2RlTWFwLmdldChlbnRpdHlDb2RlKTtcclxuICAgICAgICByZXR1cm4gISFlbnRpdHkgPyBlbnRpdHkuTmFtZSA6IGVudGl0eUNvZGU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEVudGl0eUZpZWxkTmFtZU9yRGVmYXVsdChlbnRpdHlDb2RlOiBzdHJpbmcsIGZpZWxkTGFiZWxJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IGtleSA9IGVudGl0eUNvZGUgKyBcIiNcIiArIGZpZWxkTGFiZWxJZDtcclxuICAgICAgICBsZXQgZmllbGRDb25maWcgPSB0aGlzLmVudGl0eUZpZWxkQ29uZmlnTWFwLmdldChrZXkpO1xyXG4gICAgICAgIGlmIChmaWVsZENvbmZpZyAmJiBmaWVsZENvbmZpZy5maWVsZE5hbWUgJiYgZmllbGRDb25maWcuZmllbGROYW1lICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgLy/kvJjlhYjov5Tlm57phY3nva7nmoTlkI3np7BcclxuICAgICAgICAgICAgcmV0dXJuIGZpZWxkQ29uZmlnLmZpZWxkTmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy/lpoLmnpzkuI3lrZjlnKjphY3nva7lkI3np7DvvIzliJnov5Tlm55CReWtl+auteWQjeensFxyXG4gICAgICAgIGxldCBlbGUgPSB0aGlzLmVudGl0eUZpZWxkTWFwLmdldChrZXkpO1xyXG4gICAgICAgIHJldHVybiAhIWVsZSA/IGVsZS5OYW1lIDogZmllbGRMYWJlbElkO1xyXG4gICAgfVxyXG59Il19