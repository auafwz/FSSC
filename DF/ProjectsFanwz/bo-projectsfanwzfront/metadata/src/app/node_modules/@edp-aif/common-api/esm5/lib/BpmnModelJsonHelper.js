/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
var BpmnModelJsonHelper = /** @class */ (function () {
    function BpmnModelJsonHelper() {
    }
    /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    BpmnModelJsonHelper.GetAttributeValue = /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    function (obj, attributeName) {
        if (obj == null) {
            return null;
        }
        if (obj.hasOwnProperty(attributeName)) {
            return obj[attributeName];
        }
        else {
            return null;
        }
    };
    /**
     * @template T
     * @param {?} obj
     * @param {?} attributeName
     * @param {?} value
     * @return {?}
     */
    BpmnModelJsonHelper.SetAttributeValue = /**
     * @template T
     * @param {?} obj
     * @param {?} attributeName
     * @param {?} value
     * @return {?}
     */
    function (obj, attributeName, value) {
        var e_1, _a;
        if (obj == null || value == null)
            return;
        /** @type {?} */
        var jsonArray = [];
        if (value instanceof Array) {
            try {
                //判断是否为IJsonSerializable实现类的数组，是则全部调用ConvertToJsonObject序列化，否则直接赋值
                for (var value_1 = tslib_1.__values(value), value_1_1 = value_1.next(); !value_1_1.done; value_1_1 = value_1.next()) {
                    var item = value_1_1.value;
                    if (item.hasOwnProperty("ConvertToJsonObject") && item.hasOwnProperty("LoadFromJsonObject")) {
                        jsonArray.push(item.ConvertToJsonObject());
                    }
                    else {
                        break;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (value_1_1 && !value_1_1.done && (_a = value_1.return)) _a.call(value_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            if (jsonArray.length == value.length) {
                obj[attributeName] = jsonArray;
            }
            else {
                obj[attributeName] = value;
            }
        }
        else if (value.hasOwnProperty("ConvertToJsonObject") && value.hasOwnProperty("LoadFromJsonObject")) {
            //判断是否为IJsonSerializable实现类的对象，是则调用ConvertToJsonObject序列化
            obj[attributeName] = ((/** @type {?} */ (value))).ConvertToJsonObject();
        }
        else if (value instanceof Date) {
            //判断是否为日期类型，是日期类型则转为字符串UTC的yyyyMMDDhhmmssSSS格式字符串
            /** @type {?} */
            var str = BpmnModelJsonHelper.DateTimeToString(value);
            BpmnModelJsonHelper.SetAttributeValue(obj, attributeName, str);
        }
        else {
            obj[attributeName] = value;
        }
    };
    /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    BpmnModelJsonHelper.GetAttributeValueAsString = /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    function (obj, attributeName) {
        if (obj == null) {
            return null;
        }
        if (obj.hasOwnProperty(attributeName) == true && typeof (obj[attributeName]) == "string") {
            return obj[attributeName];
        }
        return null;
    };
    /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    BpmnModelJsonHelper.GetAttributeValueAsBoolean = /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    function (obj, attributeName) {
        if (obj == null) {
            return null;
        }
        if (obj.hasOwnProperty(attributeName) == true && typeof (obj[attributeName]) == "boolean") {
            return obj[attributeName];
        }
        return null;
    };
    /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    BpmnModelJsonHelper.GetAttributeValueAsNumber = /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    function (obj, attributeName) {
        if (obj == null) {
            return null;
        }
        if (obj.hasOwnProperty(attributeName) == true && typeof (obj[attributeName]) == "number") {
            return obj[attributeName];
        }
        return null;
    };
    /**
     * @template ReturnT, ClassOfT
     * @param {?} obj
     * @param {?} attributeName
     * @param {?} classOfT
     * @return {?}
     */
    BpmnModelJsonHelper.GetAttributeValueAsList = /**
     * @template ReturnT, ClassOfT
     * @param {?} obj
     * @param {?} attributeName
     * @param {?} classOfT
     * @return {?}
     */
    function (obj, attributeName, classOfT) {
        var e_2, _a;
        /** @type {?} */
        var jsonArray = BpmnModelJsonHelper.GetAttributeValue(obj, attributeName);
        if (jsonArray == null) {
            return null;
        }
        /** @type {?} */
        var list = [];
        try {
            for (var jsonArray_1 = tslib_1.__values(jsonArray), jsonArray_1_1 = jsonArray_1.next(); !jsonArray_1_1.done; jsonArray_1_1 = jsonArray_1.next()) {
                var item = jsonArray_1_1.value;
                /** @type {?} */
                var instance = null;
                try {
                    instance = (/** @type {?} */ (new classOfT()));
                }
                catch (e) {
                    throw e;
                }
                instance.LoadFromJsonObject(item);
                list.push(instance);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (jsonArray_1_1 && !jsonArray_1_1.done && (_a = jsonArray_1.return)) _a.call(jsonArray_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return list;
    };
    /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    BpmnModelJsonHelper.GetAttributeValueAsDateTime = /**
     * @param {?} obj
     * @param {?} attributeName
     * @return {?}
     */
    function (obj, attributeName) {
        return BpmnModelJsonHelper.DateTimeFromString(BpmnModelJsonHelper.GetAttributeValueAsString(obj, attributeName));
    };
    /**
     * @template ReturnT, ClassOfT
     * @param {?} obj
     * @param {?} attributeName
     * @param {?} classOfT
     * @return {?}
     */
    BpmnModelJsonHelper.GetAttributeValueAsJsonSerializable = /**
     * @template ReturnT, ClassOfT
     * @param {?} obj
     * @param {?} attributeName
     * @param {?} classOfT
     * @return {?}
     */
    function (obj, attributeName, classOfT) {
        /** @type {?} */
        var jsonObject = BpmnModelJsonHelper.GetAttributeValue(obj, attributeName);
        if (jsonObject == null) {
            return null;
        }
        /** @type {?} */
        var instance = null;
        try {
            instance = (/** @type {?} */ (new classOfT()));
        }
        catch (e) {
            throw e;
        }
        instance.LoadFromJsonObject(jsonObject);
        return instance;
    };
    /**
     * @param {?} dt
     * @return {?}
     */
    BpmnModelJsonHelper.DateTimeToString = /**
     * @param {?} dt
     * @return {?}
     */
    function (dt) {
        if (dt == null)
            return null;
        /** @type {?} */
        var time = dt.getTime();
        if (time < BpmnModelJsonHelper.MIN_OFFSETDATETIME.getTime() || time > BpmnModelJsonHelper.MAX_OFFSETDATETIME.getTime()) {
            throw "\u7ED9\u5B9A\u7684\u65E5\u671F\u65F6\u95F4\u503C " + dt.toISOString() + " \u8D85\u51FA\u652F\u6301\u8303\u56F4(0001-01-01T12:00:00.000Z - 9999-12-31T23:59:59.000Z):";
        }
        return BpmnModelJsonHelper.dateFormat(dt, "yyyyMMddHHmmssSSS");
    };
    /**
     *
     * @param str 格式为：yyyyMMddHHmmssSSS
     */
    /**
     *
     * @param {?} str 格式为：yyyyMMddHHmmssSSS
     * @return {?}
     */
    BpmnModelJsonHelper.DateTimeFromString = /**
     *
     * @param {?} str 格式为：yyyyMMddHHmmssSSS
     * @return {?}
     */
    function (str) {
        if (str == null)
            return null;
        // const s = `${str.substring(0, 4)}/${str.substring(4, 6)}/${str.substring(6, 8)} ${str.substring(8, 10)}:${str.substring(10, 12)}:${str.substring(12, 14)}.${str.substring(14)}`;
        /** @type {?} */
        var date = new Date();
        date.setUTCFullYear(parseInt(str.substring(0, 4)));
        date.setUTCMonth(parseInt(str.substring(4, 6)) - 1);
        date.setUTCDate(parseInt(str.substring(6, 8)));
        date.setUTCHours(parseInt(str.substring(8, 10)));
        date.setUTCMinutes(parseInt(str.substring(10, 12)));
        date.setUTCSeconds(parseInt(str.substring(12, 14)));
        date.setUTCMilliseconds(parseInt(str.substring(14)));
        return date;
    };
    /**
     * @template T
     * @param {?} value
     * @return {?}
     */
    BpmnModelJsonHelper.ToJson = /**
     * @template T
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var e_3, _a;
        if (value === undefined || value === null) {
            return null;
        }
        /** @type {?} */
        var list = [];
        try {
            for (var value_2 = tslib_1.__values(value), value_2_1 = value_2.next(); !value_2_1.done; value_2_1 = value_2.next()) {
                var item = value_2_1.value;
                list.push(item.ConvertToJsonObject());
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (value_2_1 && !value_2_1.done && (_a = value_2.return)) _a.call(value_2);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return JSON.stringify(list);
    };
    /**
     * @template ReturnT, ClassOfT
     * @param {?} json
     * @param {?} classOfT
     * @return {?}
     */
    BpmnModelJsonHelper.FromJson = /**
     * @template ReturnT, ClassOfT
     * @param {?} json
     * @param {?} classOfT
     * @return {?}
     */
    function (json, classOfT) {
        if (BpmnModelJsonHelper.IsNullOrWhiteSpace(json)) {
            return null;
        }
        /** @type {?} */
        var list = new Array();
        /** @type {?} */
        var jsonArr = JSON.parse(json);
        if (jsonArr == null || Array.isArray(jsonArr) === false) {
            return list;
        }
        jsonArr.forEach((/**
         * @param {?} elt
         * @return {?}
         */
        function (elt) {
            /** @type {?} */
            var newInstance = (/** @type {?} */ (new classOfT()));
            newInstance.LoadFromJsonObject(elt);
            list.push(newInstance);
        }));
        return list;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    BpmnModelJsonHelper.StringListToJsonArray = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var e_4, _a;
        if (value == null)
            return null;
        /** @type {?} */
        var jsonArray = new Array();
        try {
            for (var value_3 = tslib_1.__values(value), value_3_1 = value_3.next(); !value_3_1.done; value_3_1 = value_3.next()) {
                var item = value_3_1.value;
                jsonArray.push(item);
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (value_3_1 && !value_3_1.done && (_a = value_3.return)) _a.call(value_3);
            }
            finally { if (e_4) throw e_4.error; }
        }
        return jsonArray;
    };
    /**
     * @param {?} jsonArray
     * @return {?}
     */
    BpmnModelJsonHelper.StringListFromJsonArray = /**
     * @param {?} jsonArray
     * @return {?}
     */
    function (jsonArray) {
        var e_5, _a;
        if (jsonArray == null) {
            return null;
        }
        /** @type {?} */
        var list = new Array();
        try {
            for (var jsonArray_2 = tslib_1.__values(jsonArray), jsonArray_2_1 = jsonArray_2.next(); !jsonArray_2_1.done; jsonArray_2_1 = jsonArray_2.next()) {
                var item = jsonArray_2_1.value;
                if (typeof item == "object") {
                    list.push(JSON.stringify(item));
                }
                else {
                    list.push(String(item));
                }
            }
        }
        catch (e_5_1) { e_5 = { error: e_5_1 }; }
        finally {
            try {
                if (jsonArray_2_1 && !jsonArray_2_1.done && (_a = jsonArray_2.return)) _a.call(jsonArray_2);
            }
            finally { if (e_5) throw e_5.error; }
        }
        return list;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    BpmnModelJsonHelper.StringListToJson = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        /** @type {?} */
        var jsonArray = BpmnModelJsonHelper.StringListToJsonArray(value);
        if (jsonArray == null)
            return null;
        return JSON.stringify(jsonArray);
    };
    /**
     * @param {?} json
     * @return {?}
     */
    BpmnModelJsonHelper.StringListFromJson = /**
     * @param {?} json
     * @return {?}
     */
    function (json) {
        if (BpmnModelJsonHelper.IsNullOrWhiteSpace(json)) {
            return null;
        }
        /** @type {?} */
        var jsonArray = (/** @type {?} */ (JSON.parse(json)));
        if (jsonArray == null) {
            return null;
        }
        return BpmnModelJsonHelper.StringListFromJsonArray(jsonArray);
    };
    /**
     * @param {?} string
     * @return {?}
     */
    BpmnModelJsonHelper.IsNullOrWhiteSpace = /**
     * @param {?} string
     * @return {?}
     */
    function (string) {
        if (string == null) {
            return true;
        }
        else {
            return string.replace(/(^s*)|(s*$)/g, "").length == 0;
        }
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    BpmnModelJsonHelper.GetDateFromISO = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        /** @type {?} */
        var a = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(value);
        if (a) {
            return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4], +a[5], +a[6]));
        }
        else {
            return null;
        }
    };
    /**
     * @private
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    BpmnModelJsonHelper.dateFormat = /**
     * @private
     * @param {?} date
     * @param {?} fmt
     * @return {?}
     */
    function (date, fmt) {
        /** @type {?} */
        var ret;
        /** @type {?} */
        var opt = {
            "y+": date.getUTCFullYear().toString(),
            // 年
            "M+": (date.getUTCMonth() + 1).toString(),
            // 月
            "d+": date.getUTCDate().toString(),
            // 日
            "H+": date.getUTCHours().toString(),
            // 时
            "m+": date.getUTCMinutes().toString(),
            // 分
            "s+": date.getUTCSeconds().toString(),
            // 秒
            "S+": date.getUTCMilliseconds().toString(),
        };
        for (var k in opt) {
            ret = new RegExp("(" + k + ")").exec(fmt);
            if (ret) {
                if (!String.prototype.padStart) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (BpmnModelJsonHelper.myPadStart(opt[k], ret[1].length, "0")));
                }
                else {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")));
                }
            }
        }
        return fmt;
    };
    /**
     * @private
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    BpmnModelJsonHelper.myPadStart = /**
     * @private
     * @param {?} src
     * @param {?} targetLength
     * @param {?} padString
     * @return {?}
     */
    function (src, targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String(typeof padString !== 'undefined' ? padString : ' ');
        if (src.length > targetLength) {
            return String(src);
        }
        else {
            targetLength = targetLength - src.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0, targetLength) + String(src);
        }
    };
    BpmnModelJsonHelper.MIN_OFFSETDATETIME = BpmnModelJsonHelper.GetDateFromISO("0001-01-01T12:00:00.000Z");
    BpmnModelJsonHelper.MAX_OFFSETDATETIME = BpmnModelJsonHelper.GetDateFromISO("9999-12-31T23:59:59.000Z");
    return BpmnModelJsonHelper;
}());
export { BpmnModelJsonHelper };
if (false) {
    /** @type {?} */
    BpmnModelJsonHelper.MIN_OFFSETDATETIME;
    /** @type {?} */
    BpmnModelJsonHelper.MAX_OFFSETDATETIME;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnBtbk1vZGVsSnNvbkhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BlZHAtYWlmL2NvbW1vbi1hcGkvIiwic291cmNlcyI6WyJsaWIvQnBtbk1vZGVsSnNvbkhlbHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBO0lBQUE7SUE0U0EsQ0FBQzs7Ozs7O0lBeFNpQixxQ0FBaUI7Ozs7O0lBQS9CLFVBQWdDLEdBQU8sRUFBRSxhQUFxQjtRQUMxRCxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7WUFDYixPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsSUFBSSxHQUFHLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxFQUFFO1lBQ25DLE9BQU8sR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQzdCO2FBQU07WUFDSCxPQUFPLElBQUksQ0FBQztTQUNmO0lBQ0wsQ0FBQzs7Ozs7Ozs7SUFFYSxxQ0FBaUI7Ozs7Ozs7SUFBL0IsVUFBNkQsR0FBTyxFQUFFLGFBQXFCLEVBQUUsS0FBK0Q7O1FBQ3hKLElBQUksR0FBRyxJQUFJLElBQUksSUFBSSxLQUFLLElBQUksSUFBSTtZQUM1QixPQUFPOztZQUVQLFNBQVMsR0FBYSxFQUFFO1FBQzVCLElBQUksS0FBSyxZQUFZLEtBQUssRUFBRTs7Z0JBQ3hCLGtFQUFrRTtnQkFDbEUsS0FBaUIsSUFBQSxVQUFBLGlCQUFBLEtBQUssQ0FBQSw0QkFBQSwrQ0FBRTtvQkFBbkIsSUFBSSxJQUFJLGtCQUFBO29CQUNULElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsb0JBQW9CLENBQUMsRUFBRTt3QkFDekYsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO3FCQUM5Qzt5QkFBTTt3QkFDSCxNQUFNO3FCQUNUO2lCQUNKOzs7Ozs7Ozs7WUFDRCxJQUFJLFNBQVMsQ0FBQyxNQUFNLElBQUksS0FBSyxDQUFD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QywwQkFBMEIsQ0FBQyxDQUFDO0lBQzFGLHNDQUFrQixHQUFTLG1CQUFtQixDQUFDLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBMFNySCwwQkFBQztDQUFBLEFBNVNELElBNFNDO1NBNVNZLG1CQUFtQjs7O0lBQzVCLHVDQUFpSDs7SUFDakgsdUNBQWlIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUpzb25TZXJpYWxpemFibGUgfSBmcm9tICcuL0lKc29uU2VyaWFsaXphYmxlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBCcG1uTW9kZWxKc29uSGVscGVyIHtcclxuICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgTUlOX09GRlNFVERBVEVUSU1FOiBEYXRlID0gQnBtbk1vZGVsSnNvbkhlbHBlci5HZXREYXRlRnJvbUlTTyhcIjAwMDEtMDEtMDFUMTI6MDA6MDAuMDAwWlwiKTtcclxuICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgTUFYX09GRlNFVERBVEVUSU1FOiBEYXRlID0gQnBtbk1vZGVsSnNvbkhlbHBlci5HZXREYXRlRnJvbUlTTyhcIjk5OTktMTItMzFUMjM6NTk6NTkuMDAwWlwiKTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIEdldEF0dHJpYnV0ZVZhbHVlKG9iajoge30sIGF0dHJpYnV0ZU5hbWU6IHN0cmluZyk6IGFueSB7XHJcbiAgICAgICAgaWYgKG9iaiA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGF0dHJpYnV0ZU5hbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmpbYXR0cmlidXRlTmFtZV07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgU2V0QXR0cmlidXRlVmFsdWU8VCBleHRlbmRzIElKc29uU2VyaWFsaXphYmxlPihvYmo6IHt9LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBib29sZWFuIHwgbnVtYmVyIHwgRGF0ZSB8IEFycmF5PFQ+IHwgVCB8IG9iamVjdCk6IHZvaWQge1xyXG4gICAgICAgIGlmIChvYmogPT0gbnVsbCB8fCB2YWx1ZSA9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgIGxldCBqc29uQXJyYXk6IE9iamVjdFtdID0gW107XHJcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgLy/liKTmlq3mmK/lkKbkuLpJSnNvblNlcmlhbGl6YWJsZeWunueOsOexu+eahOaVsOe7hO+8jOaYr+WImeWFqOmDqOiwg+eUqENvbnZlcnRUb0pzb25PYmplY3Tluo/liJfljJbvvIzlkKbliJnnm7TmjqXotYvlgLxcclxuICAgICAgICAgICAgZm9yIChsZXQgaXRlbSBvZiB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoXCJDb252ZXJ0VG9Kc29uT2JqZWN0XCIpICYmIGl0ZW0uaGFzT3duUHJvcGVydHkoXCJMb2FkRnJvbUpzb25PYmplY3RcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBqc29uQXJyYXkucHVzaChpdGVtLkNvbnZlcnRUb0pzb25PYmplY3QoKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChqc29uQXJyYXkubGVuZ3RoID09IHZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgb2JqW2F0dHJpYnV0ZU5hbWVdID0ganNvbkFycmF5O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqW2F0dHJpYnV0ZU5hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KFwiQ29udmVydFRvSnNvbk9iamVjdFwiKSAmJiB2YWx1ZS5oYXNPd25Qcm9wZXJ0eShcIkxvYWRGcm9tSnNvbk9iamVjdFwiKSkge1xyXG4gICAgICAgICAgICAvL+WIpOaWreaYr+WQpuS4uklKc29uU2VyaWFsaXphYmxl5a6e546w57G755qE5a+56LGh77yM5piv5YiZ6LCD55SoQ29udmVydFRvSnNvbk9iamVjdOW6j+WIl+WMllxyXG4gICAgICAgICAgICBvYmpbYXR0cmlidXRlTmFtZV0gPSAodmFsdWUgYXMgVCkuQ29udmVydFRvSnNvbk9iamVjdCgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XHJcbiAgICAgICAgICAgIC8v5Yik5pat5piv5ZCm5Li65pel5pyf57G75Z6L77yM5piv5pel5pyf57G75Z6L5YiZ6L2s5Li65a2X56ym5LiyVVRD55qEeXl5eU1NRERoaG1tc3NTU1PmoLzlvI/lrZfnrKbkuLJcclxuICAgICAgICAgICAgY29uc3Qgc3RyID0gQnBtbk1vZGVsSnNvbkhlbHBlci5EYXRlVGltZVRvU3RyaW5nKHZhbHVlKTtcclxuICAgICAgICAgICAgQnBtbk1vZGVsSnNvbkhlbHBlci5TZXRBdHRyaWJ1dGVWYWx1ZShvYmosIGF0dHJpYnV0ZU5hbWUsIHN0cik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb2JqW2F0dHJpYnV0ZU5hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgR2V0QXR0cmlidXRlVmFsdWVBc1N0cmluZyhvYmo6IHt9LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmIChvYmogPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoYXR0cmlidXRlTmFtZSkgPT0gdHJ1ZSAmJiB0eXBlb2YgKG9ialthdHRyaWJ1dGVOYW1lXSkgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gb2JqW2F0dHJpYnV0ZU5hbWVdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBHZXRBdHRyaWJ1dGVWYWx1ZUFzQm9vbGVhbihvYmo6IHt9LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAob2JqID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGF0dHJpYnV0ZU5hbWUpID09IHRydWUgJiYgdHlwZW9mIChvYmpbYXR0cmlidXRlTmFtZV0pID09IFwiYm9vbGVhblwiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmpbYXR0cmlidXRlTmFtZV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIEdldEF0dHJpYnV0ZVZhbHVlQXNOdW1iZXIob2JqOiB7fSwgYXR0cmlidXRlTmFtZTogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgICAgICBpZiAob2JqID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGF0dHJpYnV0ZU5hbWUpID09IHRydWUgJiYgdHlwZW9mIChvYmpbYXR0cmlidXRlTmFtZV0pID09IFwibnVtYmVyXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9ialthdHRyaWJ1dGVOYW1lXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgR2V0QXR0cmlidXRlVmFsdWVBc0xpc3Q8UmV0dXJuVCBleHRlbmRzIElKc29uU2VyaWFsaXphYmxlLCBDbGFzc09mVCBleHRlbmRzIFJldHVyblQ+KG9iajogT2JqZWN0LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcsIGNsYXNzT2ZUOiBuZXcgKCkgPT4gQ2xhc3NPZlQpOiBBcnJheTxSZXR1cm5UPiB7XHJcbiAgICAgICAgbGV0IGpzb25BcnJheTogQXJyYXk8YW55PiA9IEJwbW5Nb2RlbEpzb25IZWxwZXIuR2V0QXR0cmlidXRlVmFsdWUob2JqLCBhdHRyaWJ1dGVOYW1lKTtcclxuXHJcbiAgICAgICAgaWYgKGpzb25BcnJheSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGxpc3Q6IEFycmF5PFJldHVyblQ+ID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaXRlbSBvZiBqc29uQXJyYXkpIHtcclxuICAgICAgICAgICAgbGV0IGluc3RhbmNlOiBSZXR1cm5UID0gbnVsbDtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlID0gbmV3IGNsYXNzT2ZUKCkgYXMgQ2xhc3NPZlQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGluc3RhbmNlLkxvYWRGcm9tSnNvbk9iamVjdChpdGVtKTtcclxuICAgICAgICAgICAgbGlzdC5wdXNoKGluc3RhbmNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBsaXN0O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgR2V0QXR0cmlidXRlVmFsdWVBc0RhdGVUaW1lKG9iajogT2JqZWN0LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcpOiBEYXRlIHtcclxuICAgICAgICByZXR1cm4gQnBtbk1vZGVsSnNvbkhlbHBlci5EYXRlVGltZUZyb21TdHJpbmcoQnBtbk1vZGVsSnNvbkhlbHBlci5HZXRBdHRyaWJ1dGVWYWx1ZUFzU3RyaW5nKG9iaiwgYXR0cmlidXRlTmFtZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgR2V0QXR0cmlidXRlVmFsdWVBc0pzb25TZXJpYWxpemFibGU8UmV0dXJuVCBleHRlbmRzIElKc29uU2VyaWFsaXphYmxlLCBDbGFzc09mVCBleHRlbmRzIFJldHVyblQ+KG9iajogT2JqZWN0LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcsIGNsYXNzT2ZUOiBuZXcgKCkgPT4gQ2xhc3NPZlQpOiBSZXR1cm5UIHtcclxuICAgICAgICBsZXQganNvbk9iamVjdDogT2JqZWN0ID0gQnBtbk1vZGVsSnNvbkhlbHBlci5HZXRBdHRyaWJ1dGVWYWx1ZShvYmosIGF0dHJpYnV0ZU5hbWUpO1xyXG5cclxuICAgICAgICBpZiAoanNvbk9iamVjdCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGluc3RhbmNlOiBSZXR1cm5UID0gbnVsbDtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZSA9IG5ldyBjbGFzc09mVCgpIGFzIFJldHVyblQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnN0YW5jZS5Mb2FkRnJvbUpzb25PYmplY3QoanNvbk9iamVjdCk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIERhdGVUaW1lVG9TdHJpbmcoZHQ6IERhdGUpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmIChkdCA9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3QgdGltZSA9IGR0LmdldFRpbWUoKTtcclxuICAgICAgICBpZiAodGltZSA8IEJwbW5Nb2RlbEpzb25IZWxwZXIuTUlOX09GRlNFVERBVEVUSU1FLmdldFRpbWUoKSB8fCB0aW1lID4gQnBtbk1vZGVsSnNvbkhlbHBlci5NQVhfT0ZGU0VUREFURVRJTUUuZ2V0VGltZSgpKSB7XHJcbiAgICAgICAgICAgIHRocm93IGDnu5nlrprnmoTml6XmnJ/ml7bpl7TlgLwgJHtkdC50b0lTT1N0cmluZygpfSDotoXlh7rmlK/mjIHojIPlm7QoMDAwMS0wMS0wMVQxMjowMDowMC4wMDBaIC0gOTk5OS0xMi0zMVQyMzo1OTo1OS4wMDBaKTpgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIEJwbW5Nb2RlbEpzb25IZWxwZXIuZGF0ZUZvcm1hdChkdCwgXCJ5eXl5TU1kZEhIbW1zc1NTU1wiKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gc3RyIOagvOW8j+S4uu+8mnl5eXlNTWRkSEhtbXNzU1NTXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgRGF0ZVRpbWVGcm9tU3RyaW5nKHN0cjogc3RyaW5nKTogRGF0ZSB7XHJcbiAgICAgICAgaWYgKHN0ciA9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gY29uc3QgcyA9IGAke3N0ci5zdWJzdHJpbmcoMCwgNCl9LyR7c3RyLnN1YnN0cmluZyg0LCA2KX0vJHtzdHIuc3Vic3RyaW5nKDYsIDgpfSAke3N0ci5zdWJzdHJpbmcoOCwgMTApfToke3N0ci5zdWJzdHJpbmcoMTAsIDEyKX06JHtzdHIuc3Vic3RyaW5nKDEyLCAxNCl9LiR7c3RyLnN1YnN0cmluZygxNCl9YDtcclxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMCwgNCkpKTtcclxuICAgICAgICBkYXRlLnNldFVUQ01vbnRoKHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoNCwgNikpIC0gMSk7XHJcbiAgICAgICAgZGF0ZS5zZXRVVENEYXRlKHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoNiwgOCkpKTtcclxuICAgICAgICBkYXRlLnNldFVUQ0hvdXJzKHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoOCwgMTApKSk7XHJcbiAgICAgICAgZGF0ZS5zZXRVVENNaW51dGVzKHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMTAsIDEyKSkpO1xyXG4gICAgICAgIGRhdGUuc2V0VVRDU2Vjb25kcyhwYXJzZUludChzdHIuc3Vic3RyaW5nKDEyLCAxNCkpKTtcclxuICAgICAgICBkYXRlLnNldFVUQ01pbGxpc2Vjb25kcyhwYXJzZUludChzdHIuc3Vic3RyaW5nKDE0KSkpO1xyXG4gICAgICAgIHJldHVybiBkYXRlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgVG9Kc29uPFQgZXh0ZW5kcyBJSnNvblNlcmlhbGl6YWJsZT4odmFsdWU6IEFycmF5PFQ+KTogc3RyaW5nIHtcclxuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGxpc3Q6IE9iamVjdFtdID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaXRlbSBvZiB2YWx1ZSkge1xyXG4gICAgICAgICAgICBsaXN0LnB1c2goaXRlbS5Db252ZXJ0VG9Kc29uT2JqZWN0KCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGxpc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgRnJvbUpzb248UmV0dXJuVCBleHRlbmRzIElKc29uU2VyaWFsaXphYmxlLCBDbGFzc09mVCBleHRlbmRzIFJldHVyblQ+KGpzb246IHN0cmluZywgY2xhc3NPZlQ6IG5ldyAoKSA9PiBDbGFzc09mVCk6IEFycmF5PFJldHVyblQ+IHtcclxuICAgICAgICBpZiAoQnBtbk1vZGVsSnNvbkhlbHBlci5Jc051bGxPcldoaXRlU3BhY2UoanNvbikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbGlzdCA9IG5ldyBBcnJheTxSZXR1cm5UPigpO1xyXG4gICAgICAgIGxldCBqc29uQXJyOiBBcnJheTx7fT4gPSBKU09OLnBhcnNlKGpzb24pO1xyXG5cclxuICAgICAgICBpZiAoanNvbkFyciA9PSBudWxsIHx8IEFycmF5LmlzQXJyYXkoanNvbkFycikgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsaXN0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAganNvbkFyci5mb3JFYWNoKGVsdCA9PiB7XHJcbiAgICAgICAgICAgIGxldCBuZXdJbnN0YW5jZSA9IG5ldyBjbGFzc09mVCgpIGFzIENsYXNzT2ZUO1xyXG4gICAgICAgICAgICBuZXdJbnN0YW5jZS5Mb2FkRnJvbUpzb25PYmplY3QoZWx0KTtcclxuICAgICAgICAgICAgbGlzdC5wdXNoKG5ld0luc3RhbmNlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBTdHJpbmdMaXN0VG9Kc29uQXJyYXkodmFsdWU6IEFycmF5PHN0cmluZz4pOiBBcnJheTxzdHJpbmc+IHtcclxuICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIGxldCBqc29uQXJyYXk6IEFycmF5PHN0cmluZz4gPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICBmb3IgKGxldCBpdGVtIG9mIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGpzb25BcnJheS5wdXNoKGl0ZW0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGpzb25BcnJheTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIFN0cmluZ0xpc3RGcm9tSnNvbkFycmF5KGpzb25BcnJheTogQXJyYXk8T2JqZWN0Pik6IEFycmF5PHN0cmluZz4ge1xyXG4gICAgICAgIGlmIChqc29uQXJyYXkgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBsaXN0OiBBcnJheTxzdHJpbmc+ID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgZm9yIChsZXQgaXRlbSBvZiBqc29uQXJyYXkpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgIGxpc3QucHVzaChKU09OLnN0cmluZ2lmeShpdGVtKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2goU3RyaW5nKGl0ZW0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBTdHJpbmdMaXN0VG9Kc29uKHZhbHVlOiBBcnJheTxzdHJpbmc+KTogc3RyaW5nIHtcclxuICAgICAgICBsZXQganNvbkFycmF5ID0gQnBtbk1vZGVsSnNvbkhlbHBlci5TdHJpbmdMaXN0VG9Kc29uQXJyYXkodmFsdWUpO1xyXG4gICAgICAgIGlmIChqc29uQXJyYXkgPT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShqc29uQXJyYXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nTGlzdEZyb21Kc29uKGpzb246IHN0cmluZyk6IEFycmF5PHN0cmluZz4ge1xyXG4gICAgICAgIGlmIChCcG1uTW9kZWxKc29uSGVscGVyLklzTnVsbE9yV2hpdGVTcGFjZShqc29uKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBqc29uQXJyYXkgPSBKU09OLnBhcnNlKGpzb24pIGFzIEFycmF5PE9iamVjdD47XHJcbiAgICAgICAgaWYgKGpzb25BcnJheSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIEJwbW5Nb2RlbEpzb25IZWxwZXIuU3RyaW5nTGlzdEZyb21Kc29uQXJyYXkoanNvbkFycmF5KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIElzTnVsbE9yV2hpdGVTcGFjZShzdHJpbmc6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmIChzdHJpbmcgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoLyhecyopfChzKiQpL2csIFwiXCIpLmxlbmd0aCA9PSAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBHZXREYXRlRnJvbUlTTyh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IGEgPSAvXihcXGR7NH0pLShcXGR7Mn0pLShcXGR7Mn0pVChcXGR7Mn0pOihcXGR7Mn0pOihcXGR7Mn0oPzpcXC5cXGQqKT8pWiQvLmV4ZWModmFsdWUpO1xyXG4gICAgICAgIGlmIChhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQygrYVsxXSwgK2FbMl0gLSAxLCArYVszXSwgK2FbNF0sICthWzVdLCArYVs2XSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBkYXRlRm9ybWF0KGRhdGU6IERhdGUsIGZtdDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgcmV0O1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHtcclxuICAgICAgICAgICAgXCJ5K1wiOiBkYXRlLmdldFVUQ0Z1bGxZZWFyKCkudG9TdHJpbmcoKSwgICAgICAgIC8vIOW5tFxyXG4gICAgICAgICAgICBcIk0rXCI6IChkYXRlLmdldFVUQ01vbnRoKCkgKyAxKS50b1N0cmluZygpLCAgICAgLy8g5pyIXHJcbiAgICAgICAgICAgIFwiZCtcIjogZGF0ZS5nZXRVVENEYXRlKCkudG9TdHJpbmcoKSwgICAgICAgICAgICAvLyDml6VcclxuICAgICAgICAgICAgXCJIK1wiOiBkYXRlLmdldFVUQ0hvdXJzKCkudG9TdHJpbmcoKSwgICAgICAgICAgIC8vIOaXtlxyXG4gICAgICAgICAgICBcIm0rXCI6IGRhdGUuZ2V0VVRDTWludXRlcygpLnRvU3RyaW5nKCksICAgICAgICAgLy8g5YiGXHJcbiAgICAgICAgICAgIFwicytcIjogZGF0ZS5nZXRVVENTZWNvbmRzKCkudG9TdHJpbmcoKSwgICAgICAgICAvLyDnp5JcclxuICAgICAgICAgICAgXCJTK1wiOiBkYXRlLmdldFVUQ01pbGxpc2Vjb25kcygpLnRvU3RyaW5nKCksICAgIC8vIOenklxyXG4gICAgICAgICAgICAvLyDmnInlhbbku5bmoLzlvI/ljJblrZfnrKbpnIDmsYLlj6/ku6Xnu6fnu63mt7vliqDvvIzlv4XpobvovazljJbmiJDlrZfnrKbkuLJcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZvciAobGV0IGsgaW4gb3B0KSB7XHJcbiAgICAgICAgICAgIHJldCA9IG5ldyBSZWdFeHAoXCIoXCIgKyBrICsgXCIpXCIpLmV4ZWMoZm10KTtcclxuICAgICAgICAgICAgaWYgKHJldCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFTdHJpbmcucHJvdG90eXBlLnBhZFN0YXJ0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm10ID0gZm10LnJlcGxhY2UocmV0WzFdLCAocmV0WzFdLmxlbmd0aCA9PSAxKSA/IChvcHRba10pIDogKEJwbW5Nb2RlbEpzb25IZWxwZXIubXlQYWRTdGFydChvcHRba10sIHJldFsxXS5sZW5ndGgsIFwiMFwiKSkpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmbXQgPSBmbXQucmVwbGFjZShyZXRbMV0sIChyZXRbMV0ubGVuZ3RoID09IDEpID8gKG9wdFtrXSkgOiAob3B0W2tdLnBhZFN0YXJ0KHJldFsxXS5sZW5ndGgsIFwiMFwiKSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmbXQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgbXlQYWRTdGFydChzcmM6IHN0cmluZywgdGFyZ2V0TGVuZ3RoOiBudW1iZXIsIHBhZFN0cmluZzogc3RyaW5nKSB7XHJcbiAgICAgICAgdGFyZ2V0TGVuZ3RoID0gdGFyZ2V0TGVuZ3RoID4+IDA7IC8vZmxvb3IgaWYgbnVtYmVyIG9yIGNvbnZlcnQgbm9uLW51bWJlciB0byAwO1xyXG4gICAgICAgIHBhZFN0cmluZyA9IFN0cmluZyh0eXBlb2YgcGFkU3RyaW5nICE9PSAndW5kZWZpbmVkJyA/IHBhZFN0cmluZyA6ICcgJyk7XHJcbiAgICAgICAgaWYgKHNyYy5sZW5ndGggPiB0YXJnZXRMZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhzcmMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRhcmdldExlbmd0aCA9IHRhcmdldExlbmd0aCAtIHNyYy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXRMZW5ndGggPiBwYWRTdHJpbmcubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBwYWRTdHJpbmcgKz0gcGFkU3RyaW5nLnJlcGVhdCh0YXJnZXRMZW5ndGggLyBwYWRTdHJpbmcubGVuZ3RoKTsgLy9hcHBlbmQgdG8gb3JpZ2luYWwgdG8gZW5zdXJlIHdlIGFyZSBsb25nZXIgdGhhbiBuZWVkZWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcGFkU3RyaW5nLnNsaWNlKDAsIHRhcmdldExlbmd0aCkgKyBTdHJpbmcoc3JjKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=