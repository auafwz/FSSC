/**
 * @fileoverview added by tsickle
 * Generated from: lib/bill-tracker/mxgraph-ext/BillCell.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { mxCell, mxEvent, mxEventObject } from "../../ref/mxgraph";
import { BpmnModelJsonHelper } from "@edp-aif/common-api";
import { BillTrackingSettings, JointQueryMode } from '@edp-bif/common-api';
import { FieldNameAndValue } from "../../entity/tracking/FieldNameAndValue";
import { Events } from "./Events";
var BillCell = /** @class */ (function (_super) {
    tslib_1.__extends(BillCell, _super);
    function BillCell(billDataInfo, billInfo, entry, geometry, style) {
        var _this = _super.call(this, null, geometry, style) || this;
        _this.THUMB_SCALE = 0.6;
        _this.billDataInfo = billDataInfo;
        _this.billInfo = billInfo;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (billInfo && billInfo.billTrackingSettings) {
            bts.LoadFromJson(billInfo.billTrackingSettings);
        }
        _this.entry = entry;
        return _this;
        // this.value = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
    }
    /**
     * @return {?}
     */
    BillCell.prototype.getCaption = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var label = null;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        label = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        return label;
    };
    /**
     * @return {?}
     */
    BillCell.prototype.buildHtmlTooltip = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var tooltipHtml = "            <span>" + this.billDataInfo.dataId + "</span>        ";
        return tooltipHtml;
    };
    /**
     * 样式类在graph组件中定义
     * @param graph
     * @returns
     */
    /**
     * 样式类在graph组件中定义
     * @param {?} graph
     * @return {?}
     */
    BillCell.prototype.buildHtmlLabel = /**
     * 样式类在graph组件中定义
     * @param {?} graph
     * @return {?}
     */
    function (graph) {
        return this.buildHtmlLabelByDOM(graph);
    };
    /**
     * 通过操纵dom元素方式创建html
     * @param graph
     * @returns
     */
    /**
     * 通过操纵dom元素方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    BillCell.prototype.buildHtmlLabelByDOM = /**
     * 通过操纵dom元素方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    function (graph) {
        var _this = this;
        /** @type {?} */
        var scale = graph.view.scale;
        /** @type {?} */
        var state = graph.view.getState(this);
        /** @type {?} */
        var width = this.geometry.width;
        /** @type {?} */
        var height = this.geometry.height;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        var isEntry = this.entry;
        // 节点框架
        /** @type {?} */
        var divNodeRoot = document.createElement("div");
        divNodeRoot.classList.add("bif-cell-node");
        divNodeRoot.style.width = width + "px";
        divNodeRoot.style.height = height + "px";
        if (isEntry) {
            // 当前节点标识
            /** @type {?} */
            var divNodeCurrent = document.createElement("div");
            divNodeRoot.appendChild(divNodeCurrent);
            divNodeCurrent.classList.add("bif-cell-node-current");
            /** @type {?} */
            var spanCurrent = document.createElement("span");
            divNodeCurrent.appendChild(spanCurrent);
            spanCurrent.classList.add("bif-cell-node-current-text");
            spanCurrent.innerHTML = "当前";
        }
        // 当比例小到指定值后仅显示单据名
        if (scale < this.THUMB_SCALE) {
            // // 使用图片+标题
            // const divNodeThumb = document.createElement("div");
            // divNodeRoot.appendChild(divNodeThumb);
            // divNodeThumb.classList.add("bif-cell-node-thumb");
            // const divNodeThumbImg = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbImg);
            // divNodeThumbImg.classList.add("bif-cell-node-thumb-img-container");
            // const img = document.createElement("img");
            // divNodeThumbImg.appendChild(img);
            // img.classList.add("bif-cell-node-thumb-img");
            // img.src = "/platform/runtime/common/web/@edp-bif/runtime-api/images/non-entry-bill.png";
            // const divNodeThumbTitle = document.createElement("div");
            // divNodeThumb.appendChild(divNodeThumbTitle);
            // divNodeThumbTitle.classList.add("bif-cell-node-thumb-title");
            // const divNodeThumbTitleText = document.createElement("div");
            // divNodeThumbTitle.appendChild(divNodeThumbTitleText);
            // divNodeThumbTitleText.classList.add("bif-cell-node-thumb-title-text");
            // divNodeThumbTitleText.innerHTML = title;
            // // 判断是否需添加点击事件
            // const jqm = this.billInfo.jointQueryMode;
            // const jqp: JointQueryParameters = JSON.parse(this.billInfo.jointQueryParameters);
            // if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
            //     divNodeThumbTitleText.classList.add("bif-cell-node-title-link");
            //     mxEvent.addListener(divNodeThumbTitleText, "click", () => {
            //         graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", this));
            //         event.stopPropagation();
            //         return false;
            //     });
            // }
            // 使用标题
            // 节点标题
            /** @type {?} */
            var divNodeTitleOnly = document.createElement("div");
            divNodeRoot.appendChild(divNodeTitleOnly);
            divNodeTitleOnly.classList.add("bif-cell-node-title-only");
            /** @type {?} */
            var divNodeTitleOnlyText = document.createElement("div");
            divNodeTitleOnly.appendChild(divNodeTitleOnlyText);
            divNodeTitleOnlyText.classList.add("bif-cell-node-title-only-text");
            divNodeTitleOnlyText.innerHTML = title;
            // 判断是否需添加点击事件
            /** @type {?} */
            var jqm = this.billInfo.jointQueryMode;
            /** @type {?} */
            var jqp = JSON.parse(this.billInfo.jointQueryParameters);
            if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                divNodeTitleOnlyText.classList.add("bif-cell-node-title-link");
                mxEvent.addListener(divNodeTitleOnlyText, "click", (/**
                 * @return {?}
                 */
                function () {
                    graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", _this));
                    event.stopPropagation();
                    return false;
                }));
            }
        }
        else {
            // 节点主内容
            /** @type {?} */
            var divNodeMain = document.createElement("div");
            divNodeRoot.appendChild(divNodeMain);
            divNodeMain.classList.add("bif-cell-node-main");
            // 节点标题
            /** @type {?} */
            var divNodeTitle = document.createElement("div");
            divNodeMain.appendChild(divNodeTitle);
            divNodeTitle.classList.add("bif-cell-node-title");
            /** @type {?} */
            var divNodeTitleText = document.createElement("div");
            divNodeTitle.appendChild(divNodeTitleText);
            divNodeTitleText.classList.add("bif-cell-node-title-text");
            divNodeTitleText.innerHTML = title;
            // 节点摘要
            /** @type {?} */
            var divNodeSummaryList_1 = document.createElement("div");
            divNodeMain.appendChild(divNodeSummaryList_1);
            divNodeSummaryList_1.classList.add("bif-cell-node-summary-list");
            // 46是标题栏高度
            divNodeSummaryList_1.style.minHeight = (height - 46) + "px";
            try {
                /** @type {?} */
                var fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
                fieldNameAndValues && fieldNameAndValues.forEach((/**
                 * @param {?} fv
                 * @param {?} idx
                 * @return {?}
                 */
                function (fv, idx) {
                    /** @type {?} */
                    var divNodeSummary = document.createElement("div");
                    divNodeSummaryList_1.appendChild(divNodeSummary);
                    divNodeSummary.classList.add("bif-cell-node-summary");
                    /** @type {?} */
                    var divNodeSummaryCaption = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryCaption);
                    divNodeSummaryCaption.classList.add("bif-cell-node-summary-caption");
                    /** @type {?} */
                    var divNodeSummaryCaptionText = document.createElement("div");
                    divNodeSummaryCaption.appendChild(divNodeSummaryCaptionText);
                    divNodeSummaryCaptionText.classList.add("bif-cell-node-summary-caption-text");
                    divNodeSummaryCaptionText.title = fv.name;
                    divNodeSummaryCaptionText.innerHTML = fv.name;
                    /** @type {?} */
                    var divNodeSummaryValue = document.createElement("div");
                    divNodeSummary.appendChild(divNodeSummaryValue);
                    divNodeSummaryValue.classList.add("bif-cell-node-summary-value");
                    /** @type {?} */
                    var divNodeSummaryValueText = document.createElement("div");
                    divNodeSummaryValue.appendChild(divNodeSummaryValueText);
                    divNodeSummaryValueText.classList.add("bif-cell-node-summary-value-text");
                    divNodeSummaryValueText.title = fv.value;
                    divNodeSummaryValueText.innerText = fv.value;
                    if (idx == 0) {
                        // 判断是否需添加点击事件
                        /** @type {?} */
                        var jqm = _this.billInfo.jointQueryMode;
                        /** @type {?} */
                        var jqp = JSON.parse(_this.billInfo.jointQueryParameters);
                        if ((jqm == JointQueryMode.APP && jqp.funcId) || (jqm == JointQueryMode.URL && jqp.url)) {
                            divNodeSummaryValueText.classList.add("bif-cell-node-title-link", "bif-cell-node-title-link-color");
                            mxEvent.addListener(divNodeSummaryValueText, "click", (/**
                             * @return {?}
                             */
                            function () {
                                graph.fireEvent(new mxEventObject(Events.CLICK_FIRST_SUMMARY, "cell", _this));
                                event.stopPropagation();
                                return false;
                            }));
                        }
                    }
                }));
            }
            catch (e) {
                console.error(e);
            }
        }
        return divNodeRoot;
    };
    /**
     * 通过模板字符串方式创建html
     * @param graph
     * @returns
     */
    /**
     * 通过模板字符串方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    BillCell.prototype.buildHtmlLabelByTemplateText = /**
     * 通过模板字符串方式创建html
     * @private
     * @param {?} graph
     * @return {?}
     */
    function (graph) {
        /** @type {?} */
        var state = graph.view.getState(this);
        /** @type {?} */
        var width = state && state.width ? state.width : this.geometry.width;
        /** @type {?} */
        var height = state && state.height ? state.height : this.geometry.height;
        /** @type {?} */
        var bts = new BillTrackingSettings();
        if (this.billInfo && this.billInfo.billTrackingSettings) {
            bts.LoadFromJson(this.billInfo.billTrackingSettings);
        }
        /** @type {?} */
        var title = this.billDataInfo.caption || bts.billNodeName || this.billInfo.voName || this.billDataInfo.dataId || this.billDataInfo.summary;
        /** @type {?} */
        var titleBackground = this.entry ? "rgba(86,160,255,0.08)" : "#FFFFFF";
        /** @type {?} */
        var summaryHtml = "";
        try {
            /** @type {?} */
            var fieldNameAndValues = BpmnModelJsonHelper.FromJson(this.billDataInfo.summary, FieldNameAndValue);
            fieldNameAndValues && fieldNameAndValues.forEach((/**
             * @param {?} fv
             * @param {?} idx
             * @return {?}
             */
            function (fv, idx) {
                /** @type {?} */
                var valueText = idx == 0 ? "<a href='javascript:void(0);'>" + fv.value + "</a>" : fv.value;
                summaryHtml += "                        <div class=\"bif-cell-node-summary\">                            <div class=\"bif-cell-node-summary-caption\">                                <div class=\"bif-cell-node-summary-caption-text\" title=\"" + fv.name + "\">" + fv.name + "</div>                            </div>                            <div class=\"bif-cell-node-summary-value\">                                <div class=\"bif-cell-node-summary-value-text\" title=\"" + fv.value + "\">" + valueText + "</div>                            </div>                        </div>                    ";
            }));
        }
        catch (e) {
            console.error(e);
        }
        /** @type {?} */
        var html = "            <div class=\"bif-cell-node\" style=\"width:" + width + "px;\">                <div class=\"bif-cell-node-main\" style=\"background: " + titleBackground + ";\">                    <div class=\"bif-cell-node-title\">                        <div class=\"bif-cell-node-title-text\">" + title + "</div>                    </div>                    <div class=\"bif-cell-node-summary-list\" style=\"min-height: " + (height - 30) + "px;\">                        " + summaryHtml + "                    </div>                </div>            </div>        ";
        return html;
    };
    return BillCell;
}(mxCell));
export { BillCell };
if (false) {
    /** @type {?} */
    BillCell.prototype.THUMB_SCALE;
    /** @type {?} */
    BillCell.prototype.entry;
    /** @type {?} */
    BillCell.prototype.data;
    /** @type {?} */
    BillCell.prototype.billDataInfo;
    /** @type {?} */
    BillCell.prototype.billInfo;
    /** @type {?} */
    BillCell.prototype.downCellOverlay;
    /** @type {?} */
    BillCell.prototype.upCellOverlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmlsbENlbGwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWRwLWJpZi9ydW50aW1lLWFwaS8iLCJzb3VyY2VzIjpbImxpYi9iaWxsLXRyYWNrZXIvbXhncmFwaC1leHQvQmlsbENlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFhLE1BQU0sbUJBQW1CLENBQUM7QUFLOUUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDMUQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLGNBQWMsRUFBd0IsTUFBTSxxQkFBcUIsQ0FBQztBQUVqRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUU1RSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWxDO0lBQThCLG9DQUFNO0lBU2hDLGtCQUFZLFlBQTBCLEVBQUUsUUFBK0MsRUFBRSxLQUFjLEVBQUUsUUFBUyxFQUFFLEtBQU07UUFBMUgsWUFDSSxrQkFBTSxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxTQVUvQjtRQW5CUSxpQkFBVyxHQUFXLEdBQUcsQ0FBQztRQVcvQixLQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUNqQyxLQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQzs7WUFDckIsR0FBRyxHQUF5QixJQUFJLG9CQUFvQixFQUFFO1FBQzFELElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRTtZQUMzQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1NBQ25EO1FBQ0QsS0FBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7O1FBQ25CLCtJQUErSTtJQUNuSixDQUFDOzs7O0lBRUQsNkJBQVU7OztJQUFWOztZQUNRLEtBQUssR0FBVyxJQUFJOztZQUNwQixHQUFHLEdBQXlCLElBQUks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QztZQUNOLENBQUMsRUFDSixDQUFDO1NBQ0w7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNSLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDcEI7O1lBQ0ssSUFBSSxHQUFHLDREQUNpQyxLQUFLLG9GQUNVLGVBQWUsbUlBRXBCLEtBQUssMkhBRVksTUFBTSxHQUFHLEVBQUUsdUNBQ2xFLFdBQVcsK0VBSTVCO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNMLGVBQUM7QUFBRCxDQUFDLEFBMVFELENBQThCLE1BQU0sR0EwUW5DOzs7O0lBelFHLCtCQUFtQzs7SUFFbkMseUJBQWU7O0lBQ2Ysd0JBQWU7O0lBQ2YsZ0NBQTJCOztJQUMzQiw0QkFBZ0Q7O0lBQ2hELG1DQUE2Qjs7SUFDN0IsaUNBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbXhDZWxsLCBteEV2ZW50LCBteEV2ZW50T2JqZWN0LCBNeEdyYXBoTlMgfSBmcm9tIFwiLi4vLi4vcmVmL214Z3JhcGhcIjtcclxuaW1wb3J0IHsgQmlsbERhdGFJbmZvIH0gZnJvbSAnLi4vLi4vZW50aXR5L3RyYWNraW5nL0JpbGxEYXRhSW5mbyc7XHJcbmltcG9ydCB7IERvd25CaWxsSW5mb1Jlc3VsdCB9IGZyb20gJy4uL2FyZ3MvRG93bkJpbGxJbmZvUmVzdWx0JztcclxuaW1wb3J0IHsgVXBCaWxsSW5mb1Jlc3VsdCB9IGZyb20gJy4uL2FyZ3MvVXBCaWxsSW5mb1Jlc3VsdCc7XHJcbmltcG9ydCB7IENlbGxEYXRhIH0gZnJvbSAnLi4vLi4vZW50aXR5L3RyYWNraW5nL2NlbGwtZGF0YS9DZWxsRGF0YSc7XHJcbmltcG9ydCB7IEJwbW5Nb2RlbEpzb25IZWxwZXIgfSBmcm9tIFwiQGVkcC1haWYvY29tbW9uLWFwaVwiO1xyXG5pbXBvcnQgeyBCaWxsVHJhY2tpbmdTZXR0aW5ncywgSm9pbnRRdWVyeU1vZGUsIEpvaW50UXVlcnlQYXJhbWV0ZXJzIH0gZnJvbSAnQGVkcC1iaWYvY29tbW9uLWFwaSc7XHJcbmltcG9ydCB7IEdyYXBoIH0gZnJvbSBcIi4vR3JhcGhcIjtcclxuaW1wb3J0IHsgRmllbGROYW1lQW5kVmFsdWUgfSBmcm9tIFwiLi4vLi4vZW50aXR5L3RyYWNraW5nL0ZpZWxkTmFtZUFuZFZhbHVlXCI7XHJcbmltcG9ydCB7IENlbGxPdmVybGF5IH0gZnJvbSBcIi4vQ2VsbE92ZXJsYXlcIjtcclxuaW1wb3J0IHsgRXZlbnRzIH0gZnJvbSBcIi4vRXZlbnRzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgQmlsbENlbGwgZXh0ZW5kcyBteENlbGwge1xyXG4gICAgcmVhZG9ubHkgVEhVTUJfU0NBTEU6IG51bWJlciA9IDAuNjtcclxuXHJcbiAgICBlbnRyeTogYm9vbGVhbjtcclxuICAgIGRhdGE6IENlbGxEYXRhO1xyXG4gICAgYmlsbERhdGFJbmZvOiBCaWxsRGF0YUluZm87XHJcbiAgICBiaWxsSW5mbzogRG93bkJpbGxJbmZvUmVzdWx0IHwgVXBCaWxsSW5mb1Jlc3VsdDtcclxuICAgIGRvd25DZWxsT3ZlcmxheTogQ2VsbE92ZXJsYXk7XHJcbiAgICB1cENlbGxPdmVybGF5OiBDZWxsT3ZlcmxheTtcclxuICAgIGNvbnN0cnVjdG9yKGJpbGxEYXRhSW5mbzogQmlsbERhdGFJbmZvLCBiaWxsSW5mbzogRG93bkJpbGxJbmZvUmVzdWx0IHwgVXBCaWxsSW5mb1Jlc3VsdCwgZW50cnk6IGJvb2xlYW4sIGdlb21ldHJ5Pywgc3R5bGU/KSB7XHJcbiAgICAgICAgc3VwZXIobnVsbCwgZ2VvbWV0cnksIHN0eWxlKTtcclxuXHJcbiAgICAgICAgdGhpcy5iaWxsRGF0YUluZm8gPSBiaWxsRGF0YUluZm87XHJcbiAgICAgICAgdGhpcy5iaWxsSW5mbyA9IGJpbGxJbmZvO1xyXG4gICAgICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICAgICAgaWYgKGJpbGxJbmZvICYmIGJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIGJ0cy5Mb2FkRnJvbUpzb24oYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVudHJ5ID0gZW50cnk7XHJcbiAgICAgICAgLy8gdGhpcy52YWx1ZSA9IHRoaXMuYmlsbERhdGFJbmZvLmNhcHRpb24gfHwgYnRzLmJpbGxOb2RlTmFtZSB8fCB0aGlzLmJpbGxJbmZvLnZvTmFtZSB8fCB0aGlzLmJpbGxEYXRhSW5mby5kYXRhSWQgfHwgdGhpcy5iaWxsRGF0YUluZm8uc3VtbWFyeTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDYXB0aW9uKCkge1xyXG4gICAgICAgIGxldCBsYWJlbDogc3RyaW5nID0gbnVsbDtcclxuICAgICAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgICAgIGlmICh0aGlzLmJpbGxJbmZvICYmIHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgYnRzLkxvYWRGcm9tSnNvbih0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGFiZWwgPSB0aGlzLmJpbGxEYXRhSW5mby5jYXB0aW9uIHx8IGJ0cy5iaWxsTm9kZU5hbWUgfHwgdGhpcy5iaWxsSW5mby52b05hbWUgfHwgdGhpcy5iaWxsRGF0YUluZm8uZGF0YUlkIHx8IHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnk7XHJcbiAgICAgICAgcmV0dXJuIGxhYmVsO1xyXG4gICAgfVxyXG5cclxuICAgIGJ1aWxkSHRtbFRvb2x0aXAoKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCB0b29sdGlwSHRtbCA9IGBcXFxyXG4gICAgICAgICAgICA8c3Bhbj4ke3RoaXMuYmlsbERhdGFJbmZvLmRhdGFJZH08L3NwYW4+XFxcclxuICAgICAgICBgO1xyXG4gICAgICAgIHJldHVybiB0b29sdGlwSHRtbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagt+W8j+exu+WcqGdyYXBo57uE5Lu25Lit5a6a5LmJXHJcbiAgICAgKiBAcGFyYW0gZ3JhcGggXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgYnVpbGRIdG1sTGFiZWwoZ3JhcGg6IEdyYXBoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRIdG1sTGFiZWxCeURPTShncmFwaCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgJrov4fmk43nurVkb23lhYPntKDmlrnlvI/liJvlu7podG1sXHJcbiAgICAgKiBAcGFyYW0gZ3JhcGggXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBidWlsZEh0bWxMYWJlbEJ5RE9NKGdyYXBoOiBHcmFwaCkge1xyXG4gICAgICAgIGNvbnN0IHNjYWxlID0gZ3JhcGgudmlldy5zY2FsZTtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IGdyYXBoLnZpZXcuZ2V0U3RhdGUodGhpcyk7XHJcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmdlb21ldHJ5LndpZHRoO1xyXG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuZ2VvbWV0cnkuaGVpZ2h0O1xyXG4gICAgICAgIGxldCBidHM6IEJpbGxUcmFja2luZ1NldHRpbmdzID0gbmV3IEJpbGxUcmFja2luZ1NldHRpbmdzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuYmlsbEluZm8gJiYgdGhpcy5iaWxsSW5mby5iaWxsVHJhY2tpbmdTZXR0aW5ncykge1xyXG4gICAgICAgICAgICBidHMuTG9hZEZyb21Kc29uKHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB0aXRsZSA9IHRoaXMuYmlsbERhdGFJbmZvLmNhcHRpb24gfHwgYnRzLmJpbGxOb2RlTmFtZSB8fCB0aGlzLmJpbGxJbmZvLnZvTmFtZSB8fCB0aGlzLmJpbGxEYXRhSW5mby5kYXRhSWQgfHwgdGhpcy5iaWxsRGF0YUluZm8uc3VtbWFyeTtcclxuICAgICAgICBjb25zdCBpc0VudHJ5ID0gdGhpcy5lbnRyeTtcclxuXHJcbiAgICAgICAgLy8g6IqC54K55qGG5p62XHJcbiAgICAgICAgY29uc3QgZGl2Tm9kZVJvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGRpdk5vZGVSb290LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlXCIpO1xyXG4gICAgICAgIGRpdk5vZGVSb290LnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7XHJcbiAgICAgICAgZGl2Tm9kZVJvb3Quc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgXCJweFwiO1xyXG5cclxuICAgICAgICBpZiAoaXNFbnRyeSkge1xyXG4gICAgICAgICAgICAvLyDlvZPliY3oioLngrnmoIfor4ZcclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZUN1cnJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlQ3VycmVudCk7XHJcbiAgICAgICAgICAgIGRpdk5vZGVDdXJyZW50LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWN1cnJlbnRcIik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzcGFuQ3VycmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlQ3VycmVudC5hcHBlbmRDaGlsZChzcGFuQ3VycmVudCk7XHJcbiAgICAgICAgICAgIHNwYW5DdXJyZW50LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLWN1cnJlbnQtdGV4dFwiKTtcclxuICAgICAgICAgICAgc3BhbkN1cnJlbnQuaW5uZXJIVE1MID0gXCLlvZPliY1cIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOW9k+avlOS+i+Wwj+WIsOaMh+WumuWAvOWQjuS7heaYvuekuuWNleaNruWQjVxyXG4gICAgICAgIGlmIChzY2FsZSA8IHRoaXMuVEhVTUJfU0NBTEUpIHtcclxuICAgICAgICAgICAgLy8gLy8g5L2/55So5Zu+54mHK+agh+mimFxyXG4gICAgICAgICAgICAvLyBjb25zdCBkaXZOb2RlVGh1bWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAvLyBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlVGh1bWIpO1xyXG4gICAgICAgICAgICAvLyBkaXZOb2RlVGh1bWIuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGh1bWJcIik7XHJcblxyXG4gICAgICAgICAgICAvLyBjb25zdCBkaXZOb2RlVGh1bWJJbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAvLyBkaXZOb2RlVGh1bWIuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRodW1iSW1nKTtcclxuICAgICAgICAgICAgLy8gZGl2Tm9kZVRodW1iSW1nLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRodW1iLWltZy1jb250YWluZXJcIik7XHJcblxyXG4gICAgICAgICAgICAvLyBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xyXG4gICAgICAgICAgICAvLyBkaXZOb2RlVGh1bWJJbWcuYXBwZW5kQ2hpbGQoaW1nKTtcclxuICAgICAgICAgICAgLy8gaW1nLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRodW1iLWltZ1wiKTtcclxuICAgICAgICAgICAgLy8gaW1nLnNyYyA9IFwiL3BsYXRmb3JtL3J1bnRpbWUvY29tbW9uL3dlYi9AZWRwLWJpZi9ydW50aW1lLWFwaS9pbWFnZXMvbm9uLWVudHJ5LWJpbGwucG5nXCI7XHJcblxyXG4gICAgICAgICAgICAvLyBjb25zdCBkaXZOb2RlVGh1bWJUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIC8vIGRpdk5vZGVUaHVtYi5hcHBlbmRDaGlsZChkaXZOb2RlVGh1bWJUaXRsZSk7XHJcbiAgICAgICAgICAgIC8vIGRpdk5vZGVUaHVtYlRpdGxlLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRodW1iLXRpdGxlXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8gY29uc3QgZGl2Tm9kZVRodW1iVGl0bGVUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgLy8gZGl2Tm9kZVRodW1iVGl0bGUuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRodW1iVGl0bGVUZXh0KTtcclxuICAgICAgICAgICAgLy8gZGl2Tm9kZVRodW1iVGl0bGVUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRodW1iLXRpdGxlLXRleHRcIik7XHJcbiAgICAgICAgICAgIC8vIGRpdk5vZGVUaHVtYlRpdGxlVGV4dC5pbm5lckhUTUwgPSB0aXRsZTtcclxuXHJcbiAgICAgICAgICAgIC8vIC8vIOWIpOaWreaYr+WQpumcgOa3u+WKoOeCueWHu+S6i+S7tlxyXG4gICAgICAgICAgICAvLyBjb25zdCBqcW0gPSB0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlNb2RlO1xyXG4gICAgICAgICAgICAvLyBjb25zdCBqcXA6IEpvaW50UXVlcnlQYXJhbWV0ZXJzID0gSlNPTi5wYXJzZSh0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlQYXJhbWV0ZXJzKTtcclxuICAgICAgICAgICAgLy8gaWYgKChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuQVBQICYmIGpxcC5mdW5jSWQpIHx8IChqcW0gPT0gSm9pbnRRdWVyeU1vZGUuVVJMICYmIGpxcC51cmwpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBkaXZOb2RlVGh1bWJUaXRsZVRleHQuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtdGl0bGUtbGlua1wiKTtcclxuICAgICAgICAgICAgLy8gICAgIG14RXZlbnQuYWRkTGlzdGVuZXIoZGl2Tm9kZVRodW1iVGl0bGVUZXh0LCBcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgICAgICBncmFwaC5maXJlRXZlbnQobmV3IG14RXZlbnRPYmplY3QoRXZlbnRzLkNMSUNLX0ZJUlNUX1NVTU1BUlksIFwiY2VsbFwiLCB0aGlzKSk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAvLyAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOS9v+eUqOagh+mimFxyXG4gICAgICAgICAgICAvLyDoioLngrnmoIfpophcclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVRpdGxlT25seSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVSb290LmFwcGVuZENoaWxkKGRpdk5vZGVUaXRsZU9ubHkpO1xyXG4gICAgICAgICAgICBkaXZOb2RlVGl0bGVPbmx5LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLW9ubHlcIik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkaXZOb2RlVGl0bGVPbmx5VGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVUaXRsZU9ubHkuYXBwZW5kQ2hpbGQoZGl2Tm9kZVRpdGxlT25seVRleHQpO1xyXG4gICAgICAgICAgICBkaXZOb2RlVGl0bGVPbmx5VGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS1vbmx5LXRleHRcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVUaXRsZU9ubHlUZXh0LmlubmVySFRNTCA9IHRpdGxlO1xyXG5cclxuICAgICAgICAgICAgLy8g5Yik5pat5piv5ZCm6ZyA5re75Yqg54K55Ye75LqL5Lu2XHJcbiAgICAgICAgICAgIGNvbnN0IGpxbSA9IHRoaXMuYmlsbEluZm8uam9pbnRRdWVyeU1vZGU7XHJcbiAgICAgICAgICAgIGNvbnN0IGpxcDogSm9pbnRRdWVyeVBhcmFtZXRlcnMgPSBKU09OLnBhcnNlKHRoaXMuYmlsbEluZm8uam9pbnRRdWVyeVBhcmFtZXRlcnMpO1xyXG4gICAgICAgICAgICBpZiAoKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5BUFAgJiYganFwLmZ1bmNJZCkgfHwgKGpxbSA9PSBKb2ludFF1ZXJ5TW9kZS5VUkwgJiYganFwLnVybCkpIHtcclxuICAgICAgICAgICAgICAgIGRpdk5vZGVUaXRsZU9ubHlUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmtcIik7XHJcbiAgICAgICAgICAgICAgICBteEV2ZW50LmFkZExpc3RlbmVyKGRpdk5vZGVUaXRsZU9ubHlUZXh0LCBcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBncmFwaC5maXJlRXZlbnQobmV3IG14RXZlbnRPYmplY3QoRXZlbnRzLkNMSUNLX0ZJUlNUX1NVTU1BUlksIFwiY2VsbFwiLCB0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDoioLngrnkuLvlhoXlrrlcclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZU1haW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlUm9vdC5hcHBlbmRDaGlsZChkaXZOb2RlTWFpbik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVNYWluLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLW1haW5cIik7XHJcblxyXG4gICAgICAgICAgICAvLyDoioLngrnmoIfpophcclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZGl2Tm9kZU1haW4uYXBwZW5kQ2hpbGQoZGl2Tm9kZVRpdGxlKTtcclxuICAgICAgICAgICAgZGl2Tm9kZVRpdGxlLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlXCIpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVRpdGxlVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVUaXRsZS5hcHBlbmRDaGlsZChkaXZOb2RlVGl0bGVUZXh0KTtcclxuICAgICAgICAgICAgZGl2Tm9kZVRpdGxlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS10aXRsZS10ZXh0XCIpO1xyXG4gICAgICAgICAgICBkaXZOb2RlVGl0bGVUZXh0LmlubmVySFRNTCA9IHRpdGxlO1xyXG5cclxuICAgICAgICAgICAgLy8g6IqC54K55pGY6KaBXHJcbiAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGRpdk5vZGVNYWluLmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5TGlzdCk7XHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5TGlzdC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWxpc3RcIik7XHJcbiAgICAgICAgICAgIC8vIDQ25piv5qCH6aKY5qCP6auY5bqmXHJcbiAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5TGlzdC5zdHlsZS5taW5IZWlnaHQgPSAoaGVpZ2h0IC0gNDYpICsgXCJweFwiO1xyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkTmFtZUFuZFZhbHVlczogRmllbGROYW1lQW5kVmFsdWVbXSA9IEJwbW5Nb2RlbEpzb25IZWxwZXIuRnJvbUpzb24odGhpcy5iaWxsRGF0YUluZm8uc3VtbWFyeSwgRmllbGROYW1lQW5kVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgZmllbGROYW1lQW5kVmFsdWVzICYmIGZpZWxkTmFtZUFuZFZhbHVlcy5mb3JFYWNoKFxyXG4gICAgICAgICAgICAgICAgICAgIChmdiwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlMaXN0LmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnkuY2xhc3NMaXN0LmFkZChcImJpZi1jZWxsLW5vZGUtc3VtbWFyeVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5LmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5Q2FwdGlvbi5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LWNhcHRpb25cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uLmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5Q2FwdGlvblRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktY2FwdGlvbi10ZXh0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeUNhcHRpb25UZXh0LnRpdGxlID0gZnYubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2Tm9kZVN1bW1hcnlDYXB0aW9uVGV4dC5pbm5lckhUTUwgPSBmdi5uYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGl2Tm9kZVN1bW1hcnlWYWx1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5LmFwcGVuZENoaWxkKGRpdk5vZGVTdW1tYXJ5VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlLmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktdmFsdWVcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWUuYXBwZW5kQ2hpbGQoZGl2Tm9kZVN1bW1hcnlWYWx1ZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dC5jbGFzc0xpc3QuYWRkKFwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlLXRleHRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0LnRpdGxlID0gZnYudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0LmlubmVyVGV4dCA9IGZ2LnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDliKTmlq3mmK/lkKbpnIDmt7vliqDngrnlh7vkuovku7ZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGpxbSA9IHRoaXMuYmlsbEluZm8uam9pbnRRdWVyeU1vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBqcXA6IEpvaW50UXVlcnlQYXJhbWV0ZXJzID0gSlNPTi5wYXJzZSh0aGlzLmJpbGxJbmZvLmpvaW50UXVlcnlQYXJhbWV0ZXJzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoanFtID09IEpvaW50UXVlcnlNb2RlLkFQUCAmJiBqcXAuZnVuY0lkKSB8fCAoanFtID09IEpvaW50UXVlcnlNb2RlLlVSTCAmJiBqcXAudXJsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdk5vZGVTdW1tYXJ5VmFsdWVUZXh0LmNsYXNzTGlzdC5hZGQoXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmtcIiwgXCJiaWYtY2VsbC1ub2RlLXRpdGxlLWxpbmstY29sb3JcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXhFdmVudC5hZGRMaXN0ZW5lcihkaXZOb2RlU3VtbWFyeVZhbHVlVGV4dCwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYXBoLmZpcmVFdmVudChuZXcgbXhFdmVudE9iamVjdChFdmVudHMuQ0xJQ0tfRklSU1RfU1VNTUFSWSwgXCJjZWxsXCIsIHRoaXMpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRpdk5vZGVSb290O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCa6L+H5qih5p2/5a2X56ym5Liy5pa55byP5Yib5bu6aHRtbFxyXG4gICAgICogQHBhcmFtIGdyYXBoIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYnVpbGRIdG1sTGFiZWxCeVRlbXBsYXRlVGV4dChncmFwaDogR3JhcGgpIHtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IGdyYXBoLnZpZXcuZ2V0U3RhdGUodGhpcyk7XHJcbiAgICAgICAgY29uc3Qgd2lkdGggPSBzdGF0ZSAmJiBzdGF0ZS53aWR0aCA/IHN0YXRlLndpZHRoIDogdGhpcy5nZW9tZXRyeS53aWR0aDtcclxuICAgICAgICBjb25zdCBoZWlnaHQgPSBzdGF0ZSAmJiBzdGF0ZS5oZWlnaHQgPyBzdGF0ZS5oZWlnaHQgOiB0aGlzLmdlb21ldHJ5LmhlaWdodDtcclxuICAgICAgICBsZXQgYnRzOiBCaWxsVHJhY2tpbmdTZXR0aW5ncyA9IG5ldyBCaWxsVHJhY2tpbmdTZXR0aW5ncygpO1xyXG4gICAgICAgIGlmICh0aGlzLmJpbGxJbmZvICYmIHRoaXMuYmlsbEluZm8uYmlsbFRyYWNraW5nU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgYnRzLkxvYWRGcm9tSnNvbih0aGlzLmJpbGxJbmZvLmJpbGxUcmFja2luZ1NldHRpbmdzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLmJpbGxEYXRhSW5mby5jYXB0aW9uIHx8IGJ0cy5iaWxsTm9kZU5hbWUgfHwgdGhpcy5iaWxsSW5mby52b05hbWUgfHwgdGhpcy5iaWxsRGF0YUluZm8uZGF0YUlkIHx8IHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnk7XHJcbiAgICAgICAgY29uc3QgdGl0bGVCYWNrZ3JvdW5kID0gdGhpcy5lbnRyeSA/IFwicmdiYSg4NiwxNjAsMjU1LDAuMDgpXCIgOiBcIiNGRkZGRkZcIjtcclxuXHJcbiAgICAgICAgbGV0IHN1bW1hcnlIdG1sID0gXCJcIjtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBmaWVsZE5hbWVBbmRWYWx1ZXM6IEZpZWxkTmFtZUFuZFZhbHVlW10gPSBCcG1uTW9kZWxKc29uSGVscGVyLkZyb21Kc29uKHRoaXMuYmlsbERhdGFJbmZvLnN1bW1hcnksIEZpZWxkTmFtZUFuZFZhbHVlKTtcclxuICAgICAgICAgICAgZmllbGROYW1lQW5kVmFsdWVzICYmIGZpZWxkTmFtZUFuZFZhbHVlcy5mb3JFYWNoKFxyXG4gICAgICAgICAgICAgICAgKGZ2LCBpZHgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVUZXh0ID0gaWR4ID09IDAgPyBgPGEgaHJlZj0namF2YXNjcmlwdDp2b2lkKDApOyc+JHtmdi52YWx1ZX08L2E+YCA6IGZ2LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHN1bW1hcnlIdG1sICs9IGBcXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5XCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktY2FwdGlvblwiPlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtc3VtbWFyeS1jYXB0aW9uLXRleHRcIiB0aXRsZT1cIiR7ZnYubmFtZX1cIj4ke2Z2Lm5hbWV9PC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlXCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmlmLWNlbGwtbm9kZS1zdW1tYXJ5LXZhbHVlLXRleHRcIiB0aXRsZT1cIiR7ZnYudmFsdWV9XCI+JHt2YWx1ZVRleHR9PC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgICAgICAgICAgYDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGh0bWwgPSBgXFxcclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGVcIiBzdHlsZT1cIndpZHRoOiR7d2lkdGh9cHg7XCI+XFxcclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLW1haW5cIiBzdHlsZT1cImJhY2tncm91bmQ6ICR7dGl0bGVCYWNrZ3JvdW5kfTtcIj5cXFxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXRpdGxlXCI+XFxcclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJpZi1jZWxsLW5vZGUtdGl0bGUtdGV4dFwiPiR7dGl0bGV9PC9kaXY+XFxcclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXFxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiaWYtY2VsbC1ub2RlLXN1bW1hcnktbGlzdFwiIHN0eWxlPVwibWluLWhlaWdodDogJHtoZWlnaHQgLSAzMH1weDtcIj5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAke3N1bW1hcnlIdG1sfVxcXHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcclxuICAgICAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgICAgIDwvZGl2PlxcXHJcbiAgICAgICAgYDtcclxuICAgICAgICByZXR1cm4gaHRtbDtcclxuICAgIH1cclxufVxyXG4iXX0=