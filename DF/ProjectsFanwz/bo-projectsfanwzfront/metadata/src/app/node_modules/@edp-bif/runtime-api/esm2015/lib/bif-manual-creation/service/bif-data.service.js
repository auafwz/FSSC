/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-data.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpClient, } from '@angular/common/http';
import { of } from 'rxjs';
import { map, switchMap } from 'rxjs/operators';
import { Repository } from '@farris/devkit';
import { FormSettings } from '@edp-bif/common-api';
import { GeneralTextEntity } from '@edp-bif/common-api';
import { FormCreateResult, FormUpdateResult } from '../../ref';
import { FormGetBillCreationProcessEntityExArgs } from '../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { FormGetBillCreationProcessEntityExResult } from '../../entity/form-rest/FormGetBillCreationProcessEntityExResult';
import { FormBillCreationProcessExecutorResult } from '../../entity/form-rest/FormBillCreationProcessExecutorResult';
import { ManualCreationMode } from '../../entity/form-rest/ManualCreationMode';
export class BifDataService {
    /**
     * @param {?} httpClient
     * @param {?} repository
     */
    constructor(httpClient, repository) {
        this.httpClient = httpClient;
        this.getBillCreationProcessEntityExByIdUrl = "/api/runtime/aif/v1.0/manualcreationbill/getbillcreationprocessentityex";
        this.getBillCreationProcessEntityExByIdMethod = "GET";
        this.getBillCreationProcessEntityExUrl = "/api/runtime/aif/v1.0/manualcreationbill/getbillcreationprocessentityexes";
        this.getBillCreationProcessEntityExMethod = "POST";
        this.executeBillCreationProcessUrl = "/api/runtime/aif/v1.0/manualcreationbill/executebillcreationprocess";
        this.executeBillCreationProcessMethod = "POST";
        this.formCreateUrl = "/api/runtime/aif/v1.0/form/create";
        this.formCreateMethod = "POST";
        this.formUpdateUrl = "/api/runtime/aif/v1.0/form/update";
        this.formUpdateMethod = "POST";
        this.generalTextUrl = "/api/runtime/aif/v1.0/generaltext";
        this.generalTextMethod = "GET";
        this.repository = (/** @type {?} */ (repository));
    }
    /**
     * 根据上游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} upBillVoId 上游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByUpBillVoId4Push(upBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.manualCreationMode = ManualCreationMode.Push;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })));
    }
    /**
     * 根据下游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} downBillVoId 下游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByDownBillVoId4Pull(downBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.Pull;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })));
    }
    /**
     * 根据上游 VO Id和下游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} upBillVoId 上游 VO Id。
     * @param {?} downBillVoId 下游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPush(upBillVoId, downBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPush;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })));
    }
    /**
     * 根据上游 VO Id和下游 VO Id获取单据流生单流程实体列表。
     *
     * @param {?} upBillVoId 上游 VO Id。
     * @param {?} downBillVoId 下游 VO Id。
     * @return {?} 符合条件的单据流生单流程实体列表。
     */
    getSlimBillCreationProcessEntityExesByUpBillVoIdAndDownBillVoId4SpecificPull(upBillVoId, downBillVoId) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPull;
        return this.getSlimBillCreationProcessEntityExes(args).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res.billCreationProcessEntityExes;
        })));
    }
    /**
     * 获取单据流生单流程实体
     * @param {?} processId
     * @return {?}
     */
    getSlimBillCreationProcessEntityExById(processId) {
        /** @type {?} */
        const getCreationRuleById$ = this.repository.proxy.request(`${this.getBillCreationProcessEntityExByIdUrl}/${processId}`, this.getBillCreationProcessEntityExByIdMethod, null);
        return getCreationRuleById$;
    }
    /**
     * 获取表单配置实体
     * @param {?} formSettingsId
     * @return {?}
     */
    getFormSettingsById(formSettingsId) {
        if (formSettingsId == null || formSettingsId.trim() == "") {
            throw "FormSettingsId为空";
        }
        /** @type {?} */
        const formSettings$ = this.repository.proxy.request(`${this.generalTextUrl}/${formSettingsId}`, this.generalTextMethod, null, { responseType: "text" });
        return formSettings$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const generateText = new GeneralTextEntity();
            generateText.LoadFromJson(data);
            /** @type {?} */
            const formSettings = new FormSettings();
            formSettings.LoadFromJson(generateText.text);
            return formSettings;
        })));
    }
    /**
     * 执行单据流生单流程
     * @param {?} args
     * @return {?}
     */
    executeBillCreationProcess(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const executeCreationRule$ = this.repository.proxy.request(this.executeBillCreationProcessUrl, this.executeBillCreationProcessMethod, null, {
            body: body,
            responseType: 'text'
        });
        return executeCreationRule$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJson(data);
            return res;
        })));
    }
    /**
     * 创建单据
     * @param {?} args
     * @return {?}
     */
    createEntityDatas(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: 'text'
        };
        /** @type {?} */
        const create$ = this.repository.proxy.request(this.formCreateUrl, this.formCreateMethod, null, options);
        return create$.pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            const result = new FormCreateResult();
            result.LoadFromJson(res);
            /** @type {?} */
            const entities = result.entityDataList.map((/**
             * @param {?} entityStr
             * @return {?}
             */
            (entityStr) => {
                /** @type {?} */
                const newEntity = this.repository.buildEntity(JSON.parse(entityStr));
                this.appendInitialData(newEntity, newEntity);
                return newEntity;
            }));
            /** @type {?} */
            let origin = this.repository.entityCollection.getAllEntities();
            if (origin == null || origin.length == 0) {
                this.repository.entityCollection.loadEntities(entities);
            }
            else {
                this.repository.entityCollection.addEntities(entities);
            }
            return of(result);
        })));
    }
    /**
     * 修改单据
     * @param {?} args 表单更新参数
     * @return {?}
     */
    updateEntityDatas(args) {
        /** @type {?} */
        const body = args.ConvertToJson();
        /** @type {?} */
        const options = {
            body: body,
            responseType: "text"
        };
        /** @type {?} */
        const update$ = this.repository.proxy.request(this.formUpdateUrl, this.formUpdateMethod, null, options);
        return update$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const res = new FormUpdateResult();
            res.LoadFromJson(data);
            return res;
        })));
    }
    /**
     * 查询单据生单流程扩展实体
     * @private
     * @param {?} args 查询参数
     * @return {?}
     */
    getSlimBillCreationProcessEntityExes(args) {
        if (args == null) {
            throw "args不可为空";
        }
        if (typeof args == "string") {
            if (args == "") {
                throw "args不可为空";
            }
            /** @type {?} */
            const temp = new FormGetBillCreationProcessEntityExArgs();
            temp.LoadFromJson(args);
            args = temp;
        }
        /** @type {?} */
        const getEntity$ = this.repository.proxy.request(this.getBillCreationProcessEntityExUrl, this.getBillCreationProcessEntityExMethod, null, { body: args.ConvertToJson(), responseType: "text" });
        return getEntity$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const result = new FormGetBillCreationProcessEntityExResult();
            result.LoadFromJson(data);
            return result;
        })));
    }
    /**
     * 参考farris/bef EntityUtil实现
     * @private
     * @param {?} entity
     * @param {?} initialData
     * @return {?}
     */
    appendInitialData(entity, initialData) {
        /** @type {?} */
        const data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    }
}
BifDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifDataService.ctorParameters = () => [
    { type: HttpClient },
    { type: Repository }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.getBillCreationProcessEntityExByIdUrl;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.getBillCreationProcessEntityExByIdMethod;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.getBillCreationProcessEntityExUrl;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.getBillCreationProcessEntityExMethod;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.executeBillCreationProcessUrl;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.executeBillCreationProcessMethod;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.formCreateUrl;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.formCreateMethod;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.formUpdateUrl;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.formUpdateMethod;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.generalTextUrl;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.generalTextMethod;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.repository;
    /**
     * @type {?}
     * @private
     */
    BifDataService.prototype.httpClient;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLWRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BlZHAtYmlmL3J1bnRpbWUtYXBpLyIsInNvdXJjZXMiOlsibGliL2JpZi1tYW51YWwtY3JlYXRpb24vc2VydmljZS9iaWYtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxHQUFHLE1BQU0sc0JBQXNCLENBQUM7QUFDbkQsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR2hELE9BQU8sRUFBRSxVQUFVLEVBQVUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHeEQsT0FBTyxFQUFrQixnQkFBZ0IsRUFBa0IsZ0JBQWdCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFL0YsT0FBTyxFQUFFLHNDQUFzQyxFQUFFLE1BQU0sK0RBQStELENBQUM7QUFDdkgsT0FBTyxFQUFFLHdDQUF3QyxFQUFFLE1BQU0saUVBQWlFLENBQUM7QUFFM0gsT0FBTyxFQUFFLHFDQUFxQyxFQUFFLE1BQU0sOERBQThELENBQUM7QUFDckgsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFHL0UsTUFBTSxPQUFPLGNBQWM7Ozs7O0lBb0J2QixZQUNZLFVBQXNCLEVBQzlCLFVBQThCO1FBRHRCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFwQmpCLDBDQUFxQyxHQUFHLHlFQUF5RSxDQUFDO1FBQ2xILDZDQUF3QyxHQUFHLEtBQUssQ0FBQztRQUVqRCxzQ0FBaUMsR0FBVywyRUFBMkUsQ0FBQztRQUN4SCx5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bnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBCZWZSZXBvc2l0b3J5IH0gZnJvbSAnQGZhcnJpcy9iZWYnO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBFbnRpdHkgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcblxyXG5pbXBvcnQgeyBGb3JtU2V0dGluZ3MgfSBmcm9tICdAZWRwLWJpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgR2VuZXJhbFRleHRFbnRpdHkgfSBmcm9tICdAZWRwLWJpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeCB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5cclxuaW1wb3J0IHsgRm9ybUNyZWF0ZUFyZ3MsIEZvcm1DcmVhdGVSZXN1bHQsIEZvcm1VcGRhdGVBcmdzLCBGb3JtVXBkYXRlUmVzdWx0IH0gZnJvbSAnLi4vLi4vcmVmJztcclxuXHJcbmltcG9ydCB7IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzIH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9Gb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncyc7XHJcbmltcG9ydCB7IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhSZXN1bHQgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhSZXN1bHQnO1xyXG5pbXBvcnQgeyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yQXJncyB9IGZyb20gJy4uLy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvckFyZ3MnO1xyXG5pbXBvcnQgeyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0IH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9Gb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0JztcclxuaW1wb3J0IHsgTWFudWFsQ3JlYXRpb25Nb2RlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2Zvcm0tcmVzdC9NYW51YWxDcmVhdGlvbk1vZGUnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQmlmRGF0YVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBnZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhCeUlkVXJsID0gXCIvYXBpL3J1bnRpbWUvYWlmL3YxLjAvbWFudWFsY3JlYXRpb25iaWxsL2dldGJpbGxjcmVhdGlvbnByb2Nlc3NlbnRpdHlleFwiO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBnZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhCeUlkTWV0aG9kID0gXCJHRVRcIjtcclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFVybDogc3RyaW5nID0gXCIvYXBpL3J1bnRpbWUvYWlmL3YxLjAvbWFudWFsY3JlYXRpb25iaWxsL2dldGJpbGxjcmVhdGlvbnByb2Nlc3NlbnRpdHlleGVzXCI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeE1ldGhvZDogc3RyaW5nID0gXCJQT1NUXCI7XHJcblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBleGVjdXRlQmlsbENyZWF0aW9uUHJvY2Vzc1VybDogc3RyaW5nID0gXCIvYXBpL3J1bnRpbWUvYWlmL3YxLjAvbWFudWFsY3JlYXRpb25iaWxsL2V4ZWN1dGViaWxsY3JlYXRpb25wcm9jZXNzXCI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGV4ZWN1dGVCaWxsQ3JlYXRpb25Qcm9jZXNzTWV0aG9kOiBzdHJpbmcgPSBcIlBPU1RcIjtcclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZvcm1DcmVhdGVVcmw6IHN0cmluZyA9IFwiL2FwaS9ydW50aW1lL2FpZi92MS4wL2Zvcm0vY3JlYXRlXCI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZvcm1DcmVhdGVNZXRob2Q6IHN0cmluZyA9IFwiUE9TVFwiO1xyXG5cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZm9ybVVwZGF0ZVVybDogc3RyaW5nID0gXCIvYXBpL3J1bnRpbWUvYWlmL3YxLjAvZm9ybS91cGRhdGVcIjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZm9ybVVwZGF0ZU1ldGhvZDogc3RyaW5nID0gXCJQT1NUXCI7XHJcblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBnZW5lcmFsVGV4dFVybDogc3RyaW5nID0gXCIvYXBpL3J1bnRpbWUvYWlmL3YxLjAvZ2VuZXJhbHRleHRcIjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ2VuZXJhbFRleHRNZXRob2Q6IHN0cmluZyA9IFwiR0VUXCI7XHJcblxyXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PEVudGl0eT47XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsXHJcbiAgICAgICAgcmVwb3NpdG9yeTogUmVwb3NpdG9yeTxFbnRpdHk+LFxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5ID0gcmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PEVudGl0eT47XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7kuIrmuLggVk8gSWTojrflj5bljZXmja7mtYHnlJ/ljZXmtYHnqIvlrp7kvZPliJfooajjgIJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXBCaWxsVm9JZCDkuIrmuLggVk8gSWTjgIJcclxuICAgICAqIEByZXR1cm4g56ym5ZCI5p2h5Lu255qE5Y2V5o2u5rWB55Sf5Y2V5rWB56iL5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeVVwQmlsbFZvSWQ0UHVzaCh1cEJpbGxWb0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXT4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MoKTtcclxuICAgICAgICBhcmdzLnVwQmlsbFZvSWQgPSB1cEJpbGxWb0lkO1xyXG4gICAgICAgIGFyZ3MubWFudWFsQ3JlYXRpb25Nb2RlID0gTWFudWFsQ3JlYXRpb25Nb2RlLlB1c2g7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzKGFyZ3MpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChyZXM6IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNruS4i+a4uCBWTyBJZOiOt+WPluWNleaNrua1geeUn+WNlea1geeoi+WunuS9k+WIl+ihqOOAglxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBkb3duQmlsbFZvSWQg5LiL5ri4IFZPIElk44CCXHJcbiAgICAgKiBAcmV0dXJuIOespuWQiOadoeS7tueahOWNleaNrua1geeUn+WNlea1geeoi+WunuS9k+WIl+ihqOOAglxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzQnlEb3duQmlsbFZvSWQ0UHVsbChkb3duQmlsbFZvSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdPiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3MuZG93bkJpbGxWb0lkID0gZG93bkJpbGxWb0lkO1xyXG4gICAgICAgIGFyZ3MubWFudWFsQ3JlYXRpb25Nb2RlID0gTWFudWFsQ3JlYXRpb25Nb2RlLlB1bGw7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzKGFyZ3MpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChyZXM6IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhSZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeGVzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNruS4iua4uCBWTyBJZOWSjOS4i+a4uCBWTyBJZOiOt+WPluWNleaNrua1geeUn+WNlea1geeoi+WunuS9k+WIl+ihqOOAglxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cEJpbGxWb0lkIOS4iua4uCBWTyBJZOOAglxyXG4gICAgICogQHBhcmFtIGRvd25CaWxsVm9JZCDkuIvmuLggVk8gSWTjgIJcclxuICAgICAqIEByZXR1cm4g56ym5ZCI5p2h5Lu255qE5Y2V5o2u5rWB55Sf5Y2V5rWB56iL5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXNCeVVwQmlsbFZvSWRBbmREb3duQmlsbFZvSWQ0U3BlY2lmaWNQdXNoKHVwQmlsbFZvSWQ6IHN0cmluZywgZG93bkJpbGxWb0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhbXT4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MoKTtcclxuICAgICAgICBhcmdzLnVwQmlsbFZvSWQgPSB1cEJpbGxWb0lkO1xyXG4gICAgICAgIGFyZ3MuZG93bkJpbGxWb0lkID0gZG93bkJpbGxWb0lkO1xyXG4gICAgICAgIGFyZ3MubWFudWFsQ3JlYXRpb25Nb2RlID0gTWFudWFsQ3JlYXRpb25Nb2RlLlNwZWNpZmljUHVzaDtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXMoYXJncykucGlwZShcclxuICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgKHJlczogRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuYmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u5LiK5ri4IFZPIElk5ZKM5LiL5ri4IFZPIElk6I635Y+W5Y2V5o2u5rWB55Sf5Y2V5rWB56iL5a6e5L2T5YiX6KGo44CCXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVwQmlsbFZvSWQg5LiK5ri4IFZPIElk44CCXHJcbiAgICAgKiBAcGFyYW0gZG93bkJpbGxWb0lkIOS4i+a4uCBWTyBJZOOAglxyXG4gICAgICogQHJldHVybiDnrKblkIjmnaHku7bnmoTljZXmja7mtYHnlJ/ljZXmtYHnqIvlrp7kvZPliJfooajjgIJcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhlc0J5VXBCaWxsVm9JZEFuZERvd25CaWxsVm9JZDRTcGVjaWZpY1B1bGwodXBCaWxsVm9JZDogc3RyaW5nLCBkb3duQmlsbFZvSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeFtdPiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3MudXBCaWxsVm9JZCA9IHVwQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5kb3duQmlsbFZvSWQgPSBkb3duQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5tYW51YWxDcmVhdGlvbk1vZGUgPSBNYW51YWxDcmVhdGlvbk1vZGUuU3BlY2lmaWNQdWxsO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhlcyhhcmdzKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAocmVzOiBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4UmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5iaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhlcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bljZXmja7mtYHnlJ/ljZXmtYHnqIvlrp7kvZNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhCeUlkKHByb2Nlc3NJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB7XHJcbiAgICAgICAgY29uc3QgZ2V0Q3JlYXRpb25SdWxlQnlJZCQ6IE9ic2VydmFibGU8SVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeD4gPSB0aGlzLnJlcG9zaXRvcnkucHJveHkucmVxdWVzdChgJHt0aGlzLmdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEJ5SWRVcmx9LyR7cHJvY2Vzc0lkfWAsIHRoaXMuZ2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QnlJZE1ldGhvZCwgbnVsbCk7XHJcbiAgICAgICAgcmV0dXJuIGdldENyZWF0aW9uUnVsZUJ5SWQkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6KGo5Y2V6YWN572u5a6e5L2TXHJcbiAgICAgKiBAcGFyYW0gZm9ybVNldHRpbmdzSWQgXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRGb3JtU2V0dGluZ3NCeUlkKGZvcm1TZXR0aW5nc0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvcm1TZXR0aW5ncz4ge1xyXG4gICAgICAgIGlmIChmb3JtU2V0dGluZ3NJZCA9PSBudWxsIHx8IGZvcm1TZXR0aW5nc0lkLnRyaW0oKSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiRm9ybVNldHRpbmdzSWTkuLrnqbpcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZvcm1TZXR0aW5ncyQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMucmVwb3NpdG9yeS5wcm94eS5yZXF1ZXN0KGAke3RoaXMuZ2VuZXJhbFRleHRVcmx9LyR7Zm9ybVNldHRpbmdzSWR9YCwgdGhpcy5nZW5lcmFsVGV4dE1ldGhvZCwgbnVsbCwgeyByZXNwb25zZVR5cGU6IFwidGV4dFwiIH0pO1xyXG4gICAgICAgIHJldHVybiBmb3JtU2V0dGluZ3MkLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnZW5lcmF0ZVRleHQgPSBuZXcgR2VuZXJhbFRleHRFbnRpdHkoKTtcclxuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVRleHQuTG9hZEZyb21Kc29uKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1TZXR0aW5ncyA9IG5ldyBGb3JtU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MuTG9hZEZyb21Kc29uKGdlbmVyYXRlVGV4dC50ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybVNldHRpbmdzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJp+ihjOWNleaNrua1geeUn+WNlea1geeoi1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZXhlY3V0ZUJpbGxDcmVhdGlvblByb2Nlc3MoYXJnczogRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvckFyZ3MpOiBPYnNlcnZhYmxlPEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQ+IHtcclxuICAgICAgICBjb25zdCBib2R5ID0gYXJncy5Db252ZXJ0VG9Kc29uKCk7XHJcbiAgICAgICAgY29uc3QgZXhlY3V0ZUNyZWF0aW9uUnVsZSQgPSB0aGlzLnJlcG9zaXRvcnkucHJveHkucmVxdWVzdCh0aGlzLmV4ZWN1dGVCaWxsQ3JlYXRpb25Qcm9jZXNzVXJsLCB0aGlzLmV4ZWN1dGVCaWxsQ3JlYXRpb25Qcm9jZXNzTWV0aG9kLCBudWxsLCB7XHJcbiAgICAgICAgICAgIGJvZHk6IGJvZHksXHJcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGV4ZWN1dGVDcmVhdGlvblJ1bGUkLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgIChkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBuZXcgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5Mb2FkRnJvbUpzb24oZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rljZXmja5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGNyZWF0ZUVudGl0eURhdGFzKGFyZ3M6IEZvcm1DcmVhdGVBcmdzKTogT2JzZXJ2YWJsZTxGb3JtQ3JlYXRlUmVzdWx0PiB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IGFyZ3MuQ29udmVydFRvSnNvbigpO1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGJvZHk6IGJvZHksXHJcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjcmVhdGUkOiBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLnJlcG9zaXRvcnkucHJveHkucmVxdWVzdCh0aGlzLmZvcm1DcmVhdGVVcmwsIHRoaXMuZm9ybUNyZWF0ZU1ldGhvZCwgbnVsbCwgb3B0aW9ucyk7XHJcbiAgICAgICAgcmV0dXJuIGNyZWF0ZSQucGlwZShcclxuICAgICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAgICAgKHJlczogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IEZvcm1DcmVhdGVSZXN1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuTG9hZEZyb21Kc29uKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50aXRpZXM6IEVudGl0eVtdID0gcmVzdWx0LmVudGl0eURhdGFMaXN0Lm1hcCgoZW50aXR5U3RyOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KEpTT04ucGFyc2UoZW50aXR5U3RyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kSW5pdGlhbERhdGEobmV3RW50aXR5LCBuZXdFbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBvcmlnaW4gPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW4gPT0gbnVsbCB8fCBvcmlnaW4ubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDkv67mlLnljZXmja5cclxuICAgICAqIEBwYXJhbSBhcmdzIOihqOWNleabtOaWsOWPguaVsFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdXBkYXRlRW50aXR5RGF0YXMoYXJnczogRm9ybVVwZGF0ZUFyZ3MpOiBPYnNlcnZhYmxlPEZvcm1VcGRhdGVSZXN1bHQ+IHtcclxuICAgICAgICBjb25zdCBib2R5ID0gYXJncy5Db252ZXJ0VG9Kc29uKCk7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYm9keTogYm9keSxcclxuICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiBcInRleHRcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgdXBkYXRlJCA9IHRoaXMucmVwb3NpdG9yeS5wcm94eS5yZXF1ZXN0KHRoaXMuZm9ybVVwZGF0ZVVybCwgdGhpcy5mb3JtVXBkYXRlTWV0aG9kLCBudWxsLCBvcHRpb25zKTtcclxuICAgICAgICByZXR1cm4gdXBkYXRlJC5waXBlKFxyXG4gICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAoZGF0YTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzOiBGb3JtVXBkYXRlUmVzdWx0ID0gbmV3IEZvcm1VcGRhdGVSZXN1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXMuTG9hZEZyb21Kc29uKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5p+l6K+i5Y2V5o2u55Sf5Y2V5rWB56iL5omp5bGV5a6e5L2TXHJcbiAgICAgKiBAcGFyYW0gYXJncyDmn6Xor6Llj4LmlbBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4ZXMoYXJnczogRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MgfCBzdHJpbmcpOiBPYnNlcnZhYmxlPEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhSZXN1bHQ+IHtcclxuICAgICAgICBpZiAoYXJncyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiYXJnc+S4jeWPr+S4uuepulwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGFyZ3MgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAoYXJncyA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcImFyZ3PkuI3lj6/kuLrnqbpcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0ZW1wID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzKCk7XHJcbiAgICAgICAgICAgIHRlbXAuTG9hZEZyb21Kc29uKGFyZ3MpO1xyXG4gICAgICAgICAgICBhcmdzID0gdGVtcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZ2V0RW50aXR5JCA9IHRoaXMucmVwb3NpdG9yeS5wcm94eS5yZXF1ZXN0KHRoaXMuZ2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4VXJsLCB0aGlzLmdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeE1ldGhvZCwgbnVsbCwgeyBib2R5OiBhcmdzLkNvbnZlcnRUb0pzb24oKSwgcmVzcG9uc2VUeXBlOiBcInRleHRcIiB9KTtcclxuICAgICAgICByZXR1cm4gZ2V0RW50aXR5JC5waXBlKFxyXG4gICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAoZGF0YTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhSZXN1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuTG9hZEZyb21Kc29uKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiBcclxuICAgICAqIOWPguiAg2ZhcnJpcy9iZWYgRW50aXR5VXRpbOWunueOsFxyXG4gICAgICogQHBhcmFtIGVudGl0eSBcclxuICAgICAqIEBwYXJhbSBpbml0aWFsRGF0YSBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBhcHBlbmRJbml0aWFsRGF0YShlbnRpdHksIGluaXRpYWxEYXRhKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGluaXRpYWxEYXRhKTtcclxuICAgICAgICBkZWxldGUgZGF0YS5pZDtcclxuICAgICAgICBkZWxldGUgZGF0YS5wYXJlbnRJRDtcclxuICAgICAgICBlbnRpdHlbJ2luaXRpYWxEYXRhJ10gPSBkYXRhO1xyXG4gICAgfVxyXG59Il19