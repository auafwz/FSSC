/**
 * @fileoverview added by tsickle
 * Generated from: lib/webcmp/bif-manual-creation-data.webcmp.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { throwError } from 'rxjs';
import { MessagerService } from "@farris/ui-messager";
import { BindingData, ViewModel, FrameContext } from "@farris/devkit";
import { FormBillCreationProcessExecutorArgs } from '../entity/form-rest/FormBillCreationProcessExecutorArgs';
import { BifDataService } from '../bif-manual-creation/service/bif-data.service';
import { FormCreateArgs, FormUpdateArgs } from '../ref';
/**
 * 手工生单数据服务类
 */
export class BifManualCreationDataWebCmpService {
    /**
     * @param {?} dataService
     * @param {?} bindingData
     * @param {?} messagerService
     * @param {?} viewModel
     * @param {?} frameContext
     */
    constructor(dataService, bindingData, messagerService, viewModel, frameContext) {
        this.dataService = dataService;
        this.bindingData = bindingData;
        this.messagerService = messagerService;
        this.viewModel = viewModel;
        this.frameContext = frameContext;
    }
    /**
     * 根据生单流程Id查找指定的生单流程
     * @param {?} processId 单据流生单流程 Id
     * @return {?} creationProcess 生单流程 \@type { Observable<IRtSlimBillCreationProcessEntityEx> }
     */
    getSlimBillCreationProcessEntityExById(processId) {
        return this.dataService.getSlimBillCreationProcessEntityExById(processId);
    }
    /**
     * 查询表单配置
     * @param {?} formSettingsId 表单配置Id
     * @return {?} formSettings 表单配置 \@type { Observable<FormSettings> }
     */
    getFormSettingsById(formSettingsId) {
        return this.dataService.getFormSettingsById(formSettingsId);
    }
    /**
     * 执行生单流程
     * @param {?} entities 参与生单的来源单据列表
     * @param {?} creationProcessId 单据流生单流程 Id
     * @param {?} creationRuleId 生单规则Id（生单流程实体中记录）
     * @param {?} targetDataIds
     * @return {?} creationResult 生单结果 \@type { Observable<FormBillCreationProcessExecutorResult> }
     */
    executeBillCreationProcess(entities, creationProcessId, creationRuleId, targetDataIds) {
        if (entities == null) {
            throw "entities is null.";
        }
        if (entities instanceof Map) {
            entities = Array.from(entities.values());
        }
        entities = Array.isArray(entities) ? entities : [entities];
        //创建执行生单流程参数对象
        /** @type {?} */
        const args = new FormBillCreationProcessExecutorArgs();
        args.billCreationProcessId = creationProcessId;
        args.creationRuleId = creationRuleId;
        //FormCreationRuleExecutorArgs的sourceVoEntityDatas属性为前端实体序列化后的字符串列表
        //sourceVoEntityDatas列表中的每个字符串，在结构上应与单据流定义中所选中的上游视图对象一致。
        args.sourceVoEntityDatas = entities.map((/**
         * @param {?} item
         * @return {?}
         */
        item => JSON.stringify(item.toJSON(false, true))));
        //下推过程中不存在目标主表单据Id，所以targetVoDataIds为空列表。
        args.targetVoDataIds = targetDataIds;
        return this.dataService.executeBillCreationProcess(args);
    }
    /**
     * 创建实体数据（RetrieveDefault至缓存）
     * @param {?} formVoId 表单绑定VO Id
     * @param {?} res 生单流程执行结果
     * @return {?} formCreateResult 创建实体数据返回结果 \@type { Observable<FormCreateResult> }
     */
    createEntityDatas(formVoId, res) {
        /** @type {?} */
        const args = new FormCreateArgs();
        args.formVoId = formVoId;
        //获取生单流程执行结果
        args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
        //创建实体数据
        return this.dataService.createEntityDatas(args);
    }
    /**
     * 更新实体数据
     * @param {?} res 生单流程执行结果
     * @return {?} formUpdateResult 更新实体数据返回结果 \@type { Observable<FormUpdateResult> }
     */
    updateEntityDatas(res) {
        /** @type {?} */
        const args = new FormUpdateArgs();
        //Mapping执行条件判断结果为true时才会执行生单流程得到生单结果
        if (res.conditionResult.conditionExecutionResult == true) {
            //生单结果不为空
            if (res.creationRuleExecutorResult && res.creationRuleExecutorResult.mappingResults && res.creationRuleExecutorResult.mappingResults.length > 0) {
                args.rpcCreationRuleExecutorResult = res.creationRuleExecutorResult.ConvertToJson();
                return this.dataService.updateEntityDatas(args);
            }
            else {
                return throwError("creationRuleExecutorResult is empty!");
            }
        }
        else {
            return throwError("conditionExecutionResult is false!");
        }
    }
}
BifManualCreationDataWebCmpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifManualCreationDataWebCmpService.ctorParameters = () => [
    { type: BifDataService },
    { type: BindingData },
    { type: MessagerService },
    { type: ViewModel, decorators: [{ type: Optional }] },
    { type: FrameContext, decorators: [{ type: Optional }] }
];
if (false) {
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.dataService;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.bindingData;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.messagerService;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.viewModel;
    /** @type {?} */
    BifManualCreationDataWebCmpService.prototype.frameContext;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLW1hbnVhbC1jcmVhdGlvbi1kYXRhLndlYmNtcC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvd2ViY21wL2JpZi1tYW51YWwtY3JlYXRpb24tZGF0YS53ZWJjbXAuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFBYyxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFOUMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3RELE9BQU8sRUFBVSxXQUFXLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzlFLE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBRTlHLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUNqRixPQUFPLEVBQUUsY0FBYyxFQUFzQyxjQUFjLEVBQUUsTUFBTSxRQUFRLENBQUM7Ozs7QUFNNUYsTUFBTSxPQUFPLGtDQUFrQzs7Ozs7Ozs7SUFDM0MsWUFDVyxXQUEyQixFQUMzQixXQUF3QixFQUN4QixlQUFnQyxFQUNwQixTQUFvQixFQUNwQixZQUEwQjtRQUp0QyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFDM0IsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ3BCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsaUJBQVksR0FBWixZQUFZLENBQWM7SUFHakQsQ0FBQzs7Ozs7O0lBT00sc0NBQXNDLENBQUMsU0FBaUI7UUFDM0QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLHNDQUFzQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlFLENBQUM7Ozs7OztJQU9NLG1CQUFtQixD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b3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSBcIkBmYXJyaXMvdWktbWVzc2FnZXJcIjtcclxuaW1wb3J0IHsgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcblxyXG5pbXBvcnQgeyBFbnRpdHksIEJpbmRpbmdEYXRhLCBWaWV3TW9kZWwsIEZyYW1lQ29udGV4dCB9IGZyb20gXCJAZmFycmlzL2RldmtpdFwiO1xyXG5cclxuaW1wb3J0IHsgSVJ0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeCwgRm9ybVNldHRpbmdzIH0gZnJvbSBcIkBlZHAtYmlmL2NvbW1vbi1hcGlcIjtcclxuaW1wb3J0IHsgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvckFyZ3MgfSBmcm9tICcuLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JBcmdzJztcclxuaW1wb3J0IHsgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCB9IGZyb20gJy4uL2VudGl0eS9mb3JtLXJlc3QvRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCc7XHJcbmltcG9ydCB7IEJpZkRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGb3JtQ3JlYXRlQXJncywgRm9ybUNyZWF0ZVJlc3VsdCwgRm9ybVVwZGF0ZVJlc3VsdCwgRm9ybVVwZGF0ZUFyZ3MgfSBmcm9tICcuLi9yZWYnO1xyXG5cclxuLyoqXHJcbiAqIOaJi+W3peeUn+WNleaVsOaNruacjeWKoeexu1xyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQmlmTWFudWFsQ3JlYXRpb25EYXRhV2ViQ21wU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgZGF0YVNlcnZpY2U6IEJpZkRhdGFTZXJ2aWNlLFxyXG4gICAgICAgIHB1YmxpYyBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEsXHJcbiAgICAgICAgcHVibGljIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHB1YmxpYyB2aWV3TW9kZWw6IFZpZXdNb2RlbCxcclxuICAgICAgICBAT3B0aW9uYWwoKSBwdWJsaWMgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQsXHJcbiAgICApIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7nlJ/ljZXmtYHnqItJZOafpeaJvuaMh+WumueahOeUn+WNlea1geeoi1xyXG4gICAgICogQHBhcmFtIHByb2Nlc3NJZCDljZXmja7mtYHnlJ/ljZXmtYHnqIsgSWRcclxuICAgICAqIEByZXR1cm5zIGNyZWF0aW9uUHJvY2VzcyDnlJ/ljZXmtYHnqIsgQHR5cGUgeyBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+IH1cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhCeUlkKHByb2Nlc3NJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UuZ2V0U2xpbUJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEJ5SWQocHJvY2Vzc0lkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOafpeivouihqOWNlemFjee9rlxyXG4gICAgICogQHBhcmFtIGZvcm1TZXR0aW5nc0lkIOihqOWNlemFjee9rklkXHJcbiAgICAgKiBAcmV0dXJucyBmb3JtU2V0dGluZ3Mg6KGo5Y2V6YWN572uIEB0eXBlIHsgT2JzZXJ2YWJsZTxGb3JtU2V0dGluZ3M+IH1cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldEZvcm1TZXR0aW5nc0J5SWQoZm9ybVNldHRpbmdzSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Rm9ybVNldHRpbmdzPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UuZ2V0Rm9ybVNldHRpbmdzQnlJZChmb3JtU2V0dGluZ3NJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmiafooYznlJ/ljZXmtYHnqItcclxuICAgICAqIEBwYXJhbSBlbnRpdGllcyDlj4LkuI7nlJ/ljZXnmoTmnaXmupDljZXmja7liJfooahcclxuICAgICAqIEBwYXJhbSBjcmVhdGlvblByb2Nlc3NJZCDljZXmja7mtYHnlJ/ljZXmtYHnqIsgSWRcclxuICAgICAqIEBwYXJhbSBjcmVhdGlvblJ1bGVJZCDnlJ/ljZXop4TliJlJZO+8iOeUn+WNlea1geeoi+WunuS9k+S4reiusOW9le+8iVxyXG4gICAgICogQHJldHVybnMgY3JlYXRpb25SZXN1bHQg55Sf5Y2V57uT5p6cIEB0eXBlIHsgT2JzZXJ2YWJsZTxGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0PiB9XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBleGVjdXRlQmlsbENyZWF0aW9uUHJvY2VzcyhlbnRpdGllczogRW50aXR5W10sIGNyZWF0aW9uUHJvY2Vzc0lkOiBzdHJpbmcsIGNyZWF0aW9uUnVsZUlkOiBzdHJpbmcsIHRhcmdldERhdGFJZHM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0PiB7XHJcbiAgICAgICAgaWYgKGVudGl0aWVzID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhyb3cgXCJlbnRpdGllcyBpcyBudWxsLlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW50aXRpZXMgaW5zdGFuY2VvZiBNYXApIHtcclxuICAgICAgICAgICAgZW50aXRpZXMgPSBBcnJheS5mcm9tKGVudGl0aWVzLnZhbHVlcygpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW50aXRpZXMgPSBBcnJheS5pc0FycmF5KGVudGl0aWVzKSA/IGVudGl0aWVzIDogW2VudGl0aWVzXTtcclxuICAgICAgICAvL+WIm+W7uuaJp+ihjOeUn+WNlea1geeoi+WPguaVsOWvueixoVxyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvckFyZ3MoKTtcclxuICAgICAgICBhcmdzLmJpbGxDcmVhdGlvblByb2Nlc3NJZCA9IGNyZWF0aW9uUHJvY2Vzc0lkO1xyXG4gICAgICAgIGFyZ3MuY3JlYXRpb25SdWxlSWQgPSBjcmVhdGlvblJ1bGVJZDtcclxuICAgICAgICAvL0Zvcm1DcmVhdGlvblJ1bGVFeGVjdXRvckFyZ3PnmoRzb3VyY2VWb0VudGl0eURhdGFz5bGe5oCn5Li65YmN56uv5a6e5L2T5bqP5YiX5YyW5ZCO55qE5a2X56ym5Liy5YiX6KGoXHJcbiAgICAgICAgLy9zb3VyY2VWb0VudGl0eURhdGFz5YiX6KGo5Lit55qE5q+P5Liq5a2X56ym5Liy77yM5Zyo57uT5p6E5LiK5bqU5LiO5Y2V5o2u5rWB5a6a5LmJ5Lit5omA6YCJ5Lit55qE5LiK5ri46KeG5Zu+5a+56LGh5LiA6Ie044CCXHJcbiAgICAgICAgYXJncy5zb3VyY2VWb0VudGl0eURhdGFzID0gZW50aXRpZXMubWFwKGl0ZW0gPT4gSlNPTi5zdHJpbmdpZnkoaXRlbS50b0pTT04oZmFsc2UsIHRydWUpKSk7XHJcbiAgICAgICAgLy/kuIvmjqjov4fnqIvkuK3kuI3lrZjlnKjnm67moIfkuLvooajljZXmja5JZO+8jOaJgOS7pXRhcmdldFZvRGF0YUlkc+S4uuepuuWIl+ihqOOAglxyXG4gICAgICAgIGFyZ3MudGFyZ2V0Vm9EYXRhSWRzID0gdGFyZ2V0RGF0YUlkcztcclxuICAgICAgICByZXR1cm4gdGhpcy5kYXRhU2VydmljZS5leGVjdXRlQmlsbENyZWF0aW9uUHJvY2VzcyhhcmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuWunuS9k+aVsOaNru+8iFJldHJpZXZlRGVmYXVsdOiHs+e8k+WtmO+8iVxyXG4gICAgICogQHBhcmFtIGZvcm1Wb0lkIOihqOWNlee7keWumlZPIElkXHJcbiAgICAgKiBAcGFyYW0gcmVzIOeUn+WNlea1geeoi+aJp+ihjOe7k+aenFxyXG4gICAgICogQHJldHVybnMgZm9ybUNyZWF0ZVJlc3VsdCDliJvlu7rlrp7kvZPmlbDmja7ov5Tlm57nu5PmnpwgQHR5cGUgeyBPYnNlcnZhYmxlPEZvcm1DcmVhdGVSZXN1bHQ+IH1cclxuICAgICAqL1xyXG4gICAgcHVibGljIGNyZWF0ZUVudGl0eURhdGFzKGZvcm1Wb0lkOiBzdHJpbmcsIHJlczogRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCk6IE9ic2VydmFibGU8Rm9ybUNyZWF0ZVJlc3VsdD4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybUNyZWF0ZUFyZ3MoKTtcclxuICAgICAgICBhcmdzLmZvcm1Wb0lkID0gZm9ybVZvSWQ7XHJcbiAgICAgICAgLy/ojrflj5bnlJ/ljZXmtYHnqIvmiafooYznu5PmnpxcclxuICAgICAgICBhcmdzLnJwY0NyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0ID0gcmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0LkNvbnZlcnRUb0pzb24oKTtcclxuICAgICAgICAvL+WIm+W7uuWunuS9k+aVsOaNrlxyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmNyZWF0ZUVudGl0eURhdGFzKGFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pu05paw5a6e5L2T5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gcmVzIOeUn+WNlea1geeoi+aJp+ihjOe7k+aenFxyXG4gICAgICogQHJldHVybnMgZm9ybVVwZGF0ZVJlc3VsdCDmm7TmlrDlrp7kvZPmlbDmja7ov5Tlm57nu5PmnpwgQHR5cGUgeyBPYnNlcnZhYmxlPEZvcm1VcGRhdGVSZXN1bHQ+IH1cclxuICAgICAqL1xyXG4gICAgcHVibGljIHVwZGF0ZUVudGl0eURhdGFzKHJlczogRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCk6IE9ic2VydmFibGU8Rm9ybVVwZGF0ZVJlc3VsdD4ge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgRm9ybVVwZGF0ZUFyZ3MoKTtcclxuICAgICAgICAvL01hcHBpbmfmiafooYzmnaHku7bliKTmlq3nu5PmnpzkuLp0cnVl5pe25omN5Lya5omn6KGM55Sf5Y2V5rWB56iL5b6X5Yiw55Sf5Y2V57uT5p6cXHJcbiAgICAgICAgaWYgKHJlcy5jb25kaXRpb25SZXN1bHQuY29uZGl0aW9uRXhlY3V0aW9uUmVzdWx0ID09IHRydWUpIHtcclxuICAgICAgICAgICAgLy/nlJ/ljZXnu5PmnpzkuI3kuLrnqbpcclxuICAgICAgICAgICAgaWYgKHJlcy5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdCAmJiByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQubWFwcGluZ1Jlc3VsdHMgJiYgcmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGFyZ3MucnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPSByZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuQ29udmVydFRvSnNvbigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNlcnZpY2UudXBkYXRlRW50aXR5RGF0YXMoYXJncyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihcImNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0IGlzIGVtcHR5IVwiKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoXCJjb25kaXRpb25FeGVjdXRpb25SZXN1bHQgaXMgZmFsc2UhXCIpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19