/**
 * @fileoverview added by tsickle
 * Generated from: lib/bif-manual-creation/service/bif-source-ui.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver, NgModuleFactoryLoader, Inject, LOCALE_ID, Optional } from '@angular/core';
import { AbstractUiService } from './abstract-ui-service';
import { NavigationService, RuntimeFrameworkService } from '@farris/command-services';
import { FrameContext } from '@farris/devkit';
import { BsModalService } from '@farris/ui-modal';
import { FormGetBillCreationProcessEntityExArgs } from '../../entity/form-rest/FormGetBillCreationProcessEntityExArgs';
import { PushSelectorComponent } from '../components/push-selector/push-selector.component';
import { RpcCreationRuleExecutorResult } from '../../ref';
import { BIF_UISTATE_KEY_CREATION_RESULT } from '../config/bif-form-constants';
import { FormBillCreationProcessExecutorResult } from '../../entity/form-rest/FormBillCreationProcessExecutorResult';
import { ManualCreationMode } from '../../entity/form-rest/ManualCreationMode';
import { MessagerService } from '@farris/ui-messager';
import { judgeBrowserType } from "../../utils/BrowserUtil";
export class BifSourceUiService extends AbstractUiService {
    /**
     * @param {?} navigationService
     * @param {?} frameContext
     * @param {?} modalService
     * @param {?} messager
     * @param {?} injector
     * @param {?} cfr
     * @param {?} loader
     * @param {?} localeId
     * @param {?} runtimeFrameworkService
     */
    constructor(navigationService, frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService) {
        super(frameContext, modalService, messager, injector, cfr, loader, localeId, runtimeFrameworkService);
        this.navigationService = navigationService;
        this.frameContext = frameContext;
        this.modalService = modalService;
        this.messager = messager;
        this.injector = injector;
        this.cfr = cfr;
        this.loader = loader;
        this.localeId = localeId;
        this.uiStateKeyCreationResult = BIF_UISTATE_KEY_CREATION_RESULT;
    }
    /**
     * 下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4Push(upBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.manualCreationMode = ManualCreationMode.Push;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 特定下推时打开生单规则选择器
     * @param {?} upBillVoId
     * @param {?} downBillVoId
     * @param {?=} bizFlowchartId
     * @param {?=} modalOptions
     * @param {?=} customSelectorModuleUrl
     * @param {?=} extParams
     * @return {?}
     */
    openBillCreationProcessSelector4SpecificPush(upBillVoId, downBillVoId, bizFlowchartId, modalOptions, customSelectorModuleUrl, extParams) {
        /** @type {?} */
        const args = new FormGetBillCreationProcessEntityExArgs();
        args.upBillVoId = upBillVoId;
        args.downBillVoId = downBillVoId;
        args.manualCreationMode = ManualCreationMode.SpecificPush;
        // args.bizFlowchartId = bizFlowchartId;
        return this.openBillCreationProcessSelector(args, PushSelectorComponent, modalOptions, customSelectorModuleUrl, extParams);
    }
    /**
     * 打开下游单据制单界面
     * @param {?} formSettings
     * @param {?} creationResult
     * @param {?=} extParams
     * @return {?}
     */
    openTargetForm(formSettings, creationResult, extParams) {
        if (formSettings == null) {
            throw "参数formSettings不可为空";
        }
        if (creationResult == null) {
            throw "参数creationResult不可为空";
        }
        if (typeof creationResult == "string") {
            if (creationResult == "") {
                throw "参数creationResult不可为空";
            }
            /** @type {?} */
            const temp = new FormBillCreationProcessExecutorResult();
            temp.LoadFromJson(creationResult);
            creationResult = temp;
        }
        if ((creationResult instanceof FormBillCreationProcessExecutorResult) == false) {
            /** @type {?} */
            const res = new FormBillCreationProcessExecutorResult();
            res.LoadFromJsonObject(creationResult);
            creationResult = res;
        }
        if (creationResult.conditionResult.conditionExecutionResult == false) {
            this.messager.error(creationResult.conditionResult.message || this.localePipe.transform("creationExecutionError"));
            return;
        }
        if (creationResult.creationRuleExecutorResult == null || creationResult.creationRuleExecutorResult.mappingResults == null || creationResult.creationRuleExecutorResult.mappingResults.length == 0) {
            this.messager.error(this.localePipe.transform("creationResultEmpty"));
            return;
        }
        else if (creationResult.creationRuleExecutorResult.mappingResults.length == 1) {
            //只有一条数据则打开卡片
            this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, creationResult, extParams, false);
        }
        else {
            if (formSettings.targetListAppId != null) {
                // 多条数据且配置批量编辑界面
                throw "暂不支持打开批量编辑界面";
                this.openApp(creationResult.creationRuleExecutorResult.mappingResults[0].associations[0].tarDataId, formSettings.targetListAppId, formSettings.targetListAppEntrance, creationResult, extParams, false);
            }
            else {
                //有多条数据但未配置批量编辑界面则打开多个卡片
                for (let mappingResult of creationResult.creationRuleExecutorResult.mappingResults) {
                    /** @type {?} */
                    let singleRes = new FormBillCreationProcessExecutorResult();
                    singleRes.conditionResult = creationResult.conditionResult;
                    singleRes.creationRuleExecutorResult = new RpcCreationRuleExecutorResult();
                    singleRes.creationRuleExecutorResult.bizFlowchartId = creationResult.creationRuleExecutorResult.bizFlowchartId;
                    singleRes.creationRuleExecutorResult.creationRuleId = creationResult.creationRuleExecutorResult.creationRuleId;
                    singleRes.creationRuleExecutorResult.creationRuleInstanceId = creationResult.creationRuleExecutorResult.creationRuleInstanceId;
                    singleRes.creationRuleExecutorResult.mappingResults = [mappingResult];
                    this.openApp(mappingResult.associations[0].tarDataId, formSettings.targetCardAppId, formSettings.targetCardAppEntrance, singleRes, extParams, false);
                }
            }
        }
    }
    /**
     * @private
     * @param {?} tabId
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} creationResult
     * @param {?=} extParams
     * @param {?=} reload
     * @param {?=} tabName
     * @param {?=} enableRefresh
     * @param {?=} destructuring
     * @return {?}
     */
    openApp(tabId, appId, appEntrance, creationResult, extParams, reload, tabName, enableRefresh, destructuring) {
        extParams == null ? {} : extParams;
        /** @type {?} */
        const browser = judgeBrowserType();
        if (browser.type == "IE" && browser.IEVersion == "IE11") {
            //IE11浏览器将生成结果转换为字符串存在top.localStorage，Id为tabId
            // console.log(tabId);
            window.top.localStorage.setItem(tabId, creationResult.ConvertToJson());
            this.navigationService.openApp(tabId, appId, appEntrance, extParams, reload, tabName, enableRefresh, destructuring);
        }
        else {
            this.navigationService.openApp(tabId, appId, appEntrance, this.buildRouteParams(creationResult, extParams), reload, tabName, enableRefresh, destructuring);
        }
    }
    /**
     *
     * @private
     * @param {?} creationResult
     * @param {?} extParams
     * @return {?}
     */
    buildRouteParams(creationResult, extParams) {
        /** @type {?} */
        const params = extParams;
        params[this.uiStateKeyCreationResult] = creationResult.ConvertToJson();
        return params;
    }
}
BifSourceUiService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BifSourceUiService.ctorParameters = () => [
    { type: NavigationService },
    { type: FrameContext },
    { type: BsModalService },
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: NgModuleFactoryLoader },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: RuntimeFrameworkService, decorators: [{ type: Optional }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    BifSourceUiService.prototype.uiStateKeyCreationResult;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.navigationService;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.frameContext;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.cfr;
    /**
     * @type {?}
     * @protected
     */
    BifSourceUiService.prototype.loader;
    /** @type {?} */
    BifSourceUiService.prototype.localeId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlmLXNvdXJjZS11aS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVkcC1iaWYvcnVudGltZS1hcGkvIiwic291cmNlcyI6WyJsaWIvYmlmLW1hbnVhbC1jcmVhdGlvbi9zZXJ2aWNlL2JpZi1zb3VyY2UtdWkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLHFCQUFxQixFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25JLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsY0FBYyxFQUFnQixNQUFNLGtCQUFrQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLCtEQUErRCxDQUFDO0FBRXZILE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRTVGLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUMxRCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMvRSxPQUFPLEVBQUUscUNBQXFDLEVBQUUsTUFBTSw4REFBOEQsQ0FBQztBQUNySCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seUJBQXlCLENBQUE7QUFHMUQsTUFBTSxPQUFPLGtCQUFtQixTQUFRLGlCQUFpQjs7Ozs7Ozs7Ozs7O0lBR3JELFlBQ2MsaUJBQW9D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b21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE5nTW9kdWxlRmFjdG9yeUxvYWRlciwgSW5qZWN0LCBMT0NBTEVfSUQsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFic3RyYWN0VWlTZXJ2aWNlIH0gZnJvbSAnLi9hYnN0cmFjdC11aS1zZXJ2aWNlJztcclxuaW1wb3J0IHsgTmF2aWdhdGlvblNlcnZpY2UsIFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXggfSBmcm9tICdAZWRwLWJpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgRm9ybUdldEJpbGxDcmVhdGlvblByb2Nlc3NFbnRpdHlFeEFyZ3MgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBQdXNoU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL3B1c2gtc2VsZWN0b3IvcHVzaC1zZWxlY3Rvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBGb3JtU2V0dGluZ3MgfSBmcm9tICdAZWRwLWFpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgUnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgfSBmcm9tICcuLi8uLi9yZWYnO1xyXG5pbXBvcnQgeyBCSUZfVUlTVEFURV9LRVlfQ1JFQVRJT05fUkVTVUxUIH0gZnJvbSAnLi4vY29uZmlnL2JpZi1mb3JtLWNvbnN0YW50cyc7XHJcbmltcG9ydCB7IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L0Zvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQnO1xyXG5pbXBvcnQgeyBNYW51YWxDcmVhdGlvbk1vZGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvZm9ybS1yZXN0L01hbnVhbENyZWF0aW9uTW9kZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBqdWRnZUJyb3dzZXJUeXBlIH0gZnJvbSBcIi4uLy4uL3V0aWxzL0Jyb3dzZXJVdGlsXCJcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEJpZlNvdXJjZVVpU2VydmljZSBleHRlbmRzIEFic3RyYWN0VWlTZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgdWlTdGF0ZUtleUNyZWF0aW9uUmVzdWx0ID0gQklGX1VJU1RBVEVfS0VZX0NSRUFUSU9OX1JFU1VMVDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcm90ZWN0ZWQgbmF2aWdhdGlvblNlcnZpY2U6IE5hdmlnYXRpb25TZXJ2aWNlLFxyXG4gICAgICAgIHByb3RlY3RlZCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICAgICAgICBwcm90ZWN0ZWQgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByb3RlY3RlZCBjZnI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICBwcm90ZWN0ZWQgbG9hZGVyOiBOZ01vZHVsZUZhY3RvcnlMb2FkZXIsXHJcbiAgICAgICAgQEluamVjdChMT0NBTEVfSUQpIHB1YmxpYyBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlOiBSdW50aW1lRnJhbWV3b3JrU2VydmljZSxcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKGZyYW1lQ29udGV4dCwgbW9kYWxTZXJ2aWNlLCBtZXNzYWdlciwgaW5qZWN0b3IsIGNmciwgbG9hZGVyLCBsb2NhbGVJZCwgcnVudGltZUZyYW1ld29ya1NlcnZpY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5LiL5o6o5pe25omT5byA55Sf5Y2V6KeE5YiZ6YCJ5oup5ZmoXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuQmlsbENyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yNFB1c2godXBCaWxsVm9JZDogc3RyaW5nLCBiaXpGbG93Y2hhcnRJZD86IHN0cmluZywgbW9kYWxPcHRpb25zPzogTW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybD86IHN0cmluZywgZXh0UGFyYW1zPzoge30pOiBPYnNlcnZhYmxlPElSdFNsaW1CaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXg+IHtcclxuICAgICAgICBjb25zdCBhcmdzID0gbmV3IEZvcm1HZXRCaWxsQ3JlYXRpb25Qcm9jZXNzRW50aXR5RXhBcmdzKCk7XHJcbiAgICAgICAgYXJncy51cEJpbGxWb0lkID0gdXBCaWxsVm9JZDtcclxuICAgICAgICBhcmdzLm1hbnVhbENyZWF0aW9uTW9kZSA9IE1hbnVhbENyZWF0aW9uTW9kZS5QdXNoO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5vcGVuQmlsbENyZWF0aW9uUHJvY2Vzc1NlbGVjdG9yKGFyZ3MsIFB1c2hTZWxlY3RvckNvbXBvbmVudCwgbW9kYWxPcHRpb25zLCBjdXN0b21TZWxlY3Rvck1vZHVsZVVybCwgZXh0UGFyYW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeJueWumuS4i+aOqOaXtuaJk+W8gOeUn+WNleinhOWImemAieaLqeWZqFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcjRTcGVjaWZpY1B1c2godXBCaWxsVm9JZDogc3RyaW5nLCBkb3duQmlsbFZvSWQ6IHN0cmluZywgYml6Rmxvd2NoYXJ0SWQ/OiBzdHJpbmcsIG1vZGFsT3B0aW9ucz86IE1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmw/OiBzdHJpbmcsIGV4dFBhcmFtcz86IHt9KTogT2JzZXJ2YWJsZTxJUnRTbGltQmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4PiB7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBGb3JtR2V0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eUV4QXJncygpO1xyXG4gICAgICAgIGFyZ3MudXBCaWxsVm9JZCA9IHVwQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5kb3duQmlsbFZvSWQgPSBkb3duQmlsbFZvSWQ7XHJcbiAgICAgICAgYXJncy5tYW51YWxDcmVhdGlvbk1vZGUgPSBNYW51YWxDcmVhdGlvbk1vZGUuU3BlY2lmaWNQdXNoO1xyXG4gICAgICAgIC8vIGFyZ3MuYml6Rmxvd2NoYXJ0SWQgPSBiaXpGbG93Y2hhcnRJZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlbkJpbGxDcmVhdGlvblByb2Nlc3NTZWxlY3RvcihhcmdzLCBQdXNoU2VsZWN0b3JDb21wb25lbnQsIG1vZGFsT3B0aW9ucywgY3VzdG9tU2VsZWN0b3JNb2R1bGVVcmwsIGV4dFBhcmFtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmiZPlvIDkuIvmuLjljZXmja7liLbljZXnlYzpnaJcclxuICAgICAqIEBwYXJhbSBmb3JtU2V0dGluZ3MgXHJcbiAgICAgKiBAcGFyYW0gY3JlYXRpb25SZXN1bHQgXHJcbiAgICAgKiBAcGFyYW0gZXh0UGFyYW1zIFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlblRhcmdldEZvcm0oZm9ybVNldHRpbmdzOiBGb3JtU2V0dGluZ3MsIGNyZWF0aW9uUmVzdWx0OiBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0LCBleHRQYXJhbXM/OiB7fSk6IHZvaWQge1xyXG4gICAgICAgIGlmIChmb3JtU2V0dGluZ3MgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGZvcm1TZXR0aW5nc+S4jeWPr+S4uuepulwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIuWPguaVsGNyZWF0aW9uUmVzdWx05LiN5Y+v5Li656m6XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgY3JlYXRpb25SZXN1bHQgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgXCLlj4LmlbBjcmVhdGlvblJlc3VsdOS4jeWPr+S4uuepulwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRlbXAgPSBuZXcgRm9ybUJpbGxDcmVhdGlvblByb2Nlc3NFeGVjdXRvclJlc3VsdCgpO1xyXG4gICAgICAgICAgICB0ZW1wLkxvYWRGcm9tSnNvbihjcmVhdGlvblJlc3VsdCk7XHJcbiAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0ID0gdGVtcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChjcmVhdGlvblJlc3VsdCBpbnN0YW5jZW9mIEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgICAgIHJlcy5Mb2FkRnJvbUpzb25PYmplY3QoY3JlYXRpb25SZXN1bHQpO1xyXG4gICAgICAgICAgICBjcmVhdGlvblJlc3VsdCA9IHJlcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjcmVhdGlvblJlc3VsdC5jb25kaXRpb25SZXN1bHQuY29uZGl0aW9uRXhlY3V0aW9uUmVzdWx0ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuZXJyb3IoY3JlYXRpb25SZXN1bHQuY29uZGl0aW9uUmVzdWx0Lm1lc3NhZ2UgfHwgdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNyZWF0aW9uRXhlY3V0aW9uRXJyb3JcIikpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY3JlYXRpb25SZXN1bHQuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPT0gbnVsbCB8fCBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cyA9PSBudWxsIHx8IGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXIuZXJyb3IodGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNyZWF0aW9uUmVzdWx0RW1wdHlcIikpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIGlmIChjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0cy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAvL+WPquacieS4gOadoeaVsOaNruWImeaJk+W8gOWNoeeJh1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5tYXBwaW5nUmVzdWx0c1swXS5hc3NvY2lhdGlvbnNbMF0udGFyRGF0YUlkLFxyXG4gICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBJZCxcclxuICAgICAgICAgICAgICAgIGZvcm1TZXR0aW5ncy50YXJnZXRDYXJkQXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICBjcmVhdGlvblJlc3VsdCxcclxuICAgICAgICAgICAgICAgIGV4dFBhcmFtcyxcclxuICAgICAgICAgICAgICAgIGZhbHNlXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGZvcm1TZXR0aW5ncy50YXJnZXRMaXN0QXBwSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5aSa5p2h5pWw5o2u5LiU6YWN572u5om56YeP57yW6L6R55WM6Z2iXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIuaaguS4jeaUr+aMgeaJk+W8gOaJuemHj+e8lui+keeVjOmdolwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuQXBwKFxyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzWzBdLmFzc29jaWF0aW9uc1swXS50YXJEYXRhSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldExpc3RBcHBJZCxcclxuICAgICAgICAgICAgICAgICAgICBmb3JtU2V0dGluZ3MudGFyZ2V0TGlzdEFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uUmVzdWx0LFxyXG4gICAgICAgICAgICAgICAgICAgIGV4dFBhcmFtcyxcclxuICAgICAgICAgICAgICAgICAgICBmYWxzZVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8v5pyJ5aSa5p2h5pWw5o2u5L2G5pyq6YWN572u5om56YeP57yW6L6R55WM6Z2i5YiZ5omT5byA5aSa5Liq5Y2h54mHXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBtYXBwaW5nUmVzdWx0IG9mIGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNpbmdsZVJlcyA9IG5ldyBGb3JtQmlsbENyZWF0aW9uUHJvY2Vzc0V4ZWN1dG9yUmVzdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNvbmRpdGlvblJlc3VsdCA9IGNyZWF0aW9uUmVzdWx0LmNvbmRpdGlvblJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQgPSBuZXcgUnBjQ3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuYml6Rmxvd2NoYXJ0SWQgPSBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5iaXpGbG93Y2hhcnRJZDtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuY3JlYXRpb25SdWxlSWQgPSBjcmVhdGlvblJlc3VsdC5jcmVhdGlvblJ1bGVFeGVjdXRvclJlc3VsdC5jcmVhdGlvblJ1bGVJZDtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXMuY3JlYXRpb25SdWxlRXhlY3V0b3JSZXN1bHQuY3JlYXRpb25SdWxlSW5zdGFuY2VJZCA9IGNyZWF0aW9uUmVzdWx0LmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0LmNyZWF0aW9uUnVsZUluc3RhbmNlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLmNyZWF0aW9uUnVsZUV4ZWN1dG9yUmVzdWx0Lm1hcHBpbmdSZXN1bHRzID0gW21hcHBpbmdSZXN1bHRdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmdSZXN1bHQuYXNzb2NpYXRpb25zWzBdLnRhckRhdGFJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybVNldHRpbmdzLnRhcmdldENhcmRBcHBFbnRyYW5jZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRQYXJhbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9wZW5BcHAodGFiSWQ6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgY3JlYXRpb25SZXN1bHQ6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQsIGV4dFBhcmFtcz86IHt9LCByZWxvYWQ/OiBib29sZWFuLCB0YWJOYW1lPzogc3RyaW5nLCBlbmFibGVSZWZyZXNoPzogYW55LCBkZXN0cnVjdHVyaW5nPzogYW55KTogdm9pZCB7XHJcbiAgICAgICAgZXh0UGFyYW1zID09IG51bGwgPyB7fSA6IGV4dFBhcmFtcztcclxuICAgICAgICBjb25zdCBicm93c2VyID0ganVkZ2VCcm93c2VyVHlwZSgpO1xyXG4gICAgICAgIGlmIChicm93c2VyLnR5cGUgPT0gXCJJRVwiICYmIGJyb3dzZXIuSUVWZXJzaW9uID09IFwiSUUxMVwiKSB7XHJcbiAgICAgICAgICAgIC8vSUUxMea1j+iniOWZqOWwhueUn+aIkOe7k+aenOi9rOaNouS4uuWtl+espuS4suWtmOWcqHRvcC5sb2NhbFN0b3JhZ2XvvIxJZOS4unRhYklkXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRhYklkKTtcclxuICAgICAgICAgICAgd2luZG93LnRvcC5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0YWJJZCwgY3JlYXRpb25SZXN1bHQuQ29udmVydFRvSnNvbigpKTtcclxuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZS5vcGVuQXBwKFxyXG4gICAgICAgICAgICAgICAgdGFiSWQsIGFwcElkLCBhcHBFbnRyYW5jZSwgZXh0UGFyYW1zLCByZWxvYWQsIHRhYk5hbWUsIGVuYWJsZVJlZnJlc2gsIGRlc3RydWN0dXJpbmdcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLm9wZW5BcHAoXHJcbiAgICAgICAgICAgICAgICB0YWJJZCwgYXBwSWQsIGFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZFJvdXRlUGFyYW1zKGNyZWF0aW9uUmVzdWx0LCBleHRQYXJhbXMpLFxyXG4gICAgICAgICAgICAgICAgcmVsb2FkLCB0YWJOYW1lLCBlbmFibGVSZWZyZXNoLCBkZXN0cnVjdHVyaW5nXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gYWN0aW9uIOebruagh0FwcOWKqOS9nFxyXG4gICAgICogQHBhcmFtIHBhaXJzIOWFtuS7luWunuS9k+WPguaVsOmUruWAvOWvuVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGJ1aWxkUm91dGVQYXJhbXMoY3JlYXRpb25SZXN1bHQ6IEZvcm1CaWxsQ3JlYXRpb25Qcm9jZXNzRXhlY3V0b3JSZXN1bHQsIGV4dFBhcmFtczoge30pOiB7fSB7XHJcbiAgICAgICAgY29uc3QgcGFyYW1zID0gZXh0UGFyYW1zO1xyXG4gICAgICAgIHBhcmFtc1t0aGlzLnVpU3RhdGVLZXlDcmVhdGlvblJlc3VsdF0gPSBjcmVhdGlvblJlc3VsdC5Db252ZXJ0VG9Kc29uKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBwYXJhbXM7XHJcbiAgICB9XHJcbn0iXX0=