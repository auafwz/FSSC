!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-shortcuts"),require("@farris/ui-common/types"),require("lodash-es"),require("rxjs"),require("@angular/platform-browser"),require("@angular/common"),require("@angular/forms"),require("@farris/ui-common"),require("@farris/ui-layout"),require("@farris/ui-dialog"),require("@farris/ui-messager"),require("@farris/ui-datatable"),require("@farris/ui-treetable"),require("@farris/ui-loading"),require("@angular/animations"),require("@angular/core"),require("@farris/ui-input-group"),require("rxjs/operators"),require("@farris/ui-locale"),require("@farris/ui-notify")):"function"==typeof define&&define.amd?define("@farris/ui-lookup",["exports","@farris/ui-shortcuts","@farris/ui-common/types","lodash-es","rxjs","@angular/platform-browser","@angular/common","@angular/forms","@farris/ui-common","@farris/ui-layout","@farris/ui-dialog","@farris/ui-messager","@farris/ui-datatable","@farris/ui-treetable","@farris/ui-loading","@angular/animations","@angular/core","@farris/ui-input-group","rxjs/operators","@farris/ui-locale","@farris/ui-notify"],t):t((e.farris=e.farris||{},e.farris["ui-lookup"]={}),e.uiShortcuts,e.types,e.lodashEs,e.rxjs,e.ng.platformBrowser,e.ng.common,e.ng.forms,e.uiCommon,e.uiLayout,e.uiDialog,e.uiMessager,e.uiDatatable,e.uiTreetable,e.uiLoading,e.ng.animations,e.ng.core,e.uiInputGroup,e.rxjs.operators,e.uiLocale,e.uiNotify)}(this,function(e,t,h,f,u,d,i,n,g,s,a,o,r,l,c,p,v,m,y,b,C){"use strict";var S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var I=function(){return(I=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function T(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,s,a=i.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=a.next()).done;)o.push(n.value)}catch(r){s={error:r}}finally{try{n&&!n.done&&(i=a["return"])&&i.call(a)}finally{if(s)throw s.error}}return o}function k(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(T(arguments[t]));return e}var x="__favorite__",D={List:"LIST",TreeList:"TREELIST",NavList:"NAVLIST",NavTreeList:"NAVTREELIST"},F='<span class="f-icon f-icon-star f-lookup-favorite" style="line-height: 29px;"></span>',w='<span class="f-icon f-icon-star-outline f-lookup-favorite" style="line-height: 29px;"></span>',O='<span class="f-icon f-icon-apply-format f-lookup-unfavorite" style="line-height: 29px;"></span>',R='<span class="f-icon f-icon-apply-format f-lookup-unfavorite" style="line-height: 29px;"></span>',E="append item to favorite.",L="remove favorite.",M={provide:n.NG_VALUE_ACCESSOR,useExisting:v.forwardRef(function(){return P}),multi:!0},P=(Object.defineProperty(N.prototype,"content",{set:function(e){(this.dialog=e)&&this.dialogCreated.next(this.dialog)},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"isShow",{get:function(){return this._isShow},set:function(e){this._isShow=e,this.changeDetector.destroyed||this.changeDetector.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(N.prototype,"invalid",{get:function(){return this.ngControl.valid},enumerable:!0,configurable:!0}),N.prototype.ngOnInit=function(){this.initEvents(),this.ngControl=this.injector.get(n.NgControl,null)},N.prototype.ngOnDestroy=function(){this.lookupUnsubscribe()},N.prototype.ngAfterViewChecked=function(){var e=this;this.dialog&&this.dialog.closed.subscribe(function(){e.isShow=!1,e.dialog=null})},N.prototype.initEvents=function(){this.dictPicking||(this.dictPicking=function(){return u.of({showDialog:!0})}),this.dictPicked||(this.dictPicked=function(){return u.of({closeDialog:!0})}),this.beforeOpen||(this.beforeOpen=function(){return u.of(!0)}),this.beforeClose||(this.beforeClose=function(){return u.of(!0)}),this.dialogHeight||(this.dialogHeight=this.defaultDialogSize.height),this.dialogWidth||(this.dialogWidth=this.defaultDialogSize.width)},N.prototype.showDialog=function(){var t=this;return this.disabled||this.readonly||this.dictPicking().subscribe(function(e){!1!==e.showDialog&&(t.isShow=!0,t.ngZone.runOutsideAngular(function(){setTimeout(function(){return t.dialog.show()})}))}),!1},N.prototype.closeDialog=function(){this.isShow=!1,this.dialog&&this.dialog.close()},N.prototype.lookupUnsubscribe=function(){this.dictPickedSubscription&&this.dictPickedSubscription.unsubscribe(),this.dictPickingSubscription&&this.dictPickingSubscription.unsubscribe(),this.dialogCreatedSubscription&&this.dialogCreatedSubscription.unsubscribe()},N.prototype.onResizing=function(e){this.resizing.emit(e.size)},N.prototype.onResized=function(e){this.resized.emit(e.size)},N.prototype.onMaxDialog=function(e){this.dialogMaxed.emit(e.size)},N.prototype.writeValue=function(e){e?(this.displayText=e,this.displayValue=e,this.originalText=this.displayText):(this.displayText="",this.displayValue="",this.originalText="")},N.prototype.registerOnChange=function(e){this.onModelChange=e},N.prototype.registerOnTouched=function(e){this.onModelTouched=e},N.prototype.setDisabledState=function(e){this.disabled=e},N.decorators=[{type:v.Component,args:[{selector:"farris-lookup",template:'\n        <div\n            class="lookupbox input-group"\n            [ngClass]="{\n                \'f-state-disabled\': disabled,\n                \'f-state-readonly\': readonly,\n                \'f-state-editable\': !editable\n            }"\n        >\n            <input\n                class="form-control"\n                [value]="displayText"\n                [disabled]="disabled"\n                [readonly]="!editable || readonly"\n            />\n            <div class="input-group-append">\n                <span class="f-select input-group-text" (click)="showDialog()">\n                    <i class="f-icon f-icon-lookup"></i>\n                </span>\n            </div>\n        </div>\n        <farris-dialog\n            #dialog\n            *ngIf="isShow"\n            [title]="title"\n            [beforeOpen]="beforeOpen"\n            [beforeClose]="beforeClose"\n            [width]="dialogWidth"\n            [height]="dialogHeight"\n            [showButtons]="showButtons"\n            [showMaxButton]="showMaxButton"\n            [buttons]="buttonsRef || defaultButtonRef"\n            [buttonAlign]="buttonAlign"\n            (maxed)="onMaxDialog($event)"\n            (resized)="onResized($event)"\n            (resizing)="onResizing($event)"\n        >\n            <ng-content></ng-content>\n\n            <ng-template #defaultButtonRef>\n                <div style="width: 100%;">\n                    <button class="btn btn-primary btn-lg">Ok</button>\n                    <button\n                        class="btn btn-secondary btn-lg"\n                        (click)="closeDialog()"\n                    >\n                        Cancel\n                    </button>\n                </div>\n            </ng-template>\n        </farris-dialog>\n    ',providers:[M],styles:["\n            .input-group {\n                flex-wrap: nowrap;\n            }\n            :host-context(.ng-invalid) .form-control {\n                border-color: #ff0303;\n            }\n        "]}]}],N.ctorParameters=function(){return[{type:v.Injector},{type:v.ElementRef},{type:v.ChangeDetectorRef}]},N.propDecorators={hostCls:[{type:v.HostBinding,args:["class"]}],dialogWidth:[{type:v.Input}],dialogHeight:[{type:v.Input}],title:[{type:v.Input}],buttonAlign:[{type:v.Input}],buttonsRef:[{type:v.Input}],showButtons:[{type:v.Input}],showCloseButton:[{type:v.Input}],showMaxButton:[{type:v.Input}],resizable:[{type:v.Input}],draggable:[{type:v.Input}],disabled:[{type:v.Input}],editable:[{type:v.Input}],readonly:[{type:v.Input}],mapFields:[{type:v.Input}],valueField:[{type:v.Input}],textField:[{type:v.Input}],displayText:[{type:v.Input}],context:[{type:v.Input}],beforeOpen:[{type:v.Input}],beforeClose:[{type:v.Input}],dictPicking:[{type:v.Input}],dictPicked:[{type:v.Input}],dialogOpened:[{type:v.Output}],dialogClosed:[{type:v.Output}],dialogMaxed:[{type:v.Output}],resizing:[{type:v.Output}],resized:[{type:v.Output}],content:[{type:v.ViewChild,args:["dialog"]}]},N);function N(e,t,i){this.injector=e,this.el=t,this.changeDetector=i,this.hostCls="f-cmp-inputgroup",this.title="",this.buttonAlign="right",this.showButtons=!0,this.showCloseButton=!0,this.showMaxButton=!0,this.resizable=!0,this.draggable=!0,this.disabled=!1,this.editable=!0,this.readonly=!1,this.displayText="",this.dialogOpened=new v.EventEmitter,this.dialogClosed=new v.EventEmitter,this.dialogMaxed=new v.EventEmitter,this.resizing=new v.EventEmitter,this.resized=new v.EventEmitter,this.defaultDialogSize={width:550,height:570},this.dialogCreated=new u.Subject,this._isShow=!1,this.displayValue="",this.originalText="",this.onModelChange=function(e){},this.onModelTouched=function(e){},this.ngZone=this.injector.get(v.NgZone)}var z=function we(){},V={singleSelect:!0,showFilterBar:!0,pagination:!0,pageIndex:1,pageSize:10,pageList:[10,20,30,50,100]},_={title:"此处显示标题",favorites:"收藏夹",okText:"确定",cancelText:"取消",allColumns:"所有列"},A=new v.InjectionToken("Lookup Grid HTTP service"),j=(H.decorators=[{type:v.Injectable}],H.ctorParameters=function(){return[{type:g.CommonUtils}]},H);function H(e){var a=this;this.utils=e,this.lookupFieldMap=function(e,n,s){n&&Object.keys(n).forEach(function(t){var i="";e&&(i=e instanceof Array?e.map(function(e){return a.utils.getValue(t,e)}).join(","):a.utils.getValue(t,e)),n[t].split(",").forEach(function(e){var t=f.trim(e);a.utils.setValue(s,t,i)})})}}var B=(U.prototype.setActiveLookupInstance=function(e){this.rts&&this.rts.setLookupInstance(e)},U.prototype.pendingStart=function(){this.rts&&(this.rts.updateFormState({lookup:{pending:!0}}),document.body.style["pointer-events"]="none")},U.prototype.pendingEnd=function(){this.rts&&(this.rts.updateFormState({lookup:{pending:!1}}),document.body.style["pointer-events"]="")},U.prototype.createFilterCondition=function(e,t){return{filterField:e,value:t,lbracket:"",rbracket:"",relation:h.FilterRelation.Or,compare:h.Compare.Like}},U.prototype.mergeCondition=function(e,t,i){var n=this;e=e?f.cloneDeep(e):{pagination:{pageIndex:1,pageSize:20},filterConditions:[],sortConditions:[]};var s=I({},i),a=s.field,o=void 0===a?"*":a,r=s.value,l=void 0===r?"":r;if(l)if("*"===o){if(t&&t.length){var c=t.map(function(e){return n.createFilterCondition(e,l)});if(c.length){c[0].lbracket="(";var p=c[c.length-1];p.rbracket=")",p.relation=h.FilterRelation.Empty}e.filterConditions&&e.filterConditions.length?(e.filterConditions[e.filterConditions.length-1].relation=h.FilterRelation.And,e.filterConditions=e.filterConditions.concat(c)):e.filterConditions=c}}else{var d=this.createFilterCondition(o,l);d.relation=h.FilterRelation.Empty,e.filterConditions&&e.filterConditions.length?(e.filterConditions[e.filterConditions.length-1].relation=h.FilterRelation.And,e.filterConditions.push(d)):e.filterConditions=[d]}return e},U.prototype.canSelectable=function(e){return!e.hasOwnProperty("farris_selectable")||!!e.farris_selectable},U.prototype.makeTreeWithParentID=function(e,a,o,r){var l=this;void 0===o&&(o="parentId"),void 0===r&&(r="id");var c=new Map,p=[],d=[];return e.forEach(function(e){var t={data:e,children:[],selectable:l.canSelectable(e),parent:null,parents:[]},i=e[r];c.set(i,t);var n=l.utils.getValue(o,e);if(n===a)p.push(t);else{var s=c.get(n);s?(t.parent=n,t.parents=k(s.parents,[n]),s.children.push(t)):d.push(t)}}),d.forEach(function(e){var t=l.utils.getValue(o,e.data),i=c.get(t);i&&(e.parent=t,e.parents=k(i.parents,[t]),i.children.push(e))}),p},U.prototype.makeTree=function(e,t){var a=this,o=t.dataField,r=t.layerField,l=t.pathField,c=new Map,p=[],d=[];return e.forEach(function(e){var t={data:e,children:[],selectable:a.canSelectable(e)},i=e[o][l];if(c.set(i,t),1===e[o][r])p.push(t);else{var n=i.substr(0,i.length-4),s=c.get(n);s?s.children.push(t):d.push(t)}}),d.forEach(function(e){var t=e.data[o][l],i=c.get(t.substr(0,t.length-4));i&&i.children.push(e)}),p},U.decorators=[{type:v.Injectable}],U.ctorParameters=function(){return[{type:g.CommonUtils},{type:g.RuntimeStateService},{type:v.NgZone}]},U);function U(e,t,i){this.utils=e,this.rts=t,this.ngZone=i}var W=(Object.defineProperty(G.prototype,"personalConfigKey",{get:function(){return this._key},set:function(e){e?(this._key=this.buildKey(e),this.controlID?this._newKey=this.buildKey(this.controlID+"_"+e):this._newKey=this._key):this._newKey=this.buildKey(this.controlID)},enumerable:!0,configurable:!0}),G.prototype.buildKey=function(e){var t,i="";return i=location.hash?(t=location.hash.split("?"))?t[0]:"":(t=location.pathname.split("/"))?t[t.length-1]:"",this.idService.encrypt(i+e)},G.prototype.initPersonalConf=function(e){Object.assign(this,e)},G.prototype.getPersonalData=function(e){if(e&&(this._key=e),this.personalConfigKey){var t=localStorage.getItem(this.personalConfigKey);return t&&"undefined"!==t&&"null"!==t?(this.personalConf=t?JSON.parse(t):{},this._updatePersonalConfig(this.personalConf),this.controlID&&(this._key!==this._newKey&&localStorage.removeItem(this._key),this.savePersonalConfig(this.personalConf)),this.personalConf):null}return null},G.prototype.getQuickSelected=function(e){var t=this.getPersonalData(),i=t?t.quickSelected:null;if(e){if(i){var n=i[e];if(n&&n.length)return n}return null}return i},G.prototype.getDialogSize=function(){var e=this.getPersonalData();return e?e.size:null},G.prototype.updatePersonalConfig=function(e){var t=Object.assign(this.personalConf||{},e);this.savePersonalConfig(t)},G.prototype.savePersonalConfig=function(e){return!!this._newKey&&(localStorage.setItem(this._newKey,JSON.stringify(e)),this.personalConf=e,!0)},G.prototype.getActiveTabIndex=function(e){var t=this.getPersonalData();return e||(t&&t.tabIndex?t.tabIndex:"datalist")},G.prototype.updateQueckSelected=function(e,t){var i,n,s=this,a=this.getQuickSelected(t);if(a&&a.length){var o=[];a.forEach(function(t,i){s.singleSelect?t&&e&&t[s.idField]===e[s.idField]&&o.push(i):e&&e.forEach(function(e){t&&t[s.idField]===e[s.idField]&&o.push(i)})}),o.forEach(function(e){a[e]=null}),this.personalConf.quickSelected[t]=this.personalConf.quickSelected[t].filter(function(e){return null!==e}),this.singleSelect?this.personalConf.quickSelected[t].unshift(e):e&&e.forEach(function(e){s.personalConf.quickSelected[t].unshift(e)}),this.personalConf.quickSelected[t].length=5<this.personalConf.quickSelected[t].length?5:this.personalConf.quickSelected[t].length}else{var r=this.personalConf.quickSelected||{},l=void 0;l=this.singleSelect?Object.assign(r,((i={})[t]=[e],i)):(e.length=5<e.length?5:e.length,Object.assign(r,((n={})[t]=e,n))),this.personalConf.quickSelected=l}this.savePersonalConfig(this.personalConf)},G.prototype._updatePersonalConfig=function(e){if(e){var t=!1;e.favorite&&Array.isArray(e.favorite)&&(e.favorite={"zh-CHS":k(e.favorite)},delete e.favorite,t=!0),e.selected&&(Array.isArray(e.selected)&&(e.quickSelected={"zh-CHS":k(e.selected)}),delete e.selected,t=!0),t&&this.savePersonalConfig(e)}},G.decorators=[{type:v.Injectable}],G.ctorParameters=function(){return[{type:g.IdService}]},G);function G(e){this.idService=e,this.selectItemObser$=new u.Subject,this.displayType="LIST",this.singleSelect=!0,this._key="",this._newKey="",this.controlID=""}var q=function Oe(e){this.instance=e},K=($.prototype.getTreeInfo=function(e){if(e.data[this.treeInfo.dataField])return e.data[this.treeInfo.dataField];var t=e.data;if(t&&this.treeInfo.dataField){var i=this.treeInfo.dataField.toLowerCase(),n=Object.keys(e.data).find(function(e){return e.toLowerCase()===i});if(n)return t[n];console.error("未找到树形信息数据字段【"+this.treeInfo.dataField+"】")}else console.error("未找到树形信息数据字段【"+this.treeInfo.dataField+"】")},$.prototype.getTreeNodeLayer=function(e){return this.getTreeInfo(e)[this.treeInfo.layerField]},$.prototype.updateTreeNodeExpanded=function(e,t){var i=this;void 0===t&&(t=null),this.treeInfo=t||this.instance.treeInfo;var n=this.instance.expandLevel;-1!==n&&(this.flatAllNodes.length||(this.flatAllNodes=this.treeData2Flat(null,e,0,[])),e.forEach(function(e){e.expanded=i.shoudExpand(n,i.getTreeNodeLayer(e)),i.isSelectNodeParent(e)&&(e.expanded=!0),e.children&&e.children.length?i.updateTreeNodeExpanded(e.children,t):e.leaf=!0}))},$.prototype.treeData2Flat=function(o,e,r,l){var c=this,p=this.instance.idField,d=[];return e&&e.length&&e.forEach(function(e,t){var i=[];if(o){var n=o.data[p],s=l||[];(i=i.concat(s.map(function(e){return e}))).push(n)}var a={id:e.data[p],node:e,level:r,parents:i};d.push(a),d=d.concat(c.treeData2Flat(e,e.children,r+1,i))}),d},$.prototype.shoudExpand=function(e,t){return-1!==e&&(0===e||t<=e)},$.prototype.isSelectNodeParent=function(e){var t=this;if(this.instance.navSelectedIds){var i=this.flatAllNodes.find(function(e){return e.id===t.instance.navSelectedIds}).parents;return!(!i||!i.length)&&i.includes(e.id)}return!1},$.prototype.getLeafNode=function(e){return!e||e.children&&e.children.length?1===e.children.length?this.getLeafNode(e.children[0]):e.children:e},$.prototype.flatTreeNodes=function(e,t){var i=this;return void 0===t&&(t=[]),(e=e||[]).reduce(function(e,t){return e.push(t),t.children&&t.children.length&&i.flatTreeNodes(t.children,e),e},t)},$);function $(e){this.instance=e,this.flatAllNodes=[]}var J=(Q.prototype.getFavoriteColumns=function(){return this.instance.gridOptions.columns.map(function(e){var t=Object.assign({},e);return e.field===x&&(t.formatter=function(){return O}),t})},Q.prototype.initPersonalInfo=function(){if(this.instance.personalConfigService){var e=this.instance.el.nativeElement.id||this.instance.controlId;e||console.log("LookupGrid - 未设置组件id, 收藏功能将不能正常，请设置组件id.");var t=this.getPersonalConfigKey(e);this.instance.personalConfigService.controlID=e,this.instance.personalConfigService.personalConfigKey=t;var i={displayType:this.instance.displayType,singleSelect:this.instance.singleSelect,idField:this.instance.idField,textField:this.instance.textField,mapFields:Object.assign({},this.instance.mapFields||{})};this.instance.personalConfigService.initPersonalConf(i),this.listenPersonalConfigHandler()}},Q.prototype.getPersonalConfigKey=function(e){var t=this;return this.instance.ngControl?this.instance.ngControl.name?this.instance.ngControl.name:this.instance.mapFields&&this.instance.mapFields.length?Object.keys(this.instance.mapFields).map(function(e){return t.instance.mapFields[e]}).join("_"):this.instance.textField:""},Q.prototype.initFavoriteComponentEvent=function(e){var a=this;switch(this.instance.displayType){case D.NavList:case D.NavTreeList:case D.List:var t=e.instance;t.remoteSort=!1,t.selectedRow.subscribe(function(e){a.instance.singleSelect&&a.lookupSelectionSer.clearSelections(),a.lookupSelectionSer.updateSelections(e.data)}),t.unSelectRow.subscribe(function(e){a.lookupSelectionSer.unSelect(e.data[a.instance.idField])}),t.singleSelect||t.checkAll.subscribe(function(e){a.lookupSelectionSer.updateSelections(t.data,e)}),t.cellClick.subscribe(function(t){if(t.col.field===x&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-unfavorite"))){if(a.instance.items){a.instance.items.forEach(function(e){e[a.instance.idField]===t.row[a.instance.idField]&&(e[x]=!1)});var e=a.instance.componentRef.instance;e&&e.loadData({pageSize:a.instance.gridOptions.pageSize,pageIndex:a.instance.gridOptions.pageIndex,total:a.instance.gridOptions.total,data:a.instance.gridOptions.items})}a.instance.favoriteItems=a.instance.favoriteItems.filter(function(e){return e[a.instance.idField]!==t.row[a.instance.idField]}),a.lookupSelectionSer.updateFavoriteData(t.row,L)}}),t.rowDblClick.subscribe(function(e){a.instance.gridOptions.singleSelect&&a.instance.selectItem(e)});break;case D.TreeList:if(e){var i=e.instance;i.remoteSort=!1,i.nodeSelected.subscribe(function(e){a.instance.singleSelect&&a.lookupSelectionSer.clearSelections(),a.lookupSelectionSer.updateSelections(e.node.data)}),i.nodeUnChecked.subscribe(function(e){e&&e.node&&e.node.data&&e.node.data.id&&a.lookupSelectionSer.unSelect(e.node.data.id)}),i.nodeChecked.subscribe(function(e){a.instance.singleSelect||(e.nodes&&e.nodes.length?a.instance.multiSelMgr.updateSelections(e.nodes.map(function(e){return e.data})):Array.isArray(e.node)?a.instance.multiSelMgr.updateSelections(e.node.map(function(e){return e.data})):a.instance.multiSelMgr.updateSelections([e.node.data]))}),i.cellClick.subscribe(function(i){if(i.col.field===x&&(i.event.stopPropagation(),i.event.target.classList.contains("f-lookup-unfavorite"))){var n=a.instance;!function s(e){var t=!1;e.forEach(function(e){t||(e.data[n.idField]===i.node[n.idField]?(e.data[x]=!1,t=!0):e.children&&0<e.children.length&&s(e.children))})}(a.instance.items),a.instance.componentRef.instance.loadData(a.instance.items),a.lookupSelectionSer.updateFavoriteData(i.node.data,L)}}),i.dblClick.subscribe(function(e){a.instance.gridOptions.singleSelect&&e.selectable&&a.instance.okButton&&a.instance.okButton.nativeElement.click()})}}},Q.prototype.getFavoritData=function(){if(this.instance.personalConf){var e=this.instance.personalConf.favorite;return e&&e[this.instance.localService.localeId]?e[this.instance.localService.localeId]:[]}return[]},Q.prototype.getFavoritIds=function(){return this.getFavoritData()},Q.prototype._loadFavoriteData=function(e){void 0===e&&(e=null);var t=this.instance.favoritesComponentRef.instance;this.loadFavoriteDatatable(t,e),t.cd.markForCheck(),this.instance.closeLoading()},Q.prototype.loadFavoritesData=function(e){switch(void 0===e&&(e=null),this.getFavoritIds(),this.instance.displayType){case D.NavList:case D.NavTreeList:case D.List:var t=this.instance.favoritesComponentRef.instance;if("locale"===this.instance.favoriteDataFrom)e&&this._loadFavoriteData(e.items);else{var i=this.getFavoritData();this.loadFavoriteDatatable(t,e?e.items:i)}break;case D.TreeList:if(this.instance.favoritesComponentRef&&this.instance.favoritesComponentRef.instance instanceof l.TreeTableComponent){var n=this.instance.favoritesComponentRef.instance;this.bindFavTreetable(n),"locale"===this.instance.favoriteDataFrom?e&&this.loadFavoriteForTreeTable(e.items||[],n):e&&this.loadFavoriteForTreeTable(e.items,n)}}},Q.prototype.loadFavoriteDatatable=function(e,t){t!==undefined&&(this.instance.favoriteItems=t),e.columns&&!e.columns.length&&(e.columns=this.instance.favoriteColumns),e.loadData({total:0,pageSize:20,pageIndex:1,data:this.instance.favoriteItems}),this.instance.selectionMgr.selectCurrentValue(),e.cd.detectChanges()},Q.prototype.bindFavTreetable=function(e){var n=this;e.allColumnsTitle=this.instance.allColumnsTitle,e.idField=this.instance.idField;var t=this.instance.gridOptions.columns.map(function(e){var t=I({},e);return e.field===x&&(t.formatter=function(e,t){var i=n.getFavoritIds();return i&&i.length&&0<=i.findIndex(function(e){return e===t[n.instance.idField]})?O:""}),t});this.instance.favoriteColumns=t,e.columns=t,this.instance.gridOptions.treeInfo&&(e.onlySelectLeaf=this.instance.gridOptions.treeInfo.onlySelectLeaf),e.singleSelect||(e.checkOnSelect=!0,e.selectOnCheck=!0,e.showCheckbox=!0,this.instance.enableCascade?this.instance.ttEventMgr.cascadeValueChanged(this.instance.cascadeStatus):(e.cascadeCheck=!1,e.cascadeDown=!1,e.cascadeUp=!1))},Q.prototype.initFavoriteTreeData=function(e){var t=this.instance.gridOptions.treeInfo;return t&&!t.treeDataIsInit&&(e="pathcode"===t.layerType.toLowerCase()?this.instance.lookupUtils.makeTree(e,t):this.instance.lookupUtils.makeTreeWithParentID(e,"",t.dataField+"."+t.parentField,this.instance.idField)),this.instance.checkNodeCanBeSelect(e,!0)},Q.prototype.loadFavoriteForTreeTable=function(e,t){return e=this.initFavoriteTreeData(e),this.instance.favoriteItems=e,t.loadData(e),t.expandAll(),this.instance.selectionMgr.selectCurrentValue(),e},Q.prototype.updateFavoritesStatus=function(e){var i=this;if(e&&this.instance.useFavorite){var n=this.getFavoritIds();if(n&&n.length)if(this.instance.displayType!==D.TreeList)e.map(function(t){n&&n.length&&n.find(function(e){return e===t[i.instance.idField]})&&(t[x]=!0)});else{var s=this.instance;!function a(e){e.forEach(function(t){n&&n.length&&n.find(function(e){return e===t.data[s.idField]})&&(t.data[x]=!0),t.children&&0<t.children.length&&a(t.children)})}(e)}}},Q.prototype._updateFavorites=function(e,t){var i=this,n=this.instance.localService.localeId;this.instance.personalConf.favorite=this.instance.personalConf.favorite||{};var s=e.filter(function(e){return!e._addtional_}).map(function(e){return e[i.instance.idField]}).filter(function(e){return null!==e&&e!==undefined});return this.instance.personalConf.favorite[n]=s},Q.prototype.listenPersonalConfigHandler=function(){var o=this;this.lookupSelectionSer.favoriteItems$.subscribe(function(e){if(o.instance.favoritesComponentRef){var t=e.items,i=e.action,n=o._updateFavorites(t,i);if(o.instance.httpMgr.submitFavoriteData(i),o.instance.displayType===D.List||o.instance.displayType.includes("NAV")){var s=o.instance.favoritesComponentRef.instance;o.loadFavoriteDatatable(s,t)}else if(o.instance.displayType===D.TreeList){var a=o.instance.favoritesComponentRef.instance;o.instance.showLoading(),o.instance.httpMgr.getData({favoriteIds:n},"fav").subscribe(function(e){if(e){var t=e.items;o.loadFavoriteForTreeTable(t,a)}else o.instance.favoriteItems=[],a.loadData([]);o.instance.closeLoading()})}}})},Q);function Q(e){var a=this;this.instance=e,this.favoriteColumnFormatter=function(e,t){var i=e?F:w;if(a.instance.isTree()){var n=t[a.instance.idField];if(n){var s=a.instance.componentRef.instance.findRowNode(n);if(s)return s.node.selectable?i:""}}return i},this.lookupSelectionSer=this.instance.lookupSelectionSer}var Z=(Y.prototype.destroy=function(){},Y.prototype.getBindingData=function(){var e=this.ins.bindingData;if(this.ins.ngControl&&this.ins.ngControl.formDirective&&this.ins.ngControl.formDirective.form&&this.ins.ngControl.formDirective.form.bindingData){var t=this.ins.ngControl.formDirective.form.bindingData;(e=t).getObject&&(e=t.getObject().toJSON())}return e},Y.prototype.initDisplayValue=function(){var e=this.getBindingData();if(e&&this.ins.mapFields){var t=this.ins.idField,i=this.ins.mapFields[t];if(i){-1<i.indexOf(",")&&(i=i.split(",")[0]);var n=this.ins.utils.getValue(i,e);n&&(this.ins.displayValue=n)}}},Y.prototype._clearSelections=function(){var e=this.getDataCmpInstance().cmpRefInstance;e&&(this.ins.isTree()?(e.clearAll(!1),e.cdRef.destroyed||e.cdRef.detectChanges()):(e.dtBody.selectedRowIndex=-1,e.dtBody.selections=undefined,e.cd.destroyed||e.cd.detectChanges()))},Y.prototype.selectCurrentValue=function(e){var t=this;if(void 0===e&&(e=[]),this.ins.enableToSelect){var i=this.getDataCmpInstance(),n=i.cmpRefInstance,s=i.items;if(n&&s&&s.length){if(this._clearSelections(),!e||!e.length){var a=this.ins.lookupSelectionSer.getSelections();a.length&&(e=a.map(function(e){return e[t.ins.idField]}))}e&&e.length&&(this.ins.isTree()?(this.selected4Treetable(n,e),n.cdRef.destroyed||n.cdRef.detectChanges()):(this.selected4Datatable(n,s,e),n.cd.destroyed||n.cd.detectChanges()))}}},Y.prototype.getDataCmpInstance=function(){var e=null,t=null;return"datalist"===this.ins.activeTab?this.ins.isTree()?t=(e=this.ins.lookupCmpMgr.getComponentInstance("treetable")).serializedValue:(t=this.ins.items,e=this.ins.lookupCmpMgr.getComponentInstance()):"favorite"===this.ins.activeTab&&(e=this.ins.lookupCmpMgr.getComponentInstance("fav"),t=this.ins.favoriteItems),{cmpRefInstance:e,items:t}},Y.prototype.selected4Datatable=function(i,e,n){var s=this;this.ins.singleSelect?e.forEach(function(e,t){e[s.ins.idField]===n[0]&&(i.dtBody.isSelected(e)||(i.dtBody.selectedRowIndex=-1,i.dtBody.selectedRow("",t,e)))}):n.forEach(function(t){e.find(function(e){return e[s.ins.idField]==t})&&i.checkRow(t)})},Y.prototype.selected4Treetable=function(e,t){this.ins.singleSelect?e.selectNode(t[0],!1,!1):(e.checkedNodes(t,!1,!1),e.selectNodes(t))},Y.prototype.getSelectedIds=function(){var t=this,e=[],i=this.ins.multipleChoiceSeparator;if(!this.ins.singleSelect&&this.ins.displayValue&&-1<(""+this.ins.displayValue).indexOf(i)?e=this.ins.displayValue.split(i):null!==this.ins.displayValue&&""!==this.ins.displayValue&&this.ins.displayValue!==undefined&&(e=[this.ins.displayValue]),this.ins.showSelected){var n=this.ins.lookupSelectionSer.getSelections();e=n&&n.length?n.map(function(e){return e[t.ins.idField]}):[]}return e},Y);function Y(e){this.ins=e}var X=(ee.prototype.onSearch=function(e){var t=this;if(void 0===e&&(e={field:"*",value:""}),!e||"*"===e.field||e.value){var i={pageInfo:{pageIndex:1,pageSize:this.ins.gridOptions.pageSize},search:e};this.ins.uri?this.ins.searching||(this.ins.searching=!0,this.ins.httpMgr.getData(i,"list").pipe(y.catchError(function(e){return t.ins.searching=!1,u.of({_ERROR_:e})}),y.tap(function(){t.ins.searching=!1})).subscribe(function(e){if(t.ins.searching=!1,t.ins.closeLoading(),e._ERROR_)throw new Error(e._ERROR_);t._loadData(e)})):this.ins.search.emit(i)}else this.ins.messagerService.warning(this.ins.mustWriteSomething)},ee.prototype._loadData=function(e){var t=this.ins;t.closeLoading(),t.favHelper.updateFavoritesStatus(e.items),t.loadDataTableData(e),this.ins.selectionMgr.selectCurrentValue()},ee.prototype.bindDataTableEvent=function(){var o=this,r=this.ins,i=r.componentRef.instance;i.selectedRow.subscribe(function(e){o.ins.singleSelect&&o.lookupSelectionSer.clearSelections(),o.ins.checkedChange.emit({data:[e.data],isCheck:!0}),o.lookupSelectionSer.updateSelections([e.data]),i.cd.detectChanges()}),i.unSelectRow.subscribe(function(e){o.lookupSelectionSer.unSelect(e.data[r.idField]),o.ins.checkedChange.emit({data:[e.data],isCheck:!1})}),i.checkAll.subscribe(function(e){o.lookupSelectionSer.updateSelections(i.data,e),o.ins.checkedChange.emit({data:i.data,isCheck:e})}),i.pageChanged.subscribe(function(e){r.uri?r.httpMgr.getData(e,"list").subscribe(function(e){o._loadData(e)}):r.pagerChanged.emit(r.httpMgr.buildQueryParams(e,"list"))}),i.pageSizeChanged.subscribe(function(e){r.uri?r.httpMgr.getData(e,"list").subscribe(function(e){o._loadData(e)},function(e){r.closeLoading()}):r.pagerChanged.emit(r.httpMgr.buildQueryParams(e,"list"))}),i.search.subscribe(function(e){r._searchState=e,o.onSearch(e)}),i.rowDblClick.subscribe(function(e){r.gridOptions.singleSelect&&r.selectItem(e)}),i.cellClick.subscribe(function(t){if(t.col.field===x&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-favorite"))){r.items.forEach(function(e){r.utils.getValue(r.idField,e)===r.utils.getValue(r.idField,t.row)&&(e[x]=!e[x])}),i.loadData({pageSize:r.gridOptions.pageSize,pageIndex:r.gridOptions.pageIndex,total:r.gridOptions.total,data:r.gridOptions.items});var e=t.row[x]?E:L;o.ins.favoriteItems=e===E?k(o.ins.favoriteItems,[t.row]):o.ins.favoriteItems.filter(function(e){return r.utils.getValue(r.idField,e)!==r.utils.getValue(r.idField,t.row)}),o.lookupSelectionSer.updateFavoriteData(t.row,e)}}),i.columnSorted.subscribe(function(e){if(o.ins.remoteSort){var t=I({},e),i=t.sortName,n=t.sortOrder,s=o.ins.columns.find(function(e){return e.field===i}),a={sortName:s?s.fieldPath?s.fieldPath:s.field:i,sortOrder:n,search:r._searchState,pageInfo:{pageSize:r.pageSize,pageIndex:1}};r.httpMgr.getData(a,"search").subscribe(function(e){r.loadDataTableData(e),r.closeLoading()})}}),i.clearSearchValue.subscribe(function(){r._searchState=null,o.onSearch()})},ee);function ee(e){this.ins=e,this.lookupSelectionSer=this.ins.lookupSelectionSer}function te(e){void 0===e&&(e=null),this.searchOnServer?this.isShow=!0:(this.setModelValue(this.displayText),this.runDictPickedEvent(null))}function ie(){var n=this,s=this,e=function(e){!n.isTextChange||!n.displayText||n.nosearch&&!e.originalEvent||n.lookupUtils.rts.getFormState("lookup.pending")||(n.lookupUtils.pendingStart(),n.dictPickingSubscription=n.dictPicking({instance:n}).pipe(y.switchMap(function(e){var t=!0;return e!==undefined&&null!==e||(t=!0),"boolean"==typeof e&&(t=e),"object"==typeof e&&(t=e.showDialog===undefined||e.showDialog,e.data&&(n.customData=e.data)),t?n.httpMgr.getData({search:{field:"*",value:n.displayText}},"search"):u.of({SHOWDIALOG:t,MESSAGE:e.message||""})})).subscribe(function(e){if(n.closeLoading(),n.lookupUtils.pendingEnd(),e.hasOwnProperty("SHOWDIALOG"))e.SHOWDIALOG&&e.MESSAGE&&n.notifyService.warning(e.MESSAGE);else if(e.items&&1===e.items.length){var t=e.items[0];if(n.isTree()){var i=n.treeNodeHelper.getLeafNode(t);if(Array.isArray(i))return void te.bind(s,e)();t=i.data}n.singleSelect||(t=[t]),n.selectItem(t)}else te.bind(s,e)()},function(e){n.closeLoading(),n.lookupUtils.pendingEnd(),n.messagerService.error(e?e.Message:e)}))};this.inputGroup&&this.inputGroup.textbox&&!this.nosearch&&(this.lookupUtils.setActiveLookupInstance(this),this.render2.listen(this.inputGroup.textbox.nativeElement,"blur",e)),this.inputGroup&&(this.inputGroup.enterHandle.subscribe(e),this.inputGroup.keydownHandle.subscribe(function(e){("ArrowRight"===e.code?n.editable&&(e.target.value&&e.target.selectionStart!==e.target.value.length):e.code!==n.shortcutKey.open)||(e.stopPropagation(),e.preventDefault(),n.showDialog())}))}var ne=(se.prototype.searchTreeData=function(a){var o=this,r=this.ins.componentRef.instance;if(!this.ins.searching)return this.ins.searching=!0,this.ins.httpMgr.getData({search:a,sortName:r.sortName,sortOrder:r.sortOrder},"search").pipe(y.tap(function(){o.ins.searching=!1}),y.catchError(function(e){return o.ins.searching=!1,u.of(e)})).subscribe(function(e){if(e){o.ins.items=e.items,o.ins.closeLoading(),r.clearAll();var t=o.ins.gridOptions.treeInfo;t.treeDataIsInit||("pathcode"===t.layerType.toLowerCase()?o.ins.items=o.ins.lookupUtils.makeTree(o.ins.items,t):o.ins.items=o.ins.lookupUtils.makeTreeWithParentID(o.ins.items,"",t.dataField+"."+t.parentField,o.ins.idField));var i=function(e){return e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length&&i(e.children),e}):e},n=function(e){return e&&e.length?e.map(function(e){return e.children&&e.children.length&&(e.expanded=!0,n(e.children)),e}):e},s=i(o.ins.items);s&&s.length&&s[0].children&&s[0].children.length&&(s[0].expanded=!0,s[0].children=n(s[0].children)),o.ins.items=s,o.ins.useFavorite&&o.ins.favHelper.updateFavoritesStatus(o.ins.items),r.loadData(o.ins.items),r.resize(),o.IS_SEARCH_RESULT=!0,o.ins.selectionMgr.selectCurrentValue()}o.ins.search.emit(a)})},se.prototype.getChildren=function(e,t,i){var n=this.ins.gridOptions.uri,s=I({parentLayer:t,category:"children"},i);"parentId"===this.ins.treeInfo.layerType?s.parentId=e:s.parentPath=e;var a={searchValue:JSON.stringify(s),customData:this.ins.customData,enableFullTree:this.ins.enableFullTree,loadTreeDataType:this.ins.loadTreeDataType};this.IS_SEARCH_RESULT&&(a.enableFullTree=!1,a.loadTreeDataType="layerload",s.searchValue="",s.searchField="*",a.searchValue=JSON.stringify(s)),this.ins.helpId&&(a.helpId=this.ins.helpId);var o=this.ins.componentRef.instance;return o&&o.sortName&&Object.assign(a,{sortName:o.sortName,sortOrder:o.sortOrder}),this.ins.http.getData(n,a)},se.prototype.bindTreetableEvent=function(){var h=this,u=this.ins.componentRef.instance,t=function(e){h.ins.remoteSearch?(h.ins._searchState=e,h.searchTreeData(e)):h.ins.search.emit(e)},r=function(){return"default"===h.ins.loadTreeDataType?"all"===u.loadDataType:"loadall"===h.ins.loadTreeDataType};u.dblClickExpand=!this.ins.singleSelect,u.allColumnsTitle=this.ins.allColumnsTitle,u.idField=this.ins.idField,u.columns=this.ins.columns,u.searchFields=this.ins.gridOptions.searchFields,this.ins.treeInfo&&(u.loadDataType=this.ins.treeInfo.loadDataType,u.virtualized=!0,this.ins.allData=f.cloneDeep(this.ins.items)),this.ins.gridOptions.treeInfo&&(u.onlySelectLeaf=this.ins.gridOptions.treeInfo.onlySelectLeaf,u.loadDataType=this.ins.gridOptions.treeInfo.loadDataType),u.singleSelect||(u.checkOnSelect=!0,u.selectOnCheck=!0,u.showCheckbox=!0,u.showCheckAll=this.ins.showCheckAll,this.ins.enableCascade?this.cascadeValueChanged(this.ins.cascadeStatus):(u.cascadeCheck=!1,u.cascadeDown=!1,u.cascadeUp=!1)),u.enableFindText=this.ins.enableFindText,u.nodeSelected.subscribe(function(e){h.ins.singleSelect&&h.lookupSelectionSer.clearSelections(),h.lookupSelectionSer.updateSelections([e.node.data]),h.ins.checkedChange.emit({data:[e.node.data],isCheck:!0})}),u.nodeChecked.subscribe(function(e){if(!h.ins.singleSelect){var t=null;t=e.nodes&&e.nodes.length?e.nodes.map(function(e){return e.data}):Array.isArray(e.node)?e.node.map(function(e){return e.data}):[e.node.data],h.ins.multiSelMgr.updateSelections(t),h.ins.checkedChange.emit({data:t,isCheck:!0})}}),u.nodeUnChecked.subscribe(function(e){if(e&&e.node)if(h.ins.singleSelect){var t=h.ins.favoritesComponentRef&&h.ins.favoritesComponentRef.instance;t&&t.findRowNode(e.node.id)&&t.unSelectNode(e.node.id),h.ins.checkedChange.emit({data:[e.node.data],isCheck:!1})}else{if(h.ins.multiSelMgr.remove(e.node.id),"all"!==u.loadDataType&&"pathcode"===h.ins.treeInfo.layerType&&("enable"===h.ins.cascadeStatus||"down"===h.ins.cascadeStatus))if(e.node.children&&e.node.children.length){var i=e.node.children.map(function(e){return e.data});h.ins.lookupSelectionSer.updateSelections(i,!1)}else{var n=e.node.data[h.ins.treeInfo.dataField][h.ins.treeInfo.pathField];h.ins.lookupSelectionSer.unselectByPathcode(n)}e.nodes&&e.nodes.length?(h.ins.multiSelMgr.remove(e.nodes.map(function(e){return e.id})),h.ins.checkedChange.emit({data:e.nodes.map(function(e){return e.data}),isCheck:!1})):h.ins.checkedChange.emit({data:[e.node.data],isCheck:!1})}}),u.search.subscribe(function(e){"*"===e.field||e.value?t(e):h.ins.messagerService.warning(h.ins.mustWriteSomething)}),u.cellClick.subscribe(function(t){if(t.col.field===x&&(t.event.stopPropagation(),t.event.target.classList.contains("f-lookup-favorite"))){var i=h.ins;!function n(e){e&&e.forEach(function(e){return i.utils.getValue(i.idField,e.data)===t.node.id?(e.data[x]=!e.data[x],!0):!!(e.children&&0<e.children.length)&&n(e.children)})}(h.ins.items),u.loadData(h.ins.items),h.lookupSelectionSer.updateFavoriteData(t.node.data,t.node.data[x]?E:L)}}),u.dblClick.subscribe(function(e){h.ins.gridOptions.singleSelect&&e.selectable&&h.ins.okButton&&h.ins.selectItem(e.data)});var i=r();return u.columnSorted.subscribe(function(e){if(r())u.clientSort();else{var t=I({},e),i=t.sortName,n=t.sortOrder,s=h.ins.columns.find(function(e){return e.field===i}),a=s?s.fieldPath?s.fieldPath:s.field:i,o=Object.assign({sortName:a,sortOrder:n},{search:h.ins._searchState});h.ins.httpMgr.getData(o,"search").subscribe(function(e){h.ins.items=e.items,h.ins.closeLoading(),u.clearAll();var t=h.ins.checkNodeCanBeSelect(e.items,!1);u.loadData(t),u.resize()})}}),u.clearSearchValue.subscribe(function(){h.ins._searchState=null,h.IS_SEARCH_RESULT=!1;var e=h.ins.checkNodeCanBeSelect(h.ins.allData,i);e&&e.length?(h.ins.items=e,h.ins.favHelper.updateFavoritesStatus(h.ins.items),u.loadData(e)):t({field:"*",value:""})}),u.expand.subscribe(function(s){if(!s.leaf)if(s.children&&s.children.length){if(!h.ins.singleSelect&&h.ins.enableCascade&&("enable"===h.ins.cascadeStatus||"down"===h.ins.cascadeStatus)&&h.ins.isGetAllChidlNodes){var e=u.findRowNode(s.id);u.propagateSelectionDown(e,e.isChecked);var t=s.children.filter(function(e){return e.selectable}).map(function(e){return e.data});h.ins.lookupSelectionSer.updateSelections(t,e.isChecked)}h.ins.selectionMgr.selectCurrentValue()}else{var i=h.ins.gridOptions.treeInfo;if(("default"===h.ins.loadTreeDataType?"async"===u.loadDataType:"layerload"===h.ins.loadTreeDataType)||h.IS_SEARCH_RESULT){var n="",a=-1,o=I({},u.searchData),r=o.field,l=void 0===r?"*":r,c=o.value,p=void 0===c?"":c;if(s.showLoading=!0,u.detectChanges(),"parentId"===i.layerType)n=s.id;else{var d=i.dataField;d?(n=s.data[d][i.pathField],a=s.data[d][i.layerField]):console.log("未找到分级信息。")}if(!h.ins.uri)return void h.ins.expandTreeNode.emit({instance:u,node:s,parentIdOrPath:n,parentLayer:a,search:{value:p,field:l}});h.getChildren(n,a,{searchField:"*"===l?"*":l,searchValue:p}).subscribe(function(e){if(u){if(s&&e.items&&e.items.length){h.ins.useFavorite&&h.ins.favHelper.updateFavoritesStatus(e.items);var t=h.ins.checkNodeCanBeSelect(e.items,!1);if(u.appendChildren(t,s),"all"!==u.loadDataType&&!h.ins.singleSelect&&h.ins.isGetAllChidlNodes&&("enable"===h.ins.cascadeStatus||"down"===h.ins.cascadeStatus)){var i=u.findRowNode(s.id);u.propagateSelectionDown(i,i.isChecked);var n=e.items.filter(function(e){return!e.addtional});n&&n.length&&h.ins.lookupSelectionSer.updateSelections(n.map(function(e){return e.data}),i.isChecked)}}s.showLoading=!1,u.detectChanges(),h.ins.selectionMgr.selectCurrentValue()}})}}}),i&&this.ins.items&&this.ins.treeNodeHelper.updateTreeNodeExpanded(this.ins.items),i},se.prototype.cascadeValueChanged=function(e){var t=e,i="datalist"===this.ins.activeTab?"treetable":"fav",n=this.ins.lookupCmpMgr.getComponentInstance(i);if(n){switch(t){case"enable":n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!0;break;case"disable":n.cascadeCheck=!1,n.cascadeDown=!1,n.cascadeUp=!1;break;case"up":n.cascadeCheck=!0,n.cascadeUp=!0,n.cascadeDown=!1;break;case"down":n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!1;break;default:n.cascadeCheck=!0,n.cascadeDown=!0,n.cascadeUp=!0}this.ins.cascadeStatus=t||"enable"}},se);function se(e){this.ins=e,this.IS_SEARCH_RESULT=!1,this.lookupSelectionSer=this.ins.lookupSelectionSer}var ae=(oe.prototype.onSelectedTableCellClick=function(e){if(e.col.field===x&&(e.event.stopPropagation(),e.event.target.classList.contains("f-lookup-unfavorite"))){var t=e.row[this.ins.idField];if(this.ins.lookupSelectionSer.unSelect(t),this.ins.isTree()){var i=this.ins.lookupCmpMgr.getComponentInstance("treetable");if(i.unCheckedNode(t),i.unSelectNode(t),this.ins.useFavorite){var n=this.ins.lookupCmpMgr.getComponentInstance("fav");n.data&&n.data.length&&n.findRowNode(t)&&(n.unCheckedNode(t),n.unSelectNode(t))}}else if(this.ins.lookupCmpMgr.getComponentInstance().unCheckRow(t),this.ins.useFavorite){var s=this.ins.lookupCmpMgr.getComponentInstance("fav");s.data&&s.data.length&&s.unCheckRow(t)}}},oe.prototype.initSelectedColumns=function(){var e=[];if(this.ins.showSelected&&!this.ins.singleSelect){var t=(e=f.cloneDeep(this.ins.gridOptions.columns)).find(function(e){return e.field===x});t?t.formatter=function(){return R}:e=e.concat([{field:x,width:80,formatter:function(){return R}}])}return e},oe.prototype.updateSelections=function(e){Array.isArray(e)?this.ins.lookupSelectionSer.updateSelections(e,!0):this.ins.lookupSelectionSer.select(e)},oe.prototype.remove=function(e){e&&this.ins.lookupSelectionSer.unSelect(e)},oe.prototype.clear=function(){this.ins.lookupSelectionSer.clearSelections()},oe.prototype.save=function(e){this.ins.showSelected&&(this.ins.personalConf.selections=e,this.ins.personalConfigService.savePersonalConfig(this.ins.personalConf))},oe.prototype.loadData=function(){var e=this.ins.personalConf&&this.ins.personalConf.selections||[];e.length||(e=this.ins.lookupSelectionSer.getSelections()),this.ins.lookupSelectionSer.loadSelections(e)},oe);function oe(e){this.ins=e}var re={tabIndex:"datalist",favorite:null,size:null},le=(ce.prototype.disablePagination=function(){return{pageIndex:1,pageSize:500}},ce.prototype.buildQueryParams=function(e,t){void 0===t&&(t="all");var i={};this.ins.condition&&(i.condition=f.cloneDeep(this.ins.condition));var n={category:t};if(this.ins.isDoublleList()&&this.ins.navigationFilter&&"all"!==t&&this.ins.navigationFilter.idValue&&"textchange"!==t&&(i.relationFilter=k(this.ins.navigationFilter.idValue)),e){if("fav"!==t&&"selected"!==t||(e.pageInfo=this.disablePagination()),e.pageInfo&&(i.pageIndex=e.pageInfo.pageIndex,i.pageSize=e.pageInfo.pageSize),e.search){var s=e.search.field;s&&"*"===s&&(s="*"),n.searchField=s,n.searchValue=e.search.value}e.sortName&&(n.sortName=e.sortName),e.sortOrder&&(n.sortOrder=e.sortOrder)}return"fav"===t&&e.favoriteIds&&(n.favoriteIds=e.favoriteIds),!this.ins.isTree()&&this.ins.displayType!==D.NavTreeList||(i.enableFullTree=this.ins.enableFullTree),"textchange"===t&&(i.enableFullTree=!1),"selected"===t&&(n.category="fav",i.enableFullTree=!1,n.favoriteIds=e.favoriteIds),i.searchValue=JSON.stringify(n),i.loadTreeDataType=this.ins.loadTreeDataType,i.customData=this.ins.customData,this.ins.helpId&&(i.helpId=this.ins.helpId),e.selectedInfo&&(i.selectedInfo=e.selectedInfo),i},ce.prototype.getData=function(e,t){void 0===t&&(t="all");var i=this.ins.gridOptions.uri,n=this.buildQueryParams(e,t);if(i||this.ins.beUri){if(this.ins.beUri&&this.ins.columns&&this.ins.columns.length){var s=this.ins.columns.map(function(e){return e.searchField}).filter(function(e){return e});if(n.condition||(n.condition={}),!this.ins.isTree()&&this.ins.pagination){var a=I({},n),o=a.pageSize,r=void 0===o?this.ins.pageSize||20:o,l=a.pageIndex;n.condition.pagination={pageSize:r,pageIndex:l}}else n.condition.pagination={isUsePagination:!1};var c=JSON.parse(n.searchValue);c.searchValue&&(n.condition=this.ins.lookupUtils.mergeCondition(n.condition,s,{field:c.searchField,value:c.searchValue}))}var p=this.ins.beUri||i;if(this.ins.http&&(this.ins.http.context=this.ins.context),this.ins._searchResult)return u.of(this.ins._searchResult);if("allChildren"!==t)return this.ins.http.getData(p,n);var d={searchValue:JSON.stringify({category:t}),parentsIds:e.parentsIds,customData:n.customData,helpId:n.helpId};return this.ins.http.getData(p,d)}return u.of(!1)},ce.prototype.getSelecedItems=function(e){return this.getData({favoriteIds:e},"selected")},ce.prototype.getPersonalConfig=function(){var t=f.cloneDeep(re),e=this.ins.personalConfigService._newKey,i=this.ins.personalConfigService.getPersonalData(e);i&&Object.keys(i).length||(i=t);var n=u.of(i);return"locale"===this.ins.favoriteDataFrom||this.ins.isTabChanged?n:this.ins.http&&this.ins.http.getUserSettings?this.ins.http.getUserSettings(e).pipe(y.map(function(e){return e&&e.textValue?JSON.parse(e.textValue):t})):n},ce.prototype.lookupRequest=function(o,r){var l=this;return void 0===r&&(r="all"),this.ins.usePersionalConf?this.getPersonalConfig().pipe(y.tap(function(e){l.ins.personalConf=e,l.ins.personalConfigService.savePersonalConfig(e),l.ins.isTabChanged||(l._originalPersonalConfig=f.cloneDeep(e))}),y.switchMap(function(e){var t=e.tabIndex,i=e.favorite,n=e.size;if(l.ins.isTabChanged||(l.ins.activeTab=t||"datalist"),n&&(l.ins.dialogWidth=n.width,l.ins.dialogHeight=n.height,l.ins.dialog.reSize({width:n.width,height:n.height})),"datalist"===l.ins.activeTab)return l.getData(o,r);if("favorite"===l.ins.activeTab){var s=i?i[l.ins.localService.localeId]:[];return s&&s.length?(s.filter(function(e){return e}),o.favoriteIds=s,l.getData(o,"fav")):l.getData(o,r).pipe(y.map(function(e){return e&&(e.items=[]),e}))}if("selected"===l.ins.activeTab){var a=(l.ins.displayValue?l.ins.displayValue.split(","):[]).filter(function(e){return e});return l.getSelecedItems(a)}})):this.getData(o,r)},ce.prototype.submitFavoriteData=function(e){var t=this;if(JSON.stringify(this.ins.personalConf)!==JSON.stringify(this._originalPersonalConfig)){var i="";if(e===E?i=this.ins.addFavoriteSuccess:e===L&&(i=this.ins.delFavoriteSuccess),this.ins.personalConfigService.savePersonalConfig(this.ins.personalConf||{}),"locale"!==this.ins.favoriteDataFrom){this._originalPersonalConfig=f.cloneDeep(this.ins.personalConf);var n={configkey1:this.ins.personalConfigService.personalConfigKey,configkey2:"",configkey3:"",textvalue:JSON.stringify(this.ins.personalConf)};if(this.ins.http&&this.ins.http.saveUserSettings)return this.ins.savingFaoriteData=!0,this.ins.showLoading(),this.ins.http.saveUserSettings(n).subscribe(function(e){t.ins.savingFaoriteData=!1,t.ins.closeLoading(),i&&t.ins.notifyService.success(i)})}else i&&this.ins.notifyService.success(i)}},ce);function ce(e){this.ins=e,this._originalPersonalConfig=re}var pe=(de.prototype.ngOnInit=function(){},de.prototype.createComponent=function(){var e=null;return e=this.isTreeList()?this.cfr.resolveComponentFactory(l.TreeTableComponent):this.cfr.resolveComponentFactory(r.DataTableComponent),this.navOptions.keepSelect=!1,this.navOptions.showFilterBar=!0,this.navOptions.width=this.lookupCmp.leftPanelWidth-2,this.cmpRef=this.cmpContainer.createComponent(e),this.isTreeList()?this.navOptions.fit=!0:(this.navOptions.fill=!0,this.cmpRef.instance.maxSize=5,this.cmpRef.instance.fill=!0),this.navOptions.pageInfo?(this.navOptions.pageInfo.pageList&&(this.navOptions.pageList=this.navOptions.pageInfo.pageList),this.navOptions.pagination=this.navOptions.pageInfo.enablePager,this.navOptions.pageIndex=this.navOptions.pageInfo.pageIndex,this.navOptions.pageSize=this.navOptions.pageInfo.pageSize):this.navOptions.pagination=!1,Object.assign(this.cmpRef.instance,this.navOptions),this.loadData(),u.of(this.cmpRef)},de.prototype.update=function(){this.cd.detectChanges()},de.prototype.resize=function(e){e&&(e.width=e.width-2,this.cmpRef.instance.resize(e))},de.prototype.isTreeList=function(){return"treelist"===this.navOptions.displayType.toLowerCase()},de.prototype.selectLeftDataTableRow=function(e,t){var i=this;if(e&&e.length){var n=null;this.lookupCmp.navSelectedIds?n=e.find(function(e){return e[t.idField]==i.lookupCmp.navSelectedIds}):this.lookupCmp.selectFirstInNav&&(n=e[0]),n&&(t.dtBody.selectedRowIndex=-1,t.dtBody.selectedRow("",0,n))}},de.prototype.closeLoading=function(){this.lookupCmp.closeLoading()},de.prototype.initDataTable=function(t){var a=this;t.loadData({pageSize:this.navOptions.pageSize,pageIndex:this.navOptions.pageIndex,total:this.navOptions.total,data:this.navOptions.items}),t.resize({width:320,height:this.navOptions.height}),t.selectedRow.subscribe(function(e){a.selected.emit({data:e.data})}),t.unSelectRow.subscribe(function(e){a.selected.emit(null)});var i={pageInfo:{pageIndex:1,pageSize:this.navOptions.pageSize},search:""},o={next:function(e){a.closeLoading(),n(e)},error:function(e){a.closeLoading()}};t.search.subscribe(function(e){a._searchState=e,a.search.emit(e),i.search=e,i.pageInfo.pageSize=t.pageSize,a.lookupCmp.navigationFilter=null,a.lookupCmp.httpMgr.getData(i,"navsearch").subscribe(o)});var n=function(e){t.loadData({pageSize:e.pageInfo.pageSize,pageIndex:e.pageInfo.pageIndex,total:e.total,data:e.items}),a.selectLeftDataTableRow(e.items,t),t.cd.markForCheck()};t.pageChanged.subscribe(function(e){a.pageChanged.emit(e),a.lookupCmp.navigationFilter=null,a.lookupCmp.httpMgr.getData(e,"navsearch").subscribe(o)}),t.pageSizeChanged.subscribe(function(e){a.lookupCmp.navigationFilter=null,a.lookupCmp.httpMgr.getData(e,"navsearch").subscribe(o)}),t.columnSorted.subscribe(function(e){var t=I({},e),i=t.sortName,n=t.sortOrder;a.lookupCmp.navigationFilter=null;var s=Object.assign({sortName:i,sortOrder:n},a._searchState);a.lookupCmp.httpMgr.getData(s,"navsearch").subscribe(o)}),t.clearSearchValue.subscribe(function(){a._searchState=null}),this.selectLeftDataTableRow(this.navOptions.items,t)},de.prototype.initTreeTable=function(a){var o=this;a.virtualized=!0,a.nodeSelected.subscribe(function(e){o.selected.emit({data:e.node.data})}),a.nodeUnSelect.subscribe(function(e){o.selected.emit(null)}),a.fixedHeader=!0,this.lookupCmp.treeNodeHelper.updateTreeNodeExpanded(this.navOptions.items,this.navOptions.treeInfo),a.loadDataType=this.navOptions.treeInfo.loadDataType,this.navOptions.items=this.lookupCmp.checkNodeCanBeSelect(this.navOptions.items,"all"===this.navOptions.treeInfo.loadDataType),a.loadData(this.navOptions.items),this.lookupCmp.navSelectedIds?a.selectNode(this.lookupCmp.navSelectedIds):this.lookupCmp.selectFirstInNav&&a.selectFirstNode(),this.allData=this.navOptions.items;var r={next:function(e){o.closeLoading(),a.clearAll();var t=o.lookupCmp.checkNodeCanBeSelect(e.items,"all"===o.navOptions.treeInfo.loadDataType);a.loadData(t),a.resize()},error:function(e){o.closeLoading()}};a.search.subscribe(function(e){o._searchState=e,o.lookupCmp.navigationFilter=null,o.lookupCmp.httpMgr.getData({search:e},"navsearch").subscribe(r)}),a.columnSorted.subscribe(function(e){if(o.lookupCmp.navigationFilter=null,"all"===a.loadDataType)a.clientSort();else{var t=I({},e),i=t.sortName,n=t.sortOrder,s=Object.assign({sortName:i,sortOrder:n},o._searchState);o.lookupCmp.httpMgr.getData(s,"nav").subscribe(r)}}),a.clearSearchValue.subscribe(function(){o._searchState=null,a.loadData(o.allData)}),a.expand.subscribe(function(e){o.onNodeExpanded(e,a)})},de.prototype.onNodeExpanded=function(t,i){if(!(t.leaf||t.children&&t.children.length)){var e=this.navOptions.treeInfo;if("async"===this.navOptions.treeInfo.loadDataType){var n="",s=-1,a=I({},i.searchData),o=a.field,r=void 0===o?"*":o,l=a.value,c=void 0===l?"":l;if(t.showLoading=!0,i.detectChanges(),"parentId"===e.layerType)n=t.id;else{var p=e.dataField;p?(n=t.data[p][e.pathField],s=t.data[p][e.layerField]):console.log("未找到分级信息。")}if(!this.lookupCmp.uri)return void this.lookupCmp.expandTreeNode.emit({instance:i,node:t,parentIdOrPath:n,parentLayer:s,search:{value:c,field:r}});this.getChildren(n,s,{searchField:"*"===r?"*":r,searchValue:c},i).subscribe(function(e){i&&(t&&e.items&&e.items.length&&i.appendChildren(e.items,t),t.showLoading=!1,i.detectChanges())})}}},de.prototype.getChildren=function(e,t,i,n){var s=this.lookupCmp.gridOptions.uri,a=I({parentLayer:t,category:"nav"},i);"parentId"===this.navOptions.treeInfo.layerType?a.parentId=e:a.parentPath=e;var o={searchValue:JSON.stringify(a),customData:this.lookupCmp.customData,enableFullTree:!1,loadTreeDataType:"layerload"};return this.lookupCmp.helpId&&(o.helpId=this.lookupCmp.helpId),n&&n.sortName&&Object.assign(o,{sortName:n.sortName,sortOrder:n.sortOrder}),this.lookupCmp.http.getData(s,o)},de.prototype.loadData=function(){if(this.cmpRef.instance.allColumnsTitle=this.lookupCmp.allColumnsTitle,this.isTreeList()){var e=this.cmpRef.instance;this.initTreeTable(e)}else{var t=this.cmpRef.instance;this.initDataTable(t)}},de.decorators=[{type:v.Component,args:[{selector:"lookup-left",template:'<div style="height: 100%;position: relative;">\r\n    <ng-container #container></ng-container>\r\n</div>'}]}],de.ctorParameters=function(){return[{type:v.ComponentFactoryResolver},{type:v.ChangeDetectorRef}]},de.propDecorators={cmpContainer:[{type:v.ViewChild,args:["container",{read:v.ViewContainerRef}]}],selected:[{type:v.Output}],unselected:[{type:v.Output}],search:[{type:v.Output}],pageChanged:[{type:v.Output}]},de);function de(e,t){this.cfr=e,this.cd=t,this.selected=new v.EventEmitter,this.unselected=new v.EventEmitter,this.search=new v.EventEmitter,this.pageChanged=new v.EventEmitter,this._searchState=null,this.allData=null}var he=(ue.prototype.getComponentInstance=function(e){if(void 0===e&&(e="datatable"),!this.ins.componentRef||!this.ins.componentRef.instance)return null;if("selected"===e)return this.ins.multiSelectDT;var t=this.ins.componentRef.instance;if("leftDataTable"===e||"leftTree"===e){var i=this.ins.leftComponentRef;if(!(i&&i.instance&&i.instance.cmpRef&&i.instance.cmpRef.instance))return null;t=this.ins.leftComponentRef.instance.cmpRef.instance}switch("fav"===e&&(t=this.ins.favoritesComponentRef.instance),e){case"leftDataTable":case"fav":case"datatable":return t;case"leftTree":case"treetable":return t;default:return this.ins.isTree(),t}},ue.prototype.createComponentWithServerData=function(e){this.ins.componentRef||(this.ins.idField=e.idField||this.ins.idField,this.ins.textField=e.textField||this.ins.textField,this.ins.valueField=e.valueField||this.ins.valueField,this.ins.displayType=e&&e.displayType||this.ins.displayType||"LIST",this.ins.componentRef=this.createContent(this.ins.gridOptions),this.createFavoriteComponent(),this.resizeComponent())},ue.prototype.createFavoriteComponent=function(){if(this.ins.useFavorite&&!this.ins.favoritesComponentRef){this.ins.favoriteColumns=this.ins.favHelper.getFavoriteColumns();var e=Object.assign({},this.ins.gridOptions,{showFilterBar:!1,pagination:!1,columns:this.ins.favoriteColumns||[]});this.ins.favoritesComponentRef=this.createFavoritesContent(e),this.resizeComponent("fav")}},ue.prototype.createContent=function(e){if(!this.ins.componentRef){var t=this.ins.getComponentType(),i=this.ins.cfr.resolveComponentFactory(t),n=null;return n=this.ins.isDoublleList()?this.ins.centerContainer.createComponent(i):this.ins.contentContainer.createComponent(i),this.ins.isTree()?(e.fit=!0,e.pagination=!1):e.fill=!0,Object.assign(n.instance,e,{allColumnsTitle:this.ins.allColumnsTitle}),this.ins.componentRef=n,this.resizeComponent(),n}},ue.prototype.createFavoritesContent=function(e){var t,i=this.ins.getComponentType(),n=this.ins.cfr.resolveComponentFactory(i);return t=this.ins.favoritesContainer.createComponent(n),this.ins.isTree()?(e.fit=!0,e.pagination=!1):e.fill=!0,Object.assign(t.instance,e,{width:this.ins.dialog.size.width-20,height:this.ins.dialogMgr.getHeight()}),this.ins.favHelper.initFavoriteComponentEvent(t),t},ue.prototype.resizeComponent=function(e){void 0===e&&(e="datatable");var t={width:this.ins.dialog.size.width-20,height:this.ins.dialogMgr.getHeight()};!this.ins.isDoublleList()||"datatable"!==e&&"treetable"!==e||(t.width=this.ins.dialog.size.width-this.ins.leftPanelWidth-27),this.getComponentInstance(e).resize(t)},ue.prototype.createLeftComponent=function(e){var i=this,t=null;return this.ins.isDoublleList()&&(t=this.ins.cfr.resolveComponentFactory(pe)),this.ins.leftComponentRef=this.ins.leftContainer.createComponent(t),e.height=this.ins.dialogMgr.getHeight(),this.ins.dialogWidth<this.ins.navLookupDialogMinWidth&&(this.ins.dialogWidth=this.ins.navLookupDialogMinWidth,this.ins.dialog.reSize({width:this.ins.dialogWidth}),this.ins.resizeCmp({width:this.ins.dialog.size.width})),e.width!==this.ins.leftPanel.width&&(this.ins.leftPanel.resize({width:this.ins.leftPanel.width,height:e.height}),this.ins.resizeCmp({width:this.ins.dialog.size.width})),this.ins.leftComponentRef.instance.lookupCmp=this.ins,this.ins.leftComponentRef.instance.navOptions=e,this.ins.leftComponentRef.instance.selected.pipe(y.debounceTime(100),y.switchMap(function(e){e&&e.data?i.ins.navigationFilter={selected:e.data,idValue:i.getNavigationFilter(e.data),searchField:"",searchValue:""}:i.ins.navigationFilter=undefined;var t={pageInfo:{pageIndex:i.ins.gridOptions.pageIndex,pageSize:i.ins.gridOptions.pageSize}};return Object.assign(t,{search:i.ins._searchState}),i.ins.httpMgr.getData(t,"list")})).subscribe(function(e){i.ins.closeLoading(),i.ins.loadDataWhenOpen=!0,i.ins.useFavorite&&!i.ins.isTree()&&i.ins.favHelper.updateFavoritesStatus(e.items),i.ins.loadDataTableData(e),setTimeout(function(){i.ins.selectionMgr.selectCurrentValue(),i.ins.changeDetector.detectChanges()})}),this.ins.leftComponentRef.instance.createComponent()},ue.prototype.getNavigationFilter=function(n){if(this.ins.navigationOptions.relations&&this.ins.navigationOptions.relations.length){var s=[];return this.ins.navigationOptions.relations.forEach(function(e){var t=e.groupField,i={fieldName:e.helpField,fieldValue:""};i.fieldValue=t.split(".").reduce(function(e,t){return e[t]},n),s.push(i)}),s}return""},ue);function ue(e){this.ins=e}var fe=(ge.prototype.dialogClosed=function(){this.ins.displayText===this.ins.originalText||this.ins.nosearch||(this.ins.displayText=this.ins.originalText,this.ins.setModelValue(this.ins.displayText)),this.ins.componentRef&&(this.ins.componentRef.destroy(),this.ins.componentRef=null),this.ins.favoritesComponentRef&&(this.ins.favoritesComponentRef.destroy(),this.ins.favoritesComponentRef=null),this.ins.contentContainer&&this.ins.contentContainer.clear(),this.ins.centerContainer&&this.ins.centerContainer.clear(),this.ins.leftComponentRef&&(this.ins.leftComponentRef.destroy(),this.ins.leftComponentRef=null),this.ins.leftContainer&&this.ins.leftContainer.clear(),this.ins.isShow=!1,this.ins.isTextChange=!1,this.ins.dialog&&(this.ins.content=null),this.ins.navigationFilter=null,this.ins.lookupUtils.pendingEnd(),this.ins.helpId&&(this.ins.displayType=""),this.lookupInit&&(this.lookupInit.unsubscribe(),this.lookupInit=null),this.ins.favoriteItems=[],this.ins.isTabChanged=!1,this.ins.uri&&(this.ins.items=[]),this.ins._searchState=null,this.ins.pageIndex=1,this.ins.loadDataWhenOpen=this._loadDataWhenOpen,this.ins.navSelectedIds=this._navSelectedId,this.ins.selectFirstInNav=this._selectFirstInNav,this.ins.isGetAllChidlNodes=!1,this.ins.enableGetAllChildNodes=!0,this.ins.usePersionalConf&&"locale"!==this.ins.favoriteDataFrom&&this.ins.httpMgr.submitFavoriteData("dialog closed event."),this.keyDownHandler&&(this.keyDownHandler(),this.keyDownHandler=null),this.ins.inputGroup&&this.ins.inputGroup.focus(),this.ins.dialogClosed.emit()},ge.prototype.onDialogCreated=function(){var s=this;this._loadDataWhenOpen=this.ins.loadDataWhenOpen,this._navSelectedId=this.ins.navSelectedIds,this._selectFirstInNav=this.ins.selectFirstInNav,this.ins.dialogCreatedSubscription=this.ins.dialogCreated.subscribe(function(e){if(e){if(s.ins.dialogOpenedSubscription&&s.ins.dialogOpenedSubscription.unsubscribe(),s.ins.dialogClosedSubscription&&s.ins.dialogClosedSubscription.unsubscribe(),s.registerDialogEvent(),s.ins.isRecordSize){var t=s.ins.personalConfigService.getDialogSize();if(t){var i=t.width,n=t.height;s.ins.dialogWidth=i||s.ins.dialogWidth,s.ins.dialogHeight=n||s.ins.dialogHeight,e.width=s.ins.dialogWidth,e.height=s.ins.dialogHeight}}e.show()}})},ge.prototype.canOpenDialog=function(e){var t=!0;e!==undefined&&null!==e&&""!==e||(t=!0),"boolean"==typeof e&&(t=e),"object"==typeof e&&(t=e.showDialog===undefined||e.showDialog,e.hasOwnProperty("data")&&(this.ins.customData=e.data),this.ins.selectedIds=e.selectedIds||null,e.message&&this.ins.notifyService.warning(e.message)),this.ins.isReady=!1,this.ins.isShow=t},ge.prototype.getHeight=function(){return this.ins.dialog.size.contentHeight-this.ins.containerMargin.bottom-this.ins.containerMargin.top-(this.ins.useFavorite?40:0)},ge.prototype.getMainGridSize=function(){return this.ins.isDoublleList()?{width:this.ins.dialog.size.width-this.ins.leftPanel.width-27,height:this.getHeight()}:{width:this.ins.dialog.size.width-this.ins.containerMargin.left-this.ins.containerMargin.right,height:this.getHeight()}},ge.prototype.registerDialogEvent=function(){var t=this;this.ins.dialogOpenedSubscription=this.ins.dialog.opened.subscribe(function(){t.ins.gridOptions=Object.assign(t.ins.gridOptions,t.getMainGridSize()),t.ins.dialog.el.nativeElement.querySelector(".ps-content").style.height="100%",t.ins.displayType&&t.ins.customDisplayType&&(t.ins.componentRef=t.ins.lookupCmpMgr.createContent(t.ins.gridOptions),t.ins.lookupCmpMgr.createFavoriteComponent()),t.ins.initData(),t.ins.lookupUtils.pendingEnd(),t.ins.dialogOpened.emit()}),this.ins.subscriptions.push(this.ins.dialogOpenedSubscription),this.lookupInit=this.ins.lookupinitializationSubject.subscribe(function(){if(t.ins.loadDataWhenOpen=!0,t.registerShortcutKey(),t.ins.leftPanel){var e=t.ins.leftPanel.resizing.subscribe(function(e){t.ins.componentRef.instance.resize({width:t.ins.dialog.size.width-e.size.width-27,height:t.getHeight()}),t.ins.leftComponentRef.instance.resize(e.size)});t.ins.subscriptions.push(e)}}),this.ins.dialogClosedSubscription=this.ins.dialog.closed.subscribe(function(){t.ins.dialogMgr.dialogClosed()}),this.ins.subscriptions.push(this.ins.dialogClosedSubscription)},ge.prototype.registerShortcutKey=function(){var c=this,e=this.ins.dialog.el.nativeElement.querySelector(".farris-modal");e&&this.ins.shortcutKey&&!this.keyDownHandler&&(this.keyDownHandler=this.ins.eventManager.addEventListener(e,"keydown",function(e){e.stopPropagation();var t=c.ins.shortcutKey,i=t.moveUp,n=t.moveDown,s=t.searchFocus,a=t.confirm,o=t.nextPager,r=t.prevPager;if([i,n,t.expand,t.collapse].includes(e.code))c.ins.componentRef.instance.onKeydownEvent(e);else if(e.key===a){if("INPUT"===e.target.nodeName&&!e.ctrlKey)return;c.ins.okButton.nativeElement.click()}else if(e.code===s)e.preventDefault(),c.ins.componentRef.instance.inputGroup.focus();else if(!c.ins.isTree()&&(e.code===o||e.code===r)){var l=e.code===o;c.paginationKeyDownHandler(l)}}))},ge.prototype.paginationKeyDownHandler=function(e){void 0===e&&(e=!0);var t=this.ins.componentRef.instance,i=t.pageIndex,n=t.pageSize,s=t.total,a=i;e?a+=1:a-=1,(Math.ceil(s/n)<a||a<1)&&(a=i),this.ins.componentRef.instance.onPageChange({pageSize:n,pageIndex:a})},ge);function ge(e){this.ins=e,this.lookupInit=null,this._loadDataWhenOpen=!0,this._navSelectedId="",this._selectFirstInNav=!1,this.keyDownHandler=null}var ve=(Object.defineProperty(me.prototype,"idField",{get:function(){return this.ins.idField},enumerable:!0,configurable:!0}),me.prototype.initFavoriteItems=function(e){this.state.favoriteItems=e||[]},me.prototype.updateFavoriteData=function(t,e){var i=this;this.ins.savingFaoriteData||(this.state.favoriteItems=e===E?this.state.favoriteItems.concat([t]):this.state.favoriteItems.filter(function(e){return e[i.idField]!==t[i.idField]}),this.favoriteItems$.next({items:this.state.favoriteItems,action:e}))},me.prototype.loadSelections=function(e){this.state.selecteditems=k(e),this.state$.next(this.state)},me.prototype.getSelections=function(){return k(this.state.selecteditems)},me.prototype.select=function(e){e&&(this.state.selecteditems=k(this.state.selecteditems,[e]),this.state$.next(this.state))},me.prototype.unselectByPathcode=function(t){var e=this.ins.treeInfo,i=e.dataField,n=e.pathField;this.state.selecteditems=this.state.selecteditems.filter(function(e){return e[i][n]&&0!==e[i][n].indexOf(t)})},me.prototype.updateSelections=function(e,t){var i=this;void 0===t&&(t=!0),Array.isArray(e)||(e=[e]);var n=k(e),s=this.idField;if(t)this.state.selecteditems&&!this.state.selecteditems.length?this.state.selecteditems=n:n.map(function(e){return e[s]}).forEach(function(t,e){i.state.selecteditems.find(function(e){return e[s]==t})||i.state.selecteditems.push(n[e])});else if(e){var a=e.map(function(e){return e[s]});this.state.selecteditems=this.state.selecteditems.filter(function(e){return-1===a.indexOf(e[s])})}this.state$.next(this.state)},me.prototype.unSelect=function(t){var i=this;t&&(Array.isArray(t)?this.state.selecteditems=this.state.selecteditems.filter(function(e){return-1===t.indexOf(e[i.idField])}):this.state.selecteditems=this.state.selecteditems.filter(function(e){return e[i.idField]!=t}),this.state$.next(this.state))},me.prototype.clearSelections=function(){this.state.selecteditems=[],this.state$.next(this.state)},me);function me(e){this.ins=e,this.state={selecteditems:[],favoriteItems:[],quickItems:[]},this.state$=new u.BehaviorSubject(this.state),this.selected$=this.state$.pipe(y.switchMap(function(e){return u.of(e.selecteditems)})),this.favoriteItems$=new u.BehaviorSubject({items:this.state.favoriteItems,action:null}),this.quickItems$=this.state$.pipe(y.switchMap(function(e){return u.of(e.quickItems)}))}var ye,be={provide:n.NG_VALUE_ACCESSOR,useExisting:v.forwardRef(function(){return Ce}),multi:!0},Ce=(function Re(e,t){function i(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(Se,ye=P),Object.defineProperty(Se.prototype,"displayType",{get:function(){return this._displayType},set:function(t){if(t){var e=Object.values(D).findIndex(function(e){return e===t.toUpperCase()});if(-1<e){var i=Object.keys(D);this._displayType=D[i[e]]}}else this._displayType=t},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"gridOptions",{get:function(){return this.useFavorite&&this.columns&&0<this.columns.length&&!this.columns.find(function(e){return e.field===x})&&this.columns.push({field:x,title:"",width:40,align:"center",formatter:this.favHelper.favoriteColumnFormatter}),this._gridOptions=Object.assign(this._gridOptions,{singleSelect:this.singleSelect,idField:this.idField,uri:this.uri,showFilterBar:this.showFilterBar,pagination:this.pagination,pageIndex:this.pageIndex,pageSize:this.pageSize,pageList:this.pageList,total:this.total,items:this.items,columns:this.columns,resizableColumns:!0,fixedHeader:!0,hover:!0,treeInfo:this.treeInfo}),this._gridOptions},set:function(e){this._gridOptions=Object.assign({},this._gridOptions,e),this.selectedColumns=this.multiSelMgr.initSelectedColumns()},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"selections",{get:function(){var e=this.lookupSelectionSer.getSelections();return this.singleSelect?e[0]:e},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"usePersionalConf",{get:function(){return this.useFavorite||this.useTip||this.isRecordSize},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"displayTextList",{get:function(){return this.displayText?this.displayText.split(this.multipleChoiceSeparator):[]},enumerable:!0,configurable:!0}),Se.prototype.ngOnInit=function(){if(ye.prototype.ngOnInit.call(this),this.checkGridOptions(),this.displayInfo.title=this.title,this.http&&(this.http.context=this.context),this.allColumnsTitle=this.localService.getValue("lookup.allColumns"),this.mustWriteSomething=this.localService.getValue("lookup.mustWriteSomething"),this.mustChoosAdatarow=this.localService.getValue("lookup.mustChoosAdatarow"),this.addFavoriteSuccess=this.localService.getValue("lookup.favoriteInfo.addFav")||this.addFavoriteSuccess,this.delFavoriteSuccess=this.localService.getValue("lookup.favoriteInfo.cancelFav")||this.delFavoriteSuccess,this.dialogMgr.onDialogCreated(),this.usePersionalConf&&this.favHelper.initPersonalInfo(),this.useExtendInfo){var e=this.selectionMgr.getBindingData();this.updateExtendInfo(e,!1)}},Se.prototype.ngOnDestroy=function(){ye.prototype.ngOnDestroy.call(this),this.subscriptions.forEach(function(e){e&&(e.unsubscribe(),e=null)}),this.selectionMgr&&this.selectionMgr.destroy(),this.subscriptions=[]},Se.prototype.ngOnChanges=function(e){},Se.prototype.ngAfterViewInit=function(){if(ie.bind(this)(),"text"===this.viewType)this.render2.listen(this.inputGroup.textbox.nativeElement,"keydown.F2",this.showDialog.bind(this));else if(this.registerMouseEventForTagView(),this.tagboxHeight){var e=this.tagbox.nativeElement.querySelector(".multi-more"),t=this.tagboxHeight;"auto"!==t&&(t+="px",this.maxTagboxHeight&&this.render2.setStyle(e,"maxHeight",this.maxTagboxHeight+"px")),this.render2.setStyle(e,"height",t)}this.el&&this.farrisInstances&&this.farrisInstances.add(this.el.nativeElement,this)},Se.prototype.createInstance=function(){this.http=this.injector.get(A,null),this.messagerService=this.injector.get(o.MessagerService),this.loadingService=this.injector.get(c.LoadingService),this.notifyService=this.injector.get(C.NotifyService,null),this.personalConfigService=this.injector.get(W,null),this.lookupSelectionSer=new ve(this),this.utilService=new q(this),this.localService=this.injector.get(b.LocaleService),this.treeNodeHelper=new K(this),this.favHelper=new J(this),this.ttEventMgr=new ne(this),this.multiSelMgr=new ae(this),this.httpMgr=new le(this),this.lookupCmpMgr=new he(this),this.dialogMgr=new fe(this),this.selectionMgr=new Z(this),this.dtEventMgr=new X(this)},Se.prototype.showDialog=function(){var t=this;return this.disabled||this.readonly||(this.selectionMgr.initDisplayValue(),this.dictPickingSubscription=this.dictPicking({instance:this}).subscribe(function(e){t.dialogMgr.canOpenDialog(e)})),!1},Se.prototype.isDoublleList=function(){return this.displayType===D.NavList||this.displayType===D.NavTreeList},Se.prototype.isTree=function(){return this.displayType.toUpperCase()===D.TreeList},Se.prototype.onResized=function(e){this.resizeCmp(e.size),this.resized.emit(e.size)},Se.prototype.onResizing=function(e){this.resizing.emit(e.size),this.resizeCmp(e.size),this.isDoublleList()&&this.leftComponentRef&&this.leftComponentRef.instance.resize({width:this.leftPanel.width,height:this.dialogMgr.getHeight()})},Se.prototype.onMaxDialog=function(e){this.resizeCmp(e.size),this.leftPanel&&this.leftComponentRef.instance.resize({width:this.leftPanel.width,height:this.dialogMgr.getHeight()}),this.dialogMaxed.emit(e.size)},Se.prototype.resizeCmp=function(e){if(this.componentRef&&this.componentRef.instance){var t={width:(e=e||this.dialog.size).width-this.containerMargin.left-this.containerMargin.right,height:this.dialogMgr.getHeight()};this.useFavorite&&this.favoritesComponentRef&&this.favoritesComponentRef.instance.resize(t),this.isRecordSize&&(this.personalConf.size=this.dialog.size,this.personalConfigService.updatePersonalConfig({size:this.dialog.size})),this.isDoublleList()&&(t.width=e.width-this.leftPanel.width-27),this.componentRef.instance.resize(t)}},Se.prototype.checkGridOptions=function(){this.gridOptions.idField||console.warn("未设置主键字段 idField"),this.beforeSelectData||(this.beforeSelectData=function(){return u.of(!0)})},Se.prototype.getComponentType=function(){switch(this.displayType||(this.displayType="LIST"),this.displayType){case D.List:case D.NavList:case D.NavTreeList:return r.DataTableComponent;case D.TreeList:return l.TreeTableComponent}},Se.prototype.showLoading=function(e){if(void 0===e&&(e=""),this.dialog&&this.dialog.modalContent&&!this.loading){var t={container:this.dialog.modalContent,delay:200};e&&(t.message=e),this.loading=this.loadingService.show(t)}else this.loading=this.loadingService.show()},Se.prototype.closeLoading=function(){this.loading&&(this.loading.close(),this.loading=null),this.loadingService.clearAll()},Se.prototype.getSearchColumns=function(e){var i=e.columns||this.columns;return e.searchFields?e.searchFields.map(function(t){var e=i.find(function(e){return e.field.toLowerCase()===t.value.toLowerCase()});return e&&(t.label=e.title),t}):i?i.filter(function(e){return e.searchField}).map(function(e){return{label:e.title,value:e.field}}):[]},Se.prototype.initOptions=function(e){var t=this,i=u.of(!0);if(this.gridOptions.searchFields=this.getSearchColumns(e),e){if(e.columns&&e.columns.length&&(this.columns=e.columns),this.setLookupTitleText(e),this.isDoublleList()&&this.dialogWidth<this.navLookupDialogMinWidth&&!this.isRecordSize&&(this.dialogWidth=this.navLookupDialogMinWidth,this.dialog.reSize({width:this.dialogWidth})),this.customDisplayType||(this.displayType=e.displayType||this.displayType||"LIST",this.changeDetector.detectChanges(),this.lookupCmpMgr.createComponentWithServerData(e)),this.isDoublleList()&&e.navigation&&!this.leftComponentRef){if(this.navigationOptions=e.navigation,this.navigationOptions.hover=!0,this.navigationOptions.searchFields=this.getSearchColumns(this.navigationOptions),this.customNavFormatter&&(this.navigationOptions.columns.forEach(function(e){t.customNavFormatter[e.field]&&(e.formatter=t.customNavFormatter[e.field])}),this.navigationOptions.rowStyler=this.customNavFormatter.rowStyler,this.navigationOptions.cellStyler=this.customNavFormatter.cellStyler),this.displayType===D.NavTreeList){var n=this.navigationOptions.treeInfo.loadDataType;"default"!==this.loadTreeDataType&&(n="loadall"===this.loadTreeDataType?"all":"async"),this.navigationOptions.treeInfo.loadDataType=n}i=this.lookupCmpMgr.createLeftComponent(this.navigationOptions)}}else this.lookupCmpMgr.createContent(this.gridOptions),this.lookupCmpMgr.createFavoriteComponent();return this.isTextChange&&(this.componentRef.instance.searchData.value=this.displayText),this.customFormatter&&(this.columns.forEach(function(e){t.customFormatter[e.field]&&(e.formatter=t.customFormatter[e.field])}),this.customFormatter.rowStyler&&(this.componentRef.instance.rowStyler=this.customFormatter.rowStyler),this.customFormatter.cellStyler&&(this.componentRef.instance.cellStyler=this.customFormatter.cellStyler)),this.changeDetector.detectChanges(),i},Se.prototype.setLookupTitleText=function(e){e.displayInfo&&(this.displayInfo=e.displayInfo),this.title&&"此处显示帮助标题"!==this.title&&(this.displayInfo.title=this.title),this.displayInfo&&e.title&&(this.displayInfo.title||(this.displayInfo.title=e.title))},Se.prototype.showGetAllChildrenCheckbox=function(){this.isTree()&&this.treeInfo?this.enableGetAllChildNodes="all"!==this.treeInfo.loadDataType&&"pathcode"===this.treeInfo.layerType:this.enableGetAllChildNodes=!1},Se.prototype.initData=function(){var i=this,e={next:function(t){if(null===t)return i.isShow=!1,void(i.dialog&&i.dialog.close());i.initOptions(t).subscribe(function(){if(i.selectedColumns=i.multiSelMgr.initSelectedColumns(),i.favoriteColumns=i.favHelper.getFavoriteColumns(),i.usePersionalConf&&(i.personalConfigService.getPersonalData()||i.personalConfigService.savePersonalConfig(i.personalConf)),i.isTabChanged||i.lookupSelectionSer.loadSelections(t.selectedItems||[]),i.isDoublleList()&&(i.navSelectedIds||i.selectFirstInNav)&&(i.loadDataWhenOpen=!1),i.loadData(t),i.isTree()){if("datalist"===i.activeTab){var e=i.componentRef.instance;"all"===e.loadDataType&&e.searchData.value&&i.items&&i.items.length&&e.toggleExpand(i.items[0],!0)}i.showGetAllChildrenCheckbox()}i.isTextChange=!1,i._searchResult=null,i.closeLoading(),i.isReady=!0,i.changeDetector.detectChanges(),i.lookupinitializationSubject.next()})},error:function(e){i.closeLoading(),i._searchResult=null,i.isTextChange=!1,i.hasError=!0,i.changeDetector.detectChanges(),"string"==typeof e?i.messagerService.error(e):(e&&(e.Message?i.messagerService.error(e.Message):e.error?i.messagerService.error(e.error.Message):i.messagerService.error("应用服务器错误,请联系系统管理员！")),console.log(e))}},t={pageInfo:{pageSize:this.pageSize||20,pageIndex:1}};if(this.isTextChange&&(t={search:{field:"*",value:this.displayText}}),!this.isTabChanged&&this.enableToSelect){var n=this.selectionMgr.getSelectedIds();n&&n.length?t.selectedInfo={selected:!0,selectedIds:n}:this.selectedIds&&(t.selectedInfo={selected:!0,selectedIds:this.selectedIds})}this.showLoading(),this.hasError=!1,this.httpMgr.lookupRequest(t,"all").pipe(y.map(function(e){return e?e.selectedItems=e.selectedData||[]:e&&"object"==typeof e&&(e.selectedItems=[]),e})).subscribe(e)},Se.prototype.loadData=function(e,t){if(void 0===t&&(t=!0),"datalist"===this.activeTab)switch(this.useFavorite&&!this.isTree()&&this.favHelper.updateFavoritesStatus(e.items),this.displayType){case D.NavList:case D.NavTreeList:case D.List:this.loadDataTableData(e),t&&this.dtEventMgr.bindDataTableEvent();break;case D.TreeList:this.loadTreeTableData(e,t)}else"favorite"===this.activeTab&&this.loadFavData(e);this.selectionMgr.selectCurrentValue()},Se.prototype.loadFavData=function(e){var t=this;if(this.useFavorite){if(this.isTree&&this.setTreeInfo(e),this.isTree()){var i=this.favHelper.initFavoriteTreeData(e.items),n=this.treeNodeHelper.flatTreeNodes(i).map(function(e){return e.data._addtional_=e.addtional,e.data});this.lookupSelectionSer.initFavoriteItems(n),setTimeout(function(){t.favoritesComponentRef.instance.scrollToY(1)})}else this.lookupSelectionSer.initFavoriteItems(e.items);this.favHelper.loadFavoritesData(e)}},Se.prototype.loadDataTableData=function(e){e&&(this.gridOptions?(this.items=e.items,this.total=e.total||e.items.length,e.pageInfo?(!e.pageInfo.pageList||this.pageList&&this.pageList.length||(this.pageList=e.pageInfo.pageList),this.pagination=e.pageInfo.enablePager,this.pageIndex=e.pageInfo.pageIndex,this.pageSize=e.pageInfo.pageSize):this.pagination=!1):this.gridOptions=e),this.updateDataTable(this.gridOptions)},Se.prototype.updateDataTable=function(e){if(e){var t=this.componentRef.instance;t.columns&&0!==t.columns.length||(t.columns=this.gridOptions.columns),t.allColumnsTitle=this.allColumnsTitle,t.searchFields=e.searchFields,t.pagination=e.pagination,t.pageList=this.pageList,t.remoteSort=this.remoteSort,this.loadDataWhenOpen&&(t.loadData({pageSize:e.pageSize,pageIndex:this.gridOptions.pageIndex,total:this.gridOptions.total,data:this.gridOptions.items}),t.cd.markForCheck()),this.loadSuccess.emit()}},Se.prototype.setTreeInfo=function(e){if(e){var t=null;if(e.treeInfo){var i=e.treeInfo.onlySelectLeaf,n="no";i!==undefined&&(n=i?"yes":"no"),t=I({},e.treeInfo,{onlySelectLeaf:n})}if(this.gridOptions.treeInfo){var s=this.gridOptions.treeInfo;s&&(s.onlySelectLeaf!==undefined&&null!==s.onlySelectLeaf||(s.onlySelectLeaf="no"),"boolean"==typeof s.onlySelectLeaf&&(s.onlySelectLeaf=s.onlySelectLeaf?"yes":"no"),"default"===this.loadTreeDataType?s.loadDataType=t.loadDataType:s.loadDataType="loadall"===this.loadTreeDataType?"all":"async","default"!==s.onlySelectLeaf&&(t=Object.assign(t,s)))}this.treeInfo=t}},Se.prototype.loadTreeTableData=function(e,t){var i=this;void 0===t&&(t=!0);var n=e?e.items:this.gridOptions.items;if(this.items=n,e){this.setTreeInfo(e);var s=this.gridOptions.treeInfo;s.treeDataIsInit||("pathcode"===s.layerType.toLowerCase()?this.items=this.lookupUtils.makeTree(this.items,s):this.items=this.lookupUtils.makeTreeWithParentID(this.items,"",s.dataField+"."+s.parentField,this.idField))}if(this.componentRef.instance instanceof l.TreeTableComponent){var a=this.componentRef.instance;this.treeInfo&&(a.loadDataType=this.treeInfo.loadDataType),t&&this.ttEventMgr.bindTreetableEvent();var o="default"===i.loadTreeDataType?"all"===a.loadDataType:"loadall"===i.loadTreeDataType;this.items=this.checkNodeCanBeSelect(this.items,o),a.keepSelect=!0,this.useFavorite&&this.favHelper.updateFavoritesStatus(this.items),this.loadDataWhenOpen&&a.loadData(this.items),a.resize()}},Se.prototype.checkNodeCanBeSelect=function(e,t){var i=this;return void 0===t&&(t=!1),e&&e.length?e.map(function(e){return e.hasOwnProperty("addtional")&&(e.selectable=!e.addtional),e.children&&e.children.length?i.checkNodeCanBeSelect(e.children,t):t&&(e.leaf=!0),e}):e},Se.prototype.onChanges=function(e){e?(this.displayText=e,this.isTextChange=!0,this.nosearch&&this.setModelValue(e),this.onModelTouched(e),this.valueChanged.emit(e),this.textChanged.emit(e)):this.onClear()},Se.prototype.onClear=function(e){if(void 0===e&&(e=!0),this.isTextChange=!1,this.displayText="",this.displayValue="",this.originalText="",this.extendInfo="",this.setModelValue(""),this.mappingFn)this.mappingFn(null,this.mapFields);else if(this.mapFields){var t=this.selectionMgr.getBindingData();t&&this.defaultMapping.lookupFieldMap(null,this.mapFields,t)}this.multiSelMgr.clear(),e&&this.clear.emit()},Se.prototype.clearValue=function(e){void 0===e&&(e=!0),this.onClear(e)},Se.prototype.selectItem=function(e){var t=this,i=null;if(e?i=e:(i=this.selections)?Array.isArray(i)&&!i.length&&(i=null):i=null,this.okHandler)this.okHandler({data:i,instance:this});else if(this.beforeSelectData){var n=this.beforeSelectData({instance:this,data:i});n&&n.subscribe?n.subscribe(function(e){t._beforeSelectDataCallBack(e,i)}):console.error("帮助数据选中前事件未返回值或返回类型非Observable, 请检查")}else this._beforeSelectDataCallBack(!0,i)},Se.prototype.getParentPathCode=function(n){for(var e,t,i=this.treeInfo,s=i.dataField,a=i.pathField,o=i.layerField,r=(e=n,t=function(e){return e[s][o]},Math.max.apply(Math,k(e.map("function"==typeof t?t:function(e){return e[t]})))),l=function(t){var e=n.filter(function(e){return e[s][o]===t});e&&e.length&&e.length<n.length&&e.forEach(function(e){var t=e[s][a],i=n.filter(function(e){return e[s][a]!==t&&0===e[s][a].indexOf(t)});i&&i.length&&(n=n.filter(function(e){return e[s][a]!==t}))})},c=1;c<=r;c++)l(c);return n},Se.prototype._beforeSelectDataCallBack=function(e,s){var a=this,t=e,i="";if("boolean"==typeof e?t=e:"object"==typeof e?(t=e.canSelect,i=e.message):t=!1,s||(i=this.mustChoosAdatarow,t=!1),t){var n=u.of(s);if(!this.singleSelect&&this.enableCascade&&this.isTree()&&"all"!==this.treeInfo.loadDataType&&"pathcode"===this.treeInfo.layerType&&this.isGetAllChidlNodes){var o=this.getParentPathCode(s);o&&o.length&&(o=o.map(function(e){return e[a.treeInfo.dataField][a.treeInfo.pathField]}),this.showLoading(),n=this.httpMgr.getData({parentsIds:o},"allChildren").pipe(y.map(function(e){var t=e.items?e.items.map(function(e){return e.data}):[],i=k(s,t),n=i.map(function(e){return e[a.idField]});return(n=Array.from(new Set(n))).map(function(t){return i.find(function(e){return e[a.idField]===t})})})))}n.subscribe(function(e){a.closeLoading(),a.updateControlValue(e),a.useTip&&e&&a.useTip&&a.personalConfigService.updateQueckSelected(e,a.localService.localeId)})}else i&&(this.notifyService?this.notifyService.warning(i):this.messagerService.warning(i,"",!0,function(){a.dialog.el.nativeElement.click()}))},Se.prototype.updateControlValue=function(e){if(e){if(this.setDisplayText(e),this.mappingFn?this.mappingFn(e,this.mapFields,this.bindingData):this.mapFields&&this.bindingData&&this.defaultMapping.lookupFieldMap(e,this.mapFields,this.bindingData),this.setModelValue(this.displayText),this.inDatagrid&&e){var t=Array.isArray(e)?e:[e];this.updateBindData(t)}this.selectedData.emit(e),this.runDictPickedEvent(e),this.isTextChange=!1}else document.activeElement&&document.activeElement.blur(),this.messagerService.warning(this.mustChoosAdatarow)},Se.prototype.updateBindData=function(n){var s=this;if(this.mapFields){var e=Object.keys(this.mapFields);if(this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var a=this.ngControl.formDirective.form.bindingData;a&&e.forEach(function(i){s.mapFields[i].split(",").forEach(function(e){var t=n.map(function(e){return s.utils.getValue(i,e)}).join(s.multipleChoiceSeparator);s.utils.setValue(a,e,t)})})}}},Se.prototype.getExtendInfoFields=function(e){var i=this;if(void 0===e&&(e=!0),!this.extInfoFields)return console.warn("未设置扩展字段。"),[];var t=this.extInfoFields.split(",");return e?t.map(function(t){var e=Object.keys(i.mapFields).find(function(e){return i.mapFields[e]===t});return e||(console.warn("在帮助映射字段中未找到"+t),"")}):t},Se.prototype.onUpdateExtendInfo=function(){var e=this.selectionMgr.getBindingData();this.updateExtendInfo(e,!1)},Se.prototype.updateExtendInfo=function(e,t){var i=this;if(void 0===t&&(t=!0),e)if(this.extInfoFormatter)if(Array.isArray(e)){var n=e.map(function(e){return i.getExtendInfoText(e)});this.extendInfo=n.join("，")}else this.extendInfo=this.getExtendInfoText(e);else{var s=this.getExtendInfoFields(t);s&&s.length&&(Array.isArray(e)?(n=e.map(function(e){return i.getExtendInfoText(e,s)}),this.extendInfo=n.join("，")):this.extendInfo=this.getExtendInfoText(e,s))}},Se.prototype.getExtendInfoText=function(n,e){var s=this;if(void 0===e&&(e=null),"function"==typeof this.extInfoFormatter)return this.extInfoFormatter({bindingData:n,instance:this});var a=[];return e.map(function(e){var t,i=s.utils.getValue(e,n);return a.push(i),(t={})[e]=i,t}),a.join(" ")},Se.prototype.getDisplayText=function(e){var n=this,s=this.displayFields?this.displayFields.split(","):[this.textField],t=e.map(function(t){var i=[];return s.forEach(function(e){i.push(n.utils.getValue(e,t))}),i.join(n.displayTextSeparator)});return this.gridOptions.singleSelect?t.join(""):this.displayFields?t.map(function(e){return"["+e+"]"}).join(","):t.join(",")},Se.prototype.setDisplayText=function(e){var t=this;if(this.originalText=this.displayText,this.gridOptions.singleSelect){if(this.displayFormatter)if(this.displayText=this.utils.getValue(this.textField,e),this.isTree()){var i=this.componentRef.instance;this.displayText=this.displayFormatter(this.displayText,[e],{lookup:this,tree:i})}else this.displayText=this.displayFormatter(this.displayText,[e],{lookup:this,datatable:this.componentRef.instance});else this.displayText=this.getDisplayText([e]);this.displayValue=e[this.valueField]}else e.length&&(this.displayFormatter?(this.displayText=e.map(function(e){return t.utils.getValue(t.textField,e)}).join(this.multipleChoiceSeparator),this.isTree()?(i=this.componentRef.instance,this.displayText=this.displayFormatter(this.displayText,e,{lookup:this,tree:i})):this.displayText=this.displayFormatter(this.displayText,e,{lookup:this,datatable:this.componentRef.instance})):this.displayText=this.getDisplayText(e),this.displayValue=e.map(function(e){return t.utils.getValue(t.valueField,e)}).join(this.multipleChoiceSeparator));this.originalText=this.displayText},Se.prototype.runDictPickedEvent=function(t){var i=this;this.dictPicked?(this.okButton&&(this.okButton.nativeElement.disabled=!0),this.dictPickedSubscription=this.dictPicked(t).subscribe(function(e){i.okButton&&(i.okButton.nativeElement.disabled=!1),"boolean"==typeof e?e&&i.closeDialog(t):"object"!=typeof e||e.closeDialog===undefined||e.closeDialog?i.closeDialog(t):e.message?i.messagerService.warning(e.message):i.closeDialog(t)})):this.closeDialog(t)},Se.prototype.focusToInput=function(){var e=this;this.zone.runOutsideAngular(function(){setTimeout(function(){e.inputGroup&&e.inputGroup.textbox&&e.inputGroup.textbox.nativeElement.focus()})})},Se.prototype.closeDialog=function(e){void 0===e&&(e=null),this.isShow=!1,this.dialog&&this.dialog.close(),e&&this.multiSelMgr.save(e),this.focusToInput()},Se.prototype.cancelSelect=function(){this.closeDialog(),this.isTextChange=!1,this.nosearch||(this.displayText=this.originalText,this.setModelValue(this.displayText)),this.cancelHandler&&this.cancelHandler(this)},Se.prototype.setModelValue=function(e){this.onModelChange&&(this.onModelChange(e),this.valueChanged.emit(e))},Se.prototype.onTabChange=function(e){var t=this;this.activeTab=e.tabIndex,this.personalConf.tabIndex=this.activeTab;var i=this.isTabChanged;if(this.isTabChanged=!0,this.personalConfigService.updatePersonalConfig({tabIndex:e.tabIndex}),"datalist"===this.activeTab){if(this.isDoublleList()&&!this.leftComponentRef){if(!this.navigationOptions)return void this.initData();this.lookupCmpMgr.createLeftComponent(this.navigationOptions)}this.items&&this.items.length?i||(this.isTree()?this.loadTreeTableData():(this.loadDataTableData(),this.dtEventMgr.bindDataTableEvent())):this.initData(),this.showGetAllChildrenCheckbox()}else"favorite"===this.activeTab&&(this.isTree()?this.initData():this.favoriteItems&&this.favoriteItems.length&&this.favoriteItems.length===this.favHelper.getFavoritIds().length?i||this.favHelper._loadFavoriteData(this.favoriteItems):this.initData());this.changeDetector.detectChanges(),setTimeout(function(){if(t.resizeCmp(),t.isTree()){var e=t.componentRef.instance.state.scrollY;t.componentRef.instance.scrollToY(e,0),t.enableCascade&&t.ttEventMgr.cascadeValueChanged(t.cascadeStatus),t.selectionMgr.selectCurrentValue()}})},Se.prototype.registerMouseEventForTagView=function(){this.enableClear&&(this.tagbox.nativeElement.addEventListener("mouseenter",this.onTagboxMouseEnter.bind(this)),this.tagbox.nativeElement.addEventListener("mouseleave",this.onTagboxMouseLeave.bind(this)))},Se.prototype.toggleClearIcon=function(e,t){void 0===t&&(t=!1);var i=t?"":"none",n=e.target.querySelector(".input-group-clear");n&&(n.style.display=i)},Se.prototype.onTagboxMouseEnter=function(e){this.displayText&&this.enableClear&&(this.readonly||this.disabled||(this.showTagboxClearButton=!0)),this.showTagboxClearButton&&this.toggleClearIcon(e,!0)},Se.prototype.onTagboxMouseLeave=function(e){this.toggleClearIcon(e)},Se.prototype.onRemoveSelectItem=function(e,t){e.stopPropagation();var i=Array.from(this.displayTextList),n=this.displayTextList.indexOf(t);if(i.splice(n,1),this.displayText=i.join(this.multipleChoiceSeparator),this.setModelValue(this.displayText),this.displayValue){var s=this.displayValue.split(this.multipleChoiceSeparator);s.splice(n,1),this.displayValue=s.join(this.multipleChoiceSeparator)}this.mapFields&&this.updateOtherFieldDataWhenTagremoved(n),this.tagRemoved.emit({removedIndex:n,instance:this})},Se.prototype.updateOtherFieldDataWhenTagremoved=function(s){var a=this,e=Object.keys(this.mapFields),t=e.indexOf(this.textField);if(this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var o=this.ngControl.formDirective.form.bindingData;if(o.setValue){var i=this.ngControl.formDirective.form.bindingPath,r=[];i&&(r=i.split("/").filter(function(e){return""!==e})),e.forEach(function(e){a.mapFields[e].split(",").forEach(function(e){var t=r.concat(e.split(".")),i=o.getValue(t).split(a.multipleChoiceSeparator);i.splice(s,1);var n=i.join(a.multipleChoiceSeparator);o.setValue(r.concat(t),n,!0,!0)})})}}else this.bindingData&&(-1<t&&e.splice(t,1),e.forEach(function(e){a.mapFields[e].split(",").forEach(function(e){var t=a.utils.getValue(e,a.bindingData).split(a.multipleChoiceSeparator);t.splice(s,1);var i=t.join(a.multipleChoiceSeparator);a.utils.setValue(a.bindingData,e,i)})}))},Se.prototype.onAllChildNodesClick=function(e){this.isGetAllChidlNodes=!this.isGetAllChidlNodes},Se.decorators=[{type:v.Component,args:[{selector:"farris-lookup-grid",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-06-16 13:44:59\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-18 08:47:32\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n <input-group #inputgroup\r\n    *ngIf="viewType === \'text\'"\r\n    [groupText]="groupIcon"\r\n    [lookup-tip]= "useTip"\r\n    [(ngModel)]="displayText"\r\n    [disabled]="disabled"\r\n    [readonly]="readonly"\r\n    [editable]="editable"\r\n    [customCls]="\'lookupbox\'"\r\n    [placeholder]="\'lookup.placeholder\' | locale: \'请选择\': placeholder"\r\n    [enableClear]="enableClear"\r\n    [useExtendInfo]="useExtendInfo"\r\n    [extendInfo]="extendInfo"\r\n    [maxLength]="maxLength"\r\n    (updateExtendInfo)="onUpdateExtendInfo()"\r\n    [textAlign]="textAlign"\r\n    [value]="displayText"\r\n    (valueChange)="onChanges($event)"\r\n    (clickHandle)="showDialog()"\r\n    (clear)="onClear()"\r\n></input-group>\r\n\r\n\r\n<div  #tagbox  class="input-group" [class.f-state-disabled]="disabled" [class.f-state-readonly]="readonly" *ngIf="viewType === \'tag\'" [attr.title]="displayText">\r\n    <div class="form-control f-cmp-inputgroup--multi-wrapper multi-more" style="height: auto; min-height: 24px;">\r\n        <div class="multi--content">\r\n            <span class="multi--item" *ngFor="let txt of displayTextList; let index" title="" style="cursor: default;padding: 0 5px;\r\n            background: #ebf7fe;\r\n            border: 1px solid #cfedff;\r\n            position: relative;\r\n            padding-right: 20px;\r\n            margin-right: 3px;margin-top: 1px;">\r\n                {{txt}}\r\n                <i class="f-icon f-icon-close" *ngIf="!readonly && !disabled" style="cursor: pointer;position:absolute; right: 2px" (click)="onRemoveSelectItem($event, txt)"></i>\r\n            </span>\r\n        </div>\r\n        \x3c!-- <div class="multi--more" *ngIf="selections && selections.length">\r\n            <i class="f-icon multi--more-icon"></i><span class="multi--more-text">{{selections.length}}</span>\r\n        </div> --\x3e\r\n    </div>\r\n    <div class="input-group-append"  title="" >\r\n        <span class="input-group-text input-group-clear" style="display: none;" (click)="onClear()">\r\n            <i class="f-icon modal_close"></i>\r\n        </span>\r\n        <span class="input-group-text" (click)="showDialog()">\r\n            <span class="f-icon f-icon-lookup"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n\r\n\r\n<farris-dialog\r\n    #dialog\r\n    *ngIf="isShow"\r\n    [draggable]="draggable"\r\n    [resizable]="resizable"\r\n    [title]="displayInfo.title"\r\n    [beforeOpen]="beforeOpen"\r\n    [beforeClose]="beforeClose"\r\n    [(width)]="dialogWidth"\r\n    [(height)]="dialogHeight"\r\n    [showButtons]="showButtons"\r\n    [showMaxButton]="showMaxButton"\r\n    [showCloseButton]="true"\r\n    [buttons]="buttonsRef || defaultButtonRef"\r\n    [buttonAlign]="buttonAlign"\r\n    [enableScroll]="false"\r\n    [dialogHeaderHeight]="50"\r\n    (maxed)="onMaxDialog($event)"\r\n    (resized)="onResized($event)"\r\n    (resizing)="onResizing($event)"\r\n>\r\n    <div [ngStyle]="containerStyle" [style.height.px]="dialogHeight - 46 - 56">\r\n        <lookup-tabs (tabChange)="onTabChange($event)" [enableFav]="useFavorite" [activeTab]="activeTab"\r\n            [enableSelected]="showSelected && !singleSelect" [selectedTotal]="(currentSelectedItems | async)?.length">\r\n            <div datalist style="position: relative;" [style.height.px]="useFavorite ? dialogHeight - 46 - 56 - 40 : dialogHeight - 46 - 56">\r\n                <layout [direction]="\'h\'" [fill]="true" *ngIf="isDoublleList()">\r\n                    <layout-panel #leftPanel [width]="leftPanelWidth" region="west" [minWidth]="10" [showBorder]="false" >\r\n                        <ng-container #leftContainer></ng-container>\r\n                    </layout-panel>\r\n                    <layout-panel region="center" [showBorder]="false">\r\n                        <ng-container #centerContainer></ng-container>\r\n                    </layout-panel>\r\n                </layout>\r\n                \r\n                <ng-container *ngIf="!isDoublleList()" #contentContainer></ng-container>\r\n            </div>\r\n            <div favorites [style.height.px]="dialogHeight - 46 - 56 - 40" style="position: relative; "  *ngIf="useFavorite" >\r\n                <ng-container #favoritesContainer></ng-container>\r\n            </div>\r\n            <div selected [style.height.px]="dialogHeight - 46 - 5 -40" style="position: relative;"  *ngIf="showSelected" >\r\n                <farris-datatable #multiSelectDT\r\n                    [height]="gridOptions?.height"\r\n                    [pagination]="false" [fill]="true"\r\n                    [columns]="selectedColumns"\r\n                    [data]="currentSelectedItems | async"\r\n                    [remoteSort]="false"\r\n                    (cellClick)="multiSelMgr?.onSelectedTableCellClick($event)"\r\n                >\r\n                </farris-datatable>\r\n            </div>\r\n        </lookup-tabs>\r\n\r\n    </div>\r\n</farris-dialog>\r\n\r\n<ng-template #defaultButtonRef>\r\n    \r\n    <div class="flex-fill" style="text-align: left;" *ngIf="isReady && enableCascade && displayType===\'TREELIST\' && singleSelect === false">\r\n        <select class="form-control" style="width: auto; display: inline-block" (ngModelChange)="ttEventMgr?.cascadeValueChanged($event)" [ngModel]="cascadeStatus" name="cascadeStatus">\r\n            <option value="enable">{{ \'lookup.cascade.enable\' | locale: \'同步选择\' }}</option>\r\n            <option value="up">{{ \'lookup.cascade.up\' | locale: \'包含上级\' }}</option>\r\n            <option value="down">{{ \'lookup.cascade.down\' | locale: \'包含下级\' }}</option>\r\n            <option value="disable" >{{ \'lookup.cascade.disable\' | locale: \'仅选择自身\' }}</option>\r\n        </select>\r\n\r\n        <button class="btn btn-link" style="display: inline-block;margin-left: 10px;padding-left: 0;"\r\n            *ngIf="enableGetAllChildNodes" (click)="onAllChildNodesClick($event)">\r\n            <span class="f-icon f-icon-checkbox"[class.f-icon-checkbox-checked]="isGetAllChidlNodes"\r\n                style="margin-right: 5px; font-size: 14px;color: #0089FF;"></span>{{\'lookup.getAllChilds\'|locale: \'获取所有子级数据\'}}</button>\r\n\r\n    </div>\r\n\r\n    <button type="button" class="btn btn-secondary btn-lg" (click)="cancelSelect()" [disabled]="!(isReady || hasError)" >\r\n        {{ \'lookup.cancelText\' | locale: \'取消\' }}\r\n    </button>\r\n    <button #okbtn type="button" [disabled]="!isReady"  class="btn btn-primary btn-lg" (click)="selectItem()" >\r\n        {{ \'lookup.okText\' | locale: \'确定\' }}\r\n    </button>\r\n   \r\n    \r\n</ng-template>\r\n',providers:[be,t.ShortcutsService,j,B,W],encapsulation:v.ViewEncapsulation.None,exportAs:"lookup",styles:[".input-group{flex-wrap:nowrap}.ng-dirty.ng-invalid>input-group>.lookupbox{border-color:#ff0303}.lookup-clear{cursor:pointer;background:#fff!important}.lookup-clear:hover{background:#e9ecef!important}.f-lookup-favorite{cursor:pointer;color:#ff9800}.f-lookup-unfavorite{cursor:pointer;color:#dd2438}.lookup-tip{position:absolute;min-width:200px;max-height:400px;padding:.25rem 0;z-index:7777;background:#fff;box-shadow:0 2px 8px 0 rgba(0,0,0,.15);border-radius:2px}.lookup-tip .lookup-tip-header{font-weight:700;padding:.25rem .475rem;border-radius:0}.lookup-tip ul{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;padding-left:0;margin-bottom:0}.lookup-tip ul li{position:relative;display:block;width:100%;margin-bottom:-1px;padding:.25rem .875rem;color:rgba(0,0,0,.85);background-color:#fff;cursor:pointer}.lookup-tip ul li:hover{background-color:#e6f7ff}"]}]}],Se.ctorParameters=function(){return[{type:v.Injector},{type:v.ComponentFactoryResolver},{type:v.ElementRef},{type:g.CommonUtils},{type:j},{type:v.ChangeDetectorRef},{type:t.ShortcutsService},{type:B},{type:v.NgZone},{type:v.Renderer2}]},Se.propDecorators={customDisplayType:[{type:v.Input}],viewType:[{type:v.Input}],displayType:[{type:v.Input}],enableClear:[{type:v.Input}],remoteSort:[{type:v.Input}],condition:[{type:v.Input}],showCheckAll:[{type:v.Input}],singleSelect:[{type:v.Input}],multipleChoiceSeparator:[{type:v.Input}],idField:[{type:v.Input}],uri:[{type:v.Input}],beUri:[{type:v.Input}],showFilterBar:[{type:v.Input}],pagination:[{type:v.Input}],pageIndex:[{type:v.Input}],pageSize:[{type:v.Input}],pageList:[{type:v.Input}],total:[{type:v.Input}],columns:[{type:v.Input}],remoteSearch:[{type:v.Input}],searchOnServer:[{type:v.Input}],nosearch:[{type:v.Input}],maxLength:[{type:v.Input}],mappingFn:[{type:v.Input}],items:[{type:v.Input}],favoriteItems:[{type:v.Input}],customData:[{type:v.Input}],bindingData:[{type:v.Input}],treeInfo:[{type:v.Input}],enableCascade:[{type:v.Input}],cascadeStatus:[{type:v.Input}],placeholder:[{type:v.Input}],showSelected:[{type:v.Input}],useFavorite:[{type:v.Input}],favoriteDataFrom:[{type:v.Input}],useTip:[{type:v.Input}],isRecordSize:[{type:v.Input}],userId:[{type:v.Input}],enableToSelect:[{type:v.Input}],enableFindText:[{type:v.Input}],expandLevel:[{type:v.Input}],loadTreeDataType:[{type:v.Input}],loadDataWhenOpen:[{type:v.Input}],navSelectedIds:[{type:v.Input}],selectFirstInNav:[{type:v.Input}],enableFullTree:[{type:v.Input}],displayFormatter:[{type:v.Input}],displayFields:[{type:v.Input}],displayTextSeparator:[{type:v.Input}],helpId:[{type:v.Input}],textAlign:[{type:v.Input}],enableTitle:[{type:v.Input}],useExtendInfo:[{type:v.Input}],extInfoFields:[{type:v.Input}],extInfoFormatter:[{type:v.Input}],extendInfo:[{type:v.Input}],customFormatter:[{type:v.Input}],customNavFormatter:[{type:v.Input}],okHandler:[{type:v.Input}],cancelHandler:[{type:v.Input}],tagboxHeight:[{type:v.Input}],maxTagboxHeight:[{type:v.Input}],enableGetAllChildNodes:[{type:v.Input}],shortcutKey:[{type:v.Input}],beforeSelectData:[{type:v.Input}],selectedData:[{type:v.Output}],clear:[{type:v.Output}],search:[{type:v.Output}],valueChanged:[{type:v.Output}],loadSuccess:[{type:v.Output}],pagerChanged:[{type:v.Output}],expandTreeNode:[{type:v.Output}],textChanged:[{type:v.Output}],checkedChange:[{type:v.Output}],tagRemoved:[{type:v.Output}],gridOptions:[{type:v.Input}],contentContainer:[{type:v.ViewChild,args:["contentContainer",{read:v.ViewContainerRef}]}],favoritesContainer:[{type:v.ViewChild,args:["favoritesContainer",{read:v.ViewContainerRef}]}],leftContainer:[{type:v.ViewChild,args:["leftContainer",{read:v.ViewContainerRef}]}],centerContainer:[{type:v.ViewChild,args:["centerContainer",{read:v.ViewContainerRef}]}],multiSelectDT:[{type:v.ViewChild,args:["multiSelectDT"]}],inputGroup:[{type:v.ViewChild,args:["inputgroup"]}],leftPanel:[{type:v.ViewChild,args:["leftPanel"]}],tagbox:[{type:v.ViewChild,args:["tagbox"]}],okButton:[{type:v.ViewChild,args:["okbtn"]}]},Se);function Se(e,t,i,n,s,a,o,r,l,c){var p=ye.call(this,e,i,a)||this;return p.injector=e,p.cfr=t,p.el=i,p.utils=n,p.defaultMapping=s,p.changeDetector=a,p.shortcuts=o,p.lookupUtils=r,p.zone=l,p.render2=c,p.groupIcon='<i class="f-icon f-icon-lookup"></i>',p._displayType="",p.customDisplayType=!1,p.viewType="text",p.enableClear=!0,p.remoteSort=!0,p.showCheckAll=!1,p.singleSelect=!0,p.multipleChoiceSeparator=",",p.beUri="",p.showFilterBar=!0,p.pagination=!0,p.pageIndex=1,p.pageSize=20,p.pageList=[10,20,30,50,100],p.total=0,p.columns=[],p.remoteSearch=!0,p.searchOnServer=!0,p.nosearch=!1,p.favoriteItems=[],p.enableCascade=!1,p.cascadeStatus="enable",p.placeholder="",p.showSelected=!1,p.useFavorite=!1,p.favoriteDataFrom="remote",p.useTip=!1,p.isRecordSize=!1,p.enableToSelect=!0,p.enableFindText=!1,p.expandLevel=-1,p.loadTreeDataType="default",p.loadDataWhenOpen=!0,p.navSelectedIds="",p.selectFirstInNav=!1,p.enableFullTree=!0,p.displayFormatter=undefined,p.displayFields="",p.displayTextSeparator="_",p.helpId="",p.textAlign="left",p.enableTitle=!0,p.useExtendInfo=!1,p.extInfoFields="",p.extendInfo="",p.customFormatter=null,p.customNavFormatter=null,p.okHandler=null,p.cancelHandler=null,p.tagboxHeight="auto",p.enableGetAllChildNodes=!0,p.shortcutKey={open:"ArrowRight",confirm:"Enter",searchFocus:"F3",moveUp:"ArrowUp",moveDown:"ArrowDown",expand:"ArrowRight",collapse:"ArrowLeft",nextPager:"PageDown",prevPager:"PageUp"},p.selectedData=new v.EventEmitter,p.clear=new v.EventEmitter,p.search=new v.EventEmitter,p.valueChanged=new v.EventEmitter,p.loadSuccess=new v.EventEmitter,p.pagerChanged=new v.EventEmitter,p.expandTreeNode=new v.EventEmitter,p.textChanged=new v.EventEmitter,p.checkedChange=new v.EventEmitter,p.tagRemoved=new v.EventEmitter,p.containerMargin={top:0,bottom:5,left:10,right:10},p.containerStyle={marginLeft:p.containerMargin.left+"px",marginRight:p.containerMargin.right+"px",marginTop:p.containerMargin.top+"px",marginBottom:p.containerMargin.bottom+"px"},p._gridOptions=V,p.leftPanelWidth=320,p.navLookupDialogMinWidth=960,p.navigationFilter=null,p.subscriptions=[],p.isTextChange=!1,p.isTabChanged=!1,p.displayInfo=Object.assign({},_),p.tabChangeSubscription=null,p.personalConf={},p.favoriteColumns=[],p._searchState=null,p.allData=[],p.allColumnsTitle="所有列",p.mustWriteSomething="请输入关键字后查询。",p.mustChoosAdatarow="请选择一条记录！",p.addFavoriteSuccess="收藏成功。",p.delFavoriteSuccess="移除收藏成功。",p.searching=!1,p._searchResult=null,p.lookupinitializationSubject=new u.Subject,p.currentSelectedItems=u.of([]),p.selectedColumns=[],p.activeTab="datalist",p.favHelper=null,p.ttEventMgr=null,p.multiSelMgr=null,p.httpMgr=null,p.lookupCmpMgr=null,p.dialogMgr=null,p.selectionMgr=null,p.dtEventMgr=null,p.lookupSelectionSer=null,p.controlId="",p.savingFaoriteData=!1,p.isReady=!1,p.showTagboxClearButton=!1,p.hasError=!1,p.isGetAllChidlNodes=!1,p.selectedIds=[],p.farrisInstances=null,p.createInstance(),p.currentSelectedItems=p.lookupSelectionSer.selected$,p.eventManager=p.injector.get(d.EventManager),p.farrisInstances=p.injector.get(g.FarrisComponentInstanceService,null),p}var Ie=(Te.prototype.ngOnChanges=function(e){e.activeTab&&!e.activeTab.isFirstChange()&&this.initInkBarPos(e.activeTab.currentValue)},Te.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){e.initInkBarPos(e.activeTab)},300)},Te.prototype.navClickHandle=function(e,t){e.stopPropagation(),this.activeTab=t,this.tabChange.emit({event:e,tabIndex:t}),this.initInkBarPos(t)},Te.prototype.initInkBarPos=function(e){if(this.enableFav||this.enableSelected){var t=this.dataListNavRef.nativeElement.offsetWidth,i=0;"datalist"!==e&&(i=this.dataListNavRef.nativeElement.offsetWidth),"favorite"===e?t=this.favoriteNavRef.nativeElement.offsetWidth:"selected"===e&&(this.favoriteNavRef&&(i+=this.favoriteNavRef.nativeElement.offsetWidth),this.selectedNavRef?t=this.selectedNavRef.nativeElement.offsetWidth:this.activeTab="datalist"),this.inkBarRef.nativeElement.style="width: "+t+"px; transform: translate3d("+i+"px, 0px, 0px);"}},Te.prototype.ngOnInit=function(){},Te.decorators=[{type:v.Component,args:[{selector:"lookup-tabs",template:'<div class="lookup-tabs-nav" *ngIf="enableFav || enableSelected">\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'datalist\'" (click)="navClickHandle($event, \'datalist\')" #dataListNav>{{ \'lookup.datalist\' | locale: \'数据列表\' }}</div>\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'favorite\'" *ngIf="enableFav" (click)="navClickHandle($event, \'favorite\')" #favoriteNav>{{ \'lookup.favorites\' | locale: \'收藏夹\' }}</div>\r\n    <div class="nav-item" [class.nav-item-selected]="activeTab === \'selected\'"  *ngIf="enableSelected" (click)="navClickHandle($event, \'selected\')" #selectedNav>{{ \'lookup.selected\' | locale: \'已选数据\' }}\r\n        <div class="lookup-selected-total" style="background: #0068f3;display: inline-block;\r\n        color: white;border-radius: 10px;padding: 0 5px; text-align: center;">\r\n        {{ selectedTotal }}\r\n        </div>\r\n    </div>\r\n    <div class="tabs-ink-bar tabs-ink-bar-animated" #inkBar></div>\r\n</div>\r\n<div class="lookup-tabs-content">\r\n    <div class="lookup-datalist" style="height:100%"  @flyInOut *ngIf="activeTab === \'datalist\'">\r\n        <div style="height: 100%">\r\n            <ng-content select="[datalist]"></ng-content>\r\n        </div>\r\n    </div>\r\n    <div class="lookup-favorites" style="height:100%" @flyInOut *ngIf="activeTab === \'favorite\'" >\r\n        <div style="height: 100%">\r\n            <ng-content select="[favorites]"></ng-content>\r\n        </div>\r\n    </div>\r\n    <div class="lookup-selected" style="height:100%" @flyInOut *ngIf="activeTab === \'selected\'">\r\n        <div  style="height: 100%">\r\n            <ng-content select="[selected]"></ng-content>\r\n        </div>\r\n    </div>\r\n</div>',animations:[p.trigger("flyInOut",[p.transition(":enter",[p.style({opacity:0}),p.animate(".3s",p.style({opacity:1}))]),p.transition(":leave",[p.animate(".3s",p.style({opacity:0}))])])],styles:[":host{display:-webkit-box;display:flex;height:100%;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}:host .lookup-tabs-nav{position:relative;display:inline-block;box-sizing:border-box;margin:0;padding-left:0;list-style:none;-webkit-transition:-webkit-transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1)}:host .lookup-tabs-nav .nav-item{position:relative;display:inline-block;text-decoration:none;box-sizing:border-box;padding:.625rem .8125rem;color:inherit;cursor:pointer}:host .lookup-tabs-nav .nav-item-selected{color:#1890ff}:host .lookup-tabs-nav .tabs-ink-bar{position:absolute;bottom:1px;left:0;z-index:1;box-sizing:border-box;height:2px;background-color:#1890ff;-webkit-transform-origin:0 0;transform-origin:0 0}:host .lookup-tabs-nav .tabs-ink-bar-animated{-webkit-transition:width .3s cubic-bezier(.645,.045,.355,1),left .3s cubic-bezier(.71,.03,.35,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1);transition:transform .3s cubic-bezier(.645,.045,.355,1),width .3s cubic-bezier(.645,.045,.355,1),left .3s cubic-bezier(.71,.03,.35,1),-webkit-transform .3s cubic-bezier(.645,.045,.355,1)}:host .lookup-tabs-content{-webkit-box-flex:1;flex:1;border-top:1px solid #cecece;position:relative;top:-2px}"]}]}],Te.ctorParameters=function(){return[{type:v.Injector}]},Te.propDecorators={enableFav:[{type:v.Input}],enableSelected:[{type:v.Input}],selectedTotal:[{type:v.Input}],activeTab:[{type:v.Input}],tabChange:[{type:v.Output}],inkBarRef:[{type:v.ViewChild,args:["inkBar"]}],dataListNavRef:[{type:v.ViewChild,args:["dataListNav"]}],favoriteNavRef:[{type:v.ViewChild,args:["favoriteNav"]}],selectedNavRef:[{type:v.ViewChild,args:["selectedNav"]}]},Te);function Te(e){this.injector=e,this.enableFav=!1,this.enableSelected=!1,this.selectedTotal=0,this.activeTab="datalist",this.tabChange=new v.EventEmitter,this.render=null,this.el=null,this.personalConfigService=this.injector.get(W,null),this.render=this.injector.get(v.Renderer2),this.el=this.injector.get(v.ElementRef)}var ke=(xe.prototype.ngOnInit=function(){var t=this;this.tipText=this.localService.getValue("lookup.tipText"),this.enableTip=!1,this.enableTip&&(this.inputRef.iconMouseEnter.subscribe(function(e){t.creatPanel()}),this.inputRef.iconMouseLeave.pipe(y.delay(200)).subscribe(function(e){t.isInTipPanel||t.removePanel()}),this.inputRef.clickHandle.subscribe(function(e){t.removePanel()}))},xe.prototype.ngAfterViewInit=function(){},xe.prototype.getQuickSelectedByLocaleId=function(){var e=this.localService.localeId,t=this.personalConfigService.getPersonalData();if(t&&t.quickSelected){var i=t.quickSelected[e];if(i&&i.length)return i}return null},xe.prototype.creatPanel=function(){var n=this;if(this.selected=this.getQuickSelectedByLocaleId(),!(this.tipPanel||!this.selected||this.selected&&0===this.selected.length)){var e=this.setPosition(),s=this.renderer.createElement("ul");this.personalConfigService.textField.split("."),this.selected.forEach(function(e,t){var i=n.renderer.createElement("li");i.innerHTML=n.find(e,n.personalConfigService.textField),n.renderer.setProperty(i,"id",t),n.renderer.appendChild(s,i)});var t=this.renderer.createElement("div");this.renderer.addClass(t,"lookup-tip-header"),t.innerHTML=this.tipText,this.tipPanel=this.renderer.createElement("div"),this.renderer.appendChild(this.tipPanel,t),this.renderer.appendChild(this.tipPanel,s),this.renderer.addClass(this.tipPanel,"lookup-tip"),this.renderer.setStyle(this.tipPanel,"top",e.top),this.renderer.setStyle(this.tipPanel,"left",e.left),this.renderer.setStyle(this.tipPanel,"width",e.width),this.renderer.appendChild(document.body,this.tipPanel),this.leaveEvent=this.renderer.listen(this.tipPanel,"mouseleave",function(){n.removePanel()}),this.enterEvent=this.renderer.listen(this.tipPanel,"mouseenter",function(){n.isInTipPanel=!0}),this.clickEvent=this.renderer.listen(this.tipPanel,"click",function(e){"LI"===e.target.nodeName&&n.selectItem(e.target.id)})}},xe.prototype.removePanel=function(){document.body.contains(this.tipPanel)&&(this.renderer.removeChild(document.body,this.tipPanel),this.tipPanel=null,this.isInTipPanel=!1,this.leaveEvent(),this.enterEvent(),this.clickEvent())},xe.prototype.setPosition=function(){var e=this.inputRef.inputGroup.nativeElement.getBoundingClientRect(),t=e.left,i=e.top,n=e.width;return{left:t+"px",top:i+e.height+"px",width:n+"px"}},xe.prototype.selectItem=function(i){var e=this.selected.find(function(e,t){return Number(i)===t});this.removePanel(),this.personalConfigService.singleSelect?this.personalConfigService.selectItemObser$.next(e):this.personalConfigService.selectItemObser$.next([e])},xe.prototype.find=function(e,t){var i=t.split("."),n=e[i[0]];return n instanceof Object?(i.shift(),this.find(n,i.join("."))):n},xe.decorators=[{type:v.Directive,args:[{selector:"[lookup-tip]"}]}],xe.ctorParameters=function(){return[{type:m.InputGroupComponent},{type:v.Renderer2},{type:v.Injector}]},xe.propDecorators={enableTip:[{type:v.Input,args:["lookup-tip"]}]},xe);function xe(e,t,i){this.inputRef=e,this.renderer=t,this.injector=i,this.enableTip=!1,this.isInTipPanel=!1,this.tipText="您要找的是不是这些？",this.personalConfigService=this.injector.get(W,null),this.localService=this.injector.get(b.LocaleService)}var De=(Fe.decorators=[{type:v.NgModule,args:[{imports:[i.CommonModule,n.FormsModule,g.FarrisCommonModule.forRoot(),a.FarrisDialogModule.forRoot(),o.MessagerModule.forRoot(),C.NotifyModule.forRoot(),c.LoadingModule.forRoot({delay:1e3}),m.InputGroupModule,s.LayoutModule,r.DataTableModule,l.TreeTableModule,b.LocaleModule.forRoot()],exports:[Ce,P],declarations:[Ce,P,pe,Ie,ke],providers:[],entryComponents:[r.DataTableComponent,l.TreeTableComponent,pe,Ie]}]}],Fe);function Fe(){}e.LookupUtils=B,e.LookupDefaultMapping=j,e.LookupLeftComponent=pe,e.LOOKUPGRID_VALUE_ACCESSOR=be,e.LookupGridComponent=Ce,e.DisplayInfo=z,e.lookupGridDefaults=V,e.displayInfoDefault=_,e.LOOKUPINPUT_VALUE_ACCESSOR=M,e.LookupComponent=P,e.ServerSideToken=A,e.LookupModule=De,e.PersonalConfigService=W,e.LookupTabsComponent=Ie,e.LookupTipDirective=ke,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-lookup.umd.min.js.map