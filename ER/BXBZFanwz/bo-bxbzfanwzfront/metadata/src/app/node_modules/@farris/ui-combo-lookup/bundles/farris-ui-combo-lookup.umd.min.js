!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@farris/ui-lookup"),require("rxjs"),require("@angular/core"),require("@farris/ui-datatable"),require("@farris/ui-treetable"),require("@farris/ui-input-group"),require("@angular/common"),require("@angular/forms"),require("@farris/ui-loading"),require("@farris/ui-combo-list")):"function"==typeof define&&define.amd?define("@farris/ui-combo-lookup",["exports","rxjs/operators","@farris/ui-lookup","rxjs","@angular/core","@farris/ui-datatable","@farris/ui-treetable","@farris/ui-input-group","@angular/common","@angular/forms","@farris/ui-loading","@farris/ui-combo-list"],t):t((e.farris=e.farris||{},e.farris["ui-combo-lookup"]={}),e.rxjs.operators,e.uiLookup,e.rxjs,e.ng.core,e.uiDatatable,e.uiTreetable,e.uiInputGroup,e.ng.common,e.ng.forms,e.uiLoading,e.uiComboList)}(this,function(e,o,t,s,l,n,r,i,a,c,p,u){"use strict";var d=(h.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],h.ctorParameters=function(){return[]},h.ngInjectableDef=l.defineInjectable({factory:function(){return new h},token:h,providedIn:"root"}),h);function h(){}var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var m,g=function(){return(g=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b={provide:c.NG_VALUE_ACCESSOR,useExisting:l.forwardRef(function(){return y}),multi:!0},y=(function I(e,t){function n(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(v,m=u.BaseComboComponent),Object.defineProperty(v.prototype,"columns",{get:function(){var t=this,e=this._columns!==undefined&&0<this._columns.length?this._columns:this.comboService.columns;return this.useTreeView&&1<e.length&&(e=e.filter(function(e){return e.field===t.textField})),e},set:function(e){this._columns=e},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"pagination",{get:function(){return this._pagination!==undefined?this._pagination:!(!this.comboService.pageInfo||!this.pageInfo.enablePager)&&this.pageInfo.enablePager},set:function(e){this._pagination=e},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"displayType",{get:function(){return this.comboService.displayType},set:function(e){this.comboService.displayType=e+""},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"treeCmpRef",{get:function(){return this._treeCmpRef},set:function(e){e&&(e.cascadeCheck=this.cascade.enable,e.cascadeDown=this.cascade.down,e.cascadeUp=this.cascade.up,this.tt$.next(e)),this._treeCmpRef=e},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"tableCmpRef",{set:function(t){var n=this;t&&this.pagination&&this._tableCmpRef&&this.loaded$.pipe(o.take(1)).subscribe(function(e){t.loadData({pageSize:n.pageInfo.pageSize,total:n.pageInfo.total,data:n.data,pageIndex:n.pageInfo.pageIndex})}),!this._tableCmpRef&&this.loadFinish&&t&&(t.loadData({pageSize:this.pageInfo.pageSize,total:this.pageInfo.total,data:this.data,pageIndex:this.pageInfo.pageIndex}),this._tableCmpRef=t)},enumerable:!0,configurable:!0}),v.prototype.ngOnInit=function(){var t=this;m.prototype.ngOnInit.call(this),this.treeClientSearch.pipe(o.debounceTime(300)).subscribe(function(e){!t.remoteSearch&&t.treeCmpRef&&t.treeCmpRef.searchHandle.search(t.textField,e)}),this.comboService.treeInfo$.subscribe(function(e){e&&"default"===t.loadTreeDataType&&(t.loadDataType=e.loadDataType)})},v.prototype.onSelectionsChange=function(e){var t=this;"LOOKUPLIST"===this.displayType?(this.multiSelect?(this.ownSelections={},this.comboService.selections.forEach(function(e){t.ownSelections[e[t.idField]]=e})):this.ownSelections=e[0]?e[0]:{},this.pageInfo=g({},this.pageInfo,this.comboService.pageInfo),this.loadFinish=!0,this.cdr.detectChanges(),this.loaded$.next(this.pageInfo)):this.treeCmpRef?this.initTreeData():this.tt$.pipe(o.take(1)).subscribe(function(e){t.treeCmpRef=e,t.initTreeData()})},v.prototype.initTreeData=function(){var t=this,e=this.comboService.selections.filter(function(e){return null!==e&&e!==undefined}),n=[];this.ownSelections=e.map(function(e){return n.push(e[t.idField]),{data:e,id:e[t.idField]}}),this.treeCmpRef.selections=this.ownSelections,this.treeCmpRef.checkeds=this.ownSelections,this.comboService.data&&this.comboService.data.length&&this.treeCmpRef.checkValues&&this.treeCmpRef.checkValues.length&&(this.multiSelect&&this.treeCmpRef.checkedNodes(this.treeCmpRef.checkValues),this.treeCmpRef.selectNodes(this.treeCmpRef.checkValues))},v.prototype.initDatasChangeAction=function(){},v.prototype.isTree=function(){return"LOOKUPTREELIST"===this.displayType},v.prototype.updateMappingFieldValue=function(r){var i=this;if(void 0===r&&(r=!1),this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var a=this.ngControl.formDirective.form.bindingData,e=this.ngControl.formDirective.form.bindingPath,s=[];e&&(s=e.split("/").filter(function(e){return""!==e})),this.mappingField=this.mappingField?this.mappingField:{},this.mapFields&&Object.keys(this.mapFields).forEach(function(t){var e=i.mapFields[t]?i.mapFields[t]:"",n="";if(!r){var o=i.comboService.selections&&i.comboService.selections.map(function(e){return i.comboService.getValueByObj(t,e)}).filter(function(e){return null!==e}).join(i.separator);n=o||""}e&&e.split(",").forEach(function(e){var t=n;i.nosearch&&e===i.ngControl.name&&(t=i.displayText),a.setValue?a.setValue(s.concat(e.split(".")),t,!0,!0):i.commonUtils.setValue(a,e,n)})})}},v.prototype.updateSelectedValues=function(){if(this.ngControl&&this.ngControl.formDirective&&this.ngControl.formDirective.form&&this.ngControl.formDirective.form.bindingData){var e=this.ngControl.formDirective.form.bindingData,t=this.ngControl.formDirective.form.bindingPath,n=[];t&&(n=t.split("/").filter(function(e){return""!==e}));var o=this.mappingField?this.mapFields[this.idField]:"";o&&-1<o.indexOf(",")&&(o=o.split(",")[0]),o&&e.getValue?this.selectedValues=e.getValue(n.concat(o.split(".")))||"":o&&(this.selectedValues=this.commonUtils.getValue(o,e)||"")}},v.prototype.onSelectRows=function(e){if("LOOKUPLIST"===this.displayType){var t=e.data,n=e.index;this.comboService.selectItem(t,n),this.selectChange.emit({data:t,index:n,instance:this})}else if("LOOKUPTREELIST"===this.displayType){var o=e.node;e.nodes?this.comboService.selectItem(e.nodes.map(function(e){return e.data})):this.comboService.selectItem(o.data),this.selectChange.emit(o)}this.updateTextAndValues(),this.multiSelect||this.comboService.isOpen$.next(!1)},v.prototype.onUnSelectRows=function(e){if("LOOKUPLIST"===this.displayType){var t=e.data;this.comboService.unSelectItem(t)}else if("LOOKUPTREELIST"===this.displayType){var n=e.node;this.comboService.unSelectItem(n.data),this.selectChange.emit(n)}this.updateTextAndValues()},v.prototype.onCheckAll=function(e){var t,n=[];n="LOOKUPTREELIST"===this.displayType?(t=e.checked,this.treeCmpRef.state.rowNodes.filter(function(e){return e.node.selectable===undefined||e.node.selectable}).map(function(e){return e.node.data})):(t=e,this.data),t?this.comboService.selectAll(n):this.comboService.unSelectAll(n),this.updateTextAndValues()},v.prototype.updateTextAndValues=function(){this.selectedValues=this.comboService.getValue(this.idField);var e=this.comboService.getValue(this.textField);this.onValueChange({text:e,value:this.selectedValues,selections:this.selections})},v.prototype.onKeyup=function(e){},v.prototype.onKeydown=function(e){"Tab"===e.code&&this.hide(!1)},v.prototype.onPageChanged=function(t){var n=this;this.uri?this.getData(t).subscribe(function(e){return n.comboService.loadLookUpDataTable(e,!!t.sortName)}):this.pageChanged.emit(t)},v.prototype.onPageSizeChanged=function(t){var n=this;this.uri?this.getData(t).subscribe(function(e){return n.comboService.loadLookUpDataTable(e,!!t.sortName)}):this.pageSizeChanged.emit(t)},v.prototype.onColumnSorted=function(e){var t=this,n=g({},e),o=n.sortName,r=n.sortOrder;this.getData({sortName:o,sortOrder:r},"search").subscribe(function(e){t.comboService.loadLookUpDataTable(e,!0)})},v.prototype.onClear=function(){this.ownSelections=[],this.isTree()&&this.treeCmpRef&&this.treeCmpRef.clearAll(),m.prototype.onClear.call(this)},v.prototype.getData=function(e,t){void 0===t&&(t="all"),e=e||{},this._searchKeyWords&&(e.search={field:"*",value:this._searchKeyWords});var n=this.buildQueryParams(e,t);return this.comboService.getData(n)},v.prototype.buildQueryParams=function(e,t){void 0===t&&(t="all");var n={},o={category:t};return e&&(e.pageInfo&&(n.pageIndex=e.pageInfo.pageIndex,n.pageSize=e.pageInfo.pageSize),e.search&&(o.searchField=e.search.field,o.searchValue=e.search.value),e.sortName&&(o.sortName=e.sortName),e.sortOrder&&(o.sortOrder=e.sortOrder)),n.searchValue=JSON.stringify(o),this.customData&&(n.customData=this.customData),n},v.prototype.filterDataOnServer=function(e,t){if(this.isOpen){var n={search:{field:t,value:e}};e?this._searchKeyWords=e:(this._searchKeyWords="",n=null);var o=this.buildQueryParams(n,"search");this.comboService.serachValue$.next(o)}},v.prototype.onExpandNode=function(e){},v.decorators=[{type:l.Component,args:[{selector:"farris-combo-lookup",template:'<input-group\r\n    #input\r\n    [attr.title]="enableTitle ? displayText : \'\'"\r\n    [class.actived]="isOpen"\r\n    [(value)]="displayText"\r\n    [forcePlaceholder]="forcePlaceholder"\r\n    [disabled]="disabled"\r\n    [readonly]="readonly"\r\n    [editable]="editable"\r\n    [groupText]="groupIcon"\r\n    [placeholder]="placeholder"\r\n    [enableClear]="enableClear"\r\n    (clickHandle)="onClick()"\r\n    (inputClick)="onInputclick($event)"\r\n    (blurHandle)="onBlur($event)"\r\n    (focusHandle)="onFocus($event)"\r\n    (valueChange)="onTextChange($event)"\r\n    (clear)="onClear()"\r\n    (keyupHandle)="onKeyup($event)"\r\n    (keydownHandle)="onKeydown($event)"\r\n    [maxLength]="maxLength" \r\n    style="display: block;"\r\n>\r\n</input-group>\r\n<div class="comboPanel f-area-hide" *ngIf="isOpen" [ngStyle]="comPosition" #comboPanel style="overflow: hidden;" >\r\n    <farris-datatable\r\n        *ngIf="displayType === \'LOOKUPLIST\'"\r\n        #dt\r\n        [width]="panelWidth"\r\n        [height]="panelHeight"\r\n        [columns]="columns"\r\n        [data]="comboService.data$ | async"\r\n        [selections]="ownSelections"\r\n        [idField]="idField"\r\n        [singleSelect]="!multiSelect"\r\n        [pagination] = "pagination"\r\n        [pageSize]="pageInfo.pageSize"\r\n        [pageIndex]="pageInfo.pageIndex"\r\n        [pageList]="pageInfo.pageList"\r\n        [total]="pageInfo.total"\r\n        [pagerViewMode]="\'simple\'"\r\n        [showPageInfo]="false" \r\n        [showPageNumber]="false" \r\n        [showPageList]="false"\r\n        [remoteSort]="false"\r\n        [showHeader]="showHeader"\r\n        (selectRows)="onSelectRows($event)"\r\n        (unSelectRow)="onUnSelectRows($event)"\r\n        (checkAll)="onCheckAll($event)"\r\n        (pageChanged)="onPageChanged($event)"\r\n        (pageSizeChanged)="onPageSizeChanged($event)"\r\n        (columnSorted)="onColumnSorted($event)"\r\n    ></farris-datatable>\r\n\r\n    <farris-treetable\r\n        #tt\r\n        *ngIf="displayType === \'LOOKUPTREELIST\'"\r\n        \r\n        [showHeader]="!useTreeView && showHeader"\r\n        [showBorder]="!useTreeView" \r\n        [showHeader]="!useTreeView"\r\n        [expandLevel]="expandLevel"\r\n        [virtualized]="true"\r\n\r\n        [columns]="columns"\r\n        [singleSelect]="!multiSelect"\r\n        [idField]="idField"\r\n        [data]="comboService.data$ | async"\r\n        [checkOnSelect]="true"\r\n        [selectOnCheck]="true"\r\n        [fixedHeader]="true"\r\n        [showCheckbox]="multiSelect"\r\n        [fit]="true"\r\n        [remoteSort]="false"\r\n        [loadDataType]="loadDataType"\r\n        (nodeSelected)="onSelectRows($event)"\r\n        (nodeUnSelect)="onUnSelectRows($event)"\r\n        (nodeChecked)="onSelectRows($event)"\r\n        (nodeUnChecked)="onUnSelectRows($event)"\r\n        (checkAll)="onCheckAll($event)"\r\n        (unCheckAll)="onCheckAll($event)"\r\n        (expand)="onExpandNode($event)"\r\n    ></farris-treetable>\r\n</div>\r\n\x3c!--\r\n    [width]="panelWidth"\r\n    [height]="panelHeight"\r\n     --\x3e',encapsulation:l.ViewEncapsulation.None,providers:[b,u.ComboService,t.LookupUtils]}]}],v.ctorParameters=function(){return[{type:l.ElementRef},{type:l.ChangeDetectorRef},{type:undefined,decorators:[{type:l.Inject,args:[a.DOCUMENT]}]},{type:l.Renderer2},{type:u.ComboService},{type:l.Injector}]},v.propDecorators={showHeader:[{type:l.Input}],useTreeView:[{type:l.Input}],columns:[{type:l.Input}],pagination:[{type:l.Input}],displayType:[{type:l.Input}],expandLevel:[{type:l.Input}],treeCmpRef:[{type:l.ViewChild,args:["tt"]}],tableCmpRef:[{type:l.ViewChild,args:["dt"]}],cascade:[{type:l.Input}],treeInfo:[{type:l.Input}],loadTreeDataType:[{type:l.Input}],enableFullTree:[{type:l.Input}],pageChanged:[{type:l.Output}],pageSizeChanged:[{type:l.Output}]},v);function v(e,t,n,o,r,i){var a=m.call(this,e,t,n,o,r,i)||this;return a.el=e,a.cdr=t,a.document=n,a.render=o,a.comboService=r,a.injector=i,a.panelHeight=300,a.comPosition={"height.px":a.panelHeight},a.showHeader=!0,a.useTreeView=!1,a.expandLevel=-1,a.cascade={enable:!1,up:!1,down:!1},a.loadTreeDataType="default",a.enableFullTree=!0,a.pageChanged=new l.EventEmitter,a.pageSizeChanged=new l.EventEmitter,a.loadFinish=!1,a.pageInfo={pageSize:20,pageIndex:1,total:0},a.tt$=new s.Subject,a.loaded$=new s.Subject,a._searchKeyWords="",a.loadDataType="all",a}var S=(C.decorators=[{type:l.NgModule,args:[{declarations:[y],imports:[a.CommonModule,c.FormsModule,n.DataTableModule,r.TreeTableModule,i.InputGroupModule,p.LoadingModule.forRoot()],exports:[y],providers:[u.ComboLocaleService]}]}],C);function C(){}e.ComboLookupService=d,e.ComboLookupComponent=y,e.ComboLookupModule=S,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-combo-lookup.umd.min.js.map