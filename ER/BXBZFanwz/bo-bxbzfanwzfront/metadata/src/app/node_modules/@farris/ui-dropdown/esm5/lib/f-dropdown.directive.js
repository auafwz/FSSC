/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, Output, HostBinding, EventEmitter, ElementRef, Renderer2 } from '@angular/core';
import { Subject } from 'rxjs';
var FDropdownDirective = /** @class */ (function () {
    function FDropdownDirective(elementRef, render) {
        var _this = this;
        this.render = render;
        // tslint:disable-next-line:no-input-rename
        this._internalOpen = false;
        // 计算宽度
        this._calculateMenu = false;
        // 是否自动纠正位置
        this.autoRectify = false;
        this.dpChangeEvent = new EventEmitter();
        this._placement = 'bottom'; // 记录 position
        // 记录 position
        this.isSubDP = false; // 是否是子下拉
        this.isOpenState = new Subject();
        this._seflEl = elementRef.nativeElement;
        this.isOpenState.subscribe((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            if (_this._internalOpen !== state) {
                _this._internalOpen = state;
                if (_this._internalOpen) {
                    _this.render.addClass(_this._seflEl, 'show');
                }
                else {
                    _this.render.removeClass(_this._seflEl, 'show');
                }
            }
        }));
    }
    Object.defineProperty(FDropdownDirective.prototype, "forceState", {
        // 在外面强制控制关闭状态
        set: 
        // 在外面强制控制关闭状态
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value && value.length) {
                this.close();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FDropdownDirective.prototype, "openState", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._internalOpen = value[0];
            this.isOpenState.next(value[0]);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FDropdownDirective.prototype, "placement", {
        get: /**
         * @return {?}
         */
        function () {
            return this._placement;
        },
        set: 
        // 是否是子下拉
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            // 如果相等
            if (!value) {
                return;
            }
            //
            if (value !== this._placement) {
                /** @type {?} */
                var newClsName = this._getClsName(value);
                /** @type {?} */
                var oldClsName = this._getClsName(this._placement);
                this.render.removeClass(this._seflEl, oldClsName);
                this.render.addClass(this._seflEl, newClsName);
                this._placement = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FDropdownDirective.prototype, "isOpen", {
        // @HostBinding('class.show')
        get: 
        // @HostBinding('class.show')
        /**
         * @return {?}
         */
        function () {
            return this._internalOpen;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FDropdownDirective.prototype, "submenuCls", {
        get: /**
         * @return {?}
         */
        function () {
            return this.isSubDP;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FDropdownDirective.prototype, "dropdownCls", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.isSubDP;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.getNativeElement = /**
     * @return {?}
     */
    function () {
        return this._seflEl;
    };
    /**
     * @private
     * @return {?}
     */
    FDropdownDirective.prototype.bindDocumentEvents = /**
     * @private
     * @return {?}
     */
    function () {
        //   this.ngzone.runOutsideAngular(() => {
        this.documentClickEventListener = this.onDocumentClick.bind(this);
        document.addEventListener('click', this.documentClickEventListener);
        // 绑定被操作native时触发
        this.selfDefineEventListener = this.onSelfDefineHandler.bind(this);
        this._seflEl.addEventListener('selfClose', this.selfDefineEventListener);
        // });
    };
    /**
     * @private
     * @return {?}
     */
    FDropdownDirective.prototype.onSelfDefineHandler = /**
     * @private
     * @return {?}
     */
    function () {
        this.close();
    };
    /**
     * @private
     * @return {?}
     */
    FDropdownDirective.prototype.unbindDocumentEvents = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.documentClickEventListener) {
            document.removeEventListener('click', this.documentClickEventListener);
            this.documentClickEventListener = null;
        }
        if (this.selfDefineEventListener) {
            this._seflEl.removeEventListener('selfClose', this.selfDefineEventListener);
            this.selfDefineEventListener = null;
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    FDropdownDirective.prototype.onDocumentClick = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // 如果已经关闭，不需要再响应
        if (!this._internalOpen) {
            return;
        }
        if (event.button !== 2 && !this.isEventFromToggle(event)) {
            this.close();
        }
    };
    // 判断menu展开时是否要计算
    // 判断menu展开时是否要计算
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.needToCalculate = 
    // 判断menu展开时是否要计算
    /**
     * @return {?}
     */
    function () {
        return this.autoRectify && this._calculateMenu;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FDropdownDirective.prototype.resetCalculate = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this._calculateMenu = value;
    };
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.open = /**
     * @return {?}
     */
    function () {
        if (!this._internalOpen) {
            this.closeSiblingDropdowns();
            this._calculateMenu = true;
            this.render.addClass(this._seflEl, 'show');
            this.isOpenState.next(true);
            this.dpChangeEvent.emit(true);
            // 执行绑定事件
            this.bindDocumentEvents();
        }
    };
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.close = /**
     * @return {?}
     */
    function () {
        if (this._internalOpen) {
            this._calculateMenu = false;
            this.render.removeClass(this._seflEl, 'show');
            this.isOpenState.next(false);
            this.dpChangeEvent.emit(false);
            this.unbindDocumentEvents();
        }
    };
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.toggle = /**
     * @return {?}
     */
    function () {
        if (this._internalOpen) {
            this.close();
        }
        else {
            this.open();
        }
    };
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.getOpenState = /**
     * @return {?}
     */
    function () {
        return this.isOpenState;
    };
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.isOpenState.unsubscribe();
        this.unbindDocumentEvents();
    };
    /**
     * @private
     * @return {?}
     */
    FDropdownDirective.prototype.closeSiblingDropdowns = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var dpParentEl = this._seflEl.parentNode;
        if (dpParentEl && dpParentEl['className'].indexOf('dropdown-menu') > -1) {
            /** @type {?} */
            var dropdowns = dpParentEl.querySelectorAll('[fDropdown]');
            if (dropdowns && dropdowns.length > 1) {
                for (var k = 0; k < dropdowns.length; k++) {
                    if (dropdowns[k].className.indexOf('show')) {
                        // 触发事件试试
                        this.compatibleDispatchEvent(dropdowns[k], 'selfClose');
                        // dropdowns[k].dispatchEvent(new Event('selfClose'));
                    }
                }
            }
        }
    };
    /**
     * @private
     * @param {?} eventEl
     * @param {?} eventName
     * @return {?}
     */
    FDropdownDirective.prototype.compatibleDispatchEvent = /**
     * @private
     * @param {?} eventEl
     * @param {?} eventName
     * @return {?}
     */
    function (eventEl, eventName) {
        /** @type {?} */
        var event;
        if (typeof Event === "function") {
            event = new Event(eventName);
        }
        else {
            event = document.createEvent("Event");
            event.initEvent(eventName, false, false);
        }
        eventEl.dispatchEvent(event);
    };
    /**
     * @private
     * @param {?} position
     * @return {?}
     */
    FDropdownDirective.prototype._getClsName = /**
     * @private
     * @param {?} position
     * @return {?}
     */
    function (position) {
        /** @type {?} */
        var className = '';
        switch (position) {
            case 'top-right':
            case 'top':
                // 朝上，朝上-朝右
                className = 'dropup';
                break;
            case 'top-left':
                // 朝上-朝左
                className = 'dropup-left';
                break;
            case 'left-bottom':
            case 'left':
                // 横向——朝左——朝下
                className = 'dropleft';
                break;
            case 'left-top':
                // 横向——朝左——朝上
                className = 'dropleft-up';
                break;
            case 'right-bottom':
            case 'right':
                // 横向——朝右——朝下
                className = 'dropright';
                break;
            case 'right-top':
                // 横向——朝右——朝上
                className = 'dropright-up';
                break;
            case 'bottom-left':
                // 朝下——朝左
                className = 'dropdown-left';
                break;
            case 'bottom-right':
                className = 'dropdown';
                break;
            default:
                // 朝下，朝下——朝右
                className = 'dropdown';
        }
        return className;
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    FDropdownDirective.prototype.isEventFromToggle = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var result = this.toggleElement && this.toggleElement.contains(event.target);
        return result;
    };
    /**
     * @return {?}
     */
    FDropdownDirective.prototype.getRectifyReferenceEl = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var resultWidth = window.innerWidth;
        /** @type {?} */
        var resultHeight = window.innerHeight;
        // 横向计算
        if (this.rectifyReference) {
            resultWidth = this.rectifyReference.getBoundingClientRect().right;
        }
        // 纵向计算
        if (this.rectifyReferenceV) {
            resultWidth = this.rectifyReference.getBoundingClientRect().bottom;
        }
        return { width: resultWidth, height: resultHeight };
    };
    FDropdownDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[fDropdown]',
                    exportAs: 'fDropdown'
                },] }
    ];
    /** @nocollapse */
    FDropdownDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    FDropdownDirective.propDecorators = {
        rectifyReference: [{ type: Input }],
        rectifyReferenceV: [{ type: Input }],
        autoRectify: [{ type: Input }],
        forceState: [{ type: Input, args: ['forceState',] }],
        openState: [{ type: Input, args: ['open',] }],
        dpChangeEvent: [{ type: Output }],
        isSubDP: [{ type: Input }],
        placement: [{ type: Input, args: ['placement',] }],
        submenuCls: [{ type: HostBinding, args: ['class.dropdown-submenu',] }],
        dropdownCls: [{ type: HostBinding, args: ['class.dropdown',] }]
    };
    return FDropdownDirective;
}());
export { FDropdownDirective };
if (false) {
    /** @type {?} */
    FDropdownDirective.prototype.toggleElement;
    /** @type {?} */
    FDropdownDirective.prototype.documentClickEventListener;
    /** @type {?} */
    FDropdownDirective.prototype.selfDefineEventListener;
    /**
     * @type {?}
     * @private
     */
    FDropdownDirective.prototype._seflEl;
    /**
     * @type {?}
     * @private
     */
    FDropdownDirective.prototype._internalOpen;
    /**
     * @type {?}
     * @private
     */
    FDropdownDirective.prototype._calculateMenu;
    /** @type {?} */
    FDropdownDirective.prototype.rectifyReference;
    /** @type {?} */
    FDropdownDirective.prototype.rectifyReferenceV;
    /** @type {?} */
    FDropdownDirective.prototype.autoRectify;
    /** @type {?} */
    FDropdownDirective.prototype.dpChangeEvent;
    /**
     * @type {?}
     * @private
     */
    FDropdownDirective.prototype._placement;
    /** @type {?} */
    FDropdownDirective.prototype.isSubDP;
    /**
     * @type {?}
     * @private
     */
    FDropdownDirective.prototype.isOpenState;
    /**
     * @type {?}
     * @private
     */
    FDropdownDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    FDropdownDirective.prototype.render;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZi1kcm9wZG93bi5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRyb3Bkb3duLyIsInNvdXJjZXMiOlsibGliL2YtZHJvcGRvd24uZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUNULEtBQUssRUFDTCxNQUFNLEVBQ04sV0FBVyxFQUNYLFlBQVksRUFDWixVQUFVLEVBQ1YsU0FBUyxFQUdaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0M7SUEyRUksNEJBQ0ksVUFBc0IsRUFDZCxNQUFpQjtRQUY3QixpQkFlQztRQWJXLFdBQU0sR0FBTixNQUFNLENBQVc7O1FBbkVyQixrQkFBYSxHQUFHLEtBQUssQ0FBQzs7UUFFdEIsbUJBQWMsR0FBRyxLQUFLLENBQUM7O1FBTXRCLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBZW5CLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUM5QyxlQUFVLEdBQUcsUUFBUSxDQUFDLENBQUMsY0FBYzs7UUFFcEMsWUFBTyxHQUFHLEtBQUssQ0FBQyxDQUFDLFNBQVM7UUEwQjNCLGdCQUFXLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQWlCaEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsYUFBYSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUzs7OztRQUFDLFVBQUMsS0FBYztZQUN0QyxJQUFJLEtBQUksQ0FBQyxhQUFhLEtBQUssS0FBSyxFQUFFO2dCQUM5QixLQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztnQkFDM0IsSUFBSSxLQUFJLENBQUMsYUFBYSxFQUFFO29CQUNwQixLQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2lCQUM5QztxQkFBTTtvQkFDSCxL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QWdCLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxNQUFNLENBQUM7U0FDdEU7UUFDRCxPQUFPLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLENBQUM7SUFFeEQsQ0FBQzs7Z0JBMVFKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsYUFBYTtvQkFDdkIsUUFBUSxFQUFFLFdBQVc7aUJBQ3hCOzs7O2dCQVRHLFVBQVU7Z0JBQ1YsU0FBUzs7O21DQW1CUixLQUFLO29DQUVMLEtBQUs7OEJBRUwsS0FBSzs2QkFFTCxLQUFLLFNBQUMsWUFBWTs0QkFRbEIsS0FBSyxTQUFDLE1BQU07Z0NBS1osTUFBTTswQkFHTixLQUFLOzRCQUVMLEtBQUssU0FBQyxXQUFXOzZCQTJCakIsV0FBVyxTQUFDLHdCQUF3Qjs4QkFJcEMsV0FBVyxTQUFDLGdCQUFnQjs7SUFzTWpDLHlCQUFDO0NBQUEsQUEzUUQsSUEyUUM7U0F2UVksa0JBQWtCOzs7SUFDM0IsMkNBQW1COztJQUNuQix3REFBZ0M7O0lBQ2hDLHFEQUE2Qjs7Ozs7SUFDN0IscUNBQTZCOzs7OztJQUU3QiwyQ0FBOEI7Ozs7O0lBRTlCLDRDQUErQjs7SUFFL0IsOENBQTBCOztJQUUxQiwrQ0FBMkI7O0lBRTNCLHlDQUE2Qjs7SUFlN0IsMkNBQXNEOzs7OztJQUN0RCx3Q0FBOEI7O0lBRTlCLHFDQUF5Qjs7Ozs7SUEwQnpCLHlDQUFvQzs7Ozs7SUFXcEMsb0NBQWU7Ozs7O0lBSVgsb0NBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIERpcmVjdGl2ZSxcclxuICAgIElucHV0LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgSG9zdEJpbmRpbmcsXHJcbiAgICBFdmVudEVtaXR0ZXIsXHJcbiAgICBFbGVtZW50UmVmLFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgT25EZXN0cm95LFxyXG4gICAgT25Jbml0XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tmRHJvcGRvd25dJyxcclxuICAgIGV4cG9ydEFzOiAnZkRyb3Bkb3duJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRkRyb3Bkb3duRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xyXG4gICAgdG9nZ2xlRWxlbWVudDogYW55O1xyXG4gICAgZG9jdW1lbnRDbGlja0V2ZW50TGlzdGVuZXI6IGFueTtcclxuICAgIHNlbGZEZWZpbmVFdmVudExpc3RlbmVyOiBhbnk7XHJcbiAgICBwcml2YXRlIF9zZWZsRWw6IEhUTUxFbGVtZW50O1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWlucHV0LXJlbmFtZVxyXG4gICAgcHJpdmF0ZSBfaW50ZXJuYWxPcGVuID0gZmFsc2U7XHJcbiAgICAvLyDorqHnrpflrr3luqZcclxuICAgIHByaXZhdGUgX2NhbGN1bGF0ZU1lbnUgPSBmYWxzZTtcclxuICAgIC8vIOe6oOato+S9jee9rueahOWPgueFpyDmnIl3aW5kb3flkoxwYXJlbnTkuKTkuKrlgLxcclxuICAgIEBJbnB1dCgpIHJlY3RpZnlSZWZlcmVuY2U7XHJcbiAgICAvLyDnuqDmraPnurXlkJHkvY3nva7nmoTlj4LnhacgXHJcbiAgICBASW5wdXQoKSByZWN0aWZ5UmVmZXJlbmNlVjtcclxuICAgIC8vIOaYr+WQpuiHquWKqOe6oOato+S9jee9rlxyXG4gICAgQElucHV0KCkgYXV0b1JlY3RpZnkgPSBmYWxzZTtcclxuICAgIC8vIOWcqOWklumdouW8uuWItuaOp+WItuWFs+mXreeKtuaAgVxyXG4gICAgQElucHV0KCdmb3JjZVN0YXRlJylcclxuICAgIHNldCBmb3JjZVN0YXRlKHZhbHVlOiBBcnJheTxib29sZWFuPikge1xyXG5cclxuICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCdvcGVuJylcclxuICAgIHNldCBvcGVuU3RhdGUodmFsdWU6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLl9pbnRlcm5hbE9wZW4gPSB2YWx1ZVswXTtcclxuICAgICAgICB0aGlzLmlzT3BlblN0YXRlLm5leHQodmFsdWVbMF0pO1xyXG4gICAgfVxyXG4gICAgQE91dHB1dCgpIGRwQ2hhbmdlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcbiAgICBwcml2YXRlIF9wbGFjZW1lbnQgPSAnYm90dG9tJzsgLy8g6K6w5b2VIHBvc2l0aW9uXHJcblxyXG4gICAgQElucHV0KCkgaXNTdWJEUCA9IGZhbHNlOyAvLyDmmK/lkKbmmK/lrZDkuIvmi4lcclxuXHJcbiAgICBASW5wdXQoJ3BsYWNlbWVudCcpXHJcbiAgICBzZXQgcGxhY2VtZW50KHZhbHVlKSB7XHJcbiAgICAgICAgLy8g5aaC5p6c55u4562JXHJcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB0aGlzLl9wbGFjZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV3Q2xzTmFtZSA9IHRoaXMuX2dldENsc05hbWUodmFsdWUpO1xyXG4gICAgICAgICAgICBjb25zdCBvbGRDbHNOYW1lID0gdGhpcy5fZ2V0Q2xzTmFtZSh0aGlzLl9wbGFjZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLl9zZWZsRWwsIG9sZENsc05hbWUpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLl9zZWZsRWwsIG5ld0Nsc05hbWUpO1xyXG4gICAgICAgICAgICB0aGlzLl9wbGFjZW1lbnQgPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgcGxhY2VtZW50KCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BsYWNlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBASG9zdEJpbmRpbmcoJ2NsYXNzLnNob3cnKVxyXG4gICAgZ2V0IGlzT3BlbigpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJuYWxPcGVuO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNPcGVuU3RhdGUgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmRyb3Bkb3duLXN1Ym1lbnUnKVxyXG4gICAgZ2V0IHN1Ym1lbnVDbHMoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTdWJEUDtcclxuICAgIH1cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuZHJvcGRvd24nKVxyXG4gICAgZ2V0IGRyb3Bkb3duQ2xzKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5pc1N1YkRQO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBuZ1pvbmU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLl9zZWZsRWwgPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5pc09wZW5TdGF0ZS5zdWJzY3JpYmUoKHN0YXRlOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9pbnRlcm5hbE9wZW4gIT09IHN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbnRlcm5hbE9wZW4gPSBzdGF0ZTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pbnRlcm5hbE9wZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLl9zZWZsRWwsICdzaG93Jyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuX3NlZmxFbCwgJ3Nob3cnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcbiAgICBnZXROYXRpdmVFbGVtZW50KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zZWZsRWw7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGJpbmREb2N1bWVudEV2ZW50cygpIHtcclxuICAgICAgICAvLyAgIHRoaXMubmd6b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2tFdmVudExpc3RlbmVyID0gdGhpcy5vbkRvY3VtZW50Q2xpY2suYmluZCh0aGlzKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuZG9jdW1lbnRDbGlja0V2ZW50TGlzdGVuZXIpO1xyXG4gICAgICAgIC8vIOe7keWumuiiq+aTjeS9nG5hdGl2ZeaXtuinpuWPkVxyXG4gICAgICAgIHRoaXMuc2VsZkRlZmluZUV2ZW50TGlzdGVuZXIgPSB0aGlzLm9uU2VsZkRlZmluZUhhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLl9zZWZsRWwuYWRkRXZlbnRMaXN0ZW5lcignc2VsZkNsb3NlJywgdGhpcy5zZWxmRGVmaW5lRXZlbnRMaXN0ZW5lcik7XHJcbiAgICAgICAgLy8gfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvblNlbGZEZWZpbmVIYW5kbGVyKCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgdW5iaW5kRG9jdW1lbnRFdmVudHMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZG9jdW1lbnRDbGlja0V2ZW50TGlzdGVuZXIpIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICAgICAgICAgICdjbGljaycsXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50Q2xpY2tFdmVudExpc3RlbmVyXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRDbGlja0V2ZW50TGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5zZWxmRGVmaW5lRXZlbnRMaXN0ZW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWZsRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICAgICAgICAgICdzZWxmQ2xvc2UnLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxmRGVmaW5lRXZlbnRMaXN0ZW5lclxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGZEZWZpbmVFdmVudExpc3RlbmVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIG9uRG9jdW1lbnRDbGljayhldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIC8vIOWmguaenOW3sue7j+WFs+mXre+8jOS4jemcgOimgeWGjeWTjeW6lFxyXG4gICAgICAgIGlmICghdGhpcy5faW50ZXJuYWxPcGVuKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbiAhPT0gMiAmJiAhdGhpcy5pc0V2ZW50RnJvbVRvZ2dsZShldmVudCkpIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDliKTmlq1tZW515bGV5byA5pe25piv5ZCm6KaB6K6h566XXHJcbiAgICBuZWVkVG9DYWxjdWxhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0b1JlY3RpZnkgJiYgdGhpcy5fY2FsY3VsYXRlTWVudTtcclxuICAgIH1cclxuICAgIHJlc2V0Q2FsY3VsYXRlKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fY2FsY3VsYXRlTWVudSA9IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgb3BlbigpIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLl9pbnRlcm5hbE9wZW4pIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZVNpYmxpbmdEcm9wZG93bnMoKTtcclxuICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlTWVudSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuX3NlZmxFbCwgJ3Nob3cnKTtcclxuICAgICAgICAgICAgdGhpcy5pc09wZW5TdGF0ZS5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLmRwQ2hhbmdlRXZlbnQuZW1pdCh0cnVlKTtcclxuICAgICAgICAgICAgLy8g5omn6KGM57uR5a6a5LqL5Lu2XHJcbiAgICAgICAgICAgIHRoaXMuYmluZERvY3VtZW50RXZlbnRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9pbnRlcm5hbE9wZW4pIHtcclxuICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlTWVudSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLl9zZWZsRWwsICdzaG93Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNPcGVuU3RhdGUubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZHBDaGFuZ2VFdmVudC5lbWl0KGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy51bmJpbmREb2N1bWVudEV2ZW50cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ludGVybmFsT3Blbikge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5vcGVuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0T3BlblN0YXRlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzT3BlblN0YXRlO1xyXG4gICAgfVxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5pc09wZW5TdGF0ZS51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIHRoaXMudW5iaW5kRG9jdW1lbnRFdmVudHMoKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgY2xvc2VTaWJsaW5nRHJvcGRvd25zKCkge1xyXG4gICAgICAgIGxldCBkcFBhcmVudEVsID0gdGhpcy5fc2VmbEVsLnBhcmVudE5vZGU7XHJcbiAgICAgICAgaWYgKGRwUGFyZW50RWwgJiYgZHBQYXJlbnRFbFsnY2xhc3NOYW1lJ10uaW5kZXhPZignZHJvcGRvd24tbWVudScpID4gLTEpIHtcclxuICAgICAgICAgICAgbGV0IGRyb3Bkb3ducyA9IGRwUGFyZW50RWwucXVlcnlTZWxlY3RvckFsbCgnW2ZEcm9wZG93bl0nKTtcclxuICAgICAgICAgICAgaWYgKGRyb3Bkb3ducyAmJiBkcm9wZG93bnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBkcm9wZG93bnMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZHJvcGRvd25zW2tdLmNsYXNzTmFtZS5pbmRleE9mKCdzaG93JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g6Kem5Y+R5LqL5Lu26K+V6K+VXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGF0aWJsZURpc3BhdGNoRXZlbnQoZHJvcGRvd25zW2tdLCAnc2VsZkNsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRyb3Bkb3duc1trXS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnc2VsZkNsb3NlJykpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgY29tcGF0aWJsZURpc3BhdGNoRXZlbnQoZXZlbnRFbCwgZXZlbnROYW1lKSB7XHJcbiAgICAgICAgdmFyIGV2ZW50O1xyXG4gICAgICAgIGlmICh0eXBlb2YgRXZlbnQgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICBldmVudCA9IG5ldyBFdmVudChldmVudE5hbWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJFdmVudFwiKTtcclxuICAgICAgICAgICAgZXZlbnQuaW5pdEV2ZW50KGV2ZW50TmFtZSwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXZlbnRFbC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgX2dldENsc05hbWUocG9zaXRpb246IHN0cmluZykge1xyXG4gICAgICAgIGxldCBjbGFzc05hbWUgPSAnJztcclxuICAgICAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RvcC1yaWdodCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3RvcCc6XHJcbiAgICAgICAgICAgICAgICAvLyDmnJ3kuIrvvIzmnJ3kuIot5pyd5Y+zXHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSAnZHJvcHVwJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd0b3AtbGVmdCc6XHJcbiAgICAgICAgICAgICAgICAvLyDmnJ3kuIot5pyd5bemXHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSAnZHJvcHVwLWxlZnQnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQtYm90dG9tJzpcclxuICAgICAgICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgICAgICAgICAvLyDmqKrlkJHigJTigJTmnJ3lt6bigJTigJTmnJ3kuItcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9ICdkcm9wbGVmdCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbGVmdC10b3AnOlxyXG4gICAgICAgICAgICAgICAgLy8g5qiq5ZCR4oCU4oCU5pyd5bem4oCU4oCU5pyd5LiKXHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSAnZHJvcGxlZnQtdXAnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0LWJvdHRvbSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgICAgIC8vIOaoquWQkeKAlOKAlOacneWPs+KAlOKAlOacneS4i1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gJ2Ryb3ByaWdodCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAncmlnaHQtdG9wJzpcclxuICAgICAgICAgICAgICAgIC8vIOaoquWQkeKAlOKAlOacneWPs+KAlOKAlOacneS4ilxyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gJ2Ryb3ByaWdodC11cCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxyXG4gICAgICAgICAgICAgICAgLy8g5pyd5LiL4oCU4oCU5pyd5bemXHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSAnZHJvcGRvd24tbGVmdCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9ICdkcm9wZG93bic7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIC8vIOacneS4i++8jOacneS4i+KAlOKAlOacneWPs1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gJ2Ryb3Bkb3duJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNsYXNzTmFtZTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgaXNFdmVudEZyb21Ub2dnbGUoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPVxyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUVsZW1lbnQgJiYgdGhpcy50b2dnbGVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRSZWN0aWZ5UmVmZXJlbmNlRWwoKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIHJlc3VsdFdpZHRoID0gd2luZG93LmlubmVyV2lkdGgsIHJlc3VsdEhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgICAgICAvLyDmqKrlkJHorqHnrpdcclxuICAgICAgICBpZiAodGhpcy5yZWN0aWZ5UmVmZXJlbmNlKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdFdpZHRoID0gdGhpcy5yZWN0aWZ5UmVmZXJlbmNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDnurXlkJHorqHnrpdcclxuICAgICAgICBpZiAodGhpcy5yZWN0aWZ5UmVmZXJlbmNlVikge1xyXG4gICAgICAgICAgICByZXN1bHRXaWR0aCA9IHRoaXMucmVjdGlmeVJlZmVyZW5jZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b207XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IHdpZHRoOiByZXN1bHRXaWR0aCwgaGVpZ2h0OiByZXN1bHRIZWlnaHQgfTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIGV4cG9ydCBlbnVtIEZEcm9wZG93blBsYWNlbWVudHtcclxuLy8gICBcInRvcFwiLCBcInRvcC1sZWZ0XCIsIFwidG9wLXJpZ2h0XCIsIFwiYm90dG9tXCIsIFwiYm90dG9tLWxlZnRcIiwgXCJib3R0b20tcmlnaHRcIixcclxuLy8gICAqICAgIFwibGVmdFwiLCBcImxlZnQtdG9wXCIsIFwibGVmdC1ib3R0b21cIiwgXCJyaWdodFwiLCBcInJpZ2h0LXRvcFwiLCBcInJpZ2h0LWJvdHRvbVwiXHJcbi8vIH1cclxuIl19