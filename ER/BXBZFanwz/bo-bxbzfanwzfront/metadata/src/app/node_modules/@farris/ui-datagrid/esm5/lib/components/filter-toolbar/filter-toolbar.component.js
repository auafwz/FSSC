/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
import { Component, ViewEncapsulation, Injector, ChangeDetectorRef, ElementRef, ViewChild, Renderer2, Input, NgZone } from '@angular/core';
import { DatagridService } from './../../services/datagrid.service';
import ResizeObserver from 'resize-observer-polyfill';
import { DatagridComponent } from '../../datagrid.component';
var DatagridFilterToolbarComponent = /** @class */ (function () {
    function DatagridFilterToolbarComponent(inject, el, cd, dgs, render, ngZone, localeSer) {
        this.inject = inject;
        this.el = el;
        this.cd = cd;
        this.dgs = dgs;
        this.render = render;
        this.ngZone = ngZone;
        this.localeSer = localeSer;
        this.empty = '[ æ—  ]';
        this.filterText = this.empty;
        this.openFilterPanel = false;
        this.showExpand = false;
        this.enableFilterSetting = false;
        this.windowResizeHandler = null;
        this.ro = null;
        this.empty = this.localeSer.getValue('datagrid.filter.nofilter');
        this.filterText = this.empty;
    }
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "toolbarWidth", {
        get: /**
         * @return {?}
         */
        function () {
            return this.filterToolbarRef.nativeElement.offsetWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "filterTextContainerWidth", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var actionW = 52;
            if (this.enableFilterSetting) {
                actionW = 65;
            }
            return this.toolbarWidth - 85 - actionW;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "filterTextRealWidth", {
        get: /**
         * @return {?}
         */
        function () {
            this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'nowrap');
            /** @type {?} */
            var w = this.filterPanelTextRef.nativeElement.scrollWidth;
            this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'normal');
            return w;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.dg = this.inject.get(DatagridComponent);
        this.dfrs = this.dg.clientFilterService;
        this.filterChangeSubscription = this.dgs.onFilterChanged.subscribe((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            _this.filterText = _this.dfrs.convertFilterCondition2String(n);
            if (!_this.filterText) {
                _this.filterText = _this.empty;
            }
            _this.updateExpandState();
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.bindEvent();
            }), 100);
            if (!_this.showExpand) {
                _this.openFilterPanel = false;
            }
            _this.cd.detectChanges();
            _this.dgs.onFilterTextChange(_this.filterText);
        }));
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.ro = new ResizeObserver((/**
             * @return {?}
             */
            function () {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.updateExpandState();
                    _this.cd.detectChanges();
                }), 100);
            }));
            _this.ro.observe(_this.el.nativeElement.closest('div.f-datagrid'));
        }));
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.ro.disconnect();
        if (this.filterChangeSubscription) {
            this.filterChangeSubscription.unsubscribe();
            this.filterChangeSubscription = null;
        }
        if (this.windowResizeHandler) {
            this.windowResizeHandler();
            this.windowResizeHandler = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.bindEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var filterFields = _this.filterToolbarRef.nativeElement.querySelectorAll('.filter-field');
            _this.bindFilterFieldHandler(filterFields);
            /** @type {?} */
            var dropdownFilterFields = _this.filterPanelTextRef.nativeElement.querySelectorAll('.filter-field');
            _this.bindFilterFieldHandler(dropdownFilterFields, false);
        }));
    };
    /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.bindFilterFieldHandler = /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    function (filterFields, hidePanel) {
        var _this = this;
        if (hidePanel === void 0) { hidePanel = true; }
        if (filterFields && filterFields.length) {
            filterFields.forEach((/**
             * @param {?} ff
             * @return {?}
             */
            function (ff) {
                _this.render.listen(ff, 'click', (/**
                 * @return {?}
                 */
                function () {
                    _this.removeFilterField(ff, hidePanel);
                }));
            }));
        }
    };
    /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.removeFilterField = /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    function (ff, hidePanel) {
        if (hidePanel === void 0) { hidePanel = true; }
        /** @type {?} */
        var field = ff.classList[1].replace('filter-column-', '');
        delete this.dg.conditions[field];
        this.dfrs.removeFilterField(field);
        ff.remove();
        if (hidePanel) {
            this.openFilterPanel = false;
            this.updateExpandState();
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.updateExpandState = /**
     * @private
     * @return {?}
     */
    function () {
        this.showExpand = this.isShowExpand();
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.isShowExpand = /**
     * @return {?}
     */
    function () {
        if (this.filterTextContainerWidth > this.filterTextRealWidth) {
            return false;
        }
        else if (this.filterTextRealWidth > this.filterTextContainerWidth) {
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.clearFilter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.filterText = this.empty;
        this.dgs.onClearFilter();
        this.dgs.onFilterChanged.emit({});
        return false;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.refreshFilter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.dg.filterData();
        return false;
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.showFilterTextPanel = /**
     * @return {?}
     */
    function () {
        this.openFilterPanel = !this.openFilterPanel;
        this.cd.detectChanges();
    };
    DatagridFilterToolbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-toolbar',
                    template: "\n        <div class=\"f-datagrid-filter-toolbar-panel\" #filterPanel [class.show]=\"openFilterPanel\" style=\"width: auto\">\n            <span class=\"filter-text\" #filterPanelText [innerHTML]=\"filterText\"></span>\n        </div>\n        <div class=\"f-datagrid-filter-toolbar\" #filterToolbar>\n            <span class=\"title\">{{'datagrid.filter.title'| locale}}\uFF1A</span>\n            <span #filterbarTxt class=\"filter-text\" [innerHTML]=\"filterText\"> </span>\n            <span class=\"filter-action\" *ngIf=\"filterText !== empty \">\n                <span *ngIf=\"showExpand\" class=\"f-icon filter-action-item\"\n                    [class.f-icon-arrow-chevron-up]=\"openFilterPanel\"\n                    [class.f-icon-arrow-chevron-down]=\"!openFilterPanel\"\n                (click)=\"showFilterTextPanel()\" title=\"{{'datagrid.filter.more'|locale}}\"></span>\n                <span title=\"{{'datagrid.filter.clearAll'|locale}}\" class=\"f-icon f-icon-x filter-action-item filter-clear\" (click)=\"clearFilter($event)\"></span>\n                <span title=\"refresh\" class=\"f-icon f-icon-reload-sm filter-action-item filter-refresh\" style=\"color: #388fff\" (click)=\"refreshFilter($event)\"></span>\n                <span *ngIf=\"enableFilterSetting\" class=\"f-icon f-icon-cog filter-action-item\" title=\"{{'datagrid.filter.setting'|locale}}\"></span>\n            </span>\n        </div>\n    ",
                    encapsulation: ViewEncapsulation.None
                }] }
    ];
    /** @nocollapse */
    DatagridFilterToolbarComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: DatagridService },
        { type: Renderer2 },
        { type: NgZone },
        { type: LocaleService }
    ]; };
    DatagridFilterToolbarComponent.propDecorators = {
        enableFilterSetting: [{ type: Input }],
        filterPanelRef: [{ type: ViewChild, args: ['filterPanel',] }],
        filterPanelTextRef: [{ type: ViewChild, args: ['filterPanelText',] }],
        filterTextRef: [{ type: ViewChild, args: ['filterbarTxt',] }],
        filterToolbarRef: [{ type: ViewChild, args: ['filterToolbar',] }]
    };
    return DatagridFilterToolbarComponent;
}());
export { DatagridFilterToolbarComponent };
if (false) {
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.empty;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterText;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.openFilterPanel;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.showExpand;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.enableFilterSetting;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterToolbarRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterChangeSubscription;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.windowResizeHandler;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.localeSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpbHRlci10b29sYmFyL2ZpbHRlci10b29sYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWxELE9BQU8sRUFBRSxTQUFTLEVBQVUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQTZCLE1BQU0sZUFBZSxDQUFDO0FBQzlLLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUdwRSxPQUFPLGNBQWMsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUU3RDtJQTRESSx3Q0FDWSxNQUFnQixFQUNoQixFQUFjLEVBQ2QsRUFBcUIsRUFDckIsR0FBb0IsRUFDcEIsTUFBaUIsRUFDakIsTUFBYyxFQUNkLFNBQXdCO1FBTnhCLFdBQU0sR0FBTixNQUFNLENBQVU7UUFDaEIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ3JCLFFBQUcsR0FBSCxHQUFHLENBQWlCO1FBQ3BCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLGNBQVMsR0FBVCxTQUFTLENBQWU7UUE1Q3BDLFVBQUssR0FBRyxPQUFPLENBQUM7UUFDaEIsZUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFeEIsb0JBQWUsR0FBRyxLQUFLLENBQUM7UUFDeEIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUVWLHdCQUFtQixHQUFHLEtBQUssQ0FBQztRQTJC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MEI7Ozs7O0lBQzFCLDhDQUFvQzs7Ozs7SUFDcEMsNENBQThCOzs7OztJQUUxQixnREFBd0I7Ozs7O0lBQ3hCLDRDQUFzQjs7Ozs7SUFDdEIsNENBQTZCOzs7OztJQUM3Qiw2Q0FBNEI7Ozs7O0lBQzVCLGdEQUF5Qjs7Ozs7SUFDekIsZ0RBQXNCOzs7OztJQUN0QixtREFBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdFbmNhcHN1bGF0aW9uLCBJbmplY3RvciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgUmVuZGVyZXIyLCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIE9wdGlvbmFsLCBIb3N0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvZGF0YWdyaWQuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmlsdGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyAgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlJztcclxuaW1wb3J0IFJlc2l6ZU9ic2VydmVyIGZyb20gJ3Jlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmaWx0ZXItdG9vbGJhcicsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJmLWRhdGFncmlkLWZpbHRlci10b29sYmFyLXBhbmVsXCIgI2ZpbHRlclBhbmVsIFtjbGFzcy5zaG93XT1cIm9wZW5GaWx0ZXJQYW5lbFwiIHN0eWxlPVwid2lkdGg6IGF1dG9cIj5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmaWx0ZXItdGV4dFwiICNmaWx0ZXJQYW5lbFRleHQgW2lubmVySFRNTF09XCJmaWx0ZXJUZXh0XCI+PC9zcGFuPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJmLWRhdGFncmlkLWZpbHRlci10b29sYmFyXCIgI2ZpbHRlclRvb2xiYXI+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGl0bGVcIj57eydkYXRhZ3JpZC5maWx0ZXIudGl0bGUnfCBsb2NhbGV9fe+8mjwvc3Bhbj5cclxuICAgICAgICAgICAgPHNwYW4gI2ZpbHRlcmJhclR4dCBjbGFzcz1cImZpbHRlci10ZXh0XCIgW2lubmVySFRNTF09XCJmaWx0ZXJUZXh0XCI+IDwvc3Bhbj5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmaWx0ZXItYWN0aW9uXCIgKm5nSWY9XCJmaWx0ZXJUZXh0ICE9PSBlbXB0eSBcIj5cclxuICAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwic2hvd0V4cGFuZFwiIGNsYXNzPVwiZi1pY29uIGZpbHRlci1hY3Rpb24taXRlbVwiXHJcbiAgICAgICAgICAgICAgICAgICAgW2NsYXNzLmYtaWNvbi1hcnJvdy1jaGV2cm9uLXVwXT1cIm9wZW5GaWx0ZXJQYW5lbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgW2NsYXNzLmYtaWNvbi1hcnJvdy1jaGV2cm9uLWRvd25dPVwiIW9wZW5GaWx0ZXJQYW5lbFwiXHJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwic2hvd0ZpbHRlclRleHRQYW5lbCgpXCIgdGl0bGU9XCJ7eydkYXRhZ3JpZC5maWx0ZXIubW9yZSd8bG9jYWxlfX1cIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiB0aXRsZT1cInt7J2RhdGFncmlkLmZpbHRlci5jbGVhckFsbCd8bG9jYWxlfX1cIiBjbGFzcz1cImYtaWNvbiBmLWljb24teCBmaWx0ZXItYWN0aW9uLWl0ZW0gZmlsdGVyLWNsZWFyXCIgKGNsaWNrKT1cImNsZWFyRmlsdGVyKCRldmVudClcIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiB0aXRsZT1cInJlZnJlc2hcIiBjbGFzcz1cImYtaWNvbiBmLWljb24tcmVsb2FkLXNtIGZpbHRlci1hY3Rpb24taXRlbSBmaWx0ZXItcmVmcmVzaFwiIHN0eWxlPVwiY29sb3I6ICMzODhmZmZcIiAoY2xpY2spPVwicmVmcmVzaEZpbHRlcigkZXZlbnQpXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJlbmFibGVGaWx0ZXJTZXR0aW5nXCIgY2xhc3M9XCJmLWljb24gZi1pY29uLWNvZyBmaWx0ZXItYWN0aW9uLWl0ZW1cIiB0aXRsZT1cInt7J2RhdGFncmlkLmZpbHRlci5zZXR0aW5nJ3xsb2NhbGV9fVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgYCxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkRmlsdGVyVG9vbGJhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICAgIGVtcHR5ID0gJ1sg5pegIF0nO1xyXG4gICAgZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcblxyXG4gICAgb3BlbkZpbHRlclBhbmVsID0gZmFsc2U7XHJcbiAgICBzaG93RXhwYW5kID0gZmFsc2U7XHJcblxyXG4gICAgQElucHV0KCkgZW5hYmxlRmlsdGVyU2V0dGluZyA9IGZhbHNlO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlclBhbmVsJykgZmlsdGVyUGFuZWxSZWY6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaWx0ZXJQYW5lbFRleHQnKSBmaWx0ZXJQYW5lbFRleHRSZWY6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaWx0ZXJiYXJUeHQnKSBmaWx0ZXJUZXh0UmVmOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZmlsdGVyVG9vbGJhcicpIGZpbHRlclRvb2xiYXJSZWY6IEVsZW1lbnRSZWY7XHJcblxyXG4gICAgZ2V0IHRvb2xiYXJXaWR0aCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJUb29sYmFyUmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZpbHRlclRleHRDb250YWluZXJXaWR0aCgpIHtcclxuICAgICAgICBsZXQgYWN0aW9uVyA9IDUyO1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZUZpbHRlclNldHRpbmcpIHtcclxuICAgICAgICAgICAgYWN0aW9uVyA9IDY1O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy50b29sYmFyV2lkdGggLSA4NSAtIGFjdGlvblc7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGZpbHRlclRleHRSZWFsV2lkdGgoKSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5maWx0ZXJQYW5lbFRleHRSZWYubmF0aXZlRWxlbWVudCwgJ3doaXRlLXNwYWNlJywgJ25vd3JhcCcpO1xyXG4gICAgICAgIGNvbnN0IHcgPSB0aGlzLmZpbHRlclBhbmVsVGV4dFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZmlsdGVyUGFuZWxUZXh0UmVmLm5hdGl2ZUVsZW1lbnQsICd3aGl0ZS1zcGFjZScsICdub3JtYWwnKTtcclxuICAgICAgICByZXR1cm4gdztcclxuICAgIH1cclxuXHJcbiAgICBmaWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAgIHdpbmRvd1Jlc2l6ZUhhbmRsZXIgPSBudWxsO1xyXG4gICAgcm86IFJlc2l6ZU9ic2VydmVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGZyczogRGF0YWdyaWRGaWx0ZXJTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBkZzogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGluamVjdDogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICBwcml2YXRlIGRnczogRGF0YWdyaWRTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcclxuICAgICAgICBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSxcclxuICAgICAgKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHkgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm5vZmlsdGVyJyk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGcgPSB0aGlzLmluamVjdC5nZXQ8RGF0YWdyaWRDb21wb25lbnQ+KERhdGFncmlkQ29tcG9uZW50KTtcclxuICAgICAgICB0aGlzLmRmcnMgPSB0aGlzLmRnLmNsaWVudEZpbHRlclNlcnZpY2U7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24gPSB0aGlzLmRncy5vbkZpbHRlckNoYW5nZWQuc3Vic2NyaWJlKChuKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZGZycy5jb252ZXJ0RmlsdGVyQ29uZGl0aW9uMlN0cmluZyhuKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmZpbHRlclRleHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwYW5kU3RhdGUoKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRFdmVudCgpO1xyXG4gICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2hvd0V4cGFuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5kZ3Mub25GaWx0ZXJUZXh0Q2hhbmdlKHRoaXMuZmlsdGVyVGV4dCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucm8gPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHBhbmRTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJvLm9ic2VydmUodGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsb3Nlc3QoJ2Rpdi5mLWRhdGFncmlkJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMucm8uZGlzY29ubmVjdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLndpbmRvd1Jlc2l6ZUhhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy53aW5kb3dSZXNpemVIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMud2luZG93UmVzaXplSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZEV2ZW50KCkge1xyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsdGVyRmllbGRzID0gdGhpcy5maWx0ZXJUb29sYmFyUmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlci1maWVsZCcpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRGaWx0ZXJGaWVsZEhhbmRsZXIoZmlsdGVyRmllbGRzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duRmlsdGVyRmllbGRzID0gdGhpcy5maWx0ZXJQYW5lbFRleHRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWZpZWxkJyk7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEZpbHRlckZpZWxkSGFuZGxlcihkcm9wZG93bkZpbHRlckZpZWxkcywgZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZEZpbHRlckZpZWxkSGFuZGxlcihmaWx0ZXJGaWVsZHM6IGFueSwgaGlkZVBhbmVsID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChmaWx0ZXJGaWVsZHMgJiYgZmlsdGVyRmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBmaWx0ZXJGaWVsZHMuZm9yRWFjaChmZiA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5saXN0ZW4oZmYsICdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUZpbHRlckZpZWxkKGZmLCBoaWRlUGFuZWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbW92ZUZpbHRlckZpZWxkKGZmOiBhbnksIGhpZGVQYW5lbCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBmaWVsZCA9IGZmLmNsYXNzTGlzdFsxXS5yZXBsYWNlKCdmaWx0ZXItY29sdW1uLScsICcnKTtcclxuICAgICAgICBkZWxldGUgdGhpcy5kZy5jb25kaXRpb25zW2ZpZWxkXTtcclxuICAgICAgICB0aGlzLmRmcnMucmVtb3ZlRmlsdGVyRmllbGQoZmllbGQpO1xyXG4gICAgICAgIGZmLnJlbW92ZSgpO1xyXG4gICAgICAgIGlmIChoaWRlUGFuZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVFeHBhbmRTdGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUV4cGFuZFN0YXRlKCkge1xyXG4gICAgICAgIHRoaXMuc2hvd0V4cGFuZCA9IHRoaXMuaXNTaG93RXhwYW5kKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTaG93RXhwYW5kKCkge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5maWx0ZXJUZXh0Q29udGFpbmVyV2lkdGggPiB0aGlzLmZpbHRlclRleHRSZWFsV2lkdGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5maWx0ZXJUZXh0UmVhbFdpZHRoID4gdGhpcy5maWx0ZXJUZXh0Q29udGFpbmVyV2lkdGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhckZpbHRlcigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmZpbHRlclRleHQgPSB0aGlzLmVtcHR5O1xyXG4gICAgICAgIHRoaXMuZGdzLm9uQ2xlYXJGaWx0ZXIoKTtcclxuICAgICAgICB0aGlzLmRncy5vbkZpbHRlckNoYW5nZWQuZW1pdCh7fSk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZnJlc2hGaWx0ZXIoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5kZy5maWx0ZXJEYXRhKCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dGaWx0ZXJUZXh0UGFuZWwoKSB7XHJcbiAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSAhdGhpcy5vcGVuRmlsdGVyUGFuZWw7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbn1cclxuIl19