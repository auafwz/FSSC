/**
 * 应用上下文
 * @author Witt<jiwt@inspur.com>
 * @todo
 * 1、parnet和AppContextManager是否必要？按理说就是应该隔离上下文，表单之间通过事件通讯进行交互；
 */
import { Injectable, Injector, Optional, SkipSelf, InjectFlags } from '@angular/core';
import { Router } from '@angular/router';
import { Context } from '../context/index';
import { BindingData, BindingDataFactory } from '../binding-data';
import { FrameContextManager } from './frame_contex_manager';
import { FrameComponentRefresher } from './frame_component_refresher';
import { RepositoryManager } from './repository_mananger';
import { BindingDataManager } from './binding_data_manager';
import { ChangeDetectionController } from './change_detection_controller';
import { AppContextManager } from './app_context_manager';
import { Subject } from 'rxjs';
import { ComponentManager } from './component_manager';
import { UID } from '../misc/uid';
import { FORM_ID } from './tokens';
import { MessageManager } from '../message/messagemanager';
import { MessageData } from '../message/messagedata';
import { MessageBody } from '../message/messagebody';
import { VALIDATION_HANDLER } from '../validation';
import { throwIfEmpty } from 'rxjs/operators';
import { ContextMetadataBuilder } from './app_metadata_collector';
import { StateMachine } from '../state-machine';
import { CommandVariableParser, DataVariableParser, FrameIdVariableParser, StateMachineVariableParser, UIStateVariableParser, VariableParseService } from '../variable';
import { ViewModelManager } from './view_model_manager';
import { Repository } from '../repository';
import { UIState } from '../ui-state';
import { ContextMetadataManager } from './render_context_metadata_manager';
import { Form } from '../form';
import { ViewModel } from '../view-model';
import { FrameContext } from '../frame/frame_context';
import { NAMESPACE, FRAME_ID } from '../frame/tokens';
import { DEVKIT_RUN_MODE, RunMode } from '../core';
import { RunModeService } from '../misc/run_mode_service';
class AppContext extends Context {
    /**
     * 构造函数
     */
    constructor(injector, appContextManager, parent) {
        super();
        this.typeName = 'AppContext';
        /**
         * 是否已经销毁
         */
        this.isFormDestoryed = false;
        /**
         * 应用程序标识
         */
        this.applicationId = null;
        this.token = null;
        /**
         * 是否使用独立的eventBus
         * @memberof AppContext
         */
        this.useIsoluteEventBus = false;
        /**
         * 应用上下文元数据描述
         */
        this.metadata = {};
        this.injector = injector;
        this.appContextManager = appContextManager;
        this.formId = this.injector && this.injector.get(FORM_ID, null) || null;
        // 默认运行模式为兼容模式
        this.runMode = this.injector && this.injector.get(DEVKIT_RUN_MODE, RunMode.compatible) || RunMode.compatible;
        RunModeService.setRunMode(this.runMode);
        this.params.set('formId', this.formId);
        this.params.set('appId', this.ApplicationId);
        this.params.set('token', this.Token);
        // 确定父子关系
        if (!parent) {
            this.parent = null;
            this.root = this;
        }
        else {
            this.parent = parent;
            this.root = parent.root;
        }
        this.registerToManager();
        this.frameContextManager = new FrameContextManager(this);
        this.frameComponentRefresher = new FrameComponentRefresher();
        this.repositoryManager = new RepositoryManager();
        this.bindingDataManager = new BindingDataManager();
        this.changeDetectionController = new ChangeDetectionController(this.frameContextManager);
        this.messagePipe = new Subject();
        this.componentRefs = new Map();
        this.componentManager = new ComponentManager(this);
        this.contextMetadataManager = new ContextMetadataManager();
        this.opened = false;
        // this.sortConditionManager = new SortConditionManager();
        // this.filterConditionManager = new FilterConditionManager();
        this.router = this.injector && this.injector.get(Router);
        this.viewModelManager = new ViewModelManager();
        this.contextMetadataBuilder = new ContextMetadataBuilder();
        this.variableParseService = new VariableParseService([
            new FrameIdVariableParser(),
            new DataVariableParser(),
            new UIStateVariableParser(),
            new StateMachineVariableParser(),
            new CommandVariableParser()
        ]);
        this.initMessageEvent();
    }
    /**
     * 已废弃：请使用FrameContextManager的getFrameContextMap方法代替。
     * @deprecated
     * @summary
     * 已经有运行时直接用中括号访问该属性的场景，虽然是private，但要进行兼容。
     */
    get frameContexts() {
        return this.frameContextManager.getFrameContextMap();
    }
    get formModule() {
        return this.formMetadataContent ? this.formMetadataContent.module : null;
    }
    /**
     * 由表单元数据、状态机元数据、前端构件元数据初始化解析型应用上下文
     * @param formMetadataContent 表单元数据
     * @param stateMachineMetadata 状态机元数据
     * @param controllers 前端构件元数据
     */
    initializeByMetadata(formMetadataContent, stateMachineMetadata, controllers) {
        this.metadata = this.contextMetadataBuilder.buildAppContextMetadata(formMetadataContent, stateMachineMetadata);
        if (!this.stateMachine) {
            this.stateMachine = this.injector.get(StateMachine, new StateMachine());
        }
        this.formMetadataContent = formMetadataContent;
        this.controllers = controllers;
    }
    /**
     * Register current AppContext instance to AppContextManager
     */
    registerToManager() {
        if (!this.appContextManager) {
            return;
        }
        this.appContextManager.registerAppContext(this);
    }
    /**
     * Unregister current AppContext instance from AppContextManager
     */
    unregisterFromManager(frameContext) {
        if (!this.appContextManager) {
            return;
        }
        this.appContextManager.unregisterAppContext(this);
        // 清理repository及bindingData 
        // const frameContexts = this.frameContextManager.getFrameContexts();
        if (frameContext) {
            const repository = frameContext.repository;
            const repositoryName = repository.name;
            if (this.repositoryManager.ifRepositoryExits(repositoryName)) {
                this.repositoryManager.unRegisteRepository(repositoryName);
            }
            if (this.bindingDataManager.ifBindingDataExits(repositoryName)) {
                this.bindingDataManager.unRegisteBindingData(repositoryName);
            }
        }
    }
    /**
     * 注册FrameContext
     */
    regFrameContext(frameContext) {
        const repository = frameContext.repository;
        const repositoryName = repository.name;
        // Repository
        if (this.repositoryManager.ifRepositoryExits(repositoryName) === false) {
            this.repositoryManager.regRepository(repositoryName, repository);
        }
        // BindingData
        if (this.bindingDataManager.ifBindingDataExits(repositoryName) === false) {
            let bindingData = null;
            if (this.runMode === RunMode.highSpeed) {
                bindingData = BindingDataFactory.createFromRepository(repository, '/');
                this.bindingDataManager.regBindingData(repositoryName, bindingData);
            }
        }
        // 考虑路由再次进入的时候，AppContext没有被注销，但Component被再次构造的场景
        this.frameContextManager.regFrameContext(frameContext);
    }
    regContextMetadata(componentId, contextMetadata) {
        if (!this.contextMetadataManager.exsit(componentId)) {
            this.contextMetadataManager.register(componentId, contextMetadata);
        }
    }
    /**
     * 获取整个表单的AppContext
     */
    getFormAppContext() {
        return this;
    }
    /**
     * 销毁表单
     * @todo: 临时解决表单关闭后对象没有销毁亦获取不到销毁时机的问题,应依赖angular本身的销毁机制
     */
    destory() {
        this.isFormDestoryed = true;
    }
    /**
     * 表单是否已经被销毁
     */
    get isDestoryed() {
        return this.isFormDestoryed;
    }
    /**
     * 应用id
     */
    get ApplicationId() {
        if (!!this.applicationId) {
            return this.applicationId;
        }
        this.applicationId = UID.create();
        return this.applicationId;
    }
    set ApplicationId(appId) {
        this.applicationId = appId;
    }
    get Token() {
        if (!!this.token) {
            return this.token;
        }
        this.token = UID.create();
        return this.token;
    }
    set Token(token) {
        this.token = token;
    }
    // #region 弃用的老方法
    /**
     * 已废弃：请使用FrameComponentRefresher的refreshComponent方法代替。
     * @deprecated
     */
    registerCommandHandler(frameId, component) {
        this.frameComponentRefresher.regFrameComponent(frameId, component);
    }
    /**
     * 已废弃：请使用FrameComponentRefresher的refreshComponent方法代替。
     * @deprecated
     */
    refresh() {
        this.frameComponentRefresher.refreshComponents();
    }
    /**
     * 已废弃：请使用FrameContextManager的getFrameContextById方法代替。
     * @deprecated
     */
    getFrameContext(frameId) {
        return this.frameContextManager.getFrameContextById(frameId);
    }
    getContextById(identify) {
        const context = this.frameContextManager.getFrameContextById(identify);
        return context;
    }
    /**
     * 已废弃：请使用FrameContextManager的getFrameContextMap方法代替。
     * @deprecated
     */
    getAllFrameContexts() {
        return this.frameContextManager.getFrameContextMap();
    }
    /**
     * 处理行变更
     */
    handleSelectChange(change, srcFrameContext) {
        const force = change.force || false;
        this.frameContexts.forEach((targetFrameContext) => {
            // 相同的FrameCotnext或者Repository不一致的情况下，不同步
            if (targetFrameContext === srcFrameContext
                || targetFrameContext.repository !== srcFrameContext.repository) {
                return;
            }
            const bindingData = targetFrameContext.bindingData;
            const bindingList = bindingData.getValue(change.path);
            const currentId = change.value['id'];
            if (bindingList && bindingList.currentId !== currentId || force) {
                // 设置当前行，但不对外广播
                bindingList.setCurrentId(currentId, true, false, force);
            }
        });
    }
    // #endregion
    initMessageEvent() {
        if (this.parent && this.parent !== this) {
            let resultTask;
            const messager = MessageManager.getMessager();
            messager.setAppContext(this);
            messager.listner((msg) => {
                const source = msg.sender;
                const data = msg.data;
                const appcontext = messager.getAppContext();
                const allFrameContext = appcontext.frameContextManager.getFrameContextMap();
                if (data.command === 'wf-required-verification') { // 工作流的必填校验
                    // 注入ValidationHandler
                    const validation = this.injector.get(VALIDATION_HANDLER, null, InjectFlags.Optional);
                    if (validation) {
                        resultTask = validation.validateAll();
                    }
                }
                else {
                    const command = this.findHandler(allFrameContext, data.command);
                    if (command) {
                        resultTask = command(data.arguments);
                    }
                }
                if (resultTask) {
                    resultTask.pipe(throwIfEmpty()).subscribe((result) => {
                        // 向来源方回传消息
                        const retMsg = new MessageBody(new MessageData());
                        retMsg.data.result = true; // 目标方法返回值
                        retMsg.type = 'message';
                        retMsg.target = source;
                        messager.send(retMsg);
                    }, () => {
                        const retMsg = new MessageBody(new MessageData());
                        retMsg.data.result = false; // 目标方法返回值
                        retMsg.type = 'message';
                        retMsg.target = source;
                        messager.send(retMsg);
                    });
                }
            });
        }
    }
    findHandler(contextMap, command) {
        let func;
        const temp = [...contextMap.values()];
        // tslint:disable-next-line: forin
        for (const v in temp) {
            const vm = temp[v].viewModel;
            if (vm && vm.hasOwnProperty(command)) {
                func = vm[command];
                return func;
            }
        }
    }
    buildRenderViewContext(componentId) {
        // 提取视图模型集合
        const viewModels = this.formModule.viewmodels;
        // 提取组件描述集合
        const viewComponents = this.formModule.components;
        // 提取schema节点
        const schema = this.formModule.schemas[0];
        // 查找匹配指定标识的组件节点
        const matchedComponent = viewComponents.find(component => component.id === componentId);
        // 匹配指定组件的视图模型节点
        const matchedViewModel = viewModels.find(viewModel => matchedComponent.viewModel === viewModel.id);
        // 查找匹配视图模型的父节点
        const parentViewModel = viewModels.find(viewModel => viewModel.id === matchedViewModel.parent);
        let parentComponentId = '';
        // 如果匹配上上级视图模型，提上级视图标识
        if (parentViewModel) {
            const parentComponent = viewComponents.find(component => component.viewModel === parentViewModel.id);
            if (parentComponent) {
                parentComponentId = parentComponent.id;
            }
        }
        // 如果存在上级组件，提取器上下文对象。
        // const parentViewContext = parentComponentId ? this.getContextById(parentComponentId) : null;
        // this.buildRenderViewContextRecursively(matchedViewModel, parentViewContext, schema);
        this.buildRenderViewContextRecursively(matchedViewModel, schema);
    }
    buildRenderViewContextRecursively(viewModel, schema) {
        const controllers = this.controllers;
        const viewComponents = this.formModule.components;
        const matchedComponent = viewComponents.find(component => component.viewModel === viewModel.id);
        const contextMetadata = this.contextMetadataBuilder.buildViewContextMetadata(matchedComponent, viewModel, schema, controllers);
        // const commandHandlers: CommandHandler[] = this.buildCommandHandlers(viewModel.commands, controllers);
        // const commandHandlerExtends: CommandHandlerExtender[] = [];
        // const viewContext = new ViewComponentContext(
        //   contextMetadata,
        //   this,
        //   parent,
        //   this.injector
        // );
        // this.regFrameContext(viewContext);
        // viewContext.init();
        this.regContextMetadata(matchedComponent.id, contextMetadata);
        const viewModels = this.formModule.viewmodels;
        const subViewModels = viewModels.filter(subViewModel => subViewModel.parent === viewModel.id);
        if (subViewModels && subViewModels.length) {
            subViewModels.forEach(subViewModel => {
                this.buildRenderViewContextRecursively(subViewModel, schema);
            });
        }
    }
    getComponentProviders(componentId) {
        const contextMetadata = this.contextMetadataManager.getContextMetadataByName(componentId);
        const bindingData = new BindingData();
        const form = new Form();
        const namespace = contextMetadata.namespace;
        const repository = this.injector.get(Repository, null) || this.repository;
        const stateMachine = this.stateMachine;
        const uiState = new UIState();
        const viewModel = new ViewModel();
        viewModel.setMetadata(contextMetadata);
        return [
            { provide: FRAME_ID, useValue: componentId },
            { provide: NAMESPACE, useValue: namespace },
            { provide: FrameContext, useClass: FrameContext },
            { provide: AppContext, useValue: this },
            { provide: BindingData, useValue: bindingData },
            { provide: Form, useValue: form },
            { provide: Repository, useValue: repository },
            { provide: StateMachine, useValue: stateMachine },
            { provide: UIState, useValue: uiState },
            { provide: ViewModel, useValue: viewModel },
            {
                provide: VariableParseService, useValue: new VariableParseService([
                    new FrameIdVariableParser(),
                    new DataVariableParser(),
                    new UIStateVariableParser(),
                    new StateMachineVariableParser(),
                    new CommandVariableParser()
                ])
            }
        ];
    }
}
AppContext.decorators = [
    { type: Injectable }
];
/** @nocollapse */
AppContext.ctorParameters = () => [
    { type: Injector, decorators: [{ type: Optional }] },
    { type: AppContextManager, decorators: [{ type: Optional }] },
    { type: AppContext, decorators: [{ type: Optional }, { type: SkipSelf }] }
];
export { AppContext };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwX2NvbnRleHQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9hcHAvYXBwX2NvbnRleHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFDSCxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0RixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsa0JBQWtCLEVBQXVCLE1BQU0saUJBQWlCLENBQUM7QUFDdkYsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDN0QsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDMUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ2xDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbkMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzNELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNyRCxP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QkFBekMsUUFBUSxZQUFJLFFBQVE7O0FBMlp6QixPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog5bqU55So5LiK5LiL5paHXHJcbiAqIEBhdXRob3IgV2l0dDxqaXd0QGluc3B1ci5jb20+XHJcbiAqIEB0b2RvXHJcbiAqIDHjgIFwYXJuZXTlkoxBcHBDb250ZXh0TWFuYWdlcuaYr+WQpuW/heimge+8n+aMieeQhuivtOWwseaYr+W6lOivpemalOemu+S4iuS4i+aWh++8jOihqOWNleS5i+mXtOmAmui/h+S6i+S7tumAmuiur+i/m+ihjOS6pOS6ku+8m1xyXG4gKi9cclxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIE9wdGlvbmFsLCBTa2lwU2VsZiwgSW5qZWN0RmxhZ3MgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgQ29udGV4dCB9IGZyb20gJy4uL2NvbnRleHQvaW5kZXgnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSwgQmluZGluZ0RhdGFGYWN0b3J5LCBCaW5kaW5nTGlzdCwgQ2hhbmdlIH0gZnJvbSAnLi4vYmluZGluZy1kYXRhJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0TWFuYWdlciB9IGZyb20gJy4vZnJhbWVfY29udGV4X21hbmFnZXInO1xyXG5pbXBvcnQgeyBGcmFtZUNvbXBvbmVudFJlZnJlc2hlciB9IGZyb20gJy4vZnJhbWVfY29tcG9uZW50X3JlZnJlc2hlcic7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnlNYW5hZ2VyIH0gZnJvbSAnLi9yZXBvc2l0b3J5X21hbmFuZ2VyJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGFNYW5hZ2VyIH0gZnJvbSAnLi9iaW5kaW5nX2RhdGFfbWFuYWdlcic7XHJcbmltcG9ydCB7IENoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIgfSBmcm9tICcuL2NoYW5nZV9kZXRlY3Rpb25fY29udHJvbGxlcic7XHJcbmltcG9ydCB7IEFwcENvbnRleHRNYW5hZ2VyIH0gZnJvbSAnLi9hcHBfY29udGV4dF9tYW5hZ2VyJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRNYW5hZ2VyIH0gZnJvbSAnLi9jb21wb25lbnRfbWFuYWdlcic7XHJcbmltcG9ydCB7IFVJRCB9IGZyb20gJy4uL21pc2MvdWlkJztcclxuaW1wb3J0IHsgRk9STV9JRCB9IGZyb20gJy4vdG9rZW5zJztcclxuaW1wb3J0IHsgTWVzc2FnZU1hbmFnZXIgfSBmcm9tICcuLi9tZXNzYWdlL21lc3NhZ2VtYW5hZ2VyJztcclxuaW1wb3J0IHsgTWVzc2FnZURhdGEgfSBmcm9tICcuLi9tZXNzYWdlL21lc3NhZ2VkYXRhJztcclxuaW1wb3J0IHsgTWVzc2FnZUJvZHkgfSBmcm9tICcuLi9tZXNzYWdlL21lc3NhZ2Vib2R5JztcclxuaW1wb3J0IHsgSVZhbGlkYXRpb25IYW5kbGVyLCBWQUxJREFUSU9OX0hBTkRMRVIgfSBmcm9tICcuLi92YWxpZGF0aW9uJztcclxuaW1wb3J0IHsgdGhyb3dJZkVtcHR5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBDb250ZXh0TWV0YWRhdGFCdWlsZGVyIH0gZnJvbSAnLi9hcHBfbWV0YWRhdGFfY29sbGVjdG9yJztcclxuaW1wb3J0IHsgRm9ybU1vZHVsZSwgSUZvcm1WaWV3TW9kZWwsIElTdGF0ZU1hY2hpbmUgfSBmcm9tICcuLi9zY2hlbWEvZm9ybS1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IENvbW1hbmRDb250cm9sbGVyIH0gZnJvbSAnLi4vY29tbWFuZCc7XHJcbmltcG9ydCB7IFN0YXRlTWFjaGluZSB9IGZyb20gJy4uL3N0YXRlLW1hY2hpbmUnO1xyXG5pbXBvcnQgeyBJQ29udGV4dE1ldGFkYXRhIH0gZnJvbSAnLi9hcHBfbWV0YWRhdGEnO1xyXG5pbXBvcnQge1xyXG4gIENvbW1hbmRWYXJpYWJsZVBhcnNlciwgRGF0YVZhcmlhYmxlUGFyc2VyLCBGcmFtZUlkVmFyaWFibGVQYXJzZXIsXHJcbiAgU3RhdGVNYWNoaW5lVmFyaWFibGVQYXJzZXIsIFVJU3RhdGVWYXJpYWJsZVBhcnNlciwgVmFyaWFibGVQYXJzZVNlcnZpY2VcclxufSBmcm9tICcuLi92YXJpYWJsZSc7XHJcbmltcG9ydCB7IFZpZXdNb2RlbE1hbmFnZXIgfSBmcm9tICcuL3ZpZXdfbW9kZWxfbWFuYWdlcic7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3J5JztcclxuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnLi4vZW50aXR5JztcclxuaW1wb3J0IHsgVUlTdGF0ZSB9IGZyb20gJy4uL3VpLXN0YXRlJztcclxuaW1wb3J0IHsgU2NoZW1hIH0gZnJvbSAnLi4vc2NoZW1hJztcclxuaW1wb3J0IHsgQ29udGV4dE1ldGFkYXRhTWFuYWdlciB9IGZyb20gJy4vcmVuZGVyX2NvbnRleHRfbWV0YWRhdGFfbWFuYWdlcic7XHJcbmltcG9ydCB7IEZvcm0gfSBmcm9tICcuLi9mb3JtJztcclxuaW1wb3J0IHsgVmlld01vZGVsIH0gZnJvbSAnLi4vdmlldy1tb2RlbCc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJy4uL2ZyYW1lL2ZyYW1lX2NvbnRleHQnO1xyXG5pbXBvcnQgeyBOQU1FU1BBQ0UsIEZSQU1FX0lEIH0gZnJvbSAnLi4vZnJhbWUvdG9rZW5zJztcclxuaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICcuLi9ldmVudC1idXMtbmV3JztcclxuaW1wb3J0IHsgREVWS0lUX1JVTl9NT0RFLCBSdW5Nb2RlIH0gZnJvbSAnLi4vY29yZSc7XHJcbmltcG9ydCB7IFJ1bk1vZGVTZXJ2aWNlIH0gZnJvbSAnLi4vbWlzYy9ydW5fbW9kZV9zZXJ2aWNlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgQXBwQ29udGV4dCBleHRlbmRzIENvbnRleHQge1xyXG4gIHB1YmxpYyB0eXBlTmFtZSA9ICdBcHBDb250ZXh0JztcclxuICAvKipcclxuICAgKiDms6jlhaXlmahcclxuICAgKi9cclxuICBwdWJsaWMgaW5qZWN0b3I6IEluamVjdG9yO1xyXG4gIC8qKlxyXG4gICAqIOagueW6lOeUqOS4iuS4i+aWh1xyXG4gICAqL1xyXG4gIHB1YmxpYyByb290OiBBcHBDb250ZXh0O1xyXG4gIC8qKlxyXG4gICAqIOS4iue6p+W6lOeUqOS4iuS4i+aWh1xyXG4gICAqL1xyXG4gIHB1YmxpYyBwYXJlbnQ6IEFwcENvbnRleHQ7XHJcbiAgLyoqXHJcbiAgICog5bqU55So5LiK5LiL5paH566h55CG5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIGFwcENvbnRleHRNYW5hZ2VyOiBBcHBDb250ZXh0TWFuYWdlcjtcclxuICAvKipcclxuICAgKiBGcmFtZUNvbnRleHTnrqHnkIblmahcclxuICAgKi9cclxuICBwdWJsaWMgZnJhbWVDb250ZXh0TWFuYWdlcjogRnJhbWVDb250ZXh0TWFuYWdlcjtcclxuICAvKipcclxuICAgKiBGcmFtZUNvbXBvbmVudOWIt+aWsOWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmcmFtZUNvbXBvbmVudFJlZnJlc2hlcjogRnJhbWVDb21wb25lbnRSZWZyZXNoZXI7XHJcbiAgLyoqXHJcbiAgICogUmVwb3NpdG9yeeeuoeeQhuWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXBvc2l0b3J5TWFuYWdlcjogUmVwb3NpdG9yeU1hbmFnZXI7XHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2u566h55CG5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIGJpbmRpbmdEYXRhTWFuYWdlcjogQmluZGluZ0RhdGFNYW5hZ2VyO1xyXG4gIC8qKlxyXG4gICAqIOinhuWbvuaooeWei+euoeeQhuWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyB2aWV3TW9kZWxNYW5hZ2VyOiBWaWV3TW9kZWxNYW5hZ2VyO1xyXG5cclxuICBwdWJsaWMgY29udGV4dE1ldGFkYXRhTWFuYWdlcjogQ29udGV4dE1ldGFkYXRhTWFuYWdlcjtcclxuICAvKipcclxuICAgKiDlj5jmm7Tmo4DmtYvmjqfliLblmahcclxuICAgKi9cclxuICBwdWJsaWMgY2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlcjogQ2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlcjtcclxuICAvKipcclxuICAgKiDmmK/lkKblt7Lnu4/plIDmr4FcclxuICAgKi9cclxuICBwdWJsaWMgaXNGb3JtRGVzdG9yeWVkID0gZmFsc2U7XHJcbiAgLyoqXHJcbiAgICog5bqU55So56iL5bqP5qCH6K+GXHJcbiAgICovXHJcbiAgcHVibGljIGFwcGxpY2F0aW9uSWQ6IHN0cmluZyA9IG51bGw7XHJcblxyXG4gIHByaXZhdGUgdG9rZW46IHN0cmluZyA9IG51bGw7XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5L2/55So54us56uL55qEZXZlbnRCdXNcclxuICAgKiBAbWVtYmVyb2YgQXBwQ29udGV4dFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1c2VJc29sdXRlRXZlbnRCdXMgPSBmYWxzZTtcclxuXHJcbiAgLyoqXHJcbiAgICog54us56uL55qEZXZlbnRCdXPlrp7kvotcclxuICAgKlxyXG4gICAqIEB0eXBlIHtFdmVudEJ1c31cclxuICAgKiBAbWVtYmVyb2YgQXBwQ29udGV4dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBpc29sdXRlRXZlbnRCdXM6IEV2ZW50QnVzO1xyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8muivt+S9v+eUqEZyYW1lQ29udGV4dE1hbmFnZXLnmoRnZXRGcmFtZUNvbnRleHRNYXDmlrnms5Xku6Pmm7/jgIJcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIEBzdW1tYXJ5XHJcbiAgICog5bey57uP5pyJ6L+Q6KGM5pe255u05o6l55So5Lit5ous5Y+36K6/6Zeu6K+l5bGe5oCn55qE5Zy65pmv77yM6Jm954S25pivcHJpdmF0Ze+8jOS9huimgei/m+ihjOWFvOWuueOAglxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGZyYW1lQ29udGV4dHMoKTogTWFwPHN0cmluZywgYW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dE1hcCgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmtojmga/nrqHpgZNcclxuICAgKi9cclxuICBwdWJsaWMgbWVzc2FnZVBpcGU6IFN1YmplY3Q8YW55PjtcclxuICAvKipcclxuICAgKiDooajljZVJZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmb3JtSWQ6IHN0cmluZztcclxuICAvKipcclxuICAgKiDnu4Tku7blrp7kvovmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgY29tcG9uZW50UmVmczogTWFwPHN0cmluZywgTWFwPHN0cmluZywgYW55Pj47XHJcbiAgLyoqXHJcbiAgICog6KeG5Zu+57uE5Lu2566h55CG5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIGNvbXBvbmVudE1hbmFnZXI6IENvbXBvbmVudE1hbmFnZXI7XHJcbiAgLyoqXHJcbiAgICog6K6w5b2VY29uZmlybeW8ueeql+aYr+WQpuaJk+W8gFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvcGVuZWQ6IGJvb2xlYW47XHJcbiAgLyoqXHJcbiAgICog5o6S5bqP5p2h5Lu2566h55CG5ZmoXHJcbiAgICovXHJcbiAgLy8gcHVibGljIHNvcnRDb25kaXRpb25NYW5hZ2VyOiBTb3J0Q29uZGl0aW9uTWFuYWdlcjtcclxuICAvKipcclxuICAgKiDov4fmu6TmnaHku7bnrqHnkIblmahcclxuICAgKi9cclxuICAvLyBwdWJsaWMgZmlsdGVyQ29uZGl0aW9uTWFuYWdlcjogRmlsdGVyQ29uZGl0aW9uTWFuYWdlcjtcclxuXHJcbiAgcHJvdGVjdGVkIGNvbnRleHRNZXRhZGF0YUJ1aWxkZXI6IENvbnRleHRNZXRhZGF0YUJ1aWxkZXI7XHJcbiAgLyoqXHJcbiAgICog5bqU55So5LiK5LiL5paH5YWD5pWw5o2u5o+P6L+wXHJcbiAgICovXHJcbiAgcHVibGljIG1ldGFkYXRhOiBJQ29udGV4dE1ldGFkYXRhID0ge307XHJcbiAgLyoqXHJcbiAgICog5bqU55So56iL5bqP5LiK5LiL5paH5YWo5bGA54q25oCBXHJcbiAgICovXHJcbiAgcHVibGljIHVpU3RhdGU6IFVJU3RhdGU7XHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5LuT5bqTXHJcbiAgICovXHJcbiAgcHVibGljIHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8RW50aXR5PjtcclxuXHJcbiAgLyoqXHJcbiAgICog54q25oCB5py6XHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRlTWFjaGluZTogU3RhdGVNYWNoaW5lO1xyXG5cclxuICBwdWJsaWMgdmFyaWFibGVQYXJzZVNlcnZpY2U6IFZhcmlhYmxlUGFyc2VTZXJ2aWNlO1xyXG5cclxuICBwdWJsaWMgbmFtZXNwYWNlOiBzdHJpbmc7XHJcblxyXG4gIHB1YmxpYyByb3V0ZXI6IFJvdXRlcjtcclxuXHJcbiAgcHVibGljIGZvcm1NZXRhZGF0YUNvbnRlbnQ6IGFueTtcclxuICAvKipcclxuICAgKiDmjqfliLblmajov5DooYzmqKHlvI/vvIzmlK/mjIFjb21wYXRpYmxlIHwgaGlnaFNwZWVkXHJcbiAgICovXHJcbiAgcHVibGljIHJ1bk1vZGU6IFJ1bk1vZGU7XHJcblxyXG4gIHB1YmxpYyBnZXQgZm9ybU1vZHVsZSgpOiBGb3JtTW9kdWxlIHtcclxuICAgIHJldHVybiB0aGlzLmZvcm1NZXRhZGF0YUNvbnRlbnQgPyB0aGlzLmZvcm1NZXRhZGF0YUNvbnRlbnQubW9kdWxlIDogbnVsbDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb250cm9sbGVyczogeyBbaWQ6IHN0cmluZ106IENvbW1hbmRDb250cm9sbGVyIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQE9wdGlvbmFsKCkgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgQE9wdGlvbmFsKCkgYXBwQ29udGV4dE1hbmFnZXI6IEFwcENvbnRleHRNYW5hZ2VyLFxyXG4gICAgQE9wdGlvbmFsKCkgQFNraXBTZWxmKCkgcGFyZW50OiBBcHBDb250ZXh0XHJcbiAgKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIHRoaXMuaW5qZWN0b3IgPSBpbmplY3RvcjtcclxuICAgIHRoaXMuYXBwQ29udGV4dE1hbmFnZXIgPSBhcHBDb250ZXh0TWFuYWdlcjtcclxuICAgIHRoaXMuZm9ybUlkID0gdGhpcy5pbmplY3RvciAmJiB0aGlzLmluamVjdG9yLmdldChGT1JNX0lELCBudWxsKSB8fCBudWxsO1xyXG4gICAgLy8g6buY6K6k6L+Q6KGM5qih5byP5Li65YW85a655qih5byPXHJcbiAgICB0aGlzLnJ1bk1vZGUgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0PFJ1bk1vZGU+KERFVktJVF9SVU5fTU9ERSwgUnVuTW9kZS5jb21wYXRpYmxlKSB8fCBSdW5Nb2RlLmNvbXBhdGlibGU7XHJcbiAgICBSdW5Nb2RlU2VydmljZS5zZXRSdW5Nb2RlKHRoaXMucnVuTW9kZSk7XHJcbiAgICB0aGlzLnBhcmFtcy5zZXQoJ2Zvcm1JZCcsIHRoaXMuZm9ybUlkKTtcclxuICAgIHRoaXMucGFyYW1zLnNldCgnYXBwSWQnLCB0aGlzLkFwcGxpY2F0aW9uSWQpO1xyXG4gICAgdGhpcy5wYXJhbXMuc2V0KCd0b2tlbicsIHRoaXMuVG9rZW4pO1xyXG4gICAgLy8g56Gu5a6a54i25a2Q5YWz57O7XHJcbiAgICBpZiAoIXBhcmVudCkge1xyXG4gICAgICB0aGlzLnBhcmVudCA9IG51bGw7XHJcbiAgICAgIHRoaXMucm9vdCA9IHRoaXM7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICAgICAgdGhpcy5yb290ID0gcGFyZW50LnJvb3Q7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZWdpc3RlclRvTWFuYWdlcigpO1xyXG5cclxuICAgIHRoaXMuZnJhbWVDb250ZXh0TWFuYWdlciA9IG5ldyBGcmFtZUNvbnRleHRNYW5hZ2VyKHRoaXMpO1xyXG4gICAgdGhpcy5mcmFtZUNvbXBvbmVudFJlZnJlc2hlciA9IG5ldyBGcmFtZUNvbXBvbmVudFJlZnJlc2hlcigpO1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5TWFuYWdlciA9IG5ldyBSZXBvc2l0b3J5TWFuYWdlcigpO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YU1hbmFnZXIgPSBuZXcgQmluZGluZ0RhdGFNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmNoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIgPSBuZXcgQ2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlcih0aGlzLmZyYW1lQ29udGV4dE1hbmFnZXIpO1xyXG4gICAgdGhpcy5tZXNzYWdlUGlwZSA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHRoaXMuY29tcG9uZW50UmVmcyA9IG5ldyBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBhbnk+PigpO1xyXG4gICAgdGhpcy5jb21wb25lbnRNYW5hZ2VyID0gbmV3IENvbXBvbmVudE1hbmFnZXIodGhpcyk7XHJcbiAgICB0aGlzLmNvbnRleHRNZXRhZGF0YU1hbmFnZXIgPSBuZXcgQ29udGV4dE1ldGFkYXRhTWFuYWdlcigpO1xyXG5cclxuICAgIHRoaXMub3BlbmVkID0gZmFsc2U7XHJcbiAgICAvLyB0aGlzLnNvcnRDb25kaXRpb25NYW5hZ2VyID0gbmV3IFNvcnRDb25kaXRpb25NYW5hZ2VyKCk7XHJcbiAgICAvLyB0aGlzLmZpbHRlckNvbmRpdGlvbk1hbmFnZXIgPSBuZXcgRmlsdGVyQ29uZGl0aW9uTWFuYWdlcigpO1xyXG4gICAgdGhpcy5yb3V0ZXIgPSB0aGlzLmluamVjdG9yICYmIHRoaXMuaW5qZWN0b3IuZ2V0KFJvdXRlcik7XHJcbiAgICB0aGlzLnZpZXdNb2RlbE1hbmFnZXIgPSBuZXcgVmlld01vZGVsTWFuYWdlcigpO1xyXG4gICAgdGhpcy5jb250ZXh0TWV0YWRhdGFCdWlsZGVyID0gbmV3IENvbnRleHRNZXRhZGF0YUJ1aWxkZXIoKTtcclxuICAgIHRoaXMudmFyaWFibGVQYXJzZVNlcnZpY2UgPSBuZXcgVmFyaWFibGVQYXJzZVNlcnZpY2UoW1xyXG4gICAgICBuZXcgRnJhbWVJZFZhcmlhYmxlUGFyc2VyKCksXHJcbiAgICAgIG5ldyBEYXRhVmFyaWFibGVQYXJzZXIoKSxcclxuICAgICAgbmV3IFVJU3RhdGVWYXJpYWJsZVBhcnNlcigpLFxyXG4gICAgICBuZXcgU3RhdGVNYWNoaW5lVmFyaWFibGVQYXJzZXIoKSxcclxuICAgICAgbmV3IENvbW1hbmRWYXJpYWJsZVBhcnNlcigpXHJcbiAgICBdKTtcclxuXHJcbiAgICB0aGlzLmluaXRNZXNzYWdlRXZlbnQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOeUseihqOWNleWFg+aVsOaNruOAgeeKtuaAgeacuuWFg+aVsOaNruOAgeWJjeerr+aehOS7tuWFg+aVsOaNruWIneWni+WMluino+aekOWei+W6lOeUqOS4iuS4i+aWh1xyXG4gICAqIEBwYXJhbSBmb3JtTWV0YWRhdGFDb250ZW50IOihqOWNleWFg+aVsOaNrlxyXG4gICAqIEBwYXJhbSBzdGF0ZU1hY2hpbmVNZXRhZGF0YSDnirbmgIHmnLrlhYPmlbDmja5cclxuICAgKiBAcGFyYW0gY29udHJvbGxlcnMg5YmN56uv5p6E5Lu25YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGluaXRpYWxpemVCeU1ldGFkYXRhKFxyXG4gICAgZm9ybU1ldGFkYXRhQ29udGVudDogYW55LFxyXG4gICAgc3RhdGVNYWNoaW5lTWV0YWRhdGE6IElTdGF0ZU1hY2hpbmUsXHJcbiAgICBjb250cm9sbGVyczogeyBbaWQ6IHN0cmluZ106IENvbW1hbmRDb250cm9sbGVyIH1cclxuICApIHtcclxuICAgIHRoaXMubWV0YWRhdGEgPSB0aGlzLmNvbnRleHRNZXRhZGF0YUJ1aWxkZXIuYnVpbGRBcHBDb250ZXh0TWV0YWRhdGEoZm9ybU1ldGFkYXRhQ29udGVudCwgc3RhdGVNYWNoaW5lTWV0YWRhdGEpO1xyXG4gICAgaWYgKCF0aGlzLnN0YXRlTWFjaGluZSkge1xyXG4gICAgICB0aGlzLnN0YXRlTWFjaGluZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KFN0YXRlTWFjaGluZSwgbmV3IFN0YXRlTWFjaGluZSgpKTtcclxuICAgIH1cclxuICAgIHRoaXMuZm9ybU1ldGFkYXRhQ29udGVudCA9IGZvcm1NZXRhZGF0YUNvbnRlbnQ7XHJcbiAgICB0aGlzLmNvbnRyb2xsZXJzID0gY29udHJvbGxlcnM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWdpc3RlciBjdXJyZW50IEFwcENvbnRleHQgaW5zdGFuY2UgdG8gQXBwQ29udGV4dE1hbmFnZXJcclxuICAgKi9cclxuICBwdWJsaWMgcmVnaXN0ZXJUb01hbmFnZXIoKSB7XHJcbiAgICBpZiAoIXRoaXMuYXBwQ29udGV4dE1hbmFnZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hcHBDb250ZXh0TWFuYWdlci5yZWdpc3RlckFwcENvbnRleHQodGhpcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVbnJlZ2lzdGVyIGN1cnJlbnQgQXBwQ29udGV4dCBpbnN0YW5jZSBmcm9tIEFwcENvbnRleHRNYW5hZ2VyXHJcbiAgICovXHJcbiAgcHVibGljIHVucmVnaXN0ZXJGcm9tTWFuYWdlcihmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkge1xyXG4gICAgaWYgKCF0aGlzLmFwcENvbnRleHRNYW5hZ2VyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYXBwQ29udGV4dE1hbmFnZXIudW5yZWdpc3RlckFwcENvbnRleHQodGhpcyk7XHJcbiAgICAvLyDmuIXnkIZyZXBvc2l0b3J55Y+KYmluZGluZ0RhdGEgXHJcbiAgICAvLyBjb25zdCBmcmFtZUNvbnRleHRzID0gdGhpcy5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dHMoKTtcclxuICAgIGlmIChmcmFtZUNvbnRleHQpIHtcclxuICAgICAgY29uc3QgcmVwb3NpdG9yeSA9IGZyYW1lQ29udGV4dC5yZXBvc2l0b3J5O1xyXG4gICAgICBjb25zdCByZXBvc2l0b3J5TmFtZSA9IHJlcG9zaXRvcnkubmFtZTtcclxuICAgICAgaWYgKHRoaXMucmVwb3NpdG9yeU1hbmFnZXIuaWZSZXBvc2l0b3J5RXhpdHMocmVwb3NpdG9yeU5hbWUpKSB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5TWFuYWdlci51blJlZ2lzdGVSZXBvc2l0b3J5KHJlcG9zaXRvcnlOYW1lKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5iaW5kaW5nRGF0YU1hbmFnZXIuaWZCaW5kaW5nRGF0YUV4aXRzKHJlcG9zaXRvcnlOYW1lKSkge1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0RhdGFNYW5hZ2VyLnVuUmVnaXN0ZUJpbmRpbmdEYXRhKHJlcG9zaXRvcnlOYW1lKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5rOo5YaMRnJhbWVDb250ZXh0XHJcbiAgICovXHJcbiAgcHVibGljIHJlZ0ZyYW1lQ29udGV4dChmcmFtZUNvbnRleHQ6IGFueSk6IHZvaWQge1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IGZyYW1lQ29udGV4dC5yZXBvc2l0b3J5O1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeU5hbWUgPSByZXBvc2l0b3J5Lm5hbWU7XHJcblxyXG4gICAgLy8gUmVwb3NpdG9yeVxyXG4gICAgaWYgKHRoaXMucmVwb3NpdG9yeU1hbmFnZXIuaWZSZXBvc2l0b3J5RXhpdHMocmVwb3NpdG9yeU5hbWUpID09PSBmYWxzZSkge1xyXG4gICAgICB0aGlzLnJlcG9zaXRvcnlNYW5hZ2VyLnJlZ1JlcG9zaXRvcnkocmVwb3NpdG9yeU5hbWUsIHJlcG9zaXRvcnkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJpbmRpbmdEYXRhXHJcbiAgICBpZiAodGhpcy5iaW5kaW5nRGF0YU1hbmFnZXIuaWZCaW5kaW5nRGF0YUV4aXRzKHJlcG9zaXRvcnlOYW1lKSA9PT0gZmFsc2UpIHtcclxuICAgICAgbGV0IGJpbmRpbmdEYXRhID0gbnVsbDtcclxuICAgICAgaWYgKHRoaXMucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQpIHtcclxuICAgICAgICBiaW5kaW5nRGF0YSA9IEJpbmRpbmdEYXRhRmFjdG9yeS5jcmVhdGVGcm9tUmVwb3NpdG9yeShyZXBvc2l0b3J5LCAnLycpO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0RhdGFNYW5hZ2VyLnJlZ0JpbmRpbmdEYXRhKHJlcG9zaXRvcnlOYW1lLCBiaW5kaW5nRGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDogIPomZHot6/nlLHlho3mrKHov5vlhaXnmoTml7blgJnvvIxBcHBDb250ZXh05rKh5pyJ6KKr5rOo6ZSA77yM5L2GQ29tcG9uZW506KKr5YaN5qyh5p6E6YCg55qE5Zy65pmvXHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dE1hbmFnZXIucmVnRnJhbWVDb250ZXh0KGZyYW1lQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVnQ29udGV4dE1ldGFkYXRhKGNvbXBvbmVudElkOiBzdHJpbmcsIGNvbnRleHRNZXRhZGF0YTogSUNvbnRleHRNZXRhZGF0YSkge1xyXG4gICAgaWYgKCF0aGlzLmNvbnRleHRNZXRhZGF0YU1hbmFnZXIuZXhzaXQoY29tcG9uZW50SWQpKSB7XHJcbiAgICAgIHRoaXMuY29udGV4dE1ldGFkYXRhTWFuYWdlci5yZWdpc3Rlcihjb21wb25lbnRJZCwgY29udGV4dE1ldGFkYXRhKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaVtOS4quihqOWNleeahEFwcENvbnRleHRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Rm9ybUFwcENvbnRleHQoKSB7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6ZSA5q+B6KGo5Y2VXHJcbiAgICogQHRvZG86IOS4tOaXtuino+WGs+ihqOWNleWFs+mXreWQjuWvueixoeayoeaciemUgOavgeS6puiOt+WPluS4jeWIsOmUgOavgeaXtuacuueahOmXrumimCzlupTkvp3otZZhbmd1bGFy5pys6Lqr55qE6ZSA5q+B5py65Yi2XHJcbiAgICovXHJcbiAgcHVibGljIGRlc3RvcnkoKSB7XHJcbiAgICB0aGlzLmlzRm9ybURlc3RvcnllZCA9IHRydWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOihqOWNleaYr+WQpuW3sue7j+iiq+mUgOavgVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgaXNEZXN0b3J5ZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pc0Zvcm1EZXN0b3J5ZWQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOW6lOeUqGlkXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBBcHBsaWNhdGlvbklkKCkge1xyXG4gICAgaWYgKCEhdGhpcy5hcHBsaWNhdGlvbklkKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9uSWQ7XHJcbiAgICB9XHJcbiAgICB0aGlzLmFwcGxpY2F0aW9uSWQgPSBVSUQuY3JlYXRlKCk7XHJcbiAgICByZXR1cm4gdGhpcy5hcHBsaWNhdGlvbklkO1xyXG4gIH1cclxuICBwdWJsaWMgc2V0IEFwcGxpY2F0aW9uSWQoYXBwSWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5hcHBsaWNhdGlvbklkID0gYXBwSWQ7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXQgVG9rZW4oKSB7XHJcbiAgICBpZiAoISF0aGlzLnRva2VuKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnRva2VuO1xyXG4gICAgfVxyXG4gICAgdGhpcy50b2tlbiA9IFVJRC5jcmVhdGUoKTtcclxuICAgIHJldHVybiB0aGlzLnRva2VuO1xyXG4gIH1cclxuICBwdWJsaWMgc2V0IFRva2VuKHRva2VuOiBzdHJpbmcpIHtcclxuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcclxuICB9XHJcbiAgLy8gI3JlZ2lvbiDlvIPnlKjnmoTogIHmlrnms5VcclxuXHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77ya6K+35L2/55SoRnJhbWVDb21wb25lbnRSZWZyZXNoZXLnmoRyZWZyZXNoQ29tcG9uZW505pa55rOV5Luj5pu/44CCXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgcmVnaXN0ZXJDb21tYW5kSGFuZGxlcihmcmFtZUlkOiBzdHJpbmcsIGNvbXBvbmVudDogYW55KSB7XHJcbiAgICB0aGlzLmZyYW1lQ29tcG9uZW50UmVmcmVzaGVyLnJlZ0ZyYW1lQ29tcG9uZW50KGZyYW1lSWQsIGNvbXBvbmVudCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8muivt+S9v+eUqEZyYW1lQ29tcG9uZW50UmVmcmVzaGVy55qEcmVmcmVzaENvbXBvbmVudOaWueazleS7o+abv+OAglxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIHJlZnJlc2goKSB7XHJcbiAgICB0aGlzLmZyYW1lQ29tcG9uZW50UmVmcmVzaGVyLnJlZnJlc2hDb21wb25lbnRzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvJror7fkvb/nlKhGcmFtZUNvbnRleHRNYW5hZ2Vy55qEZ2V0RnJhbWVDb250ZXh0QnlJZOaWueazleS7o+abv+OAglxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIGdldEZyYW1lQ29udGV4dChmcmFtZUlkOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldENvbnRleHRCeUlkKGlkZW50aWZ5OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGlkZW50aWZ5KTtcclxuICAgIHJldHVybiBjb250ZXh0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77ya6K+35L2/55SoRnJhbWVDb250ZXh0TWFuYWdlcueahGdldEZyYW1lQ29udGV4dE1hcOaWueazleS7o+abv+OAglxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIGdldEFsbEZyYW1lQ29udGV4dHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dE1hcCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CG6KGM5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGhhbmRsZVNlbGVjdENoYW5nZShjaGFuZ2U6IENoYW5nZSwgc3JjRnJhbWVDb250ZXh0OiBhbnkpIHtcclxuICAgIGNvbnN0IGZvcmNlID0gY2hhbmdlLmZvcmNlIHx8IGZhbHNlO1xyXG4gICAgdGhpcy5mcmFtZUNvbnRleHRzLmZvckVhY2goKHRhcmdldEZyYW1lQ29udGV4dCkgPT4ge1xyXG4gICAgICAvLyDnm7jlkIznmoRGcmFtZUNvdG5leHTmiJbogIVSZXBvc2l0b3J55LiN5LiA6Ie055qE5oOF5Ya15LiL77yM5LiN5ZCM5q2lXHJcbiAgICAgIGlmICh0YXJnZXRGcmFtZUNvbnRleHQgPT09IHNyY0ZyYW1lQ29udGV4dFxyXG4gICAgICAgIHx8IHRhcmdldEZyYW1lQ29udGV4dC5yZXBvc2l0b3J5ICE9PSBzcmNGcmFtZUNvbnRleHQucmVwb3NpdG9yeSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgYmluZGluZ0RhdGEgPSB0YXJnZXRGcmFtZUNvbnRleHQuYmluZGluZ0RhdGE7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCA9IGJpbmRpbmdEYXRhLmdldFZhbHVlKGNoYW5nZS5wYXRoKTtcclxuICAgICAgY29uc3QgY3VycmVudElkID0gY2hhbmdlLnZhbHVlWydpZCddO1xyXG4gICAgICBpZiAoYmluZGluZ0xpc3QgJiYgYmluZGluZ0xpc3QuY3VycmVudElkICE9PSBjdXJyZW50SWQgfHwgZm9yY2UpIHtcclxuXHJcbiAgICAgICAgLy8g6K6+572u5b2T5YmN6KGM77yM5L2G5LiN5a+55aSW5bm/5pKtXHJcbiAgICAgICAgYmluZGluZ0xpc3Quc2V0Q3VycmVudElkKGN1cnJlbnRJZCwgdHJ1ZSwgZmFsc2UsIGZvcmNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIHByaXZhdGUgaW5pdE1lc3NhZ2VFdmVudCgpIHtcclxuICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudCAhPT0gdGhpcykge1xyXG4gICAgICBsZXQgcmVzdWx0VGFzaztcclxuICAgICAgY29uc3QgbWVzc2FnZXIgPSBNZXNzYWdlTWFuYWdlci5nZXRNZXNzYWdlcigpO1xyXG4gICAgICBtZXNzYWdlci5zZXRBcHBDb250ZXh0KHRoaXMpO1xyXG4gICAgICBtZXNzYWdlci5saXN0bmVyKChtc2cpID0+IHtcclxuICAgICAgICBjb25zdCBzb3VyY2UgPSBtc2cuc2VuZGVyIGFzIFdpbmRvdztcclxuICAgICAgICBjb25zdCBkYXRhID0gbXNnLmRhdGEgYXMgTWVzc2FnZURhdGE7XHJcblxyXG4gICAgICAgIGNvbnN0IGFwcGNvbnRleHQgPSBtZXNzYWdlci5nZXRBcHBDb250ZXh0KCk7XHJcbiAgICAgICAgY29uc3QgYWxsRnJhbWVDb250ZXh0ID0gYXBwY29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dE1hcCgpO1xyXG4gICAgICAgIGlmIChkYXRhLmNvbW1hbmQgPT09ICd3Zi1yZXF1aXJlZC12ZXJpZmljYXRpb24nKSB7IC8vIOW3peS9nOa1geeahOW/heWhq+agoemqjFxyXG4gICAgICAgICAgLy8g5rOo5YWlVmFsaWRhdGlvbkhhbmRsZXJcclxuICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB0aGlzLmluamVjdG9yLmdldDxJVmFsaWRhdGlvbkhhbmRsZXI+KFZBTElEQVRJT05fSEFORExFUiwgbnVsbCwgSW5qZWN0RmxhZ3MuT3B0aW9uYWwpO1xyXG4gICAgICAgICAgaWYgKHZhbGlkYXRpb24pIHtcclxuICAgICAgICAgICAgcmVzdWx0VGFzayA9IHZhbGlkYXRpb24udmFsaWRhdGVBbGwoKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSB0aGlzLmZpbmRIYW5kbGVyKGFsbEZyYW1lQ29udGV4dCwgZGF0YS5jb21tYW5kKTtcclxuICAgICAgICAgIGlmIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdFRhc2sgPSAoY29tbWFuZCBhcyBhbnkpKGRhdGEuYXJndW1lbnRzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChyZXN1bHRUYXNrKSB7XHJcbiAgICAgICAgICByZXN1bHRUYXNrLnBpcGUodGhyb3dJZkVtcHR5KCkpLnN1YnNjcmliZSgocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIOWQkeadpea6kOaWueWbnuS8oOa2iOaBr1xyXG4gICAgICAgICAgICBjb25zdCByZXRNc2cgPSBuZXcgTWVzc2FnZUJvZHkobmV3IE1lc3NhZ2VEYXRhKCkpO1xyXG4gICAgICAgICAgICByZXRNc2cuZGF0YS5yZXN1bHQgPSB0cnVlOyAvLyDnm67moIfmlrnms5Xov5Tlm57lgLxcclxuICAgICAgICAgICAgcmV0TXNnLnR5cGUgPSAnbWVzc2FnZSc7XHJcbiAgICAgICAgICAgIHJldE1zZy50YXJnZXQgPSBzb3VyY2U7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VyLnNlbmQocmV0TXNnKTtcclxuICAgICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmV0TXNnID0gbmV3IE1lc3NhZ2VCb2R5KG5ldyBNZXNzYWdlRGF0YSgpKTtcclxuICAgICAgICAgICAgcmV0TXNnLmRhdGEucmVzdWx0ID0gZmFsc2U7IC8vIOebruagh+aWueazlei/lOWbnuWAvFxyXG4gICAgICAgICAgICByZXRNc2cudHlwZSA9ICdtZXNzYWdlJztcclxuICAgICAgICAgICAgcmV0TXNnLnRhcmdldCA9IHNvdXJjZTtcclxuICAgICAgICAgICAgbWVzc2FnZXIuc2VuZChyZXRNc2cpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZmluZEhhbmRsZXIoY29udGV4dE1hcDogTWFwPHN0cmluZywgYW55PiwgY29tbWFuZDogc3RyaW5nKTogYW55IHtcclxuICAgIGxldCBmdW5jO1xyXG4gICAgY29uc3QgdGVtcCA9IFsuLi5jb250ZXh0TWFwLnZhbHVlcygpXTtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogZm9yaW5cclxuICAgIGZvciAoY29uc3QgdiBpbiB0ZW1wKSB7XHJcbiAgICAgIGNvbnN0IHZtID0gdGVtcFt2XS52aWV3TW9kZWw7XHJcbiAgICAgIGlmICh2bSAmJiB2bS5oYXNPd25Qcm9wZXJ0eShjb21tYW5kKSkge1xyXG4gICAgICAgIGZ1bmMgPSB2bVtjb21tYW5kXTtcclxuICAgICAgICByZXR1cm4gZnVuYztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIHB1YmxpYyBidWlsZFJlbmRlclZpZXdDb250ZXh0KGNvbXBvbmVudElkOiBzdHJpbmcpIHtcclxuICAgIC8vIOaPkOWPluinhuWbvuaooeWei+mbhuWQiFxyXG4gICAgY29uc3Qgdmlld01vZGVscyA9IHRoaXMuZm9ybU1vZHVsZS52aWV3bW9kZWxzO1xyXG4gICAgLy8g5o+Q5Y+W57uE5Lu25o+P6L+w6ZuG5ZCIXHJcbiAgICBjb25zdCB2aWV3Q29tcG9uZW50cyA9IHRoaXMuZm9ybU1vZHVsZS5jb21wb25lbnRzO1xyXG4gICAgLy8g5o+Q5Y+Wc2NoZW1h6IqC54K5XHJcbiAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmZvcm1Nb2R1bGUuc2NoZW1hc1swXTtcclxuICAgIC8vIOafpeaJvuWMuemFjeaMh+Wumuagh+ivhueahOe7hOS7tuiKgueCuVxyXG4gICAgY29uc3QgbWF0Y2hlZENvbXBvbmVudCA9IHZpZXdDb21wb25lbnRzLmZpbmQoY29tcG9uZW50ID0+IGNvbXBvbmVudC5pZCA9PT0gY29tcG9uZW50SWQpO1xyXG4gICAgLy8g5Yy56YWN5oyH5a6a57uE5Lu255qE6KeG5Zu+5qih5Z6L6IqC54K5XHJcbiAgICBjb25zdCBtYXRjaGVkVmlld01vZGVsID0gdmlld01vZGVscy5maW5kKHZpZXdNb2RlbCA9PiBtYXRjaGVkQ29tcG9uZW50LnZpZXdNb2RlbCA9PT0gdmlld01vZGVsLmlkKTtcclxuICAgIC8vIOafpeaJvuWMuemFjeinhuWbvuaooeWei+eahOeItuiKgueCuVxyXG4gICAgY29uc3QgcGFyZW50Vmlld01vZGVsID0gdmlld01vZGVscy5maW5kKHZpZXdNb2RlbCA9PiB2aWV3TW9kZWwuaWQgPT09IG1hdGNoZWRWaWV3TW9kZWwucGFyZW50KTtcclxuICAgIGxldCBwYXJlbnRDb21wb25lbnRJZCA9ICcnO1xyXG4gICAgLy8g5aaC5p6c5Yy56YWN5LiK5LiK57qn6KeG5Zu+5qih5Z6L77yM5o+Q5LiK57qn6KeG5Zu+5qCH6K+GXHJcbiAgICBpZiAocGFyZW50Vmlld01vZGVsKSB7XHJcbiAgICAgIGNvbnN0IHBhcmVudENvbXBvbmVudCA9IHZpZXdDb21wb25lbnRzLmZpbmQoY29tcG9uZW50ID0+IGNvbXBvbmVudC52aWV3TW9kZWwgPT09IHBhcmVudFZpZXdNb2RlbC5pZCk7XHJcbiAgICAgIGlmIChwYXJlbnRDb21wb25lbnQpIHtcclxuICAgICAgICBwYXJlbnRDb21wb25lbnRJZCA9IHBhcmVudENvbXBvbmVudC5pZDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g5aaC5p6c5a2Y5Zyo5LiK57qn57uE5Lu277yM5o+Q5Y+W5Zmo5LiK5LiL5paH5a+56LGh44CCXHJcbiAgICAvLyBjb25zdCBwYXJlbnRWaWV3Q29udGV4dCA9IHBhcmVudENvbXBvbmVudElkID8gdGhpcy5nZXRDb250ZXh0QnlJZChwYXJlbnRDb21wb25lbnRJZCkgOiBudWxsO1xyXG4gICAgLy8gdGhpcy5idWlsZFJlbmRlclZpZXdDb250ZXh0UmVjdXJzaXZlbHkobWF0Y2hlZFZpZXdNb2RlbCwgcGFyZW50Vmlld0NvbnRleHQsIHNjaGVtYSk7XHJcbiAgICB0aGlzLmJ1aWxkUmVuZGVyVmlld0NvbnRleHRSZWN1cnNpdmVseShtYXRjaGVkVmlld01vZGVsLCBzY2hlbWEpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBidWlsZFJlbmRlclZpZXdDb250ZXh0UmVjdXJzaXZlbHkodmlld01vZGVsOiBJRm9ybVZpZXdNb2RlbCwgc2NoZW1hOiBTY2hlbWEpIHtcclxuICAgIGNvbnN0IGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcclxuICAgIGNvbnN0IHZpZXdDb21wb25lbnRzID0gdGhpcy5mb3JtTW9kdWxlLmNvbXBvbmVudHM7XHJcbiAgICBjb25zdCBtYXRjaGVkQ29tcG9uZW50ID0gdmlld0NvbXBvbmVudHMuZmluZChjb21wb25lbnQgPT4gY29tcG9uZW50LnZpZXdNb2RlbCA9PT0gdmlld01vZGVsLmlkKTtcclxuICAgIGNvbnN0IGNvbnRleHRNZXRhZGF0YSA9IHRoaXMuY29udGV4dE1ldGFkYXRhQnVpbGRlci5idWlsZFZpZXdDb250ZXh0TWV0YWRhdGEobWF0Y2hlZENvbXBvbmVudCwgdmlld01vZGVsLCBzY2hlbWEsIGNvbnRyb2xsZXJzKTtcclxuICAgIC8vIGNvbnN0IGNvbW1hbmRIYW5kbGVyczogQ29tbWFuZEhhbmRsZXJbXSA9IHRoaXMuYnVpbGRDb21tYW5kSGFuZGxlcnModmlld01vZGVsLmNvbW1hbmRzLCBjb250cm9sbGVycyk7XHJcbiAgICAvLyBjb25zdCBjb21tYW5kSGFuZGxlckV4dGVuZHM6IENvbW1hbmRIYW5kbGVyRXh0ZW5kZXJbXSA9IFtdO1xyXG4gICAgLy8gY29uc3Qgdmlld0NvbnRleHQgPSBuZXcgVmlld0NvbXBvbmVudENvbnRleHQoXHJcbiAgICAvLyAgIGNvbnRleHRNZXRhZGF0YSxcclxuICAgIC8vICAgdGhpcyxcclxuICAgIC8vICAgcGFyZW50LFxyXG4gICAgLy8gICB0aGlzLmluamVjdG9yXHJcbiAgICAvLyApO1xyXG4gICAgLy8gdGhpcy5yZWdGcmFtZUNvbnRleHQodmlld0NvbnRleHQpO1xyXG4gICAgLy8gdmlld0NvbnRleHQuaW5pdCgpO1xyXG5cclxuICAgIHRoaXMucmVnQ29udGV4dE1ldGFkYXRhKG1hdGNoZWRDb21wb25lbnQuaWQsIGNvbnRleHRNZXRhZGF0YSk7XHJcblxyXG4gICAgY29uc3Qgdmlld01vZGVscyA9IHRoaXMuZm9ybU1vZHVsZS52aWV3bW9kZWxzO1xyXG4gICAgY29uc3Qgc3ViVmlld01vZGVscyA9IHZpZXdNb2RlbHMuZmlsdGVyKHN1YlZpZXdNb2RlbCA9PiBzdWJWaWV3TW9kZWwucGFyZW50ID09PSB2aWV3TW9kZWwuaWQpO1xyXG4gICAgaWYgKHN1YlZpZXdNb2RlbHMgJiYgc3ViVmlld01vZGVscy5sZW5ndGgpIHtcclxuICAgICAgc3ViVmlld01vZGVscy5mb3JFYWNoKHN1YlZpZXdNb2RlbCA9PiB7XHJcbiAgICAgICAgdGhpcy5idWlsZFJlbmRlclZpZXdDb250ZXh0UmVjdXJzaXZlbHkoc3ViVmlld01vZGVsLCBzY2hlbWEpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb21wb25lbnRQcm92aWRlcnMoY29tcG9uZW50SWQ6IHN0cmluZyk6IGFueVtdIHtcclxuICAgIGNvbnN0IGNvbnRleHRNZXRhZGF0YSA9IHRoaXMuY29udGV4dE1ldGFkYXRhTWFuYWdlci5nZXRDb250ZXh0TWV0YWRhdGFCeU5hbWUoY29tcG9uZW50SWQpO1xyXG4gICAgY29uc3QgYmluZGluZ0RhdGEgPSBuZXcgQmluZGluZ0RhdGEoKTtcclxuICAgIGNvbnN0IGZvcm0gPSBuZXcgRm9ybSgpO1xyXG4gICAgY29uc3QgbmFtZXNwYWNlID0gY29udGV4dE1ldGFkYXRhLm5hbWVzcGFjZTtcclxuICAgIGNvbnN0IHJlcG9zaXRvcnkgPSB0aGlzLmluamVjdG9yLmdldChSZXBvc2l0b3J5LCBudWxsKSB8fCB0aGlzLnJlcG9zaXRvcnk7XHJcbiAgICBjb25zdCBzdGF0ZU1hY2hpbmUgPSB0aGlzLnN0YXRlTWFjaGluZTtcclxuICAgIGNvbnN0IHVpU3RhdGUgPSBuZXcgVUlTdGF0ZSgpO1xyXG4gICAgY29uc3Qgdmlld01vZGVsID0gbmV3IFZpZXdNb2RlbCgpO1xyXG4gICAgdmlld01vZGVsLnNldE1ldGFkYXRhKGNvbnRleHRNZXRhZGF0YSk7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICB7IHByb3ZpZGU6IEZSQU1FX0lELCB1c2VWYWx1ZTogY29tcG9uZW50SWQgfSxcclxuICAgICAgeyBwcm92aWRlOiBOQU1FU1BBQ0UsIHVzZVZhbHVlOiBuYW1lc3BhY2UgfSxcclxuICAgICAgeyBwcm92aWRlOiBGcmFtZUNvbnRleHQsIHVzZUNsYXNzOiBGcmFtZUNvbnRleHQgfSxcclxuICAgICAgeyBwcm92aWRlOiBBcHBDb250ZXh0LCB1c2VWYWx1ZTogdGhpcyB9LFxyXG4gICAgICB7IHByb3ZpZGU6IEJpbmRpbmdEYXRhLCB1c2VWYWx1ZTogYmluZGluZ0RhdGEgfSxcclxuICAgICAgeyBwcm92aWRlOiBGb3JtLCB1c2VWYWx1ZTogZm9ybSB9LFxyXG4gICAgICB7IHByb3ZpZGU6IFJlcG9zaXRvcnksIHVzZVZhbHVlOiByZXBvc2l0b3J5IH0sXHJcbiAgICAgIHsgcHJvdmlkZTogU3RhdGVNYWNoaW5lLCB1c2VWYWx1ZTogc3RhdGVNYWNoaW5lIH0sXHJcbiAgICAgIHsgcHJvdmlkZTogVUlTdGF0ZSwgdXNlVmFsdWU6IHVpU3RhdGUgfSxcclxuICAgICAgeyBwcm92aWRlOiBWaWV3TW9kZWwsIHVzZVZhbHVlOiB2aWV3TW9kZWwgfSxcclxuICAgICAge1xyXG4gICAgICAgIHByb3ZpZGU6IFZhcmlhYmxlUGFyc2VTZXJ2aWNlLCB1c2VWYWx1ZTogbmV3IFZhcmlhYmxlUGFyc2VTZXJ2aWNlKFtcclxuICAgICAgICAgIG5ldyBGcmFtZUlkVmFyaWFibGVQYXJzZXIoKSxcclxuICAgICAgICAgIG5ldyBEYXRhVmFyaWFibGVQYXJzZXIoKSxcclxuICAgICAgICAgIG5ldyBVSVN0YXRlVmFyaWFibGVQYXJzZXIoKSxcclxuICAgICAgICAgIG5ldyBTdGF0ZU1hY2hpbmVWYXJpYWJsZVBhcnNlcigpLFxyXG4gICAgICAgICAgbmV3IENvbW1hbmRWYXJpYWJsZVBhcnNlcigpXHJcbiAgICAgICAgXSlcclxuICAgICAgfVxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIC8vIHByaXZhdGUgYnVpbGRDb21tYW5kSGFuZGxlcnMoY29tbWFuZE1ldGFkYXRhQXJyYXk6IElGb3JtVmlld01vZGVsQ29tbWFuZFtdLCBjb250cm9sbGVyczogeyBbaWQ6IHN0cmluZ106IENvbW1hbmRDb250cm9sbGVyIH0pXHJcbiAgLy8gICA6IENvbW1hbmRIYW5kbGVyW10ge1xyXG4gIC8vICAgY29uc3QgY29tbWFuZEhhbmRsZXJzOiBDb21tYW5kSGFuZGxlcltdID0gW107XHJcbiAgLy8gICBjb21tYW5kTWV0YWRhdGFBcnJheS5yZWR1Y2U8Q29tbWFuZEhhbmRsZXJbXT4oKHByZXZpb3VzVmFsdWU6IENvbW1hbmRIYW5kbGVyW10sIGNvbW1hbmRSZWZlcmVuY2U6IElGb3JtVmlld01vZGVsQ29tbWFuZCkgPT4ge1xyXG4gIC8vICAgICBjb25zdCBjb21tYW5kTmFtZSA9IGNvbW1hbmRSZWZlcmVuY2UuY29kZTtcclxuICAvLyAgICAgY29uc3QgY29udHJvbGxlcklkID0gY29tbWFuZFJlZmVyZW5jZS5jbXBJZDtcclxuICAvLyAgICAgY29uc3QgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzW2NvbnRyb2xsZXJJZF07XHJcbiAgLy8gICAgIGNvbnN0IG1ldGhvZCA9IE9iamVjdC5hc3NpZ24oe30sIGNvbnRyb2xsZXIubWV0aG9kc1tjb21tYW5kUmVmZXJlbmNlLmhhbmRsZXJOYW1lXSk7XHJcbiAgLy8gICAgIG1ldGhvZC5wYXJhbXMgPSBtZXRob2QucGFyYW1zLm1hcChwYXJhbSA9PiBPYmplY3QuYXNzaWduKHt9LCBwYXJhbSkpO1xyXG4gIC8vICAgICBpZiAobWV0aG9kLnBhcmFtcyAmJiBtZXRob2QucGFyYW1zLmxlbmd0aCkge1xyXG4gIC8vICAgICAgIGNvbW1hbmRSZWZlcmVuY2UucGFyYW1zLnJlZHVjZTxDb250cm9sbGVyTWV0aG9kPigocHJldmlvdXNNZXRob2RWYWx1ZTogQ29udHJvbGxlck1ldGhvZCwgcGFyYW06IElGb3JtVmlld01vZGVsQ29tbWFuZFBhcmFtKSA9PiB7XHJcbiAgLy8gICAgICAgICBjb25zdCBtZXRob2RQYXJhbSA9IHByZXZpb3VzTWV0aG9kVmFsdWUucGFyYW1zLmZpbmQodmFsdWUgPT4gdmFsdWUubmFtZSA9PT0gcGFyYW0ubmFtZSk7XHJcbiAgLy8gICAgICAgICBpZiAobWV0aG9kUGFyYW0pIHtcclxuICAvLyAgICAgICAgICAgbWV0aG9kUGFyYW0uZXhwcmVzc2lvbiA9IHBhcmFtLnZhbHVlO1xyXG4gIC8vICAgICAgICAgfVxyXG4gIC8vICAgICAgICAgcmV0dXJuIHByZXZpb3VzTWV0aG9kVmFsdWU7XHJcbiAgLy8gICAgICAgfSwgbWV0aG9kKTtcclxuICAvLyAgICAgfVxyXG4gIC8vICAgICBjb25zdCBjb21tYW5kSGFuZGxlciA9IG5ldyBEeW5hbWljQ29tbWFuZEhhbmRsZXIoY29tbWFuZE5hbWUsIG1ldGhvZCk7XHJcbiAgLy8gICAgIHByZXZpb3VzVmFsdWUucHVzaChjb21tYW5kSGFuZGxlcik7XHJcbiAgLy8gICAgIHJldHVybiBwcmV2aW91c1ZhbHVlO1xyXG4gIC8vICAgfSwgY29tbWFuZEhhbmRsZXJzKTtcclxuICAvLyAgIHJldHVybiBjb21tYW5kSGFuZGxlcnM7XHJcbiAgLy8gfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgQXBwQ29udGV4dCB9O1xyXG4iXX0=