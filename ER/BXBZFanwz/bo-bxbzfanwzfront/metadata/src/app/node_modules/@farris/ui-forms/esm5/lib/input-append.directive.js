/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Renderer2, Injector, Input, Output, ViewContainerRef, NgZone } from '@angular/core';
import { EventEmitter } from '@angular/core';
var InputAppendDirective = /** @class */ (function () {
    // private ngControl: NgControl;
    function InputAppendDirective(viewRef, el, render, injector) {
        this.viewRef = viewRef;
        this.el = el;
        this.render = render;
        this.injector = injector;
        this._enableAppend = true;
        // 追加到哪个类型下 TextBox、MultiTextBox、 StaticText
        this.inputAppendControlType = "InputGroup";
        // 根据类型不一样，在控件处于禁用、只读时，决定颜色是否可用
        this.inputAppendType = "button";
        // 追加的文本
        this._inputAppendText = '';
        // 模板
        // @Input() inputAppendTmpl: TemplateRef<any>;
        this._disabled = false;
        /*
            * 文本点击事件
            */
        this.inputAppendClickEvent = new EventEmitter();
        // 标记native的外层
        this.elWrapElement = null;
        // 标记元素
        this.appendWrapElement = null;
        // 暂时不用
        this.appendTextElement = null;
        this.clickHandler = null;
        this.disabledCls = 'f-state-disabled';
        this.ngZone = null;
        this.ngZone = this.injector.get(NgZone);
    }
    Object.defineProperty(InputAppendDirective.prototype, "enableAppend", {
        get: /**
         * @return {?}
         */
        function () {
            return this._enableAppend;
        },
        // 相当于启用禁用此功能
        set: 
        // 相当于启用禁用此功能
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value === '' || value) {
                this._enableAppend = true;
                // 需要
                if (!this.appendWrapElement) {
                    this.createStruct();
                }
            }
            else {
                this._enableAppend = false;
                if (this.appendWrapElement) {
                    this.resetStruct();
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputAppendDirective.prototype, "inputAppendText", {
        get: /**
         * @return {?}
         */
        function () {
            return this._inputAppendText;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value != this._inputAppendText) {
                this._inputAppendText = value;
                if (this.appendWrapElement && this._enableAppend) {
                    this.render.removeChild(this.appendWrapElement, this.appendTextElement);
                    this.appendTextElement.innerHTML = value;
                    this.render.appendChild(this.appendWrapElement, this.appendTextElement);
                }
                else {
                    this.createStruct();
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputAppendDirective.prototype, "inputAppendDisabled", {
        get: /**
         * @return {?}
         */
        function () {
            return this._disabled;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value != this._disabled) {
                this._disabled = value;
                if (this.appendWrapElement) {
                    value && this.render.addClass(this.appendWrapElement, this.disabledCls);
                    !value && this.render.removeClass(this.appendWrapElement, this.disabledCls);
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    InputAppendDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        //this.ngControl = this.injector.get(NgControl, null);
    };
    /**
     * @return {?}
     */
    InputAppendDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.createStruct();
    };
    /**
     * @return {?}
     */
    InputAppendDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        //this.resetStruct();
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
        if (this.elWrapElement) {
            this.elWrapElement.remove();
            this.elWrapElement = null;
        }
    };
    /**
     * 重置
     */
    /**
     * 重置
     * @private
     * @return {?}
     */
    InputAppendDirective.prototype.resetStruct = /**
     * 重置
     * @private
     * @return {?}
     */
    function () {
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        // 分类型移除不同新增加的结构或样式
        switch (this.inputAppendControlType) {
            case 'StaticText':
                this.render.removeClass(this.el.nativeElement, 'f-cmp-static-text-input-append');
                break;
            case 'TextBox':
            case 'MultiTextBox':
                if (this.elWrapElement) {
                    /** @type {?} */
                    var wrapParent = this.render.parentNode(this.elWrapElement);
                    this.render.appendChild(wrapParent, this.el.nativeElement);
                    this.elWrapElement.remove();
                    this.elWrapElement = null;
                }
                break;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
    };
    /**
     * 创建
     */
    /**
     * 创建
     * @private
     * @return {?}
     */
    InputAppendDirective.prototype.createStruct = /**
     * 创建
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.inputAppendText || !this.enableAppend || this.appendWrapElement) {
            return;
        }
        /** @type {?} */
        var buttonWrap = this.render.createElement('div');
        buttonWrap.className = 'input-group-append input-append-wrapper';
        buttonWrap.className += ' input-append-' + this.inputAppendType;
        if (this._disabled) {
            buttonWrap.className += ' ' + this.disabledCls;
        }
        /** @type {?} */
        var buttonTextWrap = this.render.createElement('div');
        buttonTextWrap.className = 'input-group-text';
        buttonTextWrap.innerHTML = this.inputAppendText;
        this.appendTextElement = buttonTextWrap;
        this.appendWrapElement = buttonWrap;
        this.render.appendChild(buttonWrap, buttonTextWrap);
        switch (this.inputAppendControlType) {
            case 'StaticText':
                // 此时还没有生成内部的样式
                // let textareaEl = this.el.nativeElement.querySelector('.f-form-control-textarea');
                this.render.addClass(this.el.nativeElement, 'f-cmp-static-text-input-append' + (this._disabled ? ' ' + this.disabledCls : ''));
                this.render.appendChild(this.el.nativeElement, buttonWrap);
                break;
            case 'TextBox':
            case 'MultiTextBox':
                /** @type {?} */
                var textParent = this.render.parentNode(this.el.nativeElement);
                /** @type {?} */
                var inputWrap = this.render.createElement('div');
                inputWrap.className = 'f-cmp-text-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                if (this.el.nativeElement.outerHTML.indexOf('textarea') > -1) {
                    inputWrap.className = 'f-cmp-textarea-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                }
                this.elWrapElement = inputWrap;
                this.render.appendChild(inputWrap, this.el.nativeElement);
                this.render.appendChild(inputWrap, buttonWrap);
                this.render.appendChild(textParent, inputWrap);
                break;
            default:
                // 存在类似下拉这样的控件，内部调用input-group结构还没有初始化
                /** @type {?} */
                var inputGroupEl = this.el.nativeElement.querySelector('.input-group');
                if (inputGroupEl) {
                    this.render.appendChild(inputGroupEl, buttonWrap);
                }
                else {
                    if (this.ngZone) {
                        this.ngZone.runOutsideAngular((/**
                         * @return {?}
                         */
                        function () {
                            setTimeout((/**
                             * @return {?}
                             */
                            function () {
                                /** @type {?} */
                                var inputGroupEl2 = _this.el.nativeElement.querySelector('.input-group');
                                _this.render.appendChild(inputGroupEl2, buttonWrap);
                            }));
                        }));
                    }
                }
        }
        if (this.inputAppendType == 'button') {
            this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
             * @param {?} ev
             * @return {?}
             */
            function (ev) {
                _this.inputAppendClickEvent.emit(ev);
            }));
        }
    };
    InputAppendDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[input-append]',
                },] }
    ];
    /** @nocollapse */
    InputAppendDirective.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: ElementRef },
        { type: Renderer2 },
        { type: Injector }
    ]; };
    InputAppendDirective.propDecorators = {
        enableAppend: [{ type: Input, args: ['input-append',] }],
        inputAppendControlType: [{ type: Input }],
        inputAppendType: [{ type: Input }],
        inputAppendText: [{ type: Input }],
        inputAppendDisabled: [{ type: Input }],
        inputAppendClickEvent: [{ type: Output }]
    };
    return InputAppendDirective;
}());
export { InputAppendDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._enableAppend;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendControlType;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._inputAppendText;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._disabled;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendClickEvent;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.elWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendTextElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.clickHandler;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.disabledCls;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZm9ybXMvIiwic291cmNlcyI6WyJsaWIvaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxLQUFLLEVBQ0wsTUFBTSxFQUFFLGdCQUFnQixFQUFlLE1BQU0sRUFDcEcsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUc3QztJQTRFSSxnQ0FBZ0M7SUFDaEMsOEJBQW9CLE9BQXlCLEVBQVUsRUFBYyxFQUFVLE1BQWlCLEVBQVUsUUFBa0I7UUFBeEcsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUF6RXBILGtCQUFhLEdBQUcsSUFBSSxDQUFDOztRQXFCcEIsMkJBQXNCLEdBQUcsWUFBWSxDQUFDOztRQUV0QyxvQkFBZSxHQUFHLFFBQVEsQ0FBQzs7UUFFNUIscUJBQWdCLEdBQUcsRUFBRSxDQUFDOzs7UUFtQnRCLGNBQVMsR0FBRyxLQUFLLENBQUM7Ozs7UUFrQmhCLDBCQUFxQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7O1FBRTdDLGtCQUFhLEdBQUcsSUFBSSxDQUFDOztRQUVyQixzQkFBaUIsR0FBRyxJQUFJLENBQUM7O1FBRXpCLHNCQUFpQixHQUFHLElBQUksQ0FBQztRQUN6QixpQkFBWSxHQUFHLElBQUksQ0FBQztRQUNwQixnQkFBVyxHQUFHLGtCQUFrQixDQUFDO1FBQ2pDLFdBQU0sR0FBVyxJQUFJLENBQUM7UUFHMUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENB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QUVyRCw2Q0FBNkI7Ozs7O0lBRTdCLGlEQUFpQzs7Ozs7SUFFakMsaURBQWlDOzs7OztJQUNqQyw0Q0FBNEI7Ozs7O0lBQzVCLDJDQUF5Qzs7Ozs7SUFDekMsc0NBQThCOzs7OztJQUVsQix1Q0FBaUM7Ozs7O0lBQUUsa0NBQXNCOzs7OztJQUFFLHNDQUF5Qjs7Ozs7SUFBRSx3Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIEluamVjdG9yLCBPbkluaXQsIElucHV0LFxyXG4gICAgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIE91dHB1dCwgVmlld0NvbnRhaW5lclJlZiwgVGVtcGxhdGVSZWYsIE5nWm9uZVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2lucHV0LWFwcGVuZF0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgSW5wdXRBcHBlbmREaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgICBwcml2YXRlIF9lbmFibGVBcHBlbmQgPSB0cnVlO1xyXG4gICAgLy8g55u45b2T5LqO5ZCv55So56aB55So5q2k5Yqf6IO9XHJcbiAgICBASW5wdXQoJ2lucHV0LWFwcGVuZCcpXHJcbiAgICBzZXQgZW5hYmxlQXBwZW5kKHZhbHVlOiBzdHJpbmcgfCBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlID09PSAnJyB8fCB2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9lbmFibGVBcHBlbmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyDpnIDopoFcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVN0cnVjdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fZW5hYmxlQXBwZW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0U3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgZW5hYmxlQXBwZW5kKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVBcHBlbmQ7XHJcbiAgICB9XHJcbiAgICAvLyDov73liqDliLDlk6rkuKrnsbvlnovkuIsgVGV4dEJveOOAgU11bHRpVGV4dEJveOOAgSBTdGF0aWNUZXh0XHJcbiAgICBASW5wdXQoKSBpbnB1dEFwcGVuZENvbnRyb2xUeXBlID0gXCJJbnB1dEdyb3VwXCI7XHJcbiAgICAvLyDmoLnmja7nsbvlnovkuI3kuIDmoLfvvIzlnKjmjqfku7blpITkuo7npoHnlKjjgIHlj6ror7vml7bvvIzlhrPlrprpopzoibLmmK/lkKblj6/nlKhcclxuICAgIEBJbnB1dCgpIGlucHV0QXBwZW5kVHlwZSA9IFwiYnV0dG9uXCI7XHJcbiAgICAvLyDov73liqDnmoTmlofmnKxcclxuICAgIHByaXZhdGUgX2lucHV0QXBwZW5kVGV4dCA9ICcnO1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBpbnB1dEFwcGVuZFRleHQodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPSB0aGlzLl9pbnB1dEFwcGVuZFRleHQpIHtcclxuICAgICAgICAgICAgdGhpcy5faW5wdXRBcHBlbmRUZXh0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50ICYmIHRoaXMuX2VuYWJsZUFwcGVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2hpbGQodGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgdGhpcy5hcHBlbmRUZXh0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRleHRFbGVtZW50LmlubmVySFRNTCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQodGhpcy5hcHBlbmRXcmFwRWxlbWVudCwgdGhpcy5hcHBlbmRUZXh0RWxlbWVudCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVN0cnVjdCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kVGV4dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRBcHBlbmRUZXh0O1xyXG4gICAgfVxyXG4gICAgLy8g5qih5p2/XHJcbiAgICAvLyBASW5wdXQoKSBpbnB1dEFwcGVuZFRtcGw6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBwcml2YXRlIF9kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBpbnB1dEFwcGVuZERpc2FibGVkKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuX2Rpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVkID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSAmJiB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmRpc2FibGVkQ2xzKTtcclxuICAgICAgICAgICAgICAgICF2YWx1ZSAmJiB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmRpc2FibGVkQ2xzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBpbnB1dEFwcGVuZERpc2FibGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgKiDmlofmnKzngrnlh7vkuovku7ZcclxuICAgICovXHJcbiAgICBAT3V0cHV0KCkgaW5wdXRBcHBlbmRDbGlja0V2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLy8g5qCH6K6wbmF0aXZl55qE5aSW5bGCXHJcbiAgICBwcml2YXRlIGVsV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgLy8g5qCH6K6w5YWD57SgXHJcbiAgICBwcml2YXRlIGFwcGVuZFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgIC8vIOaaguaXtuS4jeeUqFxyXG4gICAgcHJpdmF0ZSBhcHBlbmRUZXh0RWxlbWVudCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICBwcml2YXRlIGRpc2FibGVkQ2xzID0gJ2Ytc3RhdGUtZGlzYWJsZWQnO1xyXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSA9IG51bGw7XHJcbiAgICAvLyBwcml2YXRlIG5nQ29udHJvbDogTmdDb250cm9sO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB2aWV3UmVmOiBWaWV3Q29udGFpbmVyUmVmLCBwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMubmdab25lID0gdGhpcy5pbmplY3Rvci5nZXQoTmdab25lKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICAvL3RoaXMubmdDb250cm9sID0gdGhpcy5pbmplY3Rvci5nZXQoTmdDb250cm9sLCBudWxsKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuY3JlYXRlU3RydWN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgLy90aGlzLnJlc2V0U3RydWN0KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuZWxXcmFwRWxlbWVudCl7XHJcbiAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmHjee9rlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlc2V0U3RydWN0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNsaWNrSGFuZGxlcikge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlcigpO1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWIhuexu+Wei+enu+mZpOS4jeWQjOaWsOWinuWKoOeahOe7k+aehOaIluagt+W8j1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5pbnB1dEFwcGVuZENvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ1N0YXRpY1RleHQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZi1jbXAtc3RhdGljLXRleHQtaW5wdXQtYXBwZW5kJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnVGV4dEJveCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ011bHRpVGV4dEJveCc6XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHdyYXBQYXJlbnQgPSB0aGlzLnJlbmRlci5wYXJlbnROb2RlKHRoaXMuZWxXcmFwRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQod3JhcFBhcmVudCwgdGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7ulxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNyZWF0ZVN0cnVjdCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaW5wdXRBcHBlbmRUZXh0IHx8ICF0aGlzLmVuYWJsZUFwcGVuZCB8fCB0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgYnV0dG9uV3JhcCA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGJ1dHRvbldyYXAuY2xhc3NOYW1lID0gJ2lucHV0LWdyb3VwLWFwcGVuZCBpbnB1dC1hcHBlbmQtd3JhcHBlcic7XHJcbiAgICAgICAgYnV0dG9uV3JhcC5jbGFzc05hbWUgKz0gJyBpbnB1dC1hcHBlbmQtJyArIHRoaXMuaW5wdXRBcHBlbmRUeXBlO1xyXG4gICAgICAgIGlmICh0aGlzLl9kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICBidXR0b25XcmFwLmNsYXNzTmFtZSArPSAnICcgKyB0aGlzLmRpc2FibGVkQ2xzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBidXR0b25UZXh0V3JhcCA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGJ1dHRvblRleHRXcmFwLmNsYXNzTmFtZSA9ICdpbnB1dC1ncm91cC10ZXh0JztcclxuICAgICAgICBidXR0b25UZXh0V3JhcC5pbm5lckhUTUwgPSB0aGlzLmlucHV0QXBwZW5kVGV4dDtcclxuICAgICAgICB0aGlzLmFwcGVuZFRleHRFbGVtZW50ID0gYnV0dG9uVGV4dFdyYXA7XHJcbiAgICAgICAgdGhpcy5hcHBlbmRXcmFwRWxlbWVudCA9IGJ1dHRvbldyYXA7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoYnV0dG9uV3JhcCwgYnV0dG9uVGV4dFdyYXApO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5pbnB1dEFwcGVuZENvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ1N0YXRpY1RleHQnOlxyXG4gICAgICAgICAgICAgICAgLy8g5q2k5pe26L+Y5rKh5pyJ55Sf5oiQ5YaF6YOo55qE5qC35byPXHJcbiAgICAgICAgICAgICAgICAvLyBsZXQgdGV4dGFyZWFFbCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZi1mb3JtLWNvbnRyb2wtdGV4dGFyZWEnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtY21wLXN0YXRpYy10ZXh0LWlucHV0LWFwcGVuZCcrKHRoaXMuX2Rpc2FibGVkPycgJyt0aGlzLmRpc2FibGVkQ2xzOicnKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1RleHRCb3gnOlxyXG4gICAgICAgICAgICBjYXNlICdNdWx0aVRleHRCb3gnOlxyXG4gICAgICAgICAgICAgICAgbGV0IHRleHRQYXJlbnQgPSB0aGlzLnJlbmRlci5wYXJlbnROb2RlKHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dFdyYXAgPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGlucHV0V3JhcC5jbGFzc05hbWUgPSAnZi1jbXAtdGV4dC1pbnB1dC1hcHBlbmQnKyh0aGlzLl9kaXNhYmxlZD8nICcrdGhpcy5kaXNhYmxlZENsczonJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbC5uYXRpdmVFbGVtZW50Lm91dGVySFRNTC5pbmRleE9mKCd0ZXh0YXJlYScpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dFdyYXAuY2xhc3NOYW1lID0gJ2YtY21wLXRleHRhcmVhLWlucHV0LWFwcGVuZCcrKHRoaXMuX2Rpc2FibGVkPycgJyt0aGlzLmRpc2FibGVkQ2xzOicnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudCA9IGlucHV0V3JhcDtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGlucHV0V3JhcCwgdGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGlucHV0V3JhcCwgYnV0dG9uV3JhcCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0ZXh0UGFyZW50LCBpbnB1dFdyYXApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAvLyDlrZjlnKjnsbvkvLzkuIvmi4nov5nmoLfnmoTmjqfku7bvvIzlhoXpg6josIPnlKhpbnB1dC1ncm91cOe7k+aehOi/mOayoeacieWIneWni+WMllxyXG4gICAgICAgICAgICAgICAgbGV0IGlucHV0R3JvdXBFbCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZ3JvdXAnKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbnB1dEdyb3VwRWwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dEdyb3VwRWwsIGJ1dHRvbldyYXApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5uZ1pvbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlucHV0R3JvdXBFbDIgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmlucHV0LWdyb3VwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoaW5wdXRHcm91cEVsMiwgYnV0dG9uV3JhcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlucHV0QXBwZW5kVHlwZSA9PSAnYnV0dG9uJykge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlciA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCAnY2xpY2snLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRBcHBlbmRDbGlja0V2ZW50LmVtaXQoZXYpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19