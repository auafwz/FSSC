/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2019-08-06 07:43:53
* @LastEditors: 疯狂秀才(Lucas Huang)
* @LastEditTime: 2019-11-20 20:14:11
* @QQ: 1055818239
* @Version: v0.0.1
*/
import { ComponentFactoryResolver, ViewContainerRef } from '@angular/core';
import { Component, Input, Renderer2, ViewChild, ElementRef, ViewEncapsulation, Injector, ChangeDetectorRef, Directive, Optional, NgZone } from '@angular/core';
import { DatagridService } from '../../services/datagrid.service';
import { SCROLL_X_ACTION, FIXED_LEFT_SHADOW_CLS, SCROLL_X_REACH_START_ACTION, FIXED_RIGHT_SHADOW_CLS, SCROLL_X_REACH_END_ACTION, GRID_FILTER_ROW } from '../../types/constant';
import { DatagridComponent } from '../../datagrid.component';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
export class DatagridHeaderComponent {
    /**
     * @param {?} render2
     * @param {?} injector
     * @param {?} dg
     * @param {?} ngZone
     */
    constructor(render2, injector, dg, ngZone) {
        this.render2 = render2;
        this.injector = injector;
        this.dg = dg;
        this.ngZone = ngZone;
        this.height = 35;
        this.columns = [];
        this.enableDragColumn = false;
        this.wrapHeader = false;
        this.enableFilterRow = false;
        this.scrollbarMode = 'auto';
        this.ro = null;
        this.rightFixedColumnWidth = 0;
        this.normalColumnWidth = 0;
        this.showOverlay = false;
        this.disableSort = false;
        this.scrollX = 0;
        this.showShadowCls = false;
        this.top = 0;
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.cd = this.injector.get(ChangeDetectorRef);
        this.el = this.injector.get(ElementRef);
        this.dfrs = this.dg.clientFilterService;
        this.dgs.scorll$.subscribe((/**
         * @param {?} d
         * @return {?}
         */
        (d) => {
            if (d.type === SCROLL_X_ACTION || d.type === SCROLL_X_REACH_END_ACTION || d.type === SCROLL_X_REACH_START_ACTION) {
                this.scrollX = d.x;
                this.render2.setStyle(this.headerColumnsTable.nativeElement, 'transform', `translate3d(-${d.x}px, 0px, 0px)`);
                if (!this.dg.groupRows) {
                    if (this.fixedLeft) {
                        if (d.x) {
                            this.render2.addClass(this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                        }
                        else {
                            this.render2.removeClass(this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                        }
                    }
                }
            }
            if (d.type === SCROLL_X_REACH_START_ACTION) {
                if (this.fixedLeft) {
                    this.render2.removeClass(this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                }
            }
        }));
        this.dgs.showFixedShadow.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (this.fixedRight) {
                this.setFixedColumnPosition(e.showRightShadow, e.x);
            }
        }));
        this.dgs.disableHeader.subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        (flag) => {
            this.showOverlay = flag;
            this.disableSort = flag;
            this.cd.detectChanges();
        }));
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set chkAll(v) {
        this._chkall = v;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set fr(val) {
        if (val) {
            this.fixedRight = val;
        }
    }
    // 行号 、 复选框，在多表头下的合并行数
    /**
     * @return {?}
     */
    get rowSpan() {
        return this.columns.length + (this.dg.enableFilterRow ? 1 : 0);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.dgs.checkedRowsTotalChanged$.subscribe((/**
         * @return {?}
         */
        () => {
            if (this._chkall) {
                /** @type {?} */
                const checkedsCount = this.dfs.getCurrentPageCheckeds().length;
                /** @type {?} */
                const isCheckAll = this.dfs.isCheckAll();
                /** @type {?} */
                const isIndeterminate = isCheckAll || !checkedsCount;
                this._chkall.chk.nativeElement.indeterminate = !isIndeterminate;
                /** @type {?} */
                const _checked = isCheckAll && checkedsCount > 0;
                this._chkall.updateStatus(_checked);
            }
        }));
        this.dgs.uncheckAll.subscribe((/**
         * @return {?}
         */
        () => {
            if (this.dg.showAllCheckbox && this._chkall) {
                this._chkall.chk.nativeElement.indeterminate = false;
                this._chkall.chk.nativeElement.checked = false;
            }
        }));
        this.dgs.checkAll.subscribe((/**
         * @return {?}
         */
        () => {
            if (this._chkall) {
                this._chkall.chk.nativeElement.checked = true;
            }
        }));
        this.dgs.scrollbarUpdate.subscribe((/**
         * @param {?} ps
         * @return {?}
         */
        (ps) => {
            this.ps = ps.scrollbarRef;
            this.rightFixedColumnWidth = this.getRightFixedColWidth(this.ps);
            if (this.fixedRight) {
                this.setFixedColumnPosition(this.showShadowCls, 0);
            }
            this.cd.detectChanges();
        }));
        this.dgs.showGridHeader.subscribe((/**
         * @return {?}
         */
        () => {
            this.setHeaderPosition();
        }));
        this.dgs.smartFilterBarExpand.subscribe((/**
         * @return {?}
         */
        () => {
            this.setHeaderPosition();
        }));
        this.rightFixedColumnWidth = this.getRightFixedColWidth(this.ps);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.setHeaderPosition();
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // if (changes.scrollbarMode && !changes.scrollbarMode.isFirstChange()) {
        //     this.rightFixedColumnWidth = this.getRightFixedColWidth(this.ps);
        //     this.cd.detectChanges();
        // }
        if (changes.columnsGroup && !changes.columnsGroup.isFirstChange()) {
            this.rightFixedColumnWidth = this.getRightFixedColWidth(this.ps);
            this.cd.detectChanges();
        }
    }
    /**
     * @private
     * @param {?=} ps
     * @return {?}
     */
    getRightFixedColWidth(ps = null) {
        if (!this.columnsGroup) {
            return 0;
        }
        /** @type {?} */
        let w = this.columnsGroup.rightFixedWidth;
        if (!ps) {
            ps = this.dg.scrollInstance.instance;
        }
        if (ps && ps.scrollbarYActive && this.scrollbarMode === 'allways') {
            return w += this.showShadowCls ? 18 : 0;
        }
        return w;
    }
    /**
     * @private
     * @return {?}
     */
    setHeaderPosition() {
        /** @type {?} */
        let top = 0;
        if ((this.dg.enableFilterRow || this.dg.enableSmartFilter) && this.dg.showFilterBar) {
            top += this.dg.filterBarHeight;
        }
        if (this.dg.showRowGroupPanel) {
            top += this.dg.rowGroupPanelHeight;
        }
        this.top = top;
        this.render2.setStyle(this.el.nativeElement, 'top', `${top}px`);
    }
    /**
     * @param {?} fixedLeftWidth
     * @return {?}
     */
    isShowShadow(fixedLeftWidth) {
        /** @type {?} */
        const dgContainerWidth = this.dg.dgContainer.nativeElement.offsetWidth;
        return dgContainerWidth < this.dg.colGroup.totalWidth;
    }
    /**
     * @param {?} left
     * @param {?} right
     * @param {?} col
     * @param {?=} isdatafield
     * @return {?}
     */
    isColspan(left, right, col, isdatafield = false) {
        if (!left && !right) {
            if (isdatafield) {
                return !col.colspan && (!col.fixed || col.fixed === 'none');
            }
            else {
                return col.colspan && (!col.fixed || col.fixed === 'none');
            }
        }
        else if (left) {
            if (isdatafield) {
                return !col.colspan && col.fixed && col.fixed === 'left';
            }
            else {
                return col.colspan && col.fixed && col.fixed === 'left';
            }
        }
        else if (right) {
            if (isdatafield) {
                return !col.colspan && col.fixed && col.fixed === 'right';
            }
            else {
                return col.colspan && col.fixed && col.fixed === 'right';
            }
        }
    }
    /**
     * @param {?} isShow
     * @param {?} scrollLeft
     * @return {?}
     */
    setFixedColumnPosition(isShow, scrollLeft) {
        this.showShadowCls = isShow;
        /** @type {?} */
        const method = isShow ? 'addClass' : 'removeClass';
        this.render2[method](this.fixedRight.nativeElement, FIXED_RIGHT_SHADOW_CLS);
        /** @type {?} */
        const realWidth = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth + this.rightFixedColumnWidth;
        /** @type {?} */
        const gridWidth = this.dg.width;
        /** @type {?} */
        let l = this.dg.width - (this.dg.showBorder ? 2 : 0) - this.rightFixedColumnWidth;
        if (gridWidth > realWidth) {
            l = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth;
        }
        this.render2.setStyle(this.fixedRight.nativeElement, 'left', l + 'px');
    }
    /**
     * @param {?} e
     * @param {?} rntd
     * @return {?}
     */
    onRowNumerColumnDblClick(e, rntd) {
        /** @type {?} */
        let maxRowNumber = this.dg.getRows().length;
        if (this.dg.pagination) {
            /** @type {?} */
            const pageSize = this.dg.pageSize;
            /** @type {?} */
            const pageIndex = this.dg.pageIndex;
            maxRowNumber = pageSize * pageIndex + pageSize;
        }
        this.dg.longTextArea.nativeElement.innerHTML = maxRowNumber;
        /** @type {?} */
        const w1 = this.dg.longTextArea.nativeElement.offsetWidth;
        /** @type {?} */
        const currentWidth = rntd.offsetWidth;
        if (w1 > currentWidth) {
            this.dg.lineNumberWidth = w1 + 10;
            this.dfs.updateProperty('lineNumberWidth', this.dg.lineNumberWidth);
            this.dfs.resizeColumns();
        }
    }
    /**
     * @param {?} e
     * @param {?} col
     * @return {?}
     */
    onSortColumnClick(e, col) {
        if (this.disableSort) {
            return;
        }
        if (!col.sortable) {
            return;
        }
        // 结束编辑
        this.dg.cancelEdit(null);
        /** @type {?} */
        const sortName = this.dg.sortName;
        /** @type {?} */
        const sortOrder = this.dg.sortOrder;
        /** @type {?} */
        let sortFields = [];
        /** @type {?} */
        let sortOrders = [];
        if (sortName) {
            sortFields = sortName.split(',');
            sortOrders = sortOrder.split(',');
        }
        /** @type {?} */
        const colOrder = col.order || 'asc';
        /** @type {?} */
        let newOrder = colOrder;
        /** @type {?} */
        const i = sortFields.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => n === col.field));
        if (i >= 0) {
            /** @type {?} */
            const _order = sortOrders[i] === 'asc' ? 'desc' : 'asc';
            newOrder = _order;
            // if (this.dg.multiSort && newOrder === 'asc') {
            if (newOrder === 'asc') {
                newOrder = undefined;
                sortFields.splice(i, 1);
                sortOrders.splice(i, 1);
            }
            else {
                sortOrders[i] = _order;
            }
        }
        else {
            if (this.dg.multiSort) {
                sortFields.push(col.field);
                sortOrders.push(colOrder);
            }
            else {
                sortFields = [col.field];
                sortOrders = [colOrder];
            }
        }
        col.order = newOrder;
        this.dg.sortName = sortFields.join(',');
        this.dg.sortOrder = sortOrders.join(',');
        this.dfs.setSortInfo(this.dg.sortName, this.dg.sortOrder);
        this.dg.beforeSortColumn(this.dg.sortName, this.dg.sortOrder, this.dg).subscribe((/**
         * @return {?}
         */
        () => {
            this.dg.onColumnSorted();
        }));
    }
}
DatagridHeaderComponent.decorators = [
    { type: Component, args: [{
                selector: 'datagrid-header',
                template: "<!--\r\n * @Author: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:53\r\n * @LastEditors: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @LastEditTime: 2019-11-05 08:53:26\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n -->\r\n <!-- [style.maxWidth.px]=\"col.width - 44\"   =>  style=\"width: 100%\"    -->\r\n<ng-template #filterAndSort let-col>\r\n    <ng-container *ngIf=\"col.filter\">\r\n        <span style=\"width: 100%\" class=\"f-datagrid-header-cell-title\">\r\n            <span class=\"text-danger\" *ngIf=\" col.validators | showStar \">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <ng-container *ngIf=\"col.sortable\">\r\n            <span class=\"f-datagrid-sort\" [class.f-datagrid-filter-sort-asc]=\"col.order === 'asc'\"\r\n                [class.f-datagrid-filter-sort-desc]=\"col.order === 'desc'\"\r\n                [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\" *ngIf=\"col.order\"\r\n                datagrid-smart-filter  [disabled]=\"disableSort\" [column]=\"col\"> </span>\r\n            <span class=\"f-datagrid-sort f-datagrid-filter-sort\" [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\"\r\n                datagrid-smart-filter [disabled]=\"disableSort\" [column]=\"col\" *ngIf=\"!col.order\"></span>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!col.sortable\">\r\n            <span class=\"f-datagrid-sort f-datagrid-filter\" datagrid-smart-filter  [disabled]=\"disableSort\"  [column]=\"col\"></span>\r\n        </ng-container>\r\n    </ng-container>\r\n    <ng-container *ngIf=\"!col.filter\" [ngTemplateOutlet]=\"column_title\" [ngTemplateOutletContext]=\"{$implicit: col}\">\r\n    </ng-container>\r\n\r\n</ng-template>\r\n\r\n\r\n<ng-template #column_title let-col>\r\n    <ng-container *ngIf=\"!col.sortable\">\r\n        <span [style.width.px]=\"col.width - 20\" class=\"f-datagrid-header-cell-title\" *ngIf=\"col.field !== dg.ControlPanelFeild\">\r\n            <span class=\"text-danger\" *ngIf=\" col.validators | showStar \">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <span *ngIf=\"col.field === dg.ControlPanelFeild\" class=\"f-datagrid-header-cell-title\"\r\n            style=\"position: absolute; left: 3px; top: 0; cursor: pointer;\"\r\n            (click)=\"dg.showControlPanel($event)\">\r\n            <span class=\"f-icon f-icon-home-setup\"></span>\r\n        </span>\r\n    </ng-container>\r\n    <ng-container *ngIf=\"col.sortable\">\r\n        <span style=\"width: 100%\"  class=\"f-datagrid-header-cell-title\">\r\n            <span class=\"text-danger\" *ngIf=\" col.validators | showStar \">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <span class=\"f-datagrid-sort\" [class.f-datagrid-sort-asc]=\"col.order === 'asc'\"\r\n            [class.f-datagrid-sort-desc]=\"col.order === 'desc'\"\r\n            [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\"\r\n            (click)=\"onSortColumnClick($event, col)\" *ngIf=\"col.order\"> </span>\r\n        <span class=\"f-datagrid-sort\" [style.cursor]=\"disableSort ? 'not-allowed': 'pointer'\"\r\n            (click)=\"onSortColumnClick($event, col)\" *ngIf=\"!col.order\"></span>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n\r\n\r\n<ng-template #column_template let-col let-left=\"left\" let-right=\"right\">\r\n    <ng-container *ngIf=\"isColspan(left, right, col, false) \">\r\n        <td [resize-column]=\"col\" class=\"f-datagrid-header-cell f-datagrid-header-cell-group\" [attr.align]=\"col.halign\"\r\n            [attr.colspan]=\"col.colspan\" [attr.title]=\"col.title\">\r\n            <div class=\"f-datagrid-header-cell-content\" [header-style]=\"col\">\r\n                {{ col.title }}\r\n            </div>\r\n        </td>\r\n    </ng-container>\r\n    <ng-container *ngIf=\"isColspan(left, right, col, true)\">\r\n        <td [resize-column]=\"col\" class=\"f-datagrid-header-cell\" [attr.align]=\"col.halign\" [attr.field]=\"col.field\"\r\n            [attr.rowspan]=\"col.rowspan\" [attr.title]=\"col.title\"\r\n            *ngIf=\"dg.columnIsVisible(col)\"\r\n            [style.display]=\"dg.columnIsVisible(col) ? '': 'none'\"\r\n            [class.f-datagrid-header-cell-sort]=\"col.sortable\"\r\n            [class.smooth-dnd-draggable-wrapper]=\"enableDragColumn && col.field !== dg.ControlPanelFeild \">\r\n            <div class=\"f-datagrid-header-cell-content\" [header-style]=\"col\" [style.width.px]=\"col.width\">\r\n                <span class=\"drag-column-bar f-icon f-icon-more-vertical\" *ngIf=\"col.field !== dg.ControlPanelFeild && enableDragColumn && !dg.editable\"></span>\r\n                <ng-container *ngIf=\"col.headerTemplate\" [ngTemplateOutlet]=\"col.headerTemplate\" [ngTemplateOutletContext]=\"{$implicit: col}\">\r\n                </ng-container>\r\n                <ng-container *ngIf=\"!col.headerTemplate\" [ngTemplateOutlet]=\" !dg.enableSmartFilter ? column_title : filterAndSort \" \r\n                [ngTemplateOutletContext]=\"{$implicit: col}\">\r\n                </ng-container>\r\n            </div>\r\n        </td>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #header_template_inner let-columns let-left=\"left\" let-right=\"right\" let-groupCols=\"groupCols\">\r\n    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"height: 100%\">\r\n        <colgroup>\r\n            <col width=\"36px\" *ngIf=\"dg.showCheckbox && left\">\r\n            <col [width]=\"dg?.lineNumberWidth + 'px'\" *ngIf=\"dg.showLineNumber && left\">\r\n            <ng-container *ngFor=\"let col of groupCols\">\r\n                <col [width]=\"col.width + 'px'\" *ngIf=\"col.width && col.field\">\r\n            </ng-container>\r\n        </colgroup>\r\n        <thead [class.header-wrap]=\"wrapHeader\">\r\n            <tr class=\"f-datagrid-header-row\" *ngFor=\"let cols of columns; index as colsIdx; first as isFirst\"\r\n                [drag-column]=\"enableDragColumn\" [groupName]=\"left?'left': right ? 'right': 'center'\">\r\n                <!-- \u590D\u9009\u6846 -->\r\n                <td *ngIf=\"dg.showCheckbox && isFirst && left\" #chktd\r\n                    class=\"f-datagrid-header-cell f-datagrid-header-checkbox\" \r\n                    [attr.rowspan]=\"rowSpan\" [style.height.px]=\"height\">\r\n                    <div class=\"f-datagrid-header-cell-content\" style=\"width: 36px; text-align: center;overflow:hidden; \" [style.maxHeight.px]=\"height\">\r\n                        <datagrid-header-checkbox #chkAll *ngIf=\"dg.showAllCheckbox && dg.multiSelect\" ></datagrid-header-checkbox>\r\n                    </div>\r\n                </td>\r\n                <!-- \u884C\u53F7 -->\r\n                <td *ngIf=\"dg.showLineNumber && isFirst && left\" #rntd\r\n                    class=\"f-datagrid-header-cell f-datagrid-cell-rownumber\" [attr.rowspan]=\"rowSpan\"\r\n                    [style.height.px]=\"height\"\r\n                    (dblclick)=\"onRowNumerColumnDblClick($event, rntd)\">\r\n                    <div class=\"f-datagrid-header-cell-content\" style=\"padding: 0px;\"  [style.width.px]=\"dg?.lineNumberWidth\">\r\n                        {{ 'datagrid.lineNumberTitle' | locale: dg.lineNumberTitle }}\r\n                    </div>\r\n                </td>\r\n                <ng-container *ngFor=\"let col of cols; last as isLast\">\r\n                    <ng-container\r\n                        *ngTemplateOutlet=\"column_template; context: {$implicit: col, left: left, right: right}\">\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngIf=\"enableFilterRow\" [style.height.px]=\"dg.filterRowHeight\" class=\"f-datagrid-header-row f-datagrid-filter-row\">\r\n                <ng-container filter-row-creator [left]=\"left\" [right]=\"right\"></ng-container>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</ng-template>\r\n\r\n<div class=\"f-datagrid-header\" style=\"width: 100%;\" [style.min-height.px]=\"height\" #header>\r\n    <!--\u5DE6\u4FA7\u56FA\u5B9A\u5217-->\r\n    <div #fixedLeft class=\"f-datagrid-header-fixed-left\"\r\n        *ngIf=\"columnsGroup?.leftFixed && columnsGroup?.leftFixed.length  || dg?.showLineNumber || dg?.showCheckbox \"\r\n        [style.width.px]=\"columnsGroup?.leftFixedWidth\"\r\n        [style.height.px]=\"height\">\r\n        <ng-container *ngTemplateOutlet=\"header_template_inner; context: { $implicit: columns, left: true, right: false,\r\n            groupCols:  columnsGroup?.leftFixed}\">\r\n        </ng-container>\r\n    </div>\r\n\r\n    <!--\u6B63\u5E38\u5217-->\r\n    <div #headerContainer class=\"f-datagrid-header-center\" \r\n        [style.left.px]=\"columnsGroup?.leftFixedWidth\"\r\n        [style.width.px]=\"columnsGroup?.normalWidth\"\r\n        style=\"position: absolute;height: 100%\">\r\n        <ng-container *ngTemplateOutlet=\"header_template_inner; context: {$implicit: columns, left: false, right: false,\r\n            groupCols:  columnsGroup?.normalColumns}\">\r\n        </ng-container>\r\n    </div>\r\n    <!--\u53F3\u4FA7\u56FA\u5B9A\u5217-->\r\n    <div #fixedRight class=\"f-datagrid-header-fixed-right\"\r\n        *ngIf=\"columnsGroup?.rightFixed && columnsGroup?.rightFixed.length\"\r\n        [style.width.px]=\" dg.showBorder?  rightFixedColumnWidth : rightFixedColumnWidth + 1\"\r\n        [style.height.px]=\"height\" style=\"border: 0;\">\r\n        <ng-container *ngTemplateOutlet=\"header_template_inner; context: {$implicit: columns, left: false, right: true,\r\n            groupCols: columnsGroup?.rightFixed}\">\r\n        </ng-container>\r\n    </div>\r\n    <div class=\"filter-row-disabled\"\r\n        style=\"position: absolute;background: rgb(255, 255, 255);width: 100%;z-index: 9;height: 40px; bottom:0;opacity: 0;\"\r\n        [style.left.px]=\"dg.showAllCheckbox ? 36 : 0\" *ngIf=\"showOverlay && dg.enableFilterRow\">\r\n    </div>\r\n</div>",
                encapsulation: ViewEncapsulation.None,
                exportAs: 'dgHeader'
            }] }
];
/** @nocollapse */
DatagridHeaderComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: Injector },
    { type: DatagridComponent, decorators: [{ type: Optional }] },
    { type: NgZone }
];
DatagridHeaderComponent.propDecorators = {
    height: [{ type: Input }],
    columns: [{ type: Input }],
    columnsGroup: [{ type: Input }],
    enableDragColumn: [{ type: Input }],
    wrapHeader: [{ type: Input }],
    enableFilterRow: [{ type: Input }],
    scrollbarMode: [{ type: Input }],
    header: [{ type: ViewChild, args: ['header',] }],
    headerColumnsTable: [{ type: ViewChild, args: ['headerContainer',] }],
    fixedLeft: [{ type: ViewChild, args: ['fixedLeft',] }],
    chkAll: [{ type: ViewChild, args: ['chkAll',] }],
    fr: [{ type: ViewChild, args: ['fixedRight',] }]
};
if (false) {
    /** @type {?} */
    DatagridHeaderComponent.prototype.height;
    /** @type {?} */
    DatagridHeaderComponent.prototype.columns;
    /** @type {?} */
    DatagridHeaderComponent.prototype.columnsGroup;
    /** @type {?} */
    DatagridHeaderComponent.prototype.enableDragColumn;
    /** @type {?} */
    DatagridHeaderComponent.prototype.wrapHeader;
    /** @type {?} */
    DatagridHeaderComponent.prototype.enableFilterRow;
    /** @type {?} */
    DatagridHeaderComponent.prototype.scrollbarMode;
    /** @type {?} */
    DatagridHeaderComponent.prototype.header;
    /** @type {?} */
    DatagridHeaderComponent.prototype.headerColumnsTable;
    /** @type {?} */
    DatagridHeaderComponent.prototype.fixedLeft;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype._chkall;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.fixedRight;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.el;
    /** @type {?} */
    DatagridHeaderComponent.prototype.rightFixedColumnWidth;
    /** @type {?} */
    DatagridHeaderComponent.prototype.normalColumnWidth;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.cd;
    /** @type {?} */
    DatagridHeaderComponent.prototype.showOverlay;
    /** @type {?} */
    DatagridHeaderComponent.prototype.disableSort;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.scrollX;
    /** @type {?} */
    DatagridHeaderComponent.prototype.showShadowCls;
    /** @type {?} */
    DatagridHeaderComponent.prototype.top;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.ps;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.render2;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.injector;
    /** @type {?} */
    DatagridHeaderComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridHeaderComponent.prototype.ngZone;
}
export class FilterRowCreateDirective {
    /**
     * @param {?} vc
     * @param {?} injector
     * @param {?} dg
     * @param {?} ngZone
     */
    constructor(vc, injector, dg, ngZone) {
        this.vc = vc;
        this.injector = injector;
        this.dg = dg;
        this.ngZone = ngZone;
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.cfr = this.injector.get(ComponentFactoryResolver);
        this.cd = this.injector.get(ChangeDetectorRef);
        this.dfrs = this.dg.clientFilterService;
        this.filterRowType = this.injector.get(GRID_FILTER_ROW, null);
        this.dgs.clearFilter.subscribe((/**
         * @return {?}
         */
        () => {
            if (this.filterRowRef) {
                this.filterRowRef.instance.clearFilterValue(false);
            }
        }));
        this.dgs.columnsChanged.subscribe((/**
         * @return {?}
         */
        () => {
            this.createFilterRow(true);
        }));
        if (this.dfrs) {
            this.dfrs.removeField.subscribe((/**
             * @param {?} f
             * @return {?}
             */
            (f) => {
                if (this.filterRowRef && f) {
                    /** @type {?} */
                    let flag = false;
                    /** @type {?} */
                    let _cols = [];
                    if (this.left) {
                        _cols = this.dg.colGroup.leftFixed || [];
                    }
                    else if (this.right) {
                        _cols = this.dg.colGroup.rightFixed || [];
                    }
                    else {
                        _cols = this.dg.colGroup.normalColumns || [];
                    }
                    flag = !!_cols.find((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.field === f));
                    if (flag) {
                        this.filterRowRef.instance.removeField(f);
                    }
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.createFilterRow(true);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // if (changes.columnsGroup && !changes.columnsGroup.isFirstChange()) {
        //     this.createFilterRow();
        // }
    }
    /**
     * 过滤行
     * @param {?=} rebuild
     * @return {?}
     */
    createFilterRow(rebuild = false) {
        if (rebuild && this.filterRowRef) {
            this.filterRowRef.destroy();
            this.filterRowRef = null;
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            this._createFilterRow();
            if (rebuild) {
                this.cd.detectChanges();
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    _createFilterRow() {
        if (this.dg.enableFilterRow) {
            if (!this.filterRowType) {
                return;
            }
            /** @type {?} */
            let columnsData = this.dg.colGroup.normalColumns;
            if (this.left) {
                columnsData = this.dg.colGroup.leftFixed;
            }
            else if (this.right) {
                columnsData = this.dg.colGroup.rightFixed;
            }
            if (!this.filterRowRef && this.vc) {
                /** @type {?} */
                const cf = this.cfr.resolveComponentFactory(this.filterRowType);
                this.filterRowRef = this.vc.createComponent(cf);
                this.filterRowRef.instance.columns = columnsData;
                this.filterRowRef.instance.gridInstance = this.dg;
                this.filterRowRef.instance.conditionChange.subscribe((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    /** @type {?} */
                    const conditions = n || {};
                    this.dgs.onFilterChanged.emit(conditions);
                }));
            }
        }
    }
}
FilterRowCreateDirective.decorators = [
    { type: Directive, args: [{
                selector: '[filter-row-creator]'
            },] }
];
/** @nocollapse */
FilterRowCreateDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: Injector },
    { type: DatagridComponent },
    { type: NgZone }
];
FilterRowCreateDirective.propDecorators = {
    left: [{ type: Input }],
    right: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FilterRowCreateDirective.prototype.left;
    /** @type {?} */
    FilterRowCreateDirective.prototype.right;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.filterRowType;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.filterRowRef;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.vc;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.injector;
    /** @type {?} */
    FilterRowCreateDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    FilterRowCreateDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtaGVhZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9oZWFkZXIvZGF0YWdyaWQtaGVhZGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFVQSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsZ0JBQWdCLEVBQXdELE1BQU0sZUFBZSxDQUFDO0FBRWpJLE9BQU8sRUFDSCxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUMzQyxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQzdGLE1BQU0sZUFBZSxDQUFDO0FBSXZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNsRSxPQUFPLEVBQUUsZUFBZSxFQUFFLHFCQUFxQixFQUFFLDJCQUEyQixFQUFFLHNCQUFzQixFQUFFLHlCQUF5QixFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9LLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRTdELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBVy9FLE1BQU0sT0FBTyx1QkFBdUI7Ozs7Ozs7SUFtRGhDLFlBQ1ksT0FBa0IsRUFBVSxRQUFrQixFQUNuQyxFQUFxQixFQUFVLE1BQWM7UUFEeEQsWUFBTyxHQUFQLE9BQU8sQ0FBVztRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbkMsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBcEQzRCxXQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ1osWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUViLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUN6QixlQUFV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QUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDaEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQztnQkFDakQsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQ2xELElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxTQUFTOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFOzswQkFDL0MsVUFBVSxHQUFHLENBQUMsSUFBSSxFQUFFO29CQUMxQixJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQzlDLENBQUMsRUFBQyxDQUFDO2FBQ047U0FDSjtJQUNMLENBQUM7OztZQTFHSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHNCQUFzQjthQUNuQzs7OztZQXJWa0MsZ0JBQWdCO1lBSWIsUUFBUTtZQU9yQyxpQkFBaUI7WUFQOEQsTUFBTTs7O21CQW1WekYsS0FBSztvQkFDTCxLQUFLOzs7O0lBRE4sd0NBQXVCOztJQUN2Qix5Q0FBd0I7Ozs7O0lBRXhCLHVDQUE2Qjs7Ozs7SUFDN0IsdUNBQW1DOzs7OztJQUNuQyx1Q0FBc0M7Ozs7O0lBQ3RDLHdDQUFvQzs7Ozs7SUFDcEMsaURBQTJCOzs7OztJQUMzQixnREFBd0M7Ozs7O0lBQ3hDLHNDQUE4Qjs7Ozs7SUFDbEIsc0NBQTRCOzs7OztJQUFFLDRDQUEwQjs7SUFDaEUsc0NBQTRCOzs7OztJQUFFLDBDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFF1ZXJ5TGlzdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG4vKlxyXG4qIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0Mzo1M1xyXG4qIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4qIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMjAgMjA6MTQ6MTFcclxuKiBAUVE6IDEwNTU4MTgyMzlcclxuKiBAVmVyc2lvbjogdjAuMC4xXHJcbiovXHJcblxyXG5pbXBvcnQgeyBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIFZpZXdDb250YWluZXJSZWYsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgQ29tcG9uZW50UmVmLCBWaWV3Q2hpbGRyZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFJlbmRlcmVyMiwgVmlld0NoaWxkLCBFbGVtZW50UmVmLFxyXG4gICAgQWZ0ZXJWaWV3SW5pdCwgVmlld0VuY2Fwc3VsYXRpb24sIEluamVjdG9yLCBDaGFuZ2VEZXRlY3RvclJlZiwgRGlyZWN0aXZlLCBPcHRpb25hbCwgTmdab25lXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBEYXRhQ29sdW1uIH0gZnJvbSAnLi8uLi8uLi90eXBlcy9kYXRhLWNvbHVtbic7XHJcbmltcG9ydCB7IENvbHVtbkdyb3VwIH0gZnJvbSAnLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU0NST0xMX1hfQUNUSU9OLCBGSVhFRF9MRUZUX1NIQURPV19DTFMsIFNDUk9MTF9YX1JFQUNIX1NUQVJUX0FDVElPTiwgRklYRURfUklHSFRfU0hBRE9XX0NMUywgU0NST0xMX1hfUkVBQ0hfRU5EX0FDVElPTiwgR1JJRF9GSUxURVJfUk9XIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkSGVhZGVyQ2hlY2tib3hDb21wb25lbnQgfSBmcm9tICcuLi9jaGVja2JveC9kYXRhZ3JpZC1oZWFkZXItY2hlY2tib3guY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcclxuaW1wb3J0IHsgRGF0YWdyaWRGaWx0ZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmlsdGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBvZiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2RhdGFncmlkLWhlYWRlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vaGVhZGVyLmNvbXBvbmVudC5odG1sJyxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgICBleHBvcnRBczogJ2RnSGVhZGVyJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRIZWFkZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcyB7XHJcbiAgICBASW5wdXQoKSBoZWlnaHQgPSAzNTtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnMgPSBbXTtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnNHcm91cDogQ29sdW1uR3JvdXA7XHJcbiAgICBASW5wdXQoKSBlbmFibGVEcmFnQ29sdW1uID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSB3cmFwSGVhZGVyID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBlbmFibGVGaWx0ZXJSb3cgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBzY3JvbGxiYXJNb2RlID0gJ2F1dG8nO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2hlYWRlcicpIGhlYWRlcjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2hlYWRlckNvbnRhaW5lcicpIGhlYWRlckNvbHVtbnNUYWJsZTogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpeGVkTGVmdCcpIGZpeGVkTGVmdDogRWxlbWVudFJlZjtcclxuXHJcbiAgICBwcml2YXRlIF9jaGthbGw6IERhdGFncmlkSGVhZGVyQ2hlY2tib3hDb21wb25lbnQ7XHJcbiAgICBAVmlld0NoaWxkKCdjaGtBbGwnKSBzZXQgY2hrQWxsKHYpIHtcclxuICAgICAgICB0aGlzLl9jaGthbGwgPSB2O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZml4ZWRSaWdodDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpeGVkUmlnaHQnKSBzZXQgZnIodmFsKSB7XHJcbiAgICAgICAgaWYgKHZhbCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpeGVkUmlnaHQgPSB2YWw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZGdzOiBEYXRhZ3JpZFNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBybzogUmVzaXplT2JzZXJ2ZXIgfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI7XHJcbiAgICBwcml2YXRlIGRmcnM6IERhdGFncmlkRmlsdGVyU2VydmljZTtcclxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWY7XHJcbiAgICByaWdodEZpeGVkQ29sdW1uV2lkdGggPSAwO1xyXG4gICAgbm9ybWFsQ29sdW1uV2lkdGggPSAwO1xyXG5cclxuICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmO1xyXG4gICAgc2hvd092ZXJsYXkgPSBmYWxzZTtcclxuICAgIGRpc2FibGVTb3J0ID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIHNjcm9sbFggPSAwO1xyXG4gICAgc2hvd1NoYWRvd0NscyA9IGZhbHNlO1xyXG5cclxuICAgIHRvcCA9IDA7XHJcblxyXG4gICAgLy8g6KGM5Y+3IOOAgSDlpI3pgInmoYbvvIzlnKjlpJrooajlpLTkuIvnmoTlkIjlubbooYzmlbBcclxuICAgIGdldCByb3dTcGFuKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbHVtbnMubGVuZ3RoICsgKHRoaXMuZGcuZW5hYmxlRmlsdGVyUm93ID8gMSA6IDApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIHBzO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyMjogUmVuZGVyZXIyLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBAT3B0aW9uYWwoKSBwdWJsaWMgZGc6IERhdGFncmlkQ29tcG9uZW50LCBwcml2YXRlIG5nWm9uZTogTmdab25lKSB7XHJcbiAgICAgICAgdGhpcy5kZnMgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZEZhY2FkZVNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuZGdzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmNmciA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcik7XHJcbiAgICAgICAgdGhpcy5jZCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKTtcclxuICAgICAgICB0aGlzLmVsID0gdGhpcy5pbmplY3Rvci5nZXQoRWxlbWVudFJlZik7XHJcbiAgICAgICAgdGhpcy5kZnJzID0gdGhpcy5kZy5jbGllbnRGaWx0ZXJTZXJ2aWNlO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5kZ3Muc2NvcmxsJC5zdWJzY3JpYmUoKGQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZC50eXBlID09PSBTQ1JPTExfWF9BQ1RJT04gfHwgZC50eXBlID09PSBTQ1JPTExfWF9SRUFDSF9FTkRfQUNUSU9OIHx8IGQudHlwZSA9PT0gU0NST0xMX1hfUkVBQ0hfU1RBUlRfQUNUSU9OKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxYID0gZC54O1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyMi5zZXRTdHlsZSh0aGlzLmhlYWRlckNvbHVtbnNUYWJsZS5uYXRpdmVFbGVtZW50LCAndHJhbnNmb3JtJywgYHRyYW5zbGF0ZTNkKC0ke2QueH1weCwgMHB4LCAwcHgpYCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpeGVkTGVmdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC54KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcjIuYWRkQ2xhc3ModGhpcy5maXhlZExlZnQubmF0aXZlRWxlbWVudCwgRklYRURfTEVGVF9TSEFET1dfQ0xTKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyMi5yZW1vdmVDbGFzcyh0aGlzLmZpeGVkTGVmdC5uYXRpdmVFbGVtZW50LCBGSVhFRF9MRUZUX1NIQURPV19DTFMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZC50eXBlID09PSBTQ1JPTExfWF9SRUFDSF9TVEFSVF9BQ1RJT04pIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpeGVkTGVmdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyMi5yZW1vdmVDbGFzcyh0aGlzLmZpeGVkTGVmdC5uYXRpdmVFbGVtZW50LCBGSVhFRF9MRUZUX1NIQURPV19DTFMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5zaG93Rml4ZWRTaGFkb3cuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZml4ZWRSaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGaXhlZENvbHVtblBvc2l0aW9uKGUuc2hvd1JpZ2h0U2hhZG93LCBlLngpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLmRpc2FibGVIZWFkZXIuc3Vic2NyaWJlKChmbGFnKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd092ZXJsYXkgPSBmbGFnO1xyXG4gICAgICAgICAgICB0aGlzLmRpc2FibGVTb3J0ID0gZmxhZztcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kZ3MuY2hlY2tlZFJvd3NUb3RhbENoYW5nZWQkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9jaGthbGwpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrZWRzQ291bnQgPSB0aGlzLmRmcy5nZXRDdXJyZW50UGFnZUNoZWNrZWRzKCkubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXNDaGVja0FsbCA9IHRoaXMuZGZzLmlzQ2hlY2tBbGwoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzSW5kZXRlcm1pbmF0ZSA9IGlzQ2hlY2tBbGwgfHwgIWNoZWNrZWRzQ291bnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGthbGwuY2hrLm5hdGl2ZUVsZW1lbnQuaW5kZXRlcm1pbmF0ZSA9ICFpc0luZGV0ZXJtaW5hdGU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfY2hlY2tlZCA9IGlzQ2hlY2tBbGwgJiYgY2hlY2tlZHNDb3VudCA+IDA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGthbGwudXBkYXRlU3RhdHVzKF9jaGVja2VkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmRncy51bmNoZWNrQWxsLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNob3dBbGxDaGVja2JveCAmJiB0aGlzLl9jaGthbGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Noa2FsbC5jaGsubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGthbGwuY2hrLm5hdGl2ZUVsZW1lbnQuY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLmNoZWNrQWxsLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9jaGthbGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Noa2FsbC5jaGsubmF0aXZlRWxlbWVudC5jaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5zY3JvbGxiYXJVcGRhdGUuc3Vic2NyaWJlKChwczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucHMgPSBwcy5zY3JvbGxiYXJSZWY7XHJcbiAgICAgICAgICAgIHRoaXMucmlnaHRGaXhlZENvbHVtbldpZHRoID0gdGhpcy5nZXRSaWdodEZpeGVkQ29sV2lkdGgodGhpcy5wcyk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZpeGVkUmlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml4ZWRDb2x1bW5Qb3NpdGlvbih0aGlzLnNob3dTaGFkb3dDbHMsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5kZ3Muc2hvd0dyaWRIZWFkZXIuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRIZWFkZXJQb3NpdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5zbWFydEZpbHRlckJhckV4cGFuZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldEhlYWRlclBvc2l0aW9uKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMucmlnaHRGaXhlZENvbHVtbldpZHRoID0gdGhpcy5nZXRSaWdodEZpeGVkQ29sV2lkdGgodGhpcy5wcyk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldEhlYWRlclBvc2l0aW9uKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIC8vIGlmIChjaGFuZ2VzLnNjcm9sbGJhck1vZGUgJiYgIWNoYW5nZXMuc2Nyb2xsYmFyTW9kZS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGggPSB0aGlzLmdldFJpZ2h0Rml4ZWRDb2xXaWR0aCh0aGlzLnBzKTtcclxuICAgICAgICAvLyAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBpZiAoY2hhbmdlcy5jb2x1bW5zR3JvdXAgJiYgIWNoYW5nZXMuY29sdW1uc0dyb3VwLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLnJpZ2h0Rml4ZWRDb2x1bW5XaWR0aCA9IHRoaXMuZ2V0UmlnaHRGaXhlZENvbFdpZHRoKHRoaXMucHMpO1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSaWdodEZpeGVkQ29sV2lkdGgocHMgPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbHVtbnNHcm91cCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBsZXQgdyA9IHRoaXMuY29sdW1uc0dyb3VwLnJpZ2h0Rml4ZWRXaWR0aDtcclxuXHJcbiAgICAgICAgaWYgKCFwcykge1xyXG4gICAgICAgICAgICBwcyA9IHRoaXMuZGcuc2Nyb2xsSW5zdGFuY2UuaW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocHMgJiYgcHMuc2Nyb2xsYmFyWUFjdGl2ZSAmJiB0aGlzLnNjcm9sbGJhck1vZGUgPT09ICdhbGx3YXlzJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdyArPSB0aGlzLnNob3dTaGFkb3dDbHMgPyAxOCA6IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB3O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0SGVhZGVyUG9zaXRpb24oKSB7XHJcbiAgICAgICAgbGV0IHRvcCA9IDA7XHJcbiAgICAgICAgaWYgKCh0aGlzLmRnLmVuYWJsZUZpbHRlclJvdyB8fCB0aGlzLmRnLmVuYWJsZVNtYXJ0RmlsdGVyKSAmJiB0aGlzLmRnLnNob3dGaWx0ZXJCYXIpIHtcclxuICAgICAgICAgICAgdG9wICs9IHRoaXMuZGcuZmlsdGVyQmFySGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2hvd1Jvd0dyb3VwUGFuZWwpIHtcclxuICAgICAgICAgICAgdG9wICs9IHRoaXMuZGcucm93R3JvdXBQYW5lbEhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudG9wID0gdG9wO1xyXG4gICAgICAgIHRoaXMucmVuZGVyMi5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICd0b3AnLCBgJHt0b3B9cHhgKTtcclxuICAgIH1cclxuXHJcbiAgICBpc1Nob3dTaGFkb3coZml4ZWRMZWZ0V2lkdGgpIHtcclxuICAgICAgICBjb25zdCBkZ0NvbnRhaW5lcldpZHRoID0gdGhpcy5kZy5kZ0NvbnRhaW5lci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xyXG4gICAgICAgIHJldHVybiBkZ0NvbnRhaW5lcldpZHRoIDwgdGhpcy5kZy5jb2xHcm91cC50b3RhbFdpZHRoO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpc0NvbHNwYW4obGVmdCwgcmlnaHQsIGNvbCwgaXNkYXRhZmllbGQgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghbGVmdCAmJiAhcmlnaHQpIHtcclxuICAgICAgICAgICAgaWYgKGlzZGF0YWZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIWNvbC5jb2xzcGFuICYmICghY29sLmZpeGVkIHx8IGNvbC5maXhlZCA9PT0gJ25vbmUnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2wuY29sc3BhbiAmJiAoIWNvbC5maXhlZCB8fCBjb2wuZml4ZWQgPT09ICdub25lJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGxlZnQpIHtcclxuICAgICAgICAgICAgaWYgKGlzZGF0YWZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIWNvbC5jb2xzcGFuICYmIGNvbC5maXhlZCAmJiBjb2wuZml4ZWQgPT09ICdsZWZ0JztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2wuY29sc3BhbiAmJiBjb2wuZml4ZWQgJiYgY29sLmZpeGVkID09PSAnbGVmdCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHJpZ2h0KSB7XHJcbiAgICAgICAgICAgIGlmIChpc2RhdGFmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFjb2wuY29sc3BhbiAmJiBjb2wuZml4ZWQgJiYgY29sLmZpeGVkID09PSAncmlnaHQnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbC5jb2xzcGFuICYmIGNvbC5maXhlZCAmJiBjb2wuZml4ZWQgPT09ICdyaWdodCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Rml4ZWRDb2x1bW5Qb3NpdGlvbihpc1Nob3csIHNjcm9sbExlZnQpIHtcclxuICAgICAgICB0aGlzLnNob3dTaGFkb3dDbHMgPSBpc1Nob3c7XHJcbiAgICAgICAgY29uc3QgbWV0aG9kID0gaXNTaG93ID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyc7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIyW21ldGhvZF0odGhpcy5maXhlZFJpZ2h0Lm5hdGl2ZUVsZW1lbnQsIEZJWEVEX1JJR0hUX1NIQURPV19DTFMpO1xyXG5cclxuICAgICAgICBjb25zdCByZWFsV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC5sZWZ0Rml4ZWRXaWR0aCArIHRoaXMuY29sdW1uc0dyb3VwLm5vcm1hbFdpZHRoICsgdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGg7XHJcbiAgICAgICAgY29uc3QgZ3JpZFdpZHRoID0gdGhpcy5kZy53aWR0aDtcclxuICAgICAgICBsZXQgbCA9IHRoaXMuZGcud2lkdGggLSAodGhpcy5kZy5zaG93Qm9yZGVyID8gMiA6IDApIC0gdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGg7XHJcbiAgICAgICAgaWYgKGdyaWRXaWR0aCA+IHJlYWxXaWR0aCkge1xyXG4gICAgICAgICAgICBsID0gdGhpcy5jb2x1bW5zR3JvdXAubGVmdEZpeGVkV2lkdGggKyB0aGlzLmNvbHVtbnNHcm91cC5ub3JtYWxXaWR0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyMi5zZXRTdHlsZSh0aGlzLmZpeGVkUmlnaHQubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBsICsgJ3B4Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Sb3dOdW1lckNvbHVtbkRibENsaWNrKGU6IE1vdXNlRXZlbnQsIHJudGQ6IGFueSkge1xyXG4gICAgICAgIGxldCBtYXhSb3dOdW1iZXIgPSB0aGlzLmRnLmdldFJvd3MoKS5sZW5ndGg7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBwYWdlU2l6ZSA9IHRoaXMuZGcucGFnZVNpemU7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhZ2VJbmRleCA9IHRoaXMuZGcucGFnZUluZGV4O1xyXG4gICAgICAgICAgICBtYXhSb3dOdW1iZXIgPSBwYWdlU2l6ZSAqIHBhZ2VJbmRleCArIHBhZ2VTaXplO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5kZy5sb25nVGV4dEFyZWEubmF0aXZlRWxlbWVudC5pbm5lckhUTUwgPSBtYXhSb3dOdW1iZXI7XHJcbiAgICAgICAgY29uc3QgdzEgPSB0aGlzLmRnLmxvbmdUZXh0QXJlYS5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xyXG5cclxuICAgICAgICBjb25zdCBjdXJyZW50V2lkdGggPSBybnRkLm9mZnNldFdpZHRoO1xyXG5cclxuICAgICAgICBpZiAodzEgPiBjdXJyZW50V2lkdGgpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5saW5lTnVtYmVyV2lkdGggPSB3MSArIDEwO1xyXG4gICAgICAgICAgICB0aGlzLmRmcy51cGRhdGVQcm9wZXJ0eSgnbGluZU51bWJlcldpZHRoJywgdGhpcy5kZy5saW5lTnVtYmVyV2lkdGgpO1xyXG4gICAgICAgICAgICB0aGlzLmRmcy5yZXNpemVDb2x1bW5zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uU29ydENvbHVtbkNsaWNrKGU6IE1vdXNlRXZlbnQsIGNvbDogRGF0YUNvbHVtbikge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVTb3J0KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghY29sLnNvcnRhYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g57uT5p2f57yW6L6RXHJcbiAgICAgICAgdGhpcy5kZy5jYW5jZWxFZGl0KG51bGwpO1xyXG4gICAgICAgIGNvbnN0IHNvcnROYW1lID0gdGhpcy5kZy5zb3J0TmFtZTtcclxuICAgICAgICBjb25zdCBzb3J0T3JkZXIgPSB0aGlzLmRnLnNvcnRPcmRlcjtcclxuICAgICAgICBsZXQgc29ydEZpZWxkcyA9IFtdO1xyXG4gICAgICAgIGxldCBzb3J0T3JkZXJzID0gW107XHJcbiAgICAgICAgaWYgKHNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIHNvcnRGaWVsZHMgPSBzb3J0TmFtZS5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgICBzb3J0T3JkZXJzID0gc29ydE9yZGVyLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjb2xPcmRlciA9IGNvbC5vcmRlciB8fCAnYXNjJztcclxuICAgICAgICBsZXQgbmV3T3JkZXIgPSBjb2xPcmRlcjtcclxuICAgICAgICBjb25zdCBpID0gc29ydEZpZWxkcy5maW5kSW5kZXgobiA9PiBuID09PSBjb2wuZmllbGQpO1xyXG4gICAgICAgIGlmIChpID49IDApIHtcclxuICAgICAgICAgICAgY29uc3QgX29yZGVyID0gc29ydE9yZGVyc1tpXSA9PT0gJ2FzYycgPyAnZGVzYycgOiAnYXNjJztcclxuICAgICAgICAgICAgbmV3T3JkZXIgPSBfb3JkZXI7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLmRnLm11bHRpU29ydCAmJiBuZXdPcmRlciA9PT0gJ2FzYycpIHtcclxuICAgICAgICAgICAgaWYgKG5ld09yZGVyID09PSAnYXNjJykge1xyXG4gICAgICAgICAgICAgICAgbmV3T3JkZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBzb3J0RmllbGRzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcnMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVyc1tpXSA9IF9vcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLm11bHRpU29ydCkge1xyXG4gICAgICAgICAgICAgICAgc29ydEZpZWxkcy5wdXNoKGNvbC5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICBzb3J0T3JkZXJzLnB1c2goY29sT3JkZXIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc29ydEZpZWxkcyA9IFtjb2wuZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVycyA9IFtjb2xPcmRlcl07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbC5vcmRlciA9IG5ld09yZGVyO1xyXG5cclxuICAgICAgICB0aGlzLmRnLnNvcnROYW1lID0gc29ydEZpZWxkcy5qb2luKCcsJyk7XHJcbiAgICAgICAgdGhpcy5kZy5zb3J0T3JkZXIgPSBzb3J0T3JkZXJzLmpvaW4oJywnKTtcclxuICAgICAgICB0aGlzLmRmcy5zZXRTb3J0SW5mbyh0aGlzLmRnLnNvcnROYW1lLCB0aGlzLmRnLnNvcnRPcmRlcik7XHJcblxyXG4gICAgICAgIHRoaXMuZGcuYmVmb3JlU29ydENvbHVtbih0aGlzLmRnLnNvcnROYW1lLCB0aGlzLmRnLnNvcnRPcmRlciwgdGhpcy5kZykuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5kZy5vbkNvbHVtblNvcnRlZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2ZpbHRlci1yb3ctY3JlYXRvcl0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGaWx0ZXJSb3dDcmVhdGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgICBASW5wdXQoKSBsZWZ0OiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgcmlnaHQ6IGJvb2xlYW47XHJcblxyXG4gICAgcHJpdmF0ZSBkZ3M6IERhdGFncmlkU2VydmljZTtcclxuICAgIHByaXZhdGUgZGZzOiBEYXRhZ3JpZEZhY2FkZVNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyO1xyXG4gICAgcHJpdmF0ZSBkZnJzOiBEYXRhZ3JpZEZpbHRlclNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGZpbHRlclJvd1R5cGU6IGFueTtcclxuICAgIHByaXZhdGUgZmlsdGVyUm93UmVmOiBDb21wb25lbnRSZWY8YW55PjtcclxuICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB2YzogVmlld0NvbnRhaW5lclJlZiwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHVibGljIGRnOiBEYXRhZ3JpZENvbXBvbmVudCwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSkge1xyXG5cclxuICAgICAgICB0aGlzLmRmcyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkRmFjYWRlU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5kZ3MgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZFNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuY2ZyID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKTtcclxuICAgICAgICB0aGlzLmNkID0gdGhpcy5pbmplY3Rvci5nZXQoQ2hhbmdlRGV0ZWN0b3JSZWYpO1xyXG4gICAgICAgIHRoaXMuZGZycyA9IHRoaXMuZGcuY2xpZW50RmlsdGVyU2VydmljZTtcclxuXHJcbiAgICAgICAgdGhpcy5maWx0ZXJSb3dUeXBlID0gdGhpcy5pbmplY3Rvci5nZXQoR1JJRF9GSUxURVJfUk9XLCBudWxsKTtcclxuXHJcbiAgICAgICAgdGhpcy5kZ3MuY2xlYXJGaWx0ZXIuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZmlsdGVyUm93UmVmKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclJvd1JlZi5pbnN0YW5jZS5jbGVhckZpbHRlclZhbHVlKGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuZGdzLmNvbHVtbnNDaGFuZ2VkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRmlsdGVyUm93KHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGZycykge1xyXG4gICAgICAgICAgICB0aGlzLmRmcnMucmVtb3ZlRmllbGQuc3Vic2NyaWJlKChmKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maWx0ZXJSb3dSZWYgJiYgZikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IF9jb2xzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubGVmdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfY29scyA9IHRoaXMuZGcuY29sR3JvdXAubGVmdEZpeGVkIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfY29scyA9IHRoaXMuZGcuY29sR3JvdXAucmlnaHRGaXhlZCB8fCBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfY29scyA9IHRoaXMuZGcuY29sR3JvdXAubm9ybWFsQ29sdW1ucyB8fCBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZsYWcgPSAhIV9jb2xzLmZpbmQobiA9PiBuLmZpZWxkID09PSBmKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclJvd1JlZi5pbnN0YW5jZS5yZW1vdmVGaWVsZChmKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLmNyZWF0ZUZpbHRlclJvdyh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAgICAgLy8gaWYgKGNoYW5nZXMuY29sdW1uc0dyb3VwICYmICFjaGFuZ2VzLmNvbHVtbnNHcm91cC5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5jcmVhdGVGaWx0ZXJSb3coKTtcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOi/h+a7pOihjCAqL1xyXG4gICAgY3JlYXRlRmlsdGVyUm93KHJlYnVpbGQgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChyZWJ1aWxkICYmIHRoaXMuZmlsdGVyUm93UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUm93UmVmLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJSb3dSZWYgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUZpbHRlclJvdygpO1xyXG4gICAgICAgICAgICBpZiAocmVidWlsZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jcmVhdGVGaWx0ZXJSb3coKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZW5hYmxlRmlsdGVyUm93KSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5maWx0ZXJSb3dUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBjb2x1bW5zRGF0YSA9IHRoaXMuZGcuY29sR3JvdXAubm9ybWFsQ29sdW1ucztcclxuICAgICAgICAgICAgaWYgKHRoaXMubGVmdCkge1xyXG4gICAgICAgICAgICAgICAgY29sdW1uc0RhdGEgPSB0aGlzLmRnLmNvbEdyb3VwLmxlZnRGaXhlZDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW5zRGF0YSA9IHRoaXMuZGcuY29sR3JvdXAucmlnaHRGaXhlZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmZpbHRlclJvd1JlZiAmJiB0aGlzLnZjKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjZiA9IHRoaXMuY2ZyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KHRoaXMuZmlsdGVyUm93VHlwZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclJvd1JlZiA9IHRoaXMudmMuY3JlYXRlQ29tcG9uZW50KGNmKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyUm93UmVmLmluc3RhbmNlLmNvbHVtbnMgPSBjb2x1bW5zRGF0YTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyUm93UmVmLmluc3RhbmNlLmdyaWRJbnN0YW5jZSA9IHRoaXMuZGc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclJvd1JlZi5pbnN0YW5jZS5jb25kaXRpb25DaGFuZ2Uuc3Vic2NyaWJlKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBuIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uRmlsdGVyQ2hhbmdlZC5lbWl0KGNvbmRpdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==