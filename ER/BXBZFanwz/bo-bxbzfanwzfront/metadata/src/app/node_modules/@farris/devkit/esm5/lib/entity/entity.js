import { Subject, from } from 'rxjs';
import { tap } from 'rxjs/operators';
import { FieldMetadataUtil } from './metadata/index';
import { ModifyType, ChangeSet } from '../changeset/index';
import { PARENT_PATH, PARENT_CLASS } from './types';
import { EntityList } from './entity_list';
import { EntityFactory } from './entity_factory';
import { Validator } from './validator/index';
import { ValidationUtils } from './validator/validation_utils';
import { BigNumberType, RunMode } from '../core/types';
import { UserSettingsService } from '../i18n/user_settings_service';
import { ZonedTime } from '../i18n/zoned_time';
import { RunModeService } from '../misc';
/**
 * @author Lucas Huang
 * 实体抽象基类，所有实体必须扩展自Entity
 *
 * ### 使用示例
 * ```
 * export class UserEntity extends Entity {
 *    userId: string;
 *    userName: string;
 *
 *    constructor(data: any){
 *        super(data);
 *    }
 * }
 * ```
 */
var Entity = /** @class */ (function () {
    // #endregion
    /**
     * @param data JSON数据
     */
    function Entity(data) {
        // #region 私有、保护属性
        /**
         * 验证错误集合
         */
        this.validErrors = {};
        this.primaryFieldMetadata = null;
        this.originalData = undefined;
        /**
         * 增量变更集合
         */
        this.changeSet = new ChangeSet();
        /**
         * 是否正在验证
         */
        this.isValidating = false;
        /**
         * 新数据
         */
        this.newData = undefined;
        /**
         * 销毁流
         */
        this.unsubscribe = new Subject();
        // #endregion
        // #region 公有属性
        /**
         * 变更流
         */
        this.valueChanged = new Subject();
        /**
         * 属性值改变时触发
         *
         * ### 使用示例
         * ```
         *  const entity = new UserEntity(data);
         *  entity.onValueChanged.subscribe((data: Modification) => {
         *      console.log(data);
         *  })
         *
         * ```
         *
         * @event
         */
        this.onValueChanged = this.valueChanged.asObservable();
        this.onUpdate = new Subject();
        this.validator = new Validator();
        this.newData = Object.assign({}, data);
        this.originalData = Object.assign({}, data);
        this.onValueChanged = this.valueChanged;
        // this.onValueChanged = this.valueChanged.pipe(
        //     scan((x: Modification, curr: Modification) => {
        //         if (x) {
        //             if (isEqual(x.path, curr.path) && x.type === curr.type) {
        //                 return Object.assign(x, curr);
        //             }
        //             return curr;
        //         }
        //         return curr;
        //     })
        // );
        if (RunModeService.getRunMode() === RunMode.compatible) {
            this.initialize();
        }
        // this.validate();
    }
    Object.defineProperty(Entity.prototype, "data", {
        /**
         * 返回JSON格式的数据
         */
        get: function () {
            return this.newData;
        },
        set: function (value) {
            this.newData = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "errors", {
        /**
         * 验证错误集合
         */
        get: function () {
            return this.validErrors;
        },
        set: function (errors) {
            this.validErrors = errors;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "changes", {
        /**
         * 实体变更集
         */
        get: function () {
            return this.changeSet.changes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryProperty", {
        /**
         * 实体主键元数据
         */
        get: function () {
            if (!this.primaryFieldMetadata) {
                this.primaryFieldMetadata = FieldMetadataUtil.getPrimaryFieldMetadata(this.constructor);
            }
            return this.primaryFieldMetadata;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryKey", {
        /**
         * 主键
         * @todo
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryProperty) {
                return this.primaryProperty.property;
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryValue", {
        /**
         * 实体主键值
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryKey) {
                // return this[this.primaryProperty.property].toString();
                var primaryValue = this[this.primaryProperty.property];
                return primaryValue ? primaryValue : '';
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    // #region 公有方法
    /**
     * 将变更记录保存至变更集中
     * @param value 变更记录
     */
    Entity.prototype.setChanges = function (value) {
        var propertyName = value.path[value.path.length - 1];
        // @todo：事件会从下级向上冒泡，change可能是下级的，不能和当前Entity的newData合并。
        // this.newData = Object.assign(this.newData, { [propertyName]: value.value });
        this.valueChanged.next(value);
        if (!(this.validErrors && Object.keys(this.validErrors).includes(propertyName))) {
            if (value && value.changeSetValue !== undefined) {
                value = JSON.parse(JSON.stringify(value));
                value.value = value.changeSetValue;
            }
            this.changeSet.append(value);
        }
    };
    /**
     * 校验实体各属性的值
     * @param propertyName 属性名称，如果为空，则验证实体中所有设置了验证规则的属性
     * @returns Observable<ValidationResult>
     * ### 示例
     * ```
     *  const entity = new UserEntity(data);
     *  entity.validate().subscribe(result =>{
     *      if(result.isValid){
     *          ...
     *      } else {
     *          console.log(result.message);
     *      }
     *  })
     *
     * ```
     */
    // tslint:disable-next-line: max-line-length
    Entity.prototype.validate = function (propertyName, value, externalRules, index, frameContext) {
        var _this = this;
        return from(this.validator.validate(this, propertyName, value, externalRules, index, frameContext)).pipe(tap(function (result) {
            if (!result.isValid) {
                _this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
            }
            else {
                _this.validErrors = {};
            }
        }));
    };
    Entity.prototype.validateAll = function (validateContext) {
    };
    // 用于在entity_util中调用，如果有错误，会将验证结果传入回调cb
    Entity.prototype.validateFromUtil = function (propertyName, value, cb, context) {
        var _this = this;
        this.validErrors = {};
        from(this.validator.validate(this, propertyName, value, null, undefined, context && context.frameContext || null)).subscribe(function (result) {
            if (!result.isValid) {
                _this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
            }
            // 不应重新赋值，这里仅是实体校验通过
            /*else {
              // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
              if (this[propertyName] === value) {
                return;
              }
              this[propertyName] = value;
            }*/
            cb(result);
        });
    };
    /**
     * 同步校验
     * @param propertyName
     * @param value
     * @param cb
     */
    Entity.prototype.validateFromUtilSync = function (propertyName, value, cb, context) {
        this.validErrors = {};
        var result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);
        if (result && !result.isValid) {
            this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
        }
        cb(result);
    };
    Entity.prototype.getPaths = function () {
        var pathObj = {
            path: [],
            isUdt: false,
            isGrid: false
        };
        var handleParent = function (item) {
            var parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                var prop = parentPaths[parentPaths.length - 1];
                // 父级所在实体包含的ngObject，存在当前实体字段，则判断为UDt字段
                if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {
                    pathObj.isUdt = true;
                }
                // 存在类型为ngList，则判断为grid
                if (item instanceof EntityList === true) {
                    pathObj.isGrid = true;
                }
                else {
                    pathObj.path.push(prop);
                }
            }
            if (item[PARENT_CLASS]) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        pathObj.path = pathObj.path.reverse();
        return pathObj;
    };
    Entity.prototype.getEntityListPath = function () {
        var paths = [];
        var handleParent = function (item) {
            var parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                if (item instanceof EntityList === true) {
                    var path = parentPaths.concat([]).reverse();
                    Array.prototype.push.apply(paths, path);
                }
            }
            if (item[PARENT_CLASS]) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        return paths.reverse();
    };
    Entity.prototype.getMainEntityPrimaryValue = function () {
        var item = this;
        while (item[PARENT_CLASS]) {
            item = item[PARENT_CLASS];
        }
        return item.primaryValue;
    };
    /**
     * 加载数据
     * @param data 新数据
     */
    Entity.prototype.load = function (data, options) {
        if (options === void 0) { options = {}; }
        if (!data) {
            data = {};
        }
        this.loadFields(data);
        if (!options || (options && options.loadChild !== false)) {
            this.loadLists(data);
        }
        this.loadObjects(data);
        this.loadDynamicObjects(data);
        this.newData = Object.assign({}, data);
        this.originalData = Object.assign({}, data);
    };
    /**
     * 转换为JSON
     * @param buildChanges 是否构造变更集
     * @param includeMultiLanguageField 是否包含多语字段
     */
    Entity.prototype.toJSON = function (buildChanges) {
        var _this = this;
        var result = {};
        // 简单属性
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            if (buildChanges === true && ngField.enableTimeZone === true) {
                result[dataField] = _this.data[propName];
            }
            else {
                result[dataField] = _this[propName];
            }
        });
        // 对象属性
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON(buildChanges) : {};
        });
        // 动态属性
        var ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamics).forEach(function (propName) {
            var ngDynamic = ngDynamics[propName];
            var dataField = ngDynamic.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON(buildChanges) : {};
        });
        // 列表属性
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON(buildChanges) : {};
        });
        return result;
    };
    // #endregion
    //#region 实体初始化相关private方法
    /**
     * 初始化实体
     */
    Entity.prototype.initialize = function () {
        var constructor = this.constructor;
        var ngFields = FieldMetadataUtil.getNgFields(constructor);
        var ngObjects = FieldMetadataUtil.getNgObjects(constructor);
        var ngLists = FieldMetadataUtil.getNgList(constructor);
        var ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);
        this.initializeNormalField(ngFields);
        this.initializeList(ngLists);
        this.initializeObject(ngObjects);
        this.initializeDynamic(ngDynamic);
    };
    /**
     * 创建path
     * @param propertyName 属性名称
     */
    Entity.prototype.createPath = function (propertyName) {
        var primaryFieldMetadata = this.primaryProperty;
        if (primaryFieldMetadata) {
            var primaryDataField = primaryFieldMetadata.dataField;
            return [primaryDataField + ':' + this.primaryValue, propertyName];
        }
        else {
            return [':', propertyName];
        }
    };
    /**
     * 属性字段初始化
     * @param ngFields 属性字段元数据
     */
    Entity.prototype.initializeNormalField = function (ngFields) {
        var _this = this;
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            if (delete _this[propName]) {
                Object.defineProperty(_this, propName, {
                    get: function () {
                        var value = this.getPropValue(propName, ngField);
                        return value;
                    },
                    set: function (newPropValue) {
                        // 值相同时不触发变更。
                        var oldPropValue = this.getPropValue(propName, ngField);
                        if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {
                            return;
                        }
                        this.setPropValue(propName, ngField, newPropValue);
                        var changeSetValue = this.preparePropValue(propName, ngField, newPropValue);
                        this.emitValueChange(propName, ngField, newPropValue, oldPropValue, changeSetValue);
                    }
                });
            }
        });
    };
    /**
     * 初始化列表类型的元数据
     * @param ngListMetadata 列表类型元数据
     */
    Entity.prototype.initializeList = function (ngListMetadata) {
        var _this = this;
        Object.keys(ngListMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngListMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var val = _this.data[dataField];
            var entityList = new EntityList();
            entityList[PARENT_CLASS] = _this;
            entityList[PARENT_PATH] = path;
            if (val) {
                var entities = val.map(function (v) { return EntityFactory(fieldMetadata.type, v); });
                entityList.loadEntities(entities);
            }
            entityList.onListChanged.subscribe(function (value) {
                if (value) {
                    if (entityList[PARENT_PATH][0] !== value.path[0]) {
                        value.path = entityList[PARENT_PATH].concat(value.path);
                    }
                    _this.setChanges(value);
                }
            });
            _this[propertyName] = entityList;
        });
    };
    /**
     * 初始化子对象
     * @param ngObjectMetadata 子对象元数据
     */
    Entity.prototype.initializeObject = function (ngObjectMetadata) {
        var _this = this;
        Object.keys(ngObjectMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngObjectMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            // val不存在时，用空对象代替
            var val = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            // 如果没有值用一个空对象代替
            var childEntity = createEntityFromJsonData(val);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return childEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: childEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        childEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    }
                });
            }
        });
    };
    Entity.prototype.initializeDynamic = function (ngDynamicMetadata) {
        var _this = this;
        Object.keys(ngDynamicMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngDynamicMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var originalData = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            var dynamicEntity = createEntityFromJsonData(originalData);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return dynamicEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: dynamicEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        dynamicEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    }
                });
            }
        });
    };
    //#endregion
    // #region 加载实体数据相关private、projected方法
    /**
     * 加载简单字段值
     * @todo 临时用修改的方式模拟
     */
    Entity.prototype.loadFields = function (data) {
        var _this = this;
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            // if (ngField.primary === false) {
            //   this[propName] = data[dataField];
            // }
            var propValue = data[dataField];
            if (ngField.enableTimeZone === true) {
                var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                if (timeZoneOffset !== null && propValue) {
                    propValue = ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(propValue, timeZoneOffset);
                }
            }
            _this[propName] = propValue;
        });
    };
    /**
     * 加载子列表数据
     * @param data 数据
     */
    Entity.prototype.loadLists = function (data) {
        var _this = this;
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            var entityType = ngList.type;
            // 创建实体
            var listData = data[dataField];
            if (listData) {
                var entities = listData.map(function (entityData) {
                    return EntityFactory(entityType, entityData);
                });
                _this[propName].loadEntities(entities);
            }
            else {
                _this[propName].loadEntities([]);
            }
        });
    };
    Entity.prototype.loadObjects = function (data) {
        var _this = this;
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            var objectData = data[dataField];
            var entity = _this[propName];
            if (!entity || !objectData) {
                return;
            }
            entity.load(objectData);
        });
    };
    Entity.prototype.loadDynamicObjects = function (data) {
        var _this = this;
        var ngDynamicObjects = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamicObjects).forEach(function (propName) {
            var ngDynamicObject = ngDynamicObjects[propName];
            var dataField = ngDynamicObject.dataField || propName;
            var dynamicData = data[dataField] || {};
            var dynamicEntity = _this[propName];
            if (!dynamicEntity) {
                return;
            }
            dynamicEntity.loadDynamicData(dynamicData);
        });
    };
    // #endregion
    // #region 私有工具方法
    /**
     * 发送值变更
     */
    Entity.prototype.emitValueChange = function (propName, propMetadata, newPropValue, oldPropValue, changeSetValue) {
        if (changeSetValue === void 0) { changeSetValue = undefined; }
        var change = {
            path: this.createPath(propName),
            value: newPropValue,
            changeSetValue: changeSetValue,
            preValue: oldPropValue,
            type: ModifyType.ValueChange
        };
        if (this[PARENT_PATH]) {
            change.path = this[PARENT_PATH].concat(change.path);
        }
        this.setChanges(change);
    };
    /**
     * 准备提交给后端的属性值
     * @param propName 属性
     * @param propMetadata 属性描述
     * @param propValue 属性值
     */
    Entity.prototype.preparePropValue = function (propName, propMetadata, propValue) {
        var value = undefined;
        // 只要启用时区，传给后端的时间就必须带时区，因此当获取用户时区失败的时候，获取浏览器当前时区
        if (propMetadata.enableTimeZone === true) {
            var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
            if (timeZoneOffset !== null && propValue) {
                value = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);
            }
        }
        return value;
    };
    /**
     * 获取属性值
     */
    Entity.prototype.getPropValue = function (propName, propMetadata) {
        var _a;
        var dataField = propMetadata.dataField || propName;
        var value = this.data[dataField];
        // 对多语录入字段，query不返回问题进行兼容
        if (propMetadata.enableMultiLangInput === true && !value) {
            var langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';
            var originDataField = dataField.replace('_MULTILANGUAGE', '');
            return _a = {},
                _a[langCode] = this.data[originDataField],
                _a;
        }
        // 启用时区
        if (propMetadata.enableTimeZone === true) {
            var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
            if (timeZoneOffset !== null && value) {
                return ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(value, timeZoneOffset);
            }
        }
        if (propMetadata.originalDataFieldType === BigNumberType) {
            value = value && value.toString() || null;
        }
        return value;
    };
    /**
     * 设置属性值
     */
    Entity.prototype.setPropValue = function (propName, propMetadata, propValue) {
        var dataField = propMetadata.dataField || propName;
        if (propMetadata.originalDataFieldType === BigNumberType) {
            this.data[dataField] = propValue === null ? null : propValue && propValue.toString() || '';
        }
        else {
            if (propMetadata.enableTimeZone === true) {
                var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                if (timeZoneOffset !== null && propValue) {
                    propValue = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);
                }
            }
            this.data[dataField] = propValue;
        }
    };
    /**
     * 检查属性值是否发生变化
     */
    Entity.prototype.isPropValueChanged = function (propName, propMetadata, newPropValue, oldPropValue) {
        if (propMetadata.enableMultiLangInput === true) {
            if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {
                return false;
            }
            return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);
        }
        else if (propMetadata.originalDataFieldType === BigNumberType) {
            if (typeof newPropValue !== 'string' && newPropValue !== null && newPropValue !== undefined) {
                console.log('BigNumber must be a string !');
                newPropValue = newPropValue.toString();
            }
            return newPropValue !== oldPropValue;
        }
        else {
            return newPropValue !== oldPropValue;
        }
    };
    /**
     * 多语录入字段的值是否为空
     */
    Entity.prototype.isEmptyMultiLangPropValue = function (value) {
        if (!value) {
            return true;
        }
        var keys = Object.keys(value);
        if (keys.length === 0) {
            return true;
        }
        // 值全部为空，视为空
        var vals = Object.values(value);
        var allEmptyVal = vals.every(function (val) {
            return !val;
        });
        if (allEmptyVal === true) {
            return true;
        }
        return false;
    };
    return Entity;
}());
export { Entity };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L2VudGl0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUF3RSxpQkFBaUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzNILE9BQU8sRUFBZ0IsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQWtDLE1BQU0sbUJBQW1CLENBQUM7QUFDOUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUUvQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ3pDOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUNIO0lBMEhFLGFBQWE7SUFHYjs7T0FFRztJQUNILGdCQUFZLElBQVM7UUEvSHJCLGtCQUFrQjtRQUVsQjs7V0FFRztRQUNLLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLHlCQUFvQixHQUFvQixJQUFJLENBQUM7UUFDN0MsaUJBQVksR0FBRyxTQUFTLENBQUM7UUFN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QUksV0FBVyxLQUFLLElBQUksRUFBRTtZQUN4QixPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUgsYUFBQztBQUFELENBQUMsQUFsd0JELElBa3dCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIGZyb20gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBOZ0ZpZWxkUHJvcGVydHksIE5nTGlzdFByb3BlcnR5LCBOZ09iamVjdFByb3BlcnR5LCBOZ0R5bmFtaWNQcm9wZXJ0eSwgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuL21ldGFkYXRhL2luZGV4JztcclxuaW1wb3J0IHsgTW9kaWZpY2F0aW9uLCBNb2RpZnlUeXBlLCBDaGFuZ2VTZXQgfSBmcm9tICcuLi9jaGFuZ2VzZXQvaW5kZXgnO1xyXG5pbXBvcnQgeyBQQVJFTlRfUEFUSCwgUEFSRU5UX0NMQVNTLCBEeW5hbWljIH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IEVudGl0eUxpc3QgfSBmcm9tICcuL2VudGl0eV9saXN0JztcclxuaW1wb3J0IHsgRW50aXR5RmFjdG9yeSB9IGZyb20gJy4vZW50aXR5X2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3IsIFZhbGlkYXRpb25SZXN1bHQsIFZhbGlkYXRlUnVsZSB9IGZyb20gJy4vdmFsaWRhdG9yL2luZGV4JztcclxuaW1wb3J0IHsgVmFsaWRhdGlvblV0aWxzIH0gZnJvbSAnLi92YWxpZGF0b3IvdmFsaWRhdGlvbl91dGlscyc7XHJcbmltcG9ydCB7IEJpZ051bWJlclR5cGUsIFJ1bk1vZGUgfSBmcm9tICcuLi9jb3JlL3R5cGVzJztcclxuaW1wb3J0IHsgVXNlclNldHRpbmdzU2VydmljZSB9IGZyb20gJy4uL2kxOG4vdXNlcl9zZXR0aW5nc19zZXJ2aWNlJztcclxuaW1wb3J0IHsgWm9uZWRUaW1lIH0gZnJvbSAnLi4vaTE4bi96b25lZF90aW1lJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnLi4vZnJhbWUvaW5kZXgnO1xyXG5pbXBvcnQgeyBSdW5Nb2RlU2VydmljZSB9IGZyb20gJy4uL21pc2MnO1xyXG4vKipcclxuICogQGF1dGhvciBMdWNhcyBIdWFuZ1xyXG4gKiDlrp7kvZPmir3osaHln7rnsbvvvIzmiYDmnInlrp7kvZPlv4XpobvmianlsZXoh6pFbnRpdHlcclxuICpcclxuICogIyMjIOS9v+eUqOekuuS+i1xyXG4gKiBgYGBcclxuICogZXhwb3J0IGNsYXNzIFVzZXJFbnRpdHkgZXh0ZW5kcyBFbnRpdHkge1xyXG4gKiAgICB1c2VySWQ6IHN0cmluZztcclxuICogICAgdXNlck5hbWU6IHN0cmluZztcclxuICpcclxuICogICAgY29uc3RydWN0b3IoZGF0YTogYW55KXtcclxuICogICAgICAgIHN1cGVyKGRhdGEpO1xyXG4gKiAgICB9XHJcbiAqIH1cclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRW50aXR5IHtcclxuICAvLyAjcmVnaW9uIOengeacieOAgeS/neaKpOWxnuaAp1xyXG5cclxuICAvKipcclxuICAgKiDpqozor4HplJnor6/pm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIHZhbGlkRXJyb3JzID0ge307XHJcbiAgcHJpdmF0ZSBwcmltYXJ5RmllbGRNZXRhZGF0YTogTmdGaWVsZFByb3BlcnR5ID0gbnVsbDtcclxuICBwcml2YXRlIG9yaWdpbmFsRGF0YSA9IHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiDpqozor4HlmahcclxuICAgKi9cclxuICBwcml2YXRlIHZhbGlkYXRvcjogVmFsaWRhdG9yPGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOWinumHj+WPmOabtOmbhuWQiFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjaGFuZ2VTZXQgPSBuZXcgQ2hhbmdlU2V0KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuato+WcqOmqjOivgVxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBpc1ZhbGlkYXRpbmcgPSBmYWxzZTtcclxuXHJcbiAgLyoqXHJcbiAgICog5paw5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIG5ld0RhdGEgPSB1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICog6ZSA5q+B5rWBXHJcbiAgICovXHJcbiAgcHVibGljIHVuc3Vic2NyaWJlOlN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDlhazmnInlsZ7mgKdcclxuXHJcbiAgLyoqXHJcbiAgICog5Y+Y5pu05rWBXHJcbiAgICovXHJcbiAgcHVibGljIHZhbHVlQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcclxuXHJcbiAgLyoqXHJcbiAgICog5bGe5oCn5YC85pS55Y+Y5pe26Kem5Y+RXHJcbiAgICpcclxuICAgKiAjIyMg5L2/55So56S65L6LXHJcbiAgICogYGBgXHJcbiAgICogIGNvbnN0IGVudGl0eSA9IG5ldyBVc2VyRW50aXR5KGRhdGEpO1xyXG4gICAqICBlbnRpdHkub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKChkYXRhOiBNb2RpZmljYXRpb24pID0+IHtcclxuICAgKiAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAqICB9KVxyXG4gICAqXHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiBAZXZlbnRcclxuICAgKi9cclxuICBwdWJsaWMgb25WYWx1ZUNoYW5nZWQgPSB0aGlzLnZhbHVlQ2hhbmdlZC5hc09ic2VydmFibGUoKTtcclxuICBwdWJsaWMgb25VcGRhdGUgPSBuZXcgU3ViamVjdDxNb2RpZmljYXRpb24+KCk7XHJcbiAgLyoqXHJcbiAgICog6L+U5ZueSlNPTuagvOW8j+eahOaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgZGF0YSgpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMubmV3RGF0YTtcclxuICB9XHJcbiAgcHVibGljIHNldCBkYXRhKHZhbHVlOiBhbnkpe1xyXG4gICAgdGhpcy5uZXdEYXRhID0gdmFsdWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmqjOivgemUmeivr+mbhuWQiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgZXJyb3JzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsaWRFcnJvcnM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGVycm9ycyhlcnJvcnM6IGFueSkge1xyXG4gICAgdGhpcy52YWxpZEVycm9ycyA9IGVycm9ycztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+WPmOabtOmbhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgY2hhbmdlcygpOiBNb2RpZmljYXRpb25bXSB7XHJcbiAgICByZXR1cm4gdGhpcy5jaGFuZ2VTZXQuY2hhbmdlcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Li76ZSu5YWD5pWw5o2uXHJcbiAgICovXHJcblxyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeVByb3BlcnR5KCk6IE5nRmllbGRQcm9wZXJ0eSB7XHJcbiAgICBpZiAoIXRoaXMucHJpbWFyeUZpZWxkTWV0YWRhdGEpIHtcclxuICAgICAgdGhpcy5wcmltYXJ5RmllbGRNZXRhZGF0YSA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldFByaW1hcnlGaWVsZE1ldGFkYXRhKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucHJpbWFyeUZpZWxkTWV0YWRhdGE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDkuLvplK5cclxuICAgKiBAdG9kb1xyXG4gICAqIDHjgIHmsqHmnInkuLvplK7ml7bov5Tlm54nJ+S4jeWQiOeQhu+8jOW6lOivpei/lOWbnnVuZGVmaW5lZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeUtleSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMucHJpbWFyeVByb3BlcnR5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnByaW1hcnlQcm9wZXJ0eS5wcm9wZXJ0eTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S4u+mUruWAvFxyXG4gICAqIDHjgIHmsqHmnInkuLvplK7ml7bov5Tlm54nJ+S4jeWQiOeQhu+8jOW6lOivpei/lOWbnnVuZGVmaW5lZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeVZhbHVlKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5wcmltYXJ5S2V5KSB7XHJcbiAgICAgIC8vIHJldHVybiB0aGlzW3RoaXMucHJpbWFyeVByb3BlcnR5LnByb3BlcnR5XS50b1N0cmluZygpO1xyXG4gICAgICBjb25zdCBwcmltYXJ5VmFsdWUgPSB0aGlzW3RoaXMucHJpbWFyeVByb3BlcnR5LnByb3BlcnR5XTtcclxuICAgICAgcmV0dXJuIHByaW1hcnlWYWx1ZSA/IHByaW1hcnlWYWx1ZSA6ICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGRhdGEgSlNPTuaVsOaNrlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKGRhdGE6IGFueSkge1xyXG4gICAgdGhpcy52YWxpZGF0b3IgPSBuZXcgVmFsaWRhdG9yKCk7XHJcbiAgICB0aGlzLm5ld0RhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhKTtcclxuICAgIHRoaXMub3JpZ2luYWxEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XHJcbiAgICB0aGlzLm9uVmFsdWVDaGFuZ2VkID0gdGhpcy52YWx1ZUNoYW5nZWQ7XHJcbiAgICAvLyB0aGlzLm9uVmFsdWVDaGFuZ2VkID0gdGhpcy52YWx1ZUNoYW5nZWQucGlwZShcclxuICAgIC8vICAgICBzY2FuKCh4OiBNb2RpZmljYXRpb24sIGN1cnI6IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAgLy8gICAgICAgICBpZiAoeCkge1xyXG4gICAgLy8gICAgICAgICAgICAgaWYgKGlzRXF1YWwoeC5wYXRoLCBjdXJyLnBhdGgpICYmIHgudHlwZSA9PT0gY3Vyci50eXBlKSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeCwgY3Vycik7XHJcbiAgICAvLyAgICAgICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgICAgICByZXR1cm4gY3VycjtcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICByZXR1cm4gY3VycjtcclxuICAgIC8vICAgICB9KVxyXG4gICAgLy8gKTtcclxuICAgIGlmIChSdW5Nb2RlU2VydmljZS5nZXRSdW5Nb2RlKCkgPT09IFJ1bk1vZGUuY29tcGF0aWJsZSkge1xyXG4gICAgICB0aGlzLmluaXRpYWxpemUoKTtcclxuICAgIH1cclxuICAgIC8vIHRoaXMudmFsaWRhdGUoKTtcclxuICB9XHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOWFrOacieaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDlsIblj5jmm7TorrDlvZXkv53lrZjoh7Plj5jmm7Tpm4bkuK1cclxuICAgKiBAcGFyYW0gdmFsdWUg5Y+Y5pu06K6w5b2VXHJcbiAgICovXHJcbiAgcHVibGljIHNldENoYW5nZXModmFsdWU6IE1vZGlmaWNhdGlvbik6IHZvaWQge1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gdmFsdWUucGF0aFt2YWx1ZS5wYXRoLmxlbmd0aCAtIDFdO1xyXG5cclxuICAgIC8vIEB0b2Rv77ya5LqL5Lu25Lya5LuO5LiL57qn5ZCR5LiK5YaS5rOh77yMY2hhbmdl5Y+v6IO95piv5LiL57qn55qE77yM5LiN6IO95ZKM5b2T5YmNRW50aXR555qEbmV3RGF0YeWQiOW5tuOAglxyXG4gICAgLy8gdGhpcy5uZXdEYXRhID0gT2JqZWN0LmFzc2lnbih0aGlzLm5ld0RhdGEsIHsgW3Byb3BlcnR5TmFtZV06IHZhbHVlLnZhbHVlIH0pO1xyXG5cclxuICAgIHRoaXMudmFsdWVDaGFuZ2VkLm5leHQodmFsdWUpO1xyXG4gICAgaWYgKCEodGhpcy52YWxpZEVycm9ycyAmJiBPYmplY3Qua2V5cyh0aGlzLnZhbGlkRXJyb3JzKS5pbmNsdWRlcyhwcm9wZXJ0eU5hbWUpKSkge1xyXG4gICAgICBpZiAodmFsdWUgJiYgdmFsdWUuY2hhbmdlU2V0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHZhbHVlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xyXG4gICAgICAgIHZhbHVlLnZhbHVlID0gdmFsdWUuY2hhbmdlU2V0VmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5jaGFuZ2VTZXQuYXBwZW5kKHZhbHVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagoemqjOWunuS9k+WQhOWxnuaAp+eahOWAvFxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUg5bGe5oCn5ZCN56ew77yM5aaC5p6c5Li656m677yM5YiZ6aqM6K+B5a6e5L2T5Lit5omA5pyJ6K6+572u5LqG6aqM6K+B6KeE5YiZ55qE5bGe5oCnXHJcbiAgICogQHJldHVybnMgT2JzZXJ2YWJsZTxWYWxpZGF0aW9uUmVzdWx0PlxyXG4gICAqICMjIyDnpLrkvotcclxuICAgKiBgYGBcclxuICAgKiAgY29uc3QgZW50aXR5ID0gbmV3IFVzZXJFbnRpdHkoZGF0YSk7XHJcbiAgICogIGVudGl0eS52YWxpZGF0ZSgpLnN1YnNjcmliZShyZXN1bHQgPT57XHJcbiAgICogICAgICBpZihyZXN1bHQuaXNWYWxpZCl7XHJcbiAgICogICAgICAgICAgLi4uXHJcbiAgICogICAgICB9IGVsc2Uge1xyXG4gICAqICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgKiAgICAgIH1cclxuICAgKiAgfSlcclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqL1xyXG5cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gIHB1YmxpYyB2YWxpZGF0ZShwcm9wZXJ0eU5hbWU/OiBzdHJpbmcsIHZhbHVlPywgZXh0ZXJuYWxSdWxlcz86IE1hcDxzdHJpbmcsIFZhbGlkYXRlUnVsZVtdPiwgaW5kZXg/OiBudW1iZXIsIGZyYW1lQ29udGV4dD86IEZyYW1lQ29udGV4dCk6IE9ic2VydmFibGU8VmFsaWRhdGlvblJlc3VsdD4ge1xyXG4gICAgcmV0dXJuIGZyb20odGhpcy52YWxpZGF0b3IudmFsaWRhdGUodGhpcywgcHJvcGVydHlOYW1lLCB2YWx1ZSwgZXh0ZXJuYWxSdWxlcywgaW5kZXgsIGZyYW1lQ29udGV4dCkpLnBpcGUoXHJcbiAgICAgIHRhcChyZXN1bHQgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSBWYWxpZGF0aW9uVXRpbHMuY29udmVydEVycm9yc1RvTm9ybWFsT2JqZWN0KHJlc3VsdC5lcnJvcnMsIHt9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy52YWxpZEVycm9ycyA9IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdmFsaWRhdGVBbGwodmFsaWRhdGVDb250ZXh0PzogTWFwPHN0cmluZywgVmFsaWRhdGVSdWxlW10+KSB7XHJcblxyXG4gIH1cclxuXHJcbiAgLy8g55So5LqO5ZyoZW50aXR5X3V0aWzkuK3osIPnlKjvvIzlpoLmnpzmnInplJnor6/vvIzkvJrlsIbpqozor4Hnu5PmnpzkvKDlhaXlm57osINjYlxyXG4gIHB1YmxpYyB2YWxpZGF0ZUZyb21VdGlsKHByb3BlcnR5TmFtZTogc3RyaW5nLCB2YWx1ZSwgY2IsIGNvbnRleHQ/OiBhbnkpIHtcclxuICAgIHRoaXMudmFsaWRFcnJvcnMgPSB7fTtcclxuICAgIGZyb20odGhpcy52YWxpZGF0b3IudmFsaWRhdGUodGhpcywgcHJvcGVydHlOYW1lLCB2YWx1ZSwgbnVsbCwgdW5kZWZpbmVkLCBjb250ZXh0ICYmIGNvbnRleHQuZnJhbWVDb250ZXh0IHx8IG51bGwpKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgaWYgKCFyZXN1bHQuaXNWYWxpZCkge1xyXG4gICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSBWYWxpZGF0aW9uVXRpbHMuY29udmVydEVycm9yc1RvTm9ybWFsT2JqZWN0KHJlc3VsdC5lcnJvcnMsIHt9KTtcclxuICAgICAgfVxyXG4gICAgICAvLyDkuI3lupTph43mlrDotYvlgLzvvIzov5nph4zku4XmmK/lrp7kvZPmoKHpqozpgJrov4dcclxuICAgICAgLyplbHNlIHtcclxuICAgICAgICAvLyDlpoLmnpxCaW5kaW5nT2JqZWN05LiK55qE5bGe5oCn5YC85ZKMRW50aXR55LiK5a+55bqU5bGe5oCn5YC85LiA5qC377yM5YiZ5LiN5YaN6K6+572uXHJcbiAgICAgICAgaWYgKHRoaXNbcHJvcGVydHlOYW1lXSA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gdmFsdWU7XHJcbiAgICAgIH0qL1xyXG4gICAgICBjYihyZXN1bHQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQjOatpeagoemqjFxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUgXHJcbiAgICogQHBhcmFtIHZhbHVlIFxyXG4gICAqIEBwYXJhbSBjYiBcclxuICAgKi9cclxuICBwdWJsaWMgdmFsaWRhdGVGcm9tVXRpbFN5bmMocHJvcGVydHlOYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnksIGNiOiBhbnksIGNvbnRleHQ/OiBhbnkpIHtcclxuICAgIHRoaXMudmFsaWRFcnJvcnMgPSB7fTtcclxuICAgIGNvbnN0IHJlc3VsdDogYW55ID0gdGhpcy52YWxpZGF0b3IudmVyaWZ5KHRoaXMsIHByb3BlcnR5TmFtZSwgdmFsdWUsIG51bGwsIHVuZGVmaW5lZCwgY29udGV4dCAmJiBjb250ZXh0LmZyYW1lQ29udGV4dCB8fCBudWxsLCB0cnVlKTtcclxuICAgIGlmIChyZXN1bHQgJiYgIXJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSBWYWxpZGF0aW9uVXRpbHMuY29udmVydEVycm9yc1RvTm9ybWFsT2JqZWN0KHJlc3VsdC5lcnJvcnMsIHt9KTtcclxuICAgIH1cclxuICAgIGNiKHJlc3VsdCk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRQYXRocygpIHtcclxuICAgIGNvbnN0IHBhdGhPYmogPSB7XHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICBpc1VkdDogZmFsc2UsXHJcbiAgICAgIGlzR3JpZDogZmFsc2VcclxuICAgIH07XHJcbiAgICBjb25zdCBoYW5kbGVQYXJlbnQgPSBpdGVtID0+IHtcclxuICAgICAgY29uc3QgcGFyZW50UGF0aHMgPSBpdGVtW1BBUkVOVF9QQVRIXTtcclxuICAgICAgaWYgKHBhcmVudFBhdGhzKSB7XHJcbiAgICAgICAgY29uc3QgcHJvcCA9IHBhcmVudFBhdGhzW3BhcmVudFBhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgIC8vIOeItue6p+aJgOWcqOWunuS9k+WMheWQq+eahG5nT2JqZWN077yM5a2Y5Zyo5b2T5YmN5a6e5L2T5a2X5q6177yM5YiZ5Yik5pat5Li6VUR05a2X5q61XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhpdGVtW1BBUkVOVF9DTEFTU10uY29uc3RydWN0b3IpKS5pbmRleE9mKHByb3ApID4gLTEpIHtcclxuICAgICAgICAgIHBhdGhPYmouaXNVZHQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlrZjlnKjnsbvlnovkuLpuZ0xpc3TvvIzliJnliKTmlq3kuLpncmlkXHJcbiAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBFbnRpdHlMaXN0ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICBwYXRoT2JqLmlzR3JpZCA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHBhdGhPYmoucGF0aC5wdXNoKHByb3ApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH1cclxuICAgICAgaWYgKGl0ZW1bUEFSRU5UX0NMQVNTXSkge1xyXG4gICAgICAgIGhhbmRsZVBhcmVudChpdGVtW1BBUkVOVF9DTEFTU10pO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgaGFuZGxlUGFyZW50KHRoaXMpO1xyXG4gICAgcGF0aE9iai5wYXRoID0gcGF0aE9iai5wYXRoLnJldmVyc2UoKTtcclxuICAgIHJldHVybiBwYXRoT2JqO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0RW50aXR5TGlzdFBhdGgoKSB7XHJcbiAgICBsZXQgcGF0aHMgPSBbXTtcclxuICAgIGNvbnN0IGhhbmRsZVBhcmVudCA9IChpdGVtOiBFbnRpdHkpID0+IHtcclxuICAgICAgY29uc3QgcGFyZW50UGF0aHMgPSBpdGVtW1BBUkVOVF9QQVRIXTtcclxuICAgICAgaWYgKHBhcmVudFBhdGhzKSB7XHJcbiAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBFbnRpdHlMaXN0ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICBjb25zdCBwYXRoID0gcGFyZW50UGF0aHMuY29uY2F0KFtdKS5yZXZlcnNlKCk7XHJcbiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShwYXRocywgcGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChpdGVtW1BBUkVOVF9DTEFTU10pIHtcclxuICAgICAgICBoYW5kbGVQYXJlbnQoaXRlbVtQQVJFTlRfQ0xBU1NdKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGhhbmRsZVBhcmVudCh0aGlzKTtcclxuICAgIHJldHVybiBwYXRocy5yZXZlcnNlKCk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRNYWluRW50aXR5UHJpbWFyeVZhbHVlKCkge1xyXG4gICAgbGV0IGl0ZW0gPSB0aGlzO1xyXG4gICAgd2hpbGUgKGl0ZW1bUEFSRU5UX0NMQVNTXSkge1xyXG4gICAgICBpdGVtID0gaXRlbVtQQVJFTlRfQ0xBU1NdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGl0ZW0ucHJpbWFyeVZhbHVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliqDovb3mlbDmja5cclxuICAgKiBAcGFyYW0gZGF0YSDmlrDmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgbG9hZChkYXRhOiBhbnksIG9wdGlvbnM6IGFueSA9IHt9KSB7XHJcbiAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgZGF0YSA9IHt9O1xyXG4gICAgfVxyXG4gICAgdGhpcy5sb2FkRmllbGRzKGRhdGEpO1xyXG4gICAgaWYgKCFvcHRpb25zIHx8IChvcHRpb25zICYmIG9wdGlvbnMubG9hZENoaWxkICE9PSBmYWxzZSkpIHtcclxuICAgICAgdGhpcy5sb2FkTGlzdHMoZGF0YSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmxvYWRPYmplY3RzKGRhdGEpO1xyXG4gICAgdGhpcy5sb2FkRHluYW1pY09iamVjdHMoZGF0YSk7XHJcbiAgICB0aGlzLm5ld0RhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhKTtcclxuICAgIHRoaXMub3JpZ2luYWxEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouS4ukpTT05cclxuICAgKiBAcGFyYW0gYnVpbGRDaGFuZ2VzIOaYr+WQpuaehOmAoOWPmOabtOmbhlxyXG4gICAqIEBwYXJhbSBpbmNsdWRlTXVsdGlMYW5ndWFnZUZpZWxkIOaYr+WQpuWMheWQq+WkmuivreWtl+autVxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0pTT04oYnVpbGRDaGFuZ2VzPzogYm9vbGVhbikge1xyXG4gICAgY29uc3QgcmVzdWx0ID0ge307XHJcblxyXG4gICAgLy8g566A5Y2V5bGe5oCnXHJcbiAgICBjb25zdCBuZ0ZpZWxkcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdGaWVsZHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdGaWVsZCA9IG5nRmllbGRzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdGaWVsZC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIGlmIChidWlsZENoYW5nZXMgPT09IHRydWUgJiYgbmdGaWVsZC5lbmFibGVUaW1lWm9uZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpcy5kYXRhW3Byb3BOYW1lXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXNbcHJvcE5hbWVdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDlr7nosaHlsZ7mgKdcclxuICAgIGNvbnN0IG5nT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0cykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ09iamVjdCA9IG5nT2JqZWN0c1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nT2JqZWN0LmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgcmVzdWx0W2RhdGFGaWVsZF0gPSB0aGlzW3Byb3BOYW1lXSA/IHRoaXNbcHJvcE5hbWVdLnRvSlNPTihidWlsZENoYW5nZXMpIDoge307XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDliqjmgIHlsZ7mgKdcclxuICAgIGNvbnN0IG5nRHluYW1pY3MgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRHluYW1pYyA9IG5nRHluYW1pY3NbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0R5bmFtaWMuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXNbcHJvcE5hbWVdID8gdGhpc1twcm9wTmFtZV0udG9KU09OKGJ1aWxkQ2hhbmdlcykgOiB7fTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOWIl+ihqOWxnuaAp1xyXG4gICAgY29uc3QgbmdMaXN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdCh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nTGlzdHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdMaXN0ID0gbmdMaXN0c1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nTGlzdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpc1twcm9wTmFtZV0gPyB0aGlzW3Byb3BOYW1lXS50b0pTT04oYnVpbGRDaGFuZ2VzKSA6IHt9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vI3JlZ2lvbiDlrp7kvZPliJ3lp4vljJbnm7jlhbNwcml2YXRl5pa55rOVXHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMluWunuS9k1xyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZSgpIHtcclxuICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjtcclxuXHJcbiAgICBjb25zdCBuZ0ZpZWxkcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKGNvbnN0cnVjdG9yKTtcclxuICAgIGNvbnN0IG5nT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhjb25zdHJ1Y3Rvcik7XHJcbiAgICBjb25zdCBuZ0xpc3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdMaXN0KGNvbnN0cnVjdG9yKTtcclxuICAgIGNvbnN0IG5nRHluYW1pYyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyhjb25zdHJ1Y3Rvcik7XHJcblxyXG4gICAgdGhpcy5pbml0aWFsaXplTm9ybWFsRmllbGQobmdGaWVsZHMpO1xyXG4gICAgdGhpcy5pbml0aWFsaXplTGlzdChuZ0xpc3RzKTtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZU9iamVjdChuZ09iamVjdHMpO1xyXG4gICAgdGhpcy5pbml0aWFsaXplRHluYW1pYyhuZ0R5bmFtaWMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu6cGF0aFxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUg5bGe5oCn5ZCN56ewXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGNyZWF0ZVBhdGgocHJvcGVydHlOYW1lOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBwcmltYXJ5RmllbGRNZXRhZGF0YSA9IHRoaXMucHJpbWFyeVByb3BlcnR5O1xyXG4gICAgaWYgKHByaW1hcnlGaWVsZE1ldGFkYXRhKSB7XHJcbiAgICAgIGNvbnN0IHByaW1hcnlEYXRhRmllbGQgPSBwcmltYXJ5RmllbGRNZXRhZGF0YS5kYXRhRmllbGQ7XHJcbiAgICAgIHJldHVybiBbcHJpbWFyeURhdGFGaWVsZCArICc6JyArIHRoaXMucHJpbWFyeVZhbHVlLCBwcm9wZXJ0eU5hbWVdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIFsnOicsIHByb3BlcnR5TmFtZV07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsZ7mgKflrZfmrrXliJ3lp4vljJZcclxuICAgKiBAcGFyYW0gbmdGaWVsZHMg5bGe5oCn5a2X5q615YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplTm9ybWFsRmllbGQobmdGaWVsZHM6IHsgW2tleTogc3RyaW5nXTogTmdGaWVsZFByb3BlcnR5IH0pOiB2b2lkIHtcclxuICAgIE9iamVjdC5rZXlzKG5nRmllbGRzKS5mb3JFYWNoKHByb3BOYW1lID0+IHtcclxuICAgICAgY29uc3QgbmdGaWVsZCA9IG5nRmllbGRzW3Byb3BOYW1lXSBhcyBOZ0ZpZWxkUHJvcGVydHk7XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nRmllbGQuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG5cclxuICAgICAgaWYgKGRlbGV0ZSB0aGlzW3Byb3BOYW1lXSkge1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wTmFtZSwge1xyXG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRQcm9wVmFsdWUocHJvcE5hbWUsIG5nRmllbGQpO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbiAobmV3UHJvcFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vIOWAvOebuOWQjOaXtuS4jeinpuWPkeWPmOabtOOAglxyXG4gICAgICAgICAgICBjb25zdCBvbGRQcm9wVmFsdWUgPSB0aGlzLmdldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzUHJvcFZhbHVlQ2hhbmdlZChwcm9wTmFtZSwgbmdGaWVsZCwgbmV3UHJvcFZhbHVlLCBvbGRQcm9wVmFsdWUpID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCwgbmV3UHJvcFZhbHVlKTtcclxuICAgICAgICAgICAgY29uc3QgY2hhbmdlU2V0VmFsdWUgPSB0aGlzLnByZXBhcmVQcm9wVmFsdWUocHJvcE5hbWUsIG5nRmllbGQsIG5ld1Byb3BWYWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1pdFZhbHVlQ2hhbmdlKHByb3BOYW1lLCBuZ0ZpZWxkLCBuZXdQcm9wVmFsdWUsIG9sZFByb3BWYWx1ZSwgY2hhbmdlU2V0VmFsdWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMluWIl+ihqOexu+Wei+eahOWFg+aVsOaNrlxyXG4gICAqIEBwYXJhbSBuZ0xpc3RNZXRhZGF0YSDliJfooajnsbvlnovlhYPmlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIGluaXRpYWxpemVMaXN0KG5nTGlzdE1ldGFkYXRhOiB7IFtrZXk6IHN0cmluZ106IE5nTGlzdFByb3BlcnR5IH0pOiB2b2lkIHtcclxuICAgIE9iamVjdC5rZXlzKG5nTGlzdE1ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpZWxkTWV0YWRhdGEgPSBuZ0xpc3RNZXRhZGF0YVtwcm9wZXJ0eU5hbWVdIGFzIE5nTGlzdFByb3BlcnR5O1xyXG4gICAgICBjb25zdCBwYXRoID0gdGhpcy5jcmVhdGVQYXRoKHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IGZpZWxkTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BlcnR5TmFtZTtcclxuICAgICAgY29uc3QgdmFsID0gdGhpcy5kYXRhW2RhdGFGaWVsZF07XHJcblxyXG4gICAgICBjb25zdCBlbnRpdHlMaXN0ID0gbmV3IEVudGl0eUxpc3Q8dHlwZW9mIGZpZWxkTWV0YWRhdGEudHlwZT4oKTtcclxuICAgICAgZW50aXR5TGlzdFtQQVJFTlRfQ0xBU1NdID0gdGhpcztcclxuICAgICAgZW50aXR5TGlzdFtQQVJFTlRfUEFUSF0gPSBwYXRoO1xyXG5cclxuICAgICAgaWYgKHZhbCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdmFsLm1hcCh2ID0+IEVudGl0eUZhY3Rvcnk8dHlwZW9mIGZpZWxkTWV0YWRhdGEudHlwZT4oZmllbGRNZXRhZGF0YS50eXBlLCB2KSk7XHJcbiAgICAgICAgZW50aXR5TGlzdC5sb2FkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbnRpdHlMaXN0Lm9uTGlzdENoYW5nZWQuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgIGlmIChlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXVswXSAhPT0gdmFsdWUucGF0aFswXSkge1xyXG4gICAgICAgICAgICB2YWx1ZS5wYXRoID0gZW50aXR5TGlzdFtQQVJFTlRfUEFUSF0uY29uY2F0KHZhbHVlLnBhdGgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzW3Byb3BlcnR5TmFtZV0gPSBlbnRpdHlMaXN0O1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMluWtkOWvueixoVxyXG4gICAqIEBwYXJhbSBuZ09iamVjdE1ldGFkYXRhIOWtkOWvueixoeWFg+aVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZU9iamVjdChuZ09iamVjdE1ldGFkYXRhOiB7IFtrZXk6IHN0cmluZ106IE5nT2JqZWN0UHJvcGVydHkgfSkge1xyXG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RNZXRhZGF0YSkuZm9yRWFjaChwcm9wZXJ0eU5hbWUgPT4ge1xyXG4gICAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0gbmdPYmplY3RNZXRhZGF0YVtwcm9wZXJ0eU5hbWVdIGFzIE5nT2JqZWN0UHJvcGVydHk7XHJcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocHJvcGVydHlOYW1lKTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gZmllbGRNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcGVydHlOYW1lO1xyXG5cclxuICAgICAgLy8gdmFs5LiN5a2Y5Zyo5pe277yM55So56m65a+56LGh5Luj5pu/XHJcbiAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZGF0YVtkYXRhRmllbGRdIHx8IHt9O1xyXG5cclxuICAgICAgY29uc3QgY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhID0gKHZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICBsZXQgaW5zdGFuY2U7XHJcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgZmllbGRNZXRhZGF0YS50eXBlKSB7XHJcbiAgICAgICAgICBpbnN0YW5jZSA9IHZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpbnN0YW5jZSA9IEVudGl0eUZhY3RvcnkoZmllbGRNZXRhZGF0YS50eXBlLCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluc3RhbmNlW1BBUkVOVF9DTEFTU10gPSB0aGlzO1xyXG4gICAgICAgIGluc3RhbmNlW1BBUkVOVF9QQVRIXSA9IHBhdGg7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLm9uVmFsdWVDaGFuZ2VkLnN1YnNjcmliZShjaGFuZ2VzID0+IHtcclxuICAgICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZXMucGF0aCA9ICh0aGlzW1BBUkVOVF9QQVRIXSB8fCBbXSkuY29uY2F0KGNoYW5nZXMucGF0aCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhjaGFuZ2VzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8g5aaC5p6c5rKh5pyJ5YC855So5LiA5Liq56m65a+56LGh5Luj5pu/XHJcbiAgICAgIGxldCBjaGlsZEVudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWwpO1xyXG4gICAgICBpZiAoZGVsZXRlIHRoaXNbcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgICAgIGdldDogKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGRFbnRpdHk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWU6IGFueSkge1xyXG4gICAgICAgICAgICBjb25zdCBtb2RpZnlJbmZvID0ge1xyXG4gICAgICAgICAgICAgIHBhdGg6IGNoaWxkRW50aXR5W1BBUkVOVF9QQVRIXSxcclxuICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUuZGF0YSxcclxuICAgICAgICAgICAgICBwcmVWYWx1ZTogdGhpc1twcm9wZXJ0eU5hbWVdLmRhdGEsXHJcbiAgICAgICAgICAgICAgdHlwZTogTW9kaWZ5VHlwZS5WYWx1ZUNoYW5nZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjaGlsZEVudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhtb2RpZnlJbmZvKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXRpYWxpemVEeW5hbWljKG5nRHluYW1pY01ldGFkYXRhOiB7IFtrZXk6IHN0cmluZ106IE5nRHluYW1pY1Byb3BlcnR5IH0pIHtcclxuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY01ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpZWxkTWV0YWRhdGEgPSBuZ0R5bmFtaWNNZXRhZGF0YVtwcm9wZXJ0eU5hbWVdIGFzIE5nRHluYW1pY1Byb3BlcnR5O1xyXG4gICAgICBjb25zdCBwYXRoID0gdGhpcy5jcmVhdGVQYXRoKHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IGZpZWxkTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BlcnR5TmFtZTtcclxuXHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsRGF0YSA9IHRoaXMuZGF0YVtkYXRhRmllbGRdIHx8IHt9O1xyXG5cclxuICAgICAgY29uc3QgY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhID0gKHZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICBsZXQgaW5zdGFuY2U7XHJcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgZmllbGRNZXRhZGF0YS50eXBlKSB7XHJcbiAgICAgICAgICBpbnN0YW5jZSA9IHZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpbnN0YW5jZSA9IEVudGl0eUZhY3RvcnkoZmllbGRNZXRhZGF0YS50eXBlLCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluc3RhbmNlW1BBUkVOVF9DTEFTU10gPSB0aGlzO1xyXG4gICAgICAgIGluc3RhbmNlW1BBUkVOVF9QQVRIXSA9IHBhdGg7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLm9uVmFsdWVDaGFuZ2VkLnN1YnNjcmliZShjaGFuZ2VzID0+IHtcclxuICAgICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZXMucGF0aCA9ICh0aGlzW1BBUkVOVF9QQVRIXSB8fCBbXSkuY29uY2F0KGNoYW5nZXMucGF0aCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhjaGFuZ2VzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgbGV0IGR5bmFtaWNFbnRpdHkgPSBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEob3JpZ2luYWxEYXRhKTtcclxuICAgICAgaWYgKGRlbGV0ZSB0aGlzW3Byb3BlcnR5TmFtZV0pIHtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGR5bmFtaWNFbnRpdHk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgY29uc3QgbW9kaWZ5SW5mbyA9IHtcclxuICAgICAgICAgICAgICBwYXRoOiBkeW5hbWljRW50aXR5W1BBUkVOVF9QQVRIXSxcclxuICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUuZGF0YSxcclxuICAgICAgICAgICAgICBwcmVWYWx1ZTogdGhpc1twcm9wZXJ0eU5hbWVdLmRhdGEsXHJcbiAgICAgICAgICAgICAgdHlwZTogTW9kaWZ5VHlwZS5WYWx1ZUNoYW5nZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBkeW5hbWljRW50aXR5ID0gY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhKHZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKG1vZGlmeUluZm8pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDliqDovb3lrp7kvZPmlbDmja7nm7jlhbNwcml2YXRl44CBcHJvamVjdGVk5pa55rOVXHJcblxyXG4gIC8qKlxyXG4gICAqIOWKoOi9veeugOWNleWtl+auteWAvFxyXG4gICAqIEB0b2RvIOS4tOaXtueUqOS/ruaUueeahOaWueW8j+aooeaLn1xyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBsb2FkRmllbGRzKGRhdGE6IGFueSkge1xyXG4gICAgY29uc3QgbmdGaWVsZHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0ZpZWxkcyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRmllbGRzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRmllbGQgPSBuZ0ZpZWxkc1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nRmllbGQuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICAvLyBpZiAobmdGaWVsZC5wcmltYXJ5ID09PSBmYWxzZSkge1xyXG4gICAgICAvLyAgIHRoaXNbcHJvcE5hbWVdID0gZGF0YVtkYXRhRmllbGRdO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGxldCBwcm9wVmFsdWUgPSBkYXRhW2RhdGFGaWVsZF07XHJcbiAgICAgIGlmIChuZ0ZpZWxkLmVuYWJsZVRpbWVab25lID09PSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgdGltZVpvbmVPZmZzZXQgPSBVc2VyU2V0dGluZ3NTZXJ2aWNlLmdldFRpbWVab25lT2Zmc2V0KCk7XHJcbiAgICAgICAgaWYgKHRpbWVab25lT2Zmc2V0ICE9PSBudWxsICYmIHByb3BWYWx1ZSkge1xyXG4gICAgICAgICAgcHJvcFZhbHVlID0gWm9uZWRUaW1lLnpvbmVkVGltZVRvU3BlY2lhbFRpbWVab25lT2Zmc2V0VGltZVN0cmluZyhwcm9wVmFsdWUsIHRpbWVab25lT2Zmc2V0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgdGhpc1twcm9wTmFtZV0gPSBwcm9wVmFsdWU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWKoOi9veWtkOWIl+ihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBkYXRhIOaVsOaNrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBsb2FkTGlzdHMoZGF0YTogYW55KSB7XHJcbiAgICBjb25zdCBuZ0xpc3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdMaXN0KHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdMaXN0cykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0xpc3QgPSBuZ0xpc3RzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdMaXN0LmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgY29uc3QgZW50aXR5VHlwZSA9IG5nTGlzdC50eXBlO1xyXG5cclxuICAgICAgLy8g5Yib5bu65a6e5L2TXHJcbiAgICAgIGNvbnN0IGxpc3REYXRhID0gZGF0YVtkYXRhRmllbGRdO1xyXG4gICAgICBpZiAobGlzdERhdGEpIHtcclxuICAgICAgICBjb25zdCBlbnRpdGllcyA9IGxpc3REYXRhLm1hcCgoZW50aXR5RGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gRW50aXR5RmFjdG9yeTx0eXBlb2YgZW50aXR5VHlwZT4oZW50aXR5VHlwZSwgZW50aXR5RGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpc1twcm9wTmFtZV0ubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzW3Byb3BOYW1lXS5sb2FkRW50aXRpZXMoW10pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbG9hZE9iamVjdHMoZGF0YTogYW55KSB7XHJcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdPYmplY3QgPSBuZ09iamVjdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ09iamVjdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIGNvbnN0IG9iamVjdERhdGEgPSBkYXRhW2RhdGFGaWVsZF07XHJcbiAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXNbcHJvcE5hbWVdIGFzIEVudGl0eTtcclxuICAgICAgaWYgKCFlbnRpdHkgfHwgIW9iamVjdERhdGEpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgZW50aXR5LmxvYWQob2JqZWN0RGF0YSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBsb2FkRHluYW1pY09iamVjdHMoZGF0YTogYW55KSB7XHJcbiAgICBjb25zdCBuZ0R5bmFtaWNPYmplY3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljT2JqZWN0cykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0R5bmFtaWNPYmplY3QgPSBuZ0R5bmFtaWNPYmplY3RzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdEeW5hbWljT2JqZWN0LmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuXHJcbiAgICAgIGNvbnN0IGR5bmFtaWNEYXRhID0gZGF0YVtkYXRhRmllbGRdIHx8IHt9O1xyXG4gICAgICBjb25zdCBkeW5hbWljRW50aXR5ID0gdGhpc1twcm9wTmFtZV0gYXMgRHluYW1pYztcclxuICAgICAgaWYgKCFkeW5hbWljRW50aXR5KSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGR5bmFtaWNFbnRpdHkubG9hZER5bmFtaWNEYXRhKGR5bmFtaWNEYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAvLyAjcmVnaW9uIOengeacieW3peWFt+aWueazlVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+R6YCB5YC85Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBlbWl0VmFsdWVDaGFuZ2UocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHksIG5ld1Byb3BWYWx1ZTogYW55LCBvbGRQcm9wVmFsdWU6IGFueSwgY2hhbmdlU2V0VmFsdWU6IGFueSA9IHVuZGVmaW5lZCk6IHZvaWQge1xyXG4gICAgY29uc3QgY2hhbmdlID0ge1xyXG4gICAgICBwYXRoOiB0aGlzLmNyZWF0ZVBhdGgocHJvcE5hbWUpLFxyXG4gICAgICB2YWx1ZTogbmV3UHJvcFZhbHVlLFxyXG4gICAgICBjaGFuZ2VTZXRWYWx1ZSxcclxuICAgICAgcHJlVmFsdWU6IG9sZFByb3BWYWx1ZSxcclxuICAgICAgdHlwZTogTW9kaWZ5VHlwZS5WYWx1ZUNoYW5nZVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAodGhpc1tQQVJFTlRfUEFUSF0pIHtcclxuICAgICAgY2hhbmdlLnBhdGggPSB0aGlzW1BBUkVOVF9QQVRIXS5jb25jYXQoY2hhbmdlLnBhdGgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZXRDaGFuZ2VzKGNoYW5nZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWHhuWkh+aPkOS6pOe7meWQjuerr+eahOWxnuaAp+WAvFxyXG4gICAqIEBwYXJhbSBwcm9wTmFtZSDlsZ7mgKdcclxuICAgKiBAcGFyYW0gcHJvcE1ldGFkYXRhIOWxnuaAp+aPj+i/sFxyXG4gICAqIEBwYXJhbSBwcm9wVmFsdWUg5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwcmVwYXJlUHJvcFZhbHVlKHByb3BOYW1lOiBzdHJpbmcsIHByb3BNZXRhZGF0YTogTmdGaWVsZFByb3BlcnR5LCBwcm9wVmFsdWU6IGFueSkge1xyXG4gICAgbGV0IHZhbHVlID0gdW5kZWZpbmVkO1xyXG4gICAgLy8g5Y+q6KaB5ZCv55So5pe25Yy677yM5Lyg57uZ5ZCO56uv55qE5pe26Ze05bCx5b+F6aG75bim5pe25Yy677yM5Zug5q2k5b2T6I635Y+W55So5oi35pe25Yy65aSx6LSl55qE5pe25YCZ77yM6I635Y+W5rWP6KeI5Zmo5b2T5YmN5pe25Yy6XHJcbiAgICBpZiAocHJvcE1ldGFkYXRhLmVuYWJsZVRpbWVab25lID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IHRpbWVab25lT2Zmc2V0ID0gVXNlclNldHRpbmdzU2VydmljZS5nZXRUaW1lWm9uZU9mZnNldCgpO1xyXG4gICAgICBpZiAodGltZVpvbmVPZmZzZXQgIT09IG51bGwgJiYgcHJvcFZhbHVlKSB7XHJcbiAgICAgICAgdmFsdWUgPSBab25lZFRpbWUudGltZVpvbmVPZmZzZXRUaW1lVG9VdGNUaW1lU3RyaW5nKHByb3BWYWx1ZSwgdGltZVpvbmVPZmZzZXQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWxnuaAp+WAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UHJvcFZhbHVlKHByb3BOYW1lOiBzdHJpbmcsIHByb3BNZXRhZGF0YTogTmdGaWVsZFByb3BlcnR5KSB7XHJcbiAgICBjb25zdCBkYXRhRmllbGQgPSBwcm9wTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgbGV0IHZhbHVlID0gdGhpcy5kYXRhW2RhdGFGaWVsZF07XHJcblxyXG4gICAgLy8g5a+55aSa6K+t5b2V5YWl5a2X5q6177yMcXVlcnnkuI3ov5Tlm57pl67popjov5vooYzlhbzlrrlcclxuICAgIGlmIChwcm9wTWV0YWRhdGEuZW5hYmxlTXVsdGlMYW5nSW5wdXQgPT09IHRydWUgJiYgIXZhbHVlKSB7XHJcbiAgICAgIGNvbnN0IGxhbmdDb2RlID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZUNvZGUnKSB8fCAnemgtQ0hTJztcclxuICAgICAgY29uc3Qgb3JpZ2luRGF0YUZpZWxkID0gZGF0YUZpZWxkLnJlcGxhY2UoJ19NVUxUSUxBTkdVQUdFJywgJycpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIFtsYW5nQ29kZV06IHRoaXMuZGF0YVtvcmlnaW5EYXRhRmllbGRdXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvLyDlkK/nlKjml7bljLpcclxuICAgIGlmIChwcm9wTWV0YWRhdGEuZW5hYmxlVGltZVpvbmUgPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgdGltZVpvbmVPZmZzZXQgPSBVc2VyU2V0dGluZ3NTZXJ2aWNlLmdldFRpbWVab25lT2Zmc2V0KCk7XHJcbiAgICAgIGlmICh0aW1lWm9uZU9mZnNldCAhPT0gbnVsbCAmJiB2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBab25lZFRpbWUuem9uZWRUaW1lVG9TcGVjaWFsVGltZVpvbmVPZmZzZXRUaW1lU3RyaW5nKHZhbHVlLCB0aW1lWm9uZU9mZnNldCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChwcm9wTWV0YWRhdGEub3JpZ2luYWxEYXRhRmllbGRUeXBlID09PSBCaWdOdW1iZXJUeXBlKSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUgJiYgdmFsdWUudG9TdHJpbmcoKSB8fCBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHksIHByb3BWYWx1ZTogYW55KSB7XHJcbiAgICBjb25zdCBkYXRhRmllbGQgPSBwcm9wTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5vcmlnaW5hbERhdGFGaWVsZFR5cGUgPT09IEJpZ051bWJlclR5cGUpIHtcclxuICAgICAgdGhpcy5kYXRhW2RhdGFGaWVsZF0gPSBwcm9wVmFsdWUgPT09IG51bGwgPyBudWxsIDogcHJvcFZhbHVlICYmIHByb3BWYWx1ZS50b1N0cmluZygpIHx8ICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHByb3BNZXRhZGF0YS5lbmFibGVUaW1lWm9uZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHRpbWVab25lT2Zmc2V0ID0gVXNlclNldHRpbmdzU2VydmljZS5nZXRUaW1lWm9uZU9mZnNldCgpO1xyXG4gICAgICAgIGlmICh0aW1lWm9uZU9mZnNldCAhPT0gbnVsbCAmJiBwcm9wVmFsdWUpIHtcclxuICAgICAgICAgIHByb3BWYWx1ZSA9IFpvbmVkVGltZS50aW1lWm9uZU9mZnNldFRpbWVUb1V0Y1RpbWVTdHJpbmcocHJvcFZhbHVlLCB0aW1lWm9uZU9mZnNldCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZGF0YVtkYXRhRmllbGRdID0gcHJvcFZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l5bGe5oCn5YC85piv5ZCm5Y+R55Sf5Y+Y5YyWXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1Byb3BWYWx1ZUNoYW5nZWQocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHksIG5ld1Byb3BWYWx1ZTogYW55LCBvbGRQcm9wVmFsdWU6IGFueSkge1xyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5lbmFibGVNdWx0aUxhbmdJbnB1dCA9PT0gdHJ1ZSkge1xyXG4gICAgICBpZiAodGhpcy5pc0VtcHR5TXVsdGlMYW5nUHJvcFZhbHVlKG5ld1Byb3BWYWx1ZSkgPT09IHRydWUgJiYgdGhpcy5pc0VtcHR5TXVsdGlMYW5nUHJvcFZhbHVlKG9sZFByb3BWYWx1ZSkgPT09IHRydWUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5ld1Byb3BWYWx1ZSkgIT09IEpTT04uc3RyaW5naWZ5KG9sZFByb3BWYWx1ZSk7XHJcbiAgICB9IGVsc2UgaWYgKHByb3BNZXRhZGF0YS5vcmlnaW5hbERhdGFGaWVsZFR5cGUgPT09IEJpZ051bWJlclR5cGUpIHtcclxuICAgICAgaWYgKHR5cGVvZiBuZXdQcm9wVmFsdWUgIT09ICdzdHJpbmcnICYmIG5ld1Byb3BWYWx1ZSAhPT0gbnVsbCAmJiBuZXdQcm9wVmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdCaWdOdW1iZXIgbXVzdCBiZSBhIHN0cmluZyAhJyk7XHJcbiAgICAgICAgbmV3UHJvcFZhbHVlID0gbmV3UHJvcFZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG5ld1Byb3BWYWx1ZSAhPT0gb2xkUHJvcFZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG5ld1Byb3BWYWx1ZSAhPT0gb2xkUHJvcFZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSa6K+t5b2V5YWl5a2X5q6155qE5YC85piv5ZCm5Li656m6XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc0VtcHR5TXVsdGlMYW5nUHJvcFZhbHVlKHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHZhbHVlKTtcclxuICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlgLzlhajpg6jkuLrnqbrvvIzop4bkuLrnqbpcclxuICAgIGNvbnN0IHZhbHMgPSBPYmplY3QudmFsdWVzKHZhbHVlKTtcclxuICAgIGNvbnN0IGFsbEVtcHR5VmFsID0gdmFscy5ldmVyeSgodmFsKSA9PiB7XHJcbiAgICAgIHJldHVybiAhdmFsO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoYWxsRW1wdHlWYWwgPT09IHRydWUpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcbn1cclxuIl19