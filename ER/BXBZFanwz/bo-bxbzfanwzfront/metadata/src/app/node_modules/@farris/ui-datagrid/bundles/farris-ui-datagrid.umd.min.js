!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("lodash-es"),require("bignumber.js"),require("@farris/ui-common"),require("@farris/ui-locale"),require("@farris/ui-common/types"),require("@angular/common"),require("perfect-scrollbar"),require("resize-observer-polyfill"),require("@farris/ui-filter-panel"),require("@angular/platform-browser"),require("@farris/ui-common/column"),require("@angular/forms"),require("@farris/ui-notify"),require("@farris/ui-pagination"),require("@farris/ui-filter"),require("@farris/smooth-dnd"),require("@farris/ui-context-menu")):"function"==typeof define&&define.amd?define("@farris/ui-datagrid",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","lodash-es","bignumber.js","@farris/ui-common","@farris/ui-locale","@farris/ui-common/types","@angular/common","perfect-scrollbar","resize-observer-polyfill","@farris/ui-filter-panel","@angular/platform-browser","@farris/ui-common/column","@angular/forms","@farris/ui-notify","@farris/ui-pagination","@farris/ui-filter","@farris/smooth-dnd","@farris/ui-context-menu"],e):e(((t=t||self).farris=t.farris||{},t.farris["ui-datagrid"]={}),t.ng.core,t.ng.common.http,t.rxjs,t.rxjs.operators,t.lodashEs,t.bignumber_js,t.uiCommon,t.uiLocale,t.types,t.ng.common,t.PerfectScrollbar,t.ResizeObserver,t.uiFilterPanel,t.ng.platformBrowser,t.column,t.ng.forms,t.uiNotify,t.uiPagination,t.uiFilter,t.smoothDnd,t.uiContextMenu)}(this,function(t,e,i,n,r,o,s,l,a,c,d,h,u,p,g,f,m,y,w,v,b,C){"use strict";h=h&&h.hasOwnProperty("default")?h["default"]:h,u=u&&u.hasOwnProperty("default")?u["default"]:u;var S=function(){return(S=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function R(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(l){r={error:l}}finally{try{n&&!n.done&&(i=o["return"])&&i.call(o)}finally{if(r)throw r.error}}return s}function x(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(R(arguments[e]));return t}var E={string:0,number:1,boolean:2,date:3,time:4,datetime:5,"enum":6,fromdata:7};E[E.string]="string",E[E.number]="number",E[E.boolean]="boolean",E[E.date]="date",E[E.time]="time",E[E.datetime]="datetime",E[E["enum"]]="enum",E[E.fromdata]="fromdata";var I={none:-1,max:0,min:1,sum:2,average:3,count:4};I[I.none]="none",I[I.max]="max",I[I.min]="min",I[I.sum]="sum",I[I.average]="average",I[I.count]="count";var k=new e.InjectionToken("Farris DataGrid Editors."),F=new e.InjectionToken("Farris DataGrid Validators."),D=new e.InjectionToken("Farris DataGrid Filter-Row Component."),_=new e.InjectionToken("Farris DataGrid Setting Panel Component."),O=new e.InjectionToken("Farris DataGrid Setting Service."),P=new e.InjectionToken(" Datagrid Settings HttpClient."),T="psScrollX",H="psXReachEnd",L="psXReachStart",j="f-datagrid-fixed-left-shadow",A="f-datagrid-cell-selected",M="f-datagrid-cell-editing",z={sm:{row:29,header:34,pager:40},md:{row:36,header:40,pager:44},lg:{row:46,header:40,pager:44},xl:{row:60,header:40,pager:44}},G={datagrid:"highlight-allowedit-cell",textarea:"cell-textarea",textbox:"cell-textbox",checkbox:"cell-checkbox",datepicker:"cell-datepicker","input-group":"cell-input-group",select:"cell-combolist",lookup:"cell-lookup",numberbox:"cell-numberbox",combolist:"cell-combolist","combo-lookup":"cell-combolist","switch":"cell-switch",timepicker:"cell-timepicker","language-textbox":"cell-language-textbox","enum-editor":"cell-enum-editor"},V={idField:"id",showLineNumber:!1,selections:[],checkedRows:[],currentRow:null,columnsGroup:null,columns:[],fitColumns:!1,onlySelectSelf:!0,selectOnCheck:!0,checkOnSelect:!0,pageIndex:1,pageSize:20,pagerHeight:40,checkboxColumnWidth:36,pagination:!1,virtual:{rowIndex:0,scrollTop:0,topHideHeight:0,bottomHideHeight:0,isScrollChange:!1},sortName:undefined,sortOrder:undefined,multiSort:!1,remoteSort:!0,changes:null,showGroupColumn:!1},N="__row_index__",W="__group__",B="__group_parent_id__",$="__group_footer__",q="__group_visible__",X="__group_level__",U=function(){function t(){}return t.uuid=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.getValue=function(t,e,i){if(void 0===i&&(i=!1),!e)return"";var n="";return n=-1===t.indexOf(".")||e.hasOwnProperty(t)?e[t]:t.split(".").reduce(function(t,e){return t?t[e]:null},e),i?this.escapeValue(n):n},t.setValue=function(t,e,i,n){if(void 0===n&&(n=!0),t)if(t.indexOf(".")>-1&&n){var r=null,o=t.split(".");o.reduce(function(t,e){return r=t,t[e]},i),r&&(r[o.pop()]=e)}else i[t]=e},t.getMultilingualValue=function(t,e){if(t&&"object"==typeof t&&Object.keys(t).length>0){var i=t[e=e||"zh-CHS"];return i!==undefined?i:(console.log("can not find '"+e+"' in ",t),"")}return""},t.escapeValue=function(t){if(null===t||t===undefined||""===t)return"";return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;"):t},t.eventPath=function(t){var e=t.composedPath&&t.composedPath()||t.path,i=t.target;if(null!=e)return e.indexOf(window)<0?e.concat(window):e;if(i===window)return[window];var n=function(t,e){void 0===e&&(e=undefined),e=e||[];var i=t.parentNode;return i?n(i,e.concat(i)):e};return[i].concat(n(i),window)},t.hasDialogOpen=function(){return document.body.className.indexOf("modal-open")>-1},t.on=function(t,e,i,n){void 0===n&&(n={});var r=function(t){return t.target.matches(n.target)&&i.call(t.target,t)};return t.addEventListener(e,n.target?r:i,n.options||!1),function(){t.removeEventListener(e,r,n)}},t.off=function(t,e,i,n){void 0===i&&(i=function(){}),void 0===n&&(n={}),t.removeEventListener(e,i,n)},t.getBLen=function(t){return null==t?0:("string"!=typeof t&&(t+=""),t.replace(/[^\x00-\xff]/g,"01").length)},t.getWhenEmptyText=function(t,e){var i={"zh-CHS":"请输入","zh-CHT":"請輸入",en:"Please input"};if(t.editor)switch(t.editor.type){case"datepicker":case"select":case"lookup":case"combolist":case"combo-lookup":return{"zh-CHS":"请选择","zh-CHT":"請選擇",en:"Please select"}[e];default:return i[e]}return"_datagrid-setting-control_"===t.field?"":i[e]},t}(),Y=function(){function t(){}return t.getColumnTotal=function(t){var e=0;return t.forEach(function(t){e+=t.colspan||1}),e},t.findUndefinedItem=function(t){for(var e=0;e<t.length;e++)if(t[e]==undefined)return e;return-1},t.getColumnFields=function(e){for(var i=[],n=t.getColumnTotal(e[0]),r=0;r<e.length;r++)i[r]=new Array(n);var o=function(n){e[n].forEach(function(e){var r=t.findUndefinedItem(i[n]);if(r>=0)for(var o=e.field||e.id||"",s=0;s<(e.colspan||1);s++){for(var l=0;l<(e.rowspan||1);l++)i[n+l][r]=o;r++}})};for(r=0;r<e.length;r++)o(r);return i},t.columnIsVisible=function(t,e){t.visible===undefined&&(t.visible=!0);var i=typeof t.visible;return"boolean"===i?t.visible:"function"!==i||t.visible({instance:e,column:t})},t.getFields=function(e){var i=e.map(function(e){return e=e.filter(function(e){return t.columnIsVisible(e,t.gridInstance)})}),n=t.getColumnFields(i);return n.length?n[n.length-1]:n},t.getFilterEnumOptions=function(t){var e=null;if(t.filter.type===E["enum"]){var i=t.formatter;i?e=i.options:t.filter.options&&(e=t.filter.options)}return e},t.getEnumText=function(t,e){if(!t)return"";var i=t.valueField,n=t.textField,r=t.data,o="";return e&&(o+=" "+e.map(function(t){return r.find(function(e){return e[i]===t})[n]}).join(",")),o},t.columnVisibleAsObservable=function(t){return"function"==typeof t.visible?n.bindCallback(t.visible)():n.of(t.visible)},t.getParentColumns=function(t,e){var i=[],n=function(t){if(t&&t.parentId){var r=e.find(function(e){return e.id===t.parentId});i.push(r),n(r)}};return n(t),i},t.getChildColumns=function(t,e){var i=[],n=function(t){if(t&&t.parentId){var r=e.filter(function(e){return e.parentId===t.id});i.splice.apply(i,x([0,0],r)),r.forEach(function(t){n(t)})}};return n(t),i},t.checkGroupHeaderColumnVisible=function(e){e.filter(function(t){return!1===t.visible}).map(function(t){return t.field}).forEach(function(i){var n=e.find(function(t){return t.field===i||t.id===i});n&&t.getParentColumns(n,e).forEach(function(t){var i=e.filter(function(e){return e.parentId===t.id&&(e.visible||e.visible===undefined)});t.colspan=i.reduce(function(t,e){return t+=e.colspan||1},0),t.visible=!!t.colspan})})},t.onlyOneColumn=function(){},t.gridInstance=null,t}(),K=function(){function t(t){this.http=t,this.localId="zh-CHS",this.store=new n.BehaviorSubject(null),this.virtualRowSubject=new n.BehaviorSubject(null),this.gridSizeSubject=new n.Subject,this.errorSubject=new n.Subject,this.selectRowSubject=new n.Subject,this.unSelectRowSubject=new n.Subject,this.columnResizeSubject=new n.Subject,this.clearSelectionSubject=new n.Subject,this.checkRowSubject=new n.Subject,this.unCheckRowSubject=new n.Subject,this.clearCheckedsSubject=new n.Subject,this.clearAllSubject=new n.Subject,this.checkAllSubject=new n.Subject,this.unCheckAllSubject=new n.Subject,this.selectAllSubject=new n.Subject,this.selectCellSubject=new n.Subject,this.error$=this.errorSubject.asObservable(),this.selectRow$=this.selectRowSubject.asObservable(),this.unSelectRow$=this.unSelectRowSubject.asObservable(),this.columnResize$=this.columnResizeSubject.asObservable(),this.clearSelections$=this.clearSelectionSubject.asObservable(),this.checkRow$=this.checkRowSubject.asObservable(),this.unCheckRow$=this.unCheckRowSubject.asObservable(),this.clearCheckeds$=this.clearCheckedsSubject.asObservable(),this.clearAll$=this.clearAllSubject.asObservable(),this.checkAll$=this.checkAllSubject.asObservable(),this.unCheckAll$=this.unCheckAllSubject.asObservable(),this.selectAll$=this.selectAllSubject.asObservable(),this.currentCell$=this.selectCellSubject.asObservable(),this.editCell$=new e.EventEmitter,this.clientSort$=new e.EventEmitter,this.rowAppend$=new e.EventEmitter,this.rowUpdate$=new e.EventEmitter,this.rowDelete$=new e.EventEmitter,this.state$=this.store.asObservable().pipe(r.filter(function(t){return t})),this.columnGroup$=this.gridSizeSubject.asObservable().pipe(r.filter(function(t){return t}),r.map(function(t){return t.columnsGroup}),r.switchMap(function(t){return n.of(t)}),r.distinctUntilChanged()),this.gridSize$=this.gridSizeSubject.asObservable().pipe(r.filter(function(t){return t}),r.map(function(t){var e=S({},t);return{headerHeight:e.headerHeight,pagerHeight:e.pagerHeight,width:e.width,columnsGroup:e.columnsGroup,height:e.height,rowHeight:e.rowHeight}}),r.distinctUntilChanged()),this.data$=this.virtualRowSubject.pipe(r.filter(function(t){return t}),r.switchMap(function(t){return n.of({index:t.startIndex||0,rows:t.virtualRows||[],top:t.topHideHeight,bottom:t.bottomHideHeight,scrolling:t.isScrollChange})}),r.distinctUntilChanged()),this.difference=function(t,e){return t.filter(function(t){return!e.includes(t)})},this.differenceBy=function(t,e,i){var n=new Set(e.map(i));return t.map(i).filter(function(t){return!n.has(t)})},this._state=o.cloneDeep(V)}return t.prototype.updateVirthualRows=function(t,e){void 0===e&&(e=!1);var i=this.getVirthualRows(t);i.isScrollChange=e,this.updateState({virtual:i},!1),this.virtualRowSubject.next(i)},t.prototype.getVirthualRows=function(t){var e=this._state.data||[],i={rowIndex:0,virtualRows:e,topHideHeight:0,bottomHideHeight:0};if(0===e.length||this._state.autoHeight&&!this._state.groupRows)return i.virtualRows=e,i;if(this._state.flatColumns&&this._state.flatColumns.length&&this._state.groupRows){var n=this.groupRows2(o.cloneDeep(e));i.virtualRows=n}return this._state.mergeCell&&this._state.enableClientSortForMergeCell&&(i.virtualRows=this.sort(i.virtualRows)),i},t.prototype.getData=function(t){return void 0===t&&(t=!1),t?this._state.originalData||[]:this._state.data||[]},t.prototype.getState=function(){return this._state},t.prototype.getVirtualState=function(){return this._state.virtual},t.prototype.getPageInfo=function(){var t=S({},this._state);return{pageIndex:t.pageIndex,pageSize:t.pageSize}},t.prototype.initState=function(t){this.updateState(t,!1),this._state.originalData=o.cloneDeep(this._state.data),this.initColumns(),this.gridSizeSubject.next(this._state),this.updateVirthualRows(0)},t.prototype.loadData=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=!1),t=t||[],this.updateState({data:t},!1),e&&(this._state.originalData=o.cloneDeep(this._state.data)),i&&this._state.sortName){var n=this.sort(this._state.data);this.updateState({data:n},!1)}this.updateVirthualRows(this._state.virtual.scrollTop||0)},t.prototype.resetRow=function(t){var e=this,i=this._state.originalData;if(i){var n=i.find(function(i){return e.primaryId(i)===t});this.getCurrentRow().data=o.cloneDeep(n),this.updateRow(t,n)}},t.prototype.fetchData=function(t){return this.http.get(t).pipe(r.map(function(t){return t}))},t.prototype.setTotal=function(t){this.updateState({total:t},!1)},t.prototype.updateProperty=function(t,e){var i;this.updateState(((i={})[t]=e,i),!1)},t.prototype.setPagination=function(t,e,i){this.updateState({pageIndex:t,pageSize:e,total:i},!1)},t.prototype.setScrollTop=function(t){var e=S({},this._state.virtual,{scrollTop:t});this.updateState({virtual:e},!1)},t.prototype.isMultiSelect=function(){return this._state.multiSelect},t.prototype._isRowSelected=function(t){return!(!t||!this._state.currentRow)&&this._state.currentRow.id.toString()===t.toString()},t.prototype.isRowSelected=function(t,e){void 0===e&&(e=null);var i=this._isRowSelected(t);return!this.isMultiSelect()||this._state.onlySelectSelf?i:(e||(e=this._state.selections),this._canCancelSelectWhenMulti()?i:!(!e||0===e.length)&&e.findIndex(function(e){return e.id==t})>-1)},t.prototype.isRowChecked=function(t,e){return void 0===e&&(e=null),e||(e=this.getCheckeds()),!(!t||!e.length)&&e.findIndex(function(e){return e.id.toString()===t.toString()})>-1},t.prototype.isCheckAll=function(){var t=this,e=this.getAllRowsForLive().map(function(e){return t.primaryId(e)}),i=this._state.checkedRows.map(function(t){return t.id});return!this.difference(e,i).length},t.prototype.getCurrentPageCheckeds=function(){var t=this,e=this.getAllRowsForLive().map(function(e){return t.primaryId(e)});return this._state.checkedRows.filter(function(t){return e.indexOf(t.id)>-1})},t.prototype.getCurrentRow=function(){return this._state.currentRow||undefined},t.prototype.getSelections=function(){var t=this,e=this._state.data;if(this._state.selections&&this._state.selections.length)if(e&&e.length){var i=e.map(function(e){return t.primaryId(e)});this._state.selections=this._state.selections.filter(function(t){return i.includes(t.id)})}else this._state.selections=[];return this._state.selections||[]},t.prototype.getCheckedRowsFromSource=function(){var t=this;return(this._state.checkedRows||[]).map(function(e){var i=t.findRow(e.id);return i&&i.data&&(e.data=i.data),e})},t.prototype.getCheckeds=function(t){return void 0===t&&(t=!1),t&&(this._state.checkedRows=this.getCheckedRowsFromSource()),this._state.checkedRows||[]},t.prototype.updateCheckedData=function(t,e){var i=this,n=this.getCheckeds();if(n.length){var r=n.find(function(e){return i.primaryId(e)==t});r&&Object.keys(e).forEach(function(t){U.setValue(t,e[t],r.data)})}},t.prototype.setCheckedRows=function(t,e){var i=this;if(void 0===e&&(e=!0),t&&t.length){var n=this._state.checkedRows||[];t.forEach(function(t){var r=i.findRow(t);if(e&&r){if(!i.isRowChecked(t,n)){var o={id:i.primaryId(r.data),data:r.data,index:r.index};n.push(o)}}else i._state.enableMorePageSelect&&e||(n=n.filter(function(e){return e.id!==t}))}),this._state.checkedRows=n}else this._clearCheckeds()},t.prototype.checkRecord=function(t,e){if(void 0===e&&(e=!0),t){var i=this.findRow(t);if(i){var n=S({},i),r=n.index,o=n.data;e?this.checkRow(r,o):this.unCheckRow(r,o)}else this.errorSubject.next("未找到ID为"+t+"的数据。")}else this.errorSubject.next("参数id 不能为空。")},t.prototype.checkRow=function(t,e){this._state.multiSelect||this._clearCheckeds();var i=this.primaryId(e),n=this._state.checkedRows||[];if(i&&!this.isRowChecked(i,n)){var r={id:i,data:e,index:t};n.push(r),this._state.checkedRows=n,this._state.selectOnCheck&&this.selectRow(t,e),this.checkRowSubject.next(r)}},t.prototype.unCheckRow=function(t,e){var i=this.primaryId(e),n=this._state.checkedRows||[];if(this.isRowChecked(i,n)){var r={id:i,data:e,index:t};n=n.filter(function(t){return""+t.id!=""+i}),this._state.checkedRows=n,this._state.selectOnCheck&&this.unSelectRow(t,e),this.unCheckRowSubject.next(r)}},t.prototype.setCurrentPageData=function(t){this._state.currentPageData=t},t.prototype.getCurrentPageData=function(){return this._state.currentPageData||[]},t.prototype.getAllRowsForLive=function(){var t=this,e=this._state.data||[];return this._state.pagination&&!this._state.pagerOnServer&&(e=this.getCurrentPageData()),this._state.disableRow&&(e=e.filter(function(e,i){return!t._state.disableRow(e,i)})),e},t.prototype.checkAll=function(){var t=this;this._state.checkedRows=this._state.checkedRows||[];var e=this.getAllRowsForLive(),i=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}});if(this._state.checkedRows.length){var n=[];i.forEach(function(e){t._state.checkedRows.find(function(t){return t.id==e.id})||n.push(e)}),this._state.checkedRows=this._state.checkedRows.concat(n)}else this._state.checkedRows=i;this._state.selectOnCheck&&!this._state.onlySelectSelf&&(this._state.selections=[],this._state.selections=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}})),this.checkAllSubject.next(this._state.checkedRows)},t.prototype.selectAll=function(){var t=this;this._state.selections=[];var e=this.getAllRowsForLive();this._state.selections=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}}),this._state.checkOnSelect&&(this._state.checkedRows=[],this._state.checkedRows=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}})),this.selectAllSubject.next(this._state.selections)},t.prototype.findRow=function(t){var e=this;if(this._state.data&&this._state.data.length){var i=-1,n=this._state.data.find(function(n,r){var o=e.primaryId(n)==t;return o&&(i=r),o});return-1===i?null:{index:i,data:n}}return null},t.prototype.findRowIndex=function(t){var e=this;return this._state.data&&this._state.data.length?this._state.data.findIndex(function(i){return e.primaryId(i)===t}):-1},t.prototype.setSelectRow=function(t,e){void 0===e&&(e=!0);var i=this.findRow(t),n=S({},i),r=n.index,o={id:t,data:n.data,index:r};this.isMultiSelect()&&(e?this.selectRowForMulti(o,!1):this.unSelectRowForMulti(o,!1));var s=e?o:null;this.updateState({currentRow:s},!1)},t.prototype.selectRecord=function(t,e){if(void 0===e&&(e=!0),t){var i=this.findRow(t);if(i){var n=S({},i),r=n.index,o=n.data;e?this.selectRow(r,o):this.unSelectRow(r,o)}else this.errorSubject.next("未找到ID为"+t+"的数据。")}else this.errorSubject.next("参数id 不能为空。")},t.prototype.selectRow=function(t,e){var i=this.isMultiSelect(),n=this.primaryId(e),r={id:n,data:e,index:t};this.isRowSelected(n)&&this._state.currentRow||(i?this.selectRowForMulti(r):(this.updateState({currentRow:r},!1),this.selectRowSubject.next(this._state.currentRow),this._state.showCheckbox&&this._state.checkOnSelect&&(this._state.checkedRows=[r],this.checkRowSubject.next(r))))},t.prototype.selectRowForMulti=function(t,e){void 0===e&&(e=!0),this._state.onlySelectSelf?(this._clearSelections(),this.updateState({currentRow:t,selections:[t]},!1)):(this._state.selections=this._state.selections||[],this._state.selections=this._state.selections.filter(function(e){return e.id!==t.id}),this._state.selections.push(t)),e&&this.selectRowSubject.next(t),this._state.checkOnSelect&&this.checkRow(t.index,t.data)},t.prototype.unSelectRowForMulti=function(t,e){void 0===e&&(e=!0),this._state.selections=this._state.selections.filter(function(e){return e.id!==t.id}),(this._canCancelSelectWhenMulti()||this._state.currentRow&&this._state.currentRow.id===t.id)&&this.updateState({currentRow:null}),this._state.checkOnSelect&&this.unCheckRow(t.index,t.data),e&&this.unSelectRowSubject.next(t)},t.prototype.unSelectRow=function(t,e){var i={id:this.primaryId(e),index:t,data:e};this.isMultiSelect()?this.unSelectRowForMulti(i):this._state.currentRow&&(this.updateState({currentRow:null}),this.unSelectRowSubject.next(i),this._state.showCheckbox&&this.unCheckRow(i.index,i.data))},t.prototype._canCancelSelectWhenMulti=function(){return!this._state.keepSelect&&this._state.onlySelectSelf},t.prototype._clearSelections=function(t){this._state.currentRow=null,t&&t.length?this._state.selections=this._state.selections.filter(function(e){return t.findIndex(function(t){return t==e.id})>-1}):this._state.selections=[]},t.prototype._clearCheckeds=function(t){var e=this;void 0===t&&(t=[]),t.length?this._state.checkedRows=this._state.checkedRows.filter(function(i){return-1==t.findIndex(function(t){return e.primaryId(t)===i.id})}):this._state.checkedRows=[]},t.prototype.clearSelections=function(t){var e=this._state.selections;t=t||[],this._clearSelections(t);var i=e.filter(function(e){return-1==t.findIndex(function(t){return t==e.id})});(this._state.checkOnSelect||!this._state.multiSelect&&this._state.showCheckbox)&&(this._state.checkedRows=this._state.checkedRows.filter(function(i){return!e.find(function(e){return e.id==i.id&&-1==t.findIndex(function(t){return t==i.id})})}),this.clearCheckedsSubject.next(i)),this.clearSelectionSubject.next(i)},t.prototype.clearCheckeds=function(t){void 0===t&&(t=!0);var e=this.getAllRowsForLive(),i=t?[]:e;this._clearCheckeds(i),this._state.selectOnCheck&&this._clearSelections(),this.clearCheckedsSubject.next(e)},t.prototype.clearAll=function(){this._clearCheckeds(),this._clearSelections(),this.clearAllSubject.next()},t.prototype.setMultiSelect=function(t){this._state.multiSelect=t},t.prototype.setCheckOnSelect=function(t){this._state.checkOnSelect=t},t.prototype.setSelectOnCheck=function(t){this._state.selectOnCheck=t},t.prototype.setCurrentCell=function(t,e,i,n){var r=S({},t),o=r.rowIndex,s=r.rowData,l=S({},this._state.currentCell,{rowIndex:o,rowData:s,field:e,rowId:this.primaryId(s),cellElement:i});if(e!==this._state.ControlPanelFeild){n&&(l.cellRef=n),e&&(l.column=this.getColumn(e));var a=o===this.getData().length-1;l.lastRow=a}else l=null;this.updateState({currentCell:l},!1),this.selectRow(o,s),this._state.currentRow&&(this._state.currentRow.dr=t),this.selectCellSubject.next(l)},t.prototype.cancelSelectCell=function(){this._state.currentCell&&(this.updateState({currentCell:null},!1),this.selectCellSubject.next(null))},t.prototype.primaryId=function(t){return t[this._state.idField]},t.prototype.getCurrentCell=function(){return this._state.currentCell},t.prototype.editCell=function(){if(this._state.currentCell&&!this._state.currentCell.isEditing){var t=S({},this._state.currentCell,{isEditing:!0});this.updateState({currentCell:t},!1),this.selectCellSubject.next(t)}},t.prototype.endEditCell=function(){if(this._state.currentCell&&this._state.currentCell.isEditing){var t=S({},this._state.currentCell,{isEditing:!1});this.updateState({currentCell:t},!1),this.selectCellSubject.next(t)}},t.prototype.appendRow=function(t){if(!t||!this.primaryId(t))throw new Error("主键标识字段不能为空。");var e=this.primaryId(t);if(-1!==this.findRowIndex(e))throw new Error("主键ID 已存在！ID: "+e);this._state.data.push(t);var i=x(this._state.data);this.updateState({data:i},!1),this._state.originalData=o.cloneDeep(this._state.data),this.refresh(),this.rowAppend$.emit(t)},t.prototype.updateRow=function(t,e){var i=this.findRow(t);i&&i.data?e&&(Object.keys(e).forEach(function(t){U.setValue(t,e[t],i.data)}),this.updateCheckedData(t,e),this.rowUpdate$.emit(i)):console.log("Can not found rowid: "+t)},t.prototype.deleteRow=function(t){var e=this.findRow(t);if(e){var i=this.removeRow(this._state.data,t);return this.updateState({data:i},!1),this._state.originalData=o.cloneDeep(this._state.data),this.refresh(),this.rowDelete$.emit(t),e}console.log("Can not found row by ID:"+t)},t.prototype.removeRow=function(t,e){var i=this;return t.filter(function(t){var n=i.primaryId(t);return e!==n})},t.prototype.isCellSelected=function(t){var e=this.getCurrentCell();return!!e&&(this._state.currentRow.index===e.rowIndex&&e.field===t.field)},t.prototype.updateState=function(t,e){void 0===e&&(e=!0);var i=S({},this._state,t);this._state=i,e&&this.store.next(this._state)},t.prototype.resize=function(t){t&&this.updateState(t,!1),this.resetColumnsSize(),this._state.groupRows||this.updateVirthualRows(this._state.virtual.scrollTop)},t.prototype.fitColumns=function(t){this.updateState({fitColumns:t},!1),this.resetColumnsSize()},t.prototype.useUserSetColumnSize=function(){if(this._state.autoFitColumns){var t=this._state.width;return this._state.columnsGroup.originalTotalWidth>t}return!1},t.prototype.resetColumnsSize=function(){if(this._state.fitColumns){var t=this.useUserSetColumnSize();this.setFitColumnsWidth(this._state.columnsGroup,t,t)}this.gridSizeSubject.next(this._state)},t.prototype.updateColumns=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),this._state.columns=t,this.initColumns(i,e),this.resizeColumns(e)},t.prototype.initColumns=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this._state.flatColumns,n={leftFixed:[],rightFixed:[],normalColumns:[]};if(i&&i.length){var r=this.getFixedCols("left"),o=this.getFixedCols("right"),s=this.getFixedCols();i.forEach(function(t){t.originalWidth||(t.originalWidth=t.width)}),n={leftFixed:r,rightFixed:o,normalColumns:s},this.initColumnsWidth(n,e),this._state.fitColumns&&this.setFitColumnsWidth(n,!0),this.updateState({columnsGroup:n},t)}else n.leftFixedWidth=0,n.rightFixedWidth=0,n.normalWidth=0,n.totalWidth=0,this.updateState({columnsGroup:n},t)},t.prototype.getColumnIndex=function(t,e){void 0===e&&(e="");var i=this._state.columnsGroup;return e?"left"===e?i.leftFixed.findIndex(function(e){return e.field===t}):"right"===e?i.rightFixed.findIndex(function(e){return e.field===t}):void 0:i.normalColumns.findIndex(function(e){return e.field===t})},t.prototype.columnResizeEnd=function(){this.resizeColumns()},t.prototype.resizeColumns=function(t){void 0===t&&(t=!1);var e=this._state.columnsGroup;if(this.initColumnsWidth(e,t),this._state.fitColumns){var i=this.useUserSetColumnSize();i?this.setFitColumnsWidth(e,t,i):this.setFitColumnsWidth(e,t)}this.updateState({columnsGroup:S({},e)},!1),this.gridSizeSubject.next(this._state)},t.prototype.getAllFlatColumns=function(){return o.flatten(this._state.columns)},t.prototype.getColumn=function(t){return this.getAllFlatColumns().find(function(e){return e.field===t})},t.prototype.setFitColumnsWidth=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),t&&(t.normalWidth=this._state.width-t.leftFixedWidth-t.rightFixedWidth,t.normalWidth&&!(t.normalWidth<0)))if(i)t.totalWidth=t.originalTotalWidth,e&&t.normalColumns.forEach(function(t){t.width=t.originalWidth}),t.normalWidth=t.normalColumns.reduce(function(t,i){return!e&&i.width?t+i.width:t+i.originalWidth},0),t.totalWidth=t.leftFixedWidth+t.rightFixedWidth+t.normalWidth;else{var n=t.normalColumns.reduce(function(t,i){return e?t+i.originalWidth:t+i.width},0);t.normalWidth=t.normalWidth-2,t.normalColumns.forEach(function(i){i.width=e?Number((i.originalWidth/n*t.normalWidth).toFixed(2)):Number((i.width/n*t.normalWidth).toFixed(2))}),t.totalWidth=t.leftFixedWidth+t.rightFixedWidth+t.normalWidth}},t.prototype.getFixedCols=function(t){void 0===t&&(t="");var e=[];if(e=t?this._state.flatColumns.filter(function(e){return e.fixed===t}):this._state.flatColumns.filter(function(t){return!t.fixed}),this._state.columns.length>1&&e.length){var i=Y.getFields(this._state.columns),n=[];return i.forEach(function(t){var i=e.find(function(e){return(e.field||"")===t});i&&n.push(i)}),n}return e},t.prototype.initColumnsWidth=function(t,e){void 0===e&&(e=!1);var i=0;i=this._state.showLineNumber?i+this._state.lineNumberWidth:i,i=this._state.showCheckbox?i+this._state.checkboxColumnWidth:i;var n=function(t,e,i){return t.reduce(function(t,e){return e.left=t,i?t+e.originalWidth:t+e.width},e)};t.leftFixedWidth=i,t.leftFixed&&t.leftFixed.length&&(t.leftFixedWidth=n(t.leftFixed,i,e)),t.rightFixedWidth=0,t.rightFixed&&t.rightFixed.length&&(t.rightFixedWidth=n(t.rightFixed,0,e)),t.normalWidth=0,this._state.columns&&this._state.columns.length&&(t.normalWidth=n(t.normalColumns,0,e),t.originalTotalWidth=n(t.normalColumns,0,!0)),t.totalWidth=t.leftFixedWidth+t.rightFixedWidth+t.normalWidth},t.prototype.showCheckbox=function(t){void 0===t&&(t=!0);var e=this._state.columnsGroup;this.updateState({showCheckbox:t},!1),e.leftFixedWidth=t?e.leftFixedWidth+this._state.checkboxColumnWidth:e.leftFixedWidth-this._state.checkboxColumnWidth,this.columnResizeSubject.next(e)},t.prototype.hideCheckbox=function(){this.showCheckbox(!1)},t.prototype.showLineNumber=function(t){void 0===t&&(t=!0);var e=this._state.columnsGroup;this.updateState({showLineNumber:t},!1),e.leftFixedWidth=t?e.leftFixedWidth+this._state.lineNumberWidth:e.leftFixedWidth-this._state.lineNumberWidth,this.columnResizeSubject.next(e)},t.prototype.hideLineNumber=function(){this.showLineNumber(!1)},t.prototype.setSortInfo=function(t,e){e=e||"";var i=(t=t||"").split(","),n=e.split(","),r=this._state.columnsGroup,o=function(t){t&&t.length&&t.forEach(function(t){t.order=undefined;var e=i.findIndex(function(e){return e===t.field});e>-1&&(t.order=n[e])})};o(r.normalColumns),o(r.leftFixed),o(r.rightFixed),this.updateState({sortName:t,sortOrder:e},!1)},t.prototype.orderBy=function(t,e,i){var n=this,r=e.reduce(function(t,e){return t[e]=n.getColumn(e),t},{});return x(t).sort(function(t,o){return e.reduce(function(e,s,l){if(0===e){var a=U.getValue(s,t),c=U.getValue(s,o);r[s]&&r[s].isMultilingualField&&(a=U.getMultilingualValue(a,n.localId),c=U.getMultilingualValue(c,n.localId)),a!==undefined&&null!==a||(a=""),c!==undefined&&null!==c||(c="");var d=R(i&&"desc"===i[l]?[c,a]:[a,c],2),h=d[0],u=d[1];e="string"==typeof h?h.localeCompare(u):h>u?1:h<u?-1:0}return e},0)})},t.prototype.sort=function(t){var e=this._state.sortOrder.split(","),i=this._state.sortName.split(",");if(this._state.mergeCell&&this._state.mergeFields&&this._state.mergeFields.length){var n=[],r=x(this._state.mergeFields);return i.forEach(function(t,i){var o=r.indexOf(t);-1==o&&(r.push(t),o=r.length-1),n[o]=e[i]}),this.orderBy(t,r,n)}return this.orderBy(t,i,e)},t.prototype.clientSort=function(t){if(this._state.sortName){t&&this.updateState({data:t},!1);var e=this.sort(this._state.data);this.loadData(e,!1)}else this.clearSort();this.clientSort$.emit({sortName:this._state.sortName,sortOrder:this._state.sortOrder})},t.prototype.clearSort=function(){this.loadData(this._state.originalData,!1)},t.prototype.loadFilterData=function(t){this.loadData(t,!1)},t.prototype.hasRowChanges=function(t){var e=this._state.changes;return!!e&&e[t]},t.prototype.appendChanges=function(t){if(t){var e=t[this._state.idField];if(e){var i=""+e;this.hasRowChanges(i)?this._state.changes[i]=Object.assign(this._state.changes[i],t):(this._state.changes=this._state.changes||{},this._state.changes[i]=t)}}},t.prototype.acceptChanges=function(){var t=this,e=this._state.changes;e&&(Object.keys(e).forEach(function(i){t.updateRow(i,e[i])}),this._state.originalData=o.cloneDeep(this._state.data))},t.prototype.rejectChanges=function(t){var e=this;if(void 0===t&&(t=null),this._state.changes){if(t){if(this._state.changes[""+t]){var i=this._state.originalData.find(function(i){return e.primaryId(i)===t});this._state.data.forEach(function(n){e.primaryId(n)===t&&(n=o.cloneDeep(i))})}}else this._state.data=o.cloneDeep(this._state.originalData),this._state.changes=null;this.refresh()}},t.prototype.getChanges=function(){return this._state.changes},t.prototype.refresh=function(){var t=o.cloneDeep(this._state.data);this.loadData(t)},t.prototype.getFooterData=function(t){var e=this;if(this._state.showFooter){var i=o.flatten(this._state.columns).filter(function(t){return!t.colspan}),n={};return i.forEach(function(i){if(i.footer&&i.footer.options){var r=i.footer.options,o=r.text,s=r.calculationType;if(s!==undefined&&-1!=s){var l=e.calculation(t,s,i);n[i.field]=l}else n[i.field]=o||""}else n[i.field]=""}),[n]}return[]},t.prototype.arrToGroup=function(t,e){if(e.length){var i=e.shift(),n=o.groupBy(t,function(t){return U.getValue(i,t)});return this.toGroup(n,e),n}},t.prototype.toGroup=function(t,e){var i=this;e.length&&Object.keys(t).forEach(function(n){var r=t[n],s=e.map(function(t){return t}),l=s.shift();t[n]=o.groupBy(r,function(t){return U.getValue(l,t)}),s.length&&i.toGroup(t[n],s)})},t.prototype.groupRows2Flat=function(t,e,i){var n=this,r=[];e===undefined&&(e=0);var s=this._state.idField,l=(this._state.flatColumns,this._state.data),a=this._state.groupField.split(","),c=i?i[s]:null,d=this._state.columnsGroup.normalColumns.length;return Object.keys(t).forEach(function(h,u){var p,g,f=((p={})[s]=U.uuid(),p[W]=!0,p[X]=e,p.data={},p.value=h,p[q]=!0,p.expanded=!0,p.field=a[e],p.colspan=d,p.total=0,p.rows=[],p[B]=c,p);f.rows=i?i.rows.filter(function(t){return!t[W]&&!t[$]&&U.getValue(a[e],t)===h}):l.filter(function(t){return""+U.getValue(a[e],t)===h}),i&&i.rows.push(f),f.total=f.rows.filter(function(t){return!t[W]&&!t[$]}).length,r.push(f);var m=t[h];if(o.isPlainObject(m)){var y=e+1;r=r.concat(n.groupRows2Flat(m,y,f))}else f.total=m.length,m.map(function(t){return t[B]=f[s],t[q]=!0,t[X]=f[X]+1,t}),f.rows=m,r=r.concat(m);if(n._state.groupFooter){var w=((g={})[$]=!0,g[B]=f[s],g[q]=!0,g[X]=e,g.data={},g);f.rows.push(w),r.push(w)}}),r},t.prototype.updateGroupFooterData=function(t,e,i){var n=this;e.forEach(function(e){if(e.groupFooter&&e.groupFooter.options){var r=e.groupFooter.options,o=r.text,s=r.calculationType;if(s!==undefined&&-1!=s){var l=n.calculation(i,s,e);t.data[e.field]=l}else t.data[e.field]=o||""}else t.data[e.field]=""})},t.prototype.groupRows2=function(t){var e=this;if(t&&t.length){var i=this._state.flatColumns,n=this._state.groupField||"";if(!n)return t;var r=this.arrToGroup(t,n.split(",")),o=this.groupRows2Flat(r,0,null),s=0;return o.map(function(t,n){if(t[W]||t[$]||(t[N]=s,s++),t[$]){var r=(l=t[B],o.find(function(t){return t[e._state.idField]===l})).rows.filter(function(t){return!t[W]&&!t[$]});e.updateGroupFooterData(t,i,r)}var l;return t}),o}return[]},t.prototype.showGroupFooter=function(t){this.updateState({groupFooter:t},!1),this.updateVirthualRows(0)},t.prototype.updateGroupFooter=function(t){var e=this,i=this._state.virtual.virtualRows.find(function(e){return e.id===t});if(i){var n=i.rows,r=n.filter(function(t){return t.__group_footer__}),o=this._state.flatColumns,s=n.filter(function(t){return!t.__group_footer__});r.forEach(function(t){e.updateGroupFooterData(t,o,s)})}},t.prototype.calculation=function(t,e,i){var n="";if(!t||!t.length)return"";var r=i.field,o=t.map(function(t){return U.getValue(r,t)||0});switch(e){case I.sum:n=s.BigNumber.sum.apply(null,o).toFixed();break;case I.max:n=s.BigNumber.max.apply(null,o).toFixed();break;case I.min:n=s.BigNumber.min.apply(null,o).toFixed();break;case I.average:n=s.BigNumber.sum.apply(null,o).div(o.length).toFixed();break;case I.count:n=t.length}return n},t.prototype.setinitialOptions=function(t){this._state.initialOptions={},this._state.initialOptions.groupField=t.groupField,this._state.initialOptions.sort={sortName:t.sortName,sortOrder:t.sortOrder},t.columns&&t.columns[0]&&(this._state.initialOptions.columnFields=t.columns[0].map(function(t){return{width:t.width||100,field:t.field,halign:t.halign,align:t.align,visible:t.visible,footer:o.cloneDeep(t.footer||{}),groupFooter:o.cloneDeep(t.groupFooter||{})}}))},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient}]},t}(),Z=function(){function t(){this.scorllSubject=new n.Subject,this.scrollX=new n.BehaviorSubject(0),this.rowHoverSubject=new n.Subject,this.rowSelectSubject=new n.Subject,this.dataSourceChangedSubject=new n.Subject,this.editCellSubject=new n.Subject,this.selectCellSubject=new n.Subject,this.endCellEdit=new n.Subject,this.changeCheckedRows=new n.Subject,this.scorll$=this.scorllSubject.asObservable(),this.scrollX$=this.scorll$.pipe(r.filter(function(t){return"psScrollX"===t.type}),r.map(function(t){return t.x}),r.debounceTime(50)),this.scrollY$=this.scorll$.pipe(r.filter(function(t){return"psScrollY"===t.type}),r.map(function(t){return t.x}),r.debounceTime(50)),this.rowHover$=this.rowHoverSubject.asObservable(),this.rowClick$=this.rowSelectSubject.asObservable(),this.onDataSourceChange=this.dataSourceChangedSubject.asObservable(),this.cellEdit$=this.editCellSubject.asObservable(),this.endCellEdit$=this.endCellEdit.asObservable(),this.checkedRowsTotalChanged$=this.changeCheckedRows.asObservable(),this.updateEmptyStyle$=new e.EventEmitter,this.showGridHeader=new e.EventEmitter,this.uncheckAll=new e.EventEmitter,this.checkAll=new e.EventEmitter,this.columnResized=new e.EventEmitter,this.rowHeightChanged=new e.EventEmitter,this.loadVirtualData=new e.EventEmitter,this.showFixedShadow=new e.EventEmitter,this.setSelecedRow=new e.EventEmitter,this.setCheckedRows=new e.EventEmitter,this.scrollToCurrentRow=new e.EventEmitter,this.columnsChanged=new e.EventEmitter,this.cellContentWrapChanged=new e.EventEmitter,this.onFilterChanged=new e.EventEmitter,this.clearFilter=new e.EventEmitter,this.filterTextChange=new e.EventEmitter,this.toggleFilterRow=new e.EventEmitter,this.refreshFooterData=new e.EventEmitter,this.disableHeader=new e.EventEmitter,this.changeCheckAllStatus=new e.EventEmitter,this.setScrollbarPosition=new e.EventEmitter,this.smartFilterBarExpand=new e.EventEmitter,this.smartFilterDataChange=new e.EventEmitter,this.scrollbarUpdate=new e.EventEmitter,this.footerPositionChanged=new e.EventEmitter,this.styleElement=null,this.commonUtils=null,this.idService=null,this.cellEditorCreated=new e.EventEmitter,this.cellEditorDestory=new e.EventEmitter,this.focusRowChanged=new e.EventEmitter,this.groupBy=function(t,e){return t.map("function"==typeof e?e:function(t){return U.getValue(e,t)}).reduce(function(e,i,n){return e[i]=(e[i]||[]).concat(t[n]),e},{})}}return t.prototype.onScrollMove=function(t,e){this.scorllSubject.next({x:t,type:e})},t.prototype.dataSourceChanged=function(){this.dataSourceChangedSubject.next()},t.prototype.onRowHover=function(t,e,i){this.rowHoverSubject.next({index:t,data:e,mouseenter:i})},t.prototype.onRowClick=function(t,e){this.rowSelectSubject.next({index:t,data:e})},t.prototype.onCellEdit=function(t){this.editCellSubject.next(t)},t.prototype.onEndCellEdit=function(t){this.endCellEdit.next(t)},t.prototype.onSelectCell=function(t){this.selectCellSubject.next(t)},t.prototype.onCheckedRowsCountChange=function(){this.changeCheckedRows.next()},t.prototype.onRowHeightChange=function(t){this.rowHeightChanged.emit(t)},t.prototype.onLoadVirtualData=function(t){this.loadVirtualData.emit({data:t})},t.prototype.onClearFilter=function(){this.clearFilter.emit(),this.filterTextChange.emit("")},t.prototype.onFilterTextChange=function(t){this.filterTextChange.emit(t)},t.prototype.restoreScrollbarPosition=function(){this.setScrollbarPosition.emit()},t.prototype.updateEmptyStyle=function(){this.updateEmptyStyle$.emit()},t.prototype.getMergeCellInfo=function(t,e){var i,n={},r=null;return e.forEach(function(e,o){0===o&&t.forEach(function(t,o){var s,l=((s={})[e]={show:!0,rowspan:1},s);n[o]?n[o][e]||(n[o]=Object.assign(n[o],l)):n[o]=l;var a=n[o];if(i=t[e],null===r||r!==i)r=i,a[e].show=!0,a[e].startIndex=o;else{var c=n[o-1][e].startIndex;a[e].startIndex=c,a[e].show=!1,n[c][e].rowspan++}})}),n},t.prototype.getMergeCellInfo0=function(t,e){var i,n,r={};return t.forEach(function(t,o){var s,l=((s={})[e]={show:!0,rowspan:1,value:""},s);r[o]||(r[o]=l);var a=r[o];if(n=U.getValue(e,t),a[e].value=n,i===undefined||i!==n)i=n,a[e].show=!0,a[e].startIndex=o;else{var c=r[o-1][e].startIndex;a[e].startIndex=c,a[e].show=!1,r[c][e].rowspan++}}),r},t.prototype.getMergeCellInfo2=function(t,e){var i={},n=null;i=this.getMergeCellInfo0(t,e.splice(0,1)[0]);var r=this.groupBy(t,e[0]),o=Object.keys(r),s=0;return e.forEach(function(t,e){o.forEach(function(e,o){var l;r[e].forEach(function(e,r){var o;i[s]&&!i[s][t]&&(i[s]=Object.assign(i[s],((o={})[t]={show:!0,rowspan:1,value:""},o)));var a=i[s];if(l=U.getValue(t,e),a[t].value=l,null===n||n!==l)n=l,a[t].show=!0,a[t].startIndex=s;else{var c=i[s-1][t].startIndex;a[t].startIndex=c,a[t].show=!1,i[c][t].rowspan++}s++})})}),i},t.prototype.getMergeCellInfo3=function(t,e){var i={},n=e.splice(0,1)[0];i=this.getMergeCellInfo0(t,n);return e.forEach(function(n,r){var o,s,l=0;r>0&&e[r-1],t.forEach(function(e,r){var a;i[l]&&!i[l][n]&&(i[l]=Object.assign(i[l],((a={})[n]={show:!0,rowspan:1,value:""},a)));var c=i[l];if(s=U.getValue(n,e),c[n].value=s,l>0){var d=i[l-1];Object.keys(c).map(function(t){return""+c[t].value}).join(",")!==Object.keys(d).map(function(t){return""+d[t].value}).join(",")&&(o=undefined)}if(o===undefined||o!==s)o=s,c[n].show=!0,c[n].startIndex=l;else{var h=i[l-1][n].startIndex;c[n].startIndex=h,c[n].show=!1,i[h][n].rowspan++}t.length-1>l&&l++})}),i},t.prototype.getMergeInfo=function(t,e,i){return e&&i&&i[t]&&i[t][e]?i[t][e]:null},t.prototype.removeStyleSheet=function(){this.styleElement&&this.styleElement.remove()},t.prototype.createStyleElement=function(t){this.styleElement=this._createStyleSheet(t)},t.prototype.appendCssRules=function(t){this._appendCssRules(t,this.styleElement.sheet)},t.prototype.removeCssRule=function(t){var e=this;this.styleElement&&("string"==typeof t?this._removeCssRule(t,this.styleElement.sheet):Array.isArray(t)&&t.forEach(function(t){e._removeCssRule(t,e.styleElement.sheet)}))},t.prototype._createStyleSheet=function(t){var e=document.querySelector("head"),i=t,n=null;return document.querySelector("#"+i)?(n=document.querySelector("#"+i)).innerText="":((n=document.createElement("style")).id=i,n.type="text/css",e.appendChild(n)),n},t.prototype._appendCssRules=function(t,e){var i,n;try{for(var r=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}(t),o=r.next();!o.done;o=r.next()){var s=o.value,l=s.slice(0,s.indexOf("{")).trim(),a=this._removeCssRule(l,e);if(e.addRule){var c="";a&&(c+=a.cssText.slice(a.cssText.indexOf("{")+1,a.cssText.indexOf("}"))),c+=s.slice(s.indexOf("{")+1,s.indexOf("}")).replace(/"/g,"").replace(/,/g,";")+";",e.addRule(l,c,0)}else e.insertRule(s,0)}}catch(d){i={error:d}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(i)throw i.error}}},t.prototype._removeCssRule=function(t,e){if(e){var i=e.cssRules||e.rules,n=0,r=!1;do{if((r=i[n])&&r.selectorText.toLowerCase()==t.toLowerCase())return e.cssRules?e.deleteRule(n):e.removeRule(n),r;n++}while(r)}},t.prototype.createConfigKey=function(t){location.host;var e=location.hash,i=(location.href,location.pathname),n="",r="";if(e){var o=e.split("?");n=o[0];var s={};o[1]&&o[1].split("&").map(function(t){s[t.split("=")[0]]=t.split("=")[1]});var a=""+i;s&&Object.keys(s).length&&(r=s.funcId||"")&&localStorage.setItem(a,r),r||(r=localStorage.getItem(a))}var c=n+"_"+r+"_"+t;return this.idService||(this.idService=new l.IdService),this.idService.encrypt(c)},t.prototype.getCustomStyle=function(t,e){if("object"==typeof t)return t;if("function"==typeof t){var i=e||[];return t.apply(void 0,x(i))}},t.prototype.findNextTr=function(t,e){var i=function(t){return!(!t||-1!=t.className.indexOf("f-datagrid-disable-row"))&&t},n="down"===e?"nextElementSibling":"previousElementSibling";return function(t){for(var e=null,r=!0;r;)if(e=i(t))r=!1;else if(t&&t[n]){if(e=i(t[n]))break}else r=!1;return e}(t)},t}(),Q=new e.InjectionToken("DataGrid Request Data Service."),J=function(){},tt={required:"此字段不能为空。",min:"最小值不能小于${0}",max:"最大值不能大于${0}",minlength:"至少输入${0}个字符",maxlength:"字符长度不能大于${0}",email:"Email 格式不正确",requriedtrue:"务必选中",pattern:"输入的格式不正确。"},et=function(){function t(){}return t.prototype.getValidatorErrorMessage=function(t,e){t=t.toLowerCase();var i=e.find(function(e){return e.type.toLowerCase()===t});return i&&i.messager?i.messager:tt[t]?tt[t]:"验证不通过！"},t.decorators=[{type:e.Injectable}],t}(),it=function(){function t(){}return t.hasClass=function(t,e){return t.classList?Array.from(t.classList).filter(function(t){return t===e}).length>0:t.className.indexOf(e)>-1},t.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},t.findSingle=function(t,e){return t?t.querySelector(e):null},t.getOffset=function(t){var e=t.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}},t.getOuterHeight=function(t,e){var i=t.offsetHeight;if(e){var n=getComputedStyle(t);i+=parseFloat(n.marginTop)+parseFloat(n.marginBottom)}return i},t.getOuterWidth=function(t,e){var i=t.offsetWidth;if(e){var n=getComputedStyle(t);i+=parseFloat(n.marginLeft)+parseFloat(n.marginRight)}return i},t}(),nt=function(){function t(t,i,n){this.dfs=t,this.localeSer=i,this.inject=n,this.removeField=new e.EventEmitter}return t.prototype.validateRowData=function(t,e){return!e||0===Object.keys(e).length||this.checkAllFieldInRowData(t,e)},t.prototype.executeFilter=function(t,e){var i=this;return this.dfs.getState().enableSmartFilter?this.executeSmartFilter(t,e):t&&t.length?t.filter(function(t){return i.validateRowData(t,e)}):t},t.prototype.getCompareResult=function(t,e,i){switch(parseInt(""+e,10)){case c.Compare.Equal:return t==i;case c.Compare.NotEqual:return(""+t).toLowerCase()!==(""+i).toLowerCase();case c.Compare.Greater:return t>i;case c.Compare.GreaterOrEqual:return t>=i;case c.Compare.Less:return t<i;case c.Compare.LessOrEqual:return t<=i;case c.Compare.Like:return(""+t).toLowerCase().indexOf(i.toLowerCase())>-1;case c.Compare.NotLike:return-1===(""+t).toLowerCase().indexOf(i.toLowerCase());case c.Compare.In:return(i=i||[]).findIndex(function(e){return e==t})>-1;case 1001:return""===t;case 1002:return""!==t;case 1003:return null===t;case 1004:return null!==t}},t.prototype.getRelationResult=function(t,e,i){return"and"===e.toLowerCase()?t&&i:t||i},t.prototype.checkAllFieldResult=function(t){return!t||Object.values(t).reduce(function(t,e){return t&&e},!0)},t.prototype.checkAllFieldInRowData=function(t,e){var i=this,n=null;if(e){var r=Object.keys(e);n={},r.forEach(function(r){var o=U.getValue(r,t),s=i.dfs.getColumn(r);s&&s.isMultilingualField&&(o=U.getMultilingualValue(o,i.localeSer.localeId));var l=e[r],a=l.value1,c=l.operator1,d=l.relation,h=l.operator2,u=l.value2;if(l){var p=i.getCompareResult(o,c,a);if(n[r]=p,d){var g=i.getCompareResult(o,h,u);n[r]=i.getRelationResult(p,d,g)}}})}return this.checkAllFieldResult(n)},t.prototype.removeFilterField=function(t){this.removeField.emit(t)},t.prototype.convertFilterCondition2String=function(t){var e=this;if(!t)return"";var i="",n=this.localeSer.getValue("datagrid.filter.and"),r=this.localeSer.getValue("datagrid.filter.or"),o="<span class='badge badge-success'>"+n+"</span>",s="<span class='badge badge-info'>"+n+"</span>",l="<span class='badge badge-warning'>"+r+"</span>",a=(i=Object.keys(t).reduce(function(i,n){var r=t[n],o=e.dfs.getColumn(n),a="<b>"+o.title+"</b>",d=" "+a+" "+e.getCompareString(r.operator1)+" "+U.escapeValue(r.value1)+"  ";if(r.operator1==c.Compare.In){var h=r.value1,u=h;if(o.filter.type===E["enum"]){var p=Y.getFilterEnumOptions(o);u=(h=Y.getEnumText(p,r.value1)).split(",").slice(0,2).join(",")}else u=h.slice(0,2).join(",");d=" "+a+" "+e.getCompareString(r.operator1)+" [ "+h+" ]  ",r.value1.length>2&&(d=" "+a+" "+e.getCompareString(r.operator1)+" "+'[ <span class="ellipsis" title="$title$">  $value$<i class="f-icon f-icon-lookup"></i></span> ]'.replace("$title$",h).replace("$value$",u)+"  ")}else r.operator1==c.Compare.Equal&&Array.isArray(r.value1)&&(r.value1.length||(d=" "+a+" "+e.getCompareString(r.operator1)+" ''  "));if(r.relation){var g=a+" "+e.getCompareString(r.operator2)+" "+r.value2;d="<b>〔</b> "+d+" "+("and"===r.relation?s:l)+" "+g+" <b>〕</b>"}return i+' <span class="filter-field filter-column-'+n+'"> '+d+" AND </span>"},"")).lastIndexOf("AND"),d=i.substr(0,a);return(d+=i.substr(a+3)).replace(/AND/g,o).replace(/OR/g,l)},t.prototype.getCompareString=function(t){var e=parseInt(""+t,10),i="";switch(e){case c.Compare.Equal:case c.Compare.NotEqual:case c.Compare.Greater:case c.Compare.GreaterOrEqual:case c.Compare.Less:case c.Compare.LessOrEqual:case c.Compare.Like:case c.Compare.NotLike:case c.Compare.In:return i=(i=c.Compare[e])[0].toLowerCase()+i.substr(1),this.localeSer.getValue("datagrid.filter.operators."+i);case 1001:return" "+this.localeSer.getValue("datagrid.filter.operators.empty");case 1002:return" "+this.localeSer.getValue("datagrid.filter.operators.notEmpty");case 1003:return" "+this.localeSer.getValue("datagrid.filter.operators.null");case 1004:return" "+this.localeSer.getValue("datagrid.filter.operators.notNull")}},t.prototype.convert2FilterArray=function(t){var e=[];if(t){var i=Object.keys(t);i&&i.length&&i.forEach(function(i){var n={filterField:i,value:"",lbracket:"",rbracket:"",relation:1,compare:0},r=t[i];if("object"==typeof r)if(n.compare=r.operator1,n.value=r.value1,e.push(n),r.value2)n.lbracket="(",n.relation="and"===r.relation?1:2,(o={filterField:i,value:"",lbracket:"",rbracket:")",relation:1,compare:0}).compare=r.operator2,o.value=r.value2,e.push(o);else if(r.operator2){var o,s=parseInt(""+r.operator2,10);if(1001===s||1002===s)n.lbracket="(",n.relation="and"===r.relation?1:2,(o={filterField:i,value:"",lbracket:"",rbracket:")",relation:1,compare:0}).compare=1001===s?c.Compare.Equal:c.Compare.NotEqual,o.value="",e.push(o)}return n})}return e.length&&(e[e.length-1].relation=0),e},t.prototype.createColumnFilterOptions=function(t){var e={type:E.string,enableOperator:!0};if(t.editor)switch(t.editor.type){case"textarea":case"textbox":case"language-textbox":e={type:E.string,enableOperator:!0};break;case"checkbox":case"switch":e={type:E.boolean,enableOperator:!1};break;case"numberbox":e={type:E.number,enableOperator:!0};break;case"combolist":case"select":e={type:E["enum"],enableOperator:!0,options:t.editor.options};break;case"datepicker":e={type:"datetime"===t.dataType?E.datetime:E.date,enableOperator:!0,options:{dateFormat:t.editor.options.dateFormat,returnFormat:t.editor.options.returnFormat}};break;case"timepicker":e={type:E.time,enableOperator:!0}}else if(t.formatter){if("object"==typeof t.formatter&&Object.keys(t.formatter).length){var i=t.formatter.options;switch(t.formatter.type){case"number":e={type:E.number,enableOperator:!0};break;case"enum":e={type:E["enum"],enableOperator:!0,options:i};break;case"boolean":e={type:E.boolean,enableOperator:!1};break;case"datetime":var n=E.datetime,r="yyyy-MM-dd",o="yyyy-MM-dd";i&&i.format?-1==(r=i.format).indexOf("HH:")?n=E.date:(o+=" HH:mm",r.indexOf("ss")>-1&&(o+=":ss")):n=E.date,(e={type:n,enableOperator:!0}).options={dateFormat:r,returnFormat:o};break;default:e={type:E.string,enableOperator:!0}}}}else e={type:E.string,enableOperator:!0};return e},t.prototype.convertSmartFilter2EntityFilter=function(t){return t&&t.length?t.map(function(t){return t}):[]},t.prototype.validateRowData2=function(t,e){return!e||0===e.length||this.checkRowDataWithCondition(t,e)},t.prototype.checkRowDataWithCondition=function(t,e){var i=this,n=null;e&&(n={},e.forEach(function(e){var r=e.FilterField,o=U.getValue(r,t),s=i.dfs.getColumn(r);s&&s.isMultilingualField&&(o=U.getMultilingualValue(o,i.localeSer.localeId));var l=e,a=l.Value,c=(l.Relation,l.Compare);if(l){var d=i.getCompareResult(o,c,a);n[r]===undefined?n[r]=[d]:n[r].push(d)}}));var r=Object.keys(n),o=[];return r.forEach(function(t){var i=e.filter(function(e){return e.FilterField===t});1===n[t].length?o.push(n[t][0]):1===i[0].Relation&&2===n[t].length?o.push(n[t][0]&&n[t][1]):o.push(n[t].indexOf(!0)>-1)}),-1===o.indexOf(!1)},t.prototype.executeSmartFilter=function(t,e){var i=this;return t&&t.length?t.filter(function(t){return i.validateRowData2(t,e)}):t},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:K},{type:a.LocaleService},{type:e.Injector}]},t}(),rt=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[],imports:[d.CommonModule],exports:[],providers:[]}]}],t}(),ot=function(){},st=new e.InjectionToken("PERFECT_SCROLLBAR_CONFIG"),lt=function(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n},at=function(t,e){this.x=t,this.y=e},ct=["psScrollY","psScrollX","psScrollUp","psScrollDown","psScrollLeft","psScrollRight","psYReachEnd","psYReachStart","psXReachEnd","psXReachStart"],dt=function(){function t(t){void 0===t&&(t={}),this.assign(t)}return t.prototype.assign=function(t){for(var e in void 0===t&&(t={}),t)this[e]=t[e]},t}(),ht=function(){function t(t,i,r,o,s){this.zone=t,this.differs=i,this.elementRef=r,this.platformId=o,this.defaults=s,this.instance=null,this.ro=null,this.timeout=null,this.animation=null,this.configDiff=null,this.ngDestroy=new n.Subject,this.disabled=!1,this.psScrollY=new e.EventEmitter,this.psScrollX=new e.EventEmitter,this.psScrollUp=new e.EventEmitter,this.psScrollDown=new e.EventEmitter,this.psScrollLeft=new e.EventEmitter,this.psScrollRight=new e.EventEmitter,this.psYReachEnd=new e.EventEmitter,this.psYReachStart=new e.EventEmitter,this.psXReachEnd=new e.EventEmitter,this.psXReachStart=new e.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;if(!this.disabled&&d.isPlatformBrowser(this.platformId)){var e=new dt(this.defaults);e.assign(this.config),this.zone.runOutsideAngular(function(){setTimeout(function(){t.instance=new h(t.elementRef.nativeElement,e)})}),this.configDiff||(this.configDiff=this.differs.find(this.config||{}).create(),this.configDiff.diff(this.config||{})),this.zone.runOutsideAngular(function(){t.ro=new u(function(){t.update()}),t.elementRef.nativeElement.children[0]&&t.ro.observe(t.elementRef.nativeElement.children[0]),t.ro.observe(t.elementRef.nativeElement)}),this.zone.runOutsideAngular(function(){ct.forEach(function(e){var i=e.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()});e.indexOf("X")>-1||e.indexOf("Left")>-1||e.indexOf("Right")>-1?n.fromEvent(t.elementRef.nativeElement,i).subscribe(function(i){t[e].emit(i)}):n.fromEvent(t.elementRef.nativeElement,i).pipe(r.auditTime(20),r.takeUntil(t.ngDestroy)).subscribe(function(i){t[e].emit(i)})})})}},t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnDestroy=function(){var t=this;d.isPlatformBrowser(this.platformId)&&(this.ngDestroy.next(),this.ngDestroy.complete(),this.ro&&this.ro.disconnect(),this.timeout&&"undefined"!=typeof window&&window.clearTimeout(this.timeout),this.zone.runOutsideAngular(function(){t.instance&&t.instance.destroy()}),this.instance=null)},t.prototype.ngDoCheck=function(){!this.disabled&&this.configDiff&&d.isPlatformBrowser(this.platformId)&&(this.configDiff.diff(this.config||{})&&(this.ngOnDestroy(),this.ngOnInit()))},t.prototype.ngOnChanges=function(t){t.disabled&&!t.disabled.isFirstChange()&&d.isPlatformBrowser(this.platformId)&&t.disabled.currentValue!==t.disabled.previousValue&&(!0===t.disabled.currentValue?this.ngOnDestroy():!1===t.disabled.currentValue&&this.ngOnInit())},t.prototype.ps=function(){return this.instance},t.prototype.update=function(){var t=this;"undefined"!=typeof window&&(this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){if(!t.disabled&&t.configDiff)try{t.zone.runOutsideAngular(function(){t.instance&&t.instance.update()})}catch(e){}},0))},t.prototype.geometry=function(t){return void 0===t&&(t="scroll"),new lt(this.elementRef.nativeElement[t+"Left"],this.elementRef.nativeElement[t+"Top"],this.elementRef.nativeElement[t+"Width"],this.elementRef.nativeElement[t+"Height"])},t.prototype.position=function(t){return void 0===t&&(t=!1),!t&&this.instance?new at(this.instance.reach.x||0,this.instance.reach.y||0):new at(this.elementRef.nativeElement.scrollLeft,this.elementRef.nativeElement.scrollTop)},t.prototype.scrollable=function(t){void 0===t&&(t="any");var e=this.elementRef.nativeElement;return"any"===t?e.classList.contains("ps--active-x")||e.classList.contains("ps--active-y"):"both"===t?e.classList.contains("ps--active-x")&&e.classList.contains("ps--active-y"):e.classList.contains("ps--active-"+t)},t.prototype.scrollTo=function(t,e,i){this.disabled||(null==e&&null==i?this.animateScrolling("scrollTop",t,i):(null!=t&&this.animateScrolling("scrollLeft",t,i),null!=e&&this.animateScrolling("scrollTop",e,i)))},t.prototype.scrollToX=function(t,e){this.animateScrolling("scrollLeft",t,e)},t.prototype.scrollToY=function(t,e){this.animateScrolling("scrollTop",t,e)},t.prototype.scrollToTop=function(t,e){this.animateScrolling("scrollTop",t||0,e)},t.prototype.scrollToLeft=function(t,e){this.animateScrolling("scrollLeft",t||0,e)},t.prototype.scrollToRight=function(t,e){var i=this.elementRef.nativeElement.scrollWidth-this.elementRef.nativeElement.clientWidth;this.animateScrolling("scrollLeft",i-(t||0),e)},t.prototype.scrollToBottom=function(t,e){var i=this.elementRef.nativeElement.scrollHeight-this.elementRef.nativeElement.clientHeight;this.animateScrolling("scrollTop",i-(t||0),e)},t.prototype.scrollToElement=function(t,e,i){var n=this.elementRef.nativeElement.querySelector(t);if(n){var r=n.getBoundingClientRect(),o=this.elementRef.nativeElement.getBoundingClientRect();if(this.elementRef.nativeElement.classList.contains("ps--active-x")){var s=this.elementRef.nativeElement.scrollLeft,l=r.left-o.left+s;this.animateScrolling("scrollLeft",l+(e||0),i)}if(this.elementRef.nativeElement.classList.contains("ps--active-y")){s=this.elementRef.nativeElement.scrollTop,l=r.top-o.top+s;this.animateScrolling("scrollTop",l+(e||0),i)}}},t.prototype.animateScrolling=function(t,e,i){var n=this;if(this.animation&&(window.cancelAnimationFrame(this.animation),this.animation=null),i&&"undefined"!=typeof window){if(e!==this.elementRef.nativeElement[t]){var r=0,o=0,s=performance.now(),l=this.elementRef.nativeElement[t],a=(l-e)/2,c=function(d){o+=Math.PI/(i/(d-s)),r=Math.round(e+a+a*Math.cos(o)),n.elementRef.nativeElement[t]===l&&(o>=Math.PI?n.animateScrolling(t,e,0):(n.elementRef.nativeElement[t]=r,l=n.elementRef.nativeElement[t],s=d,n.animation=window.requestAnimationFrame(c)))};window.requestAnimationFrame(c)}}else this.elementRef.nativeElement[t]=e},t.decorators=[{type:e.Directive,args:[{selector:"[scrollbar]",exportAs:"ngxScrollbar"}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.KeyValueDiffers},{type:e.ElementRef},{type:undefined,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]},{type:undefined,decorators:[{type:e.Optional},{type:e.Inject,args:[st]}]}]},t.propDecorators={disabled:[{type:e.Input}],config:[{type:e.Input,args:["scrollbar"]}],psScrollY:[{type:e.Output}],psScrollX:[{type:e.Output}],psScrollUp:[{type:e.Output}],psScrollDown:[{type:e.Output}],psScrollLeft:[{type:e.Output}],psScrollRight:[{type:e.Output}],psYReachEnd:[{type:e.Output}],psYReachStart:[{type:e.Output}],psXReachEnd:[{type:e.Output}],psXReachStart:[{type:e.Output}]},t}(),ut=function(){function t(t,i,r){this.zone=t,this.cdRef=i,this.platformId=r,this.states={},this.indicatorX=!1,this.indicatorY=!1,this.interaction=!1,this.scrollPositionX=0,this.scrollPositionY=0,this.scrollDirectionX=0,this.scrollDirectionY=0,this.usePropagationX=!1,this.usePropagationY=!1,this.allowPropagationX=!1,this.allowPropagationY=!1,this.stateTimeout=null,this.ngDestroy=new n.Subject,this.stateUpdate=new n.Subject,this.disabled=!1,this.usePSClass=!0,this.autoPropagation=!1,this.scrollIndicators=!1,this.psScrollY=new e.EventEmitter,this.psScrollX=new e.EventEmitter,this.psScrollUp=new e.EventEmitter,this.psScrollDown=new e.EventEmitter,this.psScrollLeft=new e.EventEmitter,this.psScrollRight=new e.EventEmitter,this.psYReachEnd=new e.EventEmitter,this.psYReachStart=new e.EventEmitter,this.psXReachEnd=new e.EventEmitter,this.psXReachStart=new e.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;d.isPlatformBrowser(this.platformId)&&(this.stateUpdate.pipe(r.takeUntil(this.ngDestroy),r.distinctUntilChanged(function(e,i){return e===i&&!t.stateTimeout})).subscribe(function(e){t.stateTimeout&&"undefined"!=typeof window&&(window.clearTimeout(t.stateTimeout),t.stateTimeout=null),"x"===e||"y"===e?(t.interaction=!1,"x"===e?(t.indicatorX=!1,t.states.left=!1,t.states.right=!1,t.autoPropagation&&t.usePropagationX&&(t.allowPropagationX=!1)):"y"===e&&(t.indicatorY=!1,t.states.top=!1,t.states.bottom=!1,t.autoPropagation&&t.usePropagationY&&(t.allowPropagationY=!1))):("left"===e||"right"===e?(t.states.left=!1,t.states.right=!1,t.states[e]=!0,t.autoPropagation&&t.usePropagationX&&(t.indicatorX=!0)):"top"!==e&&"bottom"!==e||(t.states.top=!1,t.states.bottom=!1,t.states[e]=!0,t.autoPropagation&&t.usePropagationY&&(t.indicatorY=!0)),t.autoPropagation&&"undefined"!=typeof window&&(t.stateTimeout=window.setTimeout(function(){t.indicatorX=!1,t.indicatorY=!1,t.stateTimeout=null,t.interaction&&(t.states.left||t.states.right)&&(t.allowPropagationX=!0),t.interaction&&(t.states.top||t.states.bottom)&&(t.allowPropagationY=!0),t.cdRef.markForCheck()},500))),t.cdRef.markForCheck(),t.cdRef.detectChanges()}),this.zone.runOutsideAngular(function(){if(t.directiveRef){var e=t.directiveRef.elementRef.nativeElement;n.fromEvent(e,"wheel").pipe(r.takeUntil(t.ngDestroy)).subscribe(function(e){if(!t.disabled&&t.autoPropagation){var i=e.deltaX,n=e.deltaY;t.checkPropagation(e,i,n)}}),n.fromEvent(e,"touchmove").pipe(r.takeUntil(t.ngDestroy)).subscribe(function(e){if(!t.disabled&&t.autoPropagation){var i=e.touches[0].clientX,n=e.touches[0].clientY,r=i-t.scrollPositionX,o=n-t.scrollPositionY;t.checkPropagation(e,r,o),t.scrollPositionX=i,t.scrollPositionY=n}}),n.merge(n.fromEvent(e,"ps-scroll-x").pipe(r.mapTo("x")),n.fromEvent(e,"ps-scroll-y").pipe(r.mapTo("y")),n.fromEvent(e,"ps-x-reach-end").pipe(r.mapTo("right")),n.fromEvent(e,"ps-y-reach-end").pipe(r.mapTo("bottom")),n.fromEvent(e,"ps-x-reach-start").pipe(r.mapTo("left")),n.fromEvent(e,"ps-y-reach-start").pipe(r.mapTo("top"))).pipe(r.takeUntil(t.ngDestroy)).subscribe(function(e){t.disabled||!t.autoPropagation&&!t.scrollIndicators||t.stateUpdate.next(e)})}}),window.setTimeout(function(){ct.forEach(function(e){t.directiveRef&&(t.directiveRef[e]=t[e])})},0))},t.prototype.ngOnDestroy=function(){d.isPlatformBrowser(this.platformId)&&(this.ngDestroy.next(),this.ngDestroy.unsubscribe(),this.stateTimeout&&"undefined"!=typeof window&&window.clearTimeout(this.stateTimeout))},t.prototype.ngDoCheck=function(){if(d.isPlatformBrowser(this.platformId)&&!this.disabled&&this.autoPropagation&&this.directiveRef){var t=this.directiveRef.elementRef.nativeElement;this.usePropagationX=t.classList.contains("ps--active-x"),this.usePropagationY=t.classList.contains("ps--active-y")}},t.prototype.checkPropagation=function(t,e,i){this.interaction=!0;var n=e<0?-1:1,r=i<0?-1:1;(this.usePropagationX&&this.usePropagationY||this.usePropagationX&&(!this.allowPropagationX||this.scrollDirectionX!==n)||this.usePropagationY&&(!this.allowPropagationY||this.scrollDirectionY!==r))&&(t.preventDefault(),t.stopPropagation()),e&&(this.scrollDirectionX=n),i&&(this.scrollDirectionY=r),this.stateUpdate.next("interaction"),this.cdRef.detectChanges()},t.decorators=[{type:e.Component,args:[{selector:"scrollbar",exportAs:"ngxScrollbar",template:'<div style="position: static;" [class.ps]="usePSClass" [scrollbar]="config" [disabled]="disabled">\r\n    <div class="ps-content">\r\n      <ng-content></ng-content>\r\n    </div>\r\n  \r\n    <div *ngIf="scrollIndicators" class="ps-overlay" [class.ps-at-top]="states.top" [class.ps-at-left]="states.left" [class.ps-at-right]="states.right" [class.ps-at-bottom]="states.bottom">\r\n      <div class="ps-indicator-top" [class.ps-indicator-show]="indicatorY && interaction"></div>\r\n      <div class="ps-indicator-left" [class.ps-indicator-show]="indicatorX && interaction"></div>\r\n      <div class="ps-indicator-right" [class.ps-indicator-show]="indicatorX && interaction"></div>\r\n      <div class="ps-indicator-bottom" [class.ps-indicator-show]="indicatorY && interaction"></div>\r\n    </div>\r\n  </div>',encapsulation:e.ViewEncapsulation.None}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.ChangeDetectorRef},{type:undefined,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]},t.propDecorators={disabled:[{type:e.Input}],usePSClass:[{type:e.Input}],autoPropagation:[{type:e.HostBinding,args:["class.ps-show-limits"]},{type:e.Input}],scrollIndicators:[{type:e.HostBinding,args:["class.ps-show-active"]},{type:e.Input}],config:[{type:e.Input}],psScrollY:[{type:e.Output}],psScrollX:[{type:e.Output}],psScrollUp:[{type:e.Output}],psScrollDown:[{type:e.Output}],psScrollLeft:[{type:e.Output}],psScrollRight:[{type:e.Output}],psYReachEnd:[{type:e.Output}],psYReachStart:[{type:e.Output}],psXReachEnd:[{type:e.Output}],psXReachStart:[{type:e.Output}],directiveRef:[{type:e.ViewChild,args:[ht]}]},t}(),pt=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[d.CommonModule],declarations:[ut,ht],exports:[d.CommonModule,ut,ht]}]}],t}(),gt=function(){function t(t){this.template=t}return t.decorators=[{type:e.Directive,args:[{selector:"[grid-cell-editor]"}]}],t.ctorParameters=function(){return[{type:e.TemplateRef}]},t}(),ft=function(){function t(){this.halign="left",this.align="left",this.readonly=!0,this.editable=!1}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterContentInit=function(){console.log(this.editor)},t.decorators=[{type:e.Directive,args:[{selector:"farris-grid-column"}]}],t.ctorParameters=function(){return[]},t.propDecorators={field:[{type:e.Input}],title:[{type:e.Input}],width:[{type:e.Input}],halign:[{type:e.Input}],align:[{type:e.Input}],formatter:[{type:e.Input}],readonly:[{type:e.Input}],editable:[{type:e.Input}],editor:[{type:e.ContentChild,args:[gt]}]},t}(),mt=function(){function t(t,i,n){this.el=t,this.render=i,this.inject=n,this.padding="",this.height=40,this.filterData=[],this.clearFilters=new e.EventEmitter,this.removeFilter=new e.EventEmitter,this.filterChange=new e.EventEmitter,this.resize=new e.EventEmitter,this.sk=""}return t.prototype.ngOnInit=function(){this.dg=this.inject.get(bt),this.sk="smartfilter_"+this.dg.dgs.createConfigKey(this.dg.id)},t.prototype.ngOnChanges=function(t){t.filterData&&t.filterData.isFirstChange()},t.prototype.onQuery=function(t){var e=t.data,i=t.filterItem;if(e&&e.length){var n=JSON.parse(e);n&&n.length&&this.filterChange.emit({conditions:n,filterItem:i})}},t.prototype.onResetFilter=function(t){this.clearFilters.emit(t)},t.prototype.onRemoveFilter=function(t){this.removeFilter.emit(t)},t.prototype.onResize=function(t){var e=this;setTimeout(function(){var t=e.el.nativeElement.querySelector(".f-filter-wrapper");if(t){var i=t.offsetHeight;i&&e.resize.emit(i+6)}})},t.decorators=[{type:e.Component,args:[{selector:"smart-filter-toolbar",template:'<div class="f-datagrid-filter-toolbar" [style.height.px]="height" \r\n[style.padding]="padding" placeholder="此处显示列过滤条件" style="align-items: normal;"\r\n[style.display]="filterData && filterData.length ? \'\' : \'none\'"\r\n[style.pointer-events]="dg?.editable ? \'none\': \'\'"\r\n>\r\n<farris-filter [filterList]="filterData" (query)="onQuery($event)"  #farrisFilter\r\n    (resetChange)="onResetFilter($event)" (clearFilter)="onRemoveFilter($event)"\r\n    (filterResize)="onResize($event)" (expandFilter)="onResize($event)"\r\n    [localStorageKey]="sk"\r\n>\r\n</farris-filter>\r\n\r\n</div>'}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector}]},t.propDecorators={padding:[{type:e.Input}],height:[{type:e.Input}],filterData:[{type:e.Input}],clearFilters:[{type:e.Output}],removeFilter:[{type:e.Output}],filterChange:[{type:e.Output}],resize:[{type:e.Output}],filtebar:[{type:e.ViewChild,args:["farrisFilter"]}]},t}();function yt(t,e){var i=e.valueField||e.idField;return{controltype:"checkboxgroup",enumValues:e.data.map(function(t){return{value:t[i],name:t[e.textField]}})}}var wt=function(){function t(){this.conditions=[],this.controlData=[],this.filterChanged=new n.Subject,this.removeFilter=new n.Subject,this.clearAllFilter=new n.Subject}return t.prototype.getColumnFilterData=function(t){var e={controltype:"text"};if(t.filter!==undefined){if("boolean"==typeof t.filter){if(t.formatter&&"object"==typeof t.formatter&&Object.keys(t.formatter).length){var i=t.formatter.options;switch(t.formatter.type){case"number":return{controltype:"flexibleNumber",single:!1};case"enum":return yt(0,i);case"boolean":return{controltype:"bool-check"};case"datetime":var n="datetime",r="yyyy-MM-dd";i&&i.format?-1==(r=i.format).indexOf("HH:")?n="date":r.indexOf("ss"):n="date",e={controltype:"flexibleDate",dateFormat:r,single:!1,showType:3,showTime:"datetime"===n};break;default:return{controltype:"text"}}}return e}switch(t.filter.type){case E["enum"]:return yt(0,t.filter.options);case E.date:case E.datetime:return function(t,e){var i="datetime",n="yyyy-MM-dd";return e&&e.format?-1==(n=e.format).indexOf("HH:")?i="date":n.indexOf("ss"):i="date",{controltype:"flexibleDate",dateFormat:n,single:!1,showType:1,showTime:"datetime"===i}}(0,t.filter.options);case E.number:return{controltype:"flexibleNumber",single:!1};case E.boolean:return{controltype:"bool-check"}}}return e},t.prototype.filterConditionChanged=function(t){var e,i,n=t.conditions;if(this.conditions&&this.conditions.length){if(this.conditions=this.conditions.filter(function(t){return t.FilterField!==n[0].FilterField}),1===n.length?this.conditions.push(S({},n[0])):(i=this.conditions).push.apply(i,x(n)),t.controlData){var r=this.controlData.findIndex(function(e){return e.labelCode===t.controlData.labelCode});r>-1?this.controlData[r]=S({},t.controlData):this.controlData.push(S({},t.controlData))}}else(e=this.conditions).push.apply(e,x(n)),this.controlData.push(S({},t.controlData));this.filterChanged.next({conditions:x(this.conditions),controlData:x(this.controlData)})},t.prototype.removeCondition=function(t,e){void 0===e&&(e=!1),this.conditions&&this.conditions.length&&(this.conditions=this.conditions.filter(function(e){return e.FilterField!==t.labelCode}),this.controlData=this.controlData.filter(function(e){return e.labelCode!==t.labelCode})),this.filterChanged.next({conditions:x(this.conditions),controlData:x(this.controlData)}),e&&this.removeFilter.next(t)},t.prototype.clearAll=function(){this.conditions=[],this.controlData=[],this.clearAllFilter.next(null)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[]},t}(),vt=function(){function t(t){var e=this;this.dgRef=null,this.oldSettings=null,this.selectStartEvent=null,this.events=null,this.dgRef=t,"default"===this.dgRef.selectionMode&&t.zone.runOutsideAngular(function(){e.events=e.registerStopSelectionEvent()})}return t.prototype.removeEvents=function(){this.events&&this.events.length&&(this.events.forEach(function(t){t()}),this.events=null)},t.prototype.toggleMode=function(){this.dgRef&&("default"===this.dgRef.selectionMode?this.enableWindowsSelectionMode():this.restoreSettings())},t.prototype.enableWindowsSelectionMode=function(){this.dgRef&&(this.oldSettings={showCheckbox:this.dgRef.showCheckbox,keepSelect:this.dgRef.keepSelect,onlySelectSelf:this.dgRef.onlySelectSelf,selectOnCheck:this.dgRef.selectOnCheck,checkOnSelect:this.dgRef.checkOnSelect},this.dgRef.showCheckbox=!0,this.dgRef.keepSelect=!0,this.dgRef.onlySelectSelf=!1,this.dgRef.selectOnCheck=!0,this.dgRef.checkOnSelect=!0,this.dgRef.dfs.updateProperty("keepSelect",!0),this.dgRef.dfs.updateProperty("onlySelectSelf",!1),this.dgRef.dfs.updateProperty("selectOnCheck",!0),this.dgRef.dfs.updateProperty("checkOnSelect",!0))},t.prototype.restoreSettings=function(){this.dgRef&&this.oldSettings&&(this.dgRef.showCheckbox=this.oldSettings.showCheckbox,this.dgRef.keepSelect=this.oldSettings.keepSelect,this.dgRef.onlySelectSelf=this.oldSettings.onlySelectSelf,this.dgRef.selectOnCheck=this.oldSettings.selectOnCheck,this.dgRef.checkOnSelect=this.oldSettings.checkOnSelect,this.dgRef.dfs.updateProperty("keepSelect",this.oldSettings.keepSelect),this.dgRef.dfs.updateProperty("onlySelectSelf",this.oldSettings.onlySelectSelf),this.dgRef.dfs.updateProperty("selectOnCheck",this.oldSettings.selectOnCheck),this.dgRef.dfs.updateProperty("checkOnSelect",this.oldSettings.checkOnSelect))},t.prototype.registerStopSelectionEvent=function(){var t=this;return[this.dgRef.render2.listen(document,"keydown",function(e){(e.ctrlKey||e.shiftKey)&&t.unselectable()}),this.dgRef.render2.listen(document,"keyup",function(e){(e.ctrlKey||e.shiftKey||17===e.keyCode||16===e.keyCode)&&t.enableSelectable()})]},t.prototype.unselectable=function(){this.dgRef.render2.setAttribute(this.dgRef.dgContainer.nativeElement,"unselectable","on"),this.dgRef.render2.setAttribute(this.dgRef.dgContainer.nativeElement,"onselectstart","return false"),this.dgRef.render2.setStyle(this.dgRef.dgContainer.nativeElement,"-moz-user-select","none")},t.prototype.enableSelectable=function(){this.dgRef.render2.removeAttribute(this.dgRef.dgContainer.nativeElement,"unselectable"),this.dgRef.render2.removeAttribute(this.dgRef.dgContainer.nativeElement,"onselectstart"),this.dgRef.render2.removeStyle(this.dgRef.dgContainer.nativeElement,"-moz-user-select")},t.prototype.beforRowClick=function(t){var e=this;if(this.dgRef&&"default"===this.dgRef.selectionMode){var i=this.dgRef.dfs.isRowSelected(t.id),n=t.e.ctrlKey,o=t.e.shiftKey;if(this.dgRef.endEditing(),n||o){if(o){var s=this.dgRef.focusRowIndex;-1===s&&(s=0);var l=t.rowIndex,a=s,c=l;s>l&&(a=l,c=s);var d=x(this.dgRef.getRows()).splice(a,c-a+1).map(function(t){return e.dgRef.dfs.primaryId(t)});return n||this.dgRef.clearCheckeds(!1,!1),this.dgRef.checkRows(d,!0),!0}}else if(i){var h=this.dgRef.getRows().map(function(t){return t.id}),u=this.dgRef.checkValues.filter(function(e){return h.includes(e)&&e!=t.id}),p=this.dgRef.checkValues.filter(function(t){return!h.includes(t)});u&&u.length&&(this.dgRef.unCheckRows(u,!0),this.dgRef.clearSelections(x([t.id],p)))}else this.dgRef.clearCheckeds();return i&&n?(t.e.stopPropagation(),this.dgRef.unCheckRow(t.id),!0):(this.dgRef.beforeSelect(t).pipe(r.delay(100)).subscribe(function(i){i&&(e.dgRef.dfs.selectRow(t.rowIndex,t.rowData),e.dgRef.selectedRow&&(e.dgRef.selectedRow.dr=t.dr)),e.dgRef.rowClick.emit({data:t.rowData,grid:e.dgRef,dblclick:!1}),e.dgRef.dgs.setSelecedRow.emit({selected:!0,id:e.dgRef.dfs.primaryId(t.rowData)})}),!0)}return!1},t.prototype.endRowClick=function(){this.dgRef&&"default"===this.dgRef.selectionMode&&(this.dgRef.checkOnSelect=!1)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:bt}]},t}(),bt=function(){function t(t,i,o,s,c,d,h,u,p){var g=this;if(this.cd=t,this.el=i,this.inject=o,this.zone=s,this.dfs=c,this.dgs=d,this.app=h,this.domSanitizer=u,this.render2=p,this.auther="Lucas Huang - QQ:1055818239",this.version="0.8.x",this.__component_type__="DatagridComponent",this.pos="relative",this.hostCls=!1,this.useThemes=!0,this.id="",this.useHtmlTable=!1,this.autoHeight=!1,this.showBorder=!1,this.striped=!0,this.width=800,this.height=300,this.showHeader=!0,this.headerHeight=35,this.headerWrap=!1,this.showFooter=!1,this.footerHeight=29,this.footerDataFrom="client",this.footerPosition="bottom",this.rowHeight=29,this._sizeType="sm",this._fit=!1,this._fitColumns=!1,this._autoFitColumns=!1,this.disabled=!1,this.scrollBarShowMode="auto",this.scrollBarOptions={width:18,height:18},this.resizeColumn=!0,this.showLineNumber=!1,this.lineNumberTitle="序号",this.lineNumberWidth=36,this.rowHover=!0,this.clickToEdit=!0,this._lockPagination=!1,this.__pagination=!0,this.pagerViewMode="default",this.pagerOnServer=!0,this.pageList=[10,20,30,50,100],this.pageIndex=1,this.pageSize=20,this.pagerHeight=56,this.showPageList=!1,this.showPageInfo=!0,this.showPageNumber=!0,this.pagerLabelSize=7,this.showGotoInput=!1,this.enableMorePageSelect=!1,this.showSelectedList=!1,this.cellTipTimer=1e3,this.controlPaginationState=!0,this._total=0,this.enableSelectRow=!0,this.multiSelect=!1,this.showCheckbox=!1,this.showAllCheckbox=!1,this.onlySelectSelf=!0,this.checkOnSelect=!1,this.selectOnCheck=!1,this.selectionMode="custom",this.keepSelect=!0,this.emptyDataHeight=240,this.emptyMessage="暂无数据",this.emptyTemplate=null,this.idField="id",this._footerData=n.of([]),this.endEditByInvalid=!0,this._columns=[],this._fields=[],this.nowrap=!0,this.virtualized=!1,this.virtualizedAsyncLoad=!1,this.editMode="row",this._editable=!1,this.enableEditCellStyle=!1,this.selectOnEditing=!1,this.editorHeight=30,this.remoteSort=!1,this.hoverRowCls="f-datagrid-row-hover",this.enableDragColumn=!1,this.rowGroupPanelHeight=50,this.groupRows=!1,this.groupFooter=!1,this.groupSummaryPosition="groupFooterRow",this.groupCellColSpan=1,this._groupField="",this.groupFields$=new n.BehaviorSubject([]),this.showGroupColumn=!0,this._showRowGroupPanel=!1,this.AutoColumnWidthUseDblclick=!0,this.useDefaultFilter=!1,this.enableSmartFilter=!1,this.enableFilterRow=!1,this.remoteFilter=!1,this.showFilterBar=!1,this.filterBarHeight=32,this.filterRowHeight=40,this.conditions={},this.selectValue=null,this.checkValues=[],this.selectValues=[],this.mergeCell=!1,this.mergeFields=[],this.enableClientSortForMergeCell=!1,this.useControlPanel=!1,this.enableSimpleMode=!1,this.controlPanelMode="advanced",this.stopPropagation=!0,this.closeOtherGridEditor=!1,this.clearSelectionsWhenDataIsEmpty=!0,this.enableContextMenu=!1,this.contextMenus=null,this.selectValueChange=new e.EventEmitter,this.checkValuesChange=new e.EventEmitter,this.selectValuesChange=new e.EventEmitter,this.beginEdit=new e.EventEmitter,this.endEdit=new e.EventEmitter,this.cancelEdited=new e.EventEmitter,this.scrollY=new e.EventEmitter,this.pageSizeChanged=new e.EventEmitter,this.pageChanged=new e.EventEmitter,this.loadSuccess=new e.EventEmitter,this.filterChanged=new e.EventEmitter,this.enableHighlightCell=!1,this.checkedRowsDataFromSource=!1,this.editcellWhenTabKeydwon=!1,this.beforeClickCell=new e.EventEmitter,this.dblclickRow=new e.EventEmitter,this.selectChanged=new e.EventEmitter,this.unSelect=new e.EventEmitter,this.selectAll=new e.EventEmitter,this.unSelectAll=new e.EventEmitter,this.scrollYLoad=new e.EventEmitter,this.checked=new e.EventEmitter,this.unChecked=new e.EventEmitter,this.checkAll=new e.EventEmitter,this.unCheckAll=new e.EventEmitter,this.checkedChange=new e.EventEmitter,this.columnSorted=new e.EventEmitter,this.rowClick=new e.EventEmitter,this.rowAppended=new e.EventEmitter,this.rowDeleted=new e.EventEmitter,this.rowUpdated=new e.EventEmitter,this.dataChange=new e.EventEmitter,this.lastCellEnterHandle=new e.EventEmitter,this.groupFieldChange=new e.EventEmitter,this.columnMoved=new e.EventEmitter,this.cellClick=new e.EventEmitter,this._loading=!1,this._selectedRow=null,this.ds={index:0,rows:[],top:0,bottom:0,scrolling:!1},this.pagerOpts={},this.editors={},this.validators=[],this.footerWidth=0,this.clickDelay=150,this.resizeColumnInfo={proxyLineEdge:0,startWidth:0,startX:0,left:0},this.ro=null,this.subscriptions=[],this.realHeaderHeight=0,this.modalClickEvent=null,this.pending=!1,this.scrollInstance=null,this.mergeCellInfo={},this.ignoreTarget=["INPUT","SELECT","TEXTAREA"],this.clientFilterService=null,this.ControlPanelFeild="_datagrid-setting-control_",this._isResized=!1,this.gridSize={width:this.width+"px",height:this.height+"px"},this.clientFilterChanged=!1,this.styleSheetId="",this.groupRowPanelPlaceholder="",this.commonUtils=null,this.smartFilterService=null,this.smartFilterResult={controlData:[],conditions:[]},this.smartFilterBarHeight=32,this._active_datagrid_cls="datagrid-active",this._blured_datagrid_cls="datagrid-blurred",this._custom_datagrid_cls="datagrid",this.focusRowIndex=-1,this.documentBodyMouseDown=null,this.farrisInstances=null,this.currentPagerData=[],this.trackByRows=function(t,e){return e&&e[g.idField]||t},this.onDocumentMouseDown=function(t){if(g.pending)return!1;if(t.target.closest(".f-datagrid")||g.activeDataGrid(!1),g.currentCell){if(U.hasDialogOpen()){var e=g.inDialog(),i=t.target.closest(".modal-body");if(!e||!i)return;if(e!=i)return}g.currentCell.isEditing&&g.currentCell.cellElement.closeEdit().subscribe(function(t){t&&(g.currentCell&&g.currentCell.cellElement&&(it.removeClass(g.currentCell.cellElement,A),it.removeClass(g.currentCell.cellElement,M)),g.dfs.cancelSelectCell(),g.unbindDocumentEditListener(),g.currentCell=null)})}},this.styleSheetId="DATAGRID-"+U.uuid(),this.localeService=this.inject.get(a.LocaleService),this.restService=this.inject.get(Q,null),this.colFormatSer=this.inject.get(f.ColumnFormatService),this.commonUtils=this.inject.get(l.CommonUtils,null),this.clientFilterService=new nt(c,this.localeService,o),this.farrisInstances=this.inject.get(l.FarrisComponentInstanceService,null),this.smartFilterService=this.inject.get(wt,null),this.idService=this.inject.get(l.IdService,null),this.dfs.localId=this.localeService.localeId,this.settingService=this.inject.get(O,null),this.settingService){var m=this.inject.get(P,null);this.settingService.httpRestService=m}var y=this.dfs.data$.subscribe(function(t){g.cleanDom();var e=S({},t);g.conditions&&Object.keys(g.conditions).length&&!g.remoteFilter&&g.useDefaultFilter&&(e.rows=g.clientFilterService.executeFilter(e.rows,g.conditions)),g.ds=e,g.ds.rows&&g.ds.rows.length?(g.data=g.dfs.getData(),g.mergeCell&&g.mergeFields&&g.mergeFields.length&&(g.mergeCellInfo=g.dgs.getMergeCellInfo3(g.ds.rows,x(g.mergeFields))),g.setPagerTotal(),g.loadSuccess.emit(g.ds.rows)):(g.data=[],g.clearSelectionsWhenDataIsEmpty&&g.clearAll()),g.ds.scrolling||g.updateFooterData(),g.cd.detectChanges()});this.subscriptions.push(y);var w=this.dfs.columnGroup$.pipe(r.debounceTime(60)).subscribe(function(t){t&&(g.colGroup=t,g.footerWidth=t.totalWidth,g.cd.detectChanges())});this.subscriptions.push(w),this.subscriptions.push(this.dfs.gridSize$.subscribe(function(t){t&&t.columnsGroup&&(g.colGroup=t.columnsGroup,g.cd.detectChanges())})),this.initEditorAndValidator();var v=this.dfs.currentCell$.subscribe(function(t){g.currentCell=t,t&&t.cellRef&&(t.cellRef.isEditing=t.isEditing),g.unbindMoveSelectRowEvent(),g.bindDocumentEditListener()});this.dfs.selectRow$.subscribe(function(t){g.currentCell||g.bindDocumentMoveSelectRowEvent(),g.selectedRow=t}),this.subscriptions.push(v),Y.gridInstance=this;var b=this.dgs.onFilterChanged.subscribe(function(t){g.conditions=t,g.clientFilterChanged=!0,g.filterData(t)});this.subscriptions.push(b);var C=this.dgs.refreshFooterData.subscribe(function(){g.updateFooterData()});this.subscriptions.push(C),this.dgs.commonUtils=this.commonUtils,this.sms=new vt(this),this.dgs.focusRowChanged.subscribe(function(t){t&&(g.focusRowIndex=t.rowIndex)})}return Object.defineProperty(t.prototype,"autoHeightCls",{get:function(){return this.autoHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sizeType",{get:function(){return this._sizeType},set:function(t){this._sizeType=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fit",{get:function(){return this._fit},set:function(t){this._fit=t,this.hostCls=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fitColumns",{get:function(){return this._fitColumns},set:function(t){this._fitColumns=t,this.setFitColumns(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoFitColumns",{get:function(){return this._autoFitColumns},set:function(t){this._autoFitColumns=t,this.dfs.updateProperty("autoFitColumns",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lockPagination",{get:function(){return this._lockPagination},set:function(t){this._lockPagination=t,this.dgPager&&this.dgPager[t?"lock":"unlock"]()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagination",{get:function(){return this.__pagination},set:function(t){this.__pagination!==t&&(this.__pagination=t,this.dfs.updateProperty("pagination",t),this.dgs.showGridHeader.emit())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"total",{get:function(){return this._total},set:function(t){this._total=t,this.pagerOpts.totalItems=t,this.pagination||(this.pagerOpts.itemsPerPage=t),this.dfs.setTotal(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerData",{get:function(){return this._footerData},set:function(t){t&&(Array.isArray(t)?this._footerData=n.of(t):this._footerData=t),t&&this.setFooterHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._columns},set:function(t){this._columns=this.correctColumns(t),this.dfs.updateProperty("columns",this._columns)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this._fields},set:function(t){this._fields=t,this.columns=t,this.data&&this.columnsChanged(!1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editable",{get:function(){return this._editable},set:function(t){this._editable!==t&&(this._editable=t,this.cd.detectChanges(),this.dgs.updateEmptyStyle())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupField",{get:function(){return this._groupField},set:function(t){this._groupField=t||"",this.groupField?this.groupFields$.next(this.groupField.split(",")):this.groupFields$.next([]),this.dfs.updateProperty("groupField",this._groupField)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showRowGroupPanel",{get:function(){return this.groupRows&&this._showRowGroupPanel},set:function(t){this._showRowGroupPanel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},set:function(t){this._loading=t,this.cd.destroyed||this.cd.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selections",{get:function(){return this.dfs.getSelections()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkeds",{get:function(){return this.checkedRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkedRows",{get:function(){var t=this,e=this.dfs.getCheckeds();if(this.enableMorePageSelect){if(e&&e.length)return this.checkedRowsDataFromSource?e.map(function(e){var i=t.dfs.findRow(e.id);return i&&(e.data=i.data),e}):x(e)}else if(this.data&&this.data.length){var i=this.data.map(function(e){return e[t.idField]});return this.checkedRowsDataFromSource?e.filter(function(t){return i.includes(t.id)}).map(function(e){var i=t.dfs.findRow(e.id);return i&&(e.data=i.data),e}):e.filter(function(t){return i.includes(t.id)})}return[]},set:function(t){var e=this;t&&t.length&&(t=t.map(function(t){return t.data?t:{id:t[e.idField],data:t}})),this.dfs.updateProperty("checkedRows",t||[]),this.initSelectOrChecked(),this.cd.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedRow",{get:function(){return this._selectedRow},set:function(t){t?this.selectValue!=t.id&&(this._selectedRow=t,this.selectValue=t.id,this.selectValueChange.emit(t.id),this.selectChanged.emit(t)):(this.unSelect.emit(this._selectedRow),this.selectValue=null,this.selectValueChange.emit(""),this._selectedRow=null)},enumerable:!0,configurable:!0}),t.prototype.setCurrentPagerData=function(t){this.currentPagerData=t},t.prototype.updateFooterData=function(){this.showFooter&&"client"===this.footerDataFrom&&(this.footerData=n.of(this.dfs.getFooterData(this.data)))},t.prototype.ngDoCheck=function(){},t.prototype.ngOnInit=function(){var t=this;this.checkFilterStyle(),this.useThemes&&this._checkSize(),this.checkOptions(),this.groupRowPanelPlaceholder=this.localeService.getValue("datagrid.groupRow.tips"),this.smartFilterService&&(this.enableSmartFilter&&this.showFilterBar&&(this.smartFilterResult&&this.smartFilterResult.controlData&&this.smartFilterResult.controlData.length?this.filterBarHeight=this.smartFilterBarHeight:this.filterBarHeight=0),this.smartFilterService.filterChanged.subscribe(function(e){(t.smartFilterResult||e)&&JSON.stringify(t.smartFilterResult)!==JSON.stringify(e)&&(t.smartFilterResult=e,t.clientFilterChanged=!0,t.filterData(e.conditions),!t.smartFilterResult||t.smartFilterResult.controlData&&!t.smartFilterResult.controlData.length?t.onFilterBarResize(0):t.filterBarHeight||t.onFilterBarResize(t.smartFilterBarHeight))}))},t.prototype.ngAfterViewInit=function(){var t=this;(this.render2.addClass(this.dgContainer.nativeElement,this._custom_datagrid_cls),this.setHeaderHeight(),this.setPagerHeight(),this.initBeforeEvents(),this.fit&&this.setGridNewSizeWhenFit(),this.initState(),this.el&&this.farrisInstances&&this.farrisInstances.add(this.el.nativeElement,this),this.data&&this.data.length||this.fetchData(1,this.pageSize).subscribe(function(e){e&&(t.total=e.total,e.footer&&(t.footerData=e.footer),t.loadData(e.items))}),this.zone.runOutsideAngular(function(){t.ro=new u(function(e){if("none"!==e[0].target.style.display){var i=e[0].contentRect.width;if(i){var n=e[0].contentRect.height,r=Math.floor(i),o=Math.floor(i),s=Math.floor(n),l=Math.round(n);t.width!==r&&t.width!==o||t.height!==s&&t.height!==l?setTimeout(function(){t.calculateGridSize(t.fit)},100):t.dgs.restoreScrollbarPosition()}}}),t.ro.observe(t.el.nativeElement.parentElement),document.body.removeEventListener("mousedown",t.documentBodyMouseDown),document.body.addEventListener("mousedown",t.documentBodyMouseDown=function(e){var i=e.target;i.closest("td.f-datagrid-cell")||i.closest(".date-overlay-container")||i.closest(".time-picker-overlay")||i.closest(".language-textbox-panel")||i.closest(".comboPanel")||t.onDocumentMouseDown(e)},!0)}),this.showFooter)&&(this.footerTemplate&&this.el.nativeElement.querySelector(".f-datagrid-footer")&&(this.footerHeight=this.el.nativeElement.querySelector(".f-datagrid-footer").offsetHeight));this.fit&&(this.el.nativeElement.parentElement&&(this.el.nativeElement.parentElement.style.position="relative"),this.calculateGridSize(this.fit)),this.selectionMode&&"default"===this.selectionMode&&this.multiSelect&&this.sms.enableWindowsSelectionMode()},t.prototype.ngAfterContentInit=function(){this.dgColumns&&this.dgColumns.length&&(this.columns=this.dgColumns.map(function(t){return S({},t)}))},t.prototype.ngOnChanges=function(t){var e=this;if(t.data&&!t.data.isFirstChange()&&(this.dfs.loadData(t.data.currentValue),this.dgs.dataSourceChanged()),t.showCheckbox===undefined||t.showCheckbox.isFirstChange()||this.dfs.showCheckbox(t.showCheckbox.currentValue),t.showLineNumber===undefined||t.showLineNumber.isFirstChange()||this.dfs.showLineNumber(t.showLineNumber.currentValue),t.multiSelect===undefined||t.multiSelect.isFirstChange()||this.dfs.setMultiSelect(t.multiSelect.currentValue),t.checkOnSelect===undefined||t.checkOnSelect.isFirstChange()||this.dfs.setCheckOnSelect(t.checkOnSelect.currentValue),t.selectOnCheck===undefined||t.selectOnCheck.isFirstChange()||this.dfs.setSelectOnCheck(t.selectOnCheck.currentValue),t.onlySelectSelf===undefined||t.onlySelectSelf.isFirstChange()||this.dfs.updateProperty("onlySelectSelf",t.onlySelectSelf.currentValue),t.keepSelect===undefined||t.keepSelect.isFirstChange()||this.dfs.updateProperty("keepSelect",t.keepSelect.currentValue),t.headerWrap===undefined||t.headerWrap.isFirstChange()||setTimeout(function(){e.setHeaderHeight(),e.cd.detectChanges(),e.dfs.columnResizeEnd()}),t.nowrap===undefined||t.nowrap.isFirstChange()||(this.checkNowrap(),this.setRowHeight(!1),this.dgs.cellContentWrapChanged.emit(),this.dfs.updateProperty("nowrap",t.nowrap.currentValue)),t.multiSort===undefined||t.multiSort.isFirstChange()||this.dfs.updateProperty("multiSort",t.multiSort.currentValue),t.editable===undefined||t.editable.isFirstChange()||(this.dfs.updateProperty("editable",t.editable.currentValue),t.editable.currentValue||this.endCellEdit(),this.isSingleClick=null,this.cd.detectChanges()),t.showHeader===undefined||t.showHeader.isFirstChange()||(this.dfs.updateProperty("showHeader",t.showHeader.currentValue),this.headerHeightChange(),this.cd.detectChanges()),t.showFilterBar!==undefined&&!t.showFilterBar.isFirstChange()){this.dfs.updateProperty("showFilterBar",t.showFilterBar.currentValue),this.dgs.showGridHeader.emit(this.realHeaderHeight);var i=0;this.conditions&&this.conditions.length&&(i=32),this.onFilterBarResize(i)}if(t.showFooter===undefined||t.showFooter.isFirstChange()||(this.dfs.updateProperty("showFooter",t.showFooter.currentValue),this.calculateGridSize(this.fit)),t.pagerOnServer===undefined||t.pagerOnServer.isFirstChange()||(this.dfs.updateProperty("pagerOnServer",t.pagerOnServer.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{remote:this.pagerOnServer})),t.pageIndex===undefined||t.pageIndex.isFirstChange()||(this.dfs.updateProperty("pageIndex",t.pageIndex.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{currentPage:this.pageIndex})),t.pageSize===undefined||t.pageSize.isFirstChange()||(this.dfs.updateProperty("pageSize",t.pageSize.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{itemsPerPage:this.pageSize})),t.pageList===undefined||t.pageList.isFirstChange()||(this.dfs.updateProperty("pageList",t.pageList.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{pageList:this.pageList})),t.columns===undefined||t.columns.isFirstChange()||this.columnsChanged(),t.sizeType===undefined||t.sizeType.isFirstChange()||(this._sizeType=t.sizeType.currentValue,this.setRowHeight(!0),this.dfs.updateProperty("rowHeight",this.rowHeight),this.setFooterHeight(),this.refresh(),this.dgs.onRowHeightChange(this.rowHeight)),t.rowHeight&&!t.rowHeight.isFirstChange()&&this.setRowHeight(!1),t.selectValue&&!t.selectValue.isFirstChange()&&this.selectRow(this.selectValue,!1),t.checkValues&&!t.checkValues.isFirstChange()){var n=this.dfs.differenceBy(t.checkValues.currentValue||[],t.checkValues.previousValue||[],function(t){return t});n&&n.length&&this.checkRows(n,!1);var r=this.dfs.differenceBy(t.checkValues.previousValue||[],t.checkValues.currentValue||[],function(t){return t});r&&r.length&&this.unCheckRows(r,!1),setTimeout(function(){e.checkValues=e.checkeds.map(function(t){return t.id}),e.checkValuesChange.emit(e.checkValues),e.checkedChange.emit(e.checkeds),e.updateAllCheckboxStatus()},10)}t.showGroupColumn&&!t.showGroupColumn.isFirstChange()&&(this.toggleVisibleColumn(this.groupField.split(","),t.showGroupColumn.currentValue),this.columnsChanged()),t.autoFitColumns&&!t.autoFitColumns.isFirstChange()&&this.dfs.updateProperty("autoFitColumns",t.autoFitColumns.currentValue),t.groupRows&&!t.groupRows.isFirstChange()&&(this.dfs.updateProperty("groupRows",t.groupRows.currentValue),this.refresh()),t.mergeCell&&!t.mergeCell.isFirstChange()&&this.refresh(),t.mergeFields&&!t.mergeFields.isFirstChange()&&this.refresh(),t.enableFilterRow&&!t.enableFilterRow.isFirstChange()&&(this.dfs.updateProperty("enableFilterRow",t.enableFilterRow.currentValue),this.showHeader&&(this.setHeaderHeight(),this.filterBarHeight=32,this.dgs.toggleFilterRow.emit(this.enableFilterRow),this.dgs.showGridHeader.emit(this.realHeaderHeight),this.cd.detectChanges())),t.enableSmartFilter&&!t.enableSmartFilter.isFirstChange()&&this.dfs.updateProperty("enableSmartFilter",t.enableSmartFilter.currentValue),t.enableDragColumn&&!t.enableDragColumn.isFirstChange()&&this.checkDragColumns(),t.showRowGroupPanel&&!t.showRowGroupPanel.isFirstChange()&&(this.dgs.smartFilterBarExpand.emit(),this.dgs.showGridHeader.emit(this.realHeaderHeight)),t.selectionMode&&!t.selectionMode.isFirstChange()&&this.sms.toggleMode()},t.prototype.checkFilterStyle=function(){this.enableFilterRow&&this.enableSmartFilter&&(this.enableFilterRow=!1)},t.prototype._checkSize=function(){var t="sm";switch(localStorage.getItem("gsp_rtf_themSKey")){case"default":t="sm";break;case"loose":t="md"}this.sizeType=t},t.prototype.checkDragColumns=function(){this.isMultiHeader()&&(this.enableDragColumn=!1)},t.prototype.checkOptions=function(){var t=this;if(this.gridSize={width:this.width+"px",height:this.height+"px"},this.id?(this.styleSheetId=this.id+"_"+U.uuid().replace(/-/g,"").substr(0,10),this._custom_datagrid_cls=this.styleSheetId):(this.id="FarrisDataGrid"+U.uuid().replace(/-/g,"").substr(0,10),this.useControlPanel&&(this.useControlPanel=!1,console.warn("启用列配置属性，未设置ID，此功能将禁用。")),this._custom_datagrid_cls=this.id),this.settingService&&this.useControlPanel&&this.settingService.registerGridInstance(this),this.dgs.createStyleElement(this.styleSheetId),!this.idField)throw new Error("The Datagrid's idField can't be Null. ");this.checkNowrap(),this.checkSortInfo(),this.checkMergeCell(),this.setCheckboxBehavior(),this.initPaginationOptions(),this.columns||(this.columns=this.fields),this.checkGroupHeaderColumns(),this.checkGroupRowSetting(),this.checkColumnsType(),this.checkDragColumns();var e=function(){t._flatColumns(),t.setRowHeight()};if(this.dfs.setinitialOptions({columns:this.columns,groupField:this.groupField,sortName:this.sortName,sortOrder:this.sortOrder}),this.settingService&&this.useControlPanel){var i=this.settingService.getSettings(this.id);if(!i)return void e();i.subscribe(function(e){e&&(t.userProfileSetting(e),t.setRowHeight(!1)),t.data&&t.data.length&&t.dfs.updateProperty("data",t.data),t.columnsChanged(t.groupRows&&t.data&&!!t.data.length)},function(t){e(),console.error(t)})}else e()},t.prototype.refreshSelectedData=function(){var t=this;if(this.selectedRow&&this.selectedRow.id)if(this.data&&this.data.length){var e=this.data.find(function(e){return e[t.idField]===t.selectedRow.id});this.selectedRow.data=e}else this.selectedRow=null},t.prototype.ngOnDestroy=function(){this.unsubscribes(),this.ro&&this.ro.disconnect(),this.documentRowKeydownHandler&&this.documentRowKeydownHandler(),this.currentCell=null,this.clientFilterService=null,this.cleanDom(),this.dgs.removeStyleSheet(),this.settingService&&this.settingService.destroy&&this.settingService.destroy(this.id),this.sms&&this.sms.removeEvents()},t.prototype.onClick=function(t){if(this.showSelectedList&&this.dgPager&&this.dgPager.closeSelectedList(),!this.pending){var e=t.target;"TEXTAREA"!==e.nodeName&&"INPUT"!==e.nodeName?this.currentCell&&this.currentCell.editor&&this.currentCell.editor._editorClickEvent?t.stopPropagation():(this.endCellEdit(t),this.dfs.cancelSelectCell(),this.stopPropagation&&t.stopPropagation()):t.stopPropagation()}},t.prototype.initPaginationOptions=function(){this.pagerOpts={id:this.id?this.id+"-pager_"+U.uuid():"farris-datagrid-pager_"+U.uuid(),itemsPerPage:this.pagination?this.pageSize:this.total,currentPage:this.pageIndex,totalItems:this.total,pageList:this.pageList,remote:this.pagerOnServer}},t.prototype.updatePagerOptions=function(){this.pagerOpts=Object.assign(this.pagerOpts,{itemsPerPage:this.pageSize,currentPage:this.pageIndex,totalItems:this.total})},t.prototype.setPagerTotal=function(){var t=this.data.length;this.pagination&&0===this.total&&this.virtualized?this.pagerOpts.totalItems=t:this.pagination||(this.pagerOpts.itemsPerPage=t)},t.prototype.setFooterHeight=function(){var t=this;this.showFooter&&!this.footerTemplate&&this._footerData.subscribe(function(e){t.footerHeight=e.length*t.rowHeight})},t.prototype.customStyleKey=function(){return"."+this._custom_datagrid_cls},t.prototype.setRowHeight=function(t){void 0===t&&(t=!1);var e=z[this._sizeType].row;this.rowHeight=t?e:e>this.rowHeight?e:this.rowHeight;var i=this.customStyleKey()+".f-datagrid-body-row, "+this.customStyleKey()+" .f-datagrid-cell",n=this.customStyleKey()+" .f-datagrid-cell-content";if(this.dgs.removeCssRule(i),this.dgs.removeCssRule(n),29!==this.rowHeight&&this.nowrap){var r=[i+" { height: "+this.rowHeight+"px }",n+" { height: "+this.rowHeight+"px; line-height: "+this.rowHeight+"px }"];this.dgs.appendCssRules(r)}},t.prototype.initSelectOrChecked=function(){var t=this,e=this.dfs.getCurrentPageData();if(!this.enableMorePageSelect&&this.multiSelect&&(this.checkeds&&this.checkeds.length?this.checkeds.forEach(function(i){e.find(function(e){return e[t.idField]==i.id})||t.unCheckRow(i.id,!1)}):this.clearCheckeds()),this.selectValue&&e.find(function(e){return e[t.idField]==t.selectValue})&&(this.selectRow(this.selectValue,!1),this.refreshSelectedData()),this.multiSelect){if(this.checkValues&&this.checkValues.length){var i=this.checkeds.map(function(t){return t.id}),n=this.dfs.difference(i,this.checkValues);n.length?this.checkRows(n,!1):this.checkValues=[]}else this.checkValues=[];this.checkValues=this.checkeds.map(function(t){return t.id}),this._isResized&&!this.virtualized||(this.checkValuesChange.emit(this.checkValues),this.checkedChange.emit(this.checkeds)),this.updateAllCheckboxStatus(e)}},t.prototype.updateAllCheckboxStatus=function(t){var e=this;t||(t=this.dfs.getCurrentPageData());var i=0;if(this.showAllCheckbox){var n=t.map(function(t){return t[e.idField]}),r=n.filter(function(t){return e.checkValues.includes(t)});if(r&&r.length){var o=!this.dfs.difference(n,this.checkValues).length;this.checkValues&&this.checkValues.length?o?i=1:o||(i=2):i=0}}this.dgs.changeCheckAllStatus.emit(i)},t.prototype.setCheckboxBehavior=function(){!this.multiSelect&&this.showCheckbox},t.prototype._flatColumns=function(){var t=this;this.flatColumns=o.flatten(this.columns).filter(function(e){return!e.colspan&&t.columnIsVisible(e)})},t.prototype.columnIsVisible=function(t){return Y.columnIsVisible(t,this)},t.prototype.addControlCol=function(){var t=this;if(this.useControlPanel){var e=this.columns[0].find(function(e){return e.field===t.ControlPanelFeild});if(e)e.visible=!0;else{var i={field:this.ControlPanelFeild,width:24,rowspan:this.columns.length,fixed:"right",visible:!0};this.columns[0].push(i)}}},t.prototype.checkGroupHeaderColumns=function(){if(this.isMultiHeader()){var t=o.flatten(this.columns);Y.checkGroupHeaderColumnVisible(t)}},t.prototype.correctColumns=function(t){return t&&t.length&&!Array.isArray(t[0])?[t]:t||[]},t.prototype.checkColumnsType=function(){var t=this;this.columns&&this.columns.length&&(this.addControlCol(),this.columns.forEach(function(e,i){e.forEach(function(e,n){if(e.field||(e.field="farris-datagrid-column_"+i+"_"+n),e.valign||(e.valign="middle"),e.width===undefined||null===e.width?e.width=100:"string"==typeof e.width&&(e.width=parseInt(e.width,10)),e.originalWidth||(e.originalWidth=e.width),e.formatter&&"function"!=typeof e.formatter&&0===Object.keys(e.formatter).length&&(e.formatter=null),!t.showGroupColumn&&t.groupRows&&t.toggleVisibleColumn(t.groupField.split(","),!1),e.filter)if("boolean"==typeof e.filter)e.field?e.filter=t.clientFilterService.createColumnFilterOptions(e):e.filter=!1;else if(!e.filter.options||!Object.keys(e.filter.options).length)switch(e.filter.type){case E["enum"]:e.filter.options=e.formatter.options;break;case E.date:e.filter.options={dateFormat:"yyyy-MM-dd",returnFormat:"yyyy-MM-dd"};break;case E.datetime:e.filter.options={dateFormat:"yyyy-MM-dd HH:mm:ss",returnFormat:"yyyy-MM-dd HH:mm:ss"}}e.hidden!==undefined&&e.visible===undefined&&("boolean"==typeof e.hidden?e.visible=!e.hidden:"function"==typeof e.hidden&&(e.visible=function(){return!e.hidden.bind(t)}))})}))},t.prototype.checkGroupRowSetting=function(){},t.prototype.checkMergeCell=function(){this.mergeCell&&(this.mergeFields&&this.mergeFields.length?(this.virtualized=!1,this.virtualizedAsyncLoad=!1):this.mergeCell=!1)},t.prototype.checkSortInfo=function(){this.sortName&&(this.sortOrder||(this.sortOrder=this.sortName.split(",").map(function(){return"asc"}).join(",")))},t.prototype.checkNowrap=function(){this.nowrap||(this.virtualized=!1)},t.prototype.setHeaderHeight=function(){if(this.realHeaderHeight=0,this.showHeader){if(this.headerWrap){var t=this.el.nativeElement.querySelector(".f-datagrid-header");if(t){var e=t.querySelectorAll("table tr:not(.f-datagrid-filter-row)");e.forEach(function(t){t.style.height="auto",Array.from(t.children).forEach(function(t){return t.style.height="auto"})});var i=Math.max.apply(Math,x(Array.from(e).map(function(t){return t.clientHeight})));this.realHeaderHeight=i}}else this.realHeaderHeight=this.columns.length*this.headerHeight;this.enableFilterRow&&(this.realHeaderHeight+=this.filterRowHeight)}return this.realHeaderHeight},t.prototype.columnsChanged=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=null);var i=null===e?this.fitColumns:e;this.checkColumnsType(),this._flatColumns(),this.headerHeightChange(),this.dfs.updateProperty("flatColumns",this.flatColumns),this.dfs.updateColumns(this.columns,i,!0),this.updateFooterData(),t&&this.refresh(),this.dgs.columnsChanged.emit({scrollToLeft:t})},t.prototype.headerHeightChange=function(){this.setHeaderHeight(),this.dgs.showGridHeader.emit(this.realHeaderHeight)},t.prototype.inDialog=function(){return this.el.nativeElement.closest(".modal-body")},t.prototype.initEditorAndValidator=function(){var t=this,e=this.inject.get(k,[]);e.length&&e.forEach(function(e){t.editors[e.name]=e.value});var i=this.inject.get(F,[]);i&&i.length&&(this.validators=i)},t.prototype.setPagerHeight=function(){this.useHtmlTable||(this.pagination?this.pagerHeight=this.dgPager&&this.dgPager.outerHeight||40:this.pagerHeight=0)},t.prototype.initState=function(){this.data=this.data||[],this.dfs.initState(S({},this,{fitColumns:this.fitColumns,fit:this.fit,groupField:this._groupField}))},t.prototype.setFitColumns=function(t){void 0===t&&(t=!0),this.columns&&this.dfs.fitColumns(t)},t.prototype.setGridNewSizeWhenFit=function(){var t=this.el.nativeElement.parentElement;if(t){var e=t.getBoundingClientRect(),i=this.getElementPadding(t),n=this.getElementBorderWidth(t);this.width=Math.floor(e.width-n.left-n.right-i.left-i.right),this.height=Math.floor(e.height-n.top-n.bottom-i.top-i.bottom),this.height||(this.height=this.dfs.getState().height||300),this.width||(this.width=this.dfs.getState().width||800)}},t.prototype.calculateGridSize=function(t){void 0===t&&(t=!0),this.useHtmlTable||t&&(this.setGridNewSizeWhenFit(),this.width&&this.height&&(this._isResized=!0,this.gridSize={width:this.width+"px",height:this.height+"px"},this.dfs.resize({width:this.width,height:this.height}),this._isResized=!1,this.cd.detectChanges()))},t.prototype.initBeforeEvents=function(){this.beforeSelect||(this.beforeSelect=function(){return n.of(!0)}),this.beforeUnselect||(this.beforeUnselect=function(){return n.of(!0)}),this.beforeCheck||(this.beforeCheck=function(){return n.of(!0)}),this.beforeUncheck||(this.beforeUncheck=function(){return n.of(!0)}),this.beforeSortColumn||(this.beforeSortColumn=function(){return n.of(!0)}),this.beforeEdit||(this.beforeEdit=function(){return n.of(!0)}),this.afterEdit||(this.afterEdit=function(){return n.of(!0)})},t.prototype.unbindMoveSelectRowEvent=function(){this.documentRowKeydownHandler&&(this.documentRowKeydownHandler(),this.documentRowKeydownHandler=null)},t.prototype.bindDocumentMoveSelectRowEvent=function(){var t=this;this.unbindMoveSelectRowEvent(),this.unbindDocumentEditListener(),this.documentRowKeydownHandler=this.render2.listen(document,"keydown",function(e){if(t.isActived()&&!document.querySelectorAll("farris-loading").length){if(e.target){var i=e.target.nodeName;if(t.ignoreTarget.indexOf(i)>-1)return}switch(40!==e.keyCode&&38!==e.keyCode||e.preventDefault(),e.keyCode){case 40:t.selectNextRow();break;case 38:t.selectPrevRow()}}})},t.prototype.bindEditListenerInModal=function(){var t=this;if(U.hasDialogOpen()){var e=this.inDialog();if(e){var i=e.closest(".farris-modal");i&&(this.modalClickEvent=this.render2.listen(i,"click",function(){t.endEditing(),t.currentCell=null}))}}},t.prototype.bindDocumentEditListener=function(){var t=this;this.unbindDocumentEditListener(),this.documentCellClickHandler||(this.bindEditListenerInModal(),this.documentCellClickHandler=function(e){if(t.pending)return!1;if(t.currentCell){if(U.hasDialogOpen()){var i=t.inDialog(),n=e.target.closest(".modal-body");if(!i||!n)return;if(i!=n)return}t.currentCell.isEditing&&t.currentCell.cellElement.closeEdit().subscribe(function(e){e&&(it.removeClass(t.currentCell.cellElement,A),it.removeClass(t.currentCell.cellElement,M),t.dfs.cancelSelectCell(),t.unbindDocumentEditListener(),t.currentCell=null)})}},this.docuemntCellClickEvents=this.render2.listen(document,"click",this.documentCellClickHandler)),this.documentCellKeydownHandler||(this.documentCellKeydownHandler=function(e){t.isActived()&&t.onKeyDownEvent(e)},this.documentCellKeydownEvents=this.render2.listen(document,"keydown",this.documentCellKeydownHandler))},t.prototype.unbindDocumentEditListener=function(){this.documentCellClickHandler&&(this.docuemntCellClickEvents(),this.documentCellClickHandler=null),this.documentCellKeydownHandler&&(this.documentCellKeydownEvents(),this.documentCellKeydownHandler=null),this.modalClickEvent&&(this.modalClickEvent(),this.modalClickEvent=null)},t.prototype.onKeyDownEvent=function(t){var e=t.keyCode;if(this.currentCell&&!this.currentCell.isEditing)switch([13,40,37,38,39,9].indexOf(e)>-1&&t.preventDefault(),e){case 32:this.currentCell&&this.currentCell.column.onSpaceHandler&&(t.stopPropagation(),this.currentCell.column.onSpaceHandler({grid:this,cell:this.currentCell,event:t}));break;case 13:if(this.currentCell){var i=this.currentCell.cellElement.editCell;i?i.apply(this.currentCell.cellElement):this.currentCell.column.onEnterHandler&&(t.stopPropagation(),this.currentCell.column.onEnterHandler({grid:this,cell:this.currentCell,event:t}))}break;case 40:this.selectNextCell("down",t);break;case 38:this.selectNextCell("up",t);break;case 39:this.selectNextCell("right",t);break;case 37:this.selectNextCell("left",t);break;case 9:t.shiftKey?this.selectNextCell("left",t):this.selectNextCell("right",t)}},t.prototype.unsubscribes=function(){this.subscriptions.forEach(function(t){t&&(t.unsubscribe(),t=null)}),this.subscriptions=[],this.docuemntCellClickEvents&&this.docuemntCellClickEvents()},t.prototype.isRowEditing=function(){return!(!this.selectedRow||-1===this.selectedRow.index)&&("row"===this.editMode&&(this.selectedRow.editors&&this.selectedRow.editors.length))},t.prototype.isCellEditing=function(){return!(!this.currentCell||"cell"!==this.editMode)&&(this.currentCell.editor||this.currentCell.column.editorTemplate||(this.currentCell.isEditing=!1),this.currentCell.isEditing)},t.prototype.isEditing=function(){return"row"===this.editMode?this.isRowEditing():this.isCellEditing()},t.prototype.endEditing=function(){"row"===this.editMode?this.endRowEdit():"cell"===this.editMode&&this.endCellEdit()},t.prototype.getEditors=function(){return this.selectedRow.editors},t.prototype.editCell=function(t,e){if(this.activeDataGrid(),this.dfs.findRowIndex(t)>-1){this.endCellEdit();var i="row_"+t,n=this.el.nativeElement.querySelector("#"+i),r=null;n&&(r=n.querySelector('[field="'+e+'"]'));var o=this.getColumn(e);if(!r&&o.fixed)if("left"===o.fixed){var s=this.el.nativeElement.querySelector("#"+i+"_fixedleft");r=s&&s.querySelector('[field="'+e+'"]')}else if("right"===o.fixed){var l=this.el.nativeElement.querySelector("#"+i+"_fixedright");r=l&&l.querySelector('[field="'+e+'"]')}r&&r.editCell&&(this.currentCell=null,r.editCell())}},t.prototype.endCellEdit=function(t){if(this.currentCell&&(it.removeClass(this.currentCell.cellElement,A),this.currentCell.isEditing)){this.currentCell.cellEditorRef&&this.currentCell.cellEditorRef.hideCover();var e=this.currentCell.cellElement.closeEdit();e&&e.subscribe()}},t.prototype.editRow=function(t){var e=this;if(!this.editable||"row"!==this.editMode)return!1;if(t&&this.selectRow(t),!this.selectedRow||-1===this.selectedRow.index)return console.warn("Please select a row."),!1;var i=S({},this.selectedRow),n=i.index,r=i.data,o=this.beforeEdit({rowIndex:n,rowData:r,gridInstance:this});if(o&&o.subscribe){var s="row_"+t,l=this.el.nativeElement.querySelector("#"+s);this.selectedRow.dr||l.click(),o.subscribe(function(t){if(t&&e.selectedRow.dr){var i=e.selectedRow.dr.cells.toArray();if(!i||!i.length)return;i.forEach(function(t){t.column.editor&&(t.isEditing=!0)}),e.selectedRow.dr.cd.detectChanges(),setTimeout(function(){var t=i.map(function(t){if(t.cellEditor)return t.cellEditor.componentRef}).filter(function(t){return t});e.selectedRow.editors=t,t&&t.length&&t[0].instance.inputElement&&t[0].instance.inputElement.focus(),e.bindRowEditorKeydownEvent(),e.cd.destroyed||e.cd.detectChanges(),e.beginEdit.emit({rowIndex:n,rowData:r,gridInstance:e,editor:t})})}})}else console.warn("please return an Observable Type.")},t.prototype.endRowEdit=function(){var t=this;if(!this.isRowEditing())return{canEnd:!0};if(this.selectedRow&&-1!==this.selectedRow.index){var e=S({},this.selectedRow),i=e.index,n=e.data,r=e.dr,o=S({},this.currentCell),s=o.editor,l=o.column;if(document.body.click(),this.pending)return{canEnd:!1};var a=r.form;if(a.markAsTouched(),a.invalid&&!this.endEditByInvalid)return{canEnd:!1};var c=this.afterEdit(i,n,l,s);if(!c||!c.subscribe)return console.warn("please return an Observable Type."),{canEnd:!1};c.subscribe(function(e){if(e){t.closeAllCellEditor(),t.selectedRow.dr.form&&(t.selectedRow.dr.rowData=Object.assign(t.selectedRow.dr.rowData,t.selectedRow.dr.form.value),t.dfs.updateRow(t.selectedRow.id,t.selectedRow.dr.rowData),t.cd.detectChanges());var r="";s&&s.formControl&&(r=s.formControl.value),t.endEdit.emit({rowIndex:i,rowData:n,column:l,value:r}),t.dgs.refreshFooterData.emit()}})}else console.warn("Please select a row.")},t.prototype.cancelEdit=function(t,e){void 0===e&&(e=!0),this.isEditing()&&(this.closeAllCellEditor(),t&&this.dfs.rejectChanges(t),this.cd.detectChanges(),e&&this.cancelEdited.emit())},t.prototype.closeAllCellEditor=function(){if(this.selectedRow&&this.selectedRow.dr){var t=this.selectedRow.dr.cells;t&&(t.forEach(function(t){return t.isEditing=!1}),this.currentCell&&(this.currentCell.isEditing=!1)),this.selectedRow.editors=null}this.unbindRowEditorKeydownEvent()},t.prototype.rowEditTabKeydwonEvent=function(t){var e=this;if(9===(t.which||t.keyCode)){var i=t.target.closest("td"),n=t.target.closest("tr"),r=i.nextElementSibling,o=function(t){return!t.querySelector("input")&&!t.querySelector("textarea")&&!t.querySelector("select")},s=function(){var t=n.nextElementSibling;if(t){t.click();var i=t.getAttribute("id").replace("row_","");i&&e.editRow(i)}};if(r){if(o(r)){var l=n.querySelectorAll("td"),a=-1;l.forEach(function(t,e){t===r&&(a=e)});for(var c=!0;a<l.length;){if(!o(l[a])){c=!1;break}a++}c&&s()}}else s()}t.stopPropagation()},t.prototype.bindRowEditorKeydownEvent=function(){var t=this;this.documentRowEditKeydownHanlder||(this.documentRowEditKeydownHanlder=this.render2.listen(document,"keydown",this.rowEditTabKeydwonEvent.bind(this))),this.documentClickEndRowEditHandler=this.render2.listen(document,"click",function(e){if(t.pending)return!1;U.hasDialogOpen()||t.isRowEditing()})},t.prototype.unbindRowEditorKeydownEvent=function(){this.documentRowEditKeydownHanlder&&(this.documentRowEditKeydownHanlder(),this.documentRowEditKeydownHanlder=null),this.documentClickEndRowEditHandler&&(this.documentClickEndRowEditHandler(),this.documentClickEndRowEditHandler=null)},t.prototype._clientFilter=function(t,e){if(void 0===e&&(e=!1),e){var i=this.dfs.getData(!0);if(t&&Object.keys(t).length){var n=this.clientFilterService.executeFilter(i,t);this.dfs.loadFilterData(n)}else this.loadData(i,!1,!0)}this.virtualized||this.scrollToTop(),this.filterChanged.emit(t)},t.prototype.smartFilterData=function(t){if(this.remoteFilter){var e=this.clientFilterService.convertSmartFilter2EntityFilter(t);this.filterChanged.emit(e)}else this._clientFilter(t,this.useDefaultFilter)},t.prototype.onClearSmartFilters=function(t){var e=this;this.smartFilterResult={conditions:[],controlData:[]},this.conditions=[],this.smartFilterData([]),this.smartFilterService.clearAll(),setTimeout(function(){e.onFilterBarResize(0)})},t.prototype.onRemoveSmartFilterItem=function(t){if(t){var e=S({},t);e.labelCode=t.fieldCode,this.smartFilterService.removeCondition(e,!0)}},t.prototype.onFilterBarResize=function(t){this.filterBarHeight=t;var e=this.el.nativeElement.querySelector(".f-datagrid-column-drop-panel");e&&!t&&(e.style.top="0px"),this.dgs.showGridHeader.emit(this.realHeaderHeight),this.dgs.smartFilterBarExpand.emit()},t.prototype.onSmartFilterChange=function(t){var e=t.conditions,i=t.filterItem;this.smartFilterService.filterConditionChanged({conditions:e,controlData:i}),this.dgs.smartFilterDataChange.emit(i)},t.prototype.filterData=function(t){if(t?this.conditions=t:t=this.conditions,this.scrollToTop(),this.enableSmartFilter)this.smartFilterData(t);else if(this.remoteFilter){var e=this.clientFilterService.convert2FilterArray(t);this.filterChanged.emit(e)}else this._clientFilter(t,!0)},t.prototype.clearCondition=function(){this.dgs.onClearFilter()},t.prototype.loadData=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!0),this.loading&&this.closeLoading(!this.pagination),t=t||[],i&&this.scrollInstance&&this.scrollInstance.instance){var n=this.scrollInstance.instance.lastScrollTop,r=this.scrollInstance.instance.lastScrollLeft;this.dfs.updateProperty("scrollInfo",{y:n,x:r})}else this.dfs.updateProperty("scrollInfo",{y:0,x:0});this.pagination&&(this.dfs.setPagination(this.pageIndex,this.pageSize,this.total),this.updatePagerOptions(),this.cd.detectChanges()),this.data=t,e?this.remoteSort?this.dfs.loadData(t):this.dfs.loadData(t,!0,!0):this.dfs.loadData(t),this.setPagerHeight(),this.dgs.dataSourceChanged()},t.prototype.loadVirtualData=function(t){this.groupRows?console.warn('if you using GROUPROWS, please set [virtualized]="false" [virtualizedAsyncLoad]="false"'):this.virtualizedAsyncLoad&&this.dgs.onLoadVirtualData(t)},t.prototype.fetchData=function(t,e){if(this.restService){this.showLoading();var i={pageIndex:t,pageSize:e};return this.sortName&&(i.sortName=this.sortName),this.sortOrder&&(i.sortOrder=this.sortOrder),this.restService.getData(this.url,i)}return n.of(undefined)},t.prototype.refresh=function(){this.dfs.refresh()},t.prototype.reload=function(){var t=this;this.fetchData(1,this.pageSize).subscribe(function(e){e&&(t.pageIndex=1,t.total=e.total,t.loadData(e.items))})},t.prototype.getRows=function(){return this.groupRows||this.virtualized?this.pagerOnServer?this.ds.rows:this.currentPagerData:this.pagerOnServer?this.data:this.currentPagerData},t.prototype.setPageIndex=function(t,e){void 0===e&&(e=!0),this.pageIndex=t,this.pagerOpts.currentPage=t,e&&this.cd.detectChanges()},t.prototype.setPageList=function(t,e){void 0===e&&(e=!0),this.pageList=t,this.pagerOpts.pageList=t,e&&this.cd.detectChanges()},t.prototype.onPageChange=function(t){var e=this;this.lockPagination||(this.controlPaginationState&&this.setPageIndex(t,!1),this.fetchData(t,this.pageSize).subscribe(function(t){t&&e.loadData(t.items)}),this.focusRowIndex=-1,this.scrollToTop(),this.pageChanged.emit({pageIndex:t,pageSize:this.pageSize}))},t.prototype.onPageSizeChange=function(t){var e=this;this.lockPagination||(this.focusRowIndex=-1,this.scrollToTop(),this.pageSize=t,this.pagerOpts.itemsPerPage=t,this.fetchData(1,t).subscribe(function(t){t&&(e.pageIndex=1,e.loadData(t.items))}),this.pageSizeChanged.emit({pageSize:t,pageIndex:this.pageIndex}))},t.prototype.onRemoveSelectedItem=function(t){this.dfs.findRowIndex(t)>-1?(this.unCheckRow(t),this.cd.detectChanges()):(this.unCheckRow(t,!1),this.checkValues=this.checkeds.map(function(t){return t.id}))},t.prototype.onClearSelectedItem=function(t){this.selectOnCheck&&(this.selectValue=""),this.clearCheckeds(!0)},t.prototype.showLoading=function(){this.loading=!0,this.cd.detectChanges()},t.prototype.closeLoading=function(t){void 0===t&&(t=!0),this.loading=!1,t&&this.cd.detectChanges()},t.prototype.replacePX2Empty=function(t){return t?Number.parseInt(t.replace("px",""),10):0},t.prototype.renderCustomCls=function(t,e){var i=this;t&&("!"===t[0]?t.slice(1).split(" ").filter(function(t){return t}).forEach(function(t){t&&i.render2.removeClass(e,t)}):t.split(" ").filter(function(t){return t}).forEach(function(t){t&&i.render2.addClass(e,t)}))},t.prototype.renderCustomStyle=function(t,e,i){void 0===i&&(i=null),t&&(t.cls&&this.renderCustomCls(t.cls,e),t.style&&(i||(i=this.customStyleKey()+" #"+e.id+" "+JSON.stringify(t.style)),this.dgs.appendCssRules([i])))},t.prototype.getBoundingClientRect=function(t){return t.nativeElement.getBoundingClientRect()},t.prototype.getElementPadding=function(t){var e=getComputedStyle(t);return{top:this.replacePX2Empty(e.paddingTop),left:this.replacePX2Empty(e.paddingLeft),bottom:this.replacePX2Empty(e.paddingBottom),right:this.replacePX2Empty(e.paddingRight)}},t.prototype.getElementBorderWidth=function(t){var e=getComputedStyle(t);return{top:this.replacePX2Empty(e.borderTopWidth),bottom:this.replacePX2Empty(e.borderBottomWidth),right:this.replacePX2Empty(e.borderRightWidth),left:this.replacePX2Empty(e.borderLeftWidth)}},t.prototype.formatData=function(t,e,i){var n=this.getFieldValue(t,e);return this.colFormatSer.format(n,e,i)},t.prototype.getFieldValue=function(t,e){return U.getValue(t,e)},t.prototype.canOperateCheckbox=function(){return this.multiSelect&&this.showCheckbox},t.prototype.findNextCell=function(t,e){var i=null;if(this.currentCell&&this.currentCell.cellElement){var n=this.dfs.getColumn(t).fixed||"",r=this.dfs.getColumnIndex(t,n);"left"===n&&(this.showCheckbox&&(r+=1),this.showLineNumber&&(r+=1));var o=this.currentCell.cellElement;if("up"===e){var s=this.dgs.findNextTr(o.parentElement.previousElementSibling,"up");s&&(i=s.children[r])}else if("down"===e){var l=this.dgs.findNextTr(o.parentElement.nextElementSibling,"down");l&&(i=l.children[r])}else"left"===e?i=o.previousElementSibling:"right"===e&&(i=o.nextElementSibling)}return i},t.prototype.selectNextCell=function(t,e){var i=this.findNextCell(this.currentCell.field,t);if("up"!==t||i){if(i)return"Tab"===e.code&&this.editable&&this.editcellWhenTabKeydwon?i.click.apply(i,[e]):i.selectCell(e,i),i;var n=this.currentCell.cellElement.parentElement,r=n.nextElementSibling;"left"===t&&(r=n.previousElementSibling);var o=this.dgs.findNextTr(r,"left"===t?"up":"down");if(o&&"TR"===o.tagName){o.children[0].selectCell(e,o.children[0])}}},t.prototype.selectNextRow=function(){if(this.selectedRow){var t=this.selectedRow.dr.el.nativeElement;t.nextElementSibling&&t.nextElementSibling.click()}},t.prototype.selectPrevRow=function(){if(this.selectedRow){var t=this.selectedRow.dr.el.nativeElement;t.previousElementSibling&&t.previousElementSibling.click()}},t.prototype.removeCellSelectedCls=function(){var t=this,e=this.el.nativeElement.querySelectorAll("."+A);e.length&&e.forEach(function(e){t.render2.removeClass(e,A)})},t.prototype.selectRow=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=!1),this.removeCellSelectedCls(),!this.multiSelect&&this.showCheckbox&&this.clearCheckeds(!1,!1),"default"===this.selectionMode&&this.clearAll(),!t||this.selectedRow&&this.selectedRow.id==t)this.checkOnSelect&&this.checkRows([t]);else{var n=this.dfs.findRow(t);if(n&&this.disableRow&&this.disableRow(n.data,n.index))return;e?this.dfs.selectRecord(t):(this.dfs.setSelectRow(t),this.selectedRow=this.dfs.getCurrentRow(),this.checkOnSelect&&this.checkRows([t]),this.dgs.setSelecedRow.emit({id:t,selected:!0}))}i&&this.scrollToCurrentRow()},t.prototype.scrollToCurrentRow=function(){this.dgs.scrollToCurrentRow.next()},t.prototype.unSelectRow=function(t,e){void 0===e&&(e=!0),t&&(this.closeAllCellEditor(),this.currentCell&&this.currentCell.rowId==t&&this.cancelSelectCell(),e?this.dfs.selectRecord(t,!1):(this.dfs.setSelectRow(t,!1),this.selectedRow=null,this.dgs.setSelecedRow.emit({id:t,selected:!1})))},t.prototype.selectAllRows=function(){this.multiSelect&&this.dfs.selectAll()},t.prototype.cancelSelectCell=function(){this.currentCell&&(this.currentCell.cellElement.cancelSelected(),this.currentCell.isEditing||(this.currentCell=null,this.dfs.cancelSelectCell()))},t.prototype.clearSelections=function(t){this.dfs.clearSelections(t),this.selectedRow=null,this.cancelSelectCell(),this.cd.detectChanges()},t.prototype.checkRow=function(t,e){void 0===e&&(e=!0),this.canOperateCheckbox()&&(e?this.dfs.checkRecord(t):this.checkRows([t]))},t.prototype.checkRows=function(t,e){void 0===e&&(e=!1),t&&t.length&&(this.dfs.setCheckedRows(t,!0),this.dgs.setCheckedRows.next({ids:t,checked:!0}),"default"===this.selectionMode&&this.dfs.updateProperty("selections",this.checkeds),e&&(this.checkValues=this.checkeds.map(function(t){return t.id}),this.checkValuesChange.emit(this.checkValues),this.checkedChange.emit(this.checkeds)))},t.prototype.unCheckRows=function(t,e){void 0===e&&(e=!1),t&&t.length&&(this.dfs.setCheckedRows(t,!1),this.dgs.setCheckedRows.next({ids:t,checked:!1}),e&&(this.checkValues=this.checkeds.map(function(t){return t.id}),this.checkValuesChange.emit(this.checkValues),this.checkedChange.emit(this.checkeds)))},t.prototype.checkAllRows=function(t){void 0===t&&(t=!0),this.canOperateCheckbox()&&(this.dfs.checkAll(),this.dgs.checkAll.emit(),t&&this.checkAll.emit())},t.prototype.unCheckRow=function(t,e){void 0===e&&(e=!0),this.canOperateCheckbox()&&(this.currentCell&&this.currentCell.rowId==t&&this.cancelSelectCell(),e?this.dfs.checkRecord(t,!1):this.unCheckRows([t]))},t.prototype.clearCheckeds=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this.dfs.clearCheckeds(t),this.checkValues=[],this.cancelSelectCell(),e&&this.dgs.uncheckAll.emit()},t.prototype.clearAll=function(){this.dfs.clearAll(),this.checkValues=[],this.dgs.uncheckAll.emit()},t.prototype.getResizeProxyPosLeft=function(t){var e=t.target,i=this.getBoundingClientRect(this.dgContainer),n=e.parentElement,r=n.getBoundingClientRect().left,o=n.offsetWidth-(t.pageX-r);return this.resizeColumnInfo.proxyLineEdge=o,this.resizeColumnInfo.startWidth=n.offsetWidth,this.resizeColumnInfo.startX=t.pageX,this.resizeColumnInfo.left=r-i.left-1+o,t.pageX-i.left-1+o},t.prototype.toggleResizeProxy=function(t){void 0===t&&(t=!0);var e="block";t||(e="none"),this.render2.setStyle(this.resizeProxyBg.nativeElement,"display",e),this.render2.setStyle(this.resizeProxy.nativeElement,"display",e)},t.prototype.onColumnResizeBegin=function(t){if(this.resizeProxy){this.render2.setStyle(document.body,"cursor","e-resize");var e=this.resizeProxy.nativeElement,i=this.getResizeProxyPosLeft(t);this.render2.setStyle(e,"left",i+"px");var n=0;if((this.enableFilterRow||this.enableSmartFilter)&&this.showFilterBar&&(n+=this.filterBarHeight),this.showRowGroupPanel&&(n+=this.rowGroupPanelHeight),this.render2.setStyle(e,"top",n+"px"),this.autoHeight){var r=0;this.pagination&&(r+=this.pagerHeight),this.showFooter&&(r+=this.footerHeight),this.render2.setStyle(e,"height","calc(100% - "+r+"px)")}else this.render2.setStyle(e,"height",this.height-this.pagerHeight+"px");this.toggleResizeProxy()}},t.prototype.onColumnResize=function(t){var e=this.resizeProxy.nativeElement,i=this.getBoundingClientRect(this.dgContainer),n=t.pageX-i.left-1+this.resizeColumnInfo.proxyLineEdge;n-this.resizeColumnInfo.left>20?this.render2.setStyle(e,"left",n+"px"):this.render2.setStyle(e,"left",this.resizeColumnInfo.left+20+"px"),t.stopPropagation(),t.preventDefault()},t.prototype.onColumnResizeEnd=function(t,e){var i=this;this.render2.removeStyle(document.body,"cursor"),this.toggleResizeProxy(!1),this.resizeColumnInfo.proxyLineEdge=0;var n=this.resizeColumnInfo.startWidth+t.pageX-this.resizeColumnInfo.startX;if(n<20&&(n=20),e.width>n){var r=e.width-n;if(!this.fitColumns&&this.scrollInstance.elementRef.nativeElement.scrollLeft){var o=this.scrollInstance.elementRef.nativeElement.scrollLeft-r;this.scrollInstance.scrollToX(o)}}e.width=n,this.useControlPanel&&this.settingService?this.settingService.saveUserConfig(this.id).subscribe(function(){i.dfs.columnResizeEnd(),i.dgs.columnResized.emit()}):(this.dfs.columnResizeEnd(),this.dgs.columnResized.emit())},t.prototype.restituteColumnsSize=function(){this.dfs.resizeColumns(!0),this.dgs.columnResized.emit()},t.prototype.sizeToContent=function(t,e){if(!this.AutoColumnWidthUseDblclick)return!1;for(var i="",n=this.data,r=n.length-1;r>=0;r--){var o=U.getValue(t.field,n[r]);0!==o&&(o=o||"");var s=""+o;if(t.formatter&&o!==undefined&&(s=this.colFormatSer.format(o,n[r],t.formatter)),U.getBLen(s)>U.getBLen(i))i=s;else{this.longTextArea.nativeElement.innerHTML=s;var l=this.longTextArea.nativeElement.offsetWidth;this.longTextArea.nativeElement.innerHTML=i,l>this.longTextArea.nativeElement.offsetWidth&&(i=s)}}this.longTextArea.nativeElement.innerHTML=i;var a=this.longTextArea.nativeElement.offsetWidth+26;this.longTextArea.nativeElement.innerHTML=e.nativeElement.innerText;var c=this.longTextArea.nativeElement.offsetWidth+26;t.sortable&&(c+=24),t.width=a>c?a:c,this.flatColumns.findIndex(function(e){return e.field===t.field})===this.flatColumns.length-1&&(t.width+=6),this.dfs.resizeColumns(),this.dgs.columnResized.emit()},t.prototype.getChanges=function(){return this.dfs.getChanges()},t.prototype.acceptChanges=function(){this.dfs.acceptChanges()},t.prototype.rejectChanges=function(){this.dfs.rejectChanges()},t.prototype.appendRow=function(t){this.cancelEdit(null),this.dfs.appendRow(t),this.dataChange.emit(this.dfs.getData()),this.rowAppended.emit()},t.prototype.updateRow=function(t,e){this.dfs.updateRow(t,e),this.dataChange.emit(this.dfs.getData()),this.rowUpdated.emit()},t.prototype.refreshRow=function(t){var e=this.dfs.findRow(t);e&&e.data?this.dfs.rowUpdate$.emit(e):console.warn("Can not found row by id. id: "+t)},t.prototype.deleteRow=function(t){if(this.cancelEdit(t,!1),!t){if(!this.selectValue)throw new Error("删除行时主键标识ID 不能为空。");t=this.selectValue}var e=this.dfs.deleteRow(t);this.dataChange.emit(this.dfs.getData()),this.currentCell=null,this.dfs.updateProperty("currentCell",null),this.cd.detectChanges(),this.rowDeleted.emit(e)},t.prototype.validateRow=function(){},t.prototype.insertRow=function(){},t.prototype.scrollToLeft=function(){this.scrollInstance&&this.scrollInstance.scrollToLeft(0,200)},t.prototype.scrollToRight=function(){this.scrollInstance&&this.scrollInstance.scrollToRight(0,200)},t.prototype.scrollToTop=function(){this.scrollInstance&&(this.scrollInstance.scrollToTop(0,100),this.dfs.updateProperty("scrollInfo",{y:0,x:0}))},t.prototype.scrollToBottom=function(){this.scrollInstance&&this.scrollInstance.scrollToBottom(0,100)},t.prototype._setColumnReadonly=function(t,e,i){if(void 0===i&&(i=!0),t&&t.length&&e){var n=t.find(function(t){return t.field===e});n&&(n.readonly=i)}},t.prototype.setColumnReadonly=function(t,e){void 0===e&&(e=!0),this._setColumnReadonly(this.colGroup.leftFixed,t,e),this._setColumnReadonly(this.colGroup.rightFixed,t,e),this._setColumnReadonly(this.colGroup.normalColumns,t,e)},t.prototype.isMultiHeader=function(){return this.columns&&this.columns.length>1&&Array.isArray(this.columns[1])},t.prototype.toggleVisibleColumn=function(t,e){if(void 0===e&&(e=!0),this.isMultiHeader()){var i=o.flatten(this.columns);i.forEach(function(t){t.origianlColSpan===undefined&&(t.origianlColSpan=t.colspan)}),t.forEach(function(t){var n=i.find(function(e){return e.field===t||e.id===t});if(n){if(n.visible===e)return;n.visible=e;var r=Y.getParentColumns(n,i),o=Y.getChildColumns(n,i);o.forEach(function(t){t.visible=e}),e&&o.length&&(n.colspan=n.origianlColSpan);var s=n.colspan||1;r.forEach(function(t){if(e){var n=i.filter(function(e){return e.parentId===t.id&&e.visible});t.colspan=n.reduce(function(t,e){return t+=e.colspan||1},0)}else t.colspan=t.colspan-s;t.visible=!!t.colspan})}})}else this.columns.forEach(function(i){t.forEach(function(t){var n=i.find(function(e){return e.field===t||e.id===t});n&&(n.visible=e)})})},t.prototype.getColumn=function(t){return o.flatten(this.columns).find(function(e){return e.field===t||e.id===t})},t.prototype.showColumn=function(t){"string"==typeof t?this.toggleVisibleColumn([t],!0):this.toggleVisibleColumn(t,!0),this.columnsChanged()},t.prototype.hideColumn=function(t){"string"==typeof t?this.toggleVisibleColumn([t],!1):this.toggleVisibleColumn(t,!1),this.columnsChanged()},t.prototype.updateColumn=function(t,e,i){void 0===i&&(i=!0),this.columns.forEach(function(i){var n=i.find(function(e){return e.field===t});n&&(n=Object.assign(n,e))}),i&&this.columnsChanged()},t.prototype.setColumnFormatter=function(t,e){this.columns.forEach(function(i){var n=i.find(function(e){return e.field===t});n&&(n.formatter=e)}),this.columnsChanged()},t.prototype.updateColumnFormatterOptions=function(t,e){this.columns.forEach(function(i){var n=i.find(function(e){return e.field===t});if(n&&n.formatter){var r=n.formatter;r.options=r.options||{},r.options=Object.assign(r.options,e||{})}}),this.columnsChanged()},t.prototype.setColumnTitle=function(t,e){this.columns.forEach(function(i){var n=i.find(function(e){return e.field===t});n&&(n.title=e)}),this.columnsChanged()},t.prototype.sort=function(t,e){null===t||""===t||null===e||""===e?this.clearSort():(t&&e&&(this.sortName=t,this.sortOrder=e,this.dfs.setSortInfo(this.sortName,this.sortOrder)),this.remoteSort||this.dfs.clientSort(),this.onColumnSorted())},t.prototype.clearSort=function(){this.sortName="",this.sortOrder="",this.dfs.setSortInfo("",""),this.remoteSort||this.data&&this.data.length&&this.dfs.clearSort(),this.onColumnSorted()},t.prototype.onColumnSorted=function(){var t=null;if(this.sortName&&this.sortOrder){var e=this.sortOrder.split(",");t=this.sortName.split(",").reduce(function(t,i,n){return t[i]=e[n]||"asc",t},{})}this.remoteSort||this.dfs.clientSort(),this.columnSorted.emit(t)},t.prototype.updateSortInfo=function(t,e){var i=this,n=this.sortName,r=this.sortOrder,o=[],s=[];n&&(o=n.split(","),s=r.split(","));var l=t.split(","),a=e.split(",");l.forEach(function(t,e){var n=a[e]||"asc",r=n,l=o.findIndex(function(e){return e===t});if(l>=0){var c="asc"===s[l]?"desc":"asc";r=c,i.multiSort&&"asc"===r?(r=undefined,o.splice(l,1),s.splice(l,1)):s[l]=c}else i.multiSort?(o.push(t),s.push(n)):(o=[t],s=[n])}),this.sortName=o.join(","),this.sortOrder=s.join(",")},t.prototype.showControlPanel=function(t){t.stopPropagation();if(this.useControlPanel&&this.settingService){if(!this.settingService.httpRestService){var e=this.inject.get(P,null);this.settingService.httpRestService=e}this.settingService.show(this)}},t.prototype.disableHeader=function(t){void 0===t&&(t=!0),this.dgs.disableHeader.emit(t)},t.prototype.userProfileSetting=function(t){var e=this,i=t.sortInfo,n=t.viewColumns,r=t.groupField,o=t.columnFormat,s=i.sortName,l=i.sortOrder;i&&(s&&s.length&&(this.sortName=s.join(","),l&&(this.sortOrder=l.join(","))),this.__sortInfo=i),n&&n.length&&(this.columns=this.columns.map(function(t){return e.settingService.updateColumnFormat(t,o,e),e.settingService.newVisibleOrderColumns(t,n,o)}),this.addControlCol(),this.columns.forEach(function(t){t.forEach(function(t){if(s&&s.length){var e=s.indexOf(t.field);e>-1&&(t.order=l[e])}})})),this.groupRows&&r&&(this.groupField=r)},t.prototype.isActived=function(){return it.hasClass(this.dgContainer.nativeElement,this._active_datagrid_cls)},t.prototype.cleanDom=function(){var t=document.querySelectorAll(".datagrid-cell-tooltip");t&&t.length&&t.forEach(function(t){t.remove()})},t.prototype.cellIsReadOnly=function(t,e){var i=!1;return this.disableRow&&(i=this.disableRow(e)),i||t.readonly!==undefined&&("boolean"==typeof t.readonly?i=t.readonly:"function"==typeof t.readonly&&(i=t.readonly(e))),i},t.prototype.groupFieldChanged=function(){this.columnsChanged(),this.settingService&&this.settingService.saveUserConfig(this.id).subscribe(),this.groupFieldChange.emit({newGroupField:this.groupField,grid:this})},t.prototype.removeGroupField=function(t){var e=this.groupField.split(","),i=e.indexOf(t);i>-1&&e.splice(i,1).join(","),this.groupField=e.join(","),this.toggleVisibleColumn([t],!0),this.groupFieldChanged()},t.prototype.clearAllGrouppingField=function(t){var e=this;this.showLoading(),setTimeout(function(){var t=e.groupField.split(",");e.groupField="",e.toggleVisibleColumn(t,!0),e.groupFieldChanged(),e.closeLoading()})},t.prototype.setGroupFields=function(t){this.groupField=t,this.columnsChanged()},t.prototype.activeDataGrid=function(t){var e=this;void 0===t&&(t=!0);var i=document.querySelectorAll(".f-datagrid.datagrid-active");i.length&&i.forEach(function(t){e.render2.removeClass(t,e._active_datagrid_cls)}),t&&this.render2.addClass(this.dgContainer.nativeElement,this._active_datagrid_cls)},t.prototype.onDatagridContainerFocus=function(t){this.disabled||this.activeDataGrid()},t.decorators=[{type:e.Component,args:[{selector:"farris-datagrid",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-10 11:02:50\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-18 15:48:39\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n<div #datagridContainer class="f-datagrid" \r\n    [class.f-datagrid-rowhover]="rowHover"\r\n    [class.f-datagrid-bordered]="showBorder"\r\n    [class.f-datagrid-wrap]="!nowrap"\r\n    [class.f-datagrid-strip]="striped"\r\n    [class.f-datagrid-mergecell]="mergeCell"\r\n    [class.f-datagrid-enable-highlight]="enableHighlightCell"\r\n    [class.highlight-allowedit-cell]="enableEditCellStyle && editable"\r\n    [class.scrollbar-allways-show]="scrollBarShowMode === \'allways\'"\r\n    [class.f-datagrid-sm]="sizeType === \'sm\'" [class.f-datagrid-lg]="sizeType === \'lg\'" [class.f-datagrid-xl]="sizeType === \'xl\'"\r\n    [ngStyle]="gridSize" tabindex="0" style="outline: 0;" hidefocus="true" [attr.id]="id"\r\n    *ngIf="!useHtmlTable" (focus)="onDatagridContainerFocus($event)">\r\n    <div class="f-datagrid-column-drop-panel d-flex flex-row"\r\n        [style.height.px]="rowGroupPanelHeight"\r\n        [style.top.px]="showFilterBar ? (filterBarHeight): 0"\r\n        [attr.placeholder]="groupField ? \'\': groupRowPanelPlaceholder"\r\n        [style.pointer-events]="editable ? \'none\': \'\'"\r\n        *ngIf="showRowGroupPanel">\r\n        <div class="row-group-fields flex-fill" drop-column style="display: inline-block!important;">\r\n            <div class="group-field smooth-dnd-draggable-wrapper" *ngFor="let f of groupFields$ | async">{{ dfs.getColumn(f)?.title }}\r\n                <span class="f-icon f-icon-x" title="{{ \'datagrid.groupRow.removeColumn\'| locale }}" (click)="removeGroupField(f)"></span>\r\n            </div>\r\n        </div>\r\n        <button class="f-datagrid-clear-group-field btn btn-light ml-auto"\r\n        title="{{\'datagrid.groupRow.clearTip\' | locale}}" (click)="clearAllGrouppingField($event)" [style.display]="groupField ? \'\' : \'none\'">\r\n            <span class="f-icon f-icon-remove"></span> {{\'datagrid.groupRow.clear\' | locale}}\r\n        </button>\r\n    </div>\r\n    \r\n    <filter-toolbar #filterText *ngIf="enableFilterRow && showFilterBar"></filter-toolbar>\r\n    <smart-filter-toolbar #smartfiltertoolbar *ngIf="enableSmartFilter && showFilterBar"\r\n    [height]="filterBarHeight"\r\n    [filterData]="smartFilterResult?.controlData || []" \r\n    (clearFilters)="onClearSmartFilters($event)"\r\n    (removeFilter)="onRemoveSmartFilterItem($event)"\r\n    [padding]="showBorder && filterBarHeight ? \'3px\': \'\'"\r\n    (resize)="onFilterBarResize($event)"\r\n    (filterChange)="onSmartFilterChange($event)"></smart-filter-toolbar>\r\n\r\n    <datagrid-header class="d-flex flex-fill" *ngIf="showHeader" #header\r\n    [columns]="columns" [columnsGroup]="colGroup" [height]="realHeaderHeight"\r\n    [style.height.px]="realHeaderHeight" style="position: relative;width:100%;" \r\n    [enableDragColumn]="enableDragColumn" [wrapHeader]="headerWrap"\r\n    [enableFilterRow]="enableFilterRow" [scrollbarMode]="scrollBarShowMode"></datagrid-header>\r\n\r\n\r\n    <datagrid-footer [height]="footerHeight" [width]="footerWidth" [columnsGroup]="colGroup" [position]="\'top\'"\r\n    [columns]="colGroup?.normalColumns" [data]="footerData | async" *ngIf="(footerPosition===\'top\' || footerPosition === \'both\') && showFooter && ((ds && ds.rows && ds.rows.length) || (footerData | async).length)"></datagrid-footer>\r\n\r\n    <datagrid-body [columnsGroup]="colGroup" [data]="ds.rows | paginate: pagerOpts" (dataChange)="setCurrentPagerData($event)"\r\n        [startRowIndex]="ds.index" [checkedRows]="checkedRows" cell-tooltip [canvasWidth]="colGroup?.totalWidth"\r\n        [topHideHeight]="ds.top" [bottomHideHeight]="ds.bottom" [footerHeight]="footerHeight"\r\n        [scrollBarMode]="scrollBarShowMode" [contextMenuItems]="contextMenus" ></datagrid-body>\r\n\r\n    <datagrid-footer [height]="footerHeight" [width]="footerWidth" [columnsGroup]="colGroup" [position]="\'bottom\'"\r\n                [columns]="colGroup?.normalColumns" [data]="footerData | async" \r\n                *ngIf="(footerPosition===\'bottom\' || footerPosition === \'both\') && showFooter && ((ds && ds.rows && ds.rows.length) || (footerData | async).length)"></datagrid-footer>\r\n    \r\n    <datagrid-pager *ngIf="pagination" #dgPager \r\n        [showPageList]="showPageList"\r\n        [id]="pagerOpts.id" [locked]="lockPagination"\r\n        [showPageInfo]="showPageInfo"\r\n        [viewMode]="pagerViewMode"\r\n        [showPageNumber] = "showPageNumber"\r\n        [maxSize]="pagerLabelSize"\r\n        [showSelectedList]="showSelectedList && multiSelect"\r\n        [selectedData]="checkedRows"\r\n        [showGotoInput]="showGotoInput"\r\n        (pageChange)="onPageChange($event)"\r\n        (pageSizeChange)="onPageSizeChange($event)"\r\n        (removeSelectedItem)="onRemoveSelectedItem($event)"\r\n        (clearSelectedItem)="onClearSelectedItem($event)"\r\n        [listItemFormatter]="selectedItemFormatter"\r\n        ></datagrid-pager>\r\n\r\n    <div class="f-datagrid-resize-bg" #resizeProxyBg></div>\r\n    <div #resizeProxy class="f-datagrid-resize-proxy" *ngIf="resizeColumn"></div>\r\n    \r\n    <datagrid-loading *ngIf="loading"></datagrid-loading>\r\n    <div style="position: absolute; left: -1000px; top: -1000px;visibility: hidden;" #longTextArea></div>\r\n    <div class="f-datagrid-disabled" style="position: absolute;\r\n        background: #fff;\r\n        height: 100%;\r\n        width: 100%;\r\n        z-index: 99;\r\n        opacity: .3;" *ngIf="disabled">\r\n    </div>\r\n</div>\r\n\r\n\r\n<div #datagridContainer\r\nclass="f-datagrid f-datagrid-htmltable" [attr.id]="id"\r\n[class.f-datagrid-rowhover]="rowHover"\r\n[class.f-datagrid-bordered]="showBorder"\r\n[class.f-datagrid-wrap]="!nowrap"\r\n[class.f-datagrid-strip]="striped" \r\n[class.f-datagrid-md]="sizeType === \'md\'"\r\n[class.f-datagrid-sm]="sizeType === \'sm\'" [class.f-datagrid-lg]="sizeType === \'lg\'" [class.f-datagrid-xl]="sizeType === \'xl\'"\r\n*ngIf="useHtmlTable" style="border-right: 0px; border-bottom: 0px; overflow: auto">\r\n\r\n    <auto-height [columnsGroup]="colGroup" [columns]="columns" [data]="ds.rows"></auto-height>\r\n</div>\r\n',encapsulation:e.ViewEncapsulation.None,changeDetection:e.ChangeDetectionStrategy.OnPush,providers:[K,Z,wt],exportAs:"datagrid"}]}],t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:e.ElementRef},{type:e.Injector},{type:e.NgZone},{type:K},{type:Z},{type:e.ApplicationRef},{type:g.DomSanitizer},{type:e.Renderer2}]},t.propDecorators={pos:[{type:e.HostBinding,args:["style.position"]}],hostCls:[{type:e.HostBinding,args:["class.f-datagrid-full"]}],autoHeightCls:[{type:e.HostBinding,args:["class.f-datagrid-auto-height"]}],useThemes:[{type:e.Input}],id:[{type:e.Input}],useHtmlTable:[{type:e.Input}],autoHeight:[{type:e.Input}],showBorder:[{type:e.Input}],striped:[{type:e.Input}],width:[{type:e.Input}],height:[{type:e.Input}],showHeader:[{type:e.Input}],headerHeight:[{type:e.Input}],headerWrap:[{type:e.Input}],showFooter:[{type:e.Input}],footerHeight:[{type:e.Input}],footerDataFrom:[{type:e.Input}],footerTemplate:[{type:e.Input}],footerPosition:[{type:e.Input}],footerStyler:[{type:e.Input}],rowHeight:[{type:e.Input}],sizeType:[{type:e.Input}],fit:[{type:e.Input}],fitColumns:[{type:e.Input}],autoFitColumns:[{type:e.Input}],disabled:[{type:e.Input}],scrollBarShowMode:[{type:e.Input}],scrollBarOptions:[{type:e.Input}],resizeColumn:[{type:e.Input}],showLineNumber:[{type:e.Input}],lineNumberTitle:[{type:e.Input}],lineNumberWidth:[{type:e.Input}],rowHover:[{type:e.Input}],clickToEdit:[{type:e.Input}],lockPagination:[{type:e.Input}],pagination:[{type:e.Input}],pagerViewMode:[{type:e.Input}],pagerOnServer:[{type:e.Input}],pageList:[{type:e.Input}],pageIndex:[{type:e.Input}],pageSize:[{type:e.Input}],pagerHeight:[{type:e.Input}],showPageList:[{type:e.Input}],showPageInfo:[{type:e.Input}],showPageNumber:[{type:e.Input}],pagerLabelSize:[{type:e.Input}],showGotoInput:[{type:e.Input}],enableMorePageSelect:[{type:e.Input}],showSelectedList:[{type:e.Input}],selectedItemFormatter:[{type:e.Input}],cellTipTimer:[{type:e.Input}],controlPaginationState:[{type:e.Input}],total:[{type:e.Input}],enableSelectRow:[{type:e.Input}],multiSelect:[{type:e.Input}],showCheckbox:[{type:e.Input}],showAllCheckbox:[{type:e.Input}],onlySelectSelf:[{type:e.Input}],checkOnSelect:[{type:e.Input}],selectOnCheck:[{type:e.Input}],selectionMode:[{type:e.Input}],keepSelect:[{type:e.Input}],emptyDataHeight:[{type:e.Input}],emptyMessage:[{type:e.Input}],emptyTemplate:[{type:e.Input}],idField:[{type:e.Input}],url:[{type:e.Input}],data:[{type:e.Input}],footerData:[{type:e.Input}],endEditByInvalid:[{type:e.Input}],columns:[{type:e.Input}],fields:[{type:e.Input}],nowrap:[{type:e.Input}],virtualized:[{type:e.Input}],virtualizedAsyncLoad:[{type:e.Input}],rowStyler:[{type:e.Input}],editMode:[{type:e.Input}],editable:[{type:e.Input}],enableEditCellStyle:[{type:e.Input}],selectOnEditing:[{type:e.Input}],editorHeight:[{type:e.Input}],remoteSort:[{type:e.Input}],sortName:[{type:e.Input}],sortOrder:[{type:e.Input}],multiSort:[{type:e.Input}],hoverRowCls:[{type:e.Input}],enableDragColumn:[{type:e.Input}],rowGroupPanelHeight:[{type:e.Input}],groupRows:[{type:e.Input}],groupFooter:[{type:e.Input}],groupFooterStyler:[{type:e.Input}],groupSummaryPosition:[{type:e.Input}],groupCellColSpan:[{type:e.Input}],groupField:[{type:e.Input}],showGroupColumn:[{type:e.Input}],groupFormatter:[{type:e.Input}],groupStyler:[{type:e.Input}],showRowGroupPanel:[{type:e.Input}],AutoColumnWidthUseDblclick:[{type:e.Input}],disableRow:[{type:e.Input}],useDefaultFilter:[{type:e.Input}],enableSmartFilter:[{type:e.Input}],enableFilterRow:[{type:e.Input}],remoteFilter:[{type:e.Input}],showFilterBar:[{type:e.Input}],filterBarHeight:[{type:e.Input}],filterRowHeight:[{type:e.Input}],conditions:[{type:e.Input}],selectValue:[{type:e.Input}],checkValues:[{type:e.Input}],selectValues:[{type:e.Input}],mergeCell:[{type:e.Input}],mergeFields:[{type:e.Input}],enableClientSortForMergeCell:[{type:e.Input}],useControlPanel:[{type:e.Input}],enableSimpleMode:[{type:e.Input}],controlPanelMode:[{type:e.Input}],stopPropagation:[{type:e.Input}],closeOtherGridEditor:[{type:e.Input}],clearSelectionsWhenDataIsEmpty:[{type:e.Input}],enableContextMenu:[{type:e.Input}],contextMenus:[{type:e.Input}],selectValueChange:[{type:e.Output}],checkValuesChange:[{type:e.Output}],selectValuesChange:[{type:e.Output}],beforeEdit:[{type:e.Input}],beginEdit:[{type:e.Output}],afterEdit:[{type:e.Input}],endEdit:[{type:e.Output}],cancelEdited:[{type:e.Output}],scrollY:[{type:e.Output}],pageSizeChanged:[{type:e.Output}],pageChanged:[{type:e.Output}],loadSuccess:[{type:e.Output}],filterChanged:[{type:e.Output}],beforeSelect:[{type:e.Input}],beforeUnselect:[{type:e.Input}],beforeCheck:[{type:e.Input}],beforeUncheck:[{type:e.Input}],beforeSortColumn:[{type:e.Input}],enableHighlightCell:[{type:e.Input}],checkedRowsDataFromSource:[{type:e.Input}],editcellWhenTabKeydwon:[{type:e.Input}],beforeClickCell:[{type:e.Output}],dblclickRow:[{type:e.Output}],selectChanged:[{type:e.Output}],unSelect:[{type:e.Output}],selectAll:[{type:e.Output}],unSelectAll:[{type:e.Output}],scrollYLoad:[{type:e.Output}],checked:[{type:e.Output}],unChecked:[{type:e.Output}],checkAll:[{type:e.Output}],unCheckAll:[{type:e.Output}],checkedChange:[{type:e.Output}],columnSorted:[{type:e.Output}],rowClick:[{type:e.Output}],rowAppended:[{type:e.Output}],rowDeleted:[{type:e.Output}],rowUpdated:[{type:e.Output}],dataChange:[{type:e.Output}],lastCellEnterHandle:[{type:e.Output}],groupFieldChange:[{type:e.Output}],columnMoved:[{type:e.Output}],cellClick:[{type:e.Output}],dgColumns:[{type:e.ContentChildren,args:[ft]}],dgPager:[{type:e.ViewChild,args:["dgPager"]}],resizeProxy:[{type:e.ViewChild,args:["resizeProxy"]}],resizeProxyBg:[{type:e.ViewChild,args:["resizeProxyBg"]}],dgContainer:[{type:e.ViewChild,args:["datagridContainer"]}],longTextArea:[{type:e.ViewChild,args:["longTextArea"]}],smartFilterToolbar:[{type:e.ViewChild,args:["smartfiltertoolbar"]}],onClick:[{type:e.HostListener,args:["click",["$event"]]}]},t}(),Ct=function(){function t(t,e,i,n,r,o,s){this.render=t,this.el=e,this.zone=i,this.inject=n,this.filterPanelService=r,this.smartFilterSer=o,this.dg=s,this.filterData=null,this.disabled=!1,this.smartFilterDataChanged$=null,this.removeFilter$=null,this.clearAllFilter$=null,this.smartFilterEvents=[],this.idService=this.inject.get(l.IdService,null)}return t.prototype.ngOnInit=function(){var t=this;this.removeFilter$||(this.removeFilter$=this.smartFilterSer.removeFilter.subscribe(function(e){e&&e.labelCode===t.column.field&&(t.filterData=null,t.render.removeClass(t.el.nativeElement,"active"))}),this.smartFilterEvents.push(this.removeFilter$)),this.clearAllFilter$||(this.clearAllFilter$=this.smartFilterSer.clearAllFilter.subscribe(function(){t.filterData=null,t.render.removeClass(t.el.nativeElement,"active")}),this.smartFilterEvents.push(this.clearAllFilter$)),this.dg&&!this.smartFilterDataChanged$&&(this.smartFilterDataChanged$=this.dg.dgs.smartFilterDataChange.subscribe(function(e){e&&t.column.field===e.fieldCode&&(t.filterData.value=e.value,t.filterData.control.single=e.control.single)}),this.smartFilterEvents.push(this.smartFilterDataChanged$))},t.prototype.ngOnDestroy=function(){this.filterPanelRef&&(this.filterPanelService.hidePanel(),this.filterPanelRef=null),this.smartFilterEvents&&this.smartFilterEvents.length&&(this.smartFilterEvents.forEach(function(t){t.unsubscribe(),t=null}),this.smartFilterEvents=[])},t.prototype.getFilterData=function(){var t=this.column,e=t.field,i=t.title;return this.filterData||(this.filterData={id:e,labelCode:e,code:e,name:i,control:this.smartFilterSer.getColumnFilterData(this.column),placeHolder:"",value:{value:""}}),o.cloneDeep(this.filterData)},t.prototype.getPanelPosition=function(t){var e=t.pageX-33,i=t.pageY+9,n=t.target.getBoundingClientRect(),r=0;window.innerWidth-e<380&&(e=e-(380-(window.innerWidth-e))-20,r=n.left-e);return{x:e,y:i,moveArrow:r}},t.prototype.hideFilterPanel=function(){this.filterPanelRef&&(this.filterPanelService.hidePanel(),this.filterPanelRef=null,this.filterData&&this.filterData.valueText||this.render.removeClass(this.el.nativeElement,"active"))},t.prototype.clearColumnFilter=function(t){this.hideFilterPanel(),this.filterData=null,this.smartFilterSer.removeCondition(t)},t.prototype.showFilterPanel=function(t){var e=this;t.stopPropagation(),this.render.addClass(this.el.nativeElement,"active");var i=this.getPanelPosition(t),n=i.x,r=i.y,o=i.moveArrow;if(this.filterPanelRef=this.filterPanelService.showPanel({left:n,top:r,item:this.getFilterData(),panelExtendTemplate:this.column.sortable?this.sortTmp:null,localStorageKey:"smartfilter_"+this.dg.dgs.createConfigKey(this.dg.id),target:t.target}),o){var s=this.filterPanelRef.el.querySelector(".f-filter-panel-arrow");s&&this.render.setStyle(s,"left",o+"px")}this.filterPanelRef.hidePanel.subscribe(function(t){e.hideFilterPanel()}),this.filterPanelRef.filterSubmit.subscribe(function(t){t.filter&&t.filter.length?(e.filterData=t.item||null,e.hideFilterPanel(),e.smartFilterSer.filterConditionChanged({conditions:t.filter,controlData:t.item})):e.clearColumnFilter(t.item)}),this.filterPanelRef.clearFilter.subscribe(function(t){e.clearColumnFilter(t)})},t.prototype.onClick=function(t){if(t.stopPropagation(),!this.disabled)return this.showFilterPanel(t),!1},t.prototype.onSort=function(t,e){var i=this;t.stopPropagation(),this.column.order===e?this.column.order="":this.column.order=e;var n=this.dg.sortName,r=this.dg.sortOrder,o=[],s=[];n&&(o=n.split(","),s=r.split(","));var l=this.column.order,a=o.findIndex(function(t){return t===i.column.field});a>=0?""===l?(l=undefined,o.splice(a,1),s.splice(a,1)):s[a]=l:this.dg.multiSort?(o.push(this.column.field),s.push(l)):(o=[this.column.field],s=[l]),this.dg.sortName=o.join(","),this.dg.sortOrder=s.join(","),this.dg.dfs.setSortInfo(this.dg.sortName,this.dg.sortOrder),this.dg.beforeSortColumn(this.dg.sortName,this.dg.sortOrder,this.dg).subscribe(function(){i.dg.onColumnSorted()})},t.decorators=[{type:e.Component,args:[{selector:"datagrid-smart-filter, [datagrid-smart-filter]",template:'<ng-template #sort>\r\n    <div class="f-filter-panel-sort-wrapper f-filter-panel-sort-wrapper-hasfilter">\r\n        <div class="f-filter-panel-sort">\r\n            <div class="panel-sort-up panel-sort-item" [class.active]="column?.order === \'asc\'" (click)="onSort($event, \'asc\')">\r\n                <span class="panel-sort-item-icon f-icon f-icon-col-ascendingorder"></span>\r\n                <span class="panel-sort-item-text">{{ \'datagrid.settings.asc\' | locale: \'升序\' }}</span>\r\n            </div>\r\n            <div class="panel-sort-down panel-sort-item" [class.active]="column?.order === \'desc\'"  (click)="onSort($event, \'desc\')">\r\n                <span class="panel-sort-item-icon f-icon f-icon-col-descendingorder"></span>\r\n                <span class="panel-sort-item-text">{{ \'datagrid.settings.desc\' | locale: \'降序\' }}</span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</ng-template>',providers:[p.FilterPanelService]}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.ElementRef},{type:e.NgZone},{type:e.Injector},{type:p.FilterPanelService},{type:wt},{type:bt,decorators:[{type:e.Optional}]}]},t.propDecorators={column:[{type:e.Input}],filterData:[{type:e.Input}],disabled:[{type:e.Input}],sortTmp:[{type:e.ViewChild,args:["sort"]}],onClick:[{type:e.HostListener,args:["click",["$event"]]}]},t}(),St=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[Ct],imports:[p.FilterPanelModule,a.LocaleModule.forRoot()],exports:[Ct]}]}],t}(),Rt=function(){function t(t,i){this.cfs=t,this.injector=i,this.localeId="ZH-CHS",this.localeId=this.injector.get(e.LOCALE_ID)}return t.prototype.transform=function(t,e,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=!1),e&&t&&t.field){var r=U.getValue(t.field,e);if(t.editor&&t.editor.options&&t.editor.options.isPassword&&!t.formatter)return r?"******":"";var o=t.formatter;if(i)o=t.groupFooter?t.groupFooter.formatter:undefined;else if(n){if("object"==typeof(o=t.footer?t.footer.formatter:undefined))if(!o.options)o={type:o.type,options:o}}if(o){if(o&&("number"===o.type&&(o.options&&Object.keys(o.options).length||(o.options={thousand:",",precision:2})),"datetime"===o.type&&o.options&&t.editor&&t.editor.options)){var s=t.editor.options,l=s.dateRange,a=s.dateRangeDatesDelimiter;o.options=Object.assign({dateRange:l,dateRangeDatesDelimiter:a},o.options)}if(this.getDatagridInstance(),this.dataGrid){var c=this.cfs.format(r,e,o,{utils:this.dataGrid.commonUtils});return this.setPlaceHolderWhenEnableEditCellStyle(t,c,e,i||n)}return r}var d=r;return t.isMultilingualField?d=this.getMultilingualValue(r):null!==r&&r!==undefined&&"0"!==r&&"string"==typeof r&&r.indexOf("\n")>-1&&(this.getDatagridInstance(),this.dataGrid&&this.dataGrid.nowrap&&(d=r.replace(/\n/g," "))),this.setPlaceHolderWhenEnableEditCellStyle(t,d,e,i||n)}return""},t.prototype.getMultilingualValue=function(t){if(t&&"object"==typeof t&&Object.keys(t).length>0){if(this.injector&&(this.localeService=this.injector.get(a.LocaleService)),this.localeService){var e=this.localeService.localeId;return U.getMultilingualValue(t,e)}return console.log("please install @farris/ui-datagrid@latest."),t["zh-CHS"]}return""},t.prototype.setPlaceHolderWhenEnableEditCellStyle=function(t,e,i,n){if(this.getDatagridInstance(),this.dataGrid){if(!this.dataGrid.editable||null!==e&&e!==undefined&&""!==e||n||this.cellIsReadOnly(t,i)){if(this.elRef)(r=this.elRef.nativeElement.querySelector(".cell-text-box"))&&r.className.indexOf("cell-empty")>-1&&(r.className=r.className.replace("cell-empty"," "));return e}if(this.dataGrid.enableEditCellStyle){var r;if(this.elRef)(r=this.elRef.nativeElement.querySelector(".cell-text-box"))&&-1===r.className.indexOf("cell-empty")&&(r.className=r.className+" cell-empty");return U.getWhenEmptyText(t,this.localeId)}}return e},t.prototype.getDatagridInstance=function(){this.dataGrid||(this.dataGrid=this.injector.get(bt,null)),this.elRef||(this.elRef=this.injector.get(e.ElementRef,null))},t.prototype.cellIsReadOnly=function(t,e){return this.dataGrid.cellIsReadOnly(t,e)},t.decorators=[{type:e.Pipe,args:[{name:"formatCellData",pure:!1}]}],t.ctorParameters=function(){return[{type:f.ColumnFormatService},{type:e.Injector,decorators:[{type:e.Optional}]}]},t}(),xt=function(){function t(t,i,r,o,s){var l=this;this.injector=t,this.app=i,this.dg=r,this.cd=o,this.el=s,this.psConfig={swipeEasing:!1,minScrollbarLength:15,handlers:["click-rail","drag-thumb","wheel","touch"],suppressScrollY:this.dg.autoHeight},this.scrollTop=0,this.scrollLeft=0,this.deltaTopHeight=0,this.wheelWidth=0,this._fixedRightScrollLeft=0,this.maxScrollLeft=0,this.showRightShadow=!1,this.footerHeight=0,this.topHideHeight=0,this.bottomHideHeight=0,this.startRowIndex=0,this.dataChange=new e.EventEmitter,this.scrollBarMode="auto",this.checkedRows=[],this.visibleContextMenus=[],this.currentRowId=undefined,this._hoverRowIndex=-1,this.subscriptions=[],this.minRowBuffer=3,this.vScrollDir=1,this.rowsCache={},this.lastRenderedScrollTop=0,this.lastRenderedScrollLeft=0,this.prevScrollTop=0,this.prevScrollLeft=0,this.rows=[],this.blankTopHeight=0,this.blankBottomHeight=0,this.cellContentFormatter=null,this.__triggerBodyClickEvent=!0,this.onBeforeShowContextMenu=function(t){var e=t.contextMenuDom,i=t.event;if(i.target.closest(".datagrid-editor"))return n.of({show:!1});var r=i.target.id;if(e&&-1===e.className.indexOf("f-datagrid-group-row")&&-1===e.className.indexOf("f-datagrid-group-footer")){r=e.id.replace("row_","").replace("_fixedleft","").replace("_fixedright","");var o=l.dfs.findRow(r),s=l.viewportW>l.totalWidth?l.totalWidth:l.viewportW;return n.of({show:!0,data:{data:o.data,grid:l.dg},focusTargetWidth:s})}return n.of({show:!1})},this.dfs=this.injector.get(K),this.dgs=this.injector.get(Z),this.ngZone=this.injector.get(e.NgZone),this.render=this.injector.get(e.Renderer2);var a=this.injector.get(f.ColumnFormatService);this.cellContentFormatter=new Rt(a,this.injector)}return Object.defineProperty(t.prototype,"fixedRightScrollLeft",{get:function(){return this._fixedRightScrollLeft},set:function(t){this._fixedRightScrollLeft=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hoverRowIndex",{get:function(){return this._hoverRowIndex},set:function(t){this._hoverRowIndex=t,this.cd.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedRows",{get:function(){return this.dg.selections},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarXHeight",{get:function(){if(this.dg&&this.ps&&this.ps.instance){var t="allways"===this.dg.scrollBarShowMode&&this.ps.instance.scrollbarXActive?22:0;if(this.ps.instance.scrollbarYActive&&t)return t+18}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarYWidth",{get:function(){if(this.dg&&this.ps&&this.ps.instance)return"allways"===this.dg.scrollBarShowMode&&this.ps.instance.scrollbarYActive&&this.showRightShadow?18:0},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.listenSubjects(),this.dg.scrollInstance=this.ps;var e=this.dgs.showGridHeader.subscribe(function(e){t.updateContainerSize(e)});this.subscriptions.push(e);var i=this.dgs.footerPositionChanged.subscribe(function(){t.updateContainerSize()});this.subscriptions.push(i);var n=this.dgs.rowHeightChanged.subscribe(function(){t.cd.detectChanges()});this.subscriptions.push(n);var o=this.dfs.clientSort$.subscribe(function(){t.checkScrollbarPosition(!0),t.cd.detectChanges()});this.subscriptions.push(o);var s=this.dg.dgs.columnsChanged.pipe(r.delay(100)).subscribe(function(e){e&&e.scrollToLeft&&(t.ps.elementRef.nativeElement.scrollTo(0,0),t.ps.scrollToLeft(0,100))});this.subscriptions.push(s),this.viewScrollContainer.nativeElement.addEventListener("click",this.onMouseClick.bind(this))},t.prototype.updateContainerSize=function(t){var e=t||this.dg.realHeaderHeight;this.setPositionTop(e),this.height=this.dg.height-this.top,this.bodyStyle=this.getBodyStyle(),this.cd.detectChanges()},t.prototype.ngOnChanges=function(t){t.data&&!t.data.isFirstChange()&&(this.bodyStyle=this.getBodyStyle(),this.dfs.setCurrentPageData(t.data.currentValue),this.onDataChanged()),t.footerHeight===undefined||t.footerHeight.isFirstChange()||(this.bodyStyle=this.getBodyStyle()),t.scrollBarMode===undefined||t.scrollBarMode.isFirstChange()||(this.ps&&this.ps.instance&&"allways"===this.scrollBarMode&&this.ps.instance.scrollbarYActive?this.rightFixedWidth+=this.showRightShadow?18:0:this.rightFixedWidth=this.columnsGroup.rightFixedWidth)},t.prototype.ngOnDestroy=function(){this.destroySubscriptions()},t.prototype.ngAfterViewInit=function(){},t.prototype.ngAfterViewChecked=function(){},t.prototype.setPositionTop=function(t){this.top=t,(this.dg.enableFilterRow||this.dg.enableSmartFilter)&&this.dg.showFilterBar&&(this.top+=this.dg.filterBarHeight),this.dg.showRowGroupPanel&&(this.top+=this.dg.rowGroupPanelHeight),!this.dg.showFooter||"top"!==this.dg.footerPosition&&"both"!==this.dg.footerPosition||(this.top+=this.dg.footerHeight)},t.prototype.checkScrollbarPosition=function(t){if(void 0===t&&(t=!1),this.dg.data&&this.dg.data.length){var e=this.ps.instance,i=this.ps.elementRef.nativeElement,n=e?e.lastScrollLeft:0,r=e?e.lastScrollTop:0,o=i.scrollTop,s=i.scrollLeft;t?(this.ps.scrollToTop(),this.dgs.onScrollMove(r,"psScrollY")):o!=r&&(this.ps.scrollToTop(r),this.dgs.onScrollMove(r,"psScrollY")),this.scrollLeft=n,s!=n?(this.ps.scrollToX(n),this.dgs.onScrollMove(n,T)):n&&this.dgs.onScrollMove(n,T)}},t.prototype.onDataChanged=function(){var t=this;this.dg.setPagerHeight(),this.viewportH=this.getViewPortHeight(),this.bodyStyle=this.getBodyStyle(),!this.ps||!this.ps.instance||this.dg.isEditing()||this.dg.clientFilterChanged||this.dg.autoHeight||(this.scrollTop=0,this.lastRenderedScrollTop=0,this.ps.scrollToTop(),this.scrollLeft=0,this.ps.scrollToLeft()),this.rowsCache={};var e;!this.dg.nowrap||this.dg.autoHeight?(this.renderData(!1),setTimeout(function(){t.updateRowHeight()},100)):((e=t.dg.dfs.getState().scrollInfo)&&(e.y&&(t.scrollTop=e.y,t.dg.scrollInstance.scrollToY(e.y),t.dgs.onScrollMove(e.y,"psScrollY")),e.x&&(t.scrollLeft=e.x,t.dg.scrollInstance.scrollToX(e.x),t.dg.dgs.onScrollMove(e.x,T))),this.renderData(!1),this.ps.update()),this.dg.initSelectOrChecked(),this.dg.clientFilterChanged=!1,this.dataChange.emit(this.data)},t.prototype.destroySubscriptions=function(){this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){t&&(t.unsubscribe(),t=null)}),this.subscriptions=[])},t.prototype.listenSubjects=function(){var t=this;this.destroySubscriptions(),this.gridSizeSubscribe=this.dfs.gridSize$.pipe(r.debounceTime(50)).subscribe(function(e){if(e){t.dg.setPagerHeight();var i=t.dg.setHeaderHeight();t.setPositionTop(i),t.height=e.height-t.top,t.width=Math.floor(e.width),t.rowHeight=e.rowHeight,t.dg.showBorder&&(t.width-=2),t.viewportW=t.width,t.viewportH=t.getViewPortHeight(),t.canvasHeight=t.getCanvasHeight(),t.ngZone.runOutsideAngular(function(){t.checkScrollbarPosition(),t.updateColumnSize(e.columnsGroup),t.cd.detectChanges(),t.scrollLeft=t.ps.elementRef.nativeElement.scrollLeft,t.maxScrollLeft=t.colsWidth+t.leftFixedWidth;var i=t.dg.dgContainer.nativeElement.offsetWidth,n=Math.floor(t.columnsGroup.totalWidth);if(t.fixedRightScrollLeft=t.width-t.rightFixedWidth+t.scrollLeft,t.bodyStyle=t.getBodyStyle(),i>n||i===n?(t.showRightShadow=!1,t.fixedRightScrollLeft=t.maxScrollLeft):t.showRightShadow=!0,t.renderData(!1),!t.dg.nowrap||t.dg.autoHeight){var r=null;r&&r.clearTimeout(),r=setTimeout(function(){t.updateRowHeight(),t.ps.update()},100)}else t.cd.destroyed||(t.ps.update(),t.cd.detectChanges());t.dgs.showFixedShadow.emit({showRightShadow:t.showRightShadow,x:t.fixedRightScrollLeft})}),"allways"===t.scrollBarMode&&setTimeout(function(){t.updateColumnSize(t.columnsGroup),t.dgs.scrollbarUpdate.emit({scrollbarRef:t.ps.instance})},50)}}),this.subscriptions.push(this.gridSizeSubscribe),this.columnResizeSubscribe=this.dfs.columnResize$.subscribe(function(e){t.updateColumnSize(e),t.cd.detectChanges()}),this.subscriptions.push(this.columnResizeSubscribe),this.dgs.setSelecedRow.subscribe(function(e){e&&e.selected?t.currentRowId=e.id:t.currentRowId=undefined}),this.selectRowSubscribe=this.dfs.selectRow$.subscribe(function(e){e&&(t.currentRowId=e.id,t.cd.detectChanges())}),this.subscriptions.push(this.selectRowSubscribe),this.unselectRowSubscribe=this.dfs.unSelectRow$.subscribe(function(e){e&&e.id===t.currentRowId&&(t.currentRowId=undefined,t.dg.selectedRow=null),!t.dg.editable&&t.dg.multiSelect&&(t.__triggerBodyClickEvent="default"===t.dg.selectionMode),t.cd.detectChanges()}),this.subscriptions.push(this.unselectRowSubscribe),this.selectAllSubscribe=this.dfs.selectAll$.subscribe(function(e){t.dg.selectAll.emit(e),t.cd.detectChanges()}),this.subscriptions.push(this.selectAllSubscribe),this.checkRowSubscribe=this.dfs.checkRow$.subscribe(function(e){t.dg.checked.emit(e),t.checkedRowsChanged()}),this.subscriptions.push(this.checkRowSubscribe),this.clearSelectionsSubscribe=this.dfs.clearSelections$.subscribe(function(){t.currentRowId=undefined,t.dg.checkOnSelect&&t.checkedRowsChanged(),t.dg.unSelectAll.emit()}),this.subscriptions.push(this.clearSelectionsSubscribe),this.uncheckRowSubscribe=this.dfs.unCheckRow$.subscribe(function(e){t.dg.unChecked.emit(e),t.checkedRowsChanged()}),this.subscriptions.push(this.uncheckRowSubscribe),this.checkAllSubscribe=this.dfs.checkAll$.subscribe(function(e){t.dg.checkAll.emit(e),t.checkedRowsChanged()}),this.subscriptions.push(this.checkAllSubscribe),this.clearCheckedsSubscribe=this.dfs.clearCheckeds$.subscribe(function(e){t.dg.selectOnCheck&&(t.currentRowId=undefined),t.dg.unCheckAll.emit(e),t.checkedRowsChanged(),t.cd.detectChanges()}),this.subscriptions.push(this.clearCheckedsSubscribe),this.subscriptions.push(this.dgs.setScrollbarPosition.subscribe(function(){t.checkScrollbarPosition(),t.updateScrollPosition(t.scrollLeft)})),this.dgs.columnResized.pipe(r.delay(100)).subscribe(function(e){if(!t.dg.nowrap||t.dg.currentCell&&t.dg.currentCell.isEditing&&t.dg.currentCell.column&&t.dg.currentCell.column.editor&&"textarea"===t.dg.currentCell.column.editor.type){t.dg.dgContainer.nativeElement.querySelectorAll(".f-datagrid-body-row:not(f-datagrid-footer-row)").forEach(function(t){return t.style.height="auto"});var i="";if(e)i="row_"+e.id;t.updateRowHeight(i)}t.dg.headerWrap&&(t.dg.setHeaderHeight(),t.dfs.columnResizeEnd())}),this.dgs.cellContentWrapChanged.pipe(r.delay(100)).subscribe(function(){t.updateRowHeight()}),this.dg.dfs.rowUpdate$.subscribe(function(e){e&&e.data&&t.buildCustomCellStyle(e)})},t.prototype.buildCustomCellStyle=function(t){var e=this,i=[],n=[];this.fixedRightEl&&(i=this.fixedRightEl.nativeElement.querySelectorAll("tr")),this.fixedLeftEl&&(n=this.fixedLeftEl.nativeElement.querySelectorAll(".fixed-left-row"));var r=this.mainArea.nativeElement.querySelectorAll("tr.f-datagrid-body-row"),o=function(i,n,r){if(i.length){var o=i[t.index].querySelector('[field="'+n.field+'"]');o&&e.dg.renderCustomStyle(r,o)}};this.dg.flatColumns.forEach(function(e){if(e.styler){var s=t.data,l=e.styler(s[e.field],s,t.index);l&&Object.keys(l).length&&(o(n,e,l),o(i,e,l),o(r,e,l))}})},t.prototype.checkedRowsChanged=function(){this.dgs.onCheckedRowsCountChange();var t=this.dg.checkeds;this.dg.checkValues=t.map(function(t){return t.id}),this.dg.checkValuesChange.emit(this.dg.checkValues),this.dg.checkedChange.emit(t)},t.prototype.getTrDomHeight=function(){var t=this,e=[],i=[],n=[],r=[];return this.fixedRightEl&&(i=this.fixedRightEl.nativeElement.querySelectorAll("tr")),this.fixedLeftEl&&(n=this.fixedLeftEl.nativeElement.querySelectorAll(".fixed-left-row")),this.mainArea&&(r=this.mainArea.nativeElement.querySelectorAll("tr.f-datagrid-body-row")),r.forEach(function(r,o){var s=0,l=Math.ceil(r.offsetHeight),a=0;n&&n.length&&(s=Math.ceil(n[o].offsetHeight)),i&&i.length&&(a=Math.ceil(i[o].offsetHeight));var c=Math.max(s,l,a,t.dg.rowHeight);e.push(c)}),e},t.prototype.updateRowHeight=function(t){var e=this;if(void 0===t&&(t=null),this.mainArea){var i=this.el.nativeElement.querySelector("div.f-datagrid-body");i&&(!this.dg.nowrap||this.dg.autoHeight?this.render.addClass(i,"data-wrap"):this.render.removeClass(i,"data-wrap"));var n=[];if(t){n=[];var r="#"+t,o=[];if(this.fixedRightEl){var s=this.fixedRightEl.nativeElement.querySelector(r);s&&o.push(Math.ceil(s.offsetHeight))}if(this.fixedLeftEl){var l=this.fixedLeftEl.nativeElement.querySelector(r);l&&o.push(Math.ceil(l.offsetHeight))}if(this.mainArea){var a=this.mainArea.nativeElement.querySelector(r);a&&o.push(Math.ceil(a.offsetHeight))}var c=Math.max.apply(Math,x(o)),d=t+"_fixedleft",h=t+"_fixedright";!this.dg.nowrap||this.dg.autoHeight?(n.push(this.dg.customStyleKey()+" .f-datagrid-body.data-wrap #"+d+"{ height: "+c+"px;}"),n.push(this.dg.customStyleKey()+" .f-datagrid-body.data-wrap #"+t+"{ height: "+c+"px;}"),n.push(this.dg.customStyleKey()+" .f-datagrid-body.data-wrap #"+h+"{ height: "+c+"px;}")):(n.push(this.dg.customStyleKey()+" .f-datagrid-body #"+d+"{ height: "+c+"px }"),n.push(this.dg.customStyleKey()+" .f-datagrid-body #"+t+"{ height: "+c+"px }"),n.push(this.dg.customStyleKey()+" .f-datagrid-body #"+h+"{ height: "+c+"px }")),this.dgs.appendCssRules(n)}else this.rows.forEach(function(t,i){var r="row_"+e.dfs.primaryId(t),o=r+"_fixedleft",s=r+"_fixedright";if(!e.dg.nowrap||e.dg.autoHeight){var l=e.getTrDomHeight()[i];n.push(e.dg.customStyleKey()+" .f-datagrid-body.data-wrap #"+o+"{ height: "+l+"px }"),n.push(e.dg.customStyleKey()+" .f-datagrid-body.data-wrap #"+r+"{ height: "+l+"px }"),n.push(e.dg.customStyleKey()+" .f-datagrid-body.data-wrap #"+s+"{ height: "+l+"px }")}else{var a=e.dg.customStyleKey()+" .f-datagrid-body #"+o,c=e.dg.customStyleKey()+" .f-datagrid-body #"+r,d=e.dg.customStyleKey()+" .f-datagrid-body #"+s;e.dgs.removeCssRule(a),e.dgs.removeCssRule(c),e.dgs.removeCssRule(d)}}),this.dgs.appendCssRules(n);this.updateCanvasHeight(),this.dg.dgContainer.nativeElement.querySelectorAll(".f-datagrid-body-row:not(f-datagrid-footer-row)").forEach(function(t){return t.style.height=""}),this.cd.destroyed||this.cd.detectChanges()}},t.prototype.updateColumnSize=function(t){t&&(this.columnsGroup=t,this.leftFixedWidth=this.columnsGroup.leftFixedWidth,this.rightFixedWidth=this.columnsGroup.rightFixedWidth,this.ps&&this.ps.instance&&"allways"===this.dg.scrollBarShowMode&&this.ps.instance.scrollbarYActive&&(this.rightFixedWidth+=this.showRightShadow?18:0),this.colsWidth=this.columnsGroup.normalWidth,this.totalWidth=this.columnsGroup.totalWidth,"allways"!==this.scrollBarMode||this.rightRowsCmp||this.dg.useControlPanel||(this.totalWidth+=18))},t.prototype.getBodyStyle=function(){var t=this.getViewPortHeight();if(this.data.length)this.dg.showFooter&&"both"===this.dg.footerPosition&&(t-=this.dg.footerHeight);else if(this.dg.autoHeight&&(t=this.dg.emptyDataHeight),this.dg.footerData&&this.dg.showFooter){var e=this.dg.footerData;this.dg.footerData.subscribe&&(e=this.dg.footerData.value),e&&Array.isArray(e)&&e.length&&(t-=this.dg.footerHeight)}return{height:Math.floor(t)+"px"}},t.prototype.updateScrollPosition=function(t){this.scrollLeft=t,this.fixedRightScrollLeft=this.scrollLeft+this.width-this.rightFixedWidth,this.fixedRightScrollLeft===this.maxScrollLeft||this.fixedRightScrollLeft>this.maxScrollLeft?(this.fixedRightScrollLeft=this.maxScrollLeft,this.showRightShadow=!1):this.showRightShadow=!0,this.fixedLeftEl&&this.render.setStyle(this.fixedLeftEl.nativeElement,"transform","translate3d("+this.scrollLeft+"px, 0px, 0px)"),this.fixedRightEl&&this.render.setStyle(this.fixedRightEl.nativeElement,"transform","translate3d("+this.fixedRightScrollLeft+"px, 0px, 0px)")},t.prototype.onScrollToX=function(t){var e=t.target.scrollLeft;this.updateScrollPosition(e),this.dgs.onScrollMove(e,T),this.dgs.showFixedShadow.emit({showRightShadow:this.showRightShadow,x:this.fixedRightScrollLeft})},t.prototype.onScrollToY=function(t){var e=t.target.scrollTop;this.dg.virtualized&&this.handleScroll(),this.scrollTop=e,this.dg.scrollY.emit(e),this.dgs.onScrollMove(e,"psScrollY")},t.prototype.onPsXReachStart=function(t){var e=t.target.scrollLeft;this.updateScrollPosition(e),this.dgs.onScrollMove(e,L)},t.prototype.onPsXReachEnd=function(t){this.showRightShadow=!1},t.prototype.isChecked=function(t){return!!t&&this.dfs.isRowChecked(t[this.dg.idField])},t.prototype.isSelected=function(t){return!!t&&this.dfs.isRowSelected(t[this.dg.idField])},t.prototype.toggleGroupRow=function(t,e){void 0===e&&(e=!0),t.expanded=e,this.ps.update()},t.prototype.getViewPortHeight=function(){var t=this.dg.height;return this.dg.showHeader&&(t-=this.dg.realHeaderHeight),(this.dg.enableFilterRow||this.dg.enableSmartFilter)&&this.dg.showFilterBar&&(t-=this.dg.filterBarHeight),this.dg.showRowGroupPanel&&(t-=this.dg.rowGroupPanelHeight),this.dg.showFooter&&this.data.length&&(t-=this.dg.footerHeight),this.dg.pagination&&(t=t-this.dg.pagerHeight-2),this.dg.showBorder&&(t-=2),this.viewportH=t,t},t.prototype.allRowsHeight=function(){var t=this.dg.rowHeight+1,e=0,i=(e="inGroupRow"===this.dg.groupSummaryPosition?this.data.filter(function(t){return!t.__group_footer__}).length:this.data.length)*t;return this.dg.autoHeight?i+=e:i+=2,i},t.prototype.getCanvasHeight=function(){var t=0;return this.data&&this.data.length?((t=this.dg.nowrap?this.allRowsHeight():this.getTrDomHeight().reduce(function(t,e){return t+e},0))||(t=this.viewportH),this.canvasHeight=t,t):(this.canvasHeight=0,0)},t.prototype.updateCanvasHeight=function(){this.canvasHeight=this.getCanvasHeight()},t.prototype.getRowFromPosition=function(t){return Math.floor(t/(this.dg.rowHeight+1))},t.prototype.getVisibleRange=function(t,e){return null==t&&(t=this.scrollTop),null==e&&(e=this.scrollLeft),{top:this.getRowFromPosition(t),bottom:this.getRowFromPosition(t+this.viewportH)+1,leftPx:e,rightPx:e+this.viewportW}},t.prototype.getRenderedRange=function(t,e){var i=this.getVisibleRange(t,e),n=Math.round(this.viewportH/(this.dg.rowHeight+1)),r=this.minRowBuffer;return-1==this.vScrollDir?(i.top-=n,i.bottom+=r):1==this.vScrollDir?(i.top-=r,i.bottom+=n):(i.top-=r,i.bottom+=r),i.top=Math.max(0,i.top),i.bottom=Math.min(this.data.length-1,i.bottom),i.leftPx-=this.viewportW,i.rightPx+=this.viewportW,i.leftPx=Math.max(0,i.leftPx),i.rightPx=Math.min(this.canvasWidth,i.rightPx),i},t.prototype.renderRows=function(t){for(var e=this,i=[],n=this.data.length,r=t.top;r<=t.bottom;r++)this.rowsCache[r]||r==n||(i.push(r),this.rowsCache[r]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]});r=0;for(var o=i.length;r<o;r++)this.rowsCache[i[r]].rowNode=this.data[i[r]];return Object.keys(this.rowsCache).map(function(t){return e.rowsCache[t].rowNode})},t.prototype.removeRowFromCache=function(t){this.rowsCache[t]&&delete this.rowsCache[t]},t.prototype.cleanupRows=function(t){for(var e in this.rowsCache)(e<t.top||e>t.bottom)&&this.removeRowFromCache(e)},t.prototype.renderData=function(t){if(void 0===t&&(t=!0),this.canvasHeight=this.getCanvasHeight(),!this.dg.virtualized||this.dg.autoHeight)this.rows=this.data;else{this.getVisibleRange();var e=this.getRenderedRange();this.cleanupRows(e),this.rows=this.renderRows(e),this.startRowIndex=e.top,this.blankTopHeight=this.startRowIndex*(this.dg.rowHeight+1),this.blankBottomHeight=this.canvasHeight-this.blankTopHeight-this.rows.length*(this.dg.rowHeight+1),this.lastRenderedScrollTop=this.scrollTop,this.lastRenderedScrollLeft=this.scrollLeft,t&&this.cd.detectChanges()}},t.prototype.handleScroll=function(){return this.scrollTop=this.ps.elementRef.nativeElement.scrollTop,this.scrollLeft=this.ps.elementRef.nativeElement.scrollLeft,this._handleScroll()},t.prototype._handleScroll=function(){var t=this.viewScrollContainer.nativeElement,e=t.scrollHeight-t.clientHeight,i=t.scrollWidth-t.clientWidth;e=Math.max(0,e),i=Math.max(0,i),this.scrollTop>e&&(this.scrollTop=e),this.scrollLeft>i&&(this.scrollLeft=i);var n=Math.abs(this.scrollTop-this.prevScrollTop),r=Math.abs(this.scrollLeft-this.prevScrollLeft);if(r&&(this.prevScrollLeft=this.scrollLeft),n&&(this.vScrollDir=this.prevScrollTop<this.scrollTop?1:-1,this.prevScrollTop=this.scrollTop,n<this.viewportH&&this._scrollTo(this.scrollTop)),r||n){var o=Math.abs(this.lastRenderedScrollLeft-this.scrollLeft),s=Math.abs(this.lastRenderedScrollTop-this.scrollTop);(o>20||s>20)&&(s<this.viewportH&&this.viewportW,this.renderData())}return!(!r&&!n)},t.prototype._scrollTo=function(t){this.viewScrollContainer.nativeElement;t=Math.max(t,0);var e=t=Math.min(t,this.canvasHeight-this.viewportH);this.prevScrollTop!=e&&(this.vScrollDir=this.prevScrollTop<e?1:-1,this.lastRenderedScrollTop=this.scrollTop=this.prevScrollTop=e)},t.prototype.onMouseClick=function(t){var e=t.target;if("TEXTAREA"!==e.nodeName&&"INPUT"!==e.nodeName){var i=e;if("TD"!==e.nodeName&&(i=e.closest("TD")),this.dg.editable||!this.__triggerBodyClickEvent){if("row"!==this.dg.editMode&&i){if(this.dg.disableRow&&i.gridCellData){var n=i.gridCellData,r=n.rowData,o=n.rowIndex;if(this.dg.disableRow(r,o))return}this.dg.editable&&"cell"===this.dg.editMode&&i.edit?i.edit(t):i.selectCell&&(t.stopPropagation(),i.closeEdit(),i.selectCell(t,i))}}else i&&i.selectCell&&(t.stopPropagation(),i.selectCell(t,i))}},t.decorators=[{type:e.Component,args:[{selector:"datagrid-body",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:07\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-26 08:20:46\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n<ng-container  *ngIf="!data || !data.length">\r\n    <div *ngIf="!dg.emptyTemplate" class="d-flex flex-column f-datagrid-norecords" style="position:absolute; margin:0;left: 0; z-index: 1;justify-content: center; align-items: center;" [ngStyle]="bodyStyle" [style.top.px]="top" [style.width.px]="viewportW" >\r\n        <div class="f-datagrid-norecords-content" style="margin: 0;width: 100%;position: relative; top: 0">\r\n            {{ \'datagrid.emptyMessage\' | locale }}\r\n        </div>\r\n    </div>\r\n    <div class="f-datagrid-body" [ngStyle]="bodyStyle" [style.top.px]="top" [style.width.px]="viewportW" style="z-index: 1;"  *ngIf="dg.emptyTemplate">\r\n        <ng-container #emptyTemplate [ngTemplateOutlet]="dg.emptyTemplate" ></ng-container>\r\n    </div>\r\n</ng-container>\r\n<div  class="f-datagrid-body" [ngStyle]="bodyStyle" [style.top.px]="top" [style.width.px]="viewportW" \r\n[farris-context-menus]="contextMenuItems" [disabled]="!dg.enableContextMenu" [activeDomName]="\'tr\'" [beforeShowContextMenu]="onBeforeShowContextMenu"\r\n[menuClass]="\'f-datagrid-context-menu\'">\r\n\r\n    <div #viewScrollContainer [scrollbar]="psConfig" #ps="ngxScrollbar"\r\n        class="ps f-datagrid-body-wheel-area" \r\n        [ngStyle]="bodyStyle" style="width: 100%;"\r\n        (psXReachEnd)="onPsXReachEnd($event)"\r\n        (psScrollY)="onScrollToY($event)"\r\n        (psScrollX)="onScrollToX($event)" (psXReachStart)="onPsXReachStart($event)"\r\n        [style.paddingBottom.px]="scrollbarXHeight"\r\n        [style.paddingRight.px]="scrollbarYWidth">\r\n       \r\n        <div class="f-datagrid-norecords"  [auto-height]="dg.autoHeight" [wheelHeight]="dg.emptyDataHeight || 240" style="height: 100%" [style.width.px]="canvasWidth - 2"  *ngIf="!data || !data.length">\r\n            \x3c!-- <div *ngIf="!dg.emptyTemplate" class="f-datagrid-norecords-content" style="width: 100%" >{{ \'datagrid.emptyMessage\' | locale }}</div>\r\n            <ng-container #emptyTemplate *ngIf="dg.emptyTemplate" [ngTemplateOutlet]="dg.emptyTemplate" ></ng-container> --\x3e\r\n        </div>\r\n\r\n        <div [style.display]="dg.flatColumns?.length ? \'\': \'none\'"  *ngIf="data && data.length"\r\n            class="f-datagrid-bg" [auto-height]="dg.autoHeight" [wheelHeight]="canvasHeight"\r\n            [style.height.px]="canvasHeight" [style.width.px]="totalWidth" >\r\n            \r\n                <div #blankTop hidefocus style="width: 100%" [style.height.px]="blankTopHeight"></div>\r\n                \r\n                <div #fixedLeft class="f-datagrid-table f-datagrid-body-fixed-left"  [class.f-datagrid-fixed-left-shadow]="!!scrollLeft && !dg.groupRows"\r\n                    *ngIf="dg.showLineNumber || dg.showCheckbox || (columnsGroup?.leftFixed && columnsGroup?.leftFixed.length)"  [style.width.px]="leftFixedWidth" \r\n                    [style.transform]="\'translate3d(\'+ scrollLeft +\'px, 0px, 0px)\'">\r\n\r\n                    <fixed-left-rows [columns]="columnsGroup?.leftFixed" [checkedRows]="checkedRows" [selectedRows]="selectedRows" [data]="rows"></fixed-left-rows>\r\n                </div>\r\n\r\n                <div #fixedRight class="f-datagrid-table f-datagrid-body-fixed-right" [style.width.px]="rightFixedWidth" \r\n                    *ngIf="columnsGroup?.rightFixed && columnsGroup?.rightFixed.length"\r\n                    [class.f-datagrid-fixed-right-shadow]="showRightShadow" \r\n                    style="border: 0"\r\n                    [style.transform]="\'translate3d(\'+ fixedRightScrollLeft +\'px, 0px, 0px)\'">\r\n                    \r\n                    <datagrid-rows #rightRows [fixedRight]="true" [startRowIndex]="startRowIndex" [columns]="columnsGroup?.rightFixed" [data]="rows"></datagrid-rows>\r\n                </div>\r\n\r\n                <div #main [style.width.px]="colsWidth" style="position: relative;" [style.left.px]="leftFixedWidth" class="f-datagrid-table f-datagrid-body-center">\r\n                    <datagrid-rows #mainRows  [startRowIndex]="startRowIndex" [columns]="columnsGroup?.normalColumns" [data]="rows"></datagrid-rows>\r\n                </div>\r\n\r\n                <div hidefocus style="width: 100%" [style.height.px]="blankBottomHeight"></div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>',changeDetection:e.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ApplicationRef},{type:bt,decorators:[{type:e.Optional}]},{type:e.ChangeDetectorRef},{type:e.ElementRef}]},t.propDecorators={footerHeight:[{type:e.Input}],canvasWidth:[{type:e.Input}],columnsGroup:[{type:e.Input}],topHideHeight:[{type:e.Input}],bottomHideHeight:[{type:e.Input}],startRowIndex:[{type:e.Input}],data:[{type:e.Input}],dataChange:[{type:e.Output}],scrollBarMode:[{type:e.Input}],contextMenuItems:[{type:e.Input}],checkedRows:[{type:e.Input}],ps:[{type:e.ViewChild,args:["ps"]}],tableRowsCmp:[{type:e.ViewChild,args:["mainRows"]}],rightRowsCmp:[{type:e.ViewChild,args:["rightRows"]}],fixedLeftEl:[{type:e.ViewChild,args:["fixedLeft"]}],fixedRightEl:[{type:e.ViewChild,args:["fixedRight"]}],mainArea:[{type:e.ViewChild,args:["main"]}],viewScrollContainer:[{type:e.ViewChild,args:["viewScrollContainer"]}]},t}(),Et=function(){function t(t,e,i,n,r,o){this.dg=t,this.dgb=e,this.cd=i,this.el=n,this.zone=r,this.render=o,this._mouseenter=null,this._mouseleave=null}return t.prototype.ngOnInit=function(){var t=this;this.dg.rowHover&&this.zone.runOutsideAngular(function(){t._mouseenter=U.on(t.el.nativeElement,"mouseenter",t.onmouseenter.bind(t),{target:".f-datagrid-body-row",options:{capture:!0}}),t._mouseleave=U.on(t.el.nativeElement,"mouseleave",t.onmouseleave.bind(t),{target:".f-datagrid-body-row",options:{capture:!0}})})},t.prototype.ngOnDestroy=function(){this._mouseenter&&this._mouseenter(),this._mouseleave&&this._mouseleave()},t.prototype.onmouseenter=function(t){this.setRowHoverCls(t)},t.prototype.onmouseleave=function(t){this.setRowHoverCls(t,!1)},t.prototype.setRowHoverCls=function(t,e){if(void 0===e&&(e=!0),this.dg.rowHover&&t.target.matches(".f-datagrid-body-row")){this.rowIndex=t.target.getAttribute("index");var i=this.dg.el.nativeElement.querySelector(".f-datagrid-body");if(i){var n=i.querySelector(".f-datagrid-body-fixed-left"),r=i.querySelector(".f-datagrid-body-fixed-right"),o=i.querySelector(".f-datagrid-body-center"),s=e?"addClass":"removeClass",l='tr[index="'+this.rowIndex+'"]',a=this.el.nativeElement.closest("div");if(a&&a.className){var c=o.querySelector(l);if(!c)return;if(c.className.indexOf("f-datagrid-disable-row")>-1)return;var d=null,h=null;r&&(h=r.querySelector(l)),n&&(d=n.querySelector(l)),n&&d&&this.render[s](d,this.dg.hoverRowCls),r&&h&&this.render[s](h,this.dg.hoverRowCls),this.render[s](c,this.dg.hoverRowCls)}}}},t.decorators=[{type:e.Directive,args:[{selector:"[row-hover]",exportAs:"rowHover"}]}],t.ctorParameters=function(){return[{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]},{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]},{type:e.ChangeDetectorRef},{type:e.ElementRef},{type:e.NgZone},{type:e.Renderer2}]},t.propDecorators={rowIndex:[{type:e.Input}],rowData:[{type:e.Input,args:["row-hover"]}]},t}(),It=function(){function t(t,i,n,r,o,s){this.dg=t,this.injector=i,this.fb=n,this.el=r,this.render=o,this.drHover=s,this.editable=!1,this.clickHandler=new e.EventEmitter,this.form=new m.FormGroup({}),this.documentRowDblclickEvent=null,this.columnsChangedSubscription=null,this.datasourceChangedSubscription=null,this.subscriptions=[],this.dfs=this.injector.get(K),this.ngZone=this.injector.get(e.NgZone),this.cd=this.injector.get(e.ChangeDetectorRef),this.dgb=this.injector.get(xt)}return Object.defineProperty(t.prototype,"rowId",{get:function(){return this.rowData?this.dfs.primaryId(this.rowData):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return!!this.dg.disableRow&&this.dg.disableRow(this.rowData,this.rowIndex)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.datasourceChangedSubscription=this.dg.dgs.onDataSourceChange.subscribe(function(){t.renderCustomStyle()}),this.columnsChangedSubscription=this.dg.dgs.columnsChanged.subscribe(function(){t.createControl()});var e=this.dg.dfs.rowUpdate$.subscribe(function(e){e&&e.data&&t.dfs.primaryId(e.data)===t.rowId&&t.renderCustomStyle(e.data)});this.subscriptions.push(e);var i=this.dg.dgs.updateEmptyStyle$.subscribe(function(){t.updateCellEmptyStyle()});this.subscriptions.push(i);var n=this.dg.dfs.selectRow$.pipe(r.filter(function(e){return e.id===t.rowId})).subscribe(function(){if(t.dg.selectedRow&&!t.dg.selectedRow.dr){var e=t.getRowPosition();"left"===e?t.dg.selectedRow.drl=t:"right"===e?t.dg.selectedRow.drr=t:t.dg.selectedRow.dr=t}});this.subscriptions.push(n)},t.prototype.ngOnDestroy=function(){this.columnsChangedSubscription&&(this.columnsChangedSubscription.unsubscribe(),this.columnsChangedSubscription=null),this.datasourceChangedSubscription&&(this.datasourceChangedSubscription.unsubscribe(),this.datasourceChangedSubscription=null),this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions=[]),this.form&&(this.form=null)},t.prototype.ngOnChanges=function(t){t.rowData&&!t.rowData.isFirstChange()&&this.updateCellEmptyStyle()},t.prototype.ngAfterViewInit=function(){this.renderCustomStyle(),this.updateCellEmptyStyle()},t.prototype.getRowPosition=function(){var t=this.el.nativeElement.id;return t.indexOf("fixedleft")>-1?"left":t.indexOf("fixedright")>-1?"right":"center"},t.prototype.renderCustomStyle=function(t){if(void 0===t&&(t=null),this.dg.rowStyler){var e=t||this.rowData,i=this.dg.rowStyler(e,this.rowIndex);i&&Object.keys(i).length?this.dg.renderCustomStyle(i,this.el.nativeElement):this.dg.dgs.removeCssRule("#"+this.dg.id+" #"+this.el.nativeElement.id)}},t.prototype.onRowClick=function(t){var e=this;if(!(t.target.className&&t.target.className.indexOf("checkbox-column")>-1)&&this.dg.enableSelectRow&&!this.dg.disabled){if(this.dg.disableRow&&this.dg.disableRow(this.rowData,this.rowIndex))return t.stopPropagation(),!1;var i=this.dfs.primaryId(this.rowData);i||console.warn("在第 "+(this.rowIndex+1)+" 行，主键字段["+this.dg.idField+"]的值为 空，请检查相关数据。");var n={rowIndex:this.rowIndex,rowData:this.rowData,gridInstance:this.dg};if(t.shiftKey||this.dg.dgs.focusRowChanged.emit({rowIndex:this.rowIndex,rowData:this.rowData}),!this.dg.sms.beforRowClick(S({},n,{e:t,id:i,dr:this})))if(this.dfs.isRowSelected(i))this.dg.selectedRow&&!this.dg.selectedRow.dr&&(this.dg.selectedRow.dr=this),this.dg.keepSelect?this.dg.rowClick.emit({data:this.rowData,grid:this.dg,dblclick:!1}):this.dg.beforeUnselect(n).subscribe(function(t){if(t){e.dfs.unSelectRow(e.rowIndex,e.rowData);var i=e.el.nativeElement.className;i.indexOf("f-datagrid-row-selected")>-1&&(e.el.nativeElement.className=i.replace("f-datagrid-row-selected",""))}e.dg.rowClick.emit({data:e.rowData,grid:e.dg,dblclick:!1}),e.dg.dgs.setSelecedRow.emit()});else{var o=this.dg.endRowEdit();o&&!o.canEnd||this.dg.beforeSelect(n).pipe(r.delay(100)).subscribe(function(t){if(t){e.dfs.selectRow(e.rowIndex,e.rowData),e.dg.selectedRow&&(e.dg.selectedRow.dr=e);var i=e.el.nativeElement.className;-1===i.indexOf("f-datagrid-row-selected")&&(e.el.nativeElement.className=i+" f-datagrid-row-selected"),e.clickHandler.emit()}e.dg.rowClick.emit({data:e.rowData,grid:e.dg,dblclick:!1}),e.dg.dgs.setSelecedRow.emit({selected:!0,id:e.dfs.primaryId(e.rowData)})})}}},t.prototype.initFormControl=function(){this.form=this.fb.group({}),this.createControl(),this.form.bindingData=this.rowData},t.prototype.createControl=function(){var t=this;this.dg&&this.dg.flatColumns&&this.dg.flatColumns.forEach(function(e){if((e.editor||e.editorTemplate)&&!t.form.controls[e.field]){var i=t.createFormControl(e);t.form.addControl(e.field,i)}})},t.prototype.createFormControl=function(t){return this.fb.control(U.getValue(t.field,this.rowData),{validators:t.editor?this.bindValidations(t.editor.validators):null})},t.prototype.bindValidations=function(t){var e=this,i=[];return t&&t.length&&t.forEach(function(t){var n=null;switch(t.type){case"required":n=m.Validators.required;break;case"min":n=m.Validators.min(t.value);break;case"max":n=m.Validators.max(t.value);break;case"minLength":n=m.Validators.minLength(t.value);break;case"maxLength":n=m.Validators.maxLength(t.value);break;case"email":n=m.Validators.email;break;case"requiredTrue":n=m.Validators.requiredTrue;break;case"pattern":n=m.Validators.pattern(t.value)}if(n)i.push(n);else if(e.dg.validators&&e.dg.validators.length){var r=e.dg.validators.find(function(e){return e.name===t.type});r&&(n=r.value(e.rowData),i.push(n))}}),i},t.prototype.refresh=function(){this.updateRowHeight(),this.updateCellEmptyStyle()},t.prototype.updateRowHeight=function(){if(!this.dg.nowrap){var t=this.dgb.mainArea.nativeElement.querySelector('tr[index="'+this.rowIndex+'"]');t.style.height="auto";var e=null,i=null,n=[t.offsetHeight];if(this.dgb){this.dgb.fixedLeftEl&&(e=this.dgb.fixedLeftEl.nativeElement.querySelector('tr[index="'+this.rowIndex+'"]'))&&(e.style.height="auto",n.push(e.offsetHeight)),this.dgb.fixedRightEl&&(i=this.dgb.fixedRightEl.nativeElement.querySelector('tr[index="'+this.rowIndex+'"]'))&&(i.style.height="auto",n.push(i.offsetHeight));var r=Math.max.apply(Math,x(n));t.style.height=r+"px",e&&(e.style.height=r+"px"),i&&(i.style.height=r+"px"),this.cd.markForCheck(),this.dgb.updateCanvasHeight()}}},t.prototype.updateCellEmptyStyle=function(){var t=this;if(this.dg.enableEditCellStyle){var e=!1;this.dg.disableRow&&(e=this.dg.disableRow(this.rowData,this.rowIndex));!function(i){if(i.length)for(var n=0;n<i.length;n++){var r=i[n].getAttribute("field");if(r){var o=t.dfs.getColumn(r);if(o){if(!o.editor)continue;var s="right"===o.align?"allow-edit-cell-left":"allow-edit-cell",l=G[o.editor.type],a=i[n].querySelector(".cell-text-box"),c=U.getValue(r,t.rowData),d=t.dg.colFormatSer.format(c,t.rowData,o.formatter);!t.dg.editable||e||t.dg.cellIsReadOnly(o,t.rowData)?(i[n].className=i[n].className.replace(s,""),i[n].className=i[n].className.replace(l,""),a&&(a.className.indexOf("cell-empty")>-1&&(a.className=a.className.replace("cell-empty","")),""===c||null===c||c===undefined?a.innerHTML="":a.innerHTML=d)):(a&&(""===c||null===c||c===undefined?(-1===a.className.indexOf("cell-empty")&&(a.className=a.className+" cell-empty"),a.innerHTML=U.getWhenEmptyText(o,t.dg.localeService.localeId)):a.innerHTML=d),i[n].className.indexOf("cell-readonly")>-1&&(i[n].className=i[n].className.replace("cell-readonly","")),-1===i[n].className.indexOf(s)&&t.render.addClass(i[n],s),-1===i[n].className.indexOf(l)&&t.render.addClass(i[n],l))}}}}(this.el.nativeElement.querySelectorAll('td[field]:not([field="_datagrid-setting-control_"])'))}},t.decorators=[{type:e.Directive,args:[{selector:"[grid-row]",exportAs:"gridRow"}]}],t.ctorParameters=function(){return[{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]},{type:e.Injector},{type:m.FormBuilder},{type:e.ElementRef},{type:e.Renderer2},{type:Et,decorators:[{type:e.Optional},{type:e.Self}]}]},t.propDecorators={editable:[{type:e.Input}],rowData:[{type:e.Input,args:["grid-row"]}],rowIndex:[{type:e.Input}],clickHandler:[{type:e.Output}],cells:[{type:e.ContentChildren,args:[e.forwardRef(function(){return Dt}),{descendants:!0}]}],onRowClick:[{type:e.HostListener,args:["click",["$event"]]}]},t}(),kt=function(){function t(t,e,i,n,r){this.resolver=t,this.container=e,this.app=i,this.fb=n,this.dg=r,this.cfs=null,this.cfs=this.dg.inject.get(f.ColumnFormatService)}return t.prototype.ngOnInit=function(){this.column.editor&&(this.createCellEditor(),this.dg.dgs.cellEditorCreated.emit({editorRef:this.componentRef,column:this.column,cellEditorRef:this}))},t.prototype.ngOnDestroy=function(){this.dg.dgs.cellEditorDestory.emit({editorRef:this.componentRef,column:this.column,cellEditorRef:this})},t.prototype.createCellEditor=function(){var t=this,e=this.column.editor.type;if(this.dg.editors[e]){var i=this.resolver.resolveComponentFactory(this.dg.editors[e]);this.componentRef=this.container.createComponent(i),this.componentRef.instance.column=this.column,this.componentRef.instance.group=this.group,this.componentRef.instance.height=this.height,this.componentRef.instance.controlId=(this.dg.id||"DATAGRID_EDITOR")+"_"+this.column.field,this.updateControlValue(),this.componentRef.changeDetectorRef.markForCheck(),this.componentRef.changeDetectorRef.detectChanges(),setTimeout(function(){t.componentRef.instance.instance&&"lookup"===e&&(t.componentRef.instance.instance.changeDetector.destroyed||t.componentRef.instance.instance.changeDetector.detectChanges())})}else console.error("找不到名称为 "+e+" 对应的类。")},t.prototype.updateControlValue=function(){this.group&&(this.group.bindingData=this.rowData,this.group.controls[this.column.field]&&this.group.controls[this.column.field].setValue(this.value,{emitEvent:!0}))},t.prototype.hideCover=function(){!this.column.editor||"combolist"!==this.column.editor.type&&"combo-lookup"!==this.column.editor.type||this.componentRef.instance.hide(!1)},t.decorators=[{type:e.Directive,args:[{selector:"[cell-editor]"}]}],t.ctorParameters=function(){return[{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef},{type:e.ApplicationRef},{type:m.FormBuilder},{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]}]},t.propDecorators={column:[{type:e.Input}],group:[{type:e.Input}],rowData:[{type:e.Input}],value:[{type:e.Input}],height:[{type:e.Input}]},t}(),Ft=function(){function t(t){this.sanitizer=t,this.dangerWords=["<script","onerror","alert("]}return t.prototype.transform=function(t,e){switch(e){case"html":return""===t||null===t||t===undefined?t:this.sanitizer.bypassSecurityTrustHtml(t);case"style":return this.sanitizer.bypassSecurityTrustStyle(t);case"script":return this.sanitizer.bypassSecurityTrustScript(t);case"url":return this.sanitizer.bypassSecurityTrustUrl(t);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(t);default:throw new Error("Invalid safe type specified: "+e)}},t.prototype.hasDanger=function(t){if("number"==typeof t||"boolean"==typeof t)return!1;var e=0;return this.dangerWords.forEach(function(i){t.indexOf(i)>-1&&e++}),0!==e},t.decorators=[{type:e.Pipe,args:[{name:"safe"}]}],t.ctorParameters=function(){return[{type:g.DomSanitizer}]},t}(),Dt=function(){function t(t,i,n,r,o,s,l){var a=this;this.dg=t,this.dr=i,this.el=n,this.cd=r,this.injector=o,this.colFormatSer=s,this.domSanitizer=l,this.cls="",this.lastColumn=!1,this._isEditing=!1,this.controlHeight="auto",this.isSelected=!1,this._cellEditorTemplate=null,this.cellClick=new e.EventEmitter,this.cellDblClick=new e.EventEmitter,this.cellContext={},this.cellStyler={},this.safePipe=null,this.ro=null,this.canEdit=function(){return a.dg.editable&&"cell"===a.dg.editMode&&a.column.editor},this.dfs=this.injector.get(K),this.dgs=this.injector.get(Z),this.safePipe=new Ft(this.domSanitizer),this.render=this.injector.get(e.Renderer2)}return Object.defineProperty(t.prototype,"isEditing",{get:function(){return this._isEditing},set:function(t){var e=this;this._isEditing!==t&&(this._isEditing=t,t&&(this.dr.form&&Object.keys(this.dr.form.controls).length||this.dr.initFormControl(),this.column.editorTemplate&&this.column.editorTemplate.elementRef&&(this.cellContext.formGroup=this.dr.form,setTimeout(function(){if(e.el){var t=e.el.nativeElement.querySelector("input,textarea");t&&t.focus()}},10))),this.column.editor&&"textarea"===this.column.editor.type&&(this.dg.nowrap||(this.controlHeight=this.dr.el.nativeElement.offsetHeight)),this.cd.destroyed||this.cd.detectChanges())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellEditorTemplate",{get:function(){return this._cellEditorTemplate},set:function(t){this._cellEditorTemplate=t,t&&this.dg.dgs.cellEditorCreated.emit({editorRef:null,column:this.column,cellEditorRef:null,templateRef:t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.rowData&&this.column&&this.column.field?U.getValue(this.column.field,this.rowData):""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formControl",{get:function(){return this.cellEditor?this.cellEditor.componentRef.instance.formControl:this.column.editorTemplate?this.dr.form.get(this.column.field):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlign",{get:function(){var t="center";switch(this.column.valign){case"top":t="flex-start";break;case"bottom":t="flex-end";break;default:t="center"}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlign",{get:function(){var t="flex-start";return"right"===this.column.align?t="flex-end":"center"===this.column.align&&(t="center"),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellStyle",{get:function(){this.dg.nowrap;var t={width:this.lastColumn?this.column.width-6+"px":"100%"};return this.isEditing?Object.assign(t,{"justify-content":this.horizontalAlign}):Object.assign(t,{"align-items":this.verticalAlign,"justify-content":this.horizontalAlign})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellFormatterIsFn",{get:function(){return"function"==typeof this.column.formatter||"boolean"===this.column.formatter.type},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.initCellTemplateContext()},t.prototype.ngOnChanges=function(t){if(t.rowData&&!t.rowData.isFirstChange()&&(this.initCellTemplateContext(),this.buildCustomCellStyle(),this.formControl)){var e=U.getValue(this.column.field,this.rowData);this.formControl.setValue(e)}},t.prototype.initCellTemplateContext=function(){this.cellContext={field:this.column.field,rowIndex:this.rowIndex,rowData:this.rowData,column:this.column,instance:this,formGroup:this.dr.form,tools:{utils:this.dg.commonUtils,format:this.dg.colFormatSer,number:this.dg.colFormatSer.numberhelper,date:this.dg.colFormatSer.datehelper}}},t.prototype.ngAfterViewInit=function(){this.buildCustomCellStyle()},t.prototype.ngOnDestroy=function(){this.cellSubscription&&(this.cellSubscription.unsubscribe(),this.cellSubscription=null),this.rowUpdateSubscription&&(this.rowUpdateSubscription.unsubscribe(),this.rowUpdateSubscription=null)},t.prototype.buildCustomCellStyle=function(t){void 0===t&&(t=null);var e=this.el.nativeElement.parentNode;if(e.id||(e.id="row_"+this.dr.rowId+"_"+this.rowIndex+"-"+this.column.field),e.id=e.id.replace(/\./g,"_"),this.column.styler){var i=t||this.rowData,n=this.column.styler(i[this.column.field],i,this.rowIndex);n&&Object.keys(n).length&&this.dg.renderCustomStyle(n,e)}else this.dg.dgs.removeCssRule("#"+e.id)},t.prototype.updateValue=function(t){var e,i=this;if(this.dr.form){U.setValue(this.column.field,t,this.rowData);var n=this.rowData[this.dg.idField],r=this.dg.data.find(function(t){return t[i.dg.idField]===n});r&&U.setValue(this.column.field,t,r),this.dfs.updateCheckedData(n,((e={})[this.column.field]=t,e)),this.cd.destroyed||this.cd.detectChanges()}},t.decorators=[{type:e.Component,args:[{selector:"grid-body-cell",template:'\n    <div\n     [attr.cell-tooltip]="column.showTips && !isEditing" [attr.tipMode]=" column.tipMode || \'auto\'"\n     [attr.message]="column | tipmsg: rowData"  [attr.position]=" column?.tipOptions?.position || \'top-left\'"\n     [attr.tipWidth]="column?.tipOptions?.width" [attr.tipHeight]="column?.tipOptions?.height"\n     class="f-datagrid-cell-content" #cellContainer\n     [ngStyle]="cellStyle"\n    >\n        <ng-container *ngIf="!isEditing && !column.template">\n            <ng-container *ngIf="column.formatter">\n                <span class="cell-text-box" *ngIf="cellFormatterIsFn" [innerHtml]=" column | formatCellData: rowData | safe: \'html\'"></span>\n                <span class="cell-text-box" *ngIf="!cellFormatterIsFn">{{  column | formatCellData: rowData }}</span>\n            </ng-container>\n            <span *ngIf="!column.formatter" class="cell-text-box" [class.grid-cell-nowrap]="dg.nowrap" [class.grid-cell-wrap]="!dg.nowrap">{{  column | formatCellData: rowData }}</span>\n        </ng-container>\n\n        <ng-container #cellTemplate *ngIf="!isEditing && column.template" [ngTemplateOutlet]="column.template" [ngTemplateOutletContext]="{$implicit: cellContext}"></ng-container>\n        <ng-container #cellEditorTemplate *ngIf="isEditing && column.editorTemplate" [ngTemplateOutlet]="column.editorTemplate" [ngTemplateOutletContext]="{$implicit: cellContext}"></ng-container>\n        <ng-container #editorTemplate *ngIf="isEditing && !column.editorTemplate" cell-editor [height]="controlHeight" [rowData]="rowData" [value]="value" [column]="column" [group]="dr.form"></ng-container>\n    </div>\n    ',changeDetection:e.ChangeDetectionStrategy.Default}]}],t.ctorParameters=function(){return[{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]},{type:It,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return It})]}]},{type:e.ElementRef},{type:e.ChangeDetectorRef},{type:e.Injector},{type:f.ColumnFormatService},{type:g.DomSanitizer}]},t.propDecorators={width:[{type:e.Input}],height:[{type:e.Input}],cls:[{type:e.Input}],column:[{type:e.Input}],rowData:[{type:e.Input}],rowIndex:[{type:e.Input}],lastColumn:[{type:e.Input}],isEditing:[{type:e.Input}],isSelected:[{type:e.Input}],cellContainer:[{type:e.ViewChild,args:["cellContainer"]}],cellTemplateVcr:[{type:e.ViewChild,args:["cellTemplate",{read:e.ViewContainerRef}]}],cellEditorTemplate:[{type:e.ViewChild,args:["cellEditorTemplate",{read:e.ViewContainerRef}]}],cellEditor:[{type:e.ViewChild,args:[kt]}],cellClick:[{type:e.Output}],cellDblClick:[{type:e.Output}]},t}(),_t=function(){function t(t,e,i,n,o){var s=this;this.injector=t,this.el=e,this.render=i,this.dg=n,this.ngZone=o,this.cellEditorCreatedSubscription=null,this.cellEditorDestorySubscription=null,this.dgb=this.injector.get(xt),this.dr=this.injector.get(It),this.dfs=this.injector.get(K),this.dgs=this.injector.get(Z),this.cellEditorCreatedSubscription||(this.cellEditorCreatedSubscription=this.dgs.cellEditorCreated.pipe(r.filter(function(t){var e=t.column;t.editorRef,t.cellEditorRef,t.templateRef;return e.field===s.column.field&&s.dg.selectedRow.id===s.dr.rowId})).subscribe(function(t){var e=t.editorRef,i=t.cellEditorRef,n=t.templateRef;e?(s.editor=e.instance,s.formControl=s.editor.formControl,s.cellEditorRef=i,s.emitBeginEdit()):(s.formControl=s.dr.form.get(s.column.field),s.bindEditorInputEvent(),s.dg.beginEdit.emit({editor:null,column:s.column,rowData:s.rowData,gridInstance:s.dg,template:n}))}))}return t.prototype.ngOnInit=function(){},t.prototype.ngOnChanges=function(t){t.rowData&&!t.rowData.isFirstChange()&&this.setCellClsWithEditorType()},t.prototype.ngAfterViewInit=function(){this.initCellEvent(),this.setCellClsWithEditorType()},t.prototype.initCellEvent=function(){var t=this;this.column&&(this.column.editor||this.column.editorTemplate)?(this.dg.clickToEdit||(this.celldblclick=this.render.listen(this.el.nativeElement,"dblclick",function(e){t.onDblClickCell(e)})),this.el.nativeElement.edit=function(e){return t.onClickCell(e)},this.el.nativeElement.editCell=function(e){t.openCellEditor()}):this.clickTimer=0,this.el.nativeElement.gridCellData={rowData:this.rowData,rowIndex:this.dr.rowIndex},this.el.nativeElement.closeEdit=function(){return t.closeEditingCell()},this.el.nativeElement.selectCell=function(e,i){t.dg.disableRow&&t.dg.disableRow(t.rowData,t.dr.rowIndex)||(t.dg.currentCell&&t.dg.currentCell.cellElement.id===i.id&&!t.dg.keepSelect?t.dg.cancelSelectCell():(t.selectCell(t.column.field,i),t.dg.cellClick.emit({column:t.column,rowData:t.rowData,gridInstance:t.dg,event:e})))},this.el.nativeElement.cancelSelected=function(){it.removeClass(t.el.nativeElement,A),t.render.removeClass(t.el.nativeElement,M)}},t.prototype.ngOnDestroy=function(){this.cellclick&&this.cellclick(),this.celldblclick&&this.celldblclick(),this.unBindEditorInputEvent(),this.bindCellEventSubscription&&(this.bindCellEventSubscription.unsubscribe(),this.bindCellEventSubscription=null),this.cellEditorCreatedSubscription&&(this.cellEditorCreatedSubscription.unsubscribe(),this.cellEditorCreatedSubscription=null),this.cellEditorDestorySubscription&&(this.cellEditorDestorySubscription.unsubscribe(),this.cellEditorDestorySubscription=null)},t.prototype.isDifferentCell=function(){return!this.dg.currentCell||(!this.dg.selectedRow||this.dg.selectedRow.index!==this.dr.rowIndex||(this.dr.rowIndex!==this.dg.currentCell.rowIndex||this.dg.currentCell.field!==this.column.field))},t.prototype.onClickCell=function(t){var e=this;document.body.click(),this.dg.beforeClickCell.emit({rowIndex:this.dr.rowIndex,rowData:this.rowData,column:this.column,gridInstance:this.dg}),this.dr.disabled||this.dg.disabled||(this.dg.editable&&!this.isReadonly()?"row"!==this.dg.editMode&&("default"===this.dg.selectionMode&&t&&(t.ctrlKey||t.shiftKey)||(t.stopPropagation(),"INPUT"!==t.target.nodeName&&(this.dg.clickToEdit&&!this.dg.dblclickRow.observers.length&&(this.dg.clickDelay=0),this.render.addClass(this.dg.el.nativeElement,"f-datagrid-unselect"),!this.dg.isSingleClick&&this.dg.editMode&&(this.dg.isSingleClick=!0,this.clickTimer=setTimeout(function(){e.dg.isSingleClick&&e.dg.editable&&"cell"===e.dg.editMode&&(e.dg.isSingleClick=!1,clearTimeout(e.clickTimer),e.closeEditingCell().subscribe(function(i){i&&(e.dg.clickToEdit?e.openCellEditor():e.selectCell(e.column.field),e.render.removeClass(e.dg.el.nativeElement,"f-datagrid-unselect"),t.preventDefault())}))},this.dg.clickDelay))))):this.dg.enableHighlightCell&&(t.stopPropagation(),this.dg.endEditing(),this.selectCell(this.column.field)))},t.prototype.onDblClickCell=function(t){var e=this;this.dg.disabled||this.isReadonly()||"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&(this.dg.editable&&"cell"===this.dg.editMode&&this.closeEditingCell().subscribe(function(t){t&&setTimeout(function(){e.openCellEditor()})}),this.clickTimer&&(this.dg.isSingleClick=!1,clearTimeout(this.clickTimer),this.clickTimer=null))},t.prototype.isReadonly=function(t){return void 0===t&&(t=this.column),!!(this.dg.mergeCell&&this.dg.mergeFields.indexOf(t.field)>-1)||this.getReadonlyValue(t)},t.prototype.getReadonlyValue=function(t){if(void 0===t&&(t=this.column),t.readonly!==undefined){if("boolean"==typeof t.readonly)return t.readonly;if("function"==typeof t.readonly)return t.readonly(this.rowData)}return!1},t.prototype.openCellEditor=function(){var t=this;if(!this.dr.disabled)if((this.column.editor||this.column.editorTemplate)&&this.dg.editable&&!this.isReadonly()){var e=this.dg.beforeEdit({rowIndex:this.dr.rowIndex,rowData:this.rowData,column:this.column,gridInstance:this.dg});e&&e.subscribe?(this.dg.currentCell&&(this.dg.currentCell.cellRef&&this.dg.currentCell.cellRef.column.field===this.column.field||(this.dg.currentCell.cellRef=this.dc)),e.subscribe(function(e){e?(t.isDifferentCell()&&t.selectCell(t.column.field),t.dfs.editCell()):t.selectCell(t.column.field)})):console.warn("please return an Observable Type.")}else this.selectCell(this.column.field)},t.prototype.emitBeginEdit=function(){var t=this.cellEditorRef||this.dc.cellEditor;this.render.removeClass(this.dg.el.nativeElement,"f-datagrid-unselect"),"cell"===this.dg.editMode&&(this.dg.selectedRow.editors=[this.editor],this.dg.currentCell.editor=this.editor,this.dg.currentCell.cellEditorRef=t,this.bindEditorInputEvent(),this.render.addClass(this.el.nativeElement,M),this.dg.beginEdit.emit({editor:t,column:this.column,rowData:this.rowData,gridInstance:this.dg}),"textarea"===this.column.editor.type&&this.column.editor.options&&"dialog"===this.column.editor.options.editType&&this.editor.showDialog()),this.dr&&!this.dg.nowrap&&this.dr.updateRowHeight()},t.prototype.closeEditingCell=function(){var t=this;if(!this.dg.isCellEditing())return n.of(!0);var e=null,i=null;if(!this.dg.currentCell)return n.of(!0);if(e=this.dg.currentCell.cellRef){if(!e.isEditing)return n.of(!0);if(e.cellEditor&&e.cellEditor.componentRef&&!e.column.editorTemplate){if(!(i=e.cellEditor.componentRef.instance))return n.of(!0);if(i.inputElement){var r=i.inputElement.nodeName,o=i.options&&i.options.onBlur;o&&("INPUT"!==r&&"TEXTAREA"!==r||this.dg.focusElement!==i.inputElement||o({editorRef:i,rowData:e.rowData})),i.inputElement.blur&&i.inputElement.blur(),this.dg.focusElement=null}if(i.blur&&i.blur(),i.pending)return n.of(!1);if(!i.formControl)return n.of(!0);if(i.formControl.pending)return n.of(!1);if(i.formControl&&i.formControl.invalid&&!this.dg.endEditByInvalid)return n.of(!1)}}this.dg.isSingleClick=!1;var s=(i||e).column,l=this.dg.afterEdit(e.rowIndex,e.rowData,s,i);if(l&&l.subscribe){var a=n.of(undefined);return l.subscribe(function(r){if(r){var o=e.value;e&&e.formControl&&o!==e.formControl.value&&(o=e.formControl.value,e.isEditing=!1,e.updateValue(o)),t.dfs.endEditCell(),t.dgs.onEndCellEdit(t.dfs.getCurrentCell()),t.unBindEditorInputEvent(),t.render.removeClass(t.el.nativeElement,M),t.dg.selectedRow&&(t.dg.selectedRow.editors=[]),t.dfs.rowUpdate$.next({index:e.rowIndex,data:e.rowData,cellRef:e}),t.dg.endEdit.emit({rowIndex:e.rowIndex,rowData:e.rowData,column:s,value:o}),t.dgs.refreshFooterData.emit(),a=n.of(!0),t.dg.selectedRow&&t.dg.selectedRow.dr&&t.dg.selectedRow.dr.refresh()}else e&&e.cellEditor?((i=e.cellEditor.componentRef.instance).inputElement.focus(),a=n.of(!1)):a=n.of(!0)}),a}console.warn("please return an Observable Type.")},t.prototype.cancelCellEditing=function(){this.dg.currentCell&&this.dg.currentCell.isEditing&&this.dg.selectedRow.index>-1&&(this.dfs.resetRow(this.dg.selectedRow.id),this.dc.rowData=this.dg.selectedRow.data,this.formControl.reset(U.getValue(this.column.field,this.dc.rowData)),this.closeEditingCell())},t.prototype.bindEditorInputEvent=function(){var t=this,e=this.cellEditorRef||this.dc.cellEditor,i=null;e?i=e.componentRef.instance.inputElement:this.column.editorTemplate&&(i=this.dc.el.nativeElement.querySelector("input,textarea")),i&&(i.focus(),this.dg.selectOnEditing&&this.column.editorTemplate&&setTimeout(function(){i.select&&i.select()}),this.editorInputKeydownEvent=this.render.listen(i,"keydown",function(e){t.onKeyDownForInput(e)}))},t.prototype.unBindEditorInputEvent=function(){this.editorInputKeydownEvent&&(this.editorInputKeydownEvent(),this.editorInputKeydownEvent=null)},t.prototype.onKeyDownForInput=function(t){var e=this,i=t.keyCode;if(!t.altKey&&!t.ctrlKey)switch((this.editor&&this.editor.stopPropagation||13===i||this.column.editorTemplate)&&t.stopPropagation(),i){case 32:"switch"===this.column.editor.type&&(t.preventDefault(),this.editor.instance.updateChecked(t,!1));break;case 13:this.closeEditingCell().pipe(r.debounceTime(100)).subscribe(function(i){if(i){var n={gird:e.dg,cell:e.dg.currentCell,event:t};if(e.column.onEnterHandler)e.column.onEnterHandler(n);else{var r=e.dg.currentCell.cellElement.nextElementSibling;e.dg.currentCell.lastRow&&!r&&e.dg.lastCellEnterHandle.emit(n)}}});break;case 27:this.cancelCellEditing();break;case 9:t.stopPropagation(),this.dg.clickDelay=0,t.shiftKey?this.closeEditingCell().subscribe(function(t){t&&e.movePrevCellAndEdit()}):(this.closeEditingCell().subscribe(function(i){i&&e.moveNextCellAndEdit(t)}),t.preventDefault())}},t.prototype.selectCell=function(t,e){this.closeEditingCell(),e=e||this.el.nativeElement,this.clearCellSelectedClass(),t!==this.dg.ControlPanelFeild&&this.render.addClass(e,A),this.dfs.setCurrentCell(this.dr,t,e,this.dc),this.moveScrollbar(e)},t.prototype.moveScrollbar=function(t){var e=t.offsetLeft+t.offsetWidth,i=this.dg.width-this.dgb.columnsGroup.leftFixedWidth,n=t.getBoundingClientRect(),r=this.dgb.ps.elementRef.nativeElement,o=r.getBoundingClientRect(),s=r.scrollTop,l=r.scrollLeft,a=this.dgb.ps.elementRef.nativeElement.scrollLeft;if(e>i)(c=e-i+2)>a&&this.dgb.ps.scrollToX(c);else if(n.x<o.x){var c=l-n.x;this.dgb.ps.scrollToX(c)}var d=n.top-o.top+n.height;if(d>o.height){var h=d-o.height;this.dgb.ps.scrollToY(s+h)}else n.y<o.y&&this.dgb.ps.scrollToY(s-(o.y-n.y))},t.prototype.moveNextCellAndEdit=function(t){var e=this.dfs.getColumnIndex(this.column.field);if(e+1<this.dgb.columnsGroup.normalColumns.length){var i=this.dgb.columnsGroup.normalColumns[e+1],n=this.dg.currentCell.cellElement.nextElementSibling;if(i&&(!i.editor&&!i.editorTemplate||this.isReadonly(i)))return void(n&&n.selectCell(t,n));n&&(n.focus(),(i.editor||i.editorTemplate)&&(n.editCell(),this.dgs.onCellEdit(n)))}else{var r=this.dg.currentCell.cellElement.parentElement.nextElementSibling;if(r&&"TR"===r.tagName){for(var o=!1,s=0;!o;)(o=!!r.children[s].editCell)||s++;"default"===this.dg.selectionMode&&this.dg.clearCheckeds(),r.children[s].editCell()}}},t.prototype.movePrevCellAndEdit=function(){var t=this.dfs.getColumnIndex(this.column.field);if(t-1>=0){var e=this.dgb.columnsGroup.normalColumns[t-1];if(e&&this.isReadonly(e))return;var i=this.dg.currentCell.cellElement.previousElementSibling;i&&(i.focus(),e.editor&&(i.click(),this.dgs.onCellEdit(i)))}},t.prototype.clearCellSelectedClass=function(){var t=this;if(this.dg.currentCell){it.removeClass(this.dg.currentCell.cellElement,A),this.render.removeClass(this.dg.currentCell.cellElement,M);var e=this.dg.el.nativeElement.querySelectorAll("."+A);e.length&&e.forEach(function(e){t.render.removeClass(e,A)})}this.dg.removeCellSelectedCls()},t.prototype.setCellClsWithEditorType=function(){if(this.dg.currentCell&&this.dg.enableHighlightCell&&(this.dg.currentCell.field!==this.column.field||this.dg.currentCell.rowId!==this.rowData[this.dg.idField]||this.dc.isEditing||(this.clearCellSelectedClass(),this.render.addClass(this.el.nativeElement,A))),this.dg.enableEditCellStyle){var t=this.el.nativeElement;if(this.cleanOtherEditorIcon(t),!this.dr.disabled&&this.column.editor&&!this.isReadonly()){var e=this.column.editor.type,i="right"===this.column.align?"allow-edit-cell-left":"allow-edit-cell";this.render.addClass(t,i),this.render.addClass(t,G[e])}}},t.prototype.cleanOtherEditorIcon=function(t){Object.values(G).forEach(function(e){t.className.indexOf(e)>-1&&(t.className=t.className.replace("allow-edit-cell-left","").replace("allow-edit-cell",""),t.className=t.className.replace(e,""))})},t.decorators=[{type:e.Directive,args:[{selector:"[cell-editable]",exportAs:"cellEditable"}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ElementRef},{type:e.Renderer2},{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]},{type:e.NgZone}]},t.propDecorators={rowData:[{type:e.Input,args:["cell-editable"]}],column:[{type:e.Input}],dc:[{type:e.ContentChild,args:[Dt]}]},t}(),Ot=function(){function t(t,e,i,n,r,o){this.cd=t,this.dg=e,this.dgb=i,this.el=n,this.injector=r,this.ngZone=o,this.fixedRight=!1,this.isGroupRow=W,this.groupRow=B,this.isGroupFooter=$,this.visible=q,this.groupLevelField=X,this.filterConditions="",this.ro=null,this.subscriptions=[]}return Object.defineProperty(t.prototype,"groupSummaryDataInGroupRow",{get:function(){return"inGroupRow"===this.dg.groupSummaryPosition},enumerable:!0,configurable:!0}),t.prototype.listenEvent=function(){var t=this,e=this.dg.dgs.setSelecedRow.subscribe(function(e){t.detectChanges()});this.subscriptions.push(e);var i=this.dg.dfs.rowAppend$.subscribe(function(){t.detectChanges()});this.subscriptions.push(i);var n=this.dg.dfs.rowUpdate$.subscribe(function(e){e&&t.dg.groupRows&&t.dg.groupFooter&&t.dg.dfs.updateGroupFooter(e.data[t.groupRow])});this.subscriptions.push(n),this.scrollToCurrentRowSubscription=this.dg.dgs.scrollToCurrentRow.subscribe(function(){t.scrollToFirstSelectedRow()}),this.dg.dfs.checkRow$.subscribe(function(){t.detectChanges()})},t.prototype.ngOnInit=function(){this.listenEvent()},t.prototype.ngOnDestroy=function(){this.unSubscriptions()},t.prototype.unSubscriptions=function(){this.scrollToCurrentRowSubscription&&(this.scrollToCurrentRowSubscription.unsubscribe(),this.scrollToCurrentRowSubscription=null),this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe}),this.subscriptions=[])},t.prototype.ngAfterViewInit=function(){var t=this;this.ngZone.runOutsideAngular(function(){setTimeout(function(){t.dg.nowrap||t.dg.calculateGridSize()},100)})},t.prototype.getGroupColumn=function(t){return this.dg.flatColumns.find(function(e){return e.field===t})},t.prototype.detectChanges=function(){this.cd.destroyed||this.cd.detectChanges()},t.prototype.trackByField=function(t,e){return e.field},t.prototype.isElementInViewport=function(t){var e=this.dgb.ps.instance.element.getBoundingClientRect(),i=t.getBoundingClientRect(),n=i.top<=e.height+e.top,r=i.bottom<=e.bottom;return n&&r},t.prototype.scrollToFirstSelectedRow=function(){if(this.dg.selectedRow){var t=this.dg.selectedRow.index,e="#row_"+this.dg.selectedRow.id,i=document.querySelector(e);if(0===t&&this.dgb.ps&&this.dgb.ps.instance)return 0===this.dgb.ps.instance.element.scrollTop?void 0:void this.dg.scrollInstance.scrollToY(0);var n=this.dgb.getVisibleRange(),r=n.top,o=n.bottom;if(t===r||t===o)return;if(t>r&&t<o&&i&&this.isElementInViewport(i))return;if(i)i.scrollIntoView({block:"end",inline:"nearest"});else{var s=t*this.dg.rowHeight;s&&this.dg.scrollInstance.scrollToY(s)}}},t.prototype.toggleGroupRow=function(t,e,i){t.expanded=i,this.setGroupRowsVisible(t,i)},t.prototype.setGroupRowsVisible=function(t,e){var i=this;if(t.rows){var n=t.rows.filter(function(t){return t[W]}),r=t.rows.filter(function(t){return t[$]});r&&r.length&&r.forEach(function(n){n[i.visible]=e&&t.expanded}),n.forEach(function(n){n[i.visible]=e&&t.expanded&&t[i.visible],i.setGroupRowsVisible(n,e)}),n.length||t.rows.forEach(function(n){n[i.visible]=e&&t.expanded&&t[i.visible]})}},t.prototype.mergeInfo=function(t,e){return this.dg.dgs.getMergeInfo(e,t,this.dg.mergeCellInfo)},t.prototype.showCell=function(t,e){var i=this.mergeInfo(t.field,e),n=!0;return i&&(n=i.show),n},t.prototype.getRowSpan=function(t,e){var i=this.mergeInfo(t.field,e);return i&&this.showCell(t,e)?(t.readonly=!0,i.rowspan):1},t.prototype.getGroupSummaryData=function(t){var e=this.data.find(function(e){return e.__group_parent_id__===t&&e.__group_footer__});return e?e.data:null},t.decorators=[{type:e.Component,args:[{selector:"datagrid-rows",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:07\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-19 20:34:12\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\x3c!-- [class.f-datagrid-row-hover]="dg.rowHover && dgb.hoverRowIndex === hoverRow.rowIndex" \r\n        [class.f-datagrid-row-odd]="odd && dg.striped"\r\n        [class.f-datagrid-row-even]="!odd && dg.striped"\r\n--\x3e\r\n\r\n<table #tableEl style="border:0; width: 100%" class="f-datagrid-rows" cellpadding=0 cellspacing="0" row-hover row-dblclick>\r\n    <colgroup>\r\n        <col *ngFor="let col of columns" [width]="col.width + \'px\'" />\r\n    </colgroup>\r\n\r\n    <tbody *ngIf="dg.groupRows && dg.groupField" id="{{\'row-group-tbody_\'+ dg.id}}" >\r\n        <ng-container *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n            <tr *ngIf="row[isGroupRow]" class="f-datagrid-body-row f-datagrid-group-row" [style.display]="row[visible] ? \'\': \'none\'"  [group-row]="row">\r\n                \r\n                <td *ngIf="!fixedRight && !groupSummaryDataInGroupRow" class="f-datagrid-cell" [attr.colspan]="row[\'colspan\']" [style.paddingLeft.px]="row[groupLevelField] * 15">\r\n                    <span class="f-icon f-datagrid-group-expanded" *ngIf="!row.expanded" (click)="toggleGroupRow(row, i, true)"></span>\r\n                    <span class="f-icon f-datagrid-group-collapsed" *ngIf="row.expanded" (click)="toggleGroupRow(row, i, false)"></span>\r\n                    <span *ngIf="dg.groupFormatter" [innerHTML]="row | formatGroupRow: \'\': dg.groupFormatter| safe: \'html\' "></span>\r\n                    <span *ngIf="!dg.groupFormatter"> {{ row | formatGroupRow: getGroupColumn(row.field)  }} </span>\r\n                </td>\r\n\r\n                <ng-container *ngIf="groupSummaryDataInGroupRow && !fixedRight">\r\n\r\n                    <ng-container *ngFor="let col of columns; trackBy: trackByField; let ci = index;">\r\n                        <td *ngIf="!fixedRight && ci === 0" class="f-datagrid-cell" [style.paddingLeft.px]="row[groupLevelField] * 15" [attr.colspan]="dg.groupCellColSpan">\r\n                            <span class="f-icon f-datagrid-group-expanded" *ngIf="!row.expanded" (click)="toggleGroupRow(row, i, true)"></span>\r\n                            <span class="f-icon f-datagrid-group-collapsed" *ngIf="row.expanded" (click)="toggleGroupRow(row, i, false)"></span>\r\n                            <span *ngIf="dg.groupFormatter" [innerHTML]="row | formatGroupRow: \'\': dg.groupFormatter| safe: \'html\' "></span>\r\n                            <span *ngIf="!dg.groupFormatter"> {{ row | formatGroupRow: getGroupColumn(row.field)  }} </span>\r\n                        </td>\r\n                             \r\n                        <td class="f-datagrid-cell"  *ngIf="ci > 0 && ci >= dg.groupCellColSpan"\r\n                            [attr.field]="col.field" \r\n                            [attr.align]=" col.groupFooter?.align || col.align"\r\n                            [innerHTML]="col | formatCellData: getGroupSummaryData(row.id) : true: false | safe: \'html\'">\r\n                        </td>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n                <td *ngIf="fixedRight" class="f-datagrid-cell"></td>\r\n            </tr>\r\n\r\n            <ng-container *ngIf="!row[isGroupRow]">\r\n                <ng-container *ngIf="!row[isGroupFooter]">\r\n                    <tr class="f-datagrid-body-row"\r\n                        [attr.id]="row | rowDataId:fixedRight"\r\n                        [attr.index]="startRowIndex + i"\r\n                        [grid-row]="row"\r\n                        [editable]="dg.editable"\r\n                        [rowIndex]="startRowIndex + i" #dr="gridRow"\r\n                        [formGroup]="dr.form"\r\n                        [class.f-datagrid-row-selected]="row | rowIsSelected"\r\n                        [style.display]="row[visible] ? \'\': \'none\'"\r\n                        [class.f-datagrid-disable-row]="dr.disabled">\r\n                        <td class="f-datagrid-cell"\r\n                            [cell-editable]="row"\r\n                            [column]="col"\r\n                            [attr.field]="col.field" #cell\r\n                            [style.paddingLeft.px]="(ci === 0 && !fixedRight) ? row[groupLevelField] * 10 + 25 : 0"\r\n                            [attr.align]="col.align"\r\n                            *ngFor="let col of columns; trackBy: trackByField; let ci = index;">\r\n                            <grid-body-cell\r\n                                [width]="col.width"\r\n                                [height]="dg.rowHeight"\r\n                                [column]="col"\r\n                                [rowData]="row"\r\n                                [rowIndex]="startRowIndex + i">\r\n                            </grid-body-cell>\r\n                        </td>\r\n                    </tr>\r\n                </ng-container>\r\n\r\n                <ng-container *ngIf="row[isGroupFooter] && !groupSummaryDataInGroupRow">\r\n                    <tr class="f-datagrid-body-row f-datagrid-group-footer" \r\n                        *ngIf="!row[isGroupRow]"\r\n                        [attr.index]="startRowIndex + i"\r\n                        [group-footer-row-styler]="row"\r\n                        [style.display]="row[visible] ? \'\': \'none\'">\r\n                        <td class="f-datagrid-cell"\r\n                            [attr.field]="col.field" \r\n                            [attr.colspan]="col.groupFooter?.colspan || 1"\r\n                            [attr.align]=" col.groupFooter?.align || col.align"\r\n                            [style.display]="col.groupFooter?.visible === false ? \'none\': \'\'"\r\n                            [style.paddingLeft.px]="(ci === 0 && !fixedRight )? row[groupLevelField] * 10 + 25 : 0"\r\n                            footer-cell-styler [column]="col" [rowData]="row" [isGroupFooter]="true"\r\n                            *ngFor="let col of columns; trackBy: trackByField; let ci = index;"\r\n                            [innerHTML]="col | formatCellData: row.data : true: false | safe: \'html\'">\r\n                        </td>\r\n                    </tr>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n        </ng-container>\r\n\r\n    </tbody>\r\n    <tbody *ngIf="!dg.groupRows || !dg.groupField" id="{{ (fixedRight? \'right-tbody_\' : \'normal-rows-tbody_\')+ dg.id}}">\r\n\r\n        <ng-container *ngIf="!dg.mergeCell">\r\n            <tr class="f-datagrid-body-row"\r\n                [attr.id]="row | rowDataId: fixedRight"\r\n                [attr.index]="startRowIndex + i"\r\n                [grid-row]="row"\r\n                [editable]="dg.editable"\r\n                [rowIndex]="startRowIndex + i" #dr="gridRow"\r\n                [formGroup]="dr.form"\r\n                #tr\r\n                [class.f-datagrid-row-selected]="row | rowIsSelected"\r\n                [class.f-datagrid-disable-row]="dr.disabled"\r\n                *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n                    <td class="f-datagrid-cell"\r\n                        [attr.field]="col.field" \r\n                        [attr.align]="col.align"\r\n                        [style.vertical-align]="col.valign"\r\n                        [cell-editable]="row"\r\n                        [column]="col"  #editorcell="cellEditable"\r\n                        [class.cell-readonly]="editorcell.isReadonly()"\r\n                        [style.display]="dg.columnIsVisible(col) ? \'\': \'none\'"\r\n\r\n                        *ngFor="let col of columns;trackBy: dg.trackByRows; index as ci; last as islast;">\r\n                        <grid-body-cell\r\n                            [width]="col.width"\r\n                            [height]="dg.rowHeight"\r\n                            [lastColumn]="islast"\r\n                            [column]="col"\r\n                            [rowData]="row"\r\n                            [rowIndex]="startRowIndex + i">\r\n                        </grid-body-cell>\r\n                    </td>\r\n                </tr>\r\n            </ng-container>\r\n            <ng-container *ngIf="dg.mergeCell">\r\n                <tr class="f-datagrid-body-row"\r\n                    [attr.id]="row | rowDataId: fixedRight "\r\n                    [attr.index]="startRowIndex + i"\r\n                    [grid-row]="row"\r\n                    [editable]="dg.editable"\r\n                    [rowIndex]="startRowIndex + i"\r\n                    #dr="gridRow" [formGroup]="dr.form"\r\n                    [class.f-datagrid-row-selected]="row | rowIsSelected"\r\n                    [class.f-datagrid-disable-row]="dr.disabled"\r\n                    #tr\r\n                    *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n                        <td *ngFor="let column of columns; trackBy: trackByField; index as ci; last as islast;"\r\n                            [attr.field]="column.field"\r\n                            class="f-datagrid-cell" \r\n                            [attr.align]="column.align"\r\n                            [style.display]=" showCell(column, startRowIndex + i) ? \'\': \'none\' "\r\n                            [style.vertical-align]="column.valign"\r\n                            [attr.rowspan]=" getRowSpan(column, startRowIndex + i)"\r\n                            [cell-editable]="row"\r\n                            [column]="column" #td \r\n                            [class.f-datagrid-td-merged]="td.rowSpan > 1">\r\n                            <grid-body-cell \r\n                                [width]="column.width"\r\n                                [height]="dg.rowHeight" \r\n                                [lastColumn]="islast"\r\n                                [column]="column"\r\n                                [rowData]="row"\r\n                                [rowIndex]="startRowIndex + i">\r\n                            </grid-body-cell>\r\n                        </td>\r\n                </tr>\r\n            </ng-container>\r\n    </tbody>\r\n\r\n</table>'}]}],t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]},{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]},{type:e.ElementRef},{type:e.Injector},{type:e.NgZone}]},t.propDecorators={startRowIndex:[{type:e.Input}],data:[{type:e.Input}],columns:[{type:e.Input}],tableEl:[{type:e.ViewChild,args:["tableEl"]}],fixedRight:[{type:e.Input}]},t}(),Pt=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"grid-editor-textbox",template:""}]}],t}(),Tt=function(){function t(t,i,n,r){var o=this;this.render2=t,this.injector=i,this.dg=n,this.ngZone=r,this.height=35,this.columns=[],this.enableDragColumn=!1,this.wrapHeader=!1,this.enableFilterRow=!1,this.scrollbarMode="auto",this.ro=null,this.rightFixedColumnWidth=0,this.normalColumnWidth=0,this.showOverlay=!1,this.disableSort=!1,this.scrollX=0,this.showShadowCls=!1,this.top=0,this.dfs=this.injector.get(K),this.dgs=this.injector.get(Z),this.cfr=this.injector.get(e.ComponentFactoryResolver),this.cd=this.injector.get(e.ChangeDetectorRef),this.el=this.injector.get(e.ElementRef),this.dfrs=this.dg.clientFilterService,this.dgs.scorll$.subscribe(function(t){t.type!==T&&t.type!==H&&t.type!==L||(o.scrollX=t.x,o.render2.setStyle(o.headerColumnsTable.nativeElement,"transform","translate3d(-"+t.x+"px, 0px, 0px)"),o.dg.groupRows||o.fixedLeft&&(t.x?o.render2.addClass(o.fixedLeft.nativeElement,j):o.render2.removeClass(o.fixedLeft.nativeElement,j))),t.type===L&&o.fixedLeft&&o.render2.removeClass(o.fixedLeft.nativeElement,j)}),this.dgs.showFixedShadow.subscribe(function(t){o.fixedRight&&o.setFixedColumnPosition(t.showRightShadow,t.x)}),this.dgs.disableHeader.subscribe(function(t){o.showOverlay=t,o.disableSort=t,o.cd.detectChanges()})}return Object.defineProperty(t.prototype,"chkAll",{set:function(t){this._chkall=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fr",{set:function(t){t&&(this.fixedRight=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowSpan",{get:function(){return this.columns.length+(this.dg.enableFilterRow?1:0)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.dgs.checkedRowsTotalChanged$.subscribe(function(){if(t._chkall){var e=t.dfs.getCurrentPageCheckeds().length,i=t.dfs.isCheckAll(),n=i||!e;t._chkall.chk.nativeElement.indeterminate=!n;var r=i&&e>0;t._chkall.updateStatus(r)}}),this.dgs.uncheckAll.subscribe(function(){t.dg.showAllCheckbox&&t._chkall&&(t._chkall.chk.nativeElement.indeterminate=!1,t._chkall.chk.nativeElement.checked=!1)}),this.dgs.checkAll.subscribe(function(){t._chkall&&(t._chkall.chk.nativeElement.checked=!0)}),this.dgs.scrollbarUpdate.subscribe(function(e){t.ps=e.scrollbarRef,t.rightFixedColumnWidth=t.getRightFixedColWidth(t.ps),t.fixedRight&&t.setFixedColumnPosition(t.showShadowCls,0),t.cd.detectChanges()}),this.dgs.showGridHeader.subscribe(function(){t.setHeaderPosition()}),this.dgs.smartFilterBarExpand.subscribe(function(){t.setHeaderPosition()}),this.rightFixedColumnWidth=this.getRightFixedColWidth(this.ps)},t.prototype.ngAfterViewInit=function(){var t=this;setTimeout(function(){t.setHeaderPosition()})},t.prototype.ngOnChanges=function(t){t.columnsGroup&&!t.columnsGroup.isFirstChange()&&(this.rightFixedColumnWidth=this.getRightFixedColWidth(this.ps),this.cd.detectChanges())},t.prototype.getRightFixedColWidth=function(t){if(void 0===t&&(t=null),!this.columnsGroup)return 0;var e=this.columnsGroup.rightFixedWidth;return t||(t=this.dg.scrollInstance.instance),t&&t.scrollbarYActive&&"allways"===this.scrollbarMode?e+(this.showShadowCls?18:0):e},t.prototype.setHeaderPosition=function(){var t=0;(this.dg.enableFilterRow||this.dg.enableSmartFilter)&&this.dg.showFilterBar&&(t+=this.dg.filterBarHeight),this.dg.showRowGroupPanel&&(t+=this.dg.rowGroupPanelHeight),this.top=t,this.render2.setStyle(this.el.nativeElement,"top",t+"px")},t.prototype.isShowShadow=function(t){return this.dg.dgContainer.nativeElement.offsetWidth<this.dg.colGroup.totalWidth},t.prototype.isColspan=function(t,e,i,n){return void 0===n&&(n=!1),t||e?t?n?!i.colspan&&i.fixed&&"left"===i.fixed:i.colspan&&i.fixed&&"left"===i.fixed:e?n?!i.colspan&&i.fixed&&"right"===i.fixed:i.colspan&&i.fixed&&"right"===i.fixed:void 0:n?!(i.colspan||i.fixed&&"none"!==i.fixed):i.colspan&&(!i.fixed||"none"===i.fixed)},t.prototype.setFixedColumnPosition=function(t,e){this.showShadowCls=t;var i=t?"addClass":"removeClass";this.render2[i](this.fixedRight.nativeElement,"f-datagrid-fixed-right-shadow");var n=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth+this.rightFixedColumnWidth,r=this.dg.width,o=this.dg.width-(this.dg.showBorder?2:0)-this.rightFixedColumnWidth;r>n&&(o=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth),this.render2.setStyle(this.fixedRight.nativeElement,"left",o+"px")},t.prototype.onRowNumerColumnDblClick=function(t,e){var i=this.dg.getRows().length;if(this.dg.pagination){var n=this.dg.pageSize;i=n*this.dg.pageIndex+n}this.dg.longTextArea.nativeElement.innerHTML=i;var r=this.dg.longTextArea.nativeElement.offsetWidth;r>e.offsetWidth&&(this.dg.lineNumberWidth=r+10,this.dfs.updateProperty("lineNumberWidth",this.dg.lineNumberWidth),this.dfs.resizeColumns())},t.prototype.onSortColumnClick=function(t,e){var i=this;if(!this.disableSort&&e.sortable){this.dg.cancelEdit(null);var n=this.dg.sortName,r=this.dg.sortOrder,o=[],s=[];n&&(o=n.split(","),s=r.split(","));var l=e.order||"asc",a=l,c=o.findIndex(function(t){return t===e.field});if(c>=0){var d="asc"===s[c]?"desc":"asc";"asc"===(a=d)?(a=undefined,o.splice(c,1),s.splice(c,1)):s[c]=d}else this.dg.multiSort?(o.push(e.field),s.push(l)):(o=[e.field],s=[l]);e.order=a,this.dg.sortName=o.join(","),this.dg.sortOrder=s.join(","),this.dfs.setSortInfo(this.dg.sortName,this.dg.sortOrder),this.dg.beforeSortColumn(this.dg.sortName,this.dg.sortOrder,this.dg).subscribe(function(){i.dg.onColumnSorted()})}},t.decorators=[{type:e.Component,args:[{selector:"datagrid-header",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:53\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-05 08:53:26\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n \x3c!-- [style.maxWidth.px]="col.width - 44"   =>  style="width: 100%"    --\x3e\r\n<ng-template #filterAndSort let-col>\r\n    <ng-container *ngIf="col.filter">\r\n        <span style="width: 100%" class="f-datagrid-header-cell-title">\r\n            <span class="text-danger" *ngIf=" col.validators | showStar ">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <ng-container *ngIf="col.sortable">\r\n            <span class="f-datagrid-sort" [class.f-datagrid-filter-sort-asc]="col.order === \'asc\'"\r\n                [class.f-datagrid-filter-sort-desc]="col.order === \'desc\'"\r\n                [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'" *ngIf="col.order"\r\n                datagrid-smart-filter  [disabled]="disableSort" [column]="col"> </span>\r\n            <span class="f-datagrid-sort f-datagrid-filter-sort" [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n                datagrid-smart-filter [disabled]="disableSort" [column]="col" *ngIf="!col.order"></span>\r\n        </ng-container>\r\n        <ng-container *ngIf="!col.sortable">\r\n            <span class="f-datagrid-sort f-datagrid-filter" datagrid-smart-filter  [disabled]="disableSort"  [column]="col"></span>\r\n        </ng-container>\r\n    </ng-container>\r\n    <ng-container *ngIf="!col.filter" [ngTemplateOutlet]="column_title" [ngTemplateOutletContext]="{$implicit: col}">\r\n    </ng-container>\r\n\r\n</ng-template>\r\n\r\n\r\n<ng-template #column_title let-col>\r\n    <ng-container *ngIf="!col.sortable">\r\n        <span [style.width.px]="col.width - 20" class="f-datagrid-header-cell-title" *ngIf="col.field !== dg.ControlPanelFeild">\r\n            <span class="text-danger" *ngIf=" col.validators | showStar ">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <span *ngIf="col.field === dg.ControlPanelFeild" class="f-datagrid-header-cell-title"\r\n            style="position: absolute; left: 3px; top: 0; cursor: pointer;"\r\n            (click)="dg.showControlPanel($event)">\r\n            <span class="f-icon f-icon-home-setup"></span>\r\n        </span>\r\n    </ng-container>\r\n    <ng-container *ngIf="col.sortable">\r\n        <span style="width: 100%"  class="f-datagrid-header-cell-title">\r\n            <span class="text-danger" *ngIf=" col.validators | showStar ">*</span>\r\n            {{ col.title }}\r\n        </span>\r\n        <span class="f-datagrid-sort" [class.f-datagrid-sort-asc]="col.order === \'asc\'"\r\n            [class.f-datagrid-sort-desc]="col.order === \'desc\'"\r\n            [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n            (click)="onSortColumnClick($event, col)" *ngIf="col.order"> </span>\r\n        <span class="f-datagrid-sort" [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n            (click)="onSortColumnClick($event, col)" *ngIf="!col.order"></span>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n\r\n\r\n<ng-template #column_template let-col let-left="left" let-right="right">\r\n    <ng-container *ngIf="isColspan(left, right, col, false) ">\r\n        <td [resize-column]="col" class="f-datagrid-header-cell f-datagrid-header-cell-group" [attr.align]="col.halign"\r\n            [attr.colspan]="col.colspan" [attr.title]="col.title">\r\n            <div class="f-datagrid-header-cell-content" [header-style]="col">\r\n                {{ col.title }}\r\n            </div>\r\n        </td>\r\n    </ng-container>\r\n    <ng-container *ngIf="isColspan(left, right, col, true)">\r\n        <td [resize-column]="col" class="f-datagrid-header-cell" [attr.align]="col.halign" [attr.field]="col.field"\r\n            [attr.rowspan]="col.rowspan" [attr.title]="col.title"\r\n            *ngIf="dg.columnIsVisible(col)"\r\n            [style.display]="dg.columnIsVisible(col) ? \'\': \'none\'"\r\n            [class.f-datagrid-header-cell-sort]="col.sortable"\r\n            [class.smooth-dnd-draggable-wrapper]="enableDragColumn && col.field !== dg.ControlPanelFeild ">\r\n            <div class="f-datagrid-header-cell-content" [header-style]="col" [style.width.px]="col.width">\r\n                <span class="drag-column-bar f-icon f-icon-more-vertical" *ngIf="col.field !== dg.ControlPanelFeild && enableDragColumn && !dg.editable"></span>\r\n                <ng-container *ngIf="col.headerTemplate" [ngTemplateOutlet]="col.headerTemplate" [ngTemplateOutletContext]="{$implicit: col}">\r\n                </ng-container>\r\n                <ng-container *ngIf="!col.headerTemplate" [ngTemplateOutlet]=" !dg.enableSmartFilter ? column_title : filterAndSort " \r\n                [ngTemplateOutletContext]="{$implicit: col}">\r\n                </ng-container>\r\n            </div>\r\n        </td>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #header_template_inner let-columns let-left="left" let-right="right" let-groupCols="groupCols">\r\n    <table cellpadding="0" cellspacing="0" border="0" style="height: 100%">\r\n        <colgroup>\r\n            <col width="36px" *ngIf="dg.showCheckbox && left">\r\n            <col [width]="dg?.lineNumberWidth + \'px\'" *ngIf="dg.showLineNumber && left">\r\n            <ng-container *ngFor="let col of groupCols">\r\n                <col [width]="col.width + \'px\'" *ngIf="col.width && col.field">\r\n            </ng-container>\r\n        </colgroup>\r\n        <thead [class.header-wrap]="wrapHeader">\r\n            <tr class="f-datagrid-header-row" *ngFor="let cols of columns; index as colsIdx; first as isFirst"\r\n                [drag-column]="enableDragColumn" [groupName]="left?\'left\': right ? \'right\': \'center\'">\r\n                \x3c!-- 复选框 --\x3e\r\n                <td *ngIf="dg.showCheckbox && isFirst && left" #chktd\r\n                    class="f-datagrid-header-cell f-datagrid-header-checkbox" \r\n                    [attr.rowspan]="rowSpan" [style.height.px]="height">\r\n                    <div class="f-datagrid-header-cell-content" style="width: 36px; text-align: center;overflow:hidden; " [style.maxHeight.px]="height">\r\n                        <datagrid-header-checkbox #chkAll *ngIf="dg.showAllCheckbox && dg.multiSelect" ></datagrid-header-checkbox>\r\n                    </div>\r\n                </td>\r\n                \x3c!-- 行号 --\x3e\r\n                <td *ngIf="dg.showLineNumber && isFirst && left" #rntd\r\n                    class="f-datagrid-header-cell f-datagrid-cell-rownumber" [attr.rowspan]="rowSpan"\r\n                    [style.height.px]="height"\r\n                    (dblclick)="onRowNumerColumnDblClick($event, rntd)">\r\n                    <div class="f-datagrid-header-cell-content" style="padding: 0px;"  [style.width.px]="dg?.lineNumberWidth">\r\n                        {{ \'datagrid.lineNumberTitle\' | locale: dg.lineNumberTitle }}\r\n                    </div>\r\n                </td>\r\n                <ng-container *ngFor="let col of cols; last as isLast">\r\n                    <ng-container\r\n                        *ngTemplateOutlet="column_template; context: {$implicit: col, left: left, right: right}">\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngIf="enableFilterRow" [style.height.px]="dg.filterRowHeight" class="f-datagrid-header-row f-datagrid-filter-row">\r\n                <ng-container filter-row-creator [left]="left" [right]="right"></ng-container>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</ng-template>\r\n\r\n<div class="f-datagrid-header" style="width: 100%;" [style.min-height.px]="height" #header>\r\n    \x3c!--左侧固定列--\x3e\r\n    <div #fixedLeft class="f-datagrid-header-fixed-left"\r\n        *ngIf="columnsGroup?.leftFixed && columnsGroup?.leftFixed.length  || dg?.showLineNumber || dg?.showCheckbox "\r\n        [style.width.px]="columnsGroup?.leftFixedWidth"\r\n        [style.height.px]="height">\r\n        <ng-container *ngTemplateOutlet="header_template_inner; context: { $implicit: columns, left: true, right: false,\r\n            groupCols:  columnsGroup?.leftFixed}">\r\n        </ng-container>\r\n    </div>\r\n\r\n    \x3c!--正常列--\x3e\r\n    <div #headerContainer class="f-datagrid-header-center" \r\n        [style.left.px]="columnsGroup?.leftFixedWidth"\r\n        [style.width.px]="columnsGroup?.normalWidth"\r\n        style="position: absolute;height: 100%">\r\n        <ng-container *ngTemplateOutlet="header_template_inner; context: {$implicit: columns, left: false, right: false,\r\n            groupCols:  columnsGroup?.normalColumns}">\r\n        </ng-container>\r\n    </div>\r\n    \x3c!--右侧固定列--\x3e\r\n    <div #fixedRight class="f-datagrid-header-fixed-right"\r\n        *ngIf="columnsGroup?.rightFixed && columnsGroup?.rightFixed.length"\r\n        [style.width.px]=" dg.showBorder?  rightFixedColumnWidth : rightFixedColumnWidth + 1"\r\n        [style.height.px]="height" style="border: 0;">\r\n        <ng-container *ngTemplateOutlet="header_template_inner; context: {$implicit: columns, left: false, right: true,\r\n            groupCols: columnsGroup?.rightFixed}">\r\n        </ng-container>\r\n    </div>\r\n    <div class="filter-row-disabled"\r\n        style="position: absolute;background: rgb(255, 255, 255);width: 100%;z-index: 9;height: 40px; bottom:0;opacity: 0;"\r\n        [style.left.px]="dg.showAllCheckbox ? 36 : 0" *ngIf="showOverlay && dg.enableFilterRow">\r\n    </div>\r\n</div>',encapsulation:e.ViewEncapsulation.None,exportAs:"dgHeader"}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.Injector},{type:bt,decorators:[{type:e.Optional}]},{type:e.NgZone}]},t.propDecorators={height:[{type:e.Input}],columns:[{type:e.Input}],columnsGroup:[{type:e.Input}],enableDragColumn:[{type:e.Input}],wrapHeader:[{type:e.Input}],enableFilterRow:[{type:e.Input}],scrollbarMode:[{type:e.Input}],header:[{type:e.ViewChild,args:["header"]}],headerColumnsTable:[{type:e.ViewChild,args:["headerContainer"]}],fixedLeft:[{type:e.ViewChild,args:["fixedLeft"]}],chkAll:[{type:e.ViewChild,args:["chkAll"]}],fr:[{type:e.ViewChild,args:["fixedRight"]}]},t}(),Ht=function(){function t(t,i,n,r){var o=this;this.vc=t,this.injector=i,this.dg=n,this.ngZone=r,this.dfs=this.injector.get(K),this.dgs=this.injector.get(Z),this.cfr=this.injector.get(e.ComponentFactoryResolver),this.cd=this.injector.get(e.ChangeDetectorRef),this.dfrs=this.dg.clientFilterService,this.filterRowType=this.injector.get(D,null),this.dgs.clearFilter.subscribe(function(){o.filterRowRef&&o.filterRowRef.instance.clearFilterValue(!1)}),this.dgs.columnsChanged.subscribe(function(){o.createFilterRow(!0)}),this.dfrs&&this.dfrs.removeField.subscribe(function(t){if(o.filterRowRef&&t){!!(o.left?o.dg.colGroup.leftFixed||[]:o.right?o.dg.colGroup.rightFixed||[]:o.dg.colGroup.normalColumns||[]).find(function(e){return e.field===t})&&o.filterRowRef.instance.removeField(t)}})}return t.prototype.ngOnInit=function(){this.createFilterRow(!0)},t.prototype.ngOnChanges=function(t){},t.prototype.createFilterRow=function(t){var e=this;void 0===t&&(t=!1),t&&this.filterRowRef&&(this.filterRowRef.destroy(),this.filterRowRef=null),setTimeout(function(){e._createFilterRow(),t&&e.cd.detectChanges()})},t.prototype._createFilterRow=function(){var t=this;if(this.dg.enableFilterRow){if(!this.filterRowType)return;var e=this.dg.colGroup.normalColumns;if(this.left?e=this.dg.colGroup.leftFixed:this.right&&(e=this.dg.colGroup.rightFixed),!this.filterRowRef&&this.vc){var i=this.cfr.resolveComponentFactory(this.filterRowType);this.filterRowRef=this.vc.createComponent(i),this.filterRowRef.instance.columns=e,this.filterRowRef.instance.gridInstance=this.dg,this.filterRowRef.instance.conditionChange.subscribe(function(e){var i=e||{};t.dgs.onFilterChanged.emit(i)})}}},t.decorators=[{type:e.Directive,args:[{selector:"[filter-row-creator]"}]}],t.ctorParameters=function(){return[{type:e.ViewContainerRef},{type:e.Injector},{type:bt},{type:e.NgZone}]},t.propDecorators={left:[{type:e.Input}],right:[{type:e.Input}]},t}(),Lt=function(){function t(t,e,i,n){this.dh=t,this.ngzone=e,this.el=i,this.render=n,this.dg=this.dh.dg}return t.prototype.ngAfterViewInit=function(){var t=this;this.isEnable()&&(this.render.addClass(this.el.nativeElement,"f-datagrid-header-cell-resize"),this.resizer=document.createElement("span"),this.resizer.className="column-resize-bar",this.el.nativeElement.appendChild(this.resizer),this.ngzone.runOutsideAngular(function(){var e=n.fromEvent(t.resizer,"mouseup");t.resizerMouseDownListener=n.fromEvent(t.resizer,"mousedown").pipe(r.takeUntil(e)).subscribe(function(e){return t.onMouseDown(e)})}))},t.prototype.onDblClickHandler=function(){if(this.col.field&&this.col.field!==this.dg.ControlPanelFeild){var t=this.el;this.dg.sizeToContent(this.col,t)}return!1},t.prototype.isEnable=function(){return!!this.dg.resizeColumn&&(this.col.field===this.dg.ControlPanelFeild&&(this.col.resizable=!1),this.col.resizable===undefined&&(this.col.resizable=!0),this.col.resizable)},t.prototype.bindDocumentEvents=function(){var t=this;this.ngzone.runOutsideAngular(function(){t.documentMouseMoveListener=t.onMouseMove.bind(t),document.addEventListener("mousemove",t.documentMouseMoveListener),t.documentMouseUpListener=t.onMouseUp.bind(t),document.addEventListener("mouseup",t.documentMouseUpListener)})},t.prototype.unbindDocumentEvents=function(){this.documentMouseMoveListener&&(document.removeEventListener("mousemove",this.documentMouseMoveListener),this.documentMouseMoveListener=null),this.documentMouseUpListener&&(document.removeEventListener("mouseup",this.documentMouseUpListener),this.documentMouseUpListener=null)},t.prototype.onMouseDown=function(t){t.stopPropagation(),this.dg.onColumnResizeBegin(t),this.render.addClass(this.el.nativeElement,"column-resizeing"),this.bindDocumentEvents()},t.prototype.onMouseMove=function(t){this.dg.onColumnResize(t)},t.prototype.onMouseUp=function(t){this.dg.onColumnResizeEnd(t,this.col),this.render.removeClass(this.el.nativeElement,"column-resizeing"),this.unbindDocumentEvents()},t.prototype.ngOnDestroy=function(){this.resizerMouseDownListener&&this.resizerMouseDownListener.unsubscribe(),this.unbindDocumentEvents(),this.dblclickListener&&this.dblclickListener()},t.decorators=[{type:e.Directive,args:[{selector:"[resize-column]"}]}],t.ctorParameters=function(){return[{type:Tt,decorators:[{type:e.Optional}]},{type:e.NgZone},{type:e.ElementRef},{type:e.Renderer2}]},t.propDecorators={col:[{type:e.Input,args:["resize-column"]}],onDblClickHandler:[{type:e.HostListener,args:["dblclick"]}]},t}(),jt=function(){function t(t,i,n){var r=this;this.render=t,this.injector=i,this.dg=n,this._footerData=[],this.position="bottom",this.scrollX=0,this.showShadowCls=!1,this.rightFixedColumnWidth=0,this.cdRef=null,this.dg=this.injector.get(bt),this.dgs=this.injector.get(Z),this.cdRef=this.injector.get(e.ChangeDetectorRef),this.scrollXSubscription=this.dgs.scorll$.subscribe(function(t){r.scrollX=t.x,t.type===T&&(r.dg.footerTemplate||(r.render.setStyle(r.footerBody.nativeElement,"transform","translate3d(-"+t.x+"px, 0px, 0px)"),r.fixedLeft&&(t.x?r.render.addClass(r.fixedLeft.nativeElement,j):r.render.removeClass(r.fixedLeft.nativeElement,j)))),t.type===L&&r.fixedLeft&&r.render.removeClass(r.fixedLeft.nativeElement,j)}),this.dgs.showFixedShadow.subscribe(function(t){r.fixedRight&&r.setFixedColumnPosition(t.showRightShadow,t.x)}),this.dgs.showGridHeader.subscribe(function(t){r.setFooterPosition(!1)}),this.dgs.scrollbarUpdate.subscribe(function(t){r.rightFixedColumnWidth=r.getRightFixedColWidth(t.scrollbarRef),r.fixedRight&&r.setFixedColumnPosition(r.showShadowCls,0),r.cdRef&&r.cdRef.detectChanges()})}return Object.defineProperty(t.prototype,"data",{get:function(){return this._footerData},set:function(t){this._footerData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fr",{set:function(t){t&&(this.fixedRight=t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.renderFooterStyle(),this.setFooterPosition(!1),this.rightFixedColumnWidth=this.getRightFixedColWidth()},t.prototype.ngOnChanges=function(t){t.position&&this.setFooterPosition(!0),t.columnsGroup&&!t.columnsGroup.isFirstChange()&&(this.rightFixedColumnWidth=this.getRightFixedColWidth())},t.prototype.ngOnDestroy=function(){this.scrollXSubscription&&(this.scrollXSubscription.unsubscribe(),this.scrollXSubscription=null)},t.prototype.getRightFixedColWidth=function(t){if(void 0===t&&(t=null),!this.columnsGroup)return 0;var e=this.columnsGroup.rightFixedWidth;return t||(t=this.dg.scrollInstance.instance),t&&t.scrollbarYActive&&"allways"===this.dg.scrollBarShowMode?e+18:e},t.prototype.setFooterPosition=function(t){if(void 0===t&&(t=!0),"bottom"===this.position){var e=0;this.dg.pagination&&(e=this.dg.pagerHeight||40),this.render.removeStyle(this.footerContainer.nativeElement,"top"),this.render.setStyle(this.footerContainer.nativeElement,"bottom",e+"px")}if("top"===this.position){var i=0;this.dg.showHeader&&(i=this.dg.realHeaderHeight||35),this.dg.showRowGroupPanel&&(i+=this.dg.rowGroupPanelHeight),this.dg.showFilterBar&&(i+=this.dg.filterBarHeight),this.render.removeStyle(this.footerContainer.nativeElement,"bottom"),this.render.setStyle(this.footerContainer.nativeElement,"top",i+"px")}t&&this.dgs.footerPositionChanged.emit()},t.prototype.renderFooterStyle=function(){if(this.dg.footerStyler){var t=this.dgs.getCustomStyle(this.dg.footerStyler,null),e=this.dg.customStyleKey()+" .f-datagrid-footer",i=this.dg.customStyleKey()+" .f-datagrid-footer .f-datagrid-body-fixed-left,"+this.dg.customStyleKey()+" .f-datagrid-footer .f-datagrid-body-fixed-right";if(t&&Object.keys(t).length){var n=[];t.style&&(n.push(e+" "+JSON.stringify(t.style)),n.push(i+" "+JSON.stringify(t.style))),this.dgs.appendCssRules(n)}else this.dgs.removeCssRule([e,i])}},t.prototype.setFixedColumnPosition=function(t,e){this.showShadowCls=t;var i=t?"addClass":"removeClass";this.render[i](this.fixedRight.nativeElement,"f-datagrid-fixed-right-shadow");var n=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth+this.rightFixedColumnWidth,r=this.dg.width,o=this.dg.width-(this.dg.showBorder?2:0)-this.rightFixedColumnWidth;r>n&&(o=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth),this.render.setStyle(this.fixedRight.nativeElement,"left",o+"px")},t.decorators=[{type:e.Component,args:[{selector:"datagrid-footer",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-12 15:02:10\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-10-31 14:50:47\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n<ng-template #footer_content_template let-columns let-left="fixedLeft" let-right="fixedRight">\r\n    <table cellpadding="0" cellspacing="0" border="0" style="border:0; width: 100%" class="f-datagrid-rows">\r\n        <colgroup>\r\n            <col width="36px" *ngIf="dg.showCheckbox && left"/>\r\n            <col [width]="dg.lineNumberWidth + \'px\'" *ngIf="dg.showLineNumber && left"/>\r\n            <col *ngFor="let col of columns" [width]="col.width + \'px\'"/>\r\n        </colgroup>\r\n        <tbody>\r\n            <tr #tr class="f-datagrid-body-row f-datagrid-footer-row"\r\n                [attr.id]="\'footer-\'+ (row| rowDataId: right: left)"\r\n                *ngFor="let row of data;let rowIndex = index;trackBy: dg.trackByRows" \r\n                [attr.index]="rowIndex">\r\n\r\n                <td *ngIf="dg.showCheckbox && left" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center"></td>\r\n                <td *ngIf="dg.showLineNumber  && left" class="f-datagrid-cell f-datagrid-cell-rownumber" ></td>\r\n\r\n                <td class="f-datagrid-cell {{ \'footer-td-\'+ col.field }}"\r\n                    [style.width.px]="col.width"\r\n                    [attr.colspan]="col.footer?.colspan || 1"\r\n                    [style.display]="col.footer?.visible === false ? \'none\': \'\'"\r\n                    [attr.field]="col.field" [attr.align]="col.footer?.align || col.align"\r\n                    *ngFor="let col of columns; let ci = index;"\r\n                    footer-cell-styler [column]="col" [rowData]="row" [rowIndex]="rowIndex">\r\n                    <div class="f-datagrid-cell-content" style="width: 100%">\r\n                        <span *ngIf="col.footer && col.footer.formatter" [innerHtml]="col | formatCellData: row : false: true | safe: \'html\'"></span>\r\n                        <span *ngIf="!col.footer || !col.footer.formatter">{{ col | formatCellData: row : false: true }}</span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</ng-template>\r\n\r\n<div #footerContainer class="f-datagrid-footer"\r\n    [class.f-datagrid-toolbar-top]="position === \'top\'"  \r\n    [class.f-datagrid-toolbar-bottom]="position === \'bottom\'"\r\n    [style.height.px]="height"\r\n    >\r\n    <ng-container *ngIf="!dg.footerTemplate">\r\n        \r\n        <div #fixedLeft class="f-datagrid-body-fixed-left" \r\n            [style.width.px]="columnsGroup?.leftFixedWidth" [style.height.px]="height" \r\n            *ngIf="columnsGroup?.leftFixed && columnsGroup?.leftFixed.length  || dg?.showLineNumber || dg?.showCheckbox ">\r\n\r\n            <ng-container *ngTemplateOutlet="footer_content_template; context: {$implicit: columnsGroup?.leftFixed, fixedLeft: true}"></ng-container>\r\n            \r\n        </div>\r\n\r\n        <div #fixedRight class="f-datagrid-body-fixed-right" style="position: absolute;border: 0;"\r\n            [style.width.px]="rightFixedColumnWidth" [style.height.px]="height"\r\n            *ngIf="columnsGroup?.rightFixed && columnsGroup?.rightFixed.length">\r\n\r\n            <ng-container *ngTemplateOutlet="footer_content_template; context: {$implicit: columnsGroup?.rightFixed, fixedRight: true}"></ng-container>\r\n            \r\n        </div>\r\n\r\n        <div #footerBody class="f-datagrid-footer-rows" style="position: absolute;"\r\n            [style.left.px]="columnsGroup?.leftFixedWidth" [style.width.px]="columnsGroup?.normalWidth" >\r\n            <ng-container *ngTemplateOutlet="footer_content_template; context: {$implicit: columnsGroup?.normalColumns}"></ng-container>\r\n        </div>\r\n\r\n    </ng-container>\r\n\r\n\r\n    <ng-container *ngIf="dg.footerTemplate" [ngTemplateOutlet]="dg.footerTemplate" [ngTemplateOutletContext]="{footerData: data }" ></ng-container>\r\n    \r\n</div>'}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.Injector},{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]}]},t.propDecorators={data:[{type:e.Input}],height:[{type:e.Input}],width:[{type:e.Input}],columns:[{type:e.Input}],columnsGroup:[{type:e.Input}],position:[{type:e.Input}],footerContainer:[{type:e.ViewChild,args:["footerContainer"]}],footerBody:[{type:e.ViewChild,args:["footerBody"]}],fixedLeft:[{type:e.ViewChild,args:["fixedLeft"]}],fr:[{type:e.ViewChild,args:["fixedRight"]}]},t}(),At=function(){function t(t,i,n){this.el=t,this.cd=i,this.inject=n,this.id="farris-datagrid-pager",this.maxSize=7,this.directionLinks=!0,this.autoHide=!1,this.responsive=!1,this.previousLabel="上页",this.nextLabel="下页",this.showPageList=!1,this.showPageInfo=!0,this.showPageNumber=!0,this.locked=!1,this.selectedData=[],this.viewMode="default",this.showSelectedList=!1,this.showGotoInput=!1,this.pageChange=new e.EventEmitter,this.pageSizeChange=new e.EventEmitter,this.removeSelectedItem=new e.EventEmitter,this.clearSelectedItem=new e.EventEmitter,this.styles={opacity:1},this.mouseInSelectedList=!1,this.openSelectedList=!1,this.selectionDataChange$=null,this.inject&&(this.notifySer=this.inject.get(y.NotifyService,null))}return Object.defineProperty(t.prototype,"pagination",{get:function(){return this.pager.paginationDirective},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSize",{get:function(){return this.pagination.getPageSize()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"total",{get:function(){return this.pagination.getTotalItems()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outerHeight",{get:function(){return this.pc?this.pc.nativeElement.offsetHeight:40},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.listenCheckDataChanged()},t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(t){t.selectedData&&!t.selectedData.isFirstChange()&&(this.selectedData&&this.selectedData.length||this.closeSelectedList()),t.showSelectedList&&!t.showSelectedList.isFirstChange()&&this.listenCheckDataChanged()},t.prototype.listenCheckDataChanged=function(){var t=this;if(this.showSelectedList){var e=this.inject.get(bt,null);e&&(this.selectionDataChange$=e.checkedChange.subscribe(function(e){t.selectedData=e,t.cd.detectChanges()}))}else this.selectionDataChange$&&(this.selectionDataChange$.unsubscribe(),this.selectionDataChange$=null)},t.prototype.onPageChange=function(t){"object"==typeof t&&(t=t.pageIndex||1),this.pageChange.emit(Number.parseInt(t,10))},t.prototype.onPageSizeChange=function(t){this.pageSizeChange.emit(Number.parseInt(t,10))},t.prototype.lock=function(){this.locked=!0,this.styles={opacity:.5},this.cd.detectChanges()},t.prototype.unlock=function(){this.locked=!1,this.styles={opacity:1},this.cd.detectChanges()},t.prototype.onMouseEnter=function(t){t.stopPropagation(),this.locked||(this.mouseInSelectedList=!0,this.selectedData&&this.selectedData.length?this.openSelectedList=!this.openSelectedList:this.openSelectedList=!1)},t.prototype.closeSelectedList=function(){this.openSelectedList=!1,this.mouseInSelectedList=!1,this.cd.destroyed||this.cd.detectChanges()},t.prototype.onDelSelectedItem=function(t){this.removeSelectedItem.emit(t)},t.prototype.onClearSelected=function(t){this.clearSelectedItem.emit(),this.closeSelectedList()},t.prototype.onSelectListPanelClose=function(t){this.closeSelectedList()},t.decorators=[{type:e.Component,args:[{selector:"datagrid-pager",template:'<div class="f-datagrid-pager" #pagerContainer [ngStyle]="styles">\r\n    <pagination-controls #pager [id]="id" [maxSize]="maxSize"\r\n        [directionLinks]="directionLinks" [showPageList]="showPageList"\r\n        [showPageInfo]="showPageInfo"\r\n        [showPageNumber]="showPageNumber"\r\n        [autoHide]="autoHide" [responsive]="responsive"\r\n        [previousLabel]="previousLabel" [nextLabel]="nextLabel"\r\n        [showGotoInput]="showGotoInput"\r\n        (pageChange)="onPageChange($event)"\r\n        (pageSizeChange)="onPageSizeChange($event)"\r\n        [viewMode]="viewMode" [showSelectedList]="showSelectedList">\r\n        <div class="flex-fill" >\r\n            <div>\r\n                <span class="badge badge-pill badge-light" *ngIf="showSelectedList"\r\n                    style="cursor:pointer" [attr.title]="\'datagrid.selectionData.tooltip\' | locale"\r\n                    [class.badge-primary]="mouseInSelectedList"\r\n                    [innerHTML]="\'datagrid.selectionData.currentLenth\' | locale | replaceX: selectedData.length"\r\n                    (click)="onMouseEnter($event)">\r\n                </span>\r\n                <pager-selected-list *ngIf="openSelectedList"\r\n                    [data]="selectedData | selectedItem: listItemFormatter"\r\n                    (close)="onSelectListPanelClose($event)"\r\n                    (remove)="onDelSelectedItem($event)"\r\n                    (clear)="onClearSelected($event)"\r\n                ></pager-selected-list>\r\n            </div>\r\n        </div>\r\n\r\n    </pagination-controls>\r\n\r\n\r\n</div>'}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.ChangeDetectorRef},{type:e.Injector,decorators:[{type:e.Optional}]}]},t.propDecorators={id:[{type:e.Input}],maxSize:[{type:e.Input}],directionLinks:[{type:e.Input}],autoHide:[{type:e.Input}],responsive:[{type:e.Input}],previousLabel:[{type:e.Input}],nextLabel:[{type:e.Input}],showPageList:[{type:e.Input}],showPageInfo:[{type:e.Input}],showPageNumber:[{type:e.Input}],locked:[{type:e.Input}],selectedData:[{type:e.Input}],viewMode:[{type:e.Input}],listItemFormatter:[{type:e.Input}],showSelectedList:[{type:e.Input}],showGotoInput:[{type:e.Input}],pageChange:[{type:e.Output}],pageSizeChange:[{type:e.Output}],removeSelectedItem:[{type:e.Output}],clearSelectedItem:[{type:e.Output}],pc:[{type:e.ViewChild,args:["pagerContainer"]}],pager:[{type:e.ViewChild,args:["pager"]}]},t}(),Mt=function(){function t(t){this.domSanitizer=t}return t.prototype.ngOnInit=function(){this.loading?this.loading=this.domSanitizer.bypassSecurityTrustHtml(this.loading):this.loading=this.domSanitizer.bypassSecurityTrustHtml('<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n  <circle cx="50" cy="50" fill="none" r="30" stroke="#2c7dff" stroke-width="10"></circle>\n  <circle cx="50" cy="50" fill="none" r="30" stroke="#d0eaff" stroke-width="10" stroke-linecap="square" transform="rotate(178.821 50 50)">\n      <animateTransform attributeName="transform" type="rotate"\n          calcMode="linear" values="0 50 50;180 50 50;720 50 50" keyTimes="0;0.5;1" dur="1.6s" begin="0s"\n          repeatCount="indefinite"></animateTransform>\n      <animate attributeName="stroke-dasharray" calcMode="linear"\n          values="9.42477796076938 179.0707812546182;150.79644737231007 37.6991118430775;9.42477796076938 179.0707812546182"\n          keyTimes="0;0.5;1" dur="1.6" begin="0s" repeatCount="indefinite"></animate>\n  </circle>\n</svg>')},t.decorators=[{type:e.Component,args:[{selector:"datagrid-loading",template:'\n    <div style="width:100%;height:100%;position:absolute;top:0;left: 0;background:rgba(255,255,255,0);z-index: 90000000;pointer-events: unset;">\n        <div style="width: 50px;height: 50px;position: relative;top: 50%;margin-top: -25px;left: 50%;margin-left: -25px;"\n        [innerHTML]="loading" >\n        </div>\n    </div>\n    '}]}],t.ctorParameters=function(){return[{type:g.DomSanitizer}]},t.propDecorators={loading:[{type:e.Input}]},t}(),zt=function(){function t(){this.data=[],this.close=new e.EventEmitter,this.remove=new e.EventEmitter,this.clear=new e.EventEmitter}return t.prototype.ngOnInit=function(){},t.prototype.ngOnChanges=function(t){},t.prototype.onClose=function(t){t.stopPropagation(),this.close.emit()},t.prototype.onRemoveClick=function(t,e){t.stopPropagation(),this.remove.emit(e)},t.prototype.onClearClick=function(t){t.stopPropagation(),this.clear.emit()},t.prototype.onClick=function(t){return t.stopPropagation(),!1},t.decorators=[{type:e.Component,args:[{selector:"pager-selected-list",template:'\r\n<div class="f-cmp-pager-selected-list-wrapper ">\r\n\t<div class="selected-list--content" (mouseleave)="onClose($event)" (click)="onClick($event)">\r\n\t\t<div class="selected-list--arrow"></div>\r\n\t\t<div class="selected-list--title">\r\n            <div class="btn-group">\r\n                <button class="btn btn-link" (click)="onClearClick($event)"> \r\n                    <i class="f-icon f-icon-remove"></i>\r\n                    <span class="btn-text">{{ \'datagrid.selectionData.clearAll\' | locale: \'清空\' }}</span>\r\n                </button>\r\n            </div>\r\n            <div class="selected-list--close"><span class="f-icon f-icon-close" (click)="onClose($event)"></span></div>\r\n        </div> <div class="selected-list--main">\r\n            <ul class="selected-list">  \x3c!-- selected-list--wrap --\x3e\r\n                <li class="selected-list--item ng-star-inserted" *ngFor="let item of data"  style="min-height: 35px;">\r\n\t\t\t\t\t<span class="f-icon f-icon-close-outline list-icon list-error" (click)="onRemoveClick($event, item.id)"></span>\r\n                    <div class="list-con" [innerHTML]="item.text"></div>\r\n                </li>\r\n                \r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n'}]}],t.ctorParameters=function(){return[]},t.propDecorators={data:[{type:e.Input}],close:[{type:e.Output}],remove:[{type:e.Output}],clear:[{type:e.Output}]},t}(),Gt=function(){function t(){}return t.prototype.transform=function(t,e){if(t)return t=e?t.map(function(t){return{id:t.id,text:e(t.data)}}):t.map(function(t){var e=[];return Object.keys(t.data).forEach(function(i){e.push(t.data[i])}),{id:t.id,text:e.join(", ")}})},t.decorators=[{type:e.Pipe,args:[{name:"selectedItem"}]}],t}(),Vt=function(){function t(){}return t.prototype.handleError=function(t){console.error(t)},t}(),Nt=function(){function t(){}return t.prototype.handleError=function(t){console.error(t)},t}(),Wt=function(){function t(t,i){this.injector=t,this.dg=i,this.indeterminate=!1,this.checked$=null,this.subscriptions=[],this.dfs=this.injector.get(K),this.cd=this.injector.get(e.ChangeDetectorRef)}return t.prototype.ngOnInit=function(){this.indeterminate&&(this.chk.nativeElement.indeterminate=!0),this.listenSubjects()},t.prototype.ngOnChanges=function(t){t.checked&&!t.checked.isFirstChange()&&this.changeCheckedStatus(t.checked.currentValue)},t.prototype.listenSubjects=function(){var t=this,e=this.dfs.primaryId(this.rowData);this.subscriptions.push(this.dg.checkAll.subscribe(function(){var i=!0;t.dg.disableRow&&((i=!t.dg.disableRow(t.rowData,t.rowIndex))||(i=t.dg.dfs.isRowChecked(e))),t.changeCheckedStatus(i)})),this.subscriptions.push(this.dg.unCheckAll.subscribe(function(e){e&&e.length?e.find(function(e){return e[t.dg.idField]===t.rowData[t.dg.idField]})&&t.changeCheckedStatus(!1):t.changeCheckedStatus(!1)}));var i=this.dg.dgs.setCheckedRows.pipe(r.filter(function(t){return t.ids.includes(e)||t.ids.includes(""+e)}),r.map(function(t){var i=t.ids.includes(e)||t.ids.includes(""+e);return!!i&&(i&&t.checked)})).subscribe(function(e){t.checked=e,t.changeCheckedStatus(e)});this.subscriptions.push(i)},t.prototype.ngOnDestroy=function(){this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions=[])},t.prototype.handleClick=function(t){var e=this;if(!this.disabled){var i={rowIndex:this.rowIndex,rowData:this.rowData,gridInstance:this.dg};this.dg.endCellEdit(),this.chk.nativeElement.checked?this.dg.beforeUncheck(i).subscribe(function(t){t&&(e.dfs.unCheckRow(e.rowIndex,e.rowData),e.checked=!1,e.changeCheckedStatus(!1),e.dg.showSelectedList&&e.dg.cd.detectChanges())}):this.dg.beforeCheck(i).subscribe(function(t){t&&(e.dfs.checkRow(e.rowIndex,e.rowData),e.checked=!0,e.changeCheckedStatus(!0))})}t.stopPropagation()},t.prototype.changeCheckedStatus=function(t){this.chk.nativeElement.checked=t},t.decorators=[{type:e.Component,args:[{selector:"datagrid-checkbox",template:' <div class="custom-control custom-checkbox f-checkradio-single">\n        <input type="checkbox" #chk class="custom-control-input" [disabled]="disabled" [checked]="checked">\n        <label class="custom-control-label" (click)="handleClick($event)"></label>\n    </div>',styles:["\n        :host {\n            vertical-align: middle;\n        }\n        :host .custom-checkbox {\n            opacity: 1;\n            float: none;\n            top: 2px;\n        }\n        "]}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:bt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return bt})]}]}]},t.propDecorators={rowData:[{type:e.Input}],rowIndex:[{type:e.Input}],checked:[{type:e.Input}],disabled:[{type:e.Input}],indeterminate:[{type:e.Input}],chk:[{type:e.ViewChild,args:["chk"]}]},t}(),Bt=function(){function t(t){this.injector=t,this.indeterminate=!1,this.dfs=this.injector.get(K),this.dg=this.injector.get(bt)}return t.prototype.ngOnInit=function(){var t=this;this.indeterminate&&(this.chk.nativeElement.indeterminate=!0),this.dg.dgs.changeCheckAllStatus.subscribe(function(e){2===e?t.chk.nativeElement.indeterminate=!0:(t.chk.nativeElement.indeterminate=!1,t.updateStatus(!!e))})},t.prototype.updateStatus=function(t){this.checked=t,this.chk.nativeElement.checked=t},t.prototype.handleClick=function(t){this.dg.data&&this.dg.data.length&&(this.disabled||(this.checked=!this.checked,this.indeterminate=!1,this.chk.nativeElement.indeterminate=!1,this.checked?(this.dfs.checkAll(),this.chk.nativeElement.checked=!0):(this.dfs.clearCheckeds(!this.dg.enableMorePageSelect),this.dg.selectedRow&&this.dg.checkOnSelect&&this.dg.selectOnCheck&&this.dg.unSelectRow(this.dg.selectedRow.id),this.chk.nativeElement.checked=!1)),t.stopPropagation())},t.decorators=[{type:e.Component,args:[{selector:"datagrid-header-checkbox",template:' <div class="custom-control custom-checkbox f-checkradio-single">\n        <input type="checkbox" #chk class="custom-control-input" [disabled]="disabled" [checked]="checked">\n        <label class="custom-control-label" (click)="handleClick($event)"></label>\n    </div>',styles:["\n        :host {\n            vertical-align: middle;\n        }\n        :host .custom-checkbox {\n            opacity: 1;\n            float: none;\n            top: 2px;\n        }\n        "]}]}],t.ctorParameters=function(){return[{type:e.Injector}]},t.propDecorators={checked:[{type:e.Input}],disabled:[{type:e.Input}],indeterminate:[{type:e.Input}],chk:[{type:e.ViewChild,args:["chk"]}]},t}(),$t=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),t){var n="row_"+this.dfs.primaryId(t);return e?n+="_fixedright":i&&(n+="_fixedleft"),n}return null},t.decorators=[{type:e.Pipe,args:[{name:"rowDataId"}]}],t.ctorParameters=function(){return[{type:K}]},t}(),qt=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e,i){if(t){var n=t.value;if(!e&&this.dfs&&(e=this.dfs.getColumn(t.field)),e&&e.formatter&&"enum"===e.formatter.type){var r=e.formatter.options,o=S({},r),s=o.valueField,l=o.textField,a=o.data.find(function(e){return e[s]===t.value});n=a?a[l]:""}return i?i(t):n}return""},t.decorators=[{type:e.Pipe,args:[{name:"formatGroupRow"}]}],t.ctorParameters=function(){return[{type:K,decorators:[{type:e.Optional}]}]},t}(),Xt=function(){function t(t,i,n,r,o,s,l){this.cd=t,this.dg=i,this.dgb=n,this.dfs=r,this.el=o,this.injector=s,this.ngZone=l,this.columns=[],this.toggle=new e.EventEmitter,this.checkedRows=[],this.selectedRows=[],this.data=[],this.groupRowIndex=N,this.isGroupRow=W,this.groupRow=B,this.isGroupFooter=$,this.visible=q,this.filterConditions="",this.subscriptions=[],this.dgs=null,this.dgs=this.injector.get(Z),this.render2=this.injector.get(e.Renderer2)}return t.prototype.listenSubject=function(){var t=this,e=this.dgs.setSelecedRow.subscribe(function(e){t.detectChanges()});this.subscriptions.push(e),this.dfs.checkRow$.subscribe(function(){t.checkedRows=t.dfs.getCheckeds(),t.detectChanges()}),this.dfs.clearCheckeds$.subscribe(function(){t.checkedRows=t.dfs.getCheckeds(),t.detectChanges()})},t.prototype.ngOnInit=function(){this.listenSubject()},t.prototype.ngOnDestroy=function(){this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions=[])},t.prototype.detectChanges=function(){this.cd.destroyed||this.cd.detectChanges()},t.decorators=[{type:e.Component,args:[{selector:"fixed-left-rows",template:'\r\n<ng-template #groupActionCell>\r\n    <td *ngIf="dg.showLineNumber || dg.showCheckbox" class="f-datagrid-cell f-datagrid-group-action"></td>\r\n</ng-template>\r\n\r\n\r\n<table class="f-datagrid-rows" style="width: 100%" cellpadding="0" cellspacing="0" row-hover>\r\n    <colgroup>\r\n        <col width="36px" *ngIf="dg.showCheckbox" />\r\n        <col [style.width.px]="dg.lineNumberWidth" *ngIf="dg.showLineNumber" />\r\n        <col *ngFor="let col of columns" [style.width.px]="col.width" />\r\n    </colgroup>\r\n\r\n\r\n    <tbody *ngIf="dg.groupRows && dg.groupField">\r\n        <ng-container *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n            <tr *ngIf="row[isGroupRow]" [style.display]="row[visible] ? \'\': \'none\'"\r\n            [attr.id]="row | rowDataId: false: true "\r\n                class="f-datagrid-body-row fixed-left-row f-datagrid-group-row" [attr.index]="dgb.startRowIndex + i">\r\n\r\n                <ng-container *ngIf="dg.showLineNumber && dg.showCheckbox; else groupActionCell">\r\n                    <td class="f-datagrid-cell f-datagrid-cell-checkbox"></td>\r\n                    <td class="f-datagrid-cell f-datagrid-cell-rownumber"></td>\r\n                </ng-container>\r\n\r\n            </tr>\r\n\r\n            <ng-container *ngIf="!row[isGroupRow]">\r\n\r\n                <ng-container *ngIf="row[isGroupFooter] && dg.groupSummaryPosition === \'groupFooterRow\'">\r\n                    <tr class="f-datagrid-body-row fixed-left-row f-datagrid-group-footer"\r\n                        [attr.index]="dgb.startRowIndex + i" [style.display]="row[visible] ? \'\': \'none\'">\r\n                        <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox"></td>\r\n                        <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber"></td>\r\n                    </tr>\r\n                </ng-container>\r\n                <ng-container *ngIf="!row[isGroupFooter]">\r\n                    <tr class="f-datagrid-body-row fixed-left-row" [attr.index]="dgb.startRowIndex + i"\r\n                        [class.f-datagrid-row-selected]="row | rowIsSelected: selectedRows" [grid-row]="row"\r\n                        [rowIndex]="dgb.startRowIndex + i" [attr.id]="row | rowDataId: false: true "\r\n                        [class.f-datagrid-disable-row]="row | disableRow: (dgb.startRowIndex + i) : dg.disableRow"\r\n                        [style.display]="row[visible] ? \'\': \'none\'">\r\n\r\n                        <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center">\r\n                            <div class="f-datagrid-cell-content checkbox-column"  style="text-overflow: unset;">\r\n                                <datagrid-checkbox [disabled]="row | disableRow: dgb.startRowIndex + i: dg.disableRow"\r\n                                    [rowData]="row" [rowIndex]="dgb.startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                            </div>\r\n                        </td>\r\n\r\n                        <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber">\r\n                            <div class="f-datagrid-cell-content">\r\n                                {{ dg.pageSize * (dg.pageIndex-1) + dgb.startRowIndex + row[groupRowIndex] + 1 }}\r\n                            </div>\r\n                        </td>\r\n\r\n                    </tr>\r\n\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n\r\n        </ng-container>\r\n\r\n    </tbody>\r\n\r\n\r\n    <tbody *ngIf="!dg.groupRows || !dg.groupField">\r\n        <tr class="f-datagrid-body-row fixed-left-row" [attr.index]="dgb.startRowIndex + i"\r\n            [class.f-datagrid-row-selected]="row | rowIsSelected" [grid-row]="row" \r\n            [rowIndex]="dgb.startRowIndex + i" [attr.id]="row | rowDataId: false: true "\r\n            [class.f-datagrid-disable-row]="row | disableRow: (dgb.startRowIndex + i) : dg.disableRow"\r\n            *ngFor="let row of data; trackBy: dg.trackByRows; let i = index"\r\n            >\r\n\r\n            <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center">\r\n                <div class="f-datagrid-cell-content checkbox-column" style="text-overflow: unset;">\r\n                <datagrid-checkbox [disabled]="row | disableRow: dgb.startRowIndex + i: dg.disableRow" [rowData]="row"\r\n                    [rowIndex]="dgb.startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                </div>\r\n            </td>\r\n\r\n            <td *ngIf="dg.showLineNumber" [style.width.px]="dg.lineNumberWidth"  class="f-datagrid-cell f-datagrid-cell-rownumber">\r\n                <div class="f-datagrid-cell-content">\r\n                    {{ dg.pageSize * (dg.pageIndex-1) + dgb.startRowIndex + i + 1 }}\r\n                </div>\r\n            </td>\r\n\r\n            <td [cell-editable]="row" [column]="col" [attr.field]="col.field" class="f-datagrid-cell"\r\n                [attr.align]="col.align" *ngFor="let col of columns; let ci = index;">\r\n                <grid-body-cell [width]="col.width" [height]="dg.rowHeight" [column]="col" [rowData]="row"\r\n                    [rowIndex]="dgb.startRowIndex + i"></grid-body-cell>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n\r\n\r\n\r\n\r\n</table>'}]}],t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:bt},{type:xt},{type:K},{type:e.ElementRef},{type:e.Injector},{type:e.NgZone}]},t.propDecorators={columns:[{type:e.Input}],toggle:[{type:e.Output}],checkedRows:[{type:e.Input}],selectedRows:[{type:e.Input}],data:[{type:e.Input}]},t}(),Ut=function(){function t(){}return t.prototype.transform=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.forEach(function(e,i){t=t.replace("{"+i+"}",e)}),t},t.decorators=[{type:e.Pipe,args:[{name:"replaceX"}]}],t}(),Yt=function(){function t(t,e,i,n){this.injector=t,this.render=e,this.el=i,this.dg=n}return t.prototype.ngOnInit=function(){if(this.dg.groupStyler){var t=this.dg.groupStyler(this.groupRow),e=this.el.nativeElement;e.id||(e.id="group-tr_"+this.groupRow.id),this.dg.renderCustomStyle(t,e)}},t.decorators=[{type:e.Directive,args:[{selector:"[group-row]"}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.Renderer2},{type:e.ElementRef},{type:bt}]},t.propDecorators={groupRow:[{type:e.Input,args:["group-row"]}]},t}(),Kt=function(){function t(){}return t.prototype.transform=function(t){return!(!t||!t.length)&&t.find(function(t){return"required"===t.type})},t.decorators=[{type:e.Pipe,args:[{name:"showStar"}]}],t}(),Zt=function(){function t(){}return t.prototype.transform=function(t,e,i){return!!i&&i(t,e)},t.decorators=[{type:e.Pipe,args:[{name:"disableRow"}]}],t}(),Qt=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t){return this.dfs.isRowSelected(t)},t.decorators=[{type:e.Pipe,args:[{name:"selectedRow"}]}],t.ctorParameters=function(){return[{type:K}]},t}(),Jt=function(){function t(){}return t.prototype.transform=function(t,e,i){return void 0===i&&(i=!1),U.getValue(t,e,i)},t.decorators=[{type:e.Pipe,args:[{name:"fieldvalue"}]}],t}(),te=function(){function t(t,i){this.el=t,this.injector=i,this.position="top-left",this.delay=1e3,this.cls="",this.type="info",this.tipMode="auto",this.showTipTimer=null,this._mouseenter=null,this._mouseleave=null,this._mouseclick=null,this.ngZone=null,this.render=null,this.injector?(this.commonUtils=this.injector.get(l.CommonUtils,new l.CommonUtils),this.ngZone=this.injector.get(e.NgZone),this.render=this.injector.get(e.Renderer2),this.dg=this.injector.get(bt)):this.commonUtils=new l.CommonUtils}return t.prototype.ngOnInit=function(){var t=this;this.ngZone&&this.ngZone.runOutsideAngular(function(){t._mouseenter=U.on(t.el.nativeElement,"mouseenter",t.onMouseEnter.bind(t),{target:".f-datagrid-cell-content",options:{capture:!0}}),t._mouseleave=U.on(t.el.nativeElement,"mouseleave",t.onMouseLeave.bind(t),{target:".f-datagrid-cell-content",options:{capture:!0}}),t._mouseclick=U.on(t.el.nativeElement,"mousedown",t.onClick.bind(t))})},t.prototype.ngOnDestroy=function(){this.hide(),this._mouseenter&&this._mouseenter(),this._mouseleave&&this._mouseleave(),this._mouseclick&&this._mouseclick()},t.prototype.onMouseEnter=function(t){var e=this,i=this.dg?this.dg.cellTipTimer:1e3;this.showTipTimer&&(clearTimeout(this.showTipTimer),this.showTipTimer=null),this.showTipTimer=setTimeout(function(){e.show(t)},i)},t.prototype.onMouseLeave=function(){this.hide()},t.prototype.onClick=function(t){this.hide()},t.prototype.getTextContainer=function(){return it.findSingle(this.container,".f-tooltip-text")},t.prototype.donotShowTips=function(t){var e=t.offsetWidth,i=window.getComputedStyle(t),n=this.commonUtils.getTextWidth(this.message,i.font),r=i.paddingLeft,o=i.paddingRight,s=e-(Number(r.replace("px",""))||0)-(Number(o.replace("px",""))||0),l=t.closest("tr");if(l){var a=l.id;l=document.querySelector("#"+a)}return"auto"===this.tipMode?!l||s&&s>n:!l},t.prototype.hide=function(){this.showTipTimer&&(clearTimeout(this.showTipTimer),this.showTipTimer=null),this.container&&this.container.parentElement&&document.body.removeChild(this.container),this.container=null},t.prototype.show=function(t){var e=t.target;if(this.enable="true"===e.getAttribute("cell-tooltip"),this.message=e.getAttribute("message"),this.tipMode=e.getAttribute("tipMode")||"auto",this.enable&&this.message){var i=e.getAttribute("tipWidth"),n=e.getAttribute("tipHeight");if(this.position=e.getAttribute("position")||"top-left",!this.donotShowTips(t.target)){var r=t.target,o=this.getBoxSizeObj(r);this.container?it.findSingle(this.container,".f-tooltip-text").innerHTML=this.message:this.create(o),this.container.style.maxWidth=window.innerWidth-30+"px",this.container.style.minWidth="35px",i&&(this.container.style.width=i),n&&(this.container.style.height=n);var s,l,a=it.getOffset(r),c=a.top,d=a.left;this.container.style.display="block",this.changeTooltipPosition();var h=it.findSingle(this.container,".f-tooltip-arrow"),u=this.getTooltipSize();if(window.innerHeight-10<u.height){this.container.style.height=window.innerHeight-20+"px",u.height=window.innerHeight-25;var p=this.getTextContainer();p.style.height=u.height+"px",p.style.overflow="hidden"}var g=this.updateArrowPosition(h,a,t);switch(this.position){case"right":s=d+o.width,l=g;break;case"left":s=d-u.width,l=g;break;case"top-left":l=c-u.height-7,s=g}s&&(this.container.style.left=s+"px"),this.container.style.top=l+"px",this.container.style.zIndex=999999}}},t.prototype.updateArrowPosition=function(t,e,i){var n=this.getTooltipSize();if("left"===this.position||"right"===this.position){var r=e.top,o=n.height/2,s=10;return r>o&&window.innerHeight-r>o&&(s=r-n.height/2),t&&(t.style.top=r-s+"px"),s}if("top-left"===this.position){var l=i.pageX-n.width/2;return l<10&&(l=e.left),l+n.width>window.innerWidth&&(l=window.innerWidth-n.width-20),t&&i.pageX-l>28&&(i.pageX-l+28>n.width?t.style.left=n.width-28+"px":t.style.left=i.pageX-l+"px"),l}},t.prototype.create=function(t){var e=this.tooltipCls();this.container=document.createElement("div"),this.tooltipStyleClass&&(e+=" "+this.tooltipStyleClass),this.container.className=e;var i=document.createElement("div");i.className="f-tooltip-arrow ",this.container.appendChild(i);var n=document.createElement("div");n.className="f-tooltip-text ",n.innerHTML=this.message;var r=window.innerWidth-50;n.style.maxWidth=r+"px",n.style.wordBreak="break-all",this.container.style.textAlign="center",this.positionStyle&&(this.container.style.position=this.positionStyle),this.container.appendChild(n),document.body.appendChild(this.container)},t.prototype.tooltipCls=function(){return"datagrid-cell-tooltip f-tooltip "+this.getThemeCls()+" f-tooltip-"+this.position+" "+this.cls},t.prototype.getThemeCls=function(){return this.type?"f-tooltip-"+this.type:""},t.prototype.getBoxSizeObj=function(t){var e=t.getBoundingClientRect();return{width:it.getOuterWidth(t),height:it.getOuterHeight(t),left:e.left,right:e.right,top:e.top,bottom:e.bottom}},t.prototype.getTooltipSize=function(){return{width:it.getOuterWidth(this.container),height:it.getOuterHeight(this.container)}},t.prototype.getWindowSize=function(){return{width:window.innerWidth,height:window.innerHeight}},t.prototype.changeTooltipPosition=function(){var t=this.getBoxSizeObj(this.el.nativeElement),e=this.getTooltipSize(),i=this.getWindowSize();if(this.container.className=this.tooltipCls(),!(e.width<i.width&&e.height<t.top)){var n=it.getOffset(this.el.nativeElement).left,r=i.width-n-t.width;this.position=n>r?"left":"right";var o=n>r?n:r;this.getTextContainer().style.maxWidth=o-30+"px",this.container.style.maxWidth=o+"px"}},t.decorators=[{type:e.Directive,args:[{selector:"[cell-tooltip]",exportAs:"cellTooltip"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Injector}]},t.propDecorators={enable:[{type:e.Input,args:["cell-tooltip"]}],position:[{type:e.Input}],positionStyle:[{type:e.Input}],tooltipStyleClass:[{type:e.Input}],message:[{type:e.Input}],delay:[{type:e.Input}],cls:[{type:e.Input}],type:[{type:e.Input}],tipMode:[{type:e.Input}]},t}(),ee=function(){function t(t){this.injector=t}return t.prototype.transform=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t.showTips){this.colFormatSer=this.injector.get(f.ColumnFormatService);var n=this.getCellTooltipContent(t,e[0]);return n}return""},t.prototype.getCellTooltipContent=function(t,e){var i=U.getValue(t.field,e);return t.tipContent?"string"==typeof t.tipContent?i=t.tipContent:"function"==typeof t.tipContent&&(i=t.tipContent(i,e,t)):i=t.formatter&&("function"==typeof t.formatter||"object"==typeof t.formatter&&Object.keys(t.formatter).length)?this.colFormatSer.format(i,e,t.formatter):U.escapeValue(i),i},t.decorators=[{type:e.Pipe,args:[{name:"tipmsg",pure:!1}]}],t.ctorParameters=function(){return[{type:e.Injector}]},t}(),ie=function(){function t(t,e,i,n,r,o,s){this.inject=t,this.el=e,this.cd=i,this.dgs=n,this.render=r,this.ngZone=o,this.localeSer=s,this.empty="[ 无 ]",this.filterText=this.empty,this.openFilterPanel=!1,this.showExpand=!1,this.enableFilterSetting=!1,this.windowResizeHandler=null,this.ro=null,this.empty=this.localeSer.getValue("datagrid.filter.nofilter"),this.filterText=this.empty}return Object.defineProperty(t.prototype,"toolbarWidth",{get:function(){return this.filterToolbarRef.nativeElement.offsetWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterTextContainerWidth",{get:function(){var t=52;return this.enableFilterSetting&&(t=65),this.toolbarWidth-85-t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterTextRealWidth",{get:function(){this.render.setStyle(this.filterPanelTextRef.nativeElement,"white-space","nowrap");var t=this.filterPanelTextRef.nativeElement.scrollWidth;return this.render.setStyle(this.filterPanelTextRef.nativeElement,"white-space","normal"),t},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.dg=this.inject.get(bt),this.dfrs=this.dg.clientFilterService,this.filterChangeSubscription=this.dgs.onFilterChanged.subscribe(function(e){t.filterText=t.dfrs.convertFilterCondition2String(e),t.filterText||(t.filterText=t.empty),t.updateExpandState(),setTimeout(function(){t.bindEvent()},100),t.showExpand||(t.openFilterPanel=!1),t.cd.detectChanges(),t.dgs.onFilterTextChange(t.filterText)}),this.ngZone.runOutsideAngular(function(){t.ro=new u(function(){setTimeout(function(){t.updateExpandState(),t.cd.detectChanges()},100)}),t.ro.observe(t.el.nativeElement.closest("div.f-datagrid"))})},t.prototype.ngOnDestroy=function(){this.ro.disconnect(),this.filterChangeSubscription&&(this.filterChangeSubscription.unsubscribe(),this.filterChangeSubscription=null),this.windowResizeHandler&&(this.windowResizeHandler(),this.windowResizeHandler=null)},t.prototype.bindEvent=function(){var t=this;this.ngZone.runOutsideAngular(function(){var e=t.filterToolbarRef.nativeElement.querySelectorAll(".filter-field");t.bindFilterFieldHandler(e);var i=t.filterPanelTextRef.nativeElement.querySelectorAll(".filter-field");t.bindFilterFieldHandler(i,!1)})},t.prototype.bindFilterFieldHandler=function(t,e){var i=this;void 0===e&&(e=!0),t&&t.length&&t.forEach(function(t){i.render.listen(t,"click",function(){i.removeFilterField(t,e)})})},t.prototype.removeFilterField=function(t,e){void 0===e&&(e=!0);var i=t.classList[1].replace("filter-column-","");delete this.dg.conditions[i],this.dfrs.removeFilterField(i),t.remove(),e&&(this.openFilterPanel=!1,this.updateExpandState())},t.prototype.updateExpandState=function(){this.showExpand=this.isShowExpand()},t.prototype.isShowExpand=function(){return!(this.filterTextContainerWidth>this.filterTextRealWidth)&&this.filterTextRealWidth>this.filterTextContainerWidth},t.prototype.clearFilter=function(t){return this.filterText=this.empty,this.dgs.onClearFilter(),this.dgs.onFilterChanged.emit({}),!1},t.prototype.refreshFilter=function(t){return this.dg.filterData(),!1},t.prototype.showFilterTextPanel=function(){this.openFilterPanel=!this.openFilterPanel,this.cd.detectChanges()},t.decorators=[{type:e.Component,args:[{selector:"filter-toolbar",template:'\n        <div class="f-datagrid-filter-toolbar-panel" #filterPanel [class.show]="openFilterPanel" style="width: auto">\n            <span class="filter-text" #filterPanelText [innerHTML]="filterText"></span>\n        </div>\n        <div class="f-datagrid-filter-toolbar" #filterToolbar>\n            <span class="title">{{\'datagrid.filter.title\'| locale}}：</span>\n            <span #filterbarTxt class="filter-text" [innerHTML]="filterText"> </span>\n            <span class="filter-action" *ngIf="filterText !== empty ">\n                <span *ngIf="showExpand" class="f-icon filter-action-item"\n                    [class.f-icon-arrow-chevron-up]="openFilterPanel"\n                    [class.f-icon-arrow-chevron-down]="!openFilterPanel"\n                (click)="showFilterTextPanel()" title="{{\'datagrid.filter.more\'|locale}}"></span>\n                <span title="{{\'datagrid.filter.clearAll\'|locale}}" class="f-icon f-icon-x filter-action-item filter-clear" (click)="clearFilter($event)"></span>\n                <span title="refresh" class="f-icon f-icon-reload-sm filter-action-item filter-refresh" style="color: #388fff" (click)="refreshFilter($event)"></span>\n                <span *ngIf="enableFilterSetting" class="f-icon f-icon-cog filter-action-item" title="{{\'datagrid.filter.setting\'|locale}}"></span>\n            </span>\n        </div>\n    ',encapsulation:e.ViewEncapsulation.None}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ElementRef},{type:e.ChangeDetectorRef},{type:Z},{type:e.Renderer2},{type:e.NgZone},{type:a.LocaleService}]},t.propDecorators={enableFilterSetting:[{type:e.Input}],filterPanelRef:[{type:e.ViewChild,args:["filterPanel"]}],filterPanelTextRef:[{type:e.ViewChild,args:["filterPanelText"]}],filterTextRef:[{type:e.ViewChild,args:["filterbarTxt"]}],filterToolbarRef:[{type:e.ViewChild,args:["filterToolbar"]}]},t}(),ne=function(){function t(t,e,i){this.el=t,this.render=e,this.inject=i}return t.prototype.ngOnInit=function(){this.renderCss2Element()},t.prototype.renderCss2Element=function(){if(this.column&&this.column.headerStyler){var t=this.column.headerStyler,e=this.el.nativeElement,i=typeof this.column.headerStyler;if("string"===i)this.render.addClass(this.el.nativeElement,t);else if("function"===i){var n=this.column.headerStyler(this.column);n.cls&&this.render.addClass(this.el.nativeElement,n.cls),n.style&&this.renderStyle(e,n.style)}else"object"===i&&Object.keys(i).length&&this.renderStyle(e,t)}},t.prototype.renderStyle=function(t,e){var i=this;Object.keys(e).forEach(function(n){i.render.setStyle(t,n,e[n])})},t.decorators=[{type:e.Directive,args:[{selector:"[header-style]",exportAs:"HeaderStyler"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector}]},t.propDecorators={column:[{type:e.Input,args:["header-style"]}]},t}(),re=function(){function t(t,e){this.dg=t,this.inject=e}return t.prototype.ngOnInit=function(){},t.decorators=[{type:e.Component,args:[{selector:"auto-height",template:'<table style="width:100%" class="f-datagrid-ah" cellpadding="0" cellspacing="0" border="0">\r\n    <colgroup>\r\n        <col *ngIf="dg.showLineNumber" [width]="dg.lineNumberWidth + \'px\'">\r\n        <ng-container *ngFor="let col of columnsGroup?.normalColumns">\r\n            <col [width]="col.width + \'px\'">\r\n        </ng-container>\r\n    </colgroup>\r\n    <thead>\r\n        <tr class="f-datagrid-header-row" *ngFor="let cols of columns">\r\n            <td class="f-datagrid-header-cell" *ngIf="dg.showLineNumber"></td>\r\n            <ng-container *ngFor="let col of cols">\r\n                <ng-container *ngIf="col.colspan && !col.fixed">\r\n                    <td class="f-datagrid-header-cell f-datagrid-header-cell-group" \r\n                        [attr.align]="col.halign"\r\n                        [attr.colspan]="col.colspan">\r\n                        <div class="f-datagrid-header-cell-content" >\r\n                            {{ col.title }}\r\n                        </div>\r\n                    </td>\r\n                </ng-container>\r\n                <ng-container *ngIf="!col.colspan && !col.fixed">\r\n                    <td class="f-datagrid-header-cell" \r\n                        [attr.align]="col.halign" \r\n                        [attr.field]="col.field"\r\n                        [attr.rowspan]="col.rowspan">\r\n                        <div class="f-datagrid-header-cell-content">\r\n                            {{ col.title }}\r\n                        </div>\r\n                    </td>\r\n                </ng-container>\r\n            </ng-container>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr class="f-datagrid-body-row" [attr.id]="row | rowDataId" *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n            <td class="f-datagrid-cell f-datagrid-cell-rownumber" [style.width.px]="dg.lineNumberWidth" *ngIf="dg.showLineNumber">{{ i+1 }}</td>\r\n            <td class="f-datagrid-cell" [attr.align]="col.align" *ngFor="let col of columnsGroup?.normalColumns; let ci = index;">\r\n                <span [innerHtml]=" col | formatCellData: row | safe: \'html\'"></span>\r\n            </td>\r\n        </tr>\r\n        <ng-container *ngIf="dg.showFooter && data && data.length">\r\n            <tr class="f-datagrid-body-row" *ngFor="let row of dg.footerData">\r\n                <td class="f-datagrid-cell f-datagrid-cell-rownumber" [style.width.px]="dg.lineNumberWidth" *ngIf="dg.showLineNumber"></td>\r\n                <td class="f-datagrid-cell" [attr.align]="col.align" *ngFor="let col of columnsGroup?.normalColumns" [attr.title]="col | formatCellData: row ">\r\n                    <div class="f-datagrid-cell-content">\r\n                        <span *ngIf="col.footer && col.footer.formatter" [innerHtml]=" col | formatCellData: row : false: true | safe: \'html\'"></span>\r\n                        <span *ngIf="!col.footer || !col.footer.formatter">{{ col | formatCellData: row: false: true }}</span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </ng-container>\r\n    </tbody>\r\n</table>'}]}],t.ctorParameters=function(){return[{type:bt},{type:e.Injector}]},t.propDecorators={columns:[{type:e.Input}],columnsGroup:[{type:e.Input}],data:[{type:e.Input}]},t}(),oe=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e){if(!t)return!1;var i=this.dfs.primaryId(t);return!!i&&this.dfs.isRowSelected(i,e)},t.decorators=[{type:e.Pipe,args:[{name:"rowIsSelected",pure:!1}]}],t.ctorParameters=function(){return[{type:K}]},t}(),se=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e){if(!t)return!1;var i=this.dfs.primaryId(t);return!!i&&this.dfs.isRowChecked(i,e)},t.decorators=[{type:e.Pipe,args:[{name:"rowIsChecked",pure:!1}]}],t.ctorParameters=function(){return[{type:K}]},t}(),le=function(){function t(t,e,i){this.dg=t,this.inject=e,this.el=i,this.autoHeight=!1,this._timer=null}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this.updateDatagridHeight(this.wheelHeight)},t.prototype.ngOnChanges=function(t){t.wheelHeight&&this.updateDatagridHeight(this.wheelHeight)},t.prototype.ngDoCheck=function(){},t.prototype.updateDatagridHeight=function(t){if(this.el&&this.el.nativeElement&&this.el.nativeElement.parentElement&&this.autoHeight){t||(t=240,this.dg.ds&&this.dg.ds.rows&&this.dg.ds.rows.length||(t=!this.dg.emptyDataHeight||this.dg.emptyDataHeight<0?240:this.dg.emptyDataHeight));var e=parseInt(t,10);if(this.dg.showHeader&&(this.dg.realHeaderHeight?e+=this.dg.realHeaderHeight:e+=this.dg.setHeaderHeight()),this.dg.showFooter&&(e+=this.dg.footerHeight),this.dg.pagination)e+=this.dg.pagerHeight||40;this.dg.showFilterBar&&(e+=this.dg.filterBarHeight);var i=t+"px";if(this.el.nativeElement.parentElement.style.height=i,this.el.nativeElement.parentElement.parentElement.style.height=i,this.dg.dgContainer){var n=e+"px";this.dg.dgContainer.nativeElement.style.height=n,this.dg.el.nativeElement.style.height=n,this.dg.height=e}else this.dg.el.nativeElement.querySelector(".f-datagrid").style.height=e+"px"}},t.decorators=[{type:e.Directive,args:[{selector:"[auto-height]"}]}],t.ctorParameters=function(){return[{type:bt},{type:e.Injector},{type:e.ElementRef}]},t.propDecorators={autoHeight:[{type:e.Input,args:["auto-height"]}],wheelHeight:[{type:e.Input}]},t}(),ae=function(){function t(t,e,i,n,r){this.el=t,this.injector=e,this.ngZone=i,this.render=n,this.dg=r}return t.prototype.ngOnInit=function(){},t.prototype.ngOnDestroy=function(){},t.prototype.dblclickRowEvent=function(t){var e=t.target.closest("tr"),i=e.id.replace("row_","").replace("_fixedright","").replace("_fixedleft",""),n=e.getAttribute("index"),r=this.dg.dfs.findRow(i);if(this.dg.disableRow&&this.dg.disableRow(r.data,r.index))return t.stopPropagation(),!1;this.dg.editable?"row"===this.dg.editMode&&this.dg.clickToEdit?this.dg.editRow(i):(this.dg.isSingleClick=!1,this.dg.dblclickRow.emit({rowData:r,id:i,index:n,grid:this.dg,dblclick:!0})):this.dg.dblclickRow.emit({rowData:r,id:i,index:n,grid:this.dg,dblclick:!0}),t.stopPropagation(),t.preventDefault()},t.decorators=[{type:e.Directive,args:[{selector:"[row-dblclick]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Injector},{type:e.NgZone},{type:e.Renderer2},{type:bt}]},t.propDecorators={dblclickRowEvent:[{type:e.HostListener,args:["dblclick",["$event"]]}]},t}(),ce=function(){function t(t,e,i,n){this.el=t,this.render=e,this.inject=i,this.dg=n,this.isGroupFooter=!1}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this.isGroupFooter?this.setGroupFooterCellStyle(this.column):this.buildCustomCellStyle(this.column,this.rowData)},t.prototype.buildCustomCellStyle=function(t,e){var i=this.el.nativeElement.parentNode;if(i.id||(i.id="footer-row-"+this.dg.dfs.primaryId(e)),this.el.nativeElement.id||(this.el.nativeElement.id="footer-td_"+this.rowIndex+"_"+this.column.field),t&&t.footer&&t.footer.styler){var n=e,r=(0,t.footer.styler)(n[t.field],n);r&&Object.keys(r).length?this.dg.renderCustomStyle(r,this.el.nativeElement):this.dg.dgs.removeCssRule("#"+this.el.nativeElement.id)}},t.prototype.setGroupFooterCellStyle=function(t){var e=this;if(t.groupFooter&&t.groupFooter.styler){var i=this.dg.commonUtils.getValue(t.field,this.rowData),n=this.dg.dgs.getCustomStyle(t.groupFooter.styler,[i,this.rowData]);n&&(this.dg.renderCustomCls(n.cls,this.el.nativeElement),n.style&&Object.keys(n.style).forEach(function(t){e.el.nativeElement.style[t]=n.style[t]}))}},t.decorators=[{type:e.Directive,args:[{selector:"[footer-cell-styler]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector},{type:bt}]},t.propDecorators={column:[{type:e.Input}],rowData:[{type:e.Input}],rowIndex:[{type:e.Input}],isGroupFooter:[{type:e.Input}]},t}(),de=function(){function t(){}return t.prototype.moveItem=function(t,e,i){var n=t.splice(i,1);return t.splice.apply(t,x([e,0],n)),t},t.prototype.backupColumns=function(t){this.initColumns=t.map(function(t){return t.map(function(t){return{id:t.id,field:t.field}})})},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();b.constants.wrapperClass,b.constants.animationClass;b.smoothDnD.dropHandler=b.dropHandlers.reactDropHandler().handler,b.smoothDnD.wrapChild=!1;var he=function(){function t(t,e,i,n,r,o,s){var l=this;this.ngzone=t,this.injector=e,this.render=i,this.el=n,this.header=r,this.dg=o,this.dndSer=s,this.enableDrag=!0,this.groupName="",this.options={groupName:this.groupName,orientation:"horizontal",behaviour:"move",dragHandleSelector:".drag-column-bar",dragClass:"drag-column-moving",dropPlaceholder:{className:"drop-group-field"},getGhostParent:function(){return document.body},getChildPayload:this.getChildPayload.bind(this),shouldAcceptDrop:function(t,e){return"number"!=typeof e&&(t.groupName===l.groupName&&!l.dg.isMultiHeader())},onDropReady:function(t){l.ngzone.run(function(){l.onDropReady(t)})},onDrop:function(t){l.ngzone.run(function(){l.onDrop(t)})},onDragEnter:function(){l.ngzone.run(function(){l.onDragEnter()})},onDragStart:function(t){l.ngzone.run(function(){l.onDragStart(t)})},onDragEnd:function(t){l.ngzone.run(function(){l.onDragEnd(t)})}}}return t.prototype.ngOnChanges=function(t){t.enableDrag&&!t.enableDrag.isFirstChange()&&(this.enableDrag?this.initDnD():this.disposeDnd())},t.prototype.ngAfterViewInit=function(){this.initDnD()},t.prototype.ngOnDestroy=function(){this.disposeDnd()},t.prototype.disposeDnd=function(){this.container&&(this.container.dispose(),this.container=null)},t.prototype.initDnD=function(){if("left"===this.groupName||"right"===this.groupName){var t=this.columnsGroup(),e=t.left,i=t.right;if(!e.length||!i.length||1===i.length&&"_datagrid-setting-control_"===i[0].field)return}this.options.groupName=this.groupName,this.disposeDnd(),this.enableDrag&&(this.container=b.smoothDnD(this.el.nativeElement,this.options),this.dndSer.backupColumns(this.header.columns))},t.prototype.getChildPayload=function(t){var e=this;"left"===this.groupName&&(this.dg.showCheckbox&&t--,this.dg.showLineNumber&&t--);var i=this.columnsGroup();return"left"===this.groupName?i.left.filter(function(t,i){return e.dg.columnIsVisible(t)})[t]:i.middle.filter(function(t,i){return e.dg.columnIsVisible(t)})[t]},t.prototype.onDropReady=function(t){},t.prototype.onDrop=function(t){var e=this,i=t.addedIndex,n=t.payload;t.removedIndex;if(null!==i){var r=this.columnsGroup(),o=this.dg.columns[0],s=o.findIndex(function(t){return t.field===n.field}),l=i,a=[];"left"===this.groupName?(this.dg.showCheckbox&&l--,this.dg.showLineNumber&&l--,a=r.left):"center"===this.groupName?a=r.middle:"right"===this.groupName&&(a=r.right),function(t){if(t){var i=t.filter(function(t){return t.visible||t.visible===undefined})[l];if(i){var n=o.findIndex(function(t){return t.field===i.field});return e.dg.columns[0]=e.dndSer.moveItem(e.dg.columns[0],n,s),!0}}return!1}(a)&&(this.dg.columnsChanged(!1),this.dg.useControlPanel&&this.dg.settingService&&this.dg.settingService.saveUserConfig(this.dg.id),this.dg.columnMoved.emit({newColumns:this.dg.columns,grid:this.dg}))}},t.prototype.onDragStart=function(t){},t.prototype.onDragEnd=function(t){},t.prototype.onDragEnter=function(){},t.prototype.columnsGroup=function(){return{left:this.dg.columns[0].filter(function(t){return"left"===t.fixed}),right:this.dg.columns[0].filter(function(t){return"right"===t.fixed}),middle:this.dg.columns[0].filter(function(t){return"right"!==t.fixed&&"left"!==t.fixed})}},t.decorators=[{type:e.Directive,args:[{selector:"[drag-column]",providers:[de]}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.Injector},{type:e.Renderer2},{type:e.ElementRef},{type:Tt},{type:bt},{type:de}]},t.propDecorators={enableDrag:[{type:e.Input,args:["drag-column"]}],groupName:[{type:e.Input}],options:[{type:e.Input}]},t}();b.smoothDnD.dropHandler=b.dropHandlers.reactDropHandler().handler,b.smoothDnD.wrapChild=!1;b.constants.wrapperClass,b.constants.animationClass;var ue=function(){function t(t,e,i,n,r,o){var s=this;this.ngzone=t,this.injector=e,this.render=i,this.el=n,this.dg=r,this.dndSer=o,this.options={orientation:"horizontal",behaviour:"move",dragHandleSelector:".group-field",dropPlaceholder:{className:"drop-group-field"},getGhostParent:function(){return document.body},shouldAcceptDrop:function(t,e){return"number"==typeof e||s.getGroupFields().length<3&&(e.allowGrouping===undefined||e.allowGrouping)},getChildPayload:function(t){return t},onDropReady:function(t){s.ngzone.run(function(){s.onDropReady(t)})},onDrop:function(t){s.ngzone.run(function(){s.onDrop(t)})},onDragEnter:function(){s.ngzone.run(function(){s.onDragEnter()})},onDragStart:function(t){s.ngzone.run(function(){s.onDragStart(t)})},onDragEnd:function(t){s.ngzone.run(function(){s.onDragEnd(t)})}}}return t.prototype.ngAfterViewInit=function(){this.initDnD()},t.prototype.ngOnDestroy=function(){this.disposeDnd()},t.prototype.disposeDnd=function(){this.container&&(this.container.dispose(),this.container=null)},t.prototype.initDnD=function(){this.disposeDnd(),this.dg.showRowGroupPanel&&(this.container=b.smoothDnD(this.el.nativeElement,this.options))},t.prototype.onDropReady=function(t){},t.prototype.getGroupFields=function(){return this.dg.groupField?this.dg.groupField.split(","):[]},t.prototype.onDrop=function(t){var e=this,i=t.addedIndex,n=t.payload,r=t.removedIndex;if(null!==i){var o=this.getGroupFields();null===r?o.some(function(t){return t===n.field})||o.push(n.field):this.dndSer.moveItem(o,i,r),this.dg.groupField=o.join(","),this.dg.useControlPanel&&this.dg.settingService?this.dg.settingService.saveUserConfig(this.dg.id).subscribe(function(){e.dg.columnsChanged()}):this.dg.columnsChanged(),this.dg.groupFieldChange.emit({newGroupField:this.dg.groupField,grid:this.dg})}},t.prototype.onDragStart=function(t){},t.prototype.onDragEnd=function(t){},t.prototype.onDragEnter=function(){},t.decorators=[{type:e.Directive,args:[{selector:"[drop-column]",providers:[de]}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.Injector},{type:e.Renderer2},{type:e.ElementRef},{type:bt},{type:de}]},t.propDecorators={options:[{type:e.Input}]},t}(),pe=function(){function t(t,e,i,n){this.el=t,this.render=e,this.inject=i,this.dg=n}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this.buildCustomGroupFooterRowStyle(this.rowData)},t.prototype.buildCustomGroupFooterRowStyle=function(t){var e=this;if(this.dg.groupFooterStyler){var i=this.dg.dgs.getCustomStyle(this.dg.groupFooterStyler,[t]);i&&(this.dg.renderCustomCls(i.cls,this.el.nativeElement),i.style&&Object.keys(i.style).forEach(function(t){e.el.nativeElement.style[t]=i.style[t]}))}},t.decorators=[{type:e.Directive,args:[{selector:"[group-footer-row-styler]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector},{type:bt}]},t.propDecorators={column:[{type:e.Input}],rowData:[{type:e.Input,args:["group-footer-row-styler"]}],rowIndex:[{type:e.Input}]},t}(),ge={minScrollbarLength:20},fe=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:e||[]}},t.decorators=[{type:e.NgModule,args:[{imports:[d.CommonModule,m.FormsModule,m.ReactiveFormsModule,i.HttpClientModule,w.PaginationModule,rt,pt,a.LocaleModule.forRoot(),f.DataColumnModule.forRoot(),y.NotifyModule.forRoot(),v.SimpleFilterModule,St,C.FarrisContextMenuModule],declarations:[Ft,Rt,$t,qt,Kt,Jt,Ut,Zt,Qt,ee,bt,Tt,jt,Lt,_t,Dt,It,xt,At,gt,ft,Ot,Xt,Et,Mt,Wt,Bt,kt,Pt,Yt,te,ie,ne,le,re,oe,se,Gt,zt,ae,ce,he,ue,Ht,mt,pe],providers:[{provide:e.ErrorHandler,useClass:Vt},{provide:st,useValue:ge},et],exports:[bt,Tt,ft,gt,_t,Et,Lt,Pt,Rt,$t,Ut,Jt,ee,Kt,te,ie,oe,se,ae,ce,he,ue,Ht,mt,St,pe,C.FarrisContextMenuModule],entryComponents:[]}]}],t}();t.ALLOW_EDIT_CELL_HIGHLIGHT_CLS=G,t.AutoHeightDirective=le,t.CELL_EDITING_CLS=M,t.CELL_SELECTED_CLS=A,t.CalculationType=I,t.ColumnFilterType=E,t.DATAGRID_REST_SERVICEE=Q,t.DATAGRID_SETTING_FIELDNAME="_DATAGRID_CONTROL_PANEL_",t.DataGridLoadingComponent=Mt,t.DatagridBodyComponent=xt,t.DatagridCellComponent=Dt,t.DatagridCellEditableDirective=_t,t.DatagridCellEditorDirective=gt,t.DatagridColumnDirective=ft,t.DatagridComponent=bt,t.DatagridFacadeService=K,t.DatagridFilterService=nt,t.DatagridFilterToolbarComponent=ie,t.DatagridFooterComponent=jt,t.DatagridHeaderComponent=Tt,t.DatagridModule=fe,t.DatagridPagerComponent=At,t.DatagridResizeColumnDirective=Lt,t.DatagridRowDblClickDirective=ae,t.DatagridRowDirective=It,t.DatagridRowHoverDirective=Et,t.DatagridRowsComponent=Ot,t.DatagridService=Z,t.DatagridSmartFilterComponent=Ct,t.DatagridSmartFilterModule=St,t.DatagridSmartFilterService=wt,t.DatagridUtils=U,t.DomHandler=it,t.DragColumnDirective=he,t.DragDropColumnService=de,t.DropColumnDirective=ue,t.FIXED_LEFT_SHADOW_CLS=j,t.FIXED_RIGHT_SHADOW_CLS="f-datagrid-fixed-right-shadow",t.FilterRowCreateDirective=Ht,t.FooterCellStylerDirective=ce,t.GRID_EDITORS=k,t.GRID_FILTER_ROW=D,t.GRID_SETTINGS_HTTP=P,t.GRID_SETTINGS_PANEL=_,t.GRID_SETTINGS_SERVICE=O,t.GRID_VALIDATORS=F,t.GridCellEditorDirective=kt,t.GroupFooterRowStylerDirective=pe,t.HeaderStyleDirective=ne,t.NgxPaginationModule=rt,t.PagerSelectedListComponent=zt,t.PaginationService=ot,t.ROW_HOVER_CLS="f-datagrid-row-hover",t.ROW_SELECTED_CLS="f-datagrid-row-selected",t.RestService=J,t.SCROLLBAR_CONFIG=st,t.SCROLL_DOWN_ACTION="psScrollDown",t.SCROLL_LEFT_ACTION="psScrollLeft",t.SCROLL_RIGHT_ACTION="psScrollRight",t.SCROLL_UP_ACTION="psScrollUp",t.SCROLL_X_ACTION=T,t.SCROLL_X_REACH_END_ACTION=H,t.SCROLL_X_REACH_START_ACTION=L,t.SCROLL_Y_ACTION="psScrollY",t.SCROLL_Y_REACH_END_ACTION="psYReachEnd",t.SCROLL_Y_REACH_START_ACTION="psYReachStart",t.SIZE_TYPE=z,t.ScrollbarComponent=ut,t.ScrollbarDirective=ht,t.ScrollbarModule=pt,t.SelectedItemPipe=Gt,t.SmartFilterToolbarComponent=mt,t.TR_ID_PREFIX="#row_",t.TR_PREFIX="row_",t.TextboxEditorComponent=Pt,t.ValidatorMessagerService=et,t.defaultPaginationInfo={enable:!0,pageIndex:1,pageSize:10},t.ɵa=Ft,t.ɵb=Rt,t.ɵc=$t,t.ɵd=qt,t.ɵe=Kt,t.ɵf=Jt,t.ɵg=Ut,t.ɵh=Zt,t.ɵi=Qt,t.ɵj=ee,t.ɵk=Xt,t.ɵl=Wt,t.ɵm=Bt,t.ɵn=Yt,t.ɵo=te,t.ɵp=re,t.ɵq=oe,t.ɵr=se,t.ɵs=Nt,t.ɵt=Vt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-datagrid.umd.min.js.map