{"version":3,"sources":["ng://@farris/discussion-group/lib/discussion-group.service.ts","ng://@farris/discussion-group/lib/discussion-list/discussion-list.service.ts","ng://@farris/discussion-group/lib/discussion-list/discussion-list.component.ts","node_modules/tslib/tslib.es6.js","ng://@farris/discussion-group/lib/discussion-editor/discussion-editor.interface.ts","ng://@farris/discussion-group/lib/discussion-editor/discussion-editor.component.ts","ng://@farris/discussion-group/lib/discussion-personnel/discussion-personnel.component.ts","ng://@farris/discussion-group/lib/discussion-list/discussionList.directive.ts","ng://@farris/discussion-group/lib/pipe/safe-html.pipe.ts","ng://@farris/discussion-group/lib/pipe/controlType.pipe.ts","ng://@farris/discussion-group/lib/discussion-group.module.ts"],"names":["DiscussionGroupService","Injectable","args","providedIn","DiscussionListService","prototype","resetData","data","results","commentIds","length","forEach","commentId","item","find","comment","id","userId","userName","imgData","hasOwnProperty","commentDate","text","attachFiles","parentData","parentItem","i","parentId","thisData","push","this","resultDiscussion","next","getData","BehaviorSubject","DiscussionListComponent","Object","defineProperty","_total","val","initPaginationOptions","_pageSize","_discussionData","innerDiscussionData","ngOnInit","_this","discussionListService","subscribe","paginationOptions","itemsPerPage","currentPage","pageIndex","totalItems","reply","replyMessage","emit","onPageChange","page","pageChanged","pageInfo","onPageSizeChange","pageSize","total","pageLength","Math","floor","pageSizeChanged","filePreviewEventHandler","info","filePreview","fileDownloadEventHandler","fileDownload","getAvatar","personnelsDisplayKey","str","substring","Component","selector","template","encapsulation","ViewEncapsulation","None","Input","Output","ViewChild","supportPaging","EventEmitter","labels","previousLabel","nextLabel","directionLinks","maxSize","responsive","autoHide","__assign","assign","t","s","n","arguments","p","call","apply","__read","o","m","Symbol","iterator","r","e","ar","done","value","error","__spread","concat","Cancel","Confirm","DiscussionEditorComponent","_personnels","innerPersonnels","copyPersonnels","_replyUser","editorFocus","_attachFiles","self","renderer","listen","document","event","personModalVisible","relativeVisible","el","elementRef","nativeElement","permissionList","localeService","getValue","permission","options","maxUploads","maxFileSize","allowedContentTypes","placeholder","fUploadDoneHandler","ev","fileUploadDone","fUploadRemovedHandler","console","log","fileRemoveEventHandler","file","fileRemove","setTextValue","tempTextValue","target","innerHTML","textValue","tempPersonnelsValue","tempSectionValue","listenEditorValueChange","children","childrenId","selectedPersonnels","personnel","index","includes","personnelsPrimaryKey","splice","selectedSection","section","serachPersonnel","personnelText","showSearchList","getSearchData","d","searchPersonnelList","setPersonModalPosition","getMoreSearchData","personSearchUrl","url","http","get","of","personnelChecked","active","map","cd","markForCheck","appendPersonnels","selectedList","filter","appendPersonnel","resetPersonnels","appendPersonnelsList","listData","external","_isInArray","appendSectionList","appendSection","fieldInArray","array","findIndex","openModalPerson","setTimeout","stopBubble","window","innerHeight","personModal","getBoundingClientRect","bottom","scrollIntoView","openModalPermission","openModalFile","attachFilesModalVisible","stopPropagation","cancelBubble","submitApproval","editAttachFiles","attachFile","name","size","metadataId","valueChange","msgInfo","MsgInfo","mailTos","mailToSections","visibility","replyUser","notEmptyText","notifyService","cancel","changePermission","editor","focus","selectionsChangePar","users","userList_1","user","sectionList_1","sec","selectionsChange","lineDataChangePar","lineDataChange","ougUsers","getOugUsers","Renderer2","ElementRef","ChangeDetectorRef","NotifyService","Injector","HttpClient","injector","replyPersonnelsDisplayKey","cancelVisible","editHeight","type","personnelSearch","groupIcon","LocaleService","DiscussionPersonnelComponent","allOrg","sectionDataTrees","initSectionData","sectionData","sectionParent","code","layer","sortOrder","path","personnels","count","pageCount","totalCount","parent","parents","parentsArr","checked","sort","a","b","initSectionTree","sectionDataTree","sectionDataTiled","tileSectionData","currentSection","sectionCrumbs","currentSectionData","currentSectionId","getPersonnel","currentSectionPerson","selectEmployee","parentName","par","unshift","parentIdField","idField","nodes","Map","result","unattached","node","set","PID","parent_1","pid","getAllNodes","sectionNext","JSON","stringify","getNextData","getSectionById","secChecked_1","secParent","secCrumbs","initCrumbsList","detectChanges","ougId","orgUrl","crumbsClick","crumbs","handleClick","disabled","setSectionDataChecked","selectedData","_isSelectedInArray","listIdField","selectedUsers","addSection","removeSection","handleSearchClick","curChecked","secArray","secCheckedList","secIndeList","parSec","setChildDisabledStatus","status","getMoreData","sec_1","handleClickAll","curChecked_1","selectedSections","searchUser","searchText","searchUserList","selectionRemove","dataParent","childrens","child","parchildrens","parusers","moveAllToLeft","returnResult","numberType","finalText","personnelDialog","close","crumbsListWidth","crumbsList","offsetWidth","crumbsListItems","crumbsListItemWidth","setStyle","crumbsEllipsis","crumbsMore","field","Error","closeDialog","NgZone","ngZone","listDisplayText","openDialog","selections","DiscussionListDirective","_discussionListData","Directive","SafeHtmlPipe","transform","sanitized","bypassSecurityTrustHtml","Pipe","DomSanitizer","AvatarHtmlPipe","GetOrgTextPipe","orgs","org","orgtext","common","registerLocaleData","zh","DiscussionGroupModule","NgModule","declarations","imports","CommonModule","FormsModule","ModalModule","FarrisDialogModule","FarrisCommonModule","LoadingModule","PerfectScrollbarModule","TreeModule","PaginationModule","FFileUploadModule","NotifyModule","HttpClientModule","LocaleModule","forRoot","InputGroupModule","providers","BsModalService","ComponentLoaderFactory","PositioningService","exports","entryComponents"],"mappings":"0qDAAA,IAAAA,uBAECC,EAAAA,WAAUC,KAAA,CAAC,CACVC,WAAY,uJAIZ,SAAAH,KCPF,IAAAI,GAWIA,EAAAC,UAAAC,UAAA,SAAUC,OACFC,EAAU,GACVD,GAAQA,EAAKE,YAAcF,EAAKE,WAAWC,QAC3CH,EAAKE,WAAWE,QAAO,SAACC,OACdC,EAAON,EAAe,SAAEO,KAAI,SAAEC,GAChC,OAAOA,EAAY,KAAMH,IAE7B,GAAIC,EAAJ,KACQG,EAAKH,EAAS,GACdI,EAASJ,EAAa,OACtBK,EAAWL,EAAW,KAAQ,KAE9BM,EAAUN,EAAW,KAAEO,eAAe,WAAaP,EAAW,KAAW,QAAI,GAC7EQ,EAAcR,EAAkB,YAEhCS,EAAOT,EAAW,KAClBU,EAAcV,EAAKO,eAAe,eAAiBP,EAAkB,YAAI,GACzEW,OAAU,EACd,GAAIX,EAAKO,eAAe,YAAa,KAC7BK,EAAalB,EAAe,SAAEO,KAAI,SAACY,GACnC,OAAOA,EAAEV,KAAOH,EAAKc,WAErBF,IASAD,EAAa,CACTR,GATQS,EAAe,GAUvBR,OATYQ,EAAmB,OAU/BP,SATcO,EAAiB,KAAQ,KAUvCN,QARaM,EAAiB,KAAEL,eAAe,WAAaK,EAAiB,KAAW,QAAI,GAS5FJ,YARiBI,EAAwB,YASzCH,KARUG,EAAiB,KAS3BF,YARiBE,EAAWL,eAAe,eAAiBK,EAAwB,YAAI,SAYhGG,EAA6B,CAC7BZ,GAAEA,EACFC,OAAMA,EACNC,SAAQA,EACRC,QAAOA,EACPE,YAAWA,EACXC,KAAIA,EACJC,YAAWA,EACXC,WAAUA,GAEdhB,EAAQqB,KAAKD,MAQzBE,KAAKC,iBAAiBC,KAAKxB,IAE/BJ,EAAAC,UAAA4B,QAAA,WACI,OAAOH,KAAKC,sCAtEnB9B,EAAAA,mDAwEDG,GAnEI,SAAAA,IAFA0B,KAAAC,iBAAyC,IAAIG,EAAAA,gBAAqB,MCPtE,IAAAC,GAiCIC,OAAAC,eAAIF,EAAA9B,UAAA,QAAK,KAAT,WACI,OAAOyB,KAAKQ,YAEhB,SAAmBC,GACjBT,KAAKQ,OAASC,EAEdT,KAAKU,yDAOPJ,OAAAC,eAAIF,EAAA9B,UAAA,WAAQ,KAAZ,WACI,OAAOyB,KAAKW,eAEhB,SAAsBF,GACpBT,KAAKW,UAAYF,EAEjBT,KAAKU,yDAqBPJ,OAAAC,eACIF,EAAA9B,UAAA,iBAAc,KAMlB,WACE,OAAOyB,KAAKY,qBARd,SACmBH,GACdA,IACDT,KAAKY,gBAAkBH,EACvBT,KAAKa,oBAAsBJ,oCA2B/BJ,EAAA9B,UAAAuC,SAAA,WAAA,IAAAC,EAAAf,KAQEA,KAAKU,wBAELV,KAAKgB,sBAAsBb,UAAUc,UAAS,SAAExC,GAC3CA,IAASsC,EAAKH,gBAAgBhC,SAC/BmC,EAAKF,oBAAsBpC,MAIjC4B,EAAA9B,UAAAmC,sBAAA,WACEV,KAAKkB,kBAAoB,CACvBhC,GAAI,+BACJiC,aAAcnB,KAAKW,UACnBS,YAAapB,KAAKqB,UAElBC,WAAYtB,KAAKQ,SAIrBH,EAAA9B,UAAAgD,MAAA,SAAMxC,GACJiB,KAAKwB,aAAaC,KAAK1C,IAGzBsB,EAAA9B,UAAAmD,aAAA,SAAaC,GACP3B,KAAKqB,YAAcM,EAAKN,YACxBrB,KAAKqB,UAAYM,EAAKN,UACtBrB,KAAKkB,kBAAkBE,YAAcO,EAAKN,UAC1CrB,KAAK4B,YAAYH,KAAK,CAAEI,SAAUF,MAIxCtB,EAAA9B,UAAAuD,iBAAA,SAAiBC,GACb,GAAI/B,KAAK+B,WAAaA,GAAY/B,KAAKgC,MAAO,CAC1ChC,KAAKkB,kBAAkBC,aAAeY,EACtC/B,KAAK+B,SAAWA,MAEVC,EAAQhC,KAAKgC,MACfC,EAAaC,KAAKC,MAAMH,EAAQD,GACb,EAAnBC,EAAQD,IACRE,GAAc,GAGdA,GAAcjC,KAAKqB,UAAYY,IAC/BjC,KAAKqB,UAAYY,EACjBjC,KAAKkB,kBAAkBE,YAAcpB,KAAKqB,WAG9CrB,KAAKoC,gBAAgBX,KAAK,CAAEI,SAAU,CAAER,UAAWrB,KAAKqB,UAAWU,SAAUA,OAIrF1B,EAAA9B,UAAA8D,wBAAA,SAAwBC,GACtBtC,KAAKuC,YAAYd,KAAKa,IAGxBjC,EAAA9B,UAAAiE,yBAAA,SAAyBF,GACvBtC,KAAKyC,aAAahB,KAAKa,IAGzBjC,EAAA9B,UAAAmE,UAAA,SAAU3D,GACR,GAAGA,GAAQA,EAAKiB,KAAK2C,sBAAsB,KACrCC,EAAM7D,EAAKiB,KAAK2C,sBACpB,OAAOC,EAAIC,UAAUD,EAAIhE,OAAO,EAAEgE,EAAIhE,QAGpC,MAAO,wBA5KhBkE,EAAAA,UAAS1E,KAAA,CAAC,CACT2E,SAAU,yBACVC,SAAA,m3JAEAC,cAAeC,EAAAA,kBAAkBC,8/HAN1B7E,mDAUJ8E,EAAAA,6BAGAA,EAAAA,yBAIAA,EAAAA,qBAiBAA,EAAAA,wBAaAA,EAAAA,8BAwBAA,EAAAA,4BAUAC,EAAAA,4BAEAA,EAAAA,gCACAA,EAAAA,4BAGAA,EAAAA,6BAEAA,EAAAA,sBAUAC,EAAAA,UAASlF,KAAA,CAAC,YA+EfiC,GA7EI,SAAAA,EAAqBW,GAAAhB,KAAAgB,sBAAAA,EA3FZhB,KAAA2C,qBAA+B,WAG/B3C,KAAAuD,eAAwB,EAIxBvD,KAAAqB,UAAmB,EAapBrB,KAAAQ,OAAS,EAaTR,KAAAW,UAAY,GA0BpBX,KAAAa,oBAAsB,GACtBb,KAAAY,gBAAkB,GAWRZ,KAAAwB,aAAe,IAAIgC,EAAAA,aAEnBxD,KAAA4B,YAAc,IAAI4B,EAAAA,aAClBxD,KAAAoC,gBAAkB,IAAIoB,EAAAA,aAGtBxD,KAAAuC,YAAc,IAAIiB,EAAAA,aAElBxD,KAAAyC,aAAe,IAAIe,EAAAA,aACtBxD,KAAAyD,OAAc,CACjBC,cAAe,IACfC,UAAW,KAER3D,KAAA4D,gBAAiB,EACjB5D,KAAA6D,QAAU,EACV7D,KAAA8D,YAAa,EACb9D,KAAA+D,UAAW,ECtEf,IAAIC,EAAW,WAQlB,OAPAA,EAAW1D,OAAO2D,QAAU,SAAkBC,GAC1C,IAAK,IAAIC,EAAGvE,EAAI,EAAGwE,EAAIC,UAAUzF,OAAQgB,EAAIwE,EAAGxE,IAE5C,IAAK,IAAI0E,KADTH,EAAIE,UAAUzE,GACOU,OAAO/B,UAAUe,eAAeiF,KAAKJ,EAAGG,KAAIJ,EAAEI,GAAKH,EAAEG,IAE9E,OAAOJ,IAEKM,MAAMxE,KAAMqE,YAGhC,SA+EgBI,EAAOC,EAAGN,GACtB,IAAIO,EAAsB,mBAAXC,QAAyBF,EAAEE,OAAOC,UACjD,IAAKF,EAAG,OAAOD,EACf,IAAmBI,EAAYC,EAA3BnF,EAAI+E,EAAEJ,KAAKG,GAAOM,EAAK,GAC3B,IACI,WAAc,IAANZ,GAAsB,EAANA,QAAcU,EAAIlF,EAAEM,QAAQ+E,MAAMD,EAAGjF,KAAK+E,EAAEI,OAExE,MAAOC,GAASJ,EAAI,CAAEI,MAAOA,WAEzB,IACQL,IAAMA,EAAEG,OAASN,EAAI/E,EAAU,YAAI+E,EAAEJ,KAAK3E,WAExC,GAAImF,EAAG,MAAMA,EAAEI,OAE7B,OAAOH,EAGX,SAAgBI,IACZ,IAAK,IAAIJ,EAAK,GAAIpF,EAAI,EAAGA,EAAIyE,UAAUzF,OAAQgB,IAC3CoF,EAAKA,EAAGK,OAAOZ,EAAOJ,UAAUzE,KACpC,OAAOoF,SC1HPM,OAAA,EACAC,QAAA,sDC0BAjF,OAAAC,eAAIiF,EAAAjH,UAAA,aAAU,KAAd,WACI,OAAOyB,KAAKyF,iBAEhB,SAAwBhF,GAChBA,IACAT,KAAKyF,YAAchF,EACnBT,KAAK0F,gBAAkB1F,KAAKyF,YAC5BzF,KAAK2F,eAAiB3F,KAAKyF,8CAQnCnF,OAAAC,eAAIiF,EAAAjH,UAAA,YAAS,KAAb,WACI,OAAOyB,KAAK4F,gBAEhB,SAAuBnF,GACfA,IACAT,KAAK4F,WAAanF,EACfT,KAAK4F,WAAe,IACnB5F,KAAK6F,gDAMjBvF,OAAAC,eAAIiF,EAAAjH,UAAA,cAAW,KAAf,WACI,OAAOyB,KAAK8F,kBAEhB,SAAyBrF,GACjBA,IACAT,KAAK8F,aAAerF,oCAiE5B+E,EAAAjH,UAAAuC,SAAA,eACUiF,EAAO/F,KACbA,KAAKgG,SAASC,OAAOC,SAAU,QAAO,SAAYC,GAC9CJ,EAAKK,oBAAqB,EAC1BL,EAAKM,iBAAkB,IAG3BrG,KAAKsG,GAAKtG,KAAKuG,WAAWC,cAC1BxG,KAAKyG,eAAiB,CAClB,CAAEvB,MAAO,MAAO1F,KAAMQ,KAAK0G,cAAcC,SAAS,wBAClD,CAAEzB,MAAO,UAAW1F,KAAMQ,KAAK0G,cAAcC,SAAS,6BAE1D3G,KAAK4G,WAAa5G,KAAKyG,eAAe,GACtCzG,KAAK6G,QAAU,CAAEC,WAAY,EAAGC,YAAa,MAAOC,oBAAqB,CAAC,OAAQ,SAClFhH,KAAKiH,YAAcjH,KAAK0G,cAAcC,SAAS,gCAOnDnB,EAAAjH,UAAA2I,mBAAA,SAAmBC,GACfnH,KAAKoH,eAAe3F,KAAK0F,IAM7B3B,EAAAjH,UAAA8I,sBAAA,SAAsBF,GAClBG,QAAQC,IAAI,yBACZD,QAAQC,IAAIJ,IAGhB3B,EAAAjH,UAAA8D,wBAAA,SAAwBC,GACpBtC,KAAKuC,YAAYd,KAAKa,IAG1BkD,EAAAjH,UAAAiJ,uBAAA,SAAuBC,GACnBzH,KAAK0H,WAAWjG,KAAKgG,IAIzBjC,EAAAjH,UAAAoJ,aAAA,SAAa5C,QAAA,IAAAA,IAAAA,EAAA,MACLA,IAEA/E,KAAK4H,cAAgB7C,EAAE8C,OAAOC,UAC9B9H,KAAK+H,UAAY/H,KAAK4H,eAKtB5H,KAAKgI,sBACLhI,KAAK+H,WAAa/H,KAAKgI,qBAExBhI,KAAKiI,mBACJjI,KAAK+H,WAAa/H,KAAKiI,kBAE3BjI,KAAK4H,cAAgB,GACrB5H,KAAKgI,oBAAsB,GAC3BhI,KAAKiI,iBAAmB,IAI5BzC,EAAAjH,UAAA2J,wBAAA,SAAwBnD,GAAxB,IAAAhE,EAAAf,KACIA,KAAK4H,cAAgB7C,EAAE8C,OAAOC,UAG9B,QAFMK,EAAWpD,EAAE8C,OAAOM,SACpBC,EAAa,GACVxI,EAAI,EAAGA,EAAIuI,EAASvJ,OAAQgB,IACjCwI,EAAWrI,KAAKoI,EAASvI,GAAGV,IAEhCc,KAAKqI,mBAAmBxJ,QAAO,SAAEyJ,EAAWC,GACnCH,EAAWI,SAASF,EAAUvH,EAAK0H,wBACpC1H,EAAKsH,mBAAmBK,OAAOH,EAAO,KAG9CvI,KAAK2I,gBAAgB9J,QAAO,SAAE+J,EAASL,GAC9BH,EAAWI,SAASI,EAAQ7H,EAAK0H,wBAClC1H,EAAK4H,gBAAgBD,OAAOH,EAAO,KAGtCvI,KAAK4H,gBACN5H,KAAK4H,cAAgB,KAO7BpC,EAAAjH,UAAAsK,gBAAA,WAAA,IAAA9H,EAAAf,KAWOA,KAAK8I,eACJ9I,KAAK+I,gBAAiB,EACtB/I,KAAKgJ,cAAchJ,KAAK8I,cAAc,GAAG7H,UAAS,SAACgI,GAC5CA,EAAE3J,eAAe,WAChByB,EAAKmI,oBAAsBD,EAC3BlI,EAAKoI,6BAKbnJ,KAAK+I,gBAAiB,GAS9BvD,EAAAjH,UAAA6K,kBAAA,WAAA,IAAArI,EAAAf,KACIA,KAAKgJ,cAAchJ,KAAK8I,cAAc9I,KAAKkJ,oBAAoB7H,UAAY,GAAGJ,UAAS,SAACgI,GACjFA,EAAE3J,eAAe,WAChByB,EAAKmI,oBAAoB7H,UAAY4H,EAAa,UAClDlI,EAAKmI,oBAA2B,MAAC9D,EAAOrE,EAAKmI,oBAA2B,MAAKD,EAAS,WAKlGzD,EAAAjH,UAAAyK,cAAA,SAAcxJ,EAAY6B,EAAiBU,GACvC,QADuC,IAAAA,IAAAA,EAAkB/B,KAAK+B,UAC3D/B,KAAKqJ,gBAAgB,KACdC,EAAStJ,KAAKqJ,gBAAe,UAAU7J,EAAI,aAAauC,EAAQ,cAAcV,EAEpF,OAAOrB,KAAKuJ,KAAKC,IAAIF,GAIrB,OAAOG,EAAAA,IAAG,IAIlBjE,EAAAjH,UAAAmL,iBAAA,SAAiB3K,GACbA,EAAK4K,QAAU5K,EAAK4K,OACpB3J,KAAK0F,gBAAkB1F,KAAK0F,gBAAgBkE,IAAG,SAAClF,GAAK,OAAAV,EAAA,GAAMU,KAC3D1E,KAAK6J,GAAGC,eACR9J,KAAK+J,oBAITvE,EAAAjH,UAAAwL,iBAAA,eACQC,EAAe,IAKfA,EAJAhK,KAAK+I,eAIU/I,KAAKkJ,oBAA2B,MAAEe,OAAM,SAAClL,GAAQ,OAAgB,IAAhBA,EAAK4K,SAHtD3J,KAAK0F,gBAAgBuE,OAAM,SAAClL,GAAQ,OAAgB,IAAhBA,EAAK4K,UAK3C/K,QACboB,KAAKkK,gBAAgBF,GAEzBhK,KAAKmK,kBACLnK,KAAK2H,eACL3H,KAAKoG,oBAAqB,GAG9BZ,EAAAjH,UAAA6L,qBAAA,SAAqBC,GACbA,EAASzL,QACToB,KAAKkK,gBAAgBG,GAAU,GAGnCrK,KAAK2H,gBAGTnC,EAAAjH,UAAA2L,gBAAA,SAAgBG,EAAUC,GAA1B,IAAAvJ,EAAAf,UAA0B,IAAAsK,IAAAA,GAAA,GACtBD,EAASxL,QAAO,SAACE,GACTgC,EAAKsH,mBAAmBzJ,QAAUmC,EAAKwJ,WAAWxL,EAAKgC,EAAK0H,sBAAuB1H,EAAK0H,qBAAsB1H,EAAKsH,sBAInHtH,EAAKiH,qBAAuB,mEAAqEjJ,EAAKgC,EAAK0H,sBAAwB,aAAe1J,EAAKgC,EAAK0H,sBAAwB,MAAQ1J,EAAKgC,EAAK4B,sBAAwB,aAK9N5B,EAAKsH,mBAAmBtI,KAAKhB,OAQzCyG,EAAAjH,UAAAiM,kBAAA,SAAkBH,GACXA,EAASzL,QACRoB,KAAKyK,cAAcJ,GAEvBrK,KAAK2H,gBAGTnC,EAAAjH,UAAAkM,cAAA,SAAcJ,GAAd,IAAAtJ,EAAAf,KACIqK,EAASxL,QAAO,SAACE,GACTgC,EAAK4H,gBAAgB/J,QAAUmC,EAAKwJ,WAAWxL,EAAKgC,EAAK0H,sBAAuB1H,EAAK0H,qBAAsB1H,EAAK4H,mBAEhH5H,EAAKkH,kBAAoB,4DAA8DlJ,EAAKgC,EAAK0H,sBAAwB,YAAc1J,EAAKgC,EAAK0H,sBAAwB,MAAQ1J,EAAW,KAAI,aAChMgC,EAAK4H,gBAAgB5I,KAAKhB,OAO9ByG,EAAAjH,UAAAgM,WAAR,SAAmBrF,EAAYwF,EAAsBC,GACjD,SAAKzF,IAAUwF,KAGmD,IAA3DC,EAAMC,UAAS,SAAC7L,GAAQ,OAAAmG,IAAUnG,EAAK2L,MAMlDlF,EAAAjH,UAAA4L,gBAAA,WACInK,KAAK+I,gBAAiB,EACtB/I,KAAKoG,oBAAqB,EAC1BpG,KAAK0F,gBAAkB1F,KAAK2F,eACzB3F,KAAK0F,gBAAgB9G,QACpBoB,KAAK0F,gBAAgB7G,QAAO,SAACE,GAAQ,OAAAA,EAAK4K,QAAS,IAEvD3J,KAAK8I,cAAgB,IAQzBtD,EAAAjH,UAAAsM,gBAAA,SAAgB9F,GAAhB,IAAAhE,EAAAf,KACIA,KAAKoG,oBAAsBpG,KAAKoG,mBAChC0E,WAAU,WACH/J,EAAKqF,oBACJrF,EAAKoI,0BAEV,GAEHnJ,KAAK+K,WAAWhG,IAEpBS,EAAAjH,UAAA4K,uBAAA,WACe6B,OAAOC,YACAjL,KAAKkL,YAAY1E,cAAc2E,wBAAwBC,QAErEpL,KAAKkL,YAAY1E,cAAc6E,gBAAe,IAGtD7F,EAAAjH,UAAA+M,oBAAA,SAAoBvG,GAChB/E,KAAKqG,iBAAmBrG,KAAKqG,gBAC7BrG,KAAK+K,WAAWhG,IAMpBS,EAAAjH,UAAAgN,cAAA,SAAcxG,GACV/E,KAAKwL,yBAA2BxL,KAAKwL,wBACrCxL,KAAK+K,WAAWhG,IAIpBS,EAAAjH,UAAAwM,WAAA,SAAWhG,GACHA,GAAKA,EAAE0G,gBACP1G,EAAE0G,kBAEFT,OAAO7E,MAAMuF,cAAe,GAOpClG,EAAAjH,UAAAoN,eAAA,WACI,GAAK3L,KAAK+H,UAAV,KAOI6D,EAAoC,GACpC5L,KAAKP,aAAeO,KAAKP,YAAYb,QACrCoB,KAAKP,YAAYZ,QAAO,SAAC4I,OAKjBoE,EAAa,CACb3M,GALKuI,EAAS,GAMdqE,KALOrE,EAAW,KAMlBsE,KALOtE,EAAW,KAMlBuE,WALavE,EAAa,OAAc,YAO5CmE,EAAgB7L,KAAK8L,KAG7B7L,KAAKiM,YAAYxK,KAAK,CAClByK,QAASC,EAAQ5G,QACjB/F,KAAMQ,KAAK+H,UACXqE,QAASpM,KAAKqI,mBACdgE,eAAgBrM,KAAK2I,gBACrB2D,WAAYtM,KAAK4G,WAAW1B,MAC5BrF,SAAWG,KAAKuM,WAAavM,KAAKuM,UAAUjN,eAAe,MAASU,KAAKuM,UAAUrN,GAAK,KACxFO,YAAamM,EAAgBhN,OAASgN,EAAkB,OAE5D5L,KAAK+H,UAAY,GACjB/H,KAAKqI,mBAAqB,GAC1BrI,KAAK2I,gBAAkB,GACvB3I,KAAKP,YAAc,GACnBO,KAAKuM,UAAY,OApCjB,KACQC,EAAexM,KAAK0G,cAAcC,SAAS,4BAC5C6F,GACCxM,KAAKyM,cAActH,MAAMqH,KAoCrChH,EAAAjH,UAAAmO,OAAA,WACI1M,KAAKiM,YAAYxK,KAAK,CAClByK,QAASC,EAAQ7G,OACjB9F,KAAM,KACN4M,QAAS,GACTC,eAAgB,GAChBC,WAAY,KACZzM,SAAU,KACVJ,YAAa,OAEjBO,KAAK+H,UAAY,GACjB/H,KAAKqI,mBAAqB,GAC1BrI,KAAK2I,gBAAkB,GACvB3I,KAAKP,YAAc,GACnBO,KAAKuM,UAAY,IAGrB/G,EAAAjH,UAAAoO,iBAAA,SAAiBzH,GACblF,KAAK4G,WAAa5G,KAAKyG,eAAezH,KAAI,SAACD,GAAQ,OAAAA,EAAKmG,QAAUA,IAClElF,KAAKqG,iBAAkB,GAG3Bb,EAAAjH,UAAAsH,YAAA,WACI7F,KAAK4M,OAAOpG,cAAcqG,SAQ9BrH,EAAAjH,UAAAuO,oBAAA,SAAoB3G,GAEhB,GAAGA,EAAM1H,KAAKsO,MAAMnO,OAAO,KACnBoO,EAAW,GACf7G,EAAM1H,KAAKsO,MAAMlO,QAAO,SAACoO,GACrBD,EAASjN,KAAKkN,EAAKxO,QAEvBuB,KAAKoK,qBAAqB4C,GAE9B,GAAG7G,EAAM1H,KAAKmK,QAAQhK,OAAO,KACrBsO,EAAc,GAClB/G,EAAM1H,KAAKmK,QAAQ/J,QAAO,SAACsO,GACvBD,EAAYnN,KAAKoN,EAAI1O,QAEzBuB,KAAKwK,kBAAkB0C,GAE3BlN,KAAKoN,iBAAiB3L,KAAK0E,IAG/BX,EAAAjH,UAAA8O,kBAAA,SAAkBlH,GACdnG,KAAKsN,eAAe7L,KAAK0E,IAG7BX,EAAAjH,UAAAmE,UAAA,SAAU3D,GACN,GAAIA,GAAQA,EAAKiB,KAAK2C,sBAAuB,KACrCC,EAAM7D,EAAKiB,KAAK2C,sBACpB,OAAOC,EAAIC,UAAUD,EAAIhE,OAAS,EAAGgE,EAAIhE,QAGzC,MAAO,IAIf4G,EAAAjH,UAAAgP,SAAA,SAASpH,GACLnG,KAAKwN,YAAY/L,KAAK0E,wBAngB7BrD,EAAAA,UAAS1E,KAAA,CAAC,CACP2E,SAAU,2BACVC,SAAA,09UAEAC,cAAeC,EAAAA,kBAAkBC,ohmBAZqBsK,EAAAA,iBAAZC,EAAAA,kBAAgEC,EAAAA,yBAErGC,EAAAA,qBAFwHC,EAAAA,gBAKxHC,EAAAA,4DAUJ1K,EAAAA,oCACAA,EAAAA,yCACAA,EAAAA,6BAMAA,EAAAA,0BACAA,EAAAA,oBAEAA,EAAAA,sBACAA,EAAAA,+BACAA,EAAAA,2BAIAA,EAAAA,+BACAA,EAAAA,2BACAA,EAAAA,0BAaAA,EAAAA,yBAeAA,EAAAA,2BAaAA,EAAAA,gCASAC,EAAAA,+BAEAA,EAAAA,4BAEAA,EAAAA,4BAEAA,EAAAA,2BAEAA,EAAAA,+BACAA,EAAAA,gCACAA,EAAAA,4BACAA,EAAAA,uBACAC,EAAAA,UAASlF,KAAA,CAAC,+BACVkF,EAAAA,UAASlF,KAAA,CAAC,kBA4afoH,GA1YI,SAAAA,EACYQ,EACAO,EACAsD,EACA4C,EACAsB,EACAxE,GALAvJ,KAAAgG,SAAAA,EACAhG,KAAAuG,WAAAA,EACAvG,KAAA6J,GAAAA,EACA7J,KAAAyM,cAAAA,EACAzM,KAAA+N,SAAAA,EACA/N,KAAAuJ,KAAAA,EA1HHvJ,KAAAyI,qBAA+B,KAC/BzI,KAAA2C,qBAA+B,OAC/B3C,KAAAgO,0BAAoC,WAMpChO,KAAAiO,eAAyB,EACzBjO,KAAAkO,WAAqB,IAErBlO,KAAAmO,KAAe,OAgBhBnO,KAAAyF,YAA0B,GA0CxBzF,KAAAoN,iBAAmB,IAAI5J,EAAAA,aAEvBxD,KAAAsN,eAAiB,IAAI9J,EAAAA,aAErBxD,KAAAiM,YAAc,IAAIzI,EAAAA,aAElBxD,KAAAuC,YAAc,IAAIiB,EAAAA,aAElBxD,KAAA0H,WAAa,IAAIlE,EAAAA,aACjBxD,KAAAoH,eAAiB,IAAI5D,EAAAA,aACrBxD,KAAAoO,gBAAkB,IAAI5K,EAAAA,aACtBxD,KAAAwN,YAAc,IAAIhK,EAAAA,aAK5BxD,KAAA+H,UAAoB,GAIpB/H,KAAAgI,oBAA8B,GAE9BhI,KAAAiI,iBAA2B,GAE3BjI,KAAAoG,oBAAqB,EAErBpG,KAAAqI,mBAAiC,GAEjCrI,KAAA2I,gBAA8B,GAI9B3I,KAAA2F,eAA6B,GAC7B3F,KAAA0F,gBAA8B,GAI9B1F,KAAAqG,iBAA2B,EAG3BrG,KAAAwL,yBAA0B,EAC1BxL,KAAA+B,SAAkB,GAClB/B,KAAAkJ,oBAA0B,GAC1BlJ,KAAA+I,gBAAyB,EACzB/I,KAAAyG,eAA6B,GAE7BzG,KAAAqO,UAAY,6CASRrO,KAAK0G,cAAgB1G,KAAK+N,SAASvE,IAAI8E,EAAAA,sBCpE3CC,EAAAhQ,UAAAuC,SAAA,WAAA,IAAAC,EAAAf,KAEIA,KAAKwO,OAASxO,KAAK0G,cAAcC,SAAS,8BACtC8H,EAAmBzO,KAAK0O,gBAAgB1O,KAAK2O,YAAY,IAGrDC,EAAgB,CAChB,CACInQ,KAAK,CACDS,GAAG,mBACH2P,KAAK,SACL/C,KAAM9L,KAAKwO,OACXM,MAAO,EACPjP,SAAU,GACVkP,UAAW,EACXC,KAAM,IAEV7G,SAAU,GACV8G,WAAW,CACPC,MAAM,EACNC,UAAU,EACV9N,UAAU,EACVU,SAAS,EACTqN,WAAW,EACXrC,MAAO,IAEXsC,OAAQ,KACRC,QAAS,GACTC,WAAa,GACbC,SAAQ,IAGhBZ,EAAc,GAAGzG,SAAWsG,EAC5BG,EAAc,GAAGzG,SAASsH,KAAI,SAAEC,EAAGC,GAAa,OAAAD,EAAEjR,KAAgB,UAAIkR,EAAElR,KAAgB,YACxFuB,KAAK4P,gBAAgBhB,EAAc,GAAGzG,UACtCnI,KAAK6P,gBAAkBjB,EAMxB5O,KAAK6P,iBAAmB7P,KAAK6P,gBAAgBjR,SAC5CoB,KAAK8P,iBAAmB9P,KAAK+P,gBAAgB/P,KAAK6P,kBAGtD7P,KAAKgQ,eAAiBhQ,KAAK6P,gBAAgB,GAC3C7P,KAAKiQ,cAAgBjQ,KAAK6P,gBAAgB,GAAG1H,SAASvJ,OAAOoB,KAAK6P,gBAAgB,GAAG1H,SAAS,GAAe,WAAE,GAC/GnI,KAAKkQ,mBAAqBlQ,KAAK6P,gBAAgB,GAAG1H,SAASvJ,OAAOoB,KAAK6P,gBAAgB,GAAG1H,SAAS,GACnGnI,KAAKmQ,iBAAmBnQ,KAAK6P,gBAAgB,GAAGpR,KAAKS,GACrDc,KAAKoQ,aAAapQ,KAAKmQ,iBAAiB,GAAGlP,UAAS,SAAEgI,GAC/CA,EAAE3J,eAAe,WAChByB,EAAK8O,gBAAgB,GAAGZ,WAAahG,EACrClI,EAAKsP,qBAAuBtP,EAAK8O,gBAAgB,GAAGZ,cAK5DjP,KAAKsQ,eAAiBtQ,KAAK0G,cAAcC,SAAS,kCAClD3G,KAAKiH,YAAcjH,KAAK0G,cAAcC,SAAS,gCAInD4H,EAAAhQ,UAAAqR,gBAAA,SAAgBnR,EAAKoB,EAA8B0Q,GAAnD,IAAAxP,EAAAf,UAAqB,IAAAH,IAAAA,EAAA,yBAA8B,IAAA0Q,IAAAA,EAAavQ,KAAKwO,QAC9D/P,GAAQA,EAAKG,QACZH,EAAKI,QAAO,SAACE,OACLyR,EAAM,CACNtR,GAAGW,EACHiM,KAAKyE,GAETxR,EAAKwQ,WAAWkB,QAAQD,GACxBzR,EAAKuQ,QAAQmB,QAAQ5Q,GAClBd,EAAKoJ,SAASvJ,QACbmC,EAAK6O,gBAAgB7Q,EAAKoJ,aAS1CoG,EAAAhQ,UAAAmQ,gBAAA,SAAgBjQ,EAAMoB,EAAU6Q,EAA4BC,QAA5B,IAAAD,IAAAA,EAAA,iBAA4B,IAAAC,IAAAA,EAAA,UAClDC,EAAQ,IAAIC,IACZC,EAAS,GACTC,EAAa,GA8CnB,OA7CGtS,GAAQA,EAAKG,SACZH,EAAKI,QAAO,SAACqF,OACH8M,EAAO,CACTvS,KAAMyF,EACNiE,SAAU,GACV8G,WAAW,GACXI,OAAQ,KACRC,QAAS,GACTC,WAAa,GACbC,SAAS,GAEPtQ,EAAKgF,EAAEyM,GACbC,EAAMK,IAAI/R,EAAI8R,OACRE,EAAMhN,EAAEwM,GACd,GAAIQ,IAAQrR,GAAoB,OAARqR,EACpBJ,EAAO/Q,KAAKiR,OACT,KACGG,EAASP,EAAMpH,IAAI0H,GAEzB,GAAIC,EAAQ,KACJX,EAAM,CACNtR,GAAGgS,EACHpF,KAAKqF,EAAO1S,KAAKqN,MAErBkF,EAAa,OAAIE,EACjBF,EAAc,QAAC5L,EAAO+L,EAAO7B,QAAO,CAAE4B,IACtCF,EAAiB,WAAC5L,EAAO+L,EAAO5B,WAAU,CAAEiB,IAC5CW,EAAOhJ,SAASpI,KAAKiR,GACrBG,EAAOhJ,SAASsH,KAAI,SAAEC,EAAGC,GAAa,OAAAD,EAAEjR,KAAgB,UAAIkR,EAAElR,KAAgB,iBAE9EsS,EAAWhR,KAAKiR,MAIzBD,EAAWnS,QACVmS,EAAWlS,QAAO,SAACuF,OACTgN,EAAMhN,EAAE3F,KAAKiS,GACbrB,EAASuB,EAAMpH,IAAI4H,GACrB/B,IACAA,EAAOlH,SAASpI,KAAKqE,GACrBiL,EAAOlH,SAASsH,KAAI,SAAEC,EAAGC,GAAa,OAAAD,EAAEjR,KAAgB,UAAIkR,EAAElR,KAAgB,gBAKvFqS,GAEXvC,EAAAhQ,UAAAwR,gBAAA,SAAgBa,OACR9L,EAAI,GAER,OADA9E,KAAKqR,YAAYT,EAAM9L,GAChBA,GAEXyJ,EAAAhQ,UAAA8S,YAAA,SAAaT,EAAO9L,GAApB,IAAA/D,EAAAf,KACI4Q,EAAM/R,QAAO,SAACuF,GACVU,EAAE/E,KAAKqE,GACHA,EAAE+D,SAASvJ,QACXmC,EAAKsQ,YAAYjN,EAAE+D,SAAUrD,MAQzCyJ,EAAAhQ,UAAA+S,YAAA,SAAY1I,GAAZ,IAAA7H,EAAAf,KAC8C,OAAvCuR,KAAKC,UAAU5I,EAAQqG,aAAyBrG,EAAQtJ,eAAe,eAyBtEU,KAAKyR,YAAY7I,IAxBjBA,EAAQqG,WAAa,CACjBC,MAAM,EACNC,UAAU,EACV9N,UAAU,EACVU,SAAS,EACTqN,WAAW,EACXrC,MAAO,IAEX/M,KAAKoQ,aAAaxH,EAAQnK,KAAKS,GAAG,GAAG+B,UAAS,SAAEgI,GACzCA,EAAE3J,eAAe,UAChBsJ,EAAQqG,WAAWC,MAAQjG,EAAS,MACpCL,EAAQqG,WAAWE,UAAYlG,EAAa,UAC5CL,EAAQqG,WAAW5N,UAAY4H,EAAa,UAC5CL,EAAQqG,WAAWlN,SAAWkH,EAAY,SAC1CL,EAAQqG,WAAWG,WAAanG,EAAc,WAC9CL,EAAQqG,WAAkB,MAAC7J,EAAOwD,EAAQqG,WAAkB,MAAKhG,EAAS,QAG1EL,EAAqB,aAAI,EAE7B7H,EAAK0Q,YAAY7I,OAW7B2F,EAAAhQ,UAAAkT,YAAA,SAAY7I,GAAZ,IAAA7H,EAAAf,KACI,GAAI4I,EAAQT,UAAYS,EAAQT,SAASvJ,QAAmD,OAAvC2S,KAAKC,UAAU5I,EAAQqG,YAAsB,KACxF9B,EAAMnN,KAAK0R,eAAe9I,EAAQnK,KAAKS,IAC7C,GAAGiO,EAAI,KACCwE,EAAaxE,EAAa,QAC9BA,EAAc,WAAIwE,EACdxE,EAAmB,gBAChBA,EAAIhF,UAAYgF,EAAIhF,SAASvJ,QAC5BuO,EAAIhF,SAAStJ,QAAO,SAACE,GACjBA,EAAc,QAAI4S,EAClB5S,EAAoB,eAAI,IAI7B6J,EAAQqG,WAAkB,OAAKrG,EAAQqG,WAAkB,MAAErQ,QAC1DgK,EAAQqG,WAAkB,MAAEpQ,QAAO,SAACoO,GAChCA,EAAc,QAAI0E,EAClB1E,EAAoB,eAAI,SAMpC2E,EAAY,CACZ1S,GAAGiO,EAAI1O,KAAKS,GACZ4M,KAAKqB,EAAI1O,KAAKqN,MAEd+F,EAASzM,EAAO+H,EAAgB,WAAC,CAACyE,IACtC5R,KAAKiQ,cAAgB9C,EAAIhF,SAASvJ,OAAOuO,EAAIhF,SAAS,GAAe,WAAE0J,EACvE7R,KAAKkQ,mBAAqB/C,EAAIhF,SAASvJ,OAAOuO,EAAIhF,SAAS,GAC3DnI,KAAKgQ,eAAiB7C,EACtBnN,KAAKmQ,iBAAmBhD,EAAI1O,KAAKS,GACjCc,KAAKqQ,qBAAuBlD,EAAI8B,WAChCnE,WAAU,WACN/J,EAAK+Q,kBACN,GAEH9R,KAAK6J,GAAGkI,qBAGR/R,KAAKqQ,qBAAuB,IAIpC9B,EAAAhQ,UAAA6R,aAAA,SAAa4B,EAAa3Q,EAAiBU,GAEvC,QAFuC,IAAAA,IAAAA,EAAkB/B,KAAK+B,UAE3D/B,KAAKiS,OAAO,KACL3I,EAAStJ,KAAKiS,OAAM,UAAUD,EAAK,aAAajQ,EAAQ,cAAcV,EAC5E,OAAOrB,KAAKuJ,KAAKC,IAAIF,GAerB,OAAOG,EAAAA,IAAG,IAKlB8E,EAAAhQ,UAAAmT,eAAA,SAAexS,GAIX,OAHcc,KAAK8P,iBAAiB9Q,KAAI,SAACmO,GACrC,OAAOA,EAAI1O,KAAKS,IAAMA,KAQ9BqP,EAAAhQ,UAAA2T,YAAA,SAAYC,GAAZ,IAAApR,EAAAf,KACI,GAAGmS,EAAOjT,IAAMc,KAAKmQ,iBAArB,KACMhD,EAAMnN,KAAK0R,eAAeS,EAAOjT,IACvCc,KAAKiQ,cAAgB9C,EAAIhF,SAASvJ,OAAOuO,EAAIhF,SAAS,GAAe,WAAE,GACvEnI,KAAKkQ,mBAAqB/C,EAAIhF,SAASvJ,OAAOuO,EAAIhF,SAAS,GAC3DnI,KAAKmQ,iBAAmBhD,EAAI1O,KAAKS,GACjCc,KAAKqQ,qBAAuBlD,EAAI8B,WAChCjP,KAAKgQ,eAAiB7C,EACtBrC,WAAU,WACN/J,EAAK+Q,kBACN,KAOPvD,EAAAhQ,UAAA6T,YAAA,SAAYjM,EAAMyC,EAAQuF,GAA1B,IAAApN,EAAAf,KACI,IAAGA,KAAKgQ,eAAeqC,SAKvB,GAJAlM,EAAMsF,kBACN7C,EAAQ4G,SAAW5G,EAAQ4G,QAC3B5G,EAAuB,eAAI,EAC3B5I,KAAKsS,wBACF1J,EAAQ4G,QAAQ,KACX+C,EAAe,CACflD,OAAOrP,KAAKgQ,eACZvR,KAAKmK,GAET,GAAW,QAARuF,EAAe,CACd,GAAInO,KAAKwS,mBAAmB5J,EAAQ5I,KAAKyS,aAAczS,KAAKyS,YAAazS,KAAK0S,eAC1E,OAGA1S,KAAK0S,cAAc3S,KAAKwS,OAGhB,WAARpE,GACJnO,KAAK2S,WAAW/J,OAIT,QAARuF,EACKnO,KAAKwS,mBAAmB5J,EAAQ5I,KAAKyS,aAAczS,KAAKyS,YAAazS,KAAK0S,gBAC1E1S,KAAK0S,cAAc7T,QAAO,SAAEE,EAAMwJ,GAC1BxJ,EAAW,KAAEgC,EAAK0R,eAAiB7J,EAAQ7H,EAAK0R,cAChD1R,EAAK2R,cAAchK,OAAOH,EAAO,KAKjC,WAAR4F,GACJnO,KAAK4S,cAAchK,IAM/B2F,EAAAhQ,UAAAsU,kBAAA,SAAkB1M,EAAM8G,GAAxB,IAAAlM,EAAAf,KAGI,GAFAmG,EAAMsF,kBACNwB,EAAKuC,SAAWvC,EAAKuC,QAClBvC,EAAKuC,QAAQ,CACZ,GAAIxP,KAAKwS,mBAAmBvF,EAAKjN,KAAKyS,aAAczS,KAAKyS,YAAazS,KAAK0S,eACvE,WAGIH,EAAe,CACflD,OAAO,KACP5Q,KAAKwO,GAETjN,KAAK0S,cAAc3S,KAAKwS,QAIxBvS,KAAKwS,mBAAmBvF,EAAKjN,KAAKyS,aAAczS,KAAKyS,YAAazS,KAAK0S,gBACvE1S,KAAK0S,cAAc7T,QAAO,SAAEE,EAAMwJ,GAC1BxJ,EAAW,KAAEgC,EAAK0R,eAAiBxF,EAAKlM,EAAK0R,cAC7C1R,EAAK2R,cAAchK,OAAOH,EAAO,MAOrDgG,EAAAhQ,UAAA+T,sBAAA,WAAA,IAAAvR,EAAAf,KACQ8S,GAAqB,EACrB3F,EAAMnN,KAAKgQ,eACX+C,EAAe,GACnB,GAAG5F,EAAIhF,UAAagF,EAAI8B,WAAkB,OAAK9B,EAAI8B,WAAkB,MAAErQ,OAAQ,KAEvEoU,GADJD,EAAWA,EAAS1N,OAAO8H,EAAIhF,SAASgF,EAAI8B,WAAkB,QAChChF,OAAM,SAAClL,GACjC,GAAGA,EAAKO,eAAe,YAAcP,EAAc,QAC/C,OAAOA,IAGXkU,EAAc9F,EAAIhF,SAAS8B,OAAM,SAAClL,GAClC,GAAGA,EAAKO,eAAe,kBAAoBP,EAAoB,cAC3D,OAAOA,IAGfiB,KAAKgQ,eAA8B,iBAAKiD,IAAeA,EAAYrU,QAChEoU,GAAkBA,EAAepU,OAC7BoU,EAAepU,QAAUmU,EAASnU,QAAUuO,EAAI8B,WAAW5N,WAAa8L,EAAI8B,WAAWE,UAAU,EAChG2D,GAAa,EAGb9S,KAAKgQ,eAA8B,eAAI,EAI3C8C,GAAa,EAEjB9S,KAAKgQ,eAAwB,QAAI8C,EAIC,EAAnC9S,KAAKgQ,eAAeV,QAAQ1Q,QAAYoB,KAAKgQ,eAA8B,eAC1EhQ,KAAKgQ,eAAeV,QAAQzQ,QAAO,SAAC2R,OAC1B0C,EAASnS,EAAK2Q,eAAelB,GAChC0C,IACCA,EAAsB,cAAInS,EAAKiP,eAA8B,kBAM7EzB,EAAAhQ,UAAA4U,uBAAA,SAAuBC,QAAA,IAAAA,IAAAA,GAAA,OACfjG,EAAMnN,KAAKgQ,gBAEZ7C,EAAIhF,UAAagF,EAAI8B,WAAkB,OAAK9B,EAAI8B,WAAkB,MAAErQ,UACnEuO,EAAIhF,SAAStJ,QAAO,SAACE,GACjBA,EAAe,SAAIqU,IAGvBjG,EAAI8B,WAAkB,MAAEpQ,QAAO,SAACoO,GAC5BA,EAAe,SAAImG,MAQ/B7E,EAAAhQ,UAAA8U,YAAA,WAAA,IAAAtS,EAAAf,KACI,GAAGA,KAAKmQ,iBAAiB,KACfmD,EAAMtT,KAAK0R,eAAe1R,KAAKmQ,kBAClCmD,GACCtT,KAAKoQ,aAAapQ,KAAKmQ,iBAAkBmD,EAAIrE,WAAW5N,UAAY,GAAGJ,UAAS,SAAEgI,GAC3EA,EAAE3J,eAAe,WAChBgU,EAAIrE,WAAW5N,UAAY4H,EAAa,UACxCqK,EAAIrE,WAAkB,MAAC7J,EAAOkO,EAAIrE,WAAkB,MAAKhG,EAAS,OAC/DqK,EAAIrE,WAAkB,MAAErQ,QACpB0U,EAAa,SACZA,EAAIrE,WAAkB,MAAEpQ,QAAO,SAACoO,GAC5BA,EAAc,QAAIqG,EAAa,WAM/CvS,EAAK8I,GAAGkI,oBASxBxD,EAAAhQ,UAAAgV,eAAA,SAAepN,GACX,IAAGnG,KAAKgQ,eAAeqC,UACpBrS,KAAKgQ,eAAe,CACnBhQ,KAAKgQ,eAAwB,SAAKhQ,KAAKgQ,eAAwB,QAC/DhQ,KAAKgQ,eAA8B,eAAI,MACnCwD,EAAaxT,KAAKgQ,eAAwB,QAC9ChQ,KAAKgQ,eAAe7H,SAAStJ,QAAO,SAACE,GACjCA,EAAc,QAAIyU,IAE+B,MAAlDjC,KAAKC,UAAUxR,KAAKgQ,eAAef,aAAuBjP,KAAKgQ,eAA2B,WAAS,MAAEpR,QACpGoB,KAAKgQ,eAA2B,WAAS,MAAEnR,QAAO,SAACoO,GAC/CA,EAAc,QAAIuG,IAGvBA,EACCxT,KAAK2S,WAAW3S,KAAKgQ,gBAGrBhQ,KAAK4S,cAAc5S,KAAKgQ,kBAKpCzB,EAAAhQ,UAAAoU,WAAA,SAAW/J,GACH5I,KAAKwS,mBAAmB5J,EAAc,KAAE5I,KAAKyS,aAAczS,KAAKyS,YAAazS,KAAKyT,mBAIlFzT,KAAKyT,iBAAiB1T,KAAK6I,IAGnC2F,EAAAhQ,UAAAqU,cAAA,SAAchK,GAAd,IAAA7H,EAAAf,KACQA,KAAKwS,mBAAmB5J,EAAc,KAAE5I,KAAKyS,aAAczS,KAAKyS,YAAazS,KAAKyT,mBAClFzT,KAAKyT,iBAAiB5U,QAAO,SAAEE,EAAMwJ,GAC7BxJ,EAAW,KAAEgC,EAAK0R,eAAiB7J,EAAc,KAAE7H,EAAK0R,cACxD1R,EAAK0S,iBAAiB/K,OAAOH,EAAO,MASpDgG,EAAAhQ,UAAAmV,WAAA,WAAA,IAAA3S,EAAAf,KACQA,KAAK2T,YACL3T,KAAK+I,gBAAiB,EACtB/I,KAAKgJ,cAAchJ,KAAK2T,WAAW,GAAG1S,UAAS,SAACgI,GACzCA,EAAE3J,eAAe,WAChByB,EAAK6S,eAAiB3K,MAK9BjJ,KAAK+I,gBAAiB,GAM9BwF,EAAAhQ,UAAA6K,kBAAA,WAAA,IAAArI,EAAAf,KACOA,KAAK2T,YAAc3T,KAAKqJ,iBACvBrJ,KAAKgJ,cAAchJ,KAAK2T,WAAW3T,KAAK4T,eAAevS,UAAY,GAAGJ,UAAS,SAACgI,GACzEA,EAAE3J,eAAe,WAChByB,EAAK6S,eAAevS,UAAY4H,EAAa,UAC7ClI,EAAK6S,eAAsB,MAACxO,EAAOrE,EAAK6S,eAAsB,MAAK3K,EAAS,WAM5FsF,EAAAhQ,UAAAyK,cAAA,SAAcxJ,EAAY6B,EAAiBU,GACvC,QADuC,IAAAA,IAAAA,EAAkB/B,KAAK+B,UAC3D/B,KAAKqJ,gBAAgB,KACdC,EAAStJ,KAAKqJ,gBAAe,UAAU7J,EAAI,aAAauC,EAAQ,cAAcV,EACpF,OAAOrB,KAAKuJ,KAAKC,IAAIF,GAIrB,OAAOG,EAAAA,IAAG,IASlB8E,EAAAhQ,UAAAsV,gBAAA,SAAgBpV,EAAW0P,GAA3B,IAAApN,EAAAf,KACI,GAAIvB,EAAJ,CACA,GAAW,QAAR0P,EAIa,IAHR5F,EAAQvI,KAAK0S,cAAc9H,UAAS,SAACqC,GACrC,OAAOA,EAAKxO,KAAKS,IAAMT,EAAKA,KAAKS,OAGjCc,KAAK0S,cAAchK,OAAOH,EAAO,GAErC9J,EAAKA,KAAc,SAAI,OAEtB,GAAW,WAAR0P,EAAkB,KAClB5F,EAGQ,IAHRA,EAAQvI,KAAKyT,iBAAiB7I,UAAS,SAAC7L,GACxC,OAAOA,EAAKN,KAAKS,IAAMT,EAAKA,KAAKS,OAGjCc,KAAKyT,iBAAiB/K,OAAOH,EAAO,GAExC9J,EAAc,SAAI,MAElBqV,EAAa,KAOjB,GANW,WAAR3F,EACC2F,EAAa9T,KAAK0R,eAAejT,EAAK4Q,QAE1B,QAARlB,IACJ2F,EAAa9T,KAAK0R,eAAejT,EAAK4Q,OAAO5Q,KAAKS,KAEnD4U,IACCA,EAAoB,SAAI,EACpBA,EAAW3L,UAAY2L,EAAW3L,SAASvJ,QAAYkV,EAAW7E,WAAWlC,OAAS+G,EAAW7E,WAAWlC,MAAMnO,QAAS,KACvHmV,EAAYD,EAAW3L,SAAS8B,OAAM,SAAC+J,GACvC,OAAOA,EAAe,UAEtBjH,EAAQ+G,EAAW7E,WAAWlC,MAAM9C,OAAM,SAACgD,GAC3C,OAAOA,EAAc,UAErB8G,GAAaA,EAAUnV,QAAYmO,GAASA,EAAMnO,OAClDkV,EAA0B,eAAI,EAG9BA,EAA0B,eAAI,EAEL,EAA1BA,EAAWxE,QAAQ1Q,QAClBkV,EAAWxE,QAAQzQ,QAAO,SAAC2R,OACjB0C,EAASnS,EAAK2Q,eAAelB,GACnC,GAAI0C,EAAO/K,UAAY+K,EAAO/K,SAASvJ,QAAYsU,EAAOjE,WAAWlC,OAASmG,EAAOjE,WAAWlC,MAAMnO,OAAQ,KACtGqV,EAAef,EAAO/K,SAAS8B,OAAM,SAAC+J,GACtC,OAAOA,EAAe,UAEtBE,EAAWhB,EAAOjE,WAAWlC,MAAM9C,OAAM,SAACgD,GAC1C,OAAOA,EAAc,UAErBgH,GAAgBA,EAAarV,QAAYsV,GAAYA,EAAStV,OAC9DsU,EAAsB,eAAI,EAGvBY,EAA0B,cACzBZ,EAAsB,cAAIY,EAA0B,cAGpDZ,EAAsB,eAAI,QAY1D3E,EAAAhQ,UAAA4V,cAAA,WACInU,KAAK0S,cAAc7T,QAAO,SAACoO,GACvBA,EAAKxO,KAAc,SAAI,IAE3BuB,KAAKyT,iBAAiB5U,QAAO,SAACE,GAC1BA,EAAc,SAAI,IAEtBiB,KAAK8P,iBAAiBjR,QAAO,SAACsO,GAC1BA,EAAmB,eAAI,EACvBA,EAAa,SAAI,EACjBA,EAAc,UAAI,EACmB,MAAlCoE,KAAKC,UAAUrE,EAAI8B,aAAuB9B,EAAgB,WAAS,MAAEvO,QACpEuO,EAAgB,WAAS,MAAEtO,QAAO,SAACoO,GAC/BA,EAAc,SAAI,MAI9BjN,KAAK0S,cAAgB,GACrB1S,KAAKyT,iBAAmB,GACxBzT,KAAK6J,GAAGC,gBAOZyE,EAAAhQ,UAAA6V,aAAA,SAAaC,GACTrU,KAAKsU,UAAY,GACbD,EAEArU,KAAKoN,iBAAiB3L,KAAK,CACvBa,KAAM,UACN7D,KAAM,CACFsO,MAAO/M,KAAK0S,cACZ9J,QAAS5I,KAAKyT,oBAOtBzT,KAAKoN,iBAAiB3L,KAAK,CACvBa,KAAM,SACN7D,KAAM,CACFsO,MAAO,GACPnE,QAAS,MAIrB5I,KAAKmU,gBACLnU,KAAK2T,WAAa,GAClB3T,KAAK0T,aACL1T,KAAKuU,gBAAgBC,SAGzBjG,EAAAhQ,UAAAuT,eAAA,eACU2C,EAAkBzU,KAAK0U,WAAWlO,cAAcmO,YAAc,GAC9DC,EAAkB5U,KAAK0U,WAAWlO,cAAc2B,SAElD0M,EAAsB,EAC1B,GAAGD,GAAmBA,EAAgBhW,OAClC,IAAK,IAAIgB,EAAIgV,EAAgBhW,OAAS,EAAQ,GAALgB,EAAQA,IAE7CI,KAAKgG,SAAS8O,SAASF,EAAgBhV,GAAG,UAAU,QAG1B6U,IAD1BI,GADYD,EAAgBhV,GAAG+U,aAG3B3U,KAAKgG,SAAS8O,SAASF,EAAgBhV,GAAG,UAAU,QAGpDI,KAAKgG,SAAS8O,SAASF,EAAgBhV,GAAG,UAAU,QAO5DI,KAAK+U,eADiBN,GAAvBI,GAQPtG,EAAAhQ,UAAAyW,WAAA,WACOhV,KAAKiQ,eAAiBjQ,KAAKiQ,cAAcrR,QACxCoB,KAAKkS,YAAYlS,KAAKiQ,cAAc,KAI5C1B,EAAAhQ,UAAAgM,WAAA,SAAWrF,EAAe+P,EAAetK,GACrC,IAAKsK,IAAU/P,EACX,MAAM,IAAIgQ,MAAM,WAEpB,QAAOvK,EAAM3L,KAAI,SAACD,GAAQ,OAAAmG,IAAUnG,EAAKkW,MAG7C1G,EAAAhQ,UAAAiU,mBAAA,SAAmBtN,EAAe+P,EAAetK,GAC7C,IAAKsK,IAAU/P,EACX,MAAM,IAAIgQ,MAAM,WAEpB,QAAOvK,EAAM3L,KAAI,SAACD,GAAQ,OAAAmG,IAAUnG,EAAW,KAAEkW,MAGrD1G,EAAAhQ,UAAA4W,YAAA,WACInV,KAAKmU,gBACLnU,KAAK2T,WAAa,GAClB3T,KAAK0T,kCAvvBZ5Q,EAAAA,UAAS1E,KAAA,CAAC,CACT2E,SAAU,8BACVC,SAAA,8mdARwDyK,EAAAA,iBAAZC,EAAAA,kBAAuB0H,EAAAA,cAG5DtH,EAAAA,kBAHuGH,EAAAA,yBAAmBE,EAAAA,iDAc9HzK,EAAAA,+BAEAA,EAAAA,2BACAA,EAAAA,sBACAA,EAAAA,+BACAA,EAAAA,+BAEAE,EAAAA,UAASlF,KAAA,CAAC,6CAIViF,EAAAA,+BAEAA,EAAAA,2BACAA,EAAAA,yBACAA,EAAAA,2BAEAC,EAAAA,UAASlF,KAAA,CAAC,iBAguBfmQ,GAnsBI,SAAAA,EACYvI,EACAO,EACA8O,EACA9L,EACAM,EACAkE,GALA/N,KAAAgG,SAAAA,EACAhG,KAAAuG,WAAAA,EACAvG,KAAAqV,OAAAA,EACArV,KAAAuJ,KAAAA,EACAvJ,KAAA6J,GAAAA,EACA7J,KAAA+N,SAAAA,EApDH/N,KAAAyS,YAAsB,KAEtBzS,KAAAsV,gBAA0B,WASzBtV,KAAAoN,iBAAmB,IAAI5J,EAAAA,aAEvBxD,KAAAsN,eAAiB,IAAI9J,EAAAA,aACrBxD,KAAAuV,WAAa,IAAI/R,EAAAA,aACjBxD,KAAAuN,SAAW,IAAI/J,EAAAA,aAKzBxD,KAAAwV,WAAoB,GACpBxV,KAAAyT,iBAAyB,GACzBzT,KAAA0S,cAAsB,GAItB1S,KAAAsU,UAAoB,GAEpBtU,KAAA6P,gBAA6B,GAC7B7P,KAAA8P,iBAA8B,GAC9B9P,KAAAkQ,mBAAgC,GAChClQ,KAAAgQ,eAAqB,GACrBhQ,KAAAqQ,qBAA2B,GAC3BrQ,KAAAmQ,iBAA0B,GAC1BnQ,KAAAiQ,cAA2B,GAC3BjQ,KAAA+B,SAAkB,GAElB/B,KAAA+I,gBAAyB,EACzB/I,KAAA+U,gBAAyB,EACzB/U,KAAA4T,eAAqB,GAErB5T,KAAAsQ,eAAwB,OACxBtQ,KAAAiH,YAAqB,YACrBjH,KAAAwO,OAAgB,OAEhBxO,KAAAqO,UAAY,6CASRrO,KAAK0G,cAAgB1G,KAAK+N,SAASvE,IAAI8E,EAAAA,eCpE/C,IAAAmH,GAsBInV,OAAAC,eACIkV,EAAAlX,UAAA,qBAAkB,KAOtB,WACE,OAAOyB,KAAK0V,yBATd,SACuBjX,GAClBA,IACDuB,KAAK0V,oBAAsBjX,EAC3BuB,KAAKgB,sBAAsBxC,UAAUC,yDArB5CkX,EAAAA,UAASvX,KAAA,CAAC,CACP2E,SAAU,iEAHLzE,iDAmBJ8E,EAAAA,SAcLqS,GAFI,SAAAA,EAAoBzU,GAAAhB,KAAAgB,sBAAAA,EAbpBhB,KAAA0V,oBAAsB,GCpB1B,IAAAE,GAMIA,EAAArX,UAAAsX,UAAA,SAAU3Q,GACN,OAAOlF,KAAK8V,UAAUC,wBAAwB7Q,wBALrD8Q,EAAAA,KAAI5X,KAAA,CAAC,CAAE0N,KAAM,wDADLmK,EAAAA,gBAQTL,GALI,SAAAA,EAAoBE,GAAA9V,KAAA8V,UAAAA,ECLxB,IAAAI,GAIIA,EAAA3X,UAAAsX,UAAA,SAAU9W,OACF6D,EAAM7D,EAAW,KACrB,OAAG6D,EACQA,EAAIC,UAAUD,EAAIhE,OAAO,EAAEgE,EAAIhE,QAG/B,wBARlBoX,EAAAA,KAAI5X,KAAA,CAAC,CAAC0N,KAAM,iBAWboK,GAXA,SAAAA,YAeIC,EAAA5X,UAAAsX,UAAA,SAAU9W,EAAUqX,OACZxT,EAAM7D,EAAY,MACtB,GAAGqX,GAAQA,EAAKxX,OAAO,KACf0U,EAAM8C,EAAKpX,KAAI,SAACqX,GAChB,OAAOA,EAAQ,IAAKzT,IAEpB0T,EAAU,GACd,GAAGhD,EACC,GAAsB,IAAnBA,EAAc,SAAQ,KACjB9C,EAAM4F,EAAKpX,KAAI,SAACqX,GAChB,OAAOA,EAAQ,IAAK/C,EAAc,WAEtCgD,EAAU9F,EAASA,EAAI1E,KAAI,IAAIwH,EAAU,KAAIA,EAAU,UAGvDgD,EAAUhD,EAAU,KAG5B,OAAOgD,EAGP,MAAO,wBAvBlBN,EAAAA,KAAI5X,KAAA,CAAC,CAAC0N,KAAM,iBA0BbqK,GA1BA,SAAAA,KCfAI,EAAAC,mBA0BmBC,GAEnB,IAAAC,uBAACC,EAAAA,SAAQvY,KAAA,CAAC,CACRwY,aAAc,CAACpR,EAA2BnF,EAAyBkO,EAA8BqH,EAAcM,EAAeC,EAAeV,GAC7IoB,QAAS,CACPC,EAAAA,aACAC,EAAAA,YACAC,EAAAA,YACAC,EAAAA,mBACAC,EAAAA,mBACAC,EAAAA,cACAC,EAAAA,uBACAC,EAAAA,WACAC,EAAAA,iBACAC,EAAAA,kBACAC,EAAAA,aACAC,EAAAA,iBACAC,EAAAA,aAAaC,UACbC,EAAAA,kBAEFC,UAAW,CACPC,EAAAA,eACAC,EAAAA,uBACAC,EAAAA,mBACA1Z,GAEJ2Z,QAAS,CAACzS,EAA2BnF,EAAyBkO,EAA8BqH,EAAcM,EAAeC,EAAeV,GACxIyC,gBAAiB,CAAE3J,OAEgBmI,GA3BrC,SAAAA","sourcesContent":["import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DiscussionGroupService {\r\n\r\n  constructor() { }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { discussionConfig } from './discussionList.interface';\r\nimport { Subject,BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class DiscussionListService {\r\n\r\n    resultDiscussion: BehaviorSubject<any> = new BehaviorSubject<any>(null);;\r\n\r\n    constructor() { }\r\n\r\n    resetData(data) {\r\n        let results = [];\r\n        if (data && data.commentIds && data.commentIds.length) {\r\n            data.commentIds.forEach(commentId => {\r\n                const item = data['comments'].find((comment) => {\r\n                    return comment[\"id\"] === commentId\r\n                })\r\n                if (item) {\r\n                    let id = item[\"id\"],\r\n                        userId = item[\"userId\"],\r\n                        userName = item['user'][\"name\"],\r\n                        //  imgData = item['user'][\"imgData\"],\r\n                        imgData = item['user'].hasOwnProperty('imgData') ? item['user'][\"imgData\"] : '',\r\n                        commentDate = item[\"commentDate\"],\r\n                        //  commentDate = this.dataFormate(item[\"commentDate\"]),\r\n                        text = item[\"text\"],\r\n                        attachFiles = item.hasOwnProperty('attachFiles') ? item[\"attachFiles\"] : [],\r\n                        parentData;\r\n                    if (item.hasOwnProperty('parentId')) {\r\n                        let parentItem = data['comments'].find(i => {\r\n                            return i.id === item.parentId;\r\n                        })\r\n                        if (parentItem) {\r\n                            let parid = parentItem[\"id\"],\r\n                                paruserId = parentItem[\"userId\"],\r\n                                paruserName = parentItem['user'][\"name\"],\r\n                                // parimgData = parentItem['user'][\"imgData\"],\r\n                                parimgData = parentItem['user'].hasOwnProperty('imgData') ? parentItem['user'][\"imgData\"] : '',\r\n                                parcommentDate = parentItem[\"commentDate\"],\r\n                                partext = parentItem[\"text\"],\r\n                                parattachFiles = parentItem.hasOwnProperty('attachFiles') ? parentItem[\"attachFiles\"] : [];\r\n                            parentData = {\r\n                                id: parid,\r\n                                userId: paruserId,\r\n                                userName: paruserName,\r\n                                imgData: parimgData,\r\n                                commentDate: parcommentDate,\r\n                                text: partext,\r\n                                attachFiles: parattachFiles\r\n                            }\r\n                        }\r\n                    }\r\n                    let thisData: discussionConfig = {\r\n                        id,\r\n                        userId,\r\n                        userName,\r\n                        imgData,\r\n                        commentDate,\r\n                        text,\r\n                        attachFiles,\r\n                        parentData\r\n                    };\r\n                    results.push(thisData);\r\n                }\r\n                else {\r\n                    return;\r\n                }\r\n            });\r\n        }\r\n        // this.resultDiscussion = results;\r\n        this.resultDiscussion.next(results);\r\n    }\r\n    getData() {\r\n        return this.resultDiscussion;\r\n    }\r\n}\r\n","import { Component, OnInit, Input, Output, EventEmitter, ViewChild, ViewEncapsulation } from '@angular/core';\r\nimport { PaginationControlsComponent, PaginationInstance } from '@farris/ui-pagination';\r\nimport { DiscussionListService } from './discussion-list.service';\r\n\r\n@Component({\r\n  selector: 'farris-discussion-list',\r\n  templateUrl:'./discussion-list.component.html',\r\n  styleUrls:['./discussion-list.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class DiscussionListComponent implements OnInit {\r\n    // @Input() personnelsPrimaryKey: string = 'userId';\r\n    @Input() personnelsDisplayKey: string = 'userName';\r\n\r\n    /**æ¯å¦æ¯æåé¡µ */\r\n    @Input() supportPaging:boolean = true;\r\n    /**æ»é¡µæ° */\r\n    // @Input() pageSize:number;\r\n    /**å½åé¡µç  */\r\n    @Input() pageIndex:number = 1;\r\n    /**æ¯é¡µæ¾ç¤ºæ¡æ°éé¡¹ */\r\n    // private _pageList = [10,20,30,50];\r\n    // get pageList() {\r\n    //     return this._pageList;\r\n    // }\r\n    // @Input() set pageList(val) {\r\n    //     this._pageList = val;\r\n    //     if (this.pager) {\r\n    //         this.pager.setPageList(val);\r\n    //     }\r\n    // }\r\n    /**æ»æ¡æ° */\r\n    private _total = 0;\r\n    get total() {\r\n        return this._total;\r\n    }\r\n    @Input() set total(val) {\r\n      this._total = val;\r\n      // this.paginationOptions.totalItems = val;\r\n      this.initPaginationOptions();\r\n      // if(val){\r\n      //   this.initPaginationOptions();\r\n      // }\r\n    }\r\n    /**æ¯é¡µæ¾ç¤ºä¸ªæ° */\r\n    private _pageSize = 10;\r\n    get pageSize() {\r\n        return this._pageSize;\r\n    }\r\n    @Input() set pageSize(val) {\r\n      this._pageSize = val;\r\n      // this.paginationOptions.itemsPerPage = val;\r\n      this.initPaginationOptions();\r\n      //if(val){\r\n        //this.initPaginationOptions();\r\n      //}\r\n    }\r\n    /**å½åé¡µæ° */\r\n    // private _pageIndex = 1;\r\n    // get pageIndex() {\r\n    //     return this._pageIndex;\r\n    // }\r\n    // @Input() set pageIndex(val) {\r\n    //   if(val){\r\n    //     this._pageIndex = val;\r\n    //     this.initPaginationOptions();\r\n    //   }\r\n    // }\r\n    /**æ»æ¡æ° */\r\n    // @Input() total = 0;\r\n    /**è¯è®ºæ°æ® */\r\n    innerDiscussionData = [];\r\n    _discussionData = [];\r\n    @Input() \r\n    set discussionData(val) {\r\n      if(val){\r\n        this._discussionData = val;\r\n        this.innerDiscussionData = val;\r\n      }\r\n    }\r\n    get discussionData(){\r\n      return this._discussionData;\r\n    }\r\n    @Output() replyMessage = new EventEmitter();\r\n    // åé¡µäºä»¶\r\n    @Output() pageChanged = new EventEmitter();\r\n    @Output() pageSizeChanged = new EventEmitter();\r\n\r\n    /**éä»¶é¢è§ */\r\n    @Output() filePreview = new EventEmitter();\r\n    /**éä»¶ä¸è½½ */\r\n    @Output() fileDownload = new EventEmitter();\r\n    public labels: any = {\r\n        previousLabel: ' ',\r\n        nextLabel: ' '\r\n    };\r\n    public directionLinks = true;\r\n    public maxSize = 7;\r\n    public responsive = true;\r\n    public autoHide = false;\r\n    paginationOptions: PaginationInstance;\r\n    @ViewChild('pager') pager: PaginationControlsComponent;\r\n\r\n    constructor( private discussionListService:DiscussionListService ) { }\r\n    ngOnInit(){\r\n      // this.paginationOptions = {\r\n      //   id: 'Farris-discussion-Pagination',\r\n      //   itemsPerPage: this.pageSize,\r\n      //   currentPage: this.pageIndex,\r\n      //   // pageList: this.pageList,\r\n      //   totalItems: this.total\r\n      // };\r\n      this.initPaginationOptions();\r\n      /**çå¬æä»¤å¾å°çæ°æ® */\r\n      this.discussionListService.getData().subscribe((data:any): void => {\r\n        if(data && !this._discussionData.length){\r\n          this.innerDiscussionData = data;\r\n        }\r\n      });\r\n    }\r\n    initPaginationOptions(){\r\n      this.paginationOptions = {\r\n        id: 'Farris-discussion-Pagination',\r\n        itemsPerPage: this._pageSize,\r\n        currentPage: this.pageIndex,\r\n        // pageList: this.pageList,\r\n        totalItems: this._total\r\n      };\r\n    }\r\n    /**ç¹å»åå¤çè¨ */\r\n    reply(item){\r\n      this.replyMessage.emit(item);\r\n    }\r\n    /**é¡µç åå */\r\n    onPageChange(page: { pageIndex: number, pageSize: number }) {\r\n      if (this.pageIndex !== page.pageIndex) {\r\n          this.pageIndex = page.pageIndex;\r\n          this.paginationOptions.currentPage = page.pageIndex;\r\n          this.pageChanged.emit({ pageInfo: page });\r\n      }\r\n    }\r\n    /**æ¯é¡µæ¾ç¤ºæ¡æ°åå */\r\n    onPageSizeChange(pageSize: number) {\r\n        if (this.pageSize !== pageSize && this.total) {\r\n            this.paginationOptions.itemsPerPage = pageSize;\r\n            this.pageSize = pageSize;\r\n  \r\n            const total = this.total;\r\n            let pageLength = Math.floor(total / pageSize);\r\n            if (total % pageSize > 0) {\r\n                pageLength += 1;\r\n            }\r\n  \r\n            if (pageLength && this.pageIndex > pageLength) {\r\n                this.pageIndex = pageLength;\r\n                this.paginationOptions.currentPage = this.pageIndex;\r\n            }\r\n  \r\n            this.pageSizeChanged.emit({ pageInfo: { pageIndex: this.pageIndex, pageSize: pageSize } });\r\n        }\r\n    }\r\n    /**éä»¶é¢è§ */\r\n    filePreviewEventHandler(info) {\r\n      this.filePreview.emit(info);\r\n    }\r\n    /**éä»¶ä¸è½½ */\r\n    fileDownloadEventHandler(info) {\r\n      this.fileDownload.emit(info);\r\n    }\r\n    /**å ä½å¤´åæå­ */\r\n    getAvatar(item){\r\n      if(item && item[this.personnelsDisplayKey]){\r\n        let str = item[this.personnelsDisplayKey];\r\n        return str.substring(str.length-2,str.length);\r\n      }\r\n      else{\r\n          return '';\r\n      }\r\n    }\r\n  \r\n}","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export interface editAttachFile {\r\n    id?:string;\r\n    name:string;\r\n    size:number;\r\n    metadataId:string;\r\n}\r\nexport interface ValueConfig {\r\n    msgInfo: MsgInfo;\r\n    text: string;\r\n    mailTos: Array<{ userId: string, userName: string }>;\r\n    mailToSections:Array<any>;\r\n    visibility: string;\r\n    // replyUser?:any;\r\n    parentId:string;\r\n    attachFiles?:editAttachFile[];\r\n}\r\nexport enum MsgInfo {\r\n    Cancel = 0,\r\n    Confirm = 1\r\n}","import { Component, OnInit, Input, ViewChild, ElementRef, Renderer2, Output, EventEmitter, ViewEncapsulation, ChangeDetectorRef, Injector } from '@angular/core';\r\nimport { UploaderOptions, FUploadFileExtend } from '@farris/extend-file-upload';\r\nimport { NotifyService } from '@farris/ui-notify';\r\nimport { LocaleService } from '@farris/ui-locale';\r\nimport { ValueConfig, MsgInfo, editAttachFile } from './discussion-editor.interface';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { of } from 'rxjs';\r\n\r\n@Component({\r\n    selector: 'farris-discussion-editor',\r\n    templateUrl: './discussion-editor.component.html',\r\n    styleUrls: ['./discussion-editor.component.scss'],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class DiscussionEditorComponent implements OnInit {\r\n    @Input() personnelsPrimaryKey: string = 'id';\r\n    @Input() personnelsDisplayKey: string = 'name';\r\n    @Input() replyPersonnelsDisplayKey: string = 'userName';\r\n    // @Input() personnels: Array<any> = [];\r\n    // @Input() permissionList: Array<any> = [\r\n    //     { value: 'ALL', text: this.localeService.getValue('discussionGroup.all') },\r\n    //     { value: 'RELATED', text: this.localeService.getValue('discussionGroup.related') }\r\n    // ];\r\n    @Input() cancelVisible: boolean = true;\r\n    @Input() editHeight: number = 130;\r\n\r\n    @Input() type: string = 'user';\r\n    @Input() orgUrl:string;\r\n    @Input() personSearchUrl:string;\r\n    // éè¦çæ æ°æ®\r\n    // @Input() treeData: any[];\r\n    // å·¦ä¾§æ çä¸»é®å­æ®µ\r\n    @Input() treeIdField: string;\r\n    @Input() treeDisplayText: string;\r\n    @Input() sectionData:any[];\r\n    // ç¨æ·è§è²\r\n    // @Input() groupList: any[] = [];\r\n\r\n    options: UploaderOptions;\r\n    placeholder:string;\r\n    sectiontreeData:Array<any>;\r\n    // äººäºå¼¹çªåè¡¨æ°æ®\r\n    private _personnels: Array<any> = [];\r\n\r\n    get personnels() {\r\n        return this._personnels;\r\n    }\r\n    @Input() set personnels(val) {\r\n        if (val) {\r\n            this._personnels = val;\r\n            this.innerPersonnels = this._personnels;\r\n            this.copyPersonnels = this._personnels;\r\n            // this.copyPersonnels = this._personnels;\r\n        }\r\n    }\r\n\r\n    // äººäºå¼¹çªåè¡¨æ°æ®\r\n    private _replyUser;\r\n\r\n    get replyUser() {\r\n        return this._replyUser;\r\n    }\r\n    @Input() set replyUser(val) {\r\n        if (val) {\r\n            this._replyUser = val;\r\n            if(this._replyUser['id']){\r\n                this.editorFocus();\r\n            }\r\n        }\r\n    }\r\n\r\n    _attachFiles: FUploadFileExtend[];\r\n    get attachFiles() {\r\n        return this._attachFiles;\r\n    }\r\n    @Input() set attachFiles(val) {\r\n        if (val) {\r\n            this._attachFiles = val;\r\n        }\r\n    }\r\n\r\n    // æ°å»ºè¿æ¯ç»´æ¤èªå®ä¹è§è²\r\n    // @Output() customGroupChange = new EventEmitter<any>();\r\n    // å¯¹å¤æ´é²æ°æ®\r\n    @Output() selectionsChange = new EventEmitter<any>();\r\n    // éä¸­çè¡\r\n    @Output() lineDataChange = new EventEmitter<any>();\r\n    // å¯¹å¤\r\n    @Output() valueChange = new EventEmitter<ValueConfig>();\r\n    /** éä»¶é¢è§ */\r\n    @Output() filePreview = new EventEmitter();\r\n    /** éä»¶å é¤ */\r\n    @Output() fileRemove = new EventEmitter();\r\n    @Output() fileUploadDone = new EventEmitter();\r\n    @Output() personnelSearch = new EventEmitter();\r\n    @Output() getOugUsers = new EventEmitter();\r\n    @ViewChild('editor') editor;\r\n    @ViewChild('personModal') personModal;\r\n    // @ViewChild('searchInput') searchInput;\r\n    // å®¡æ¹æè§\r\n    textValue: string = '';\r\n    // æå­ææ¬æ¡çè¾å¥ï¼è§£å³ç¦ç¹é®é¢\r\n    tempTextValue: string;\r\n    // æå­äººåä¿¡æ¯\r\n    tempPersonnelsValue: string = '';\r\n    // æå­é¨é¨\r\n    tempSectionValue: string = '';\r\n    // æç´¢äººäºç®¡çå¼¹çª\r\n    personModalVisible = false;\r\n    // éæ©è¦åéçäººååè¡¨\r\n    selectedPersonnels: Array<any> = [];\r\n    // éæ©è¦åéçé¨é¨\r\n    selectedSection: Array<any> = [];\r\n    // æç´¢ææ¬æ¡ä¸­ç»å®çå¼\r\n    personnelText;\r\n    // æå­äººåä¿¡æ¯ï¼ç¨äºæç´¢\r\n    copyPersonnels: Array<any> = [];\r\n    innerPersonnels: Array<any> = [];\r\n    el: ElementRef;\r\n    // é¿åéå¤è¾å¥çtoken\r\n    token: boolean;\r\n    relativeVisible: boolean = false;\r\n    permission: any;\r\n    //ä¸ä¼ éä»¶æ¯å¦æ¾ç¤º\r\n    attachFilesModalVisible = false;\r\n    pageSize:number = 20;\r\n    searchPersonnelList:any = {};\r\n    showSearchList:boolean = false;\r\n    permissionList: Array<any> = [];\r\n    localeService: LocaleService;\r\n    groupIcon = '<span class=\"f-icon f-icon-search\"></span>';\r\n    constructor(\r\n        private renderer: Renderer2,\r\n        private elementRef: ElementRef,\r\n        private cd: ChangeDetectorRef,\r\n        private notifyService: NotifyService,\r\n        private injector: Injector,\r\n        private http: HttpClient,\r\n    ) { \r\n        this.localeService = this.injector.get(LocaleService);\r\n    }\r\n\r\n    ngOnInit() {\r\n        const self = this;\r\n        this.renderer.listen(document, 'click', function (event) {\r\n            self.personModalVisible = false;\r\n            self.relativeVisible = false;\r\n        });\r\n        // this.copyPersonnels = this.personnels;\r\n        this.el = this.elementRef.nativeElement;\r\n        this.permissionList = [\r\n            { value: 'ALL', text: this.localeService.getValue('discussionGroup.all') },\r\n            { value: 'RELATED', text: this.localeService.getValue('discussionGroup.related') }\r\n        ]\r\n        this.permission = this.permissionList[0];\r\n        this.options = { maxUploads: 3, maxFileSize: 10240, allowedContentTypes: ['.jpg', '.pdf'] };\r\n        this.placeholder = this.localeService.getValue('discussionGroup.placeholder');\r\n    }\r\n\r\n    /**\r\n     * åä¸ªéä»¶ä¸ä¼ å®æ\r\n     * @param ev \r\n     */\r\n    fUploadDoneHandler(ev) {\r\n        this.fileUploadDone.emit(ev);\r\n    }\r\n    /**\r\n     * ä¸ä¼ éä»¶ä¸­åä¸ªéä»¶å é¤å®æ\r\n     * @param ev \r\n     */\r\n    fUploadRemovedHandler(ev) {\r\n        console.log('fUploadRemovedHandler');\r\n        console.log(ev);\r\n    }\r\n    /**éä»¶åè¡¨ä¸­é¢è§ */\r\n    filePreviewEventHandler(info) {\r\n        this.filePreview.emit(info);\r\n    }\r\n    /**éä»¶åè¡¨ä¸­å é¤ */\r\n    fileRemoveEventHandler(file) {\r\n        this.fileRemove.emit(file);\r\n    }\r\n\r\n    // ææ¬æ¡å¤±å»ç¦ç¹è§¦å\r\n    setTextValue(e = null) {\r\n        if (e) {\r\n            // console.log(e.target.innerHTML);\r\n            this.tempTextValue = e.target.innerHTML;\r\n            this.textValue = this.tempTextValue;\r\n        }\r\n        // if (this.tempTextValue) {\r\n        //     this.textValue = this.tempTextValue\r\n        // }\r\n        if (this.tempPersonnelsValue) {\r\n            this.textValue += this.tempPersonnelsValue;\r\n        }\r\n        if(this.tempSectionValue){\r\n            this.textValue += this.tempSectionValue;\r\n        }\r\n        this.tempTextValue = '';\r\n        this.tempPersonnelsValue = '';\r\n        this.tempSectionValue = '';\r\n    }\r\n\r\n    // çå¬é®çäºä»¶, ä¸»è¦æ¯ç¨äºå é¤@äºº\r\n    listenEditorValueChange(e) {\r\n        this.tempTextValue = e.target.innerHTML;\r\n        const children = e.target.children;\r\n        const childrenId = [];\r\n        for (let i = 0; i < children.length; i++) {\r\n            childrenId.push(children[i].id);\r\n        }\r\n        this.selectedPersonnels.forEach((personnel, index) => {\r\n            if (!childrenId.includes(personnel[this.personnelsPrimaryKey])) {\r\n                this.selectedPersonnels.splice(index, 1);\r\n            }\r\n        });\r\n        this.selectedSection.forEach((section, index) => {\r\n            if (!childrenId.includes(section[this.personnelsPrimaryKey])) {\r\n                this.selectedSection.splice(index, 1);\r\n            }\r\n        });\r\n        if (!this.tempTextValue) {\r\n            this.tempTextValue = '';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * æç´¢äººå\r\n     */\r\n    serachPersonnel() {\r\n        // if (this.personnelText) {\r\n        //     this.innerPersonnels = this.copyPersonnels.filter(item => {\r\n        //         if(item[this.personnelsDisplayKey]){\r\n        //             return item[this.personnelsDisplayKey].indexOf(this.personnelText) !== -1;\r\n        //         }\r\n        //     })\r\n        // }\r\n        // else {\r\n        //     this.innerPersonnels = this.copyPersonnels;\r\n        // }\r\n        if(this.personnelText){\r\n            this.showSearchList = true;\r\n            this.getSearchData(this.personnelText,0).subscribe(d=>{\r\n                if(d.hasOwnProperty(\"users\")){\r\n                    this.searchPersonnelList = d;\r\n                    this.setPersonModalPosition();\r\n                }\r\n            });\r\n        }\r\n        else{\r\n            this.showSearchList = false;\r\n        }\r\n        // this.searchInput.nativeElement.blur();\r\n        //ææ¶æ³¨éææå¡å¨ç«¯æ¥è¯¢\r\n        // this.personnelSearch.emit(this.personnelText);\r\n    }\r\n    /**\r\n     * æç´¢ä¸ä¸é¡µ\r\n     */\r\n    getMoreSearchData(){\r\n        this.getSearchData(this.personnelText,this.searchPersonnelList.pageIndex + 1).subscribe(d=>{\r\n            if(d.hasOwnProperty(\"users\")){\r\n                this.searchPersonnelList.pageIndex = d['pageIndex'];\r\n                this.searchPersonnelList['users'] = [...this.searchPersonnelList['users'],...d['users']];\r\n            }\r\n        });\r\n    }\r\n\r\n    getSearchData(text:string,pageIndex:number,pageSize:number = this.pageSize){\r\n        if(this.personSearchUrl){\r\n            const url = `${this.personSearchUrl}?param=${text}&pageSize=${pageSize}&pageIndex=${pageIndex}`;\r\n            //console.log(url);\r\n            return this.http.get(url);\r\n            //return this.http.get('assets/data/discussionPerson3.json');\r\n        }\r\n        else{\r\n            return of(true);\r\n        }\r\n    }\r\n\r\n    personnelChecked(item){\r\n        item.active = !item.active;\r\n        this.innerPersonnels = this.innerPersonnels.map(o => ({ ...o }));\r\n        this.cd.markForCheck();\r\n        this.appendPersonnels();\r\n    }\r\n\r\n    // å¢å @äººå\r\n    appendPersonnels() {\r\n        let selectedList = [];\r\n        if(!this.showSearchList){\r\n            selectedList = this.innerPersonnels.filter(item => item.active === true);\r\n        }\r\n        else{\r\n            selectedList = this.searchPersonnelList['users'].filter(item => item.active === true);\r\n        }\r\n        if (selectedList.length) {\r\n            this.appendPersonnel(selectedList);\r\n        }\r\n        this.resetPersonnels();\r\n        this.setTextValue();\r\n        this.personModalVisible = false;\r\n    }\r\n    //é«çº§æç´¢äººåæ·»å \r\n    appendPersonnelsList(listData) {\r\n        if (listData.length) {\r\n            this.appendPersonnel(listData, true);\r\n        }\r\n\r\n        this.setTextValue();\r\n    }\r\n    //å¾ªç¯å¢å äººå\r\n    appendPersonnel(listData, external = false) {\r\n        listData.forEach(item => {\r\n            if (this.selectedPersonnels.length && this._isInArray(item[this.personnelsPrimaryKey], this.personnelsPrimaryKey, this.selectedPersonnels)) {\r\n                return;\r\n            } else {\r\n                //if (!external) {\r\n                this.tempPersonnelsValue += '<a name=\"personnel\" contenteditable=\"false\" class=\"at-user\" id=\"' + item[this.personnelsPrimaryKey] + '\" userid=\"' + item[this.personnelsPrimaryKey] + '\">@' + item[this.personnelsDisplayKey] + '</a>&nbsp;';\r\n                // }\r\n                // else {\r\n                //     this.tempPersonnelsValue += '<a name=\"personnel\" contenteditable=\"false\" class=\"at-user\" id=\"' + item[this.personnelsPrimaryKey] + '\" userid=\"' + item[this.personnelsPrimaryKey] + '\">@' + item[this.replyPersonnelsDisplayKey] + '</a>';\r\n                // }\r\n                this.selectedPersonnels.push(item);\r\n            }\r\n        })\r\n    }\r\n    /**\r\n     * æ·»å é¨é¨\r\n     * @param listData \r\n     */\r\n    appendSectionList(listData){\r\n        if(listData.length){\r\n            this.appendSection(listData);\r\n        }\r\n        this.setTextValue();\r\n    }\r\n\r\n    appendSection(listData,) {\r\n        listData.forEach(item => {\r\n            if (this.selectedSection.length && this._isInArray(item[this.personnelsPrimaryKey], this.personnelsPrimaryKey, this.selectedSection)) {return;} \r\n            else {\r\n                this.tempSectionValue += '<a name=\"org\" contenteditable=\"false\" class=\"at-org\" id=\"' + item[this.personnelsPrimaryKey] + '\" orgid=\"' + item[this.personnelsPrimaryKey] + '\">@' + item['name'] + '</a>&nbsp;';\r\n                this.selectedSection.push(item);\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n    // å¤æ­æ¯å¦å¨æ°ç»\r\n    private _isInArray(value: any, fieldInArray: string, array: any[]) {\r\n        if (!value || !fieldInArray) {\r\n            return false;\r\n        }\r\n        return array.findIndex(item => value === item[fieldInArray]) === -1 ? false : true;\r\n    }\r\n\r\n    /**\r\n     * å³é­äººäºç®¡çå¼¹çª\r\n     */\r\n    resetPersonnels() {\r\n        this.showSearchList = false;\r\n        this.personModalVisible = false;\r\n        this.innerPersonnels = this.copyPersonnels;\r\n        if(this.innerPersonnels.length){\r\n            this.innerPersonnels.forEach(item => item.active = false);\r\n        }\r\n        this.personnelText = '';\r\n        // this.stopBubble(e);\r\n    }\r\n\r\n    /**\r\n     * æå¼äººåç®¡ç\r\n     * @param e äºä»¶\r\n     */\r\n    openModalPerson(e) {\r\n        this.personModalVisible = !this.personModalVisible;\r\n        setTimeout(() => {\r\n            if(this.personModalVisible){\r\n                this.setPersonModalPosition();\r\n            }\r\n        }, 0);\r\n        // this.getPersonnelList();\r\n        this.stopBubble(e);\r\n    }\r\n    setPersonModalPosition(){\r\n        let winH = window.innerHeight;\r\n        let ModalBottom = this.personModal.nativeElement.getBoundingClientRect().bottom;\r\n        if(winH < ModalBottom){\r\n            this.personModal.nativeElement.scrollIntoView(false);\r\n        }\r\n    }\r\n    openModalPermission(e) {\r\n        this.relativeVisible = !this.relativeVisible;\r\n        this.stopBubble(e);\r\n    }\r\n\r\n    /**\r\n     * æå¼ä¸ä¼ éä»¶\r\n     */\r\n    openModalFile(e) {\r\n        this.attachFilesModalVisible = !this.attachFilesModalVisible;\r\n        this.stopBubble(e);\r\n    }\r\n\r\n    // é»æ­¢åæ³¡\r\n    stopBubble(e) {\r\n        if (e && e.stopPropagation) {\r\n            e.stopPropagation();\r\n        } else {\r\n            window.event.cancelBubble = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * æäº¤è¯è¯­\r\n     */\r\n    submitApproval() {\r\n        if (!this.textValue) {\r\n            let notEmptyText = this.localeService.getValue('discussionGroup.notEmpty');\r\n            if(notEmptyText){\r\n                this.notifyService.error(notEmptyText);\r\n            }\r\n            return;\r\n        }\r\n        let editAttachFiles: editAttachFile[] = [];\r\n        if (this.attachFiles && this.attachFiles.length) {\r\n            this.attachFiles.forEach(file => {\r\n                let id = file['id'],\r\n                    name = file['name'],\r\n                    size = file['size'],\r\n                    metadataId = file['extend']['metadataId'];\r\n                let attachFile = {\r\n                    id,\r\n                    name,\r\n                    size,\r\n                    metadataId\r\n                }\r\n                editAttachFiles.push(attachFile);\r\n            })\r\n        }\r\n        this.valueChange.emit({\r\n            msgInfo: MsgInfo.Confirm,\r\n            text: this.textValue,\r\n            mailTos: this.selectedPersonnels,\r\n            mailToSections: this.selectedSection,\r\n            visibility: this.permission.value,\r\n            parentId: (this.replyUser && this.replyUser.hasOwnProperty('id')) ? this.replyUser.id : null,\r\n            attachFiles: editAttachFiles.length ? editAttachFiles : null\r\n        });\r\n        this.textValue = '';\r\n        this.selectedPersonnels = [];\r\n        this.selectedSection = [];\r\n        this.attachFiles = [];\r\n        this.replyUser = {};\r\n    }\r\n\r\n    cancel() {\r\n        this.valueChange.emit({\r\n            msgInfo: MsgInfo.Cancel,\r\n            text: null,\r\n            mailTos: [],\r\n            mailToSections: [],\r\n            visibility: null,\r\n            parentId: null,\r\n            attachFiles: null\r\n        });\r\n        this.textValue = '';\r\n        this.selectedPersonnels = [];\r\n        this.selectedSection = [];\r\n        this.attachFiles = [];\r\n        this.replyUser = {};\r\n    }\r\n    /**ä¿®æ¹æ¥çæé */\r\n    changePermission(value: string) {\r\n        this.permission = this.permissionList.find(item => item.value === value);\r\n        this.relativeVisible = false;\r\n    }\r\n    //è·å¾ç¦ç¹\r\n    editorFocus() {\r\n        this.editor.nativeElement.focus();\r\n    }\r\n    // customGroupChangePar(event){\r\n    //     this.customGroupChange.emit(event);\r\n    // }\r\n    /**\r\n     * é«çº§äººåç¹ç¡®è®¤\r\n     */\r\n    selectionsChangePar(event) {\r\n        //this.resetPersonnels();\r\n        if(event.data.users.length){\r\n            let userList = [];\r\n            event.data.users.forEach(user => {\r\n                userList.push(user.data);\r\n            });\r\n            this.appendPersonnelsList(userList);\r\n        }\r\n        if(event.data.section.length){\r\n            let sectionList = [];\r\n            event.data.section.forEach(sec => {\r\n                sectionList.push(sec.data);\r\n            });\r\n            this.appendSectionList(sectionList);\r\n        }\r\n        this.selectionsChange.emit(event);\r\n    }\r\n    /**é«çº§äººåä¸­éä¸­æè¡ */\r\n    lineDataChangePar(event) {\r\n        this.lineDataChange.emit(event);\r\n    }\r\n    /**è·å¾å ä½å¤´å */\r\n    getAvatar(item) {\r\n        if (item && item[this.personnelsDisplayKey]) {\r\n            let str = item[this.personnelsDisplayKey];\r\n            return str.substring(str.length - 2, str.length);\r\n        }\r\n        else {\r\n            return '';\r\n        }\r\n    }\r\n\r\n    ougUsers(event){\r\n        this.getOugUsers.emit(event);\r\n    }\r\n}","import { Component, OnInit, Input, ViewChild, ElementRef, Renderer2, NgZone, HostBinding, Output, EventEmitter, ChangeDetectorRef, Injector } from '@angular/core';\r\nimport { of } from 'rxjs';\r\nimport { Type } from './type';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { LocaleService } from '@farris/ui-locale';\r\n\r\n@Component({\r\n  selector: 'farris-discussion-personnel',\r\n  templateUrl:'./discussion-personnel.component.html',\r\n  styleUrls:['./discussion-personnel.component.scss'],\r\n})\r\nexport class DiscussionPersonnelComponent implements OnInit {\r\n\r\n    // æä½åè¡¨æèåç»æéè¦çä¸»é®å­æ®µ\r\n    @Input() listIdField: string = \"id\";\r\n    // åè¡¨ä¸­æ¾ç¤ºçå­æ®µ\r\n    @Input() listDisplayText: string = \"userName\";\r\n    @Input() sectionData:any[];\r\n    @Input() orgUrl:string;\r\n    @Input() personSearchUrl:string;\r\n\r\n    @ViewChild('personnelDialog') personnelDialog;\r\n    // æ°å»ºè¿æ¯ç»´æ¤èªå®ä¹è§è²\r\n    // @Output() customGroupChange = new EventEmitter<any>();\r\n    // å¯¹å¤æ´é²æ°æ®\r\n    @Output() selectionsChange = new EventEmitter<any>();\r\n    // éä¸­çè¡\r\n    @Output() lineDataChange = new EventEmitter<any>();\r\n    @Output() openDialog = new EventEmitter<any>();\r\n    @Output() ougUsers = new EventEmitter<any>();\r\n\r\n    @ViewChild('crumbsList') crumbsList:ElementRef;\r\n\r\n    // å³ä¾§é¡¹\r\n    selections: any[] = [];\r\n    selectedSections:any[] = [];\r\n    selectedUsers:any[] = [];\r\n    // æç´¢ææ¬\r\n    searchText: string\r\n    // æéè¦æ¾ç¤ºçäººåä¿¡æ¯\r\n    finalText: string = '';\r\n\r\n    sectionDataTree:Array<any> = [];\r\n    sectionDataTiled:Array<any> = [];\r\n    currentSectionData:Array<any> = [];\r\n    currentSection:any = {};\r\n    currentSectionPerson:any = {};\r\n    currentSectionId:string = '';\r\n    sectionCrumbs:Array<any> = [];\r\n    pageSize:number = 20;\r\n\r\n    showSearchList:boolean = false;\r\n    crumbsEllipsis:boolean = false;\r\n    searchUserList:any = {};\r\n\r\n    selectEmployee:string = \"éæ©åå·¥\";\r\n    placeholder:string = \"è¯·è¾å¥åå·¥å§åæç´¢\";\r\n    allOrg:string = \"å¨é¨ç»ç»\";\r\n    private localeService: LocaleService;\r\n    groupIcon = '<span class=\"f-icon f-icon-search\"></span>';\r\n    constructor(\r\n        private renderer: Renderer2,\r\n        private elementRef: ElementRef,\r\n        private ngZone: NgZone,\r\n        private http: HttpClient,\r\n        private cd: ChangeDetectorRef,\r\n        private injector: Injector\r\n    ) {\r\n        this.localeService = this.injector.get(LocaleService);\r\n     }\r\n\r\n    ngOnInit() {\r\n        // let sectionDataTrees = this.initsectionData(this.sectionData,'');\r\n        this.allOrg = this.localeService.getValue('discussionGroup.allOrg');\r\n        let sectionDataTrees = this.initSectionData(this.sectionData,'');\r\n        // this.sectionSort(sectionDataTrees);\r\n        // if(sectionDataTrees.length>1){\r\n            let sectionParent = [\r\n                {\r\n                    data:{\r\n                        id:'discussionParent',\r\n                        code:'parent',\r\n                        name: this.allOrg,\r\n                        layer: 0,\r\n                        parentId: \"\",\r\n                        sortOrder: 1,\r\n                        path: \"\",\r\n                    },\r\n                    children: [],\r\n                    personnels:{\r\n                        count:0,\r\n                        pageCount:0,\r\n                        pageIndex:1,\r\n                        pageSize:0,\r\n                        totalCount:0,\r\n                        users: []\r\n                    },\r\n                    parent: null,\r\n                    parents: [],\r\n                    parentsArr : [],\r\n                    checked:false\r\n                }\r\n            ];\r\n            sectionParent[0].children = sectionDataTrees;\r\n            sectionParent[0].children.sort((a, b):number => a.data['sortOrder'] - b.data['sortOrder']);\r\n            this.initSectionTree(sectionParent[0].children);\r\n            this.sectionDataTree = sectionParent;\r\n        // }\r\n        // else{\r\n        //     this.sectionDataTree = sectionDataTrees;\r\n        // }\r\n        //console.log(this.sectionDataTree);\r\n        if(this.sectionDataTree && this.sectionDataTree.length){\r\n            this.sectionDataTiled = this.tileSectionData(this.sectionDataTree);\r\n        }\r\n        //console.log(this.sectionDataTiled);\r\n        this.currentSection = this.sectionDataTree[0];\r\n        this.sectionCrumbs = this.sectionDataTree[0].children.length?this.sectionDataTree[0].children[0]['parentsArr']:[];\r\n        this.currentSectionData = this.sectionDataTree[0].children.length?this.sectionDataTree[0].children:[];\r\n        this.currentSectionId = this.sectionDataTree[0].data.id;\r\n        this.getPersonnel(this.currentSectionId,0).subscribe((d:any)=>{\r\n            if(d.hasOwnProperty(\"users\")){\r\n                this.sectionDataTree[0].personnels = d;\r\n                this.currentSectionPerson = this.sectionDataTree[0].personnels;\r\n                // console.log('cur',this.currentSectionPerson);\r\n            }\r\n        });\r\n\r\n        this.selectEmployee = this.localeService.getValue('discussionGroup.selectEmployee');\r\n        this.placeholder = this.localeService.getValue('discussionGroup.placeholder');\r\n        // console.log(this.sectionDataTiled);\r\n    }\r\n\r\n    initSectionTree(data,parentId=\"discussionParent\",  parentName = this.allOrg){\r\n        if(data && data.length){\r\n            data.forEach(item => {\r\n                let par = {\r\n                    id:parentId,\r\n                    name:parentName\r\n                };\r\n                item.parentsArr.unshift(par);\r\n                item.parents.unshift(parentId);\r\n                if(item.children.length){\r\n                    this.initSectionTree(item.children);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * åå§ååç»æ°æ®\r\n     */\r\n    initSectionData(data, parentId, parentIdField = 'parentId', idField = 'id') {\r\n        const nodes = new Map();\r\n        const result = [];\r\n        const unattached = [];\r\n        if(data && data.length){\r\n            data.forEach(t => {\r\n                const node = {\r\n                    data: t,\r\n                    children: [],\r\n                    personnels:{},\r\n                    parent: null,\r\n                    parents: [],\r\n                    parentsArr : [],\r\n                    checked: false\r\n                };\r\n                const id = t[idField];\r\n                nodes.set(id, node);\r\n                const PID = t[parentIdField];\r\n                if (PID === parentId || PID === null) {\r\n                    result.push(node);\r\n                } else {\r\n                    const parent = nodes.get(PID);\r\n                    // console.log(parent);\r\n                    if (parent) {\r\n                        let par = {\r\n                            id:PID,\r\n                            name:parent.data.name\r\n                        };\r\n                        node['parent'] = PID;\r\n                        node['parents'] = [...parent.parents, PID];\r\n                        node['parentsArr'] = [...parent.parentsArr, par];\r\n                        parent.children.push(node);\r\n                        parent.children.sort((a, b):number => a.data['sortOrder'] - b.data['sortOrder']);\r\n                    } else {\r\n                        unattached.push(node);\r\n                    }\r\n                }\r\n            });\r\n            if(unattached.length){\r\n                unattached.forEach(n => {\r\n                    const pid = n.data[parentIdField];\r\n                    const parent = nodes.get(pid);\r\n                    if (parent) {\r\n                        parent.children.push(n);\r\n                        parent.children.sort((a, b):number => a.data['sortOrder'] - b.data['sortOrder']);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    tileSectionData(nodes){\r\n        let r = [];\r\n        this.getAllNodes(nodes,r);\r\n        return r;\r\n    }\r\n    getAllNodes( nodes, r) {\r\n        nodes.forEach(n =>{\r\n            r.push(n);\r\n            if (n.children.length) {\r\n                this.getAllNodes(n.children, r);\r\n            }  \r\n        })\r\n    }\r\n    /**\r\n     * ç¹å»ä¸çº§\r\n     * @param section \r\n     */\r\n    sectionNext(section){\r\n        if(JSON.stringify(section.personnels) === '{}' && !section.hasOwnProperty('noPersonnel')){\r\n            section.personnels = {\r\n                count:0,\r\n                pageCount:0,\r\n                pageIndex:1,\r\n                pageSize:0,\r\n                totalCount:0,\r\n                users: []\r\n            };\r\n            this.getPersonnel(section.data.id,0).subscribe((d:any)=>{\r\n                if(d.hasOwnProperty(\"users\")){\r\n                    section.personnels.count = d['count'];\r\n                    section.personnels.pageCount = d['pageCount'];\r\n                    section.personnels.pageIndex = d['pageIndex'];\r\n                    section.personnels.pageSize = d['pageSize'];\r\n                    section.personnels.totalCount = d['totalCount'];\r\n                    section.personnels['users'] = [...section.personnels['users'],...d['users']];\r\n                }\r\n                else{\r\n                    section['noPersonnel'] = true;\r\n                }\r\n                this.getNextData(section);\r\n            })\r\n        }\r\n        else{\r\n            this.getNextData(section);\r\n        }\r\n    }\r\n    /**\r\n     * è·åä¸çº§æ°æ®\r\n     * @param section \r\n     */\r\n    getNextData(section){\r\n        if((section.children && section.children.length) || (JSON.stringify(section.personnels) !== '{}')){\r\n            const sec = this.getSectionById(section.data.id);\r\n            if(sec){\r\n                let secChecked = sec['checked'];\r\n                sec['disabled'] = secChecked?true:false;\r\n                if(!sec['indeterminate']){\r\n                    if(sec.children && sec.children.length){\r\n                        sec.children.forEach(item => {\r\n                            item['checked'] = secChecked;\r\n                            item['indeterminate'] = false;\r\n                            // item['disabled'] = sec['disabled'];\r\n                        });\r\n                    };\r\n                    if(section.personnels['users'] && section.personnels['users'].length){\r\n                        section.personnels['users'].forEach(user => {\r\n                            user['checked'] = secChecked;\r\n                            user['indeterminate'] = false;\r\n                            // user['disabled'] = sec['disabled'];\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            let secParent = {\r\n                id:sec.data.id,\r\n                name:sec.data.name\r\n            };\r\n            let secCrumbs = [...sec['parentsArr'],secParent];\r\n            this.sectionCrumbs = sec.children.length?sec.children[0]['parentsArr']:secCrumbs;\r\n            this.currentSectionData = sec.children.length?sec.children:[];\r\n            this.currentSection = sec;\r\n            this.currentSectionId = sec.data.id;\r\n            this.currentSectionPerson = sec.personnels;\r\n            setTimeout(() => {\r\n                this.initCrumbsList();\r\n            }, 0);\r\n            // console.log(this.currentSection);\r\n            this.cd.detectChanges();\r\n        }\r\n        else{\r\n            this.currentSectionPerson = [];\r\n        }\r\n    }\r\n\r\n    getPersonnel(ougId:string,pageIndex:number,pageSize:number = this.pageSize){\r\n        // let data = {};\r\n        if(this.orgUrl){\r\n            const url = `${this.orgUrl}?orgId=${ougId}&pageSize=${pageSize}&pageIndex=${pageIndex}`;\r\n            return this.http.get(url);\r\n            // if(ougId == 'langchao'){\r\n            //     return this.http.get('assets/data/discussionPerson.json');\r\n            // }\r\n            // else if(ougId == 'guoji'){\r\n            //     return this.http.get('assets/data/discussionPerson2.json');\r\n            // }\r\n            // else if(ougId == 'yanfa'){\r\n            //     return this.http.get('assets/data/discussionPerson3.json');\r\n            // }\r\n            // else{\r\n            //     return of(true);\r\n            // }\r\n        }\r\n        else{\r\n            return of(true);\r\n        }\r\n        // return data;\r\n    }\r\n\r\n    getSectionById(id){\r\n        let section = this.sectionDataTiled.find(sec=>{\r\n            return sec.data.id == id;\r\n        });\r\n        return section;\r\n    }\r\n    /**\r\n     * ç¹å»é¢åå±\r\n     * @param crumbs \r\n     */\r\n    crumbsClick(crumbs){\r\n        if(crumbs.id == this.currentSectionId) return;\r\n        const sec = this.getSectionById(crumbs.id);\r\n        this.sectionCrumbs = sec.children.length?sec.children[0]['parentsArr']:[];\r\n        this.currentSectionData = sec.children.length?sec.children:[];\r\n        this.currentSectionId = sec.data.id;\r\n        this.currentSectionPerson = sec.personnels;\r\n        this.currentSection = sec;\r\n        setTimeout(() => {\r\n            this.initCrumbsList();\r\n        }, 0);\r\n    }\r\n    /**\r\n     * é¨é¨æäººåç¶æåå\r\n     * @param event \r\n     * @param section \r\n     */\r\n    handleClick(event,section,type) {\r\n        if(this.currentSection.disabled) return;\r\n        event.stopPropagation();\r\n        section.checked = !section.checked;\r\n        section['indeterminate'] = false;\r\n        this.setSectionDataChecked();\r\n        if(section.checked){\r\n            let selectedData = {\r\n                parent:this.currentSection,\r\n                data:section\r\n            };\r\n            if(type == 'user'){\r\n                if (this._isSelectedInArray(section[this.listIdField], this.listIdField, this.selectedUsers)) {\r\n                    return;\r\n                }\r\n                else{\r\n                    this.selectedUsers.push(selectedData);\r\n                }\r\n            }\r\n            else if(type == 'section'){\r\n                this.addSection(section);\r\n            }\r\n        }\r\n        else{\r\n            if(type == 'user'){\r\n                if (this._isSelectedInArray(section[this.listIdField], this.listIdField, this.selectedUsers)) {\r\n                    this.selectedUsers.forEach((item, index) => {\r\n                        if (item['data'][this.listIdField] === section[this.listIdField]) {\r\n                            this.selectedUsers.splice(index, 1);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            else if(type == 'section'){\r\n                this.removeSection(section);\r\n            }\r\n        }\r\n        // console.log(this.selectedUsers,this.selectedSections);\r\n    }\r\n\r\n    handleSearchClick(event,user){\r\n        event.stopPropagation();\r\n        user.checked = !user.checked;\r\n        if(user.checked){\r\n            if (this._isSelectedInArray(user[this.listIdField], this.listIdField, this.selectedUsers)) {\r\n                return;\r\n            }\r\n            else{\r\n                let selectedData = {\r\n                    parent:null,\r\n                    data:user\r\n                };\r\n                this.selectedUsers.push(selectedData);\r\n            }\r\n        }\r\n        else{\r\n            if (this._isSelectedInArray(user[this.listIdField], this.listIdField, this.selectedUsers)) {\r\n                this.selectedUsers.forEach((item, index) => {\r\n                    if (item['data'][this.listIdField] === user[this.listIdField]) {\r\n                        this.selectedUsers.splice(index, 1);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n    \r\n    setSectionDataChecked(){\r\n        let curChecked:boolean = false;\r\n        let sec = this.currentSection;\r\n        let secArray:any = [];\r\n        if(sec.children || (sec.personnels['users'] && sec.personnels['users'].length)){\r\n            secArray = secArray.concat(sec.children,sec.personnels['users']);\r\n            let secCheckedList = secArray.filter(item=>{\r\n                if(item.hasOwnProperty('checked') && item['checked']){\r\n                    return item;\r\n                }\r\n            });\r\n            let secIndeList = sec.children.filter(item=>{\r\n                if(item.hasOwnProperty('indeterminate') && item['indeterminate']){\r\n                    return item;\r\n                }\r\n            })\r\n            this.currentSection['indeterminate'] = (secIndeList && secIndeList.length)? true : false;\r\n            if(secCheckedList && secCheckedList.length){\r\n                if(secCheckedList.length == secArray.length && sec.personnels.pageIndex >= sec.personnels.pageCount-1){\r\n                    curChecked = true;\r\n                }\r\n                else{\r\n                    this.currentSection['indeterminate'] = true;\r\n                }\r\n            }\r\n            else{\r\n                curChecked = false;\r\n            }\r\n            this.currentSection['checked'] = curChecked;\r\n            // console.log(this.currentSection);\r\n        }\r\n\r\n        if(this.currentSection.parents.length>0 && this.currentSection['indeterminate']){\r\n            this.currentSection.parents.forEach(par => {\r\n                const parSec = this.getSectionById(par);\r\n                if(parSec){\r\n                    parSec['indeterminate'] = this.currentSection['indeterminate'];\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    setChildDisabledStatus(status:boolean = true){\r\n        let sec = this.currentSection;\r\n        // sec['disabled'] = status;\r\n        if(sec.children || (sec.personnels['users'] && sec.personnels['users'].length)){\r\n            sec.children.forEach(item => {\r\n                item['disabled'] = status;\r\n            });\r\n            // sec['childDisabled'] = status;\r\n            sec.personnels['users'].forEach(user => {\r\n                user['disabled'] = status;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * äººåæ¥çæ´å¤\r\n     */\r\n    getMoreData(){\r\n        if(this.currentSectionId){\r\n            const sec = this.getSectionById(this.currentSectionId);\r\n            if(sec){\r\n                this.getPersonnel(this.currentSectionId, sec.personnels.pageIndex + 1).subscribe((d:any)=>{\r\n                    if(d.hasOwnProperty(\"users\")){\r\n                        sec.personnels.pageIndex = d['pageIndex'];\r\n                        sec.personnels['users'] = [...sec.personnels['users'],...d['users']];\r\n                        if(sec.personnels['users'].length){\r\n                            if(sec['checked']){\r\n                                sec.personnels['users'].forEach(user => {\r\n                                    user['checked'] = sec['checked'];\r\n                                });\r\n                            }\r\n                        }\r\n                        // this.setSectionDataChecked();\r\n                    }\r\n                    this.cd.detectChanges();\r\n                })\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * å¨é\r\n     * @param event \r\n     */\r\n    handleClickAll(event){\r\n        if(this.currentSection.disabled) return;\r\n        if(this.currentSection){\r\n            this.currentSection['checked'] = !this.currentSection['checked'];\r\n            this.currentSection['indeterminate'] = false;\r\n            let curChecked = this.currentSection['checked'];\r\n            this.currentSection.children.forEach(item => {\r\n                item['checked'] = curChecked;\r\n            });\r\n            if(JSON.stringify(this.currentSection.personnels) != '{}' && this.currentSection['personnels']['users'].length){\r\n                this.currentSection['personnels']['users'].forEach(user => {\r\n                    user['checked'] = curChecked;\r\n                });\r\n            }\r\n            if(curChecked){\r\n                this.addSection(this.currentSection)\r\n            }\r\n            else{\r\n                this.removeSection(this.currentSection);\r\n            }\r\n        }\r\n    }\r\n\r\n    addSection(section){\r\n        if (this._isSelectedInArray(section['data'][this.listIdField], this.listIdField, this.selectedSections)) {\r\n            return;\r\n        }\r\n        else{\r\n            this.selectedSections.push(section);\r\n        }\r\n    }\r\n    removeSection(section){\r\n        if (this._isSelectedInArray(section['data'][this.listIdField], this.listIdField, this.selectedSections)) {\r\n            this.selectedSections.forEach((item, index) => {\r\n                if (item['data'][this.listIdField] === section['data'][this.listIdField]) {\r\n                    this.selectedSections.splice(index, 1);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * æç´¢ç¨æ·\r\n     */\r\n    searchUser() {\r\n        if (this.searchText) {\r\n            this.showSearchList = true;\r\n            this.getSearchData(this.searchText,0).subscribe(d=>{\r\n                if(d.hasOwnProperty(\"users\")){\r\n                    this.searchUserList = d;\r\n                }\r\n            });\r\n        }\r\n        else{\r\n            this.showSearchList = false;\r\n        }\r\n    }\r\n    /**\r\n     * æç´¢äººåæ¥çæ´å¤\r\n     */\r\n    getMoreSearchData(){\r\n        if(this.searchText && this.personSearchUrl){\r\n            this.getSearchData(this.searchText,this.searchUserList.pageIndex + 1).subscribe(d=>{\r\n                if(d.hasOwnProperty(\"users\")){\r\n                    this.searchUserList.pageIndex = d['pageIndex'];\r\n                    this.searchUserList['users'] = [...this.searchUserList['users'],...d['users']];\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    getSearchData(text:string,pageIndex:number,pageSize:number = this.pageSize){\r\n        if(this.personSearchUrl){\r\n            const url = `${this.personSearchUrl}?param=${text}&pageSize=${pageSize}&pageIndex=${pageIndex}`;\r\n            return this.http.get(url);\r\n            //return this.http.get('assets/data/discussionPerson3.json');\r\n        }\r\n        else{\r\n            return of(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * éä¸­äººåæç»ç»å é¤\r\n     * @param data \r\n     * @param type \r\n     */\r\n    selectionRemove(data: any, type:string) {\r\n        if(!data) return;\r\n        if(type == 'user'){\r\n            let index = this.selectedUsers.findIndex(user => {\r\n                return user.data.id == data.data.id;\r\n            });\r\n            if(index >= 0 ){\r\n                this.selectedUsers.splice(index, 1);\r\n            }\r\n            data.data['checked'] = false;\r\n        }\r\n        else if(type == 'section'){\r\n            let index = this.selectedSections.findIndex(item => {\r\n                return item.data.id == data.data.id;\r\n            });\r\n            if(index >= 0 ){\r\n                this.selectedSections.splice(index, 1);\r\n            }\r\n            data['checked'] = false;\r\n        }\r\n        let dataParent = null;\r\n        if(type == 'section'){\r\n            dataParent = this.getSectionById(data.parent);\r\n        }\r\n        else if(type == 'user'){\r\n            dataParent = this.getSectionById(data.parent.data.id);\r\n        }\r\n        if(dataParent){\r\n            dataParent['checked'] = false;\r\n            if((dataParent.children && dataParent.children.length) || (dataParent.personnels.users && dataParent.personnels.users.length) ){\r\n                let childrens = dataParent.children.filter(child=>{\r\n                    return child['checked'];\r\n                });\r\n                let users = dataParent.personnels.users.filter(user=>{\r\n                    return user['checked'];\r\n                })\r\n                if((childrens && childrens.length) || (users && users.length)){\r\n                    dataParent['indeterminate'] = true;\r\n                }\r\n                else{\r\n                    dataParent['indeterminate'] = false;\r\n                }\r\n                if(dataParent.parents.length>0){\r\n                    dataParent.parents.forEach(par => {\r\n                        const parSec = this.getSectionById(par);\r\n                        if((parSec.children && parSec.children.length) || (parSec.personnels.users && parSec.personnels.users.length)){\r\n                            let parchildrens = parSec.children.filter(child=>{\r\n                                return child['checked'];\r\n                            });\r\n                            let parusers = parSec.personnels.users.filter(user=>{\r\n                                return user['checked'];\r\n                            })\r\n                            if((parchildrens && parchildrens.length) || (parusers && parusers.length)){\r\n                                parSec['indeterminate'] = true;\r\n                            }\r\n                            else{\r\n                                if(dataParent['indeterminate']){\r\n                                    parSec['indeterminate'] = dataParent['indeterminate'];\r\n                                }\r\n                                else{\r\n                                    parSec['indeterminate'] = false;\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * å é¤å³ä¾§å¨é¨æ°æ®\r\n     */\r\n    moveAllToLeft() {\r\n        this.selectedUsers.forEach(user=>{\r\n            user.data['checked'] = false;\r\n        });\r\n        this.selectedSections.forEach(item=>{\r\n            item['checked'] = false;\r\n        });\r\n        this.sectionDataTiled.forEach(sec => {\r\n            sec['indeterminate'] = false;\r\n            sec['checked'] = false;\r\n            sec['disabled'] = false;\r\n            if(JSON.stringify(sec.personnels) != '{}' && sec['personnels']['users'].length){\r\n                sec['personnels']['users'].forEach(user => {\r\n                    user['checked'] = false;\r\n                });\r\n            }\r\n        });\r\n        this.selectedUsers = [];\r\n        this.selectedSections = [];\r\n        this.cd.markForCheck();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param numberType 0ï¼åæ¶ï¼1ï¼ç¡®å®\r\n     */\r\n    returnResult(numberType: number) {\r\n        this.finalText = '';\r\n        if (numberType) {\r\n            // console.log(this.selectedUsers,this.selectedSections);\r\n            this.selectionsChange.emit({\r\n                info: 'confirm',\r\n                data: {\r\n                    users: this.selectedUsers,\r\n                    section: this.selectedSections\r\n                }\r\n            });\r\n            // this.selections.forEach(item => {\r\n            //     this.finalText += item[this.listDisplayText] + 'ï¼';\r\n            // })\r\n        } else {\r\n            this.selectionsChange.emit({\r\n                info: 'cancel',\r\n                data: {\r\n                    users: [],\r\n                    section: []\r\n                }\r\n            });\r\n        }\r\n        this.moveAllToLeft();\r\n        this.searchText = '';\r\n        this.searchUser();\r\n        this.personnelDialog.close();\r\n    }\r\n\r\n    initCrumbsList(){\r\n        const crumbsListWidth = this.crumbsList.nativeElement.offsetWidth - 30;\r\n        const crumbsListItems = this.crumbsList.nativeElement.children;\r\n        // console.log(crumbsListItems);\r\n        let crumbsListItemWidth = 0;\r\n        if(crumbsListItems && crumbsListItems.length){\r\n            for (let i = crumbsListItems.length - 1; i >= 0; i--) {\r\n                // console.log(crumbsListItems[i]);\r\n                this.renderer.setStyle(crumbsListItems[i],'display','flex');\r\n                let width = crumbsListItems[i].offsetWidth;\r\n                crumbsListItemWidth += width;\r\n                if(crumbsListItemWidth >= crumbsListWidth){\r\n                    this.renderer.setStyle(crumbsListItems[i],'display','none');\r\n                }\r\n                else{\r\n                    this.renderer.setStyle(crumbsListItems[i],'display','flex');\r\n                }\r\n                // console.log(width,crumbsListItemWidth,crumbsListWidth,i);\r\n            }\r\n        };\r\n        // console.log(crumbsListItemWidth,crumbsListWidth);\r\n        if(crumbsListItemWidth >= crumbsListWidth){\r\n            this.crumbsEllipsis = true;\r\n          }\r\n          else{\r\n            this.crumbsEllipsis = false;\r\n          }\r\n    }\r\n\r\n    crumbsMore(){\r\n        if(this.sectionCrumbs && this.sectionCrumbs.length){\r\n            this.crumbsClick(this.sectionCrumbs[0]);\r\n        }\r\n    }\r\n\r\n    _isInArray(value: string, field: string, array: any[]) {\r\n        if (!field || !value) {\r\n            throw new Error('å2ä¸ªåæ°å¿å¡«');\r\n        }\r\n        return array.find(item => value === item[field]) ? true : false;\r\n    }\r\n\r\n    _isSelectedInArray(value: string, field: string, array: any[]) {\r\n        if (!field || !value) {\r\n            throw new Error('å2ä¸ªåæ°å¿å¡«');\r\n        }\r\n        return array.find(item => value === item['data'][field]) ? true : false;\r\n    }\r\n\r\n    closeDialog(){\r\n        this.moveAllToLeft();\r\n        this.searchText = '';\r\n        this.searchUser();\r\n    }\r\n}","import { Directive, Input } from '@angular/core';\r\nimport { of } from 'rxjs';\r\nimport { discussionConfig } from './discussionList.interface';\r\nimport { DiscussionListService } from './discussion-list.service';\r\n\r\n@Directive({\r\n    selector: '[fDiscussionList]'\r\n})\r\nexport class DiscussionListDirective {\r\n    // private comments=[];\r\n    // @Input('discussionListData') \r\n    // set discussionListData(datas){\r\n    //     if(datas){\r\n    //         this.discussionListService.resetData(datas);\r\n    //         this.comments=[...datas];\r\n    //     }\r\n    // };\r\n    // get discussionListData(){\r\n    //     return this.comments;\r\n    // }\r\n\r\n    _discussionListData = [];\r\n    @Input() \r\n    set discussionListData(data) {\r\n      if(data){\r\n        this._discussionListData = data;\r\n        this.discussionListService.resetData(data);\r\n        // this.comments=[...data];\r\n      }\r\n    }\r\n    get discussionListData(){\r\n      return this._discussionListData;\r\n    }\r\n\r\n    constructor(private discussionListService:DiscussionListService) {\r\n    }\r\n}","\r\nimport { Pipe, PipeTransform } from \"@angular/core\";\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\n@Pipe({ name: 'safeHtml' })\r\nexport class SafeHtmlPipe implements PipeTransform {\r\n    constructor(private sanitized: DomSanitizer) { }\r\n\r\n    transform(value) {\r\n        return this.sanitized.bypassSecurityTrustHtml(value);\r\n    }\r\n}","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\n@Pipe({name: 'avatarHtml'})\r\nexport class AvatarHtmlPipe implements PipeTransform {\r\n    transform(item:any): string {\r\n        let str = item['name'];\r\n        if(str){\r\n            return str.substring(str.length-2,str.length);\r\n        }\r\n        else{\r\n            return '';\r\n        }\r\n    }\r\n}\r\n\r\n@Pipe({name: 'getOrgText'})\r\nexport class GetOrgTextPipe implements PipeTransform {\r\n    transform(item:any, orgs: any[]): string {\r\n        let str = item['orgId'];\r\n        if(orgs && orgs.length){\r\n            let sec = orgs.find(org => {\r\n                return org['id'] == str;\r\n            });\r\n            let orgtext = '';\r\n            if(sec){\r\n                if(sec['parentId'] != ''){\r\n                    let par = orgs.find(org => {\r\n                        return org['id'] == sec['parentId'];\r\n                    });\r\n                    orgtext = par ? `${par.name}/${sec['name']}`:sec['name'];\r\n                }\r\n                else{\r\n                    orgtext = sec['name'];\r\n                }\r\n            }\r\n            return orgtext;\r\n        }\r\n        else {\r\n            return '';\r\n        }\r\n    }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule,registerLocaleData } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { SafeHtmlPipe } from './pipe/safe-html.pipe';\r\nimport { DiscussionListComponent } from './discussion-list/discussion-list.component';\r\nimport { DiscussionEditorComponent } from './discussion-editor/discussion-editor.component';\r\nimport { FarrisDialogModule } from '@farris/ui-dialog';\r\nimport { FarrisCommonModule } from '@farris/ui-common';\r\nimport { TreeModule } from '@farris/ui-tree';\r\nimport { ModalModule, BsModalService } from '@farris/ui-modal';\r\nimport { LoadingModule } from '@farris/ui-loading';\r\nimport { LocaleModule } from '@farris/ui-locale';\r\nimport { ComponentLoaderFactory } from '@farris/ui-modal/component-loader';\r\nimport { PositioningService } from '@farris/ui-modal/positioning';\r\nimport { PerfectScrollbarModule } from '@farris/ui-perfect-scrollbar';\r\nimport { DiscussionPersonnelComponent } from './discussion-personnel/discussion-personnel.component';\r\nimport { PaginationModule } from '@farris/ui-pagination';\r\nimport { DiscussionListService } from './discussion-list/discussion-list.service';\r\nimport { DiscussionListDirective } from './discussion-list/discussionList.directive';\r\nimport { FFileUploadModule } from '@farris/extend-file-upload';\r\nimport { NotifyModule } from '@farris/ui-notify';\r\nimport { InputGroupModule } from '@farris/ui-input-group';\r\n\r\nimport zh from '@angular/common/locales/zh';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { AvatarHtmlPipe, GetOrgTextPipe } from './pipe/controlType.pipe';\r\nregisterLocaleData(zh);\r\n\r\n@NgModule({\r\n  declarations: [DiscussionEditorComponent, DiscussionListComponent, DiscussionPersonnelComponent, SafeHtmlPipe, AvatarHtmlPipe,GetOrgTextPipe,DiscussionListDirective],\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ModalModule,\r\n    FarrisDialogModule,\r\n    FarrisCommonModule,\r\n    LoadingModule,\r\n    PerfectScrollbarModule,\r\n    TreeModule,\r\n    PaginationModule,\r\n    FFileUploadModule,\r\n    NotifyModule,\r\n    HttpClientModule,\r\n    LocaleModule.forRoot(),\r\n    InputGroupModule\r\n  ],\r\n  providers: [\r\n      BsModalService,\r\n      ComponentLoaderFactory,\r\n      PositioningService,\r\n      DiscussionListService\r\n  ],\r\n  exports: [DiscussionEditorComponent, DiscussionListComponent, DiscussionPersonnelComponent, SafeHtmlPipe, AvatarHtmlPipe,GetOrgTextPipe,DiscussionListDirective],\r\n  entryComponents: [ DiscussionPersonnelComponent]\r\n})\r\nexport class DiscussionGroupModule { }\r\n"]}