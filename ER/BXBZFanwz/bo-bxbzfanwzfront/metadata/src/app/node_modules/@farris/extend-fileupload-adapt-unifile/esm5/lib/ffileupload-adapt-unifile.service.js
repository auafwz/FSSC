/**
 * @fileoverview added by tsickle
 * Generated from: lib/ffileupload-adapt-unifile.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { UploadServerService, UploadStatus } from '@farris/extend-file-upload';
import { Observable, forkJoin } from 'rxjs';
import { UploadService, GspFormUploadListEntity, GspFormRemoveListEntity, GspFormDocInfo, GspFormUploadEntity, OperatingModes } from '@gsp-svc/formdoc-upload';
import { FFileUploadAdaptUnifileConfigService } from './ffileupload-adapt-unifile.config';
import * as i0 from "@angular/core";
import * as i1 from "@gsp-svc/formdoc-upload";
import * as i2 from "./ffileupload-adapt-unifile.config";
var FfileuploadAdaptUnifileService = /** @class */ (function (_super) {
    tslib_1.__extends(FfileuploadAdaptUnifileService, _super);
    function FfileuploadAdaptUnifileService(uploadSer, configSer) {
        var _this = _super.call(this) || this;
        _this.uploadSer = uploadSer;
        _this.configSer = configSer;
        // 暂时用于简单合并
        _this.bufferSize = 1024 * 1024; // 1024 * 1024
        _this.uploadedChunk = {};
        _this.fileTotalChunk = {};
        _this.extendData = _this.configSer.getConfig();
        return _this;
    }
    /**
     * @private
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.uuid = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var S4 = (/**
         * @return {?}
         */
        function () {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        });
        /** @type {?} */
        var nGuid = S4() + S4() + S4() + S4() + S4() + S4() + S4() + S4();
        return nGuid;
    };
    /**
     * 删除文件
     * @param file
     * @param event
     */
    /**
     * 删除文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.remove = /**
     * 删除文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        return this.innerRemoveList(files, event, extendService);
    };
    /**
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?=} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.innerRemoveList = /**
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?=} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        var _this = this;
        if (extendService === void 0) { extendService = null; }
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            /** @type {?} */
            var removeFileInfo = new GspFormRemoveListEntity;
            /** @type {?} */
            var metadataIdList = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            function (fileItem) {
                if (fileItem['response']) {
                    metadataIdList.push(fileItem['response']['metadataId']);
                }
            }));
            removeFileInfo.mode = _this.getFinallyConfig('mode', extendService);
            /** @type {?} */
            var rootId = _this.getFinallyConfig('rootId', extendService);
            removeFileInfo.metadataIdList = [].concat(metadataIdList);
            _this.uploadSer.removeList(metadataIdList, rootId).subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                // 没有需要整合的服务器端返回数据
                observer.next({ type: 'removed', files: files });
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                observer.error(error);
                observer.complete();
            }), (/**
             * @return {?}
             */
            function () {
                observer.complete();
            }));
        }));
    };
    /**
     * 上传文件
     * @param file
     * @param event
     */
    /**
     * 上传文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.upload = /**
     * 上传文件
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        return this.innerUploadList(files, event, extendService);
    };
    /**
     * 内部上传方式
     * @param files
     * @param event
     * @param extendService
     */
    /**
     * 内部上传方式
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.innerUploadList = /**
     * 内部上传方式
     * @private
     * @param {?} files
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (files, event, extendService) {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            /** @type {?} */
            var uploadInfo = new GspFormUploadListEntity;
            uploadInfo.formId = _this.getFinallyConfig('formId', extendService);
            uploadInfo.mode = _this.getFinallyConfig('mode', extendService);
            /** @type {?} */
            var rootId = _this.getFinallyConfig('rootId', extendService);
            uploadInfo.docInfoList = [];
            /** @type {?} */
            var readerObserable = [];
            files.forEach((/**
             * @param {?} fileItem
             * @return {?}
             */
            function (fileItem) {
                /** @type {?} */
                var sub = new Observable((/**
                 * @param {?} obser
                 * @return {?}
                 */
                function (obser) {
                    /** @type {?} */
                    var reader = new FileReader();
                    // 暂不处理异常
                    reader.readAsBinaryString(fileItem.nativeFile);
                    reader.onload = (/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) {
                        /** @type {?} */
                        var info = (/** @type {?} */ ({ 'fileName': '', 'fileContent': '' }));
                        info['fileName'] = fileItem.name;
                        info['fileContent'] = btoa(reader.result.toString());
                        // 如果data里有数据，并且属性是配置的扩展属性
                        if (event.hasOwnProperty('data') && event['data'] && event['data'].hasOwnProperty('extProperty')) {
                            // 
                            info['extProperty'] = event['data']['extProperty'];
                        }
                        uploadInfo.docInfoList.push(info);
                        obser.next();
                        obser.complete();
                    });
                }));
                readerObserable.push(sub);
            }));
            forkJoin(readerObserable).subscribe((/**
             * @param {?} datas
             * @return {?}
             */
            function (datas) {
                //     metadataId: string;
                //  fileName: string;
                _this.uploadSer.uploadList(uploadInfo, rootId).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    if (result.error) {
                        // 此接口一旦出现问题，所有附件都上传不通过
                        observer.error(_this.errorInfoFormat(result.error, files));
                        observer.complete();
                        return;
                    }
                    // 合并返回结果到此处
                    result.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        /** @type {?} */
                        var findIndex = _this.findFileIndexByFileName(files, item.fileName);
                        if (findIndex > -1) {
                            files[findIndex]['response'] = item;
                            files[findIndex]['progress']['status'] = UploadStatus.Done;
                        }
                    }));
                    observer.next({ type: 'done', files: files });
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    observer.error(_this.errorInfoFormat(error, files));
                    observer.complete();
                }), (/**
                 * @return {?}
                 */
                function () {
                    observer.complete();
                }));
            }));
        }));
    };
    ;
    /**
     * 分片加载
     * @param file
     * @param event
     * @param extendService
     */
    /**
     * 分片加载
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.multipartUpload = /**
     * 分片加载
     * @param {?} file
     * @param {?} event
     * @param {?} extendService
     * @return {?}
     */
    function (file, event, extendService) {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            // let fileInfo: FileInfo;
            /** @type {?} */
            var uuid = _this.uuid();
            // let uuid = UUID.UUID();
            //reader.readAsBinaryString(selectedFile);
            //reader.onload = (e) => {
            /** @type {?} */
            var fileName = file.name;
            // fileInfo = {
            //   id: uuid,
            //   name: fileName,
            //   type: file.type,
            //   source: "",
            //   size: this.formatFileSize(file.size),
            //   fileSize: file.size,
            //   picListDisplayName: this.getMultipartDisplayName(fileName),
            //   queueListDisplayName: fileName,
            //   //content: reader.result.toString(),
            //   hasUploaded: false,
            //   mouseOn: false,
            //   selectd: false,
            //   isUploading: true,
            //   uploadResult: false,
            //   uploadProcess: 0,
            //   errorMessage: "",
            //   extensionDropListId: 0,
            //   extensionName: ""
            // }
            /** @type {?} */
            var chunkTotal = Math.ceil(file.size / _this.bufferSize);
            // 标记当前附件总的分片数
            _this.fileTotalChunk[uuid] = chunkTotal;
            /** @type {?} */
            var chunkIndex = 0;
            // 标记当前附件成功的分片数
            _this.uploadedChunk[uuid] = 0;
            var _loop_1 = function () {
                /** @type {?} */
                var uploadInfo = new GspFormUploadEntity;
                uploadInfo.mode = OperatingModes.Temp;
                uploadInfo.formId = _this.getFinallyConfig('formId', extendService);
                uploadInfo.rootId = _this.getFinallyConfig('rootId', extendService);
                /** @type {?} */
                var docInfo = new GspFormDocInfo;
                docInfo.fileName = fileName;
                docInfo.metadataId = uuid;
                docInfo.total = chunkTotal;
                // 如果data里有数据，并且属性是配置的扩展属性
                if (event.hasOwnProperty('data') && event['data'] && event['data'].hasOwnProperty('extProperty')) {
                    docInfo['extProperty'] = (/** @type {?} */ (event['data']['extProperty']));
                }
                // 下一个文件大小
                /** @type {?} */
                var nextSize = Math.min((chunkIndex + 1) * _this.bufferSize, file.size);
                // File类型
                /** @type {?} */
                var fileData = file['nativeFile'].slice(chunkIndex * _this.bufferSize, nextSize);
                // 读取文件
                /** @type {?} */
                var reader = new FileReader();
                reader.readAsBinaryString(fileData);
                /** @type {?} */
                var innerIndex = chunkIndex;
                reader.onload = (/**
                 * @return {?}
                 */
                function () {
                    // 附件上传
                    docInfo.fileContent = btoa(reader.result.toString());
                    docInfo.index = innerIndex;
                    uploadInfo.docInfo = docInfo;
                    /** @type {?} */
                    var info = uploadInfo;
                    _this.uploadSer.uploadFile(info).subscribe((/**
                     * @param {?} result
                     * @return {?}
                     */
                    function (result) {
                        if (result && result.error) {
                            // 分片上传有返回结果就是报错了
                            observer.error(_this.errorInfoFormat(result.error, [file]));
                            observer.complete();
                            return;
                        }
                        else {
                            _this.uploadedChunk[uuid]++;
                            if (_this.uploadedChunk[docInfo.metadataId] == _this.fileTotalChunk[docInfo.metadataId]) {
                                // 判断是所有分片都上传完成
                                file.progress = {
                                    status: UploadStatus.Done,
                                    data: {
                                        percentage: 100
                                    }
                                };
                                file.response = docInfo;
                                delete _this.uploadedChunk[uuid];
                                delete _this.fileTotalChunk[uuid];
                                observer.next({ type: 'done', files: [file] });
                                observer.complete();
                            }
                            else {
                                // 分片上传正常
                                /** @type {?} */
                                var percentage = Number.parseInt((_this.uploadedChunk[uuid] / _this.fileTotalChunk[uuid] * 100).toFixed(0));
                                // 判断未上传完成
                                file.progress = {
                                    status: UploadStatus.Uploading,
                                    data: {
                                        percentage: percentage
                                    }
                                };
                                observer.next({ type: 'uploading', files: [file] });
                            }
                        }
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    function (error) {
                        delete _this.uploadedChunk[uuid];
                        delete _this.fileTotalChunk[uuid];
                        observer.error(_this.errorInfoFormat(error, [file]));
                        observer.complete();
                    }));
                });
                chunkIndex = chunkIndex + 1;
            };
            while (chunkIndex < chunkTotal) {
                _loop_1();
            }
        }));
    };
    /**
     * 获取分片的附件大小
     * @param size
     */
    /**
     * 获取分片的附件大小
     * @private
     * @param {?} size
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.formatFileSize = /**
     * 获取分片的附件大小
     * @private
     * @param {?} size
     * @return {?}
     */
    function (size) {
        if (size < 102400)
            return (size / 1024).toFixed(1) + "K";
        else if (size < 1024 * 1024)
            return (size / 1024).toFixed(0) + "K";
        else if (size < 100 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(1) + "M";
        else if (size < 1024 * 1024 * 1024)
            return (size / 1024 / 1024).toFixed(0) + "M";
        else
            return (size / 1024 / 1024 / 1024).toFixed(1) + "G";
    };
    /**
     * 获取分片的 附件名称
     * @param fileName
     */
    /**
     * 获取分片的 附件名称
     * @private
     * @param {?} fileName
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.getMultipartDisplayName = /**
     * 获取分片的 附件名称
     * @private
     * @param {?} fileName
     * @return {?}
     */
    function (fileName) {
        if (fileName.length <= 10)
            return fileName;
        else {
            /** @type {?} */
            var headContent = fileName.substring(0, 2);
            /** @type {?} */
            var tailContent = fileName.substring(fileName.lastIndexOf('.') - 2);
            return headContent + "…" + tailContent;
        }
    };
    /**
     * @private
     * @param {?} error
     * @param {?} files
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.errorInfoFormat = /**
     * @private
     * @param {?} error
     * @param {?} files
     * @return {?}
     */
    function (error, files) {
        // 
        /** @type {?} */
        var errorFiles = files.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return { id: item.id, name: item.name };
        }));
        if (error) {
            return Object.assign(error, { files: errorFiles }, { message: error['Message'] || error['extensionMessage'] || '上传失败', type: 'error' });
        }
        else {
            return Object.assign({ files: errorFiles }, { message: '上传失败', type: 'error' });
        }
    };
    /**
     * 返回最终属性值
     * @param key
     * @param configValue
     * @param extendValue
     */
    /**
     * 返回最终属性值
     * @private
     * @param {?} key
     * @param {?} extendValue
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.getFinallyConfig = /**
     * 返回最终属性值
     * @private
     * @param {?} key
     * @param {?} extendValue
     * @return {?}
     */
    function (key, extendValue) {
        if (extendValue && extendValue.hasOwnProperty(key)) {
            return extendValue[key];
        }
        return this.extendData[key];
    };
    /**
     * @private
     * @param {?} files
     * @param {?} fileName
     * @return {?}
     */
    FfileuploadAdaptUnifileService.prototype.findFileIndexByFileName = /**
     * @private
     * @param {?} files
     * @param {?} fileName
     * @return {?}
     */
    function (files, fileName) {
        // 按照肯定能找到文件来处理
        /** @type {?} */
        var findIndex = files.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        function (file) { return file.name == fileName; }));
        return findIndex;
    };
    // 1024 * 1024
    FfileuploadAdaptUnifileService.previous = 0;
    FfileuploadAdaptUnifileService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    FfileuploadAdaptUnifileService.ctorParameters = function () { return [
        { type: UploadService },
        { type: FFileUploadAdaptUnifileConfigService }
    ]; };
    /** @nocollapse */ FfileuploadAdaptUnifileService.ngInjectableDef = i0.defineInjectable({ factory: function FfileuploadAdaptUnifileService_Factory() { return new FfileuploadAdaptUnifileService(i0.inject(i1.UploadService), i0.inject(i2.FFileUploadAdaptUnifileConfigService)); }, token: FfileuploadAdaptUnifileService, providedIn: "root" });
    return FfileuploadAdaptUnifileService;
}(UploadServerService));
export { FfileuploadAdaptUnifileService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.previous;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.extendData;
    /** @type {?} */
    FfileuploadAdaptUnifileService.prototype.bufferSize;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadedChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.fileTotalChunk;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.uploadSer;
    /**
     * @type {?}
     * @private
     */
    FfileuploadAdaptUnifileService.prototype.configSer;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmZpbGV1cGxvYWQtYWRhcHQtdW5pZmlsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9leHRlbmQtZmlsZXVwbG9hZC1hZGFwdC11bmlmaWxlLyIsInNvdXJjZXMiOlsibGliL2ZmaWxldXBsb2FkLWFkYXB0LXVuaWZpbGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxtQkFBbUIsRUFBMkIsWUFBWSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDeEcsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLGFBQWEsRUFBRSx1QkFBdUIsRUFBRSx1QkFBdUIsRUFBRSxjQUFjLEVBQUUsbUJBQW1CLEVBQVksY0FBYyxFQUFzQixNQUFNLHlCQUF5QixDQUFDO0FBQzdMLE9BQU8sRUFBRSxvQ0FBb0MsRUFBaUMsTUFBTSxvQ0FBb0MsQ0FBQzs7OztBQUV6SDtJQUdvRCwwREFBbUI7SUFPckUsd0NBQW9CLFNBQXdCLEVBQVUsU0FBK0M7UUFBckcsWUFDRSxpQkFBTyxTQUVSO1FBSG1CLGVBQVMsR0FBVCxTQUFTLENBQWU7UUFBVSxlQUFTLEdBQVQsU0FBUyxDQUFzQzs7UUFMckcsZ0JBQVUsR0FBRyxJQUFJLEdBQUMsSUFBSSxDQUFDLENBQUEsY0FBYztRQUU3QixtQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixvQkFBYyxHQUFHLEVBQUUsQ0FBQztRQUkxQixLQUFJLENBQUMsVUFBVSxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUM7O0lBQy9DLENBQUM7Ozs7O0lBRU8sNkNBQUk7Ozs7SUFBWjs7WUFDTyxFQUFFOzs7UUFBRztZQUNSLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxH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RCxDQUdvRCxtQkFBbUIsR0FtVHRFO1NBblRZLDhCQUE4Qjs7Ozs7O0lBR3pDLHdDQUE0Qjs7SUFGNUIsb0RBQVc7O0lBQ1gsb0RBQXVCOzs7OztJQUV2Qix1REFBMkI7Ozs7O0lBQzNCLHdEQUE0Qjs7Ozs7SUFFaEIsbURBQWdDOzs7OztJQUFFLG1EQUF1RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVXBsb2FkU2VydmVyU2VydmljZSwgVXBsb2FkRmlsZSwgVXBsb2FkSW5wdXQsIFVwbG9hZFN0YXR1cyB9IGZyb20gJ0BmYXJyaXMvZXh0ZW5kLWZpbGUtdXBsb2FkJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZm9ya0pvaW4gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVXBsb2FkU2VydmljZSwgR3NwRm9ybVVwbG9hZExpc3RFbnRpdHksIEdzcEZvcm1SZW1vdmVMaXN0RW50aXR5LCBHc3BGb3JtRG9jSW5mbywgR3NwRm9ybVVwbG9hZEVudGl0eSwgRmlsZUluZm8sIE9wZXJhdGluZ01vZGVzLCBHc3BEb2NNZXRhUHJvcGVydHkgfSBmcm9tICdAZ3NwLXN2Yy9mb3JtZG9jLXVwbG9hZCc7XHJcbmltcG9ydCB7IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnU2VydmljZSwgRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWcgfSBmcm9tICcuL2ZmaWxldXBsb2FkLWFkYXB0LXVuaWZpbGUuY29uZmlnJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZmaWxldXBsb2FkQWRhcHRVbmlmaWxlU2VydmljZSBleHRlbmRzIFVwbG9hZFNlcnZlclNlcnZpY2Uge1xyXG4gIGV4dGVuZERhdGE7Ly8g5pqC5pe255So5LqO566A5Y2V5ZCI5bm2XHJcbiAgYnVmZmVyU2l6ZSA9IDEwMjQqMTAyNDsvLyAxMDI0ICogMTAyNFxyXG4gIHByaXZhdGUgc3RhdGljIHByZXZpb3VzID0gMDtcclxuICBwcml2YXRlIHVwbG9hZGVkQ2h1bmsgPSB7fTtcclxuICBwcml2YXRlIGZpbGVUb3RhbENodW5rID0ge307XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdXBsb2FkU2VyOiBVcGxvYWRTZXJ2aWNlLCBwcml2YXRlIGNvbmZpZ1NlcjogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWdTZXJ2aWNlKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5leHRlbmREYXRhID0gdGhpcy5jb25maWdTZXIuZ2V0Q29uZmlnKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHV1aWQoKSB7XHJcbiAgICBsZXQgIFM0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICByZXR1cm4gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xyXG4gICAgfTtcclxuICAgIGxldCBuR3VpZCA9IFM0KCkgKyBTNCgpICsgIFM0KCkgKyAgUzQoKSArICBTNCgpICsgIFM0KCkgKyBTNCgpICsgUzQoKTtcclxuICAgIHJldHVybiBuR3VpZDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5paH5Lu2XHJcbiAgICogQHBhcmFtIGZpbGUgXHJcbiAgICogQHBhcmFtIGV2ZW50IFxyXG4gICAqL1xyXG4gIHJlbW92ZShmaWxlczogVXBsb2FkRmlsZVtdLCBldmVudDogVXBsb2FkSW5wdXQsIGV4dGVuZFNlcnZpY2U6IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmlubmVyUmVtb3ZlTGlzdChmaWxlcywgZXZlbnQsIGV4dGVuZFNlcnZpY2UpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbm5lclJlbW92ZUxpc3QoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0LCBleHRlbmRTZXJ2aWNlID0gbnVsbCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gICAgICBsZXQgcmVtb3ZlRmlsZUluZm8gPSBuZXcgR3NwRm9ybVJlbW92ZUxpc3RFbnRpdHk7XHJcbiAgICAgIGxldCBtZXRhZGF0YUlkTGlzdCA9IFtdO1xyXG4gICAgICBmaWxlcy5mb3JFYWNoKGZpbGVJdGVtID0+IHtcclxuICAgICAgICBpZiAoZmlsZUl0ZW1bJ3Jlc3BvbnNlJ10pIHtcclxuICAgICAgICAgIG1ldGFkYXRhSWRMaXN0LnB1c2goZmlsZUl0ZW1bJ3Jlc3BvbnNlJ11bJ21ldGFkYXRhSWQnXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlbW92ZUZpbGVJbmZvLm1vZGUgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ21vZGUnLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgbGV0IHJvb3RJZCA9IHRoaXMuZ2V0RmluYWxseUNvbmZpZygncm9vdElkJywgZXh0ZW5kU2VydmljZSk7XHJcbiAgICAgIHJlbW92ZUZpbGVJbmZvLm1ldGFkYXRhSWRMaXN0ID0gW10uY29uY2F0KG1ldGFkYXRhSWRMaXN0KTtcclxuXHJcbiAgICAgIHRoaXMudXBsb2FkU2VyLnJlbW92ZUxpc3QobWV0YWRhdGFJZExpc3QsIHJvb3RJZCkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgLy8g5rKh5pyJ6ZyA6KaB5pW05ZCI55qE5pyN5Yqh5Zmo56uv6L+U5Zue5pWw5o2uXHJcbiAgICAgICAgb2JzZXJ2ZXIubmV4dCh7IHR5cGU6ICdyZW1vdmVkJywgZmlsZXM6IGZpbGVzIH0pO1xyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgIH0sICgpID0+IHtcclxuICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkuIrkvKDmlofku7ZcclxuICAgKiBAcGFyYW0gZmlsZSBcclxuICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICovXHJcbiAgdXBsb2FkKGZpbGVzOiBVcGxvYWRGaWxlW10sIGV2ZW50OiBVcGxvYWRJbnB1dCwgZXh0ZW5kU2VydmljZTogRkZpbGVVcGxvYWRBZGFwdFVuaWZpbGVDb25maWcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJVcGxvYWRMaXN0KGZpbGVzLCBldmVudCwgZXh0ZW5kU2VydmljZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWGhemDqOS4iuS8oOaWueW8j1xyXG4gICAqIEBwYXJhbSBmaWxlcyBcclxuICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICogQHBhcmFtIGV4dGVuZFNlcnZpY2UgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbm5lclVwbG9hZExpc3QoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0LCBleHRlbmRTZXJ2aWNlOiBGRmlsZVVwbG9hZEFkYXB0VW5pZmlsZUNvbmZpZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG5cclxuICAgICAgbGV0IHVwbG9hZEluZm8gPSBuZXcgR3NwRm9ybVVwbG9hZExpc3RFbnRpdHk7XHJcbiAgICAgIHVwbG9hZEluZm8uZm9ybUlkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdmb3JtSWQnLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgdXBsb2FkSW5mby5tb2RlID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdtb2RlJywgZXh0ZW5kU2VydmljZSk7XHJcblxyXG4gICAgICBsZXQgcm9vdElkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdyb290SWQnLCBleHRlbmRTZXJ2aWNlKTtcclxuICAgICAgdXBsb2FkSW5mby5kb2NJbmZvTGlzdCA9IFtdO1xyXG4gICAgICBsZXQgcmVhZGVyT2JzZXJhYmxlOiBPYnNlcnZhYmxlPGFueT5bXSA9IFtdO1xyXG4gICAgICBmaWxlcy5mb3JFYWNoKChmaWxlSXRlbTogVXBsb2FkRmlsZSkgPT4ge1xyXG4gICAgICAgIGxldCBzdWIgPSBuZXcgT2JzZXJ2YWJsZShvYnNlciA9PiB7XHJcbiAgICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgIC8vIOaaguS4jeWkhOeQhuW8guW4uFxyXG4gICAgICAgICAgcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlSXRlbS5uYXRpdmVGaWxlKTtcclxuICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgaW5mbyA9IHsgJ2ZpbGVOYW1lJzogJycsICdmaWxlQ29udGVudCc6ICcnIH0gYXMgYW55O1xyXG4gICAgICAgICAgICBpbmZvWydmaWxlTmFtZSddID0gZmlsZUl0ZW0ubmFtZTtcclxuICAgICAgICAgICAgaW5mb1snZmlsZUNvbnRlbnQnXSA9IGJ0b2EocmVhZGVyLnJlc3VsdC50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgLy8g5aaC5p6cZGF0YemHjOacieaVsOaNru+8jOW5tuS4lOWxnuaAp+aYr+mFjee9rueahOaJqeWxleWxnuaAp1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSAmJiBldmVudFsnZGF0YSddICYmIGV2ZW50WydkYXRhJ10uaGFzT3duUHJvcGVydHkoJ2V4dFByb3BlcnR5JykpIHtcclxuICAgICAgICAgICAgICAvLyBcclxuICAgICAgICAgICAgICBpbmZvWydleHRQcm9wZXJ0eSddID0gZXZlbnRbJ2RhdGEnXVsnZXh0UHJvcGVydHknXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB1cGxvYWRJbmZvLmRvY0luZm9MaXN0LnB1c2goaW5mbyk7XHJcbiAgICAgICAgICAgIG9ic2VyLm5leHQoKTtcclxuICAgICAgICAgICAgb2JzZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZWFkZXJPYnNlcmFibGUucHVzaChzdWIpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGZvcmtKb2luKHJlYWRlck9ic2VyYWJsZSkuc3Vic2NyaWJlKGRhdGFzID0+IHtcclxuICAgICAgICAvLyAgICAgbWV0YWRhdGFJZDogc3RyaW5nO1xyXG4gICAgICAgIC8vICBmaWxlTmFtZTogc3RyaW5nO1xyXG4gICAgICAgIHRoaXMudXBsb2FkU2VyLnVwbG9hZExpc3QodXBsb2FkSW5mbywgcm9vdElkKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICAgICAgLy8g5q2k5o6l5Y+j5LiA5pem5Ye6546w6Zeu6aKY77yM5omA5pyJ6ZmE5Lu26YO95LiK5Lyg5LiN6YCa6L+HXHJcbiAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KHJlc3VsdC5lcnJvciwgZmlsZXMpKTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgLy8g5ZCI5bm26L+U5Zue57uT5p6c5Yiw5q2k5aSEXHJcbiAgICAgICAgICByZXN1bHQuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgdmFyIGZpbmRJbmRleCA9IHRoaXMuZmluZEZpbGVJbmRleEJ5RmlsZU5hbWUoZmlsZXMsIGl0ZW0uZmlsZU5hbWUpO1xyXG4gICAgICAgICAgICBpZiAoZmluZEluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICBmaWxlc1tmaW5kSW5kZXhdWydyZXNwb25zZSddID0gaXRlbTtcclxuICAgICAgICAgICAgICBmaWxlc1tmaW5kSW5kZXhdWydwcm9ncmVzcyddWydzdGF0dXMnXSA9IFVwbG9hZFN0YXR1cy5Eb25lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KHsgdHlwZTogJ2RvbmUnLCBmaWxlczogZmlsZXMgfSk7XHJcblxyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGVycm9yLCBmaWxlcykpO1xyXG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH07XHJcbiAgLyoqXHJcbiAgICog5YiG54mH5Yqg6L29XHJcbiAgICogQHBhcmFtIGZpbGUgXHJcbiAgICogQHBhcmFtIGV2ZW50IFxyXG4gICAqIEBwYXJhbSBleHRlbmRTZXJ2aWNlIFxyXG4gICAqL1xyXG4gIG11bHRpcGFydFVwbG9hZChmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQsIGV4dGVuZFNlcnZpY2U6IEZGaWxlVXBsb2FkQWRhcHRVbmlmaWxlQ29uZmlnKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuXHJcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG5cclxuICAgICAvLyBsZXQgZmlsZUluZm86IEZpbGVJbmZvO1xyXG4gICAgICBsZXQgdXVpZCA9IHRoaXMudXVpZCgpO1xyXG4gICAgICAvLyBsZXQgdXVpZCA9IFVVSUQuVVVJRCgpO1xyXG4gICAgICAvL3JlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoc2VsZWN0ZWRGaWxlKTtcclxuICAgICAgLy9yZWFkZXIub25sb2FkID0gKGUpID0+IHtcclxuICAgICAgbGV0IGZpbGVOYW1lID0gZmlsZS5uYW1lO1xyXG4gICAgICAvLyBmaWxlSW5mbyA9IHtcclxuICAgICAgLy8gICBpZDogdXVpZCxcclxuICAgICAgLy8gICBuYW1lOiBmaWxlTmFtZSxcclxuICAgICAgLy8gICB0eXBlOiBmaWxlLnR5cGUsXHJcbiAgICAgIC8vICAgc291cmNlOiBcIlwiLFxyXG4gICAgICAvLyAgIHNpemU6IHRoaXMuZm9ybWF0RmlsZVNpemUoZmlsZS5zaXplKSxcclxuICAgICAgLy8gICBmaWxlU2l6ZTogZmlsZS5zaXplLFxyXG4gICAgICAvLyAgIHBpY0xpc3REaXNwbGF5TmFtZTogdGhpcy5nZXRNdWx0aXBhcnREaXNwbGF5TmFtZShmaWxlTmFtZSksXHJcbiAgICAgIC8vICAgcXVldWVMaXN0RGlzcGxheU5hbWU6IGZpbGVOYW1lLFxyXG4gICAgICAvLyAgIC8vY29udGVudDogcmVhZGVyLnJlc3VsdC50b1N0cmluZygpLFxyXG4gICAgICAvLyAgIGhhc1VwbG9hZGVkOiBmYWxzZSxcclxuICAgICAgLy8gICBtb3VzZU9uOiBmYWxzZSxcclxuICAgICAgLy8gICBzZWxlY3RkOiBmYWxzZSxcclxuICAgICAgLy8gICBpc1VwbG9hZGluZzogdHJ1ZSxcclxuICAgICAgLy8gICB1cGxvYWRSZXN1bHQ6IGZhbHNlLFxyXG4gICAgICAvLyAgIHVwbG9hZFByb2Nlc3M6IDAsXHJcbiAgICAgIC8vICAgZXJyb3JNZXNzYWdlOiBcIlwiLFxyXG4gICAgICAvLyAgIGV4dGVuc2lvbkRyb3BMaXN0SWQ6IDAsXHJcbiAgICAgIC8vICAgZXh0ZW5zaW9uTmFtZTogXCJcIlxyXG4gICAgICAvLyB9XHJcblxyXG4gICAgICBsZXQgY2h1bmtUb3RhbDogbnVtYmVyID0gTWF0aC5jZWlsKGZpbGUuc2l6ZSAvIHRoaXMuYnVmZmVyU2l6ZSk7XHJcbiAgICAgIC8vIOagh+iusOW9k+WJjemZhOS7tuaAu+eahOWIhueJh+aVsFxyXG4gICAgICB0aGlzLmZpbGVUb3RhbENodW5rW3V1aWRdID0gY2h1bmtUb3RhbDtcclxuICAgICAgbGV0IGNodW5rSW5kZXg6IG51bWJlciA9IDA7XHJcbiAgICAgIC8vIOagh+iusOW9k+WJjemZhOS7tuaIkOWKn+eahOWIhueJh+aVsFxyXG4gICAgICB0aGlzLnVwbG9hZGVkQ2h1bmtbdXVpZF0gPSAwO1xyXG4gICAgICB3aGlsZSAoY2h1bmtJbmRleCA8IGNodW5rVG90YWwpIHtcclxuICAgICAgICBsZXQgdXBsb2FkSW5mbyA9IG5ldyBHc3BGb3JtVXBsb2FkRW50aXR5O1xyXG4gICAgICAgIHVwbG9hZEluZm8ubW9kZSA9IE9wZXJhdGluZ01vZGVzLlRlbXA7XHJcbiAgICAgICAgdXBsb2FkSW5mby5mb3JtSWQgPSB0aGlzLmdldEZpbmFsbHlDb25maWcoJ2Zvcm1JZCcsIGV4dGVuZFNlcnZpY2UpO1xyXG4gICAgICAgIHVwbG9hZEluZm8ucm9vdElkID0gdGhpcy5nZXRGaW5hbGx5Q29uZmlnKCdyb290SWQnLCBleHRlbmRTZXJ2aWNlKTtcclxuXHJcbiAgICAgICAgbGV0IGRvY0luZm86IEdzcEZvcm1Eb2NJbmZvID0gbmV3IEdzcEZvcm1Eb2NJbmZvO1xyXG4gICAgICAgIGRvY0luZm8uZmlsZU5hbWUgPSBmaWxlTmFtZTtcclxuICAgICAgICBkb2NJbmZvLm1ldGFkYXRhSWQgPSB1dWlkO1xyXG4gICAgICAgIGRvY0luZm8udG90YWwgPSBjaHVua1RvdGFsO1xyXG4gICAgICAgIC8vIOWmguaenGRhdGHph4zmnInmlbDmja7vvIzlubbkuJTlsZ7mgKfmmK/phY3nva7nmoTmianlsZXlsZ7mgKdcclxuICAgICAgICBpZiAoZXZlbnQuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSAmJiBldmVudFsnZGF0YSddICYmIGV2ZW50WydkYXRhJ10uaGFzT3duUHJvcGVydHkoJ2V4dFByb3BlcnR5JykpIHtcclxuICAgICAgICAgIGRvY0luZm9bJ2V4dFByb3BlcnR5J10gPSBldmVudFsnZGF0YSddWydleHRQcm9wZXJ0eSddIGFzIEdzcERvY01ldGFQcm9wZXJ0eTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5LiL5LiA5Liq5paH5Lu25aSn5bCPXHJcbiAgICAgICAgbGV0IG5leHRTaXplID0gTWF0aC5taW4oKGNodW5rSW5kZXggKyAxKSAqIHRoaXMuYnVmZmVyU2l6ZSwgZmlsZS5zaXplKTtcclxuICAgICAgICAvLyBGaWxl57G75Z6LXHJcbiAgICAgICAgbGV0IGZpbGVEYXRhID0gZmlsZVsnbmF0aXZlRmlsZSddLnNsaWNlKGNodW5rSW5kZXggKiB0aGlzLmJ1ZmZlclNpemUsIG5leHRTaXplKTtcclxuICAgICAgICAvLyDor7vlj5bmlofku7ZcclxuICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICByZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGVEYXRhKTtcclxuICAgICAgICBsZXQgaW5uZXJJbmRleCA9IGNodW5rSW5kZXg7XHJcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgIC8vIOmZhOS7tuS4iuS8oFxyXG4gICAgICAgICAgZG9jSW5mby5maWxlQ29udGVudCA9IGJ0b2EocmVhZGVyLnJlc3VsdC50b1N0cmluZygpKTtcclxuICAgICAgICAgIGRvY0luZm8uaW5kZXggPSBpbm5lckluZGV4O1xyXG5cclxuICAgICAgICAgIHVwbG9hZEluZm8uZG9jSW5mbyA9IGRvY0luZm87XHJcbiAgICAgICAgICBsZXQgaW5mbyA9IHVwbG9hZEluZm87XHJcblxyXG4gICAgICAgICAgdGhpcy51cGxvYWRTZXIudXBsb2FkRmlsZShpbmZvKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAvLyDliIbniYfkuIrkvKDmnInov5Tlm57nu5PmnpzlsLHmmK/miqXplJnkuoZcclxuICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcih0aGlzLmVycm9ySW5mb0Zvcm1hdChyZXN1bHQuZXJyb3IsIFtmaWxlXSkpO1xyXG4gICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHRoaXMudXBsb2FkZWRDaHVua1t1dWlkXSsrO1xyXG4gICAgICAgICAgICAgIGlmICh0aGlzLnVwbG9hZGVkQ2h1bmtbZG9jSW5mby5tZXRhZGF0YUlkXSA9PSB0aGlzLmZpbGVUb3RhbENodW5rW2RvY0luZm8ubWV0YWRhdGFJZF0pIHtcclxuICAgICAgICAgICAgICAgIC8vIOWIpOaWreaYr+aJgOacieWIhueJh+mDveS4iuS8oOWujOaIkFxyXG4gICAgICAgICAgICAgICAgZmlsZS5wcm9ncmVzcyA9IHtcclxuICAgICAgICAgICAgICAgICAgc3RhdHVzOiBVcGxvYWRTdGF0dXMuRG9uZSxcclxuICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDEwMFxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZmlsZS5yZXNwb25zZT1kb2NJbmZvO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMudXBsb2FkZWRDaHVua1t1dWlkXTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmZpbGVUb3RhbENodW5rW3V1aWRdO1xyXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh7IHR5cGU6ICdkb25lJywgZmlsZXM6IFtmaWxlXSB9KTtcclxuICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcblxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIC8vIOWIhueJh+S4iuS8oOato+W4uFxyXG4gICAgICAgICAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IE51bWJlci5wYXJzZUludCgodGhpcy51cGxvYWRlZENodW5rW3V1aWRdIC8gdGhpcy5maWxlVG90YWxDaHVua1t1dWlkXSAqIDEwMCkudG9GaXhlZCgwKSk7XHJcbiAgICAgICAgICAgICAgICAvLyDliKTmlq3mnKrkuIrkvKDlrozmiJBcclxuICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgIHN0YXR1czogVXBsb2FkU3RhdHVzLlVwbG9hZGluZyxcclxuICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IHBlcmNlbnRhZ2VcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoeyB0eXBlOiAndXBsb2FkaW5nJywgZmlsZXM6IFtmaWxlXSB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMudXBsb2FkZWRDaHVua1t1dWlkXTtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuZmlsZVRvdGFsQ2h1bmtbdXVpZF07XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZXJyb3JJbmZvRm9ybWF0KGVycm9yLCBbZmlsZV0pKTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjaHVua0luZGV4ID0gY2h1bmtJbmRleCArIDE7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbniYfnmoTpmYTku7blpKflsI9cclxuICAgKiBAcGFyYW0gc2l6ZSBcclxuICAgKi9cclxuICBwcml2YXRlIGZvcm1hdEZpbGVTaXplKHNpemU6IG51bWJlcikge1xyXG4gICAgaWYgKHNpemUgPCAxMDI0MDApXHJcbiAgICAgIHJldHVybiAoc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMSkgKyBcIktcIjtcclxuICAgIGVsc2UgaWYgKHNpemUgPCAxMDI0ICogMTAyNClcclxuICAgICAgcmV0dXJuIChzaXplIC8gMTAyNCkudG9GaXhlZCgwKSArIFwiS1wiO1xyXG4gICAgZWxzZSBpZiAoc2l6ZSA8IDEwMCAqIDEwMjQgKiAxMDI0KVxyXG4gICAgICByZXR1cm4gKHNpemUgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgxKSArIFwiTVwiO1xyXG4gICAgZWxzZSBpZiAoc2l6ZSA8IDEwMjQgKiAxMDI0ICogMTAyNClcclxuICAgICAgcmV0dXJuIChzaXplIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMCkgKyBcIk1cIjtcclxuICAgIGVsc2VcclxuICAgICAgcmV0dXJuIChzaXplIC8gMTAyNCAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDEpICsgXCJHXCI7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhueJh+eahCDpmYTku7blkI3np7BcclxuICAgKiBAcGFyYW0gZmlsZU5hbWUgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRNdWx0aXBhcnREaXNwbGF5TmFtZShmaWxlTmFtZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoZmlsZU5hbWUubGVuZ3RoIDw9IDEwKVxyXG4gICAgICByZXR1cm4gZmlsZU5hbWU7XHJcbiAgICBlbHNlIHtcclxuICAgICAgbGV0IGhlYWRDb250ZW50ID0gZmlsZU5hbWUuc3Vic3RyaW5nKDAsIDIpO1xyXG4gICAgICBsZXQgdGFpbENvbnRlbnQgPSBmaWxlTmFtZS5zdWJzdHJpbmcoZmlsZU5hbWUubGFzdEluZGV4T2YoJy4nKSAtIDIpO1xyXG4gICAgICByZXR1cm4gaGVhZENvbnRlbnQgKyBcIuKAplwiICsgdGFpbENvbnRlbnQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgZXJyb3JJbmZvRm9ybWF0KGVycm9yLCBmaWxlcykge1xyXG4gICAgLy8gXHJcbiAgICBsZXQgZXJyb3JGaWxlcyA9IGZpbGVzLm1hcChpdGVtID0+IHtcclxuICAgICAgcmV0dXJuIHsgaWQ6IGl0ZW0uaWQsIG5hbWU6IGl0ZW0ubmFtZSB9O1xyXG4gICAgfSk7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oZXJyb3IsIHsgZmlsZXM6IGVycm9yRmlsZXMgfSwgeyBtZXNzYWdlOiBlcnJvclsnTWVzc2FnZSddIHx8IGVycm9yWydleHRlbnNpb25NZXNzYWdlJ10gfHwgJ+S4iuS8oOWksei0pScsIHR5cGU6ICdlcnJvcicgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7IGZpbGVzOiBlcnJvckZpbGVzIH0sIHsgbWVzc2FnZTogJ+S4iuS8oOWksei0pScsIHR5cGU6ICdlcnJvcicgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi/lOWbnuacgOe7iOWxnuaAp+WAvFxyXG4gICAqIEBwYXJhbSBrZXkgXHJcbiAgICogQHBhcmFtIGNvbmZpZ1ZhbHVlIFxyXG4gICAqIEBwYXJhbSBleHRlbmRWYWx1ZSBcclxuICAgKi9cclxuICBwcml2YXRlIGdldEZpbmFsbHlDb25maWcoa2V5LCBleHRlbmRWYWx1ZSkge1xyXG4gICAgaWYgKGV4dGVuZFZhbHVlICYmIGV4dGVuZFZhbHVlLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgcmV0dXJuIGV4dGVuZFZhbHVlW2tleV07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5leHRlbmREYXRhW2tleV07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZpbmRGaWxlSW5kZXhCeUZpbGVOYW1lKGZpbGVzOiBVcGxvYWRGaWxlW10sIGZpbGVOYW1lKSB7XHJcbiAgICAvLyDmjInnhafogq/lrprog73mib7liLDmlofku7bmnaXlpITnkIZcclxuICAgIGxldCBmaW5kSW5kZXggPSBmaWxlcy5maW5kSW5kZXgoZmlsZSA9PiBmaWxlLm5hbWUgPT0gZmlsZU5hbWUpO1xyXG4gICAgcmV0dXJuIGZpbmRJbmRleDtcclxuICB9XHJcblxyXG59XHJcblxyXG4iXX0=