!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@farris/ui-common"),require("@farris/ui-locale"),require("@angular/forms"),require("@angular/common"),require("@farris/ui-pagination"),require("@angular/core")):"function"==typeof define&&define.amd?define("@farris/ui-list-view",["exports","@farris/ui-common","@farris/ui-locale","@angular/forms","@angular/common","@farris/ui-pagination","@angular/core"],e):e((t.farris=t.farris||{},t.farris["ui-list-view"]={}),t.uiCommon,t.uiLocale,t.ng.forms,t.ng.common,t.uiPagination,t.ng.core)}(this,function(t,e,i,a,s,n,r){"use strict";var l=(o.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],o.ctorParameters=function(){return[]},o.ngInjectableDef=r.defineInjectable({factory:function(){return new o},token:o,providedIn:"root"}),o);function o(){}function c(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var a,s,n=i.call(t),r=[];try{for(;(void 0===e||0<e--)&&!(a=n.next()).done;)r.push(a.value)}catch(l){s={error:l}}finally{try{a&&!a.done&&(i=n["return"])&&i.call(n)}finally{if(s)throw s.error}}return r}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}var p=(u.decorators=[{type:r.Directive,args:[{selector:"[listViewHeader]"}]}],u.ctorParameters=function(){return[{type:r.TemplateRef}]},u);function u(t){this.template=t}var d=(g.decorators=[{type:r.Directive,args:[{selector:"[listTemplate]"}]}],g.ctorParameters=function(){return[{type:r.TemplateRef}]},g);function g(t){this.template=t}var f=(m.decorators=[{type:r.Directive,args:[{selector:"[listViewFooter]"}]}],m.ctorParameters=function(){return[{type:r.TemplateRef}]},m);function m(t){this.template=t}var v=(y.decorators=[{type:r.Directive,args:[{selector:"[listViewEmpty]"}]}],y.ctorParameters=function(){return[{type:r.TemplateRef}]},y);function y(t){this.template=t}var k=(Object.defineProperty(L.prototype,"activeIndex",{get:function(){return this._activeIndex},set:function(t){this._activeIndex=t,this.dataInit()},enumerable:!0,configurable:!0}),Object.defineProperty(L.prototype,"pageList",{get:function(){return this._pageList},set:function(t){this._pageList=t,this.pager&&this.pager.setPageList(t)},enumerable:!0,configurable:!0}),Object.defineProperty(L.prototype,"listviewFill",{get:function(){return this.fill},enumerable:!0,configurable:!0}),L.prototype.ngOnInit=function(){this.currentData=this.data,this.dataInit(),this.paginationOptions={id:"Farris-listView-Pagination",itemsPerPage:this.pageSize,currentPage:this.pageIndex,pageList:this.pageList,totalItems:this.total,remote:this.pagerOnServer},this.id&&(this.paginationOptions.id=this.paginationOptions.id+this.id)},L.prototype.ngOnChanges=function(t){var e=this;if(t.data&&!t.data.isFirstChange()&&(this.currentData=this.data,this.dataInit()),t.total&&this.total&&this.paginationOptions&&(this.paginationOptions.totalItems=this.total),t.pageIndex&&this.pageIndex&&this.paginationOptions&&(this.paginationOptions.currentPage=this.pageIndex),!t||t.checkValues===undefined||t.checkValues.isFirstChange()||this.differenceBy(t.checkValues.currentValue||[],t.checkValues.previousValue||[],function(t){return t})&&(this.enableMorePageSelect||this.checkRows(this.checkValues)),t.checkItems&&!t.checkItems.isFirstChange()){this.selectDataListWithOtherPager=h(this.checkItems);var i=this.checkItems.map(function(t){return t[e.listidName]});this.checkedItems(i,!1)}},L.prototype.ngAfterViewInit=function(){},L.prototype.ngAfterContentInit=function(){},L.prototype.searchList=function(s){return""!==s&&this.data&&this.data.length?this.currentData=this.data.filter(function(t){for(var e,i=Object.values(t),a=0;a<i.length;a++)if("string"==typeof i[a]&&i[a].toString().includes(s)){e=i[a].toString().includes(s);break}return e}):this.currentData=this.data,{listdata:this.currentData,searchValue:s,length:this.currentData.length}},L.prototype.listSelect=function(t,i,a,e){var s=this;if(void 0===e&&(e=!1),!i.unClick&&!i.selectDisable){if(this.checkChange.emit({listdata:i,index:a}),this.multipleSelect){if(i.checked){var n=this.selectDataList.findIndex(function(t,e){return s.getKey(t,e)===s.getKey(i,a)});this.selectDataList.splice(n,1),this.updateDataListForMorePager("remove",i)}else this.selectDataList.find(function(t,e){return s.getKey(t,e)===s.getKey(i,a)})||(this.selectDataList.unshift(i),this.updateDataListForMorePager("append",i));i.checked=!i.checked}else this.selectDataList=[],this.selectDataList.push(i);if(e||(this.clickItem=i),this.listClick.emit({data:this.selectDataList,index:a,checkChangeEvent:e}),this.multipleSelect){var r=this.data.filter(function(t){return!!t.checked}).map(function(t){return t[s.listidName]});this.enableMorePageSelect&&(r=this.selectDataListWithOtherPager.map(function(t){return t[s.listidName]})),this.onCheckValuesChange(r)}}},L.prototype.getKey=function(t,e){return this.listidName&&t.hasOwnProperty(this.listidName)?t[this.listidName]:e},L.prototype.getSelect=function(t,e,i){var a=t.checked;this.listSelect(a,e,i,!0)},L.prototype.sort=function(t,e){return void 0===e&&(e="asc"),this.currentData.sort(this.compare(t,e)),{sortResult:{listdata:this.currentData,sortkeyName:t,sortType:e}}},L.prototype.selectRow=function(e){var i=this;if(this.currentData&&0<this.currentData.length){var t=this.currentData.find(function(t){return t[i.listidName]===e});t&&(this.clickItem=t,this.cdr.markForCheck())}},L.prototype.compare=function(s,t){return"desc"===t?function(t,e){var i=t[s],a=e[s];return a<i?1:i<a?-1:0}:"asc"===t?function(t,e){var i=t[s],a=e[s];return i<a?1:a<i?-1:0}:void 0},L.prototype.getItemActive=function(t){return!(!this.listidName||!this.clickItem)&&t[this.listidName]===this.clickItem[this.listidName]},L.prototype.onPageChange=function(t){this.pageIndex!==t.pageIndex&&(this.pageIndex=t.pageIndex,this.paginationOptions.currentPage=t.pageIndex,this.pageChanged.emit({pageInfo:t}))},L.prototype.onPageSizeChange=function(t){if(this.pageSize!==t&&this.total){this.paginationOptions.itemsPerPage=t,this.pageSize=t;var e=this.total,i=Math.floor(e/t);0<e%t&&(i+=1),i&&this.pageIndex>i&&(this.pageIndex=i,this.paginationOptions.currentPage=this.pageIndex),this.pageSizeChanged.emit({pageInfo:{pageIndex:this.pageIndex,pageSize:t}})}},L.prototype.getCurrentData=function(){return this.currentData},L.prototype.getSelectData=function(){return this.selectDataList},L.prototype.setData=function(t){this.currentData=t,this.data=t,this.dataInit()},L.prototype.dataInit=function(){if(this.data&&this.data.length)if(this.selectDataList=this.data.filter(function(t){return t.checked}),0<=this.activeIndex&&this.activeIndex<=this.data.length-1){var t=this.data[this.activeIndex];t&&(this.clickItem=t,this.selectDataList.push(this.clickItem))}else{if(this.activeIndex<0)return;this.selectDataList.length||this.multipleSelect||this.selectDataList.push(this.data[0]),this.clickItem=this.data[0]}this.updateDataListForMorePager(),this.cdr&&this.cdr.detectChanges()},L.prototype.updateDataListForMorePager=function(t,i,e){var a=this;if(void 0===t&&(t=""),void 0===e&&(e=!0),this.multipleSelect&&this.enableMorePageSelect)if("remove"===t&&i)Array.isArray(i)?this.selectDataListWithOtherPager=this.selectDataListWithOtherPager.filter(function(e){return-1===i.indexOf(function(t){return t[a.listidName]===e[a.listidName]})}):this.selectDataListWithOtherPager=this.selectDataListWithOtherPager.filter(function(t){return"object"==typeof i?t[a.listidName]!=i[a.listidName]:t[a.listidName]!=i}),e&&this.checkItemsChange.emit({items:h(this.selectDataListWithOtherPager),instance:this});else if("append"===t)Array.isArray(i)?this.selectDataListWithOtherPager=h(this.selectDataListWithOtherPager,i):this.selectDataListWithOtherPager=h(this.selectDataListWithOtherPager,[i]),e&&this.checkItemsChange.emit({items:h(this.selectDataListWithOtherPager),instance:this});else if(this.selectDataListWithOtherPager.length){var s=this.sameBy(this.currentData,this.selectDataListWithOtherPager,function(t){return t[a.listidName]});s&&s.length&&this.data.forEach(function(t){t.checked=s.includes(t[a.listidName])})}else this.selectDataListWithOtherPager=h(this.selectDataList)},L.prototype.listCheckAll=function(){this.multipleSelect&&(this.currentData.forEach(function(t){t.checked=!0}),this.selectDataList=this.currentData.filter(function(t){return t.checked}),this.updateDataListForMorePager("append",this.currentData),this.cdr.markForCheck())},L.prototype.listCheckAllCancel=function(){this.multipleSelect&&(this.currentData.forEach(function(t){t.checked=!1}),this.selectDataList=[],this.updateDataListForMorePager("remove",this.currentData),this.cdr.markForCheck())},L.prototype.checkRows=function(e){var i=this;if(this.multipleSelect){if(!e||e.length<1)return void this.listCheckAllCancel();this.data.forEach(function(t){e.includes(t[i.listidName])?t.checked=!0:t.checked=!1}),this.cdr.markForCheck()}},L.prototype.onCheckValuesChange=function(t){this.checkValuesChange.emit(t)},L.prototype.onMouseEnter=function(t){t.stopPropagation(),this.mouseInSelectedList=!0,this.selectDataListWithOtherPager&&this.selectDataListWithOtherPager.length?this.openSelectedList=!this.openSelectedList:this.openSelectedList=!1},L.prototype.closeSelectedList=function(){this.openSelectedList=!1,this.mouseInSelectedList=!1,this.cdr.destroyed||this.cdr.detectChanges()},L.prototype.onDelSelectedItem=function(e){var i=this;this.currentData.forEach(function(t){t[i.listidName]==e&&(t.checked=!1)}),this.selectDataList=this.selectDataList.filter(function(t){return t[i.listidName]!=e}),this.updateDataListForMorePager("remove",e),this.updateCheckedValues()},L.prototype.onClearSelected=function(t){this.closeSelectedList(),this.listCheckAllCancel(),this.selectDataListWithOtherPager=[],this.checkValues=[],this.onCheckValuesChange([])},L.prototype.onSelectListPanelClose=function(t){this.closeSelectedList()},L.prototype.updateCheckedValues=function(t){var e=this;void 0===t&&(t=!0),this.multipleSelect&&(this.enableMorePageSelect?this.checkValues=this.selectDataListWithOtherPager.map(function(t){return t[e.listidName]}):this.checkValues=this.selectDataList.map(function(t){return t[e.listidName]}),t&&(this.onCheckValuesChange(this.checkValues),this.checkItemsChange.emit({items:this.selectDataListWithOtherPager,instance:this})))},L.prototype.clearCheckeds=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.multipleSelect&&(this.currentData.forEach(function(t){t.checked=!1}),this.selectDataList=[],t?this.selectDataListWithOtherPager=[]:this.updateDataListForMorePager("remove",this.currentData),e&&this.updateCheckedValues(e),this.cdr.markForCheck())},L.prototype._setItemsCheckedStatus=function(t,a,e){var s=this;t&&t.length&&(t.forEach(function(t){var e=t;"object"==typeof t&&(e=t[s.listidName]);var i=s.data.find(function(t){return t[s.listidName]===e});i&&(i.checked=a),a?s.updateDataListForMorePager("append",t,!1):s.updateDataListForMorePager("remove",e,!1)}),this.updateCheckedValues(e),this.cdr.markForCheck())},L.prototype.unCheckItems=function(t,e){void 0===e&&(e=!1),this._setItemsCheckedStatus(t,!1,e)},L.prototype.checkedItems=function(t,e){void 0===e&&(e=!1),this._setItemsCheckedStatus(t,!0,e)},L.decorators=[{type:r.Component,args:[{selector:"farris-list-view",template:'<div class="f-list-view" [ngClass]="{\'f-list-view-multiple\': multipleSelect}">\r\n    <div class="f-list-view-header" *ngIf="headerTemplate">\r\n        <ng-container [ngTemplateOutlet]="headerTemplate"></ng-container>\r\n    </div>\r\n    <div class="f-list-view-content">\r\n        <ul class="f-list-view-group" [ngClass]="{\'d-flex flex-wrap\': cardLayout}">\r\n            <ng-container *ngIf="currentData&&currentData.length;else emptyData">\r\n                <li class="f-list-view-group-item {{listClassName}}"\r\n                    *ngFor="let list of (supportPaging ? (currentData | paginate: paginationOptions) : currentData); let i = index;let first = first; let last = last"\r\n                    [id]="getKey(list,i)" (click)="listSelect($event,list,i)"\r\n                    [ngClass]="{\'f-un-click\': list[\'unClick\'],\'f-un-select\':list[\'selectDisable\'],\'f-listview-active\':getItemActive(list)}">\r\n                    <div class="f-list-select" *ngIf="multipleSelect" (click)="$event.stopPropagation()">\r\n                        <list-view-checkout [id]="\'list-\'+getKey(list,i)"\r\n                            [disabled]="list[\'selectDisable\']||list[\'unClick\']" [checked]="list[\'checked\']"\r\n                            (checkedChange)="getSelect($event,list,i)"></list-view-checkout>\r\n                    </div>\r\n                    <div class="f-list-content">\r\n                        <ng-container [ngTemplateOutlet]="listTemplate"\r\n                            [ngTemplateOutletContext]="{ item: list , index:i, selectedItem: clickItem, first:first,last:last }">\r\n                        </ng-container>\r\n                    </div>\r\n                </li>\r\n            </ng-container>\r\n\r\n            <ng-template #emptyData>\r\n                \x3c!-- 空数据默认模板 --\x3e\r\n                <div class="f-list-view-emptydata" *ngIf="showEmpty&&!emptyTemplate;else customEmpty">\r\n                    <p class="f-empty-title">{{ \'listview.emptyMessage\' | locale }}</p>\r\n                </div>\r\n                \x3c!-- 自定义空数据模板 --\x3e\r\n                <ng-template #customEmpty>\r\n                    <ng-container [ngTemplateOutlet]="emptyDataTemplate"></ng-container>\r\n                </ng-template>\r\n\r\n            </ng-template>\r\n        </ul>\r\n    </div>\r\n    <div class="f-list-view-footer" *ngIf="footerTemplate || supportPaging">\r\n        <ng-container [ngTemplateOutlet]="footerTemplate">\r\n            <div class="f-paging-wrapper" *ngIf="supportPaging&&currentData&&currentData.length">\r\n                <pagination-controls #pager [id]="paginationOptions.id" [maxSize]="maxSize"\r\n                    [directionLinks]="directionLinks" [autoHide]="autoHide" [responsive]="responsive"\r\n                    [previousLabel]="labels.previousLabel" [nextLabel]="labels.nextLabel"\r\n                    [screenReaderPaginationLabel]="labels.screenReaderPaginationLabel"\r\n                    [screenReaderPageLabel]="labels.screenReaderPageLabel"\r\n                    [screenReaderCurrentLabel]="labels.screenReaderCurrentLabel" (pageChange)="onPageChange($event)"\r\n                    (pageSizeChange)="onPageSizeChange($event)" [showSelectedList]="showSelectedList && enableMorePageSelect">\r\n\r\n                    <div class="flex-fill" >\r\n                        <div>\r\n                            <span class="badge badge-pill badge-light" *ngIf="showSelectedList"\r\n                                style="cursor:pointer" [attr.title]="\'datagrid.selectionData.tooltip\' | locale"\r\n                                [class.badge-primary]="mouseInSelectedList"\r\n                                [innerHTML]="\'datagrid.selectionData.currentLenth\' | locale | replaceX: selectDataListWithOtherPager.length"\r\n                                (click)="onMouseEnter($event)">\r\n                            </span>\r\n                            <pagination-selected-list *ngIf="openSelectedList"\r\n                                [data]="selectDataListWithOtherPager | formatItems: selectedItemFormat"\r\n                                (close)="onSelectListPanelClose($event)"\r\n                                (remove)="onDelSelectedItem($event)"\r\n                                (clear)="onClearSelected($event)"\r\n                            ></pagination-selected-list>\r\n                        </div>\r\n                    </div>\r\n\r\n                </pagination-controls>\r\n            </div>\r\n        </ng-container>\r\n    </div>\r\n</div>',styles:[":host{height:100%}:host.f-listview-fill{-webkit-box-flex:1;flex-grow:1;flex-shrink:1;flex-basis:0;overflow:hidden}:host.f-listview-fill .f-list-view{height:100%}:host.f-listview-fill .f-list-view .f-list-view-header{flex-shrink:0}:host.f-listview-fill .f-list-view .f-list-view-footer{flex-shrink:0}:host.f-listview-fill .f-list-view .f-list-view-content{overflow-y:auto;-webkit-box-flex:1;flex-grow:1;flex-shrink:1;flex-basis:0}:host .f-list-view{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}:host .f-list-view .f-paging-wrapper{padding:14px 0}:host .f-list-view-group-item{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}:host .f-list-view-group-item.f-none-border{border-bottom:0}:host .f-list-view-group-item .f-list-content{-webkit-box-flex:1;flex:1 1 auto;width:100%}:host .f-list-select{padding:0 14px}:host .f-list-view-emptydata .f-empty-title{font-size:14px;line-height:22px;color:#999;padding:20px 0;text-align:center}"]}]}],L.ctorParameters=function(){return[{type:r.ElementRef},{type:r.Renderer2},{type:r.ChangeDetectorRef}]},L.propDecorators={headerTemplate:[{type:r.ContentChild,args:[p,{read:r.TemplateRef}]}],listTemplate:[{type:r.ContentChild,args:[d,{read:r.TemplateRef}]}],footerTemplate:[{type:r.ContentChild,args:[f,{read:r.TemplateRef}]}],emptyDataTemplate:[{type:r.ContentChild,args:[v,{read:r.TemplateRef}]}],listGroup:[{type:r.ViewChild,args:["listGroup"]}],pager:[{type:r.ViewChild,args:["pager"]}],data:[{type:r.Input}],id:[{type:r.Input}],showEmpty:[{type:r.Input}],emptyTemplate:[{type:r.Input}],multipleSelect:[{type:r.Input}],supportPaging:[{type:r.Input}],pagerOnServer:[{type:r.Input}],pageSize:[{type:r.Input}],pageIndex:[{type:r.Input}],enableMorePageSelect:[{type:r.Input}],showSelectedList:[{type:r.Input}],selectedItemFormat:[{type:r.Input}],fill:[{type:r.Input}],cardLayout:[{type:r.Input}],activeIndex:[{type:r.Input}],listClassName:[{type:r.Input}],checkValues:[{type:r.Input}],checkValuesChange:[{type:r.Output}],checkItems:[{type:r.Input}],checkItemsChange:[{type:r.Input}],pageList:[{type:r.Input}],total:[{type:r.Input}],listidName:[{type:r.Input}],listviewFill:[{type:r.HostBinding,args:["class.f-listview-fill"]}],listClick:[{type:r.Output}],checkChange:[{type:r.Output}],pageChanged:[{type:r.Output}],pageSizeChanged:[{type:r.Output}]},L);function L(t,e,i){this.el=t,this.renderer=e,this.cdr=i,this.data=[],this.showEmpty=!0,this.emptyTemplate=!1,this.multipleSelect=!1,this.supportPaging=!1,this.pagerOnServer=!0,this.pageSize=10,this.pageIndex=1,this.enableMorePageSelect=!1,this.showSelectedList=!1,this.selectedItemFormat=null,this.fill=!1,this.cardLayout=!1,this.checkValues=[],this.checkValuesChange=new r.EventEmitter,this.checkItems=[],this.checkItemsChange=new r.EventEmitter,this._pageList=[10,20,30,50],this.total=0,this.listidName="id",this.listClick=new r.EventEmitter,this.checkChange=new r.EventEmitter,this.pageChanged=new r.EventEmitter,this.pageSizeChanged=new r.EventEmitter,this.currentData=[],this.selectDataList=[],this.selectDataListWithOtherPager=[],this.maxSize=7,this.directionLinks=!0,this.autoHide=!1,this.responsive=!0,this.paginationOptions={id:"Farris-listView-Pagination",itemsPerPage:this.pageSize,currentPage:this.pageIndex,pageList:this.pageList,totalItems:this.total},this.labels={previousLabel:" ",nextLabel:" ",screenReaderPaginationLabel:"Pagination",screenReaderPageLabel:"page",screenReaderCurrentLabel:"You're on page"},this.mouseInSelectedList=!1,this.openSelectedList=!1,this.differenceBy=function(t,e,i){var a=new Set(e.map(i));return t.map(i).filter(function(t){return!a.has(t)})},this.sameBy=function(t,e,i){var a=new Set(e.map(i));return t.map(i).filter(function(t){return a.has(t)})}}var I=(D.prototype.ngOnInit=function(){},D.prototype.handleClick=function(t){this.disabled||this.checkedChange.emit({originalEvent:t,checked:!this.checked})},D.decorators=[{type:r.Component,args:[{selector:"list-view-checkout",template:'<div class="custom-control custom-checkbox  custom-control-inline listview-checkbox">\r\n    <input type="checkbox" class="custom-control-input"  [checked]="checked">\r\n    <label class="custom-control-label" (click)="handleClick($event)"></label>\r\n</div>'}]}],D.ctorParameters=function(){return[]},D.propDecorators={checked:[{type:r.Input}],id:[{type:r.Input}],disabled:[{type:r.Input}],checkedChange:[{type:r.Output}]},D);function D(){this.checkedChange=new r.EventEmitter}var C=(w.prototype.transform=function(t,e){if(t){var a=this.listViewRef.listidName;return t=e?t.map(function(t){return{id:t[a],text:e(t)}}):t.map(function(e){var i=[];return Object.keys(e).forEach(function(t){i.push(e[t])}),{id:e[a],text:i.join(", ")}})}return[]},w.decorators=[{type:r.Pipe,args:[{name:"formatItems"}]}],w.ctorParameters=function(){return[{type:k}]},w);function w(t){this.listViewRef=t}var P=(b.decorators=[{type:r.NgModule,args:[{declarations:[k,I,p,d,f,v,C],imports:[s.CommonModule,a.FormsModule,i.LocaleModule.forRoot(),e.FarrisCommonModule,n.PaginationModule],exports:[k,I,p,d,f,v,C]}]}],b);function b(){}t.ListViewService=l,t.ListViewComponent=k,t.ListViewModule=P,t.ListViewHeaderTemplateDirective=p,t.ListViewTemplateDirective=d,t.ListViewFooterTemplateDirective=f,t.ListViewEmptyTemplateDirective=v,t.ListViewCheckoutComponent=I,t.SelectedListFormatPipe=C,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-list-view.umd.min.js.map