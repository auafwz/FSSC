/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from './../../datagrid.component';
import { NotifyService } from '@farris/ui-notify';
import { ChangeDetectorRef, Injector, Optional } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-17 20:20:21
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, Output, EventEmitter, ElementRef, ViewChild } from '@angular/core';
import { PaginationControlsComponent } from '@farris/ui-pagination';
export class DatagridPagerComponent {
    /**
     * @param {?} el
     * @param {?} cd
     * @param {?} inject
     */
    constructor(el, cd, inject) {
        this.el = el;
        this.cd = cd;
        this.inject = inject;
        this.id = 'farris-datagrid-pager';
        /**
         * 显示页码的数量
         */
        this.maxSize = 7;
        /**
         * 是否显示页码
         */
        this.directionLinks = true;
        this.autoHide = false;
        this.responsive = false;
        /**
         * 上页标签
         */
        this.previousLabel = '上页';
        /**
         * 下页标签
         */
        this.nextLabel = '下页';
        this.showPageList = false;
        this.showPageInfo = true;
        this.showPageNumber = true;
        this.locked = false;
        this.selectedData = [];
        this.viewMode = 'default';
        this.showSelectedList = false;
        this.showGotoInput = false;
        this.pageChange = new EventEmitter();
        this.pageSizeChange = new EventEmitter();
        this.removeSelectedItem = new EventEmitter();
        this.clearSelectedItem = new EventEmitter();
        this.styles = { opacity: 1 };
        this.mouseInSelectedList = false;
        this.openSelectedList = false;
        this.selectionDataChange$ = null;
        if (this.inject) {
            this.notifySer = this.inject.get(NotifyService, null);
        }
    }
    /**
     * @return {?}
     */
    get pagination() {
        return this.pager.paginationDirective;
    }
    /**
     * @return {?}
     */
    get pageSize() {
        return this.pagination.getPageSize();
    }
    /**
     * @return {?}
     */
    get total() {
        return this.pagination.getTotalItems();
    }
    /**
     * @return {?}
     */
    get outerHeight() {
        if (this.pc) {
            return this.pc.nativeElement.offsetHeight;
        }
        return 40;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.listenCheckDataChanged();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.selectedData && !changes.selectedData.isFirstChange()) {
            if (!this.selectedData || !this.selectedData.length) {
                this.closeSelectedList();
            }
        }
        if (changes.showSelectedList && !changes.showSelectedList.isFirstChange()) {
            this.listenCheckDataChanged();
        }
    }
    /**
     * @private
     * @return {?}
     */
    listenCheckDataChanged() {
        if (this.showSelectedList) {
            /** @type {?} */
            const dg = this.inject.get(DatagridComponent, null);
            if (dg) {
                this.selectionDataChange$ = dg.checkedChange.subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    this.selectedData = data;
                    this.cd.detectChanges();
                }));
            }
        }
        else {
            if (this.selectionDataChange$) {
                this.selectionDataChange$.unsubscribe();
                this.selectionDataChange$ = null;
            }
        }
    }
    /**
     * @param {?} pageIndex
     * @return {?}
     */
    onPageChange(pageIndex) {
        if (typeof pageIndex === 'object') {
            pageIndex = pageIndex.pageIndex || 1;
        }
        this.pageChange.emit(Number.parseInt(pageIndex, 10));
    }
    /**
     * @param {?} pageSize
     * @return {?}
     */
    onPageSizeChange(pageSize) {
        this.pageSizeChange.emit(Number.parseInt(pageSize, 10));
    }
    /**
     * @return {?}
     */
    lock() {
        this.locked = true;
        this.styles = { opacity: 0.5 };
        this.cd.detectChanges();
    }
    /**
     * @return {?}
     */
    unlock() {
        this.locked = false;
        this.styles = { opacity: 1 };
        this.cd.detectChanges();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseEnter($event) {
        $event.stopPropagation();
        if (this.locked) {
            return;
        }
        this.mouseInSelectedList = true;
        if (this.selectedData && this.selectedData.length) {
            this.openSelectedList = !this.openSelectedList;
        }
        else {
            this.openSelectedList = false;
        }
    }
    /**
     * @return {?}
     */
    closeSelectedList() {
        this.openSelectedList = false;
        this.mouseInSelectedList = false;
        if (!this.cd['destroyed']) {
            this.cd.detectChanges();
        }
    }
    /**
     * @param {?} id
     * @return {?}
     */
    onDelSelectedItem(id) {
        this.removeSelectedItem.emit(id);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onClearSelected($event) {
        this.clearSelectedItem.emit();
        this.closeSelectedList();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onSelectListPanelClose($event) {
        this.closeSelectedList();
    }
}
DatagridPagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'datagrid-pager',
                template: "<div class=\"f-datagrid-pager\" #pagerContainer [ngStyle]=\"styles\">\r\n    <pagination-controls #pager [id]=\"id\" [maxSize]=\"maxSize\"\r\n        [directionLinks]=\"directionLinks\" [showPageList]=\"showPageList\"\r\n        [showPageInfo]=\"showPageInfo\"\r\n        [showPageNumber]=\"showPageNumber\"\r\n        [autoHide]=\"autoHide\" [responsive]=\"responsive\"\r\n        [previousLabel]=\"previousLabel\" [nextLabel]=\"nextLabel\"\r\n        [showGotoInput]=\"showGotoInput\"\r\n        (pageChange)=\"onPageChange($event)\"\r\n        (pageSizeChange)=\"onPageSizeChange($event)\"\r\n        [viewMode]=\"viewMode\" [showSelectedList]=\"showSelectedList\">\r\n        <div class=\"flex-fill\" >\r\n            <div>\r\n                <span class=\"badge badge-pill badge-light\" *ngIf=\"showSelectedList\"\r\n                    style=\"cursor:pointer\" [attr.title]=\"'datagrid.selectionData.tooltip' | locale\"\r\n                    [class.badge-primary]=\"mouseInSelectedList\"\r\n                    [innerHTML]=\"'datagrid.selectionData.currentLenth' | locale | replaceX: selectedData.length\"\r\n                    (click)=\"onMouseEnter($event)\">\r\n                </span>\r\n                <pager-selected-list *ngIf=\"openSelectedList\"\r\n                    [data]=\"selectedData | selectedItem: listItemFormatter\"\r\n                    (close)=\"onSelectListPanelClose($event)\"\r\n                    (remove)=\"onDelSelectedItem($event)\"\r\n                    (clear)=\"onClearSelected($event)\"\r\n                ></pager-selected-list>\r\n            </div>\r\n        </div>\r\n\r\n    </pagination-controls>\r\n\r\n\r\n</div>"
            }] }
];
/** @nocollapse */
DatagridPagerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: Injector, decorators: [{ type: Optional }] }
];
DatagridPagerComponent.propDecorators = {
    id: [{ type: Input }],
    maxSize: [{ type: Input }],
    directionLinks: [{ type: Input }],
    autoHide: [{ type: Input }],
    responsive: [{ type: Input }],
    previousLabel: [{ type: Input }],
    nextLabel: [{ type: Input }],
    showPageList: [{ type: Input }],
    showPageInfo: [{ type: Input }],
    showPageNumber: [{ type: Input }],
    locked: [{ type: Input }],
    selectedData: [{ type: Input }],
    viewMode: [{ type: Input }],
    listItemFormatter: [{ type: Input }],
    showSelectedList: [{ type: Input }],
    showGotoInput: [{ type: Input }],
    pageChange: [{ type: Output }],
    pageSizeChange: [{ type: Output }],
    removeSelectedItem: [{ type: Output }],
    clearSelectedItem: [{ type: Output }],
    pc: [{ type: ViewChild, args: ['pagerContainer',] }],
    pager: [{ type: ViewChild, args: ['pager',] }]
};
if (false) {
    /** @type {?} */
    DatagridPagerComponent.prototype.id;
    /**
     * 显示页码的数量
     * @type {?}
     */
    DatagridPagerComponent.prototype.maxSize;
    /**
     * 是否显示页码
     * @type {?}
     */
    DatagridPagerComponent.prototype.directionLinks;
    /** @type {?} */
    DatagridPagerComponent.prototype.autoHide;
    /** @type {?} */
    DatagridPagerComponent.prototype.responsive;
    /**
     * 上页标签
     * @type {?}
     */
    DatagridPagerComponent.prototype.previousLabel;
    /**
     * 下页标签
     * @type {?}
     */
    DatagridPagerComponent.prototype.nextLabel;
    /** @type {?} */
    DatagridPagerComponent.prototype.showPageList;
    /** @type {?} */
    DatagridPagerComponent.prototype.showPageInfo;
    /** @type {?} */
    DatagridPagerComponent.prototype.showPageNumber;
    /** @type {?} */
    DatagridPagerComponent.prototype.locked;
    /** @type {?} */
    DatagridPagerComponent.prototype.selectedData;
    /** @type {?} */
    DatagridPagerComponent.prototype.viewMode;
    /** @type {?} */
    DatagridPagerComponent.prototype.listItemFormatter;
    /** @type {?} */
    DatagridPagerComponent.prototype.showSelectedList;
    /** @type {?} */
    DatagridPagerComponent.prototype.showGotoInput;
    /** @type {?} */
    DatagridPagerComponent.prototype.pageChange;
    /** @type {?} */
    DatagridPagerComponent.prototype.pageSizeChange;
    /** @type {?} */
    DatagridPagerComponent.prototype.removeSelectedItem;
    /** @type {?} */
    DatagridPagerComponent.prototype.clearSelectedItem;
    /** @type {?} */
    DatagridPagerComponent.prototype.pc;
    /** @type {?} */
    DatagridPagerComponent.prototype.pager;
    /** @type {?} */
    DatagridPagerComponent.prototype.styles;
    /** @type {?} */
    DatagridPagerComponent.prototype.mouseInSelectedList;
    /** @type {?} */
    DatagridPagerComponent.prototype.openSelectedList;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.selectionDataChange$;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.notifySer;
    /** @type {?} */
    DatagridPagerComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridPagerComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BhZ2VyL3BhZ2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUE0QixNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7O0FBU2hHLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFpQixTQUFTLEVBQWUsTUFBTSxlQUFlLENBQUM7QUFDbEksT0FBTyxFQUFFLDJCQUEyQixFQUErQixNQUFNLHVCQUF1QixDQUFDO0FBTWpHLE1BQU0sT0FBTyxzQkFBc0I7Ozs7OztJQWlFL0IsWUFBbUIsRUFBYyxFQUFVLEVBQXFCLEVBQXNCLE1BQWdCO1FBQW5GLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFzQixXQUFNLEdBQU4sTUFBTSxDQUFVO1FBL0Q3RixPQUFFLEdBQUcsdUJBQXVCLENBQUM7Ozs7UUFFN0IsWUFBTyxHQUFHLENBQUMsQ0FBQzs7OztRQUVaLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBRXRCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFakIsZUFBVSxHQUFHLEtBQUssQ0FBQzs7OztRQUVuQixrQkFBYSxHQUFHLElBQUksQ0FBQzs7OztRQUVyQixjQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3JCLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FB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Ozs7SUFFdEMseUNBQXFCOzs7OztJQUVyQixnREFBK0I7O0lBRS9CLDBDQUEwQjs7SUFFMUIsNENBQTRCOzs7OztJQUU1QiwrQ0FBOEI7Ozs7O0lBRTlCLDJDQUEwQjs7SUFDMUIsOENBQThCOztJQUM5Qiw4Q0FBNkI7O0lBQzdCLGdEQUErQjs7SUFDL0Isd0NBQXdCOztJQUV4Qiw4Q0FBMkI7O0lBQzNCLDBDQUFvRDs7SUFDcEQsbURBQTZDOztJQUU3QyxrREFBa0M7O0lBRWxDLCtDQUErQjs7SUFFL0IsNENBQTBDOztJQUMxQyxnREFBOEM7O0lBRTlDLG9EQUFrRDs7SUFDbEQsbURBQWlEOztJQUVqRCxvQ0FBNEM7O0lBQzVDLHVDQUF1RDs7SUFxQnZELHdDQUF3Qjs7SUFFeEIscURBQTRCOztJQUM1QixrREFBeUI7Ozs7O0lBRXpCLHNEQUFrRDs7Ozs7SUFFbEQsMkNBQWlDOztJQUVyQixvQ0FBcUI7Ozs7O0lBQUUsb0NBQTZCOzs7OztJQUFFLHdDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4vLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdG9yLCBPcHRpb25hbCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMDYgMDc6NDM6MDdcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTAtMTcgMjA6MjA6MjFcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEVsZW1lbnRSZWYsIEFmdGVyVmlld0luaXQsIFZpZXdDaGlsZCwgSG9zdEJpbmRpbmcgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUGFnaW5hdGlvbkNvbnRyb2xzQ29tcG9uZW50LCBQYWdpbmF0aW9uQ29udHJvbHNEaXJlY3RpdmUgfSBmcm9tICdAZmFycmlzL3VpLXBhZ2luYXRpb24nO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2RhdGFncmlkLXBhZ2VyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9wYWdlLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRQYWdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzIHtcclxuXHJcbiAgICBASW5wdXQoKSBpZCA9ICdmYXJyaXMtZGF0YWdyaWQtcGFnZXInO1xyXG4gICAgLyoqIOaYvuekuumhteeggeeahOaVsOmHjyAqL1xyXG4gICAgQElucHV0KCkgbWF4U2l6ZSA9IDc7XHJcbiAgICAvKiog5piv5ZCm5pi+56S66aG156CBICovXHJcbiAgICBASW5wdXQoKSBkaXJlY3Rpb25MaW5rcyA9IHRydWU7XHJcblxyXG4gICAgQElucHV0KCkgYXV0b0hpZGUgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSByZXNwb25zaXZlID0gZmFsc2U7XHJcbiAgICAvKiog5LiK6aG15qCH562+ICovXHJcbiAgICBASW5wdXQoKSBwcmV2aW91c0xhYmVsID0gJ+S4iumhtSc7XHJcbiAgICAvKiog5LiL6aG15qCH562+ICovXHJcbiAgICBASW5wdXQoKSBuZXh0TGFiZWwgPSAn5LiL6aG1JztcclxuICAgIEBJbnB1dCgpIHNob3dQYWdlTGlzdCA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgc2hvd1BhZ2VJbmZvID0gdHJ1ZTtcclxuICAgIEBJbnB1dCgpIHNob3dQYWdlTnVtYmVyID0gdHJ1ZTtcclxuICAgIEBJbnB1dCgpIGxvY2tlZCA9IGZhbHNlO1xyXG5cclxuICAgIEBJbnB1dCgpIHNlbGVjdGVkRGF0YSA9IFtdO1xyXG4gICAgQElucHV0KCkgdmlld01vZGU6ICdkZWZhdWx0JyB8ICdzaW1wbGUnID0gJ2RlZmF1bHQnO1xyXG4gICAgQElucHV0KCkgbGlzdEl0ZW1Gb3JtYXR0ZXI6IChkYXRhKSA9PiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgc2hvd1NlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG5cclxuICAgIEBJbnB1dCgpIHNob3dHb3RvSW5wdXQgPSBmYWxzZTtcclxuXHJcbiAgICBAT3V0cHV0KCkgcGFnZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBwYWdlU2l6ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAT3V0cHV0KCkgcmVtb3ZlU2VsZWN0ZWRJdGVtID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIGNsZWFyU2VsZWN0ZWRJdGVtID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3BhZ2VyQ29udGFpbmVyJykgcGM6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdwYWdlcicpIHBhZ2VyOiBQYWdpbmF0aW9uQ29udHJvbHNDb21wb25lbnQ7XHJcblxyXG4gICAgZ2V0IHBhZ2luYXRpb24oKTogUGFnaW5hdGlvbkNvbnRyb2xzRGlyZWN0aXZlIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYWdlci5wYWdpbmF0aW9uRGlyZWN0aXZlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXQgcGFnZVNpemUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbi5nZXRQYWdlU2l6ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0b3RhbCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uLmdldFRvdGFsSXRlbXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgb3V0ZXJIZWlnaHQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGMubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiA0MDtcclxuICAgIH1cclxuICAgIHN0eWxlcyA9IHsgb3BhY2l0eTogMSB9O1xyXG5cclxuICAgIG1vdXNlSW5TZWxlY3RlZExpc3QgPSBmYWxzZTtcclxuICAgIG9wZW5TZWxlY3RlZExpc3QgPSBmYWxzZTtcclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdGlvbkRhdGFDaGFuZ2UkOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgbm90aWZ5U2VyOiBOb3RpZnlTZXJ2aWNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0OiBJbmplY3Rvcikge1xyXG4gICAgICAgIGlmICh0aGlzLmluamVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeVNlciA9IHRoaXMuaW5qZWN0LmdldDxOb3RpZnlTZXJ2aWNlPihOb3RpZnlTZXJ2aWNlLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5saXN0ZW5DaGVja0RhdGFDaGFuZ2VkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5zZWxlY3RlZERhdGEgJiYgIWNoYW5nZXMuc2VsZWN0ZWREYXRhLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWREYXRhIHx8ICF0aGlzLnNlbGVjdGVkRGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VTZWxlY3RlZExpc3QoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMuc2hvd1NlbGVjdGVkTGlzdCAmJiAhY2hhbmdlcy5zaG93U2VsZWN0ZWRMaXN0LmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLmxpc3RlbkNoZWNrRGF0YUNoYW5nZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsaXN0ZW5DaGVja0RhdGFDaGFuZ2VkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnNob3dTZWxlY3RlZExpc3QpIHtcclxuICAgICAgICAgICAgY29uc3QgZGcgPSB0aGlzLmluamVjdC5nZXQoRGF0YWdyaWRDb21wb25lbnQsIG51bGwpO1xyXG4gICAgICAgICAgICBpZiAoZGcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uRGF0YUNoYW5nZSQgPSBkZy5jaGVja2VkQ2hhbmdlLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25EYXRhQ2hhbmdlJCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25EYXRhQ2hhbmdlJC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25EYXRhQ2hhbmdlJCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25QYWdlQ2hhbmdlKHBhZ2VJbmRleDogYW55KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBwYWdlSW5kZXggPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIHBhZ2VJbmRleCA9IHBhZ2VJbmRleC5wYWdlSW5kZXggfHwgMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wYWdlQ2hhbmdlLmVtaXQoTnVtYmVyLnBhcnNlSW50KHBhZ2VJbmRleCwgMTApKTtcclxuICAgIH1cclxuXHJcbiAgICBvblBhZ2VTaXplQ2hhbmdlKHBhZ2VTaXplOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnBhZ2VTaXplQ2hhbmdlLmVtaXQoTnVtYmVyLnBhcnNlSW50KHBhZ2VTaXplLCAxMCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvY2soKSB7XHJcbiAgICAgICAgdGhpcy5sb2NrZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc3R5bGVzID0ge29wYWNpdHk6IDAuNSB9O1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG4gICAgdW5sb2NrKCkge1xyXG4gICAgICAgIHRoaXMubG9ja2VkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zdHlsZXMgPSB7b3BhY2l0eTogMSB9O1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW91c2VFbnRlcigkZXZlbnQpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmxvY2tlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm1vdXNlSW5TZWxlY3RlZExpc3QgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRGF0YSAmJiB0aGlzLnNlbGVjdGVkRGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5vcGVuU2VsZWN0ZWRMaXN0ID0gIXRoaXMub3BlblNlbGVjdGVkTGlzdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5TZWxlY3RlZExpc3QgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNsb3NlU2VsZWN0ZWRMaXN0KCkge1xyXG4gICAgICAgIHRoaXMub3BlblNlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubW91c2VJblNlbGVjdGVkTGlzdCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRGVsU2VsZWN0ZWRJdGVtKGlkOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZVNlbGVjdGVkSXRlbS5lbWl0KGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsZWFyU2VsZWN0ZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbGVhclNlbGVjdGVkSXRlbS5lbWl0KCk7XHJcbiAgICAgICAgdGhpcy5jbG9zZVNlbGVjdGVkTGlzdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uU2VsZWN0TGlzdFBhbmVsQ2xvc2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZVNlbGVjdGVkTGlzdCgpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==