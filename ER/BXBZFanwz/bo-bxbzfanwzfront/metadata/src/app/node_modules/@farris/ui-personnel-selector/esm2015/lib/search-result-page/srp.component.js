/**
 * @fileoverview added by tsickle
 * Generated from: lib/search-result-page/srp.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ChangeDetectorRef, Optional, Injector } from '@angular/core';
import { noDataImg } from '../../assets/resource';
import { NotifyService } from '@farris/ui-notify';
import { FavoritesTool } from '../../utils/favorites.tool';
export class SearchResultComponent {
    /**
     * @param {?} notifyService
     * @param {?} favoritesTool
     * @param {?} injector
     */
    constructor(notifyService, favoritesTool, injector) {
        this.notifyService = notifyService;
        this.favoritesTool = favoritesTool;
        this.injector = injector;
        this.selectionsChange = new EventEmitter();
        this.closePanelChange = new EventEmitter();
        this.pageIndexChange = new EventEmitter();
        // 当前搜索页中所有数据已被勾选
        this.allChecked = false;
        // 右侧已选人员数据
        this.selections = [];
        this.cloneSelections = [];
        this.allIndexId = 'allIndexId';
        this.noDataImg = noDataImg;
        // 搜索结果，用于页面展示
        this.items = [];
        this.recentContactsList = [];
        this.favoritesList = [];
        // 搜索结果页索引
        this.pageIndex = 1;
        // 是否显示用户编号
        this.showUserCode = true;
        this.allIndexId = Math.random().toString(16).substring(3, 12);
        this.cdRef = this.injector.get(ChangeDetectorRef);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set data(value) {
        this.items = value;
        this.loadSearchResult();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // 兼容老表单
        if (this.favoritesTool) {
            this.favoritesTool.favoritesSubject.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                this.favoritesList = data;
                if (this.enableFavorites) {
                    this.loadSearchResult();
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @param {?} dir
     * @param {?} num
     * @return {?}
     */
    turnOverPage(dir, num) {
        if ((dir === 'pre' && this.pageIndex === 1) || (dir === 'next' && this.pageIndex === this.pageTotal)) {
            return;
        }
        this.pageIndex = this.pageIndex + num;
        this.switchPage({ pageIndex: this.pageIndex });
    }
    /**
     * @param {?} inputEl
     * @param {?} maxNumber
     * @return {?}
     */
    beforePageIndexChange(inputEl, maxNumber) {
        /** @type {?} */
        const target = (/** @type {?} */ (inputEl.target));
        /** @type {?} */
        const currentPageNumber = Number(target.value);
        if (currentPageNumber > maxNumber) {
            target.value = maxNumber;
        }
        else {
            if (currentPageNumber < 1) {
                target.value = 1;
            }
        }
        this.pageIndex = Number(target.value);
    }
    /**
     * @param {?} size
     * @return {?}
     */
    switchPage(size) {
        this.pageIndexChange.emit(size);
    }
    /**
     * @return {?}
     */
    closePanel() {
        this.closePanelChange.emit(true);
    }
    // 目前点击触发按钮已被去掉，无法被触发 2022.3.15
    /**
     * @return {?}
     */
    toggleAll() {
        if (!this.allChecked) {
            this.checkAll();
        }
        else {
            this.unCheckAll();
        }
        this.emitSelections();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    toggleOne(data) {
        if (data.checked) {
            this.unSelectLine(data);
        }
        else {
            this.selectLine(data);
        }
        this.emitSelections();
    }
    /**
     * 用于数据展示
     * @return {?}
     */
    loadSearchResult() {
        this.items.forEach((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            /** @type {?} */
            const indexId = Math.random().toString(16).substring(3, 10);
            res.checked = false;
            res.inFavorites = false;
            res.indexId = indexId;
            if (this._isInArray(res[this.idField], this.idField, this.selections) !== -1) {
                res.checked = true;
            }
            if (this._isInArray(res[this.idField], this.idField, this.favoritesList) !== -1) {
                res.inFavorites = true;
            }
            res.displayName = !!this.showUserCode ? ('[' + res.code + ']' + res.name) : res.name;
        }));
        this.items = this.items.slice();
        this.toggleChecked();
    }
    /**
     * 全选后处理
     * @return {?}
     */
    checkAll() {
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            this._insertOneIntoSelections(item);
            item.checked = true;
        }));
    }
    /**
     * 全部取消
     * @return {?} void
     * 由toggleAll()转调，目前无法被触发 2022.3.15
     */
    unCheckAll() {
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            this.selections.forEach((/**
             * @param {?} selection
             * @param {?} index
             * @return {?}
             */
            (selection, index) => {
                if (item[this.idField] === selection[this.idField]) {
                    this.selections.splice(index, 1);
                }
            }));
            item.checked = false;
        }));
    }
    /**
     * 当前行选中
     * @param {?} data 当前行的数据（）
     * @return {?}
     */
    selectLine(data) {
        if (this.multiSelect) {
            this._insertOneIntoSelections(data);
        }
        else {
            this.selections = [];
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                if (item.checked) {
                    item.checked = false;
                }
            }));
            this._insertOneIntoSelections(data);
        }
        if (this.isAllChecked()) {
            this.allChecked = true;
        }
    }
    /**
     * 单选取消选中
     * @param {?} data 取消选中行
     * @return {?}
     */
    unSelectLine(data) {
        /** @type {?} */
        const index = this._isInArray(data[this.idField], this.idField, this.selections);
        if (index > -1) {
            this.selections.splice(index, 1);
        }
        if (this.allChecked) {
            this.allChecked = false;
        }
    }
    /**
     * @private
     * @return {?}
     */
    emitSelections() {
        /** @type {?} */
        const emitObj = {
            selections: this.selections,
            token: 'recent'
        };
        this.selectionsChange.emit(emitObj);
    }
    /**
     * @param {?} e
     * @param {?} item
     * @return {?}
     */
    toggleFavorites(e, item) {
        this.favoritesTool.toggleFavorites(e, item);
    }
    /**
     *  取消选中
     * @param {?} $event 取消勾选的数据
     * @return {?}
     */
    cancelSelections($event) {
        if (this.items.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        item => item[this.idField] === $event.id)) === -1) {
            return;
        }
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            if (item[this.idField] === $event.id) {
                item.checked = false;
            }
        }));
        this.selections.forEach((/**
         * @param {?} selection
         * @param {?} index
         * @return {?}
         */
        (selection, index) => {
            if ($event.id === selection[this.idField]) {
                this.selections.splice(index, 1);
            }
        }));
        this.allChecked = false;
    }
    /**
     * 全部取消勾选
     * @return {?}
     */
    clearCheckeds() {
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            item.checked = false;
        }));
        this.allChecked = false;
        this.selections = [];
    }
    /**
     * 选中并插入当前行数据到右侧
     * @param {?} data 当前行的数据
     * @return {?}
     */
    _insertOneIntoSelections(data) {
        // 如果当前数据已经移入右侧数据，则返回。
        if (this._isInArray(data[this.idField], this.idField, this.selections) > -1) {
            return;
        }
        this.selections.push(data);
        this.selections = this.selections.slice();
    }
    /**
     * 判断是否在内
     * @param {?} value value
     * @param {?} field field
     * @param {?} array array
     * @return {?} 位置索引
     */
    _isInArray(value, field, array) {
        if (!field || !value) {
            throw new Error('前2个参数必填');
        }
        return array.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        item => value === item[field]));
    }
    /**
     * 翻页检查：人员展示区的勾选状态与已选人员区是否对应
     * @return {?}
     */
    toggleChecked() {
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            if (this._isInArray(item[this.idField], this.idField, this.selections) > -1) {
                item.checked = true;
            }
            else {
                item.checked = false;
            }
        }));
        if (this.isAllChecked()) {
            this.allChecked = true;
        }
        else {
            this.allChecked = false;
        }
    }
    /**
     * @private
     * @return {?}
     */
    isAllChecked() {
        /** @type {?} */
        let count = 0;
        /** @type {?} */
        let allChecked = false;
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            this.selections.forEach((/**
             * @param {?} selection
             * @return {?}
             */
            selection => {
                if (item[this.idField] === selection[this.idField]) {
                    count += 1;
                }
            }));
        }));
        if (this.items.length === count && count > 0) {
            allChecked = true;
        }
        return allChecked;
    }
    /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    trackByFn(index, item) {
        return index;
    }
}
SearchResultComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-search-result',
                template: "<div class=\"candidate\">\r\n    <div class=\"candidate-title\">\r\n        <span>\u641C\u7D22\u7ED3\u679C\uFF08{{itemTotalCount}}\uFF09</span>\r\n        <!-- <div class=\"custom-control custom-checkbox mb-2\" *ngIf=\"multiSelect && items.length > 0\">\r\n            <input class=\"custom-control-input\" [id]=\"allIndexId\" type=\"checkbox\" [(ngModel)]=\"allChecked\">\r\n            <label class=\"custom-control-label\" [for]=\"allIndexId\" (click)=\"toggleAll()\">\u5168\u9009</label>\r\n        </div> -->\r\n        <span class=\"f-icon modal_close\" (click)=\"closePanel()\" title=\"\u5173\u95ED\"></span>\r\n    </div>\r\n    <perfect-scrollbar>\r\n        <div class=\"candidate-content\">\r\n            <div *ngFor=\"let data of items; let i = index;trackBy: trackByFn\" class=\"s-selectedPerson\">\r\n                <div class=\"custom-control custom-checkbox mb-2\">\r\n                    <input class=\"custom-control-input\" [id]=\"data.indexId\" type=\"checkbox\" [(ngModel)]=\"data.checked\">\r\n                    <label class=\"custom-control-label\" [for]=\"data.indexId\" (click)=\"toggleOne(data)\">\r\n                        <div style=\"display: flex; height: 32px; margin: -21px 0 0 24px;\">\r\n                            <farris-avatar [avatarWidth]=\"35\" [avatarHeight]=\"35\" [cover]=\"data.ext1\" [readonly]=\"true\">\r\n                            </farris-avatar>\r\n                            <div style=\"margin-left: 11px; margin-top: -2px;  padding-right: 10px; overflow: hidden;\">\r\n                                <p class=\"candidate-content-title\" title=\"{{data.displayName}}\">\r\n                                    {{data.displayName}}</p>\r\n                                <p class=\"candidate-content-orgpath\" title=\"{{data.orgAllPath}}\">\r\n                                    {{data.orgAllPath}}</p>\r\n                            </div>\r\n                        </div>\r\n                    </label>\r\n                </div>\r\n                <span class=\"f-icon f-icon-star\" *ngIf=\"enableFavorites\" [class.default-light-color]=\"data.inFavorites\"\r\n                    [class.default-dark-color]=\"!data.inFavorites\" (click)=\"toggleFavorites($event, data)\"></span>\r\n            </div>\r\n            <div *ngIf=\"items.length===0\" [ngStyle]=\"{'background-image': noDataImg}\" class=\"fp-candidate-nodata\">\r\n                \u6682\u65E0\u6570\u636E</div>\r\n        </div>\r\n    </perfect-scrollbar>\r\n    <div class=\"pagination-container\" *ngIf=\"items.length!==0\">\r\n        <ul class=\"ngx-pagination pagination pager-viewmode-simple\">\r\n            <li class=\"page-item d-flex flex-fill\"></li>\r\n            <li class=\"page-item\" [class.disabled]=\"pageIndex === 1\" (click)=\"turnOverPage('pre', -1)\">\r\n                <span class=\"page-link border-0\">\r\n                    <span class=\"f-icon f-page-pre\"></span>\r\n                </span>\r\n            </li>\r\n            <li class=\"page-item\">\r\n                <input id=\"farris-datagrid-gotopagenumber\" min=\"1\" type=\"number\" max=\"{{pageTotal}}\"\r\n                    [(ngModel)]=\"pageIndex\" style=\"width: 38px;\" (keyup.enter)=\"switchPage({pageIndex: pageIndex})\"\r\n                    (input)=\"beforePageIndexChange($event, pageTotal)\">\r\n            </li>\r\n            <li class=\"page-item page-separator\" style=\"margin-left: 10px\"> / </li>\r\n            <li class=\"page-item page-total\" style=\"margin-left: 5px\">\r\n                <span style=\"font-size: 16px; font-weight: 600;\"> {{pageTotal}}</span>\r\n            </li>\r\n            <li class=\"page-item\" [class.disabled]=\"pageIndex === pageTotal\" (click)=\"turnOverPage('next', 1)\">\r\n                <a class=\"page-link border-0\">\r\n                    <span class=\"f-icon f-page-next\"></span>\r\n                </a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>",
                styles: [":host{position:absolute;z-index:100;background:#fff;top:44px;right:0;left:0;bottom:0;display:-webkit-box;display:flex}.candidate{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-flex:1;flex:1;overflow:hidden}.candidate .s-selectedPerson:hover{background:#eef5ff;border-radius:5px}.candidate .candidate-content{padding-top:3px;clear:both}.candidate .s-selectedPerson{min-width:240px;float:left;width:calc(50% - 6px);position:relative;height:40px;padding:5px 12px;margin:0 3px 1px}.candidate .s-selectedPerson .f-icon-star{position:absolute;top:13px;right:15px;font-size:14px}.candidate .s-selectedPerson .default-light-color{color:#f7b500}.candidate .s-selectedPerson .default-dark-color{color:#d8dce6}.candidate .k-checkbox-label::after,.candidate .k-checkbox-label::before{top:10px;font-size:16px;width:14px;height:14px}.candidate .fp-candidate-nodata{width:100px;height:100px;text-align:center;background-repeat:no-repeat;background-size:contain;color:#b4bccc;padding-top:110px;position:absolute;left:50%;top:50%;margin:-70px 0 0 -50px}.candidate .candidate-content-title{margin:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:13px}.candidate .candidate-content-orgpath{margin:0;font-size:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;color:#c7ccd7}.candidate .candidate-title{display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between;padding:15px;font-size:14px}.candidate .candidate-title .custom-control{margin:10px 0 0 15px;line-height:35px}.candidate .candidate-title .title-clearall{margin:10px 15px 0 0;color:#2a87ff;cursor:pointer;line-height:35px}.candidate .s-selectedPerson .custom-control-label::before{top:8px}.candidate .candidate-title .f-icon{color:#878d99;cursor:pointer}"]
            }] }
];
/** @nocollapse */
SearchResultComponent.ctorParameters = () => [
    { type: NotifyService, decorators: [{ type: Optional }] },
    { type: FavoritesTool, decorators: [{ type: Optional }] },
    { type: Injector }
];
SearchResultComponent.propDecorators = {
    idField: [{ type: Input }],
    multiSelect: [{ type: Input }],
    enableFavorites: [{ type: Input }],
    data: [{ type: Input }],
    selectionsChange: [{ type: Output }],
    closePanelChange: [{ type: Output }],
    pageIndexChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SearchResultComponent.prototype.idField;
    /** @type {?} */
    SearchResultComponent.prototype.multiSelect;
    /** @type {?} */
    SearchResultComponent.prototype.enableFavorites;
    /** @type {?} */
    SearchResultComponent.prototype.selectionsChange;
    /** @type {?} */
    SearchResultComponent.prototype.closePanelChange;
    /** @type {?} */
    SearchResultComponent.prototype.pageIndexChange;
    /**
     * @type {?}
     * @private
     */
    SearchResultComponent.prototype.cdRef;
    /** @type {?} */
    SearchResultComponent.prototype.allChecked;
    /** @type {?} */
    SearchResultComponent.prototype.columns;
    /** @type {?} */
    SearchResultComponent.prototype.selections;
    /** @type {?} */
    SearchResultComponent.prototype.cloneSelections;
    /** @type {?} */
    SearchResultComponent.prototype.allIndexId;
    /** @type {?} */
    SearchResultComponent.prototype.noDataImg;
    /** @type {?} */
    SearchResultComponent.prototype.items;
    /** @type {?} */
    SearchResultComponent.prototype.recentContactsList;
    /** @type {?} */
    SearchResultComponent.prototype.favoritesList;
    /** @type {?} */
    SearchResultComponent.prototype.pageIndex;
    /** @type {?} */
    SearchResultComponent.prototype.pageTotal;
    /** @type {?} */
    SearchResultComponent.prototype.itemTotalCount;
    /** @type {?} */
    SearchResultComponent.prototype.showUserCode;
    /**
     * @type {?}
     * @private
     */
    SearchResultComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    SearchResultComponent.prototype.favoritesTool;
    /**
     * @type {?}
     * @private
     */
    SearchResultComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktcGVyc29ubmVsLXNlbGVjdG9yLyIsInNvdXJjZXMiOlsibGliL3NlYXJjaC1yZXN1bHQtcGFnZS9zcnAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBeUIsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFDdkcsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFPM0QsTUFBTSxPQUFPLHFCQUFxQjs7Ozs7O0lBb0M5QixZQUN3QixhQUE0QixFQUM1QixhQUE0QixFQUN4QyxRQUFrQjtRQUZOLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQ3hDLGFBQVEsR0FBUixRQUFRLENBQVU7UUE5QnBCLHFCQUFnQixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDM0MscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUMvQyxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7O1FBSXBELGVBQVUsR0FBRyxLQUFLLENBQUM7O1FBR25CLGVBQVUsR0FBVSxFQUFFLENBQUM7UUFFdkIsb0JBQWUsR0FBRyxFQUFFLENBQUM7UUFDckIsZUFBVSxHQUFHLFlBQVksQ0FBQztRQUMxQixjQUFTLEdBQUcsU0FBUyxDQUFDOztRQUV0QixVQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ1gsdUJBQWtCLEdBQUcsRUFBRSxDQUFDO1FBQ3hCLGtCQUFhLEdBQUcsRUFBRSxDQUFDOztRQUVuQixjQUFTLEdBQUcs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biAgICBDb21wb25lbnQsIElucHV0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgT25Jbml0LCBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiwgT3B0aW9uYWwsIEluamVjdG9yXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgbm9EYXRhSW1nIH0gZnJvbSAnLi4vLi4vYXNzZXRzL3Jlc291cmNlJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgRmF2b3JpdGVzVG9vbCB9IGZyb20gJy4uLy4uL3V0aWxzL2Zhdm9yaXRlcy50b29sJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsaWItc2VhcmNoLXJlc3VsdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vc3JwLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3NycC5jb21wb25lbnQuY3NzJ10sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTZWFyY2hSZXN1bHRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG5cclxuICAgIEBJbnB1dCgpIGlkRmllbGQ6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIG11bHRpU2VsZWN0OiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRmF2b3JpdGVzOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgc2V0IGRhdGEodmFsdWU6IGFueVtdKSB7XHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMubG9hZFNlYXJjaFJlc3VsdCgpO1xyXG4gICAgfVxyXG4gICAgQE91dHB1dCgpIHNlbGVjdGlvbnNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIEBPdXRwdXQoKSBjbG9zZVBhbmVsQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG4gICAgQE91dHB1dCgpIHBhZ2VJbmRleENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpOyBcclxuXHJcbiAgICBwcml2YXRlIGNkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZjtcclxuICAgIC8vIOW9k+WJjeaQnOe0oumhteS4reaJgOacieaVsOaNruW3suiiq+WLvumAiVxyXG4gICAgYWxsQ2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgY29sdW1uczogYW55O1xyXG4gICAgLy8g5Y+z5L6n5bey6YCJ5Lq65ZGY5pWw5o2uXHJcbiAgICBzZWxlY3Rpb25zOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgIGNsb25lU2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgYWxsSW5kZXhJZCA9ICdhbGxJbmRleElkJztcclxuICAgIG5vRGF0YUltZyA9IG5vRGF0YUltZztcclxuICAgIC8vIOaQnOe0oue7k+aenO+8jOeUqOS6jumhtemdouWxleekulxyXG4gICAgaXRlbXMgPSBbXTtcclxuICAgIHJlY2VudENvbnRhY3RzTGlzdCA9IFtdO1xyXG4gICAgZmF2b3JpdGVzTGlzdCA9IFtdO1xyXG4gICAgLy8g5pCc57Si57uT5p6c6aG157Si5byVXHJcbiAgICBwYWdlSW5kZXggPSAxO1xyXG4gICAgLy8g5pCc57Si57uT5p6c5oC76aG15pWwXHJcbiAgICBwYWdlVG90YWw6IG51bWJlcjtcclxuICAgIC8vIOaQnOe0oue7k+aenOaAu+aVsOmHj1xyXG4gICAgaXRlbVRvdGFsQ291bnQ6IG51bWJlcjtcclxuICAgIC8vIOaYr+WQpuaYvuekuueUqOaIt+e8luWPt1xyXG4gICAgc2hvd1VzZXJDb2RlID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBmYXZvcml0ZXNUb29sOiBGYXZvcml0ZXNUb29sLFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmFsbEluZGV4SWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMywgMTIpO1xyXG4gICAgICAgIHRoaXMuY2RSZWYgPSB0aGlzLmluamVjdG9yLmdldChDaGFuZ2VEZXRlY3RvclJlZik7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy8g5YW85a656ICB6KGo5Y2VXHJcbiAgICAgICAgaWYgKHRoaXMuZmF2b3JpdGVzVG9vbCkge1xyXG4gICAgICAgICAgICB0aGlzLmZhdm9yaXRlc1Rvb2wuZmF2b3JpdGVzU3ViamVjdC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZhdm9yaXRlc0xpc3QgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZW5hYmxlRmF2b3JpdGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU2VhcmNoUmVzdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICB9XHJcblxyXG4gICAgdHVybk92ZXJQYWdlKGRpcjogc3RyaW5nLCBudW06IG51bWJlcikge1xyXG4gICAgICAgIGlmICgoZGlyID09PSAncHJlJyAmJiB0aGlzLnBhZ2VJbmRleCA9PT0gMSkgfHwgKGRpciA9PT0gJ25leHQnICYmIHRoaXMucGFnZUluZGV4ID09PSB0aGlzLnBhZ2VUb3RhbCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBhZ2VJbmRleCA9IHRoaXMucGFnZUluZGV4ICsgbnVtO1xyXG4gICAgICAgIHRoaXMuc3dpdGNoUGFnZSh7IHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXggfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYmVmb3JlUGFnZUluZGV4Q2hhbmdlKGlucHV0RWw6IEtleWJvYXJkRXZlbnQsIG1heE51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGlucHV0RWwudGFyZ2V0IGFzIGFueTtcclxuICAgICAgICBjb25zdCBjdXJyZW50UGFnZU51bWJlciA9IE51bWJlcih0YXJnZXQudmFsdWUpO1xyXG4gICAgICAgIGlmIChjdXJyZW50UGFnZU51bWJlciA+IG1heE51bWJlcikge1xyXG4gICAgICAgICAgICB0YXJnZXQudmFsdWUgPSBtYXhOdW1iZXI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRQYWdlTnVtYmVyIDwgMSkge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0LnZhbHVlID0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBhZ2VJbmRleCA9IE51bWJlcih0YXJnZXQudmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHN3aXRjaFBhZ2Uoc2l6ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5wYWdlSW5kZXhDaGFuZ2UuZW1pdChzaXplKTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZVBhbmVsKCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VQYW5lbENoYW5nZS5lbWl0KHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOebruWJjeeCueWHu+inpuWPkeaMiemSruW3suiiq+WOu+aOie+8jOaXoOazleiiq+inpuWPkSAyMDIyLjMuMTVcclxuICAgIHRvZ2dsZUFsbCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuYWxsQ2hlY2tlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrQWxsKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy51bkNoZWNrQWxsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZW1pdFNlbGVjdGlvbnMoKTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVPbmUoZGF0YSkge1xyXG4gICAgICAgIGlmIChkYXRhLmNoZWNrZWQpIHtcclxuICAgICAgICAgICAgdGhpcy51blNlbGVjdExpbmUoZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RMaW5lKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVtaXRTZWxlY3Rpb25zKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOeUqOS6juaVsOaNruWxleekulxyXG4gICAgICovXHJcbiAgICBsb2FkU2VhcmNoUmVzdWx0KCkge1xyXG4gICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChyZXMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleElkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDMsIDEwKTtcclxuICAgICAgICAgICAgcmVzLmNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmVzLmluRmF2b3JpdGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJlcy5pbmRleElkID0gaW5kZXhJZDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2lzSW5BcnJheShyZXNbdGhpcy5pZEZpZWxkXSwgdGhpcy5pZEZpZWxkLCB0aGlzLnNlbGVjdGlvbnMpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmVzLmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9pc0luQXJyYXkocmVzW3RoaXMuaWRGaWVsZF0sIHRoaXMuaWRGaWVsZCwgdGhpcy5mYXZvcml0ZXNMaXN0KSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJlcy5pbkZhdm9yaXRlcyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzLmRpc3BsYXlOYW1lID0gISF0aGlzLnNob3dVc2VyQ29kZSA/ICgnWycgKyByZXMuY29kZSArICddJyArIHJlcy5uYW1lKSA6IHJlcy5uYW1lO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLml0ZW1zLnNsaWNlKCk7XHJcbiAgICAgICAgdGhpcy50b2dnbGVDaGVja2VkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlhajpgInlkI7lpITnkIZcclxuICAgICAqIEBwYXJhbSBkYXRhQXJyIOWFqOmAieeahOWAvFxyXG4gICAgICog55SxdG9nZ2xlQWxsKCnovazosIPvvIznm67liY3ml6Dms5Xooqvop6blj5EgMjAyMi4zLjE1XHJcbiAgICAgKi9cclxuICAgIGNoZWNrQWxsKCkge1xyXG4gICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgdGhpcy5faW5zZXJ0T25lSW50b1NlbGVjdGlvbnMoaXRlbSk7XHJcbiAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlhajpg6jlj5bmtohcclxuICAgICAqIEBwYXJhbSBkYXRhQXJyIOWPlua2iOeahOaVsOaNrlxyXG4gICAgICogQHJldHVybnMgdm9pZFxyXG4gICAgICog55SxdG9nZ2xlQWxsKCnovazosIPvvIznm67liY3ml6Dms5Xooqvop6blj5EgMjAyMi4zLjE1XHJcbiAgICAgKi9cclxuICAgIHVuQ2hlY2tBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMuZm9yRWFjaCgoc2VsZWN0aW9uLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1bdGhpcy5pZEZpZWxkXSA9PT0gc2VsZWN0aW9uW3RoaXMuaWRGaWVsZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN6KGM6YCJ5LitXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDlvZPliY3ooYznmoTmlbDmja7vvIjvvIlcclxuICAgICAqL1xyXG4gICAgc2VsZWN0TGluZShkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbnNlcnRPbmVJbnRvU2VsZWN0aW9ucyhkYXRhKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5faW5zZXJ0T25lSW50b1NlbGVjdGlvbnMoZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlzQWxsQ2hlY2tlZCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWxsQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Y2V6YCJ5Y+W5raI6YCJ5LitXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDlj5bmtojpgInkuK3ooYxcclxuICAgICAqL1xyXG4gICAgdW5TZWxlY3RMaW5lKGRhdGE6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5faXNJbkFycmF5KGRhdGFbdGhpcy5pZEZpZWxkXSwgdGhpcy5pZEZpZWxkLCB0aGlzLnNlbGVjdGlvbnMpO1xyXG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hbGxDaGVja2VkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWxsQ2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGVtaXRTZWxlY3Rpb25zKCkge1xyXG4gICAgICAgIGNvbnN0IGVtaXRPYmogPSB7XHJcbiAgICAgICAgICAgIHNlbGVjdGlvbnM6IHRoaXMuc2VsZWN0aW9ucyxcclxuICAgICAgICAgICAgdG9rZW46ICdyZWNlbnQnXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnNDaGFuZ2UuZW1pdChlbWl0T2JqKTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVGYXZvcml0ZXMoZTogYW55LCBpdGVtOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmZhdm9yaXRlc1Rvb2wudG9nZ2xlRmF2b3JpdGVzKGUsIGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogIOWPlua2iOmAieS4rVxyXG4gICAgICogQHBhcmFtICRldmVudCDlj5bmtojli77pgInnmoTmlbDmja5cclxuICAgICAqL1xyXG4gICAgY2FuY2VsU2VsZWN0aW9ucygkZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5pdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gPT09ICRldmVudC5pZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbVt0aGlzLmlkRmllbGRdID09PSAkZXZlbnQuaWQpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zLmZvckVhY2goKHNlbGVjdGlvbiwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKCRldmVudC5pZCA9PT0gc2VsZWN0aW9uW3RoaXMuaWRGaWVsZF0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5hbGxDaGVja2VkID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlhajpg6jlj5bmtojli77pgIlcclxuICAgICAqL1xyXG4gICAgY2xlYXJDaGVja2VkcygpIHtcclxuICAgICAgICB0aGlzLml0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYWxsQ2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCJ5Lit5bm25o+S5YWl5b2T5YmN6KGM5pWw5o2u5Yiw5Y+z5L6nXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDlvZPliY3ooYznmoTmlbDmja5cclxuICAgICAqIEBwYXJhbSBjb2xsZWN0aW9uIOaaguWtmOW9k+WJjeaVsOaNrueahOmbhuWQiFxyXG4gICAgICovXHJcbiAgICBfaW5zZXJ0T25lSW50b1NlbGVjdGlvbnMoZGF0YTogYW55KSB7XHJcbiAgICAgICAgLy8g5aaC5p6c5b2T5YmN5pWw5o2u5bey57uP56e75YWl5Y+z5L6n5pWw5o2u77yM5YiZ6L+U5Zue44CCXHJcbiAgICAgICAgaWYgKHRoaXMuX2lzSW5BcnJheShkYXRhW3RoaXMuaWRGaWVsZF0sIHRoaXMuaWRGaWVsZCwgdGhpcy5zZWxlY3Rpb25zKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goZGF0YSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gdGhpcy5zZWxlY3Rpb25zLnNsaWNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKTmlq3mmK/lkKblnKjlhoVcclxuICAgICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGZpZWxkIGZpZWxkXHJcbiAgICAgKiBAcGFyYW0gYXJyYXkgYXJyYXlcclxuICAgICAqIEByZXR1cm5zIOS9jee9rue0ouW8lVxyXG4gICAgICovXHJcbiAgICBfaXNJbkFycmF5KHZhbHVlOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIGFycmF5OiBhbnlbXSk6IG51bWJlciB7XHJcbiAgICAgICAgaWYgKCFmaWVsZCB8fCAhdmFsdWUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfliY0y5Liq5Y+C5pWw5b+F5aGrJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhcnJheS5maW5kSW5kZXgoaXRlbSA9PiB2YWx1ZSA9PT0gaXRlbVtmaWVsZF0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog57+76aG15qOA5p+l77ya5Lq65ZGY5bGV56S65Yy655qE5Yu+6YCJ54q25oCB5LiO5bey6YCJ5Lq65ZGY5Yy65piv5ZCm5a+55bqUXHJcbiAgICAgKi9cclxuICAgIHRvZ2dsZUNoZWNrZWQoKSB7XHJcbiAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5faXNJbkFycmF5KGl0ZW1bdGhpcy5pZEZpZWxkXSwgdGhpcy5pZEZpZWxkLCB0aGlzLnNlbGVjdGlvbnMpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQWxsQ2hlY2tlZCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWxsQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hbGxDaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNBbGxDaGVja2VkKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGxldCBjb3VudCA9IDA7XHJcbiAgICAgICAgbGV0IGFsbENoZWNrZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMuZm9yRWFjaChzZWxlY3Rpb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1bdGhpcy5pZEZpZWxkXSA9PT0gc2VsZWN0aW9uW3RoaXMuaWRGaWVsZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IGNvdW50ICYmIGNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICBhbGxDaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFsbENoZWNrZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgdHJhY2tCeUZuKGluZGV4LCBpdGVtKSB7XHJcbiAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=