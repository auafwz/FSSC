// tslint:disable: max-line-length member-ordering
/**
 * 绑定数据相关定义
 * @author Witt<jiwt@inspur.com>
 * @todo
 * 1、全局的BindingData和局部的BindingData应该拆成两个类，两个类之间是装饰关系；；
 * 2、为了保持兼容，减少改动量，暂时放在一起，待进一步重构。
 */
import { Injectable } from '@angular/core';
import { ChangeType } from './changes';
import { BindingList } from './binding_list';
import { BindingListFactory } from './binding_list_factory';
import { PropertyUtil } from './property_util';
import { EntityUtil } from './entity_util';
/**
 * 绑定数据
 * @description
 * # BindingData
 *
 * BindingData用于直接和界面绑定，它持有一个不可变的数据集合（BindingList），数据集合中是一个个不可变的数据对象（BindingObject）。
 *
 * ## 更新界面数据
 *
 * ### 接口定义
 *
 * ```javascript
 * //根据paths设置属性值
 * //@param paths 属性路径数组
 * //@param value 属性值
 * //@param emitEventToView 如果设置为true，则发送事件通知订阅它的组件、指令去更新界面，默认为false。
 * //@param emitEventToEntity 如果设置为true，则同步去更新Entity上对应的字段，默认为true。
 * public setValue(paths: string[], value: any, emitEventToView: boolean = false, emitEventToEntity: boolean = true)
 * ```
 *
 * ### 示例
 *
 * - 更新主表数据
 *
 *   ```javascript
 *   bindingData.setValue(['name'],'ESG');
 *   ```
 *
 * - 更新子表数据
 *
 *   ```javascript
 *   bindingData.setValue(['soItems','price'],20);
 *   ```
 *
 * - 更新业务字段数据
 *
 *   ```javascript
 *   bindingData.setValue(['udt','udt_field'],'value');
 *   ```
 *
 * - 仅更新界面数据（不提交变更集）
 *
 *   ```javascript
 *   bindingData.setValue(['name'],'ESG',true,false);
 *   ```
 *
 *   > 注意：
 *   >
 *   > 仅更新界面数据时bindingData必须是对应组件上下文的bindingData。
 *   >
 *   > 更新数据的命令挂载到不同的组件，产生的效果也不相同。如果命令挂到了卡片视图模型，那么可以直接在构件中注入`FrameContext`或`BindingData`并更新数据就可以。但如果命令挂到了非卡片视图 * 模型，则应该先获取到卡片上下文的bindingData。
 *   >
 *   > - 命令挂在卡片视图模型:
 *   >
 *   >   ```javascript
 *   >   const frameContext = this.frameContext.bindingData;
 *   >   frameContext.bindingData.setValue(['name'],'ESG');
 *   >   ```
 *   >
 *   > - 命令挂在非卡片视图模型：
 *   >
 *   >   ```javascript
 *   >   const cardFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('card-frameId');
 *   >   cardFrameContext.bindingData.setValue(['name'],'ESG');
 *   >   ```
 *
 * ## 获取界面数据
 *
 * ### 接口定义
 *
 *   ```javascript
 *   //获取paths对应的属性值
 *   //@param  paths 属性路径数组
 *   //@returns 属性值
 *   public getValue(paths: string[], useInitValue = false)
 *   ```
 *
 * ### 示例
 *
 * - 获取主表数据
 *
 *   ```javascript
 *   bindingData.getValue(['name']) //'ESG'
 *   ```
 *
 * - 获取从表中字段属性
 *
 *   ```javascript
 *   bindingData.getValue(['soItems','price']); // 20
 *   ```
 *
 * - 获取业务字段数据
 *
 *   ```javascript
 *   bindingData.getValue(['udt','udt_field']); // 'value'
 *   ```
 *
 * ## 获取指定BindingObject
 *
 * ### 接口定义
 *
 * ```javascript
 * //通过主键获取对应的bindingObject
 * bindingData.list.findById(id: string): BindingObject;
 * ```
 *
 * ### 示例
 * - 获取某个主实体
 *   ```javascript
 *   bindingData.list.findById("id");
 *   ```
 * - 获取某个实体下子表的所有数据
 *   ```javascript
 *   // 获取主实体
 *   const bindingObject = bindingData.list.findById("id") as BindingObject;
 *   // 获取该实体下的某个子表数据
 *   const bindingList = bindingObject.getValue("soItems") as BindingList;
 *   ```
 *
 * - 获取子表某一行数据
 *
 *   ```javascript
 *   //获取主实体
 *   const bindingObject = bindingData.list.findById("id") as BindingObject;
 *   //获取该实体下的某个子表数据
 *   const bindingList = bindingObject.getValue("soItems") as BindingList;
 *   //子表行数据
 *   const childrenBindingObject = bindingList.findById('子表数据id');
 *   const name = childrenBindingObject.getValue("name"); // 或者childrenBindingObject['name']
 *   ```
 *
 * ## 常见问题
 *
 * ### 赋值或取值时为何不用指定主键？
 *
 *    示例中取值或赋值时并没有指定主键值，这是由于BindingData赋值或取值时都是对当前行就行操作的，所以不需要指定主键。所以在计算&行切换场景下会导致取值或赋值错误，如本来想给第一行的某个字 * 段赋值，结果由于行切换导致把值赋给了其他行。
 *
 *    如果遇到赋值错误的情况可以通过BindingObject赋值或取值。
 *
 * ### 通过bindingData赋值了，界面也刷新了，但保存不上
 *
 *    这种情况多发生在有后端请求的情况下，比如通过bindingData赋值后紧接着有一个后端请求。由于bindingData赋值是异步的（目前是），这就可能导致赋值还没有结束（还没有产生变更）请求就发送 * 了，从而请求中没有对应的变更，请求回来后会默认清空本地变更，从而导致界面上显示数据已经修改，但数据库中数据并未修改。
 *
 *    解决该类问题可以通过实体赋值的方式，给实体赋值是同步的，赋值完成后变更就会产生，这样再发送请求时就可以把变更带到后端。
 */
class BindingData {
    constructor() {
        this.paginationInfo = null;
    }
    set pagingInfo(pagingInfo) {
        this.paginationInfo = pagingInfo;
        this.firePagingChangeEvent();
    }
    get pagingInfo() {
        return this.paginationInfo;
    }
    /**
     * 设置分页信息
     * @param skip 跳过
     * @param take 获取
     * @param bindingPath 路径
     */
    setPagingInfo(skip, take, bindingPath) {
        if (bindingPath.length < 1 || bindingPath === '/') {
            this.paginationInfo = Object.assign(this.paginationInfo, { pageSize: take, pageIndex: skip / take + 1 });
        }
        else {
            let pagingInfo = this.paginationInfo || {};
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0); // .map(item => item.substring(0, item.length - 1));
            let nodeCode = bindingPaths[bindingPaths.length - 1];
            // 去s
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            // 找到父级
            // 获取当前实体上级的主键
            const paths = bindingPaths.slice(0, bindingPaths.length - 1);
            const parentObject = this.getValue(paths);
            if (parentObject && parentObject[parentObject.primaryKey]) {
                // const key = `${nodeCode}_${parentObject[parentObject.primaryKey]}`;
                const key = `${nodeCode}`;
                pagingInfo = pagingInfo[key] || {};
                pagingInfo.pageIndex = ((skip / take) || 0) + 1;
                pagingInfo.pageSize = take || 0;
            }
        }
        this.firePagingChangeEvent();
    }
    updatePagingInfo(pageInfo, bindingPath) {
        if (bindingPath.length < 1 || bindingPath === '/') {
            this.paginationInfo = Object.assign(this.paginationInfo, pageInfo);
        }
        else {
            let pagingInfo = this.paginationInfo || {};
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0); // .map(item => item.substring(0, item.length - 1));
            let nodeCode = bindingPaths[bindingPaths.length - 1];
            // 去s
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            pagingInfo[nodeCode] = Object.assign(pagingInfo[nodeCode], pageInfo);
        }
        this.firePagingChangeEvent();
    }
    firePagingChangeEvent() {
        this.list.changes.next({
            type: ChangeType.PaginationInfoChange,
            path: this.bindingPath && this.bindingPath.split('/').filter(p => p) || [],
            value: this.paginationInfo
        });
    }
    /**
     * 变更集
     */
    get changes() {
        return this.list.changes;
    }
    /**
     * 设置值变化执行器工厂
     * @param value 值变化执行器工厂
     */
    setValueChangeInvokerFactory(value) {
        this.valueChangeInvokerFactory = value;
    }
    getValudChangeInvokerFactory() {
        return this.valueChangeInvokerFactory;
    }
    /**
     * 初始化（已废弃）
     */
    init(repository, bindingPath) {
        this.initByRepository(repository, bindingPath);
    }
    /**
     * 根据Repository对BindingData进行初始化
     */
    initByRepository(repository, bindingPath) {
        this.bindingPath = bindingPath;
        this.properties = PropertyUtil.getProperties(repository.entityType);
        this.list = BindingListFactory.create(this.properties);
        // 从repository初始化bindingData
        this.pagingInfo = repository.entityCollection.paginationInfo;
        // @todo
        // BindingData不应该知道Repository，加载数据、建立关联关系的过程应该转移到外边
        EntityUtil.loadRepository(repository, this.list);
        this.dataTypeInfo = repository.entityTypeInfo;
        this.extendProperties(this.properties);
    }
    /**
     * 初始化
     */
    initByBindingList(bindingList, bindingPath) {
        this.list = bindingList;
        this.bindingPath = bindingPath;
        this.extendProperties(this.list.properties);
    }
    setDataTypeInfo(dataTypeInfo) {
        this.dataTypeInfo = dataTypeInfo;
    }
    /**
     * 获取界面数据
     * @param paths 属性路径数组
     * @param useInitValue 是否使用默认值，默认为`false`
     * @returns 属性值
     */
    getValue(paths, useInitValue = false) {
        let target = this.list;
        paths.forEach((path) => {
            if (target) {
                target = target[path];
            }
        });
        if (useInitValue === true && paths && paths.length > 0) {
            const initValue = this.getInitValueByPaths(paths);
            if (target === undefined && target !== initValue) {
                target = initValue;
            }
        }
        return target;
    }
    /**
     * 该方法可以更新绑定层数据，从而达到更新界面数据的目的，进而更新本地仓库实体数据，产生变更，下次请求时会将变更带到后端并更新后端数据。
     * @param paths 属性路径数组
     * @param value 属性值
     * @param emitEventToView 如果设置为true，则发送事件通知订阅它的组件、指令去更新界面，默认为false。
     * @param emitEventToEntity 如果设置为true，则同步去更新Entity上对应的字段，默认为true。
     * @description
     * ## 示例
     *
     * ### 更新界面数据
     * 使用该方法时只传递path和value参数，其余参数使用默认值。该用法会更新界面数据，同时更新实体数据，实体数据更新时会产生变更，这样在下次请求时会将该变更带到后端，
     * 进而更新后端数据。
     * ```typescript
     * this.frameContext.bindingData.setValue(paths,value);
     * ```
     *
     * ### 仅更新界面数据
     * 有些场景下我们希望只更新界面的数据，不希望对后端数据产生影响，此时除传递paths和value参数外，还需要将emitEventToView设为true，emitEventToEntity设为false，
     * 此时必须使用对应BindingData的setValue方法：
     * ```typescript
     * const tableFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('data-grid-component');
     * tableFrameContext.bindingData.setValue(paths,value,true,false);
     * ```
     * ## 注意事项
     * setValue为异步方法，如果调用该方法后随即发送后端请求，此时实体变更尚未产生，但请求已经发送，变更无法带到后端，导致变更丢失，出现界面上显示数据已经修改，
     * 但后端并未修改的问题。
     * 因此，如果赋值后随即发送请求应该使用实体赋值的方法。
     */
    setValue(paths, value, emitEventToView = false, emitEventToEntity = true, errors = {}, context) {
        if (!paths || paths.length === 0) {
            throw Error('路径不能为空');
        }
        const parentPaths = paths.slice(0, paths.length - 1);
        const propName = paths[paths.length - 1];
        let parent = this.getValue(parentPaths);
        if (!parent) {
            throw Error('找不到要设置的对象');
        }
        if (parent instanceof BindingData) {
            parent = parent.list.currentItem;
        }
        else if (parent instanceof BindingList) {
            parent = parent.currentItem;
        }
        if (!!this.valueChangeInvokerFactory) {
            parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, this.valueChangeInvokerFactory(paths), context);
        }
        else {
            parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, null, context);
        }
    }
    /**
     * 根据paths清空属性值
     */
    clearValue(paths, emitEventToView = false, emitEventToEntity = true, context) {
        let initValue;
        const propInfo = this.dataTypeInfo.getPropInfoByPath(paths);
        if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {
            initValue = propInfo.metadataInfo.initValue;
        }
        else {
            // 原来的帮助映射中，强行纠正了数值的情况，保持一致
            const oldValue = this.getValue(paths);
            if (typeof oldValue === 'number') {
                initValue = 0;
            }
            else {
                initValue = '';
            }
        }
        this.setValue(paths, initValue, emitEventToView, emitEventToEntity, null, context);
    }
    /**
     * 获取当前列表
     */
    getList() {
        if (!this.bindingPath || this.bindingPath === '/') {
            return this.list;
        }
        const bindingPath = this.bindingPath.substr(1);
        const bindingPathArray = bindingPath.split('/').filter((part) => {
            return part !== '';
        });
        return this.getValue(bindingPathArray);
    }
    /**
     * 获取当前对象
     */
    getObject() {
        const bindingList = this.getList();
        return bindingList.currentItem;
    }
    /**
     * 绑定路径（仅路径部分，不包括属性）
     * @param bindingPath 绑定路径
     */
    getPath(bindingPath) {
        const bindingPaths = bindingPath.filter(p => p);
        const path = [`${this.list.primaryKey}:${this.list.currentId}`];
        bindingPaths.forEach((item) => {
            path.push(item);
            const list = this[item];
            if (list) {
                path.push(`${list.primaryKey}:${list.currentId}`);
            }
        });
        return path;
    }
    /**
     * 清空绑定数据
     */
    reset() {
        this.list.clear();
    }
    /**
     * 通过绑定路径获取属性初始值
     * @param paths 绑定路径
     */
    getInitValueByPaths(paths) {
        let initValue;
        const propInfo = this.dataTypeInfo && this.dataTypeInfo.getPropInfoByPath(paths) || null;
        if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {
            initValue = propInfo.metadataInfo.initValue;
        }
        return initValue;
    }
    /**
     * 扩展BindingData属性，映射BindingData所持有的绑定列表当前行的属性，减少绑定层级。
     * @param properties 关联实体的属性集合
     */
    extendProperties(properties) {
        properties.forEach((property) => {
            const propName = property.name;
            Object.defineProperty(this, propName, {
                get: () => {
                    return this.list.currentItem[propName];
                },
                set: (value) => {
                    this.list.currentItem[propName] = value;
                }
            });
        });
    }
}
BindingData.decorators = [
    { type: Injectable }
];
export { BindingData };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19kYXRhLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2JpbmRpbmdfZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrREFBa0Q7QUFDbEQ7Ozs7OztHQU1HO0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkzQyxPQUFPLEVBQVUsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRS9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkzQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBZ0pHO0FBQ0gsTUFDTSxXQUFXO0lBRGpCO1FBMEJVLG1CQUFjLEdBQUcsSUFBSSxDQUFDO0lBK1JoQyxDQUFDO0lBN1JDLElBQVcsVUFBVSxDQUFDLFVBQWU7UUFDbkMsSUFBSSxDQUFDLGNBQWMsR0FBRyxVQUFVLENBQUM7UUFDakMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVELElBQVcsVUFBVTtRQUNuQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUNEOzs7OztPQUtHO0lBQ0ksYUFBYSxDQUFDLElBQVksRUFBRSxJQUFZLEVBQUUsV0FBbUI7UUFDbEUsSUFBSSxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxX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Q0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUM7UUFDekYsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLFlBQVksSUFBSSxRQUFRLENBQUMsWUFBWSxDQUFDLFNBQVMsS0FBSyxTQUFTLEVBQUU7WUFDdEYsU0FBUyxHQUFHLFFBQVEsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDO1NBQzdDO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUNEOzs7T0FHRztJQUNLLGdCQUFnQixDQUFDLFVBQTZCO1FBQ3BELFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUF5QixFQUFFLEVBQUU7WUFDL0MsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztZQUMvQixNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUU7Z0JBQ3BDLEdBQUcsRUFBRSxHQUFHLEVBQUU7b0JBQ1IsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDekMsQ0FBQztnQkFDRCxHQUFHLEVBQUUsQ0FBQyxLQUFVLEVBQUUsRUFBRTtvQkFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEdBQUcsS0FBSyxDQUFDO2dCQUMxQyxDQUFDO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOzs7WUF4VEYsVUFBVTs7QUEyVFgsT0FBTyxFQUFFLFdBQVcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aCBtZW1iZXItb3JkZXJpbmdcclxuLyoqXHJcbiAqIOe7keWumuaVsOaNruebuOWFs+WumuS5iVxyXG4gKiBAYXV0aG9yIFdpdHQ8aml3dEBpbnNwdXIuY29tPlxyXG4gKiBAdG9kb1xyXG4gKiAx44CB5YWo5bGA55qEQmluZGluZ0RhdGHlkozlsYDpg6jnmoRCaW5kaW5nRGF0YeW6lOivpeaLhuaIkOS4pOS4quexu++8jOS4pOS4quexu+S5i+mXtOaYr+ijhemlsOWFs+ezu++8m++8m1xyXG4gKiAy44CB5Li65LqG5L+d5oyB5YW85a6577yM5YeP5bCR5pS55Yqo6YeP77yM5pqC5pe25pS+5Zyo5LiA6LW377yM5b6F6L+b5LiA5q2l6YeN5p6E44CCXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IERhdGFUeXBlSW5mbyB9IGZyb20gJy4uL2NvcmUvZGF0YS10eXBlLWluZm8nO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yeS9pbmRleCc7XHJcbmltcG9ydCB7IENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0IH0gZnJvbSAnLi9iaW5kaW5nX2xpc3QnO1xyXG5pbXBvcnQgeyBCaW5kaW5nTGlzdEZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfbGlzdF9mYWN0b3J5JztcclxuaW1wb3J0IHsgUHJvcGVydHlVdGlsIH0gZnJvbSAnLi9wcm9wZXJ0eV91dGlsJztcclxuaW1wb3J0IHsgRW50aXR5VXRpbCB9IGZyb20gJy4vZW50aXR5X3V0aWwnO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XHJcbmltcG9ydCB7IEludm9rZU9uVmFsdWVDaGFuZ2UgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbi8qKlxyXG4gKiDnu5HlrprmlbDmja5cclxuICogQGRlc2NyaXB0aW9uXHJcbiAqICMgQmluZGluZ0RhdGFcclxuICogXHJcbiAqIEJpbmRpbmdEYXRh55So5LqO55u05o6l5ZKM55WM6Z2i57uR5a6a77yM5a6D5oyB5pyJ5LiA5Liq5LiN5Y+v5Y+Y55qE5pWw5o2u6ZuG5ZCI77yIQmluZGluZ0xpc3TvvInvvIzmlbDmja7pm4blkIjkuK3mmK/kuIDkuKrkuKrkuI3lj6/lj5jnmoTmlbDmja7lr7nosaHvvIhCaW5kaW5nT2JqZWN077yJ44CCXHJcbiAqIFxyXG4gKiAjIyDmm7TmlrDnlYzpnaLmlbDmja5cclxuICogXHJcbiAqICMjIyDmjqXlj6PlrprkuYlcclxuICogXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy/moLnmja5wYXRoc+iuvue9ruWxnuaAp+WAvFxyXG4gKiAvL0BwYXJhbSBwYXRocyDlsZ7mgKfot6/lvoTmlbDnu4RcclxuICogLy9AcGFyYW0gdmFsdWUg5bGe5oCn5YC8XHJcbiAqIC8vQHBhcmFtIGVtaXRFdmVudFRvVmlldyDlpoLmnpzorr7nva7kuLp0cnVl77yM5YiZ5Y+R6YCB5LqL5Lu26YCa55+l6K6i6ZiF5a6D55qE57uE5Lu244CB5oyH5Luk5Y675pu05paw55WM6Z2i77yM6buY6K6k5Li6ZmFsc2XjgIJcclxuICogLy9AcGFyYW0gZW1pdEV2ZW50VG9FbnRpdHkg5aaC5p6c6K6+572u5Li6dHJ1Ze+8jOWImeWQjOatpeWOu+abtOaWsEVudGl0eeS4iuWvueW6lOeahOWtl+aute+8jOm7mOiupOS4unRydWXjgIJcclxuICogcHVibGljIHNldFZhbHVlKHBhdGhzOiBzdHJpbmdbXSwgdmFsdWU6IGFueSwgZW1pdEV2ZW50VG9WaWV3OiBib29sZWFuID0gZmFsc2UsIGVtaXRFdmVudFRvRW50aXR5OiBib29sZWFuID0gdHJ1ZSlcclxuICogYGBgXHJcbiAqIFxyXG4gKiAjIyMg56S65L6LXHJcbiAqIFxyXG4gKiAtIOabtOaWsOS4u+ihqOaVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuc2V0VmFsdWUoWyduYW1lJ10sJ0VTRycpO1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDmm7TmlrDlrZDooajmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLnNldFZhbHVlKFsnc29JdGVtcycsJ3ByaWNlJ10sMjApO1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDmm7TmlrDkuJrliqHlrZfmrrXmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLnNldFZhbHVlKFsndWR0JywndWR0X2ZpZWxkJ10sJ3ZhbHVlJyk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOS7heabtOaWsOeVjOmdouaVsOaNru+8iOS4jeaPkOS6pOWPmOabtOmbhu+8iVxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuc2V0VmFsdWUoWyduYW1lJ10sJ0VTRycsdHJ1ZSxmYWxzZSk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAgID4g5rOo5oSP77yaXHJcbiAqICAgPlxyXG4gKiAgID4g5LuF5pu05paw55WM6Z2i5pWw5o2u5pe2YmluZGluZ0RhdGHlv4XpobvmmK/lr7nlupTnu4Tku7bkuIrkuIvmlofnmoRiaW5kaW5nRGF0YeOAglxyXG4gKiAgID5cclxuICogICA+IOabtOaWsOaVsOaNrueahOWRveS7pOaMgui9veWIsOS4jeWQjOeahOe7hOS7tu+8jOS6p+eUn+eahOaViOaenOS5n+S4jeebuOWQjOOAguWmguaenOWRveS7pOaMguWIsOS6huWNoeeJh+inhuWbvuaooeWei++8jOmCo+S5iOWPr+S7peebtOaOpeWcqOaehOS7tuS4reazqOWFpWBGcmFtZUNvbnRleHRg5oiWYEJpbmRpbmdEYXRhYOW5tuabtOaWsOaVsOaNruWwseWPr+S7peOAguS9huWmguaenOWRveS7pOaMguWIsOS6humdnuWNoeeJh+inhuWbviAqIOaooeWei++8jOWImeW6lOivpeWFiOiOt+WPluWIsOWNoeeJh+S4iuS4i+aWh+eahGJpbmRpbmdEYXRh44CCXHJcbiAqICAgPlxyXG4gKiAgID4gLSDlkb3ku6TmjILlnKjljaHniYfop4blm77mqKHlnos6XHJcbiAqICAgPlxyXG4gKiAgID4gICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgPiAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gKiAgID4gICBmcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuc2V0VmFsdWUoWyduYW1lJ10sJ0VTRycpO1xyXG4gKiAgID4gICBgYGBcclxuICogICA+XHJcbiAqICAgPiAtIOWRveS7pOaMguWcqOmdnuWNoeeJh+inhuWbvuaooeWei++8mlxyXG4gKiAgID5cclxuICogICA+ICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgID4gICBjb25zdCBjYXJkRnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoJ2NhcmQtZnJhbWVJZCcpO1xyXG4gKiAgID4gICBjYXJkRnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnNldFZhbHVlKFsnbmFtZSddLCdFU0cnKTtcclxuICogICA+ICAgYGBgXHJcbiAqIFxyXG4gKiAjIyDojrflj5bnlYzpnaLmlbDmja5cclxuICogXHJcbiAqICMjIyDmjqXlj6PlrprkuYlcclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIC8v6I635Y+WcGF0aHPlr7nlupTnmoTlsZ7mgKflgLxcclxuICogICAvL0BwYXJhbSAgcGF0aHMg5bGe5oCn6Lev5b6E5pWw57uEXHJcbiAqICAgLy9AcmV0dXJucyDlsZ7mgKflgLxcclxuICogICBwdWJsaWMgZ2V0VmFsdWUocGF0aHM6IHN0cmluZ1tdLCB1c2VJbml0VmFsdWUgPSBmYWxzZSlcclxuICogICBgYGBcclxuICogXHJcbiAqICMjIyDnpLrkvotcclxuICogXHJcbiAqIC0g6I635Y+W5Li76KGo5pWw5o2uXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBiaW5kaW5nRGF0YS5nZXRWYWx1ZShbJ25hbWUnXSkgLy8nRVNHJ1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDojrflj5bku47ooajkuK3lrZfmrrXlsZ7mgKdcclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLmdldFZhbHVlKFsnc29JdGVtcycsJ3ByaWNlJ10pOyAvLyAyMFxyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDojrflj5bkuJrliqHlrZfmrrXmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLmdldFZhbHVlKFsndWR0JywndWR0X2ZpZWxkJ10pOyAvLyAndmFsdWUnXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAjIyDojrflj5bmjIflrppCaW5kaW5nT2JqZWN0XHJcbiAqIFxyXG4gKiAjIyMg5o6l5Y+j5a6a5LmJXHJcbiAqIFxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8v6YCa6L+H5Li76ZSu6I635Y+W5a+55bqU55qEYmluZGluZ09iamVjdFxyXG4gKiBiaW5kaW5nRGF0YS5saXN0LmZpbmRCeUlkKGlkOiBzdHJpbmcpOiBCaW5kaW5nT2JqZWN0O1xyXG4gKiBgYGBcclxuICogXHJcbiAqICMjIyDnpLrkvotcclxuICogLSDojrflj5bmn5DkuKrkuLvlrp7kvZNcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEubGlzdC5maW5kQnlJZChcImlkXCIpO1xyXG4gKiAgIGBgYFxyXG4gKiAtIOiOt+WPluafkOS4quWunuS9k+S4i+WtkOihqOeahOaJgOacieaVsOaNrlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICAvLyDojrflj5bkuLvlrp7kvZNcclxuICogICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gYmluZGluZ0RhdGEubGlzdC5maW5kQnlJZChcImlkXCIpIGFzIEJpbmRpbmdPYmplY3Q7XHJcbiAqICAgLy8g6I635Y+W6K+l5a6e5L2T5LiL55qE5p+Q5Liq5a2Q6KGo5pWw5o2uXHJcbiAqICAgY29uc3QgYmluZGluZ0xpc3QgPSBiaW5kaW5nT2JqZWN0LmdldFZhbHVlKFwic29JdGVtc1wiKSBhcyBCaW5kaW5nTGlzdDtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g6I635Y+W5a2Q6KGo5p+Q5LiA6KGM5pWw5o2uXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICAvL+iOt+WPluS4u+WunuS9k1xyXG4gKiAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBiaW5kaW5nRGF0YS5saXN0LmZpbmRCeUlkKFwiaWRcIikgYXMgQmluZGluZ09iamVjdDtcclxuICogICAvL+iOt+WPluivpeWunuS9k+S4i+eahOafkOS4quWtkOihqOaVsOaNrlxyXG4gKiAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gYmluZGluZ09iamVjdC5nZXRWYWx1ZShcInNvSXRlbXNcIikgYXMgQmluZGluZ0xpc3Q7XHJcbiAqICAgLy/lrZDooajooYzmlbDmja5cclxuICogICBjb25zdCBjaGlsZHJlbkJpbmRpbmdPYmplY3QgPSBiaW5kaW5nTGlzdC5maW5kQnlJZCgn5a2Q6KGo5pWw5o2uaWQnKTtcclxuICogICBjb25zdCBuYW1lID0gY2hpbGRyZW5CaW5kaW5nT2JqZWN0LmdldFZhbHVlKFwibmFtZVwiKTsgLy8g5oiW6ICFY2hpbGRyZW5CaW5kaW5nT2JqZWN0WyduYW1lJ11cclxuICogICBgYGBcclxuICogXHJcbiAqICMjIOW4uOingemXrumimFxyXG4gKiBcclxuICogIyMjIOi1i+WAvOaIluWPluWAvOaXtuS4uuS9leS4jeeUqOaMh+WumuS4u+mUru+8n1xyXG4gKiBcclxuICogICAg56S65L6L5Lit5Y+W5YC85oiW6LWL5YC85pe25bm25rKh5pyJ5oyH5a6a5Li76ZSu5YC877yM6L+Z5piv55Sx5LqOQmluZGluZ0RhdGHotYvlgLzmiJblj5blgLzml7bpg73mmK/lr7nlvZPliY3ooYzlsLHooYzmk43kvZznmoTvvIzmiYDku6XkuI3pnIDopoHmjIflrprkuLvplK7jgILmiYDku6XlnKjorqHnrpcm6KGM5YiH5o2i5Zy65pmv5LiL5Lya5a+86Ie05Y+W5YC85oiW6LWL5YC86ZSZ6K+v77yM5aaC5pys5p2l5oOz57uZ56ys5LiA6KGM55qE5p+Q5Liq5a2XICog5q616LWL5YC877yM57uT5p6c55Sx5LqO6KGM5YiH5o2i5a+86Ie05oqK5YC86LWL57uZ5LqG5YW25LuW6KGM44CCXHJcbiAqIFxyXG4gKiAgICDlpoLmnpzpgYfliLDotYvlgLzplJnor6/nmoTmg4XlhrXlj6/ku6XpgJrov4dCaW5kaW5nT2JqZWN06LWL5YC85oiW5Y+W5YC844CCXHJcbiAqIFxyXG4gKiAjIyMg6YCa6L+HYmluZGluZ0RhdGHotYvlgLzkuobvvIznlYzpnaLkuZ/liLfmlrDkuobvvIzkvYbkv53lrZjkuI3kuIpcclxuICogXHJcbiAqICAgIOi/meenjeaDheWGteWkmuWPkeeUn+WcqOacieWQjuerr+ivt+axgueahOaDheWGteS4i++8jOavlOWmgumAmui/h2JpbmRpbmdEYXRh6LWL5YC85ZCO57Sn5o6l552A5pyJ5LiA5Liq5ZCO56uv6K+35rGC44CC55Sx5LqOYmluZGluZ0RhdGHotYvlgLzmmK/lvILmraXnmoTvvIjnm67liY3mmK/vvInvvIzov5nlsLHlj6/og73lr7zoh7TotYvlgLzov5jmsqHmnInnu5PmnZ/vvIjov5jmsqHmnInkuqfnlJ/lj5jmm7TvvInor7fmsYLlsLHlj5HpgIEgKiDkuobvvIzku47ogIzor7fmsYLkuK3msqHmnInlr7nlupTnmoTlj5jmm7TvvIzor7fmsYLlm57mnaXlkI7kvJrpu5jorqTmuIXnqbrmnKzlnLDlj5jmm7TvvIzku47ogIzlr7zoh7TnlYzpnaLkuIrmmL7npLrmlbDmja7lt7Lnu4/kv67mlLnvvIzkvYbmlbDmja7lupPkuK3mlbDmja7lubbmnKrkv67mlLnjgIJcclxuICogXHJcbiAqICAgIOino+WGs+ivpeexu+mXrumimOWPr+S7pemAmui/h+WunuS9k+i1i+WAvOeahOaWueW8j++8jOe7meWunuS9k+i1i+WAvOaYr+WQjOatpeeahO+8jOi1i+WAvOWujOaIkOWQjuWPmOabtOWwseS8muS6p+eUn++8jOi/meagt+WGjeWPkemAgeivt+axguaXtuWwseWPr+S7peaKiuWPmOabtOW4puWIsOWQjuerr+OAglxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBCaW5kaW5nRGF0YSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaVsOaNruexu+Wei+aPj+i/sFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZGF0YVR5cGVJbmZvOiBEYXRhVHlwZUluZm87XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuivpei3r+W+hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBiaW5kaW5nUGF0aDogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDlj6/nu5HlrprnmoTlsZ7mgKfmj4/ov7BcclxuICAgKi9cclxuICBwdWJsaWMgcHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W107XHJcblxyXG4gIC8qKlxyXG4gICAqIOihjOWIh+aNouS6i+S7tuaaguWBnOaKm+WHulxyXG4gICAqL1xyXG4gIHB1YmxpYyByb3dTZWxlY3RlZEV2ZW50U3VzcGVuZDogYm9vbGVhbjtcclxuICAvKipcclxuICAgKiDmlbDmja7liJfooahcclxuICAgKi9cclxuICBwdWJsaWMgbGlzdDogQmluZGluZ0xpc3Q7XHJcbiAgcHJpdmF0ZSBwYWdpbmF0aW9uSW5mbyA9IG51bGw7XHJcblxyXG4gIHB1YmxpYyBzZXQgcGFnaW5nSW5mbyhwYWdpbmdJbmZvOiBhbnkpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBwYWdpbmdJbmZvO1xyXG4gICAgdGhpcy5maXJlUGFnaW5nQ2hhbmdlRXZlbnQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgcGFnaW5nSW5mbygpIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7liIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gc2tpcCDot7Pov4dcclxuICAgKiBAcGFyYW0gdGFrZSDojrflj5ZcclxuICAgKiBAcGFyYW0gYmluZGluZ1BhdGgg6Lev5b6EXHJcbiAgICovXHJcbiAgcHVibGljIHNldFBhZ2luZ0luZm8oc2tpcDogbnVtYmVyLCB0YWtlOiBudW1iZXIsIGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcclxuICAgIGlmIChiaW5kaW5nUGF0aC5sZW5ndGggPCAxIHx8IGJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24odGhpcy5wYWdpbmF0aW9uSW5mbywgeyBwYWdlU2l6ZTogdGFrZSwgcGFnZUluZGV4OiBza2lwIC8gdGFrZSArIDEgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsZXQgcGFnaW5nSW5mbyA9IHRoaXMucGFnaW5hdGlvbkluZm8gfHwge307XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnN1YnN0cigxKS5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLmxlbmd0aCA+IDApOyAvLyAubWFwKGl0ZW0gPT4gaXRlbS5zdWJzdHJpbmcoMCwgaXRlbS5sZW5ndGggLSAxKSk7XHJcbiAgICAgIGxldCBub2RlQ29kZSA9IGJpbmRpbmdQYXRoc1tiaW5kaW5nUGF0aHMubGVuZ3RoIC0gMV07XHJcbiAgICAgIC8vIOWOu3NcclxuICAgICAgbm9kZUNvZGUgPSBub2RlQ29kZS5zdWJzdHIoMCwgbm9kZUNvZGUubGVuZ3RoIC0gMSk7XHJcbiAgICAgIC8vIOaJvuWIsOeItue6p1xyXG4gICAgICAvLyDojrflj5blvZPliY3lrp7kvZPkuIrnuqfnmoTkuLvplK5cclxuICAgICAgY29uc3QgcGF0aHMgPSBiaW5kaW5nUGF0aHMuc2xpY2UoMCwgYmluZGluZ1BhdGhzLmxlbmd0aCAtIDEpO1xyXG4gICAgICBjb25zdCBwYXJlbnRPYmplY3QgPSB0aGlzLmdldFZhbHVlKHBhdGhzKSBhcyBCaW5kaW5nT2JqZWN0O1xyXG4gICAgICBpZiAocGFyZW50T2JqZWN0ICYmIHBhcmVudE9iamVjdFtwYXJlbnRPYmplY3QucHJpbWFyeUtleV0pIHtcclxuICAgICAgICAvLyBjb25zdCBrZXkgPSBgJHtub2RlQ29kZX1fJHtwYXJlbnRPYmplY3RbcGFyZW50T2JqZWN0LnByaW1hcnlLZXldfWA7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gYCR7bm9kZUNvZGV9YDtcclxuICAgICAgICBwYWdpbmdJbmZvID0gcGFnaW5nSW5mb1trZXldIHx8IHt9O1xyXG4gICAgICAgIHBhZ2luZ0luZm8ucGFnZUluZGV4ID0gKChza2lwIC8gdGFrZSkgfHwgMCkgKyAxO1xyXG4gICAgICAgIHBhZ2luZ0luZm8ucGFnZVNpemUgPSB0YWtlIHx8IDA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuZmlyZVBhZ2luZ0NoYW5nZUV2ZW50KCk7XHJcbiAgfVxyXG4gIHB1YmxpYyB1cGRhdGVQYWdpbmdJbmZvKHBhZ2VJbmZvOiB7IHBhZ2VJbmRleD86IG51bWJlciwgcGFnZVNpemU/OiBudW1iZXIsIHRvdGFsPzogbnVtYmVyIH0sIGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcclxuICAgIGlmIChiaW5kaW5nUGF0aC5sZW5ndGggPCAxIHx8IGJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24odGhpcy5wYWdpbmF0aW9uSW5mbywgcGFnZUluZm8pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IHBhZ2luZ0luZm8gPSB0aGlzLnBhZ2luYXRpb25JbmZvIHx8IHt9O1xyXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zdWJzdHIoMSkuc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS5sZW5ndGggPiAwKTsgLy8gLm1hcChpdGVtID0+IGl0ZW0uc3Vic3RyaW5nKDAsIGl0ZW0ubGVuZ3RoIC0gMSkpO1xyXG4gICAgICBsZXQgbm9kZUNvZGUgPSBiaW5kaW5nUGF0aHNbYmluZGluZ1BhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAvLyDljrtzXHJcbiAgICAgIG5vZGVDb2RlID0gbm9kZUNvZGUuc3Vic3RyKDAsIG5vZGVDb2RlLmxlbmd0aCAtIDEpO1xyXG4gICAgICBwYWdpbmdJbmZvW25vZGVDb2RlXSA9IE9iamVjdC5hc3NpZ24ocGFnaW5nSW5mb1tub2RlQ29kZV0sIHBhZ2VJbmZvKTtcclxuICAgIH1cclxuICAgIHRoaXMuZmlyZVBhZ2luZ0NoYW5nZUV2ZW50KCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZmlyZVBhZ2luZ0NoYW5nZUV2ZW50KCkge1xyXG4gICAgdGhpcy5saXN0LmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UsXHJcbiAgICAgIHBhdGg6IHRoaXMuYmluZGluZ1BhdGggJiYgdGhpcy5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApIHx8IFtdLFxyXG4gICAgICB2YWx1ZTogdGhpcy5wYWdpbmF0aW9uSW5mb1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWPmOabtOmbhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgY2hhbmdlcygpOiBTdWJqZWN0PENoYW5nZT4ge1xyXG4gICAgcmV0dXJuIHRoaXMubGlzdC5jaGFuZ2VzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YC85Y+Y5YyW5omn6KGM5Zmo5bel5Y6C77yM5qC55o2u6Lev5b6E5Lqn55Sf5omn6KGM5ZmoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2YWx1ZUNoYW5nZUludm9rZXJGYWN0b3J5OiAocGF0aHM6IHN0cmluZ1tdKSA9PiBJbnZva2VPblZhbHVlQ2hhbmdlO1xyXG5cclxuICAvKipcclxuICAgKiDorr7nva7lgLzlj5jljJbmiafooYzlmajlt6XljoJcclxuICAgKiBAcGFyYW0gdmFsdWUg5YC85Y+Y5YyW5omn6KGM5Zmo5bel5Y6CXHJcbiAgICovXHJcbiAgcHVibGljIHNldFZhbHVlQ2hhbmdlSW52b2tlckZhY3RvcnkodmFsdWU6IChwYXRoczogc3RyaW5nW10pID0+IEludm9rZU9uVmFsdWVDaGFuZ2UpIHtcclxuICAgIHRoaXMudmFsdWVDaGFuZ2VJbnZva2VyRmFjdG9yeSA9IHZhbHVlO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0VmFsdWRDaGFuZ2VJbnZva2VyRmFjdG9yeSgpIHtcclxuICAgIHJldHVybiB0aGlzLnZhbHVlQ2hhbmdlSW52b2tlckZhY3Rvcnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJbvvIjlt7Llup/lvIPvvIlcclxuICAgKi9cclxuICBwdWJsaWMgaW5pdChyZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuaW5pdEJ5UmVwb3NpdG9yeShyZXBvc2l0b3J5LCBiaW5kaW5nUGF0aCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja5SZXBvc2l0b3J55a+5QmluZGluZ0RhdGHov5vooYzliJ3lp4vljJZcclxuICAgKi9cclxuICBwdWJsaWMgaW5pdEJ5UmVwb3NpdG9yeShyZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIGJpbmRpbmdQYXRoOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aDtcclxuXHJcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBQcm9wZXJ0eVV0aWwuZ2V0UHJvcGVydGllcyhyZXBvc2l0b3J5LmVudGl0eVR5cGUpO1xyXG4gICAgdGhpcy5saXN0ID0gQmluZGluZ0xpc3RGYWN0b3J5LmNyZWF0ZSh0aGlzLnByb3BlcnRpZXMpO1xyXG4gICAgLy8g5LuOcmVwb3NpdG9yeeWIneWni+WMlmJpbmRpbmdEYXRhXHJcbiAgICB0aGlzLnBhZ2luZ0luZm8gPSByZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnaW5hdGlvbkluZm87XHJcbiAgICAvLyBAdG9kb1xyXG4gICAgLy8gQmluZGluZ0RhdGHkuI3lupTor6Xnn6XpgZNSZXBvc2l0b3J577yM5Yqg6L295pWw5o2u44CB5bu656uL5YWz6IGU5YWz57O755qE6L+H56iL5bqU6K+l6L2s56e75Yiw5aSW6L65XHJcbiAgICBFbnRpdHlVdGlsLmxvYWRSZXBvc2l0b3J5KHJlcG9zaXRvcnksIHRoaXMubGlzdCk7XHJcbiAgICB0aGlzLmRhdGFUeXBlSW5mbyA9IHJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm87XHJcblxyXG4gICAgdGhpcy5leHRlbmRQcm9wZXJ0aWVzKHRoaXMucHJvcGVydGllcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJZcclxuICAgKi9cclxuICBwdWJsaWMgaW5pdEJ5QmluZGluZ0xpc3QoYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0LCBiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmxpc3QgPSBiaW5kaW5nTGlzdDtcclxuICAgIHRoaXMuYmluZGluZ1BhdGggPSBiaW5kaW5nUGF0aDtcclxuICAgIHRoaXMuZXh0ZW5kUHJvcGVydGllcyh0aGlzLmxpc3QucHJvcGVydGllcyk7XHJcbiAgfVxyXG4gIHB1YmxpYyBzZXREYXRhVHlwZUluZm8oZGF0YVR5cGVJbmZvOiBEYXRhVHlwZUluZm8pIHtcclxuICAgIHRoaXMuZGF0YVR5cGVJbmZvID0gZGF0YVR5cGVJbmZvO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bnlYzpnaLmlbDmja5cclxuICAgKiBAcGFyYW0gcGF0aHMg5bGe5oCn6Lev5b6E5pWw57uEXHJcbiAgICogQHBhcmFtIHVzZUluaXRWYWx1ZSDmmK/lkKbkvb/nlKjpu5jorqTlgLzvvIzpu5jorqTkuLpgZmFsc2VgXHJcbiAgICogQHJldHVybnMg5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHVibGljIGdldFZhbHVlKHBhdGhzOiBzdHJpbmdbXSwgdXNlSW5pdFZhbHVlID0gZmFsc2UpIHtcclxuICAgIGxldCB0YXJnZXQ6IGFueSA9IHRoaXMubGlzdDtcclxuICAgIHBhdGhzLmZvckVhY2goKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0W3BhdGhdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmICh1c2VJbml0VmFsdWUgPT09IHRydWUgJiYgcGF0aHMgJiYgcGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBpbml0VmFsdWUgPSB0aGlzLmdldEluaXRWYWx1ZUJ5UGF0aHMocGF0aHMpO1xyXG4gICAgICBpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQgJiYgdGFyZ2V0ICE9PSBpbml0VmFsdWUpIHtcclxuICAgICAgICB0YXJnZXQgPSBpbml0VmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0YXJnZXQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDor6Xmlrnms5Xlj6/ku6Xmm7TmlrDnu5HlrprlsYLmlbDmja7vvIzku47ogIzovr7liLDmm7TmlrDnlYzpnaLmlbDmja7nmoTnm67nmoTvvIzov5vogIzmm7TmlrDmnKzlnLDku5PlupPlrp7kvZPmlbDmja7vvIzkuqfnlJ/lj5jmm7TvvIzkuIvmrKHor7fmsYLml7bkvJrlsIblj5jmm7TluKbliLDlkI7nq6/lubbmm7TmlrDlkI7nq6/mlbDmja7jgIJcclxuICAgKiBAcGFyYW0gcGF0aHMg5bGe5oCn6Lev5b6E5pWw57uEXHJcbiAgICogQHBhcmFtIHZhbHVlIOWxnuaAp+WAvFxyXG4gICAqIEBwYXJhbSBlbWl0RXZlbnRUb1ZpZXcg5aaC5p6c6K6+572u5Li6dHJ1Ze+8jOWImeWPkemAgeS6i+S7tumAmuefpeiuoumYheWug+eahOe7hOS7tuOAgeaMh+S7pOWOu+abtOaWsOeVjOmdou+8jOm7mOiupOS4umZhbHNl44CCXHJcbiAgICogQHBhcmFtIGVtaXRFdmVudFRvRW50aXR5IOWmguaenOiuvue9ruS4unRydWXvvIzliJnlkIzmraXljrvmm7TmlrBFbnRpdHnkuIrlr7nlupTnmoTlrZfmrrXvvIzpu5jorqTkuLp0cnVl44CCXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICogIyMg56S65L6LXHJcbiAgICogXHJcbiAgICogIyMjIOabtOaWsOeVjOmdouaVsOaNrlxyXG4gICAqIOS9v+eUqOivpeaWueazleaXtuWPquS8oOmAknBhdGjlkox2YWx1ZeWPguaVsO+8jOWFtuS9meWPguaVsOS9v+eUqOm7mOiupOWAvOOAguivpeeUqOazleS8muabtOaWsOeVjOmdouaVsOaNru+8jOWQjOaXtuabtOaWsOWunuS9k+aVsOaNru+8jOWunuS9k+aVsOaNruabtOaWsOaXtuS8muS6p+eUn+WPmOabtO+8jOi/meagt+WcqOS4i+asoeivt+axguaXtuS8muWwhuivpeWPmOabtOW4puWIsOWQjuerr++8jFxyXG4gICAqIOi/m+iAjOabtOaWsOWQjuerr+aVsOaNruOAglxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5zZXRWYWx1ZShwYXRocyx2YWx1ZSk7XHJcbiAgICogYGBgXHJcbiAgICogXHJcbiAgICogIyMjIOS7heabtOaWsOeVjOmdouaVsOaNrlxyXG4gICAqIOacieS6m+WcuuaZr+S4i+aIkeS7rOW4jOacm+WPquabtOaWsOeVjOmdoueahOaVsOaNru+8jOS4jeW4jOacm+WvueWQjuerr+aVsOaNruS6p+eUn+W9seWTje+8jOatpOaXtumZpOS8oOmAknBhdGhz5ZKMdmFsdWXlj4LmlbDlpJbvvIzov5jpnIDopoHlsIZlbWl0RXZlbnRUb1ZpZXforr7kuLp0cnVl77yMZW1pdEV2ZW50VG9FbnRpdHnorr7kuLpmYWxzZe+8jFxyXG4gICAqIOatpOaXtuW/hemhu+S9v+eUqOWvueW6lEJpbmRpbmdEYXRh55qEc2V0VmFsdWXmlrnms5XvvJpcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogY29uc3QgdGFibGVGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZCgnZGF0YS1ncmlkLWNvbXBvbmVudCcpO1xyXG4gICAqIHRhYmxlRnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnNldFZhbHVlKHBhdGhzLHZhbHVlLHRydWUsZmFsc2UpO1xyXG4gICAqIGBgYFxyXG4gICAqICMjIOazqOaEj+S6i+mhuVxyXG4gICAqIHNldFZhbHVl5Li65byC5q2l5pa55rOV77yM5aaC5p6c6LCD55So6K+l5pa55rOV5ZCO6ZqP5Y2z5Y+R6YCB5ZCO56uv6K+35rGC77yM5q2k5pe25a6e5L2T5Y+Y5pu05bCa5pyq5Lqn55Sf77yM5L2G6K+35rGC5bey57uP5Y+R6YCB77yM5Y+Y5pu05peg5rOV5bim5Yiw5ZCO56uv77yM5a+86Ie05Y+Y5pu05Lii5aSx77yM5Ye6546w55WM6Z2i5LiK5pi+56S65pWw5o2u5bey57uP5L+u5pS577yMXHJcbiAgICog5L2G5ZCO56uv5bm25pyq5L+u5pS555qE6Zeu6aKY44CCXHJcbiAgICog5Zug5q2k77yM5aaC5p6c6LWL5YC85ZCO6ZqP5Y2z5Y+R6YCB6K+35rGC5bqU6K+l5L2/55So5a6e5L2T6LWL5YC855qE5pa55rOV44CCXHJcbiAgICovXHJcbiAgcHVibGljIHNldFZhbHVlKHBhdGhzOiBzdHJpbmdbXSwgdmFsdWU6IGFueSwgZW1pdEV2ZW50VG9WaWV3OiBib29sZWFuID0gZmFsc2UsIGVtaXRFdmVudFRvRW50aXR5OiBib29sZWFuID0gdHJ1ZSwgZXJyb3JzOiBhbnkgPSB7fSwgY29udGV4dD86IGFueSkge1xyXG5cclxuICAgIGlmICghcGF0aHMgfHwgcGF0aHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHRocm93IEVycm9yKCfot6/lvoTkuI3og73kuLrnqbonKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBhcmVudFBhdGhzID0gcGF0aHMuc2xpY2UoMCwgcGF0aHMubGVuZ3RoIC0gMSk7XHJcbiAgICBjb25zdCBwcm9wTmFtZSA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDFdO1xyXG5cclxuICAgIGxldCBwYXJlbnQgPSB0aGlzLmdldFZhbHVlKHBhcmVudFBhdGhzKTtcclxuICAgIGlmICghcGFyZW50KSB7XHJcbiAgICAgIHRocm93IEVycm9yKCfmib7kuI3liLDopoHorr7nva7nmoTlr7nosaEnKTtcclxuICAgIH1cclxuICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBCaW5kaW5nRGF0YSkge1xyXG4gICAgICBwYXJlbnQgPSBwYXJlbnQubGlzdC5jdXJyZW50SXRlbTtcclxuICAgIH0gZWxzZSBpZiAocGFyZW50IGluc3RhbmNlb2YgQmluZGluZ0xpc3QpIHtcclxuICAgICAgcGFyZW50ID0gcGFyZW50LmN1cnJlbnRJdGVtO1xyXG4gICAgfVxyXG4gICAgaWYgKCEhdGhpcy52YWx1ZUNoYW5nZUludm9rZXJGYWN0b3J5KSB7XHJcbiAgICAgIHBhcmVudC5zZXRWYWx1ZShwcm9wTmFtZSwgdmFsdWUsIGVtaXRFdmVudFRvVmlldywgZW1pdEV2ZW50VG9FbnRpdHksIGVycm9ycywgdGhpcy52YWx1ZUNoYW5nZUludm9rZXJGYWN0b3J5KHBhdGhzKSwgY29udGV4dCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwYXJlbnQuc2V0VmFsdWUocHJvcE5hbWUsIHZhbHVlLCBlbWl0RXZlbnRUb1ZpZXcsIGVtaXRFdmVudFRvRW50aXR5LCBlcnJvcnMsIG51bGwsIGNvbnRleHQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2ucGF0aHPmuIXnqbrlsZ7mgKflgLxcclxuICAgKi9cclxuICBwdWJsaWMgY2xlYXJWYWx1ZShwYXRoczogc3RyaW5nW10sIGVtaXRFdmVudFRvVmlldzogYm9vbGVhbiA9IGZhbHNlLCBlbWl0RXZlbnRUb0VudGl0eTogYm9vbGVhbiA9IHRydWUsIGNvbnRleHQ/OiBhbnkpIHtcclxuICAgIGxldCBpbml0VmFsdWU6IGFueTtcclxuICAgIGNvbnN0IHByb3BJbmZvID0gdGhpcy5kYXRhVHlwZUluZm8uZ2V0UHJvcEluZm9CeVBhdGgocGF0aHMpO1xyXG4gICAgaWYgKHByb3BJbmZvICYmIHByb3BJbmZvLm1ldGFkYXRhSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm8uaW5pdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgaW5pdFZhbHVlID0gcHJvcEluZm8ubWV0YWRhdGFJbmZvLmluaXRWYWx1ZTtcclxuICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAvLyDljp/mnaXnmoTluK7liqnmmKDlsITkuK3vvIzlvLrooYznuqDmraPkuobmlbDlgLznmoTmg4XlhrXvvIzkv53mjIHkuIDoh7RcclxuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLmdldFZhbHVlKHBhdGhzKTtcclxuICAgICAgaWYgKHR5cGVvZiBvbGRWYWx1ZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICBpbml0VmFsdWUgPSAwO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGluaXRWYWx1ZSA9ICcnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldFZhbHVlKHBhdGhzLCBpbml0VmFsdWUsIGVtaXRFdmVudFRvVmlldywgZW1pdEV2ZW50VG9FbnRpdHksIG51bGwsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5b2T5YmN5YiX6KGoXHJcbiAgICovXHJcbiAgcHVibGljIGdldExpc3QoKSB7XHJcbiAgICBpZiAoIXRoaXMuYmluZGluZ1BhdGggfHwgdGhpcy5iaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLmJpbmRpbmdQYXRoLnN1YnN0cigxKTtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoQXJyYXkgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcigocGFydDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHJldHVybiBwYXJ0ICE9PSAnJztcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoYmluZGluZ1BhdGhBcnJheSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blvZPliY3lr7nosaFcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0T2JqZWN0KCkge1xyXG4gICAgY29uc3QgYmluZGluZ0xpc3QgPSB0aGlzLmdldExpc3QoKTtcclxuICAgIHJldHVybiBiaW5kaW5nTGlzdC5jdXJyZW50SXRlbTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog57uR5a6a6Lev5b6E77yI5LuF6Lev5b6E6YOo5YiG77yM5LiN5YyF5ous5bGe5oCn77yJXHJcbiAgICogQHBhcmFtIGJpbmRpbmdQYXRoIOe7keWumui3r+W+hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQYXRoKGJpbmRpbmdQYXRoPzogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLmZpbHRlcihwID0+IHApO1xyXG4gICAgY29uc3QgcGF0aCA9IFtgJHt0aGlzLmxpc3QucHJpbWFyeUtleX06JHt0aGlzLmxpc3QuY3VycmVudElkfWBdO1xyXG5cclxuICAgIGJpbmRpbmdQYXRocy5mb3JFYWNoKChpdGVtOiBzdHJpbmcpID0+IHtcclxuICAgICAgcGF0aC5wdXNoKGl0ZW0pO1xyXG4gICAgICBjb25zdCBsaXN0ID0gdGhpc1tpdGVtXSBhcyBCaW5kaW5nTGlzdDtcclxuICAgICAgaWYgKGxpc3QpIHtcclxuICAgICAgICBwYXRoLnB1c2goYCR7bGlzdC5wcmltYXJ5S2V5fToke2xpc3QuY3VycmVudElkfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBwYXRoO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmuIXnqbrnu5HlrprmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXQoKSB7XHJcbiAgICB0aGlzLmxpc3QuY2xlYXIoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCa6L+H57uR5a6a6Lev5b6E6I635Y+W5bGe5oCn5Yid5aeL5YC8XHJcbiAgICogQHBhcmFtIHBhdGhzIOe7keWumui3r+W+hFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0SW5pdFZhbHVlQnlQYXRocyhwYXRoczogQXJyYXk8c3RyaW5nPikge1xyXG4gICAgbGV0IGluaXRWYWx1ZTogYW55O1xyXG4gICAgY29uc3QgcHJvcEluZm8gPSB0aGlzLmRhdGFUeXBlSW5mbyAmJiB0aGlzLmRhdGFUeXBlSW5mby5nZXRQcm9wSW5mb0J5UGF0aChwYXRocykgfHwgbnVsbDtcclxuICAgIGlmIChwcm9wSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm8gJiYgcHJvcEluZm8ubWV0YWRhdGFJbmZvLmluaXRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGluaXRWYWx1ZSA9IHByb3BJbmZvLm1ldGFkYXRhSW5mby5pbml0VmFsdWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaW5pdFZhbHVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmianlsZVCaW5kaW5nRGF0YeWxnuaAp++8jOaYoOWwhEJpbmRpbmdEYXRh5omA5oyB5pyJ55qE57uR5a6a5YiX6KGo5b2T5YmN6KGM55qE5bGe5oCn77yM5YeP5bCR57uR5a6a5bGC57qn44CCXHJcbiAgICogQHBhcmFtIHByb3BlcnRpZXMg5YWz6IGU5a6e5L2T55qE5bGe5oCn6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBleHRlbmRQcm9wZXJ0aWVzKHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKSB7XHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goKHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpID0+IHtcclxuICAgICAgY29uc3QgcHJvcE5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcE5hbWUsIHtcclxuICAgICAgICBnZXQ6ICgpID0+IHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmxpc3QuY3VycmVudEl0ZW1bcHJvcE5hbWVdO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5saXN0LmN1cnJlbnRJdGVtW3Byb3BOYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEJpbmRpbmdEYXRhIH07XHJcbiJdfQ==