/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Renderer2, Injector, Input, Output, ViewContainerRef, NgZone } from '@angular/core';
import { EventEmitter } from '@angular/core';
export class InputAppendDirective {
    // private ngControl: NgControl;
    /**
     * @param {?} viewRef
     * @param {?} el
     * @param {?} render
     * @param {?} injector
     */
    constructor(viewRef, el, render, injector) {
        this.viewRef = viewRef;
        this.el = el;
        this.render = render;
        this.injector = injector;
        this._enableAppend = true;
        // 追加到哪个类型下 TextBox、MultiTextBox、 StaticText
        this.inputAppendControlType = "InputGroup";
        // 根据类型不一样，在控件处于禁用、只读时，决定颜色是否可用
        this.inputAppendType = "button";
        // 追加的文本
        this._inputAppendText = '';
        // 模板
        // @Input() inputAppendTmpl: TemplateRef<any>;
        this._disabled = false;
        /*
            * 文本点击事件
            */
        this.inputAppendClickEvent = new EventEmitter();
        // 标记native的外层
        this.elWrapElement = null;
        // 标记元素
        this.appendWrapElement = null;
        // 暂时不用
        this.appendTextElement = null;
        this.clickHandler = null;
        this.disabledCls = 'f-state-disabled';
        this.ngZone = null;
        this.ngZone = this.injector.get(NgZone);
    }
    // 相当于启用禁用此功能
    /**
     * @param {?} value
     * @return {?}
     */
    set enableAppend(value) {
        if (value === '' || value) {
            this._enableAppend = true;
            // 需要
            if (!this.appendWrapElement) {
                this.createStruct();
            }
        }
        else {
            this._enableAppend = false;
            if (this.appendWrapElement) {
                this.resetStruct();
            }
        }
    }
    /**
     * @return {?}
     */
    get enableAppend() {
        return this._enableAppend;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendText(value) {
        if (value != this._inputAppendText) {
            this._inputAppendText = value;
            if (this.appendWrapElement && this._enableAppend) {
                this.render.removeChild(this.appendWrapElement, this.appendTextElement);
                this.appendTextElement.innerHTML = value;
                this.render.appendChild(this.appendWrapElement, this.appendTextElement);
            }
            else {
                this.createStruct();
            }
        }
    }
    /**
     * @return {?}
     */
    get inputAppendText() {
        return this._inputAppendText;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set inputAppendDisabled(value) {
        if (value != this._disabled) {
            this._disabled = value;
            if (this.appendWrapElement) {
                value && this.render.addClass(this.appendWrapElement, this.disabledCls);
                !value && this.render.removeClass(this.appendWrapElement, this.disabledCls);
            }
        }
    }
    /**
     * @return {?}
     */
    get inputAppendDisabled() {
        return this._disabled;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        //this.ngControl = this.injector.get(NgControl, null);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.createStruct();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        //this.resetStruct();
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
        if (this.elWrapElement) {
            this.elWrapElement.remove();
            this.elWrapElement = null;
        }
    }
    /**
     * 重置
     * @private
     * @return {?}
     */
    resetStruct() {
        if (this.clickHandler) {
            this.clickHandler();
            this.clickHandler = null;
        }
        // 分类型移除不同新增加的结构或样式
        switch (this.inputAppendControlType) {
            case 'StaticText':
                this.render.removeClass(this.el.nativeElement, 'f-cmp-static-text-input-append');
                break;
            case 'TextBox':
            case 'MultiTextBox':
                if (this.elWrapElement) {
                    /** @type {?} */
                    let wrapParent = this.render.parentNode(this.elWrapElement);
                    this.render.appendChild(wrapParent, this.el.nativeElement);
                    this.elWrapElement.remove();
                    this.elWrapElement = null;
                }
                break;
        }
        if (this.appendWrapElement) {
            this.appendWrapElement.remove();
            this.appendWrapElement = null;
        }
    }
    /**
     * 创建
     * @private
     * @return {?}
     */
    createStruct() {
        if (!this.inputAppendText || !this.enableAppend || this.appendWrapElement) {
            return;
        }
        /** @type {?} */
        const buttonWrap = this.render.createElement('div');
        buttonWrap.className = 'input-group-append input-append-wrapper';
        buttonWrap.className += ' input-append-' + this.inputAppendType;
        if (this._disabled) {
            buttonWrap.className += ' ' + this.disabledCls;
        }
        /** @type {?} */
        const buttonTextWrap = this.render.createElement('div');
        buttonTextWrap.className = 'input-group-text';
        buttonTextWrap.innerHTML = this.inputAppendText;
        this.appendTextElement = buttonTextWrap;
        this.appendWrapElement = buttonWrap;
        this.render.appendChild(buttonWrap, buttonTextWrap);
        switch (this.inputAppendControlType) {
            case 'StaticText':
                // 此时还没有生成内部的样式
                // let textareaEl = this.el.nativeElement.querySelector('.f-form-control-textarea');
                this.render.addClass(this.el.nativeElement, 'f-cmp-static-text-input-append' + (this._disabled ? ' ' + this.disabledCls : ''));
                this.render.appendChild(this.el.nativeElement, buttonWrap);
                break;
            case 'TextBox':
            case 'MultiTextBox':
                /** @type {?} */
                let textParent = this.render.parentNode(this.el.nativeElement);
                /** @type {?} */
                const inputWrap = this.render.createElement('div');
                inputWrap.className = 'f-cmp-text-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                if (this.el.nativeElement.outerHTML.indexOf('textarea') > -1) {
                    inputWrap.className = 'f-cmp-textarea-input-append' + (this._disabled ? ' ' + this.disabledCls : '');
                }
                this.elWrapElement = inputWrap;
                this.render.appendChild(inputWrap, this.el.nativeElement);
                this.render.appendChild(inputWrap, buttonWrap);
                this.render.appendChild(textParent, inputWrap);
                break;
            default:
                // 存在类似下拉这样的控件，内部调用input-group结构还没有初始化
                /** @type {?} */
                let inputGroupEl = this.el.nativeElement.querySelector('.input-group');
                if (inputGroupEl) {
                    this.render.appendChild(inputGroupEl, buttonWrap);
                }
                else {
                    if (this.ngZone) {
                        this.ngZone.runOutsideAngular((/**
                         * @return {?}
                         */
                        () => {
                            setTimeout((/**
                             * @return {?}
                             */
                            () => {
                                /** @type {?} */
                                let inputGroupEl2 = this.el.nativeElement.querySelector('.input-group');
                                this.render.appendChild(inputGroupEl2, buttonWrap);
                            }));
                        }));
                    }
                }
        }
        if (this.inputAppendType == 'button') {
            this.clickHandler = this.render.listen(this.appendWrapElement, 'click', (/**
             * @param {?} ev
             * @return {?}
             */
            (ev) => {
                this.inputAppendClickEvent.emit(ev);
            }));
        }
    }
}
InputAppendDirective.decorators = [
    { type: Directive, args: [{
                selector: '[input-append]',
            },] }
];
/** @nocollapse */
InputAppendDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: ElementRef },
    { type: Renderer2 },
    { type: Injector }
];
InputAppendDirective.propDecorators = {
    enableAppend: [{ type: Input, args: ['input-append',] }],
    inputAppendControlType: [{ type: Input }],
    inputAppendType: [{ type: Input }],
    inputAppendText: [{ type: Input }],
    inputAppendDisabled: [{ type: Input }],
    inputAppendClickEvent: [{ type: Output }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._enableAppend;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendControlType;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendType;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._inputAppendText;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype._disabled;
    /** @type {?} */
    InputAppendDirective.prototype.inputAppendClickEvent;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.elWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendWrapElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.appendTextElement;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.clickHandler;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.disabledCls;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    InputAppendDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZm9ybXMvIiwic291cmNlcyI6WyJsaWIvaW5wdXQtYXBwZW5kLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxLQUFLLEVBQ0wsTUFBTSxFQUFFLGdCQUFnQixFQUFlLE1BQU0sRUFDcEcsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU03QyxNQUFNLE9BQU8sb0JBQW9COzs7Ozs7OztJQTBFN0IsWUFBb0IsT0FBeUIsRUFBVSxFQUFjLEVBQVUsTUFBaUIsRUFBVSxRQUFrQjtRQUF4RyxZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXpFcEgsa0JBQWEsR0FBRyxJQUFJLENBQUM7O1FBcUJwQiwyQkFBc0IsR0FBRyxZQUFZLENBQUM7O1FBRXRDLG9CQUFlLEdBQUcsUUFBUSxDQUFDOztRQUU1QixxQkFBZ0IsR0FBRyxFQUFFLENBQUM7OztRQW1CdEIsY0FBUyxHQUFHLEtBQUssQ0FBQzs7OztRQWtCaEIsMEJBQXFCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFFN0Msa0JBQWEsR0FBRyxJQUFJLENBQUM7O1FBRXJCLHNCQUFpQixHQUFHLElBQUksQ0FBQzs7UUFFekIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLGdCQUFXLEdBQUcsa0JBQWtCLENBQUM7UUFDakMsV0FBTSxHQUFXLElBQUksQ0FBQztRQUcxQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxD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c0I7Ozs7O0lBQUUsc0NBQXlCOzs7OztJQUFFLHdDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgSW5qZWN0b3IsIE9uSW5pdCwgSW5wdXQsXHJcbiAgICBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgT3V0cHV0LCBWaWV3Q29udGFpbmVyUmVmLCBUZW1wbGF0ZVJlZiwgTmdab25lXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbaW5wdXQtYXBwZW5kXScsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBJbnB1dEFwcGVuZERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAgIHByaXZhdGUgX2VuYWJsZUFwcGVuZCA9IHRydWU7XHJcbiAgICAvLyDnm7jlvZPkuo7lkK/nlKjnpoHnlKjmraTlip/og71cclxuICAgIEBJbnB1dCgnaW5wdXQtYXBwZW5kJylcclxuICAgIHNldCBlbmFibGVBcHBlbmQodmFsdWU6IHN0cmluZyB8IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAodmFsdWUgPT09ICcnIHx8IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2VuYWJsZUFwcGVuZCA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIOmcgOimgVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9lbmFibGVBcHBlbmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRTdHJ1Y3QoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBlbmFibGVBcHBlbmQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZUFwcGVuZDtcclxuICAgIH1cclxuICAgIC8vIOi/veWKoOWIsOWTquS4quexu+Wei+S4iyBUZXh0Qm9444CBTXVsdGlUZXh0Qm9444CBIFN0YXRpY1RleHRcclxuICAgIEBJbnB1dCgpIGlucHV0QXBwZW5kQ29udHJvbFR5cGUgPSBcIklucHV0R3JvdXBcIjtcclxuICAgIC8vIOagueaNruexu+Wei+S4jeS4gOagt++8jOWcqOaOp+S7tuWkhOS6juemgeeUqOOAgeWPquivu+aXtu+8jOWGs+WumuminOiJsuaYr+WQpuWPr+eUqFxyXG4gICAgQElucHV0KCkgaW5wdXRBcHBlbmRUeXBlID0gXCJidXR0b25cIjtcclxuICAgIC8vIOi/veWKoOeahOaWh+acrFxyXG4gICAgcHJpdmF0ZSBfaW5wdXRBcHBlbmRUZXh0ID0gJyc7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kVGV4dCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuX2lucHV0QXBwZW5kVGV4dCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbnB1dEFwcGVuZFRleHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQgJiYgdGhpcy5fZW5hYmxlQXBwZW5kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDaGlsZCh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmFwcGVuZFRleHRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVGV4dEVsZW1lbnQuaW5uZXJIVE1MID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0aGlzLmFwcGVuZFdyYXBFbGVtZW50LCB0aGlzLmFwcGVuZFRleHRFbGVtZW50KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU3RydWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgaW5wdXRBcHBlbmRUZXh0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbnB1dEFwcGVuZFRleHQ7XHJcbiAgICB9XHJcbiAgICAvLyDmqKHmnb9cclxuICAgIC8vIEBJbnB1dCgpIGlucHV0QXBwZW5kVG1wbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIHByaXZhdGUgX2Rpc2FibGVkID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGlucHV0QXBwZW5kRGlzYWJsZWQodmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUgIT0gdGhpcy5fZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlICYmIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQsIHRoaXMuZGlzYWJsZWRDbHMpO1xyXG4gICAgICAgICAgICAgICAgIXZhbHVlICYmIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQsIHRoaXMuZGlzYWJsZWRDbHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IGlucHV0QXBwZW5kRGlzYWJsZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qXHJcbiAgICAqIOaWh+acrOeCueWHu+S6i+S7tlxyXG4gICAgKi9cclxuICAgIEBPdXRwdXQoKSBpbnB1dEFwcGVuZENsaWNrRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvLyDmoIforrBuYXRpdmXnmoTlpJblsYJcclxuICAgIHByaXZhdGUgZWxXcmFwRWxlbWVudCA9IG51bGw7XHJcbiAgICAvLyDmoIforrDlhYPntKBcclxuICAgIHByaXZhdGUgYXBwZW5kV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgLy8g5pqC5pe25LiN55SoXHJcbiAgICBwcml2YXRlIGFwcGVuZFRleHRFbGVtZW50ID0gbnVsbDtcclxuICAgIHByaXZhdGUgY2xpY2tIYW5kbGVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGlzYWJsZWRDbHMgPSAnZi1zdGF0ZS1kaXNhYmxlZCc7XHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lID0gbnVsbDtcclxuICAgIC8vIHByaXZhdGUgbmdDb250cm9sOiBOZ0NvbnRyb2w7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdSZWY6IFZpZXdDb250YWluZXJSZWYsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIC8vdGhpcy5uZ0NvbnRyb2wgPSB0aGlzLmluamVjdG9yLmdldChOZ0NvbnRyb2wsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVTdHJ1Y3QoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICAvL3RoaXMucmVzZXRTdHJ1Y3QoKTtcclxuICAgICAgICBpZiAodGhpcy5jbGlja0hhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hcHBlbmRXcmFwRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5lbFdyYXBFbGVtZW50KXtcclxuICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6YeN572uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcmVzZXRTdHJ1Y3QoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5YiG57G75Z6L56e76Zmk5LiN5ZCM5paw5aKe5Yqg55qE57uT5p6E5oiW5qC35byPXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmlucHV0QXBwZW5kQ29udHJvbFR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnU3RhdGljVGV4dCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWNtcC1zdGF0aWMtdGV4dC1pbnB1dC1hcHBlbmQnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdUZXh0Qm94JzpcclxuICAgICAgICAgICAgY2FzZSAnTXVsdGlUZXh0Qm94JzpcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVsV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgd3JhcFBhcmVudCA9IHRoaXMucmVuZGVyLnBhcmVudE5vZGUodGhpcy5lbFdyYXBFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh3cmFwUGFyZW50LCB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWxXcmFwRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVsV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmFwcGVuZFdyYXBFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu6XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY3JlYXRlU3RydWN0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pbnB1dEFwcGVuZFRleHQgfHwgIXRoaXMuZW5hYmxlQXBwZW5kIHx8IHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBidXR0b25XcmFwID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgYnV0dG9uV3JhcC5jbGFzc05hbWUgPSAnaW5wdXQtZ3JvdXAtYXBwZW5kIGlucHV0LWFwcGVuZC13cmFwcGVyJztcclxuICAgICAgICBidXR0b25XcmFwLmNsYXNzTmFtZSArPSAnIGlucHV0LWFwcGVuZC0nICsgdGhpcy5pbnB1dEFwcGVuZFR5cGU7XHJcbiAgICAgICAgaWYgKHRoaXMuX2Rpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIGJ1dHRvbldyYXAuY2xhc3NOYW1lICs9ICcgJyArIHRoaXMuZGlzYWJsZWRDbHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGJ1dHRvblRleHRXcmFwID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgYnV0dG9uVGV4dFdyYXAuY2xhc3NOYW1lID0gJ2lucHV0LWdyb3VwLXRleHQnO1xyXG4gICAgICAgIGJ1dHRvblRleHRXcmFwLmlubmVySFRNTCA9IHRoaXMuaW5wdXRBcHBlbmRUZXh0O1xyXG4gICAgICAgIHRoaXMuYXBwZW5kVGV4dEVsZW1lbnQgPSBidXR0b25UZXh0V3JhcDtcclxuICAgICAgICB0aGlzLmFwcGVuZFdyYXBFbGVtZW50ID0gYnV0dG9uV3JhcDtcclxuICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChidXR0b25XcmFwLCBidXR0b25UZXh0V3JhcCk7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmlucHV0QXBwZW5kQ29udHJvbFR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnU3RhdGljVGV4dCc6XHJcbiAgICAgICAgICAgICAgICAvLyDmraTml7bov5jmsqHmnInnlJ/miJDlhoXpg6jnmoTmoLflvI9cclxuICAgICAgICAgICAgICAgIC8vIGxldCB0ZXh0YXJlYUVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mLWZvcm0tY29udHJvbC10ZXh0YXJlYScpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZi1jbXAtc3RhdGljLXRleHQtaW5wdXQtYXBwZW5kJysodGhpcy5fZGlzYWJsZWQ/JyAnK3RoaXMuZGlzYWJsZWRDbHM6JycpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgYnV0dG9uV3JhcCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnVGV4dEJveCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ011bHRpVGV4dEJveCc6XHJcbiAgICAgICAgICAgICAgICBsZXQgdGV4dFBhcmVudCA9IHRoaXMucmVuZGVyLnBhcmVudE5vZGUodGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0V3JhcCA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXRXcmFwLmNsYXNzTmFtZSA9ICdmLWNtcC10ZXh0LWlucHV0LWFwcGVuZCcrKHRoaXMuX2Rpc2FibGVkPycgJyt0aGlzLmRpc2FibGVkQ2xzOicnKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQub3V0ZXJIVE1MLmluZGV4T2YoJ3RleHRhcmVhJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0V3JhcC5jbGFzc05hbWUgPSAnZi1jbXAtdGV4dGFyZWEtaW5wdXQtYXBwZW5kJysodGhpcy5fZGlzYWJsZWQ/JyAnK3RoaXMuZGlzYWJsZWRDbHM6JycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbFdyYXBFbGVtZW50ID0gaW5wdXRXcmFwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoaW5wdXRXcmFwLCB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoaW5wdXRXcmFwLCBidXR0b25XcmFwKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHRleHRQYXJlbnQsIGlucHV0V3JhcCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIC8vIOWtmOWcqOexu+S8vOS4i+aLiei/meagt+eahOaOp+S7tu+8jOWGhemDqOiwg+eUqGlucHV0LWdyb3Vw57uT5p6E6L+Y5rKh5pyJ5Yid5aeL5YyWXHJcbiAgICAgICAgICAgICAgICBsZXQgaW5wdXRHcm91cEVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1ncm91cCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0R3JvdXBFbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKGlucHV0R3JvdXBFbCwgYnV0dG9uV3JhcCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm5nWm9uZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5wdXRHcm91cEVsMiA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZ3JvdXAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChpbnB1dEdyb3VwRWwyLCBidXR0b25XcmFwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRBcHBlbmRUeXBlID09ICdidXR0b24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuYXBwZW5kV3JhcEVsZW1lbnQsICdjbGljaycsIChldikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEFwcGVuZENsaWNrRXZlbnQuZW1pdChldik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=