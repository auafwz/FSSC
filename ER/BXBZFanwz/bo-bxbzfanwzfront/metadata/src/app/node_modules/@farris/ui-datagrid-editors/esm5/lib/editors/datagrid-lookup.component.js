/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injector } from '@angular/core';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-14 11:41:00
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-10-14 13:00:48
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Renderer2, ElementRef, ViewChild } from '@angular/core';
import { DatagridBaseEditorDirective } from '../datagrid-base-editor.directive';
import { LookupDefaultOptions } from '../editor-default-options';
import { LookupGridComponent } from '@farris/ui-lookup';
import { RuntimeStateService } from '@farris/ui-common';
var DatagridLookupComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatagridLookupComponent, _super);
    function DatagridLookupComponent(render, el, rts, injector) {
        var _this = _super.call(this, render, el, injector) || this;
        _this.rts = rts;
        _this.stopPropagation = false;
        _this.extInfoFormatter = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (_this.options.extInfoFormatter) {
                return _this.options.extInfoFormatter({ bindingData: _this.dr.rowData, instance: e.instance });
            }
            return '';
        });
        _this.rts.state$.subscribe((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            if (state && state.form && state.form.lookup) {
                _this.pending = state.form.lookup.pending;
                _this.dg.pending = _this.pending;
            }
        }));
        return _this;
    }
    Object.defineProperty(DatagridLookupComponent.prototype, "controlId", {
        set: /**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            this.instance.controlId = id;
            if (this.instance.uri) {
                this.instance.controlId += '_' + this.instance.uri;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.ngOnInit.call(this);
        this.options = Object.assign({}, LookupDefaultOptions, this.options);
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
        this.inputElement = this.instance.inputGroup.textbox.nativeElement;
        _super.prototype.ngAfterViewInit.call(this);
        if (this.options.loader) {
            this.instance['http'] = { getData: this.options.loader };
        }
        this.instance['host'] = this.dg;
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogClosed = /**
     * @return {?}
     */
    function () {
        // this.lookup.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onDialogOpen = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @return {?}
     */
    DatagridLookupComponent.prototype.onLoadSuccess = /**
     * @return {?}
     */
    function () {
        this.instance.changeDetector.detectChanges();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridLookupComponent.prototype.onClear = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // const rowData = this.instance.selectionMgr.getBindingData();
        // this.instance['defaultMapping'].lookupFieldMap(null, this.instance.mapFields, rowData);
        this.instance.changeDetector.detectChanges();
        if (this.options.clear) {
            this.options.clear();
        }
    };
    DatagridLookupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'grid-editor-lookup',
                    template: "\n    <div [formGroup]=\"group\" class=\"f-datagrid-cell-formgroup farris-group-auto\">\n        <datagrid-tooltip [control]=\"formControl\" [tooltipPosition]=\"'top-left'\" [message]=\"errorMessage\">\n            <farris-lookup-grid #lookup style=\"width: 100%\"\n                id=\"{{ controlId }}\"\n                [formControlName]=\"column.field\"\n                [uri]=\"options.uri\"\n                [helpId]=\"options.helpId\"\n                [displayType]=\"options.displayType\"\n                [singleSelect]=\"options.singleSelect\"\n                [idField]=\"options.idField\"\n                [pageSize]=\"options.pageSize || 20\"\n                [pageIndex]=\"options.pageSize || 1\"\n                [pagination]=\"options.pageination\"\n                [textField]=\"options.textField\"\n                [valueField]=\"options.valueField\"\n                [title]=\"options.title\"\n                [useFavorite]=\"options.useFavorite\"\n                [isRecordSize]=\"options.isRecordSize\"\n                [useTip]=\"options.useTip\"\n                [editable]=\"options.editable\"\n                [readonly]=\"options.readonly\"\n                [dialogWidth]=\"options.dialogWidth\"\n                [dialogHeight]=\"options.dialogHeight\"\n                [showMaxButton]=\"options.showMaxButton\"\n                [showCloseButton]=\"options.showCloseButton\"\n                [resizable]=\"options.resizable\"\n                [buttonAlign]=\"options.buttonAlign\"\n                [enableClear]=\"options.enableClear\"\n                [searchOnServer]=\"options.searchOnServer\"\n                [nosearch]=\"options.nosearch\"\n                [maxLength]=\"options.maxLength\"\n                [mappingFn]=\"options.mappingFn\"\n                [mapFields]=\"options.mapFields\"\n                [context]=\"options.context\"\n                [expandLevel]=\"options.expandLevel\"\n                [dictPicking]=\"options.dictPicking\"\n                [dictPicked]=\"options.dictPicked\"\n                [enableFullTree]=\"options.enableFullTree\"\n                [loadTreeDataType]=\"options.loadTreeDataType\"\n                [enableCascade]=\"options.enableCascade\"\n                [cascadeStatus]=\"options.cascadeStatus\"\n                [useExtendInfo]=\"options.useExtendInfo\"\n                [extInfoFields]=\"options.extInfoFields\"\n                [extInfoFormatter]=\"options.extInfoFormatter\"\n                [textAlign]=\"options.textAlign\"\n                [loadDataWhenOpen]=\"options.loadDataWhenOpen\"\n                [selectFirstInNav]=\"options.selectFirstInNav\"\n                [customNavFormatter]=\"options.customNavFormatter\"\n                [customFormatter]=\"options.customFormatter\"\n                [treeInfo]=\"options?.treeInfo\"\n                (dialogClosed)=\"onDialogClosed()\"\n                (dialogOpened)=\"onDialogOpen()\"\n                (clear)=\"onClear($event)\"\n                (loadSuccess)=\"onLoadSuccess()\"\n            ></farris-lookup-grid>\n        </datagrid-tooltip>\n    </div>\n    "
                }] }
    ];
    /** @nocollapse */
    DatagridLookupComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: RuntimeStateService },
        { type: Injector }
    ]; };
    DatagridLookupComponent.propDecorators = {
        instance: [{ type: ViewChild, args: ['lookup',] }]
    };
    return DatagridLookupComponent;
}(DatagridBaseEditorDirective));
export { DatagridLookupComponent };
if (false) {
    /** @type {?} */
    DatagridLookupComponent.prototype.instance;
    /** @type {?} */
    DatagridLookupComponent.prototype.stopPropagation;
    /** @type {?} */
    DatagridLookupComponent.prototype.extInfoFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridLookupComponent.prototype.rts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtbG9va3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycy8iLCJzb3VyY2VzIjpbImxpYi9lZGl0b3JzL2RhdGFncmlkLWxvb2t1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQXFELFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7O0FBUzVGLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDaEYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQ7SUE4RDZDLG1EQUEyQjtJQVlwRSxpQ0FBWSxNQUFpQixFQUFFLEVBQWMsRUFBVSxHQUF3QixFQUNuRSxRQUFrQjtRQUQ5QixZQUVJLGtCQUFNLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxDQUFDLFNBTzlCO1FBVHNELFNBQUcsR0FBSCxHQUFHLENBQXFCO1FBRC9FLHFCQUFlLEdBQUcsS0FBSyxDQUFDO1FBbUR4QixzQkFBZ0I7Ozs7UUFBRyxVQUFDLENBQUM7WUFDakIsSUFBSSxLQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFO2dCQUMvQixPQUFPLEtBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxXQUFXLEVBQUUsS0FBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO2FBQ2hHO1lBRUQsT0FBTyxFQUFFLENBQUM7UUFDZCxDQUFDLEVBQUE7UUFyREcsS0FBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsS0FBSztZQUMzQixJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUMxQyxLQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztnQkFDekMsS0FBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQzthQUNsQztRQUNMLENBQUMsRUFBQyxDQUFDOztJQUNQLENBQUM7SUFqQkQsc0JBQUksOENBQVM7Ozs7O1FBQWIsVUFBYyxFQUFFO1lBQ1osSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQzdCLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUU7Z0JBQ25CLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxJQUFJLEdBQUcsR0FBRSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQzthQUNyRDtRQUNMLENBQUM7OztPQUFBOzs7O0lBY0QsMENBQVE7OztJQUFSO1FBQ0ksaUJBQU0sUUFBUSxXQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFFLEVBQUUsRUFBRyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0UsQ0FBQzs7OztJQUVELGlEQUFlOzs7SUFBZjtRQUNJLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzdDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztRQUNuRSxpQkFBTSxlQUFlLFdBQUUsQ0FBQztRQUV4QixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUM3RDtRQUVELElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNwQyxDQUFDOzs7O0lBRUQsZ0RBQWM7OztJQUFkO1FBQ0ksOENBQThDO0lBQ2xELENBQUM7Ozs7SUFFRCw4Q0FBWTs7O0lBQVo7UUFDSSxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNqRCxDQUFDOzs7O0lBRUQsK0NBQWE7OztJQUFiO1FBQ0ksSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDakQsQ0FBQzs7Ozs7SUFFRCx5Q0FBTzs7OztJQUFQLFVBQVEsS0FBaUI7UUFDckIsK0RBQStEO1FBQy9ELDBGQUEwRjtRQUUxRixJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUM3QyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDeEI7SUFDTCxDQUFDOztnQkExSEosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxvQkFBb0I7b0JBQzlCLFFBQVEsRUFBRSxvaUdBMERUO2lCQUNKOzs7O2dCQWxFMkIsU0FBUztnQkFBRSxVQUFVO2dCQUl4QyxtQkFBbUI7Z0JBYmdDLFFBQVE7OzsyQkE2RS9ELFNBQVMsU0FBQyxRQUFROztJQW9FdkIsOEJBQUM7Q0FBQSxBQW5JRCxDQThENkMsMkJBQTJCLEdBcUV2RTtTQXJFWSx1QkFBdUI7OztJQUNoQywyQ0FBbUQ7O0lBVW5ELGtEQUF3Qjs7SUFtRHhCLG1EQU1DOzs7OztJQXhEOEMsc0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQXBwbGljYXRpb25SZWYsIEluamVjdCwgZm9yd2FyZFJlZiwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0xNCAxMTo0MTowMFxyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMC0xNCAxMzowMDo0OFxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQmFzZUVkaXRvckRpcmVjdGl2ZSB9IGZyb20gJy4uL2RhdGFncmlkLWJhc2UtZWRpdG9yLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IExvb2t1cERlZmF1bHRPcHRpb25zIH0gZnJvbSAnLi4vZWRpdG9yLWRlZmF1bHQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IFJ1bnRpbWVTdGF0ZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdncmlkLWVkaXRvci1sb29rdXAnLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgIDxkaXYgW2Zvcm1Hcm91cF09XCJncm91cFwiIGNsYXNzPVwiZi1kYXRhZ3JpZC1jZWxsLWZvcm1ncm91cCBmYXJyaXMtZ3JvdXAtYXV0b1wiPlxyXG4gICAgICAgIDxkYXRhZ3JpZC10b29sdGlwIFtjb250cm9sXT1cImZvcm1Db250cm9sXCIgW3Rvb2x0aXBQb3NpdGlvbl09XCIndG9wLWxlZnQnXCIgW21lc3NhZ2VdPVwiZXJyb3JNZXNzYWdlXCI+XHJcbiAgICAgICAgICAgIDxmYXJyaXMtbG9va3VwLWdyaWQgI2xvb2t1cCBzdHlsZT1cIndpZHRoOiAxMDAlXCJcclxuICAgICAgICAgICAgICAgIGlkPVwie3sgY29udHJvbElkIH19XCJcclxuICAgICAgICAgICAgICAgIFtmb3JtQ29udHJvbE5hbWVdPVwiY29sdW1uLmZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFt1cmldPVwib3B0aW9ucy51cmlcIlxyXG4gICAgICAgICAgICAgICAgW2hlbHBJZF09XCJvcHRpb25zLmhlbHBJZFwiXHJcbiAgICAgICAgICAgICAgICBbZGlzcGxheVR5cGVdPVwib3B0aW9ucy5kaXNwbGF5VHlwZVwiXHJcbiAgICAgICAgICAgICAgICBbc2luZ2xlU2VsZWN0XT1cIm9wdGlvbnMuc2luZ2xlU2VsZWN0XCJcclxuICAgICAgICAgICAgICAgIFtpZEZpZWxkXT1cIm9wdGlvbnMuaWRGaWVsZFwiXHJcbiAgICAgICAgICAgICAgICBbcGFnZVNpemVdPVwib3B0aW9ucy5wYWdlU2l6ZSB8fCAyMFwiXHJcbiAgICAgICAgICAgICAgICBbcGFnZUluZGV4XT1cIm9wdGlvbnMucGFnZVNpemUgfHwgMVwiXHJcbiAgICAgICAgICAgICAgICBbcGFnaW5hdGlvbl09XCJvcHRpb25zLnBhZ2VpbmF0aW9uXCJcclxuICAgICAgICAgICAgICAgIFt0ZXh0RmllbGRdPVwib3B0aW9ucy50ZXh0RmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3ZhbHVlRmllbGRdPVwib3B0aW9ucy52YWx1ZUZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFt0aXRsZV09XCJvcHRpb25zLnRpdGxlXCJcclxuICAgICAgICAgICAgICAgIFt1c2VGYXZvcml0ZV09XCJvcHRpb25zLnVzZUZhdm9yaXRlXCJcclxuICAgICAgICAgICAgICAgIFtpc1JlY29yZFNpemVdPVwib3B0aW9ucy5pc1JlY29yZFNpemVcIlxyXG4gICAgICAgICAgICAgICAgW3VzZVRpcF09XCJvcHRpb25zLnVzZVRpcFwiXHJcbiAgICAgICAgICAgICAgICBbZWRpdGFibGVdPVwib3B0aW9ucy5lZGl0YWJsZVwiXHJcbiAgICAgICAgICAgICAgICBbcmVhZG9ubHldPVwib3B0aW9ucy5yZWFkb25seVwiXHJcbiAgICAgICAgICAgICAgICBbZGlhbG9nV2lkdGhdPVwib3B0aW9ucy5kaWFsb2dXaWR0aFwiXHJcbiAgICAgICAgICAgICAgICBbZGlhbG9nSGVpZ2h0XT1cIm9wdGlvbnMuZGlhbG9nSGVpZ2h0XCJcclxuICAgICAgICAgICAgICAgIFtzaG93TWF4QnV0dG9uXT1cIm9wdGlvbnMuc2hvd01heEJ1dHRvblwiXHJcbiAgICAgICAgICAgICAgICBbc2hvd0Nsb3NlQnV0dG9uXT1cIm9wdGlvbnMuc2hvd0Nsb3NlQnV0dG9uXCJcclxuICAgICAgICAgICAgICAgIFtyZXNpemFibGVdPVwib3B0aW9ucy5yZXNpemFibGVcIlxyXG4gICAgICAgICAgICAgICAgW2J1dHRvbkFsaWduXT1cIm9wdGlvbnMuYnV0dG9uQWxpZ25cIlxyXG4gICAgICAgICAgICAgICAgW2VuYWJsZUNsZWFyXT1cIm9wdGlvbnMuZW5hYmxlQ2xlYXJcIlxyXG4gICAgICAgICAgICAgICAgW3NlYXJjaE9uU2VydmVyXT1cIm9wdGlvbnMuc2VhcmNoT25TZXJ2ZXJcIlxyXG4gICAgICAgICAgICAgICAgW25vc2VhcmNoXT1cIm9wdGlvbnMubm9zZWFyY2hcIlxyXG4gICAgICAgICAgICAgICAgW21heExlbmd0aF09XCJvcHRpb25zLm1heExlbmd0aFwiXHJcbiAgICAgICAgICAgICAgICBbbWFwcGluZ0ZuXT1cIm9wdGlvbnMubWFwcGluZ0ZuXCJcclxuICAgICAgICAgICAgICAgIFttYXBGaWVsZHNdPVwib3B0aW9ucy5tYXBGaWVsZHNcIlxyXG4gICAgICAgICAgICAgICAgW2NvbnRleHRdPVwib3B0aW9ucy5jb250ZXh0XCJcclxuICAgICAgICAgICAgICAgIFtleHBhbmRMZXZlbF09XCJvcHRpb25zLmV4cGFuZExldmVsXCJcclxuICAgICAgICAgICAgICAgIFtkaWN0UGlja2luZ109XCJvcHRpb25zLmRpY3RQaWNraW5nXCJcclxuICAgICAgICAgICAgICAgIFtkaWN0UGlja2VkXT1cIm9wdGlvbnMuZGljdFBpY2tlZFwiXHJcbiAgICAgICAgICAgICAgICBbZW5hYmxlRnVsbFRyZWVdPVwib3B0aW9ucy5lbmFibGVGdWxsVHJlZVwiXHJcbiAgICAgICAgICAgICAgICBbbG9hZFRyZWVEYXRhVHlwZV09XCJvcHRpb25zLmxvYWRUcmVlRGF0YVR5cGVcIlxyXG4gICAgICAgICAgICAgICAgW2VuYWJsZUNhc2NhZGVdPVwib3B0aW9ucy5lbmFibGVDYXNjYWRlXCJcclxuICAgICAgICAgICAgICAgIFtjYXNjYWRlU3RhdHVzXT1cIm9wdGlvbnMuY2FzY2FkZVN0YXR1c1wiXHJcbiAgICAgICAgICAgICAgICBbdXNlRXh0ZW5kSW5mb109XCJvcHRpb25zLnVzZUV4dGVuZEluZm9cIlxyXG4gICAgICAgICAgICAgICAgW2V4dEluZm9GaWVsZHNdPVwib3B0aW9ucy5leHRJbmZvRmllbGRzXCJcclxuICAgICAgICAgICAgICAgIFtleHRJbmZvRm9ybWF0dGVyXT1cIm9wdGlvbnMuZXh0SW5mb0Zvcm1hdHRlclwiXHJcbiAgICAgICAgICAgICAgICBbdGV4dEFsaWduXT1cIm9wdGlvbnMudGV4dEFsaWduXCJcclxuICAgICAgICAgICAgICAgIFtsb2FkRGF0YVdoZW5PcGVuXT1cIm9wdGlvbnMubG9hZERhdGFXaGVuT3BlblwiXHJcbiAgICAgICAgICAgICAgICBbc2VsZWN0Rmlyc3RJbk5hdl09XCJvcHRpb25zLnNlbGVjdEZpcnN0SW5OYXZcIlxyXG4gICAgICAgICAgICAgICAgW2N1c3RvbU5hdkZvcm1hdHRlcl09XCJvcHRpb25zLmN1c3RvbU5hdkZvcm1hdHRlclwiXHJcbiAgICAgICAgICAgICAgICBbY3VzdG9tRm9ybWF0dGVyXT1cIm9wdGlvbnMuY3VzdG9tRm9ybWF0dGVyXCJcclxuICAgICAgICAgICAgICAgIFt0cmVlSW5mb109XCJvcHRpb25zPy50cmVlSW5mb1wiXHJcbiAgICAgICAgICAgICAgICAoZGlhbG9nQ2xvc2VkKT1cIm9uRGlhbG9nQ2xvc2VkKClcIlxyXG4gICAgICAgICAgICAgICAgKGRpYWxvZ09wZW5lZCk9XCJvbkRpYWxvZ09wZW4oKVwiXHJcbiAgICAgICAgICAgICAgICAoY2xlYXIpPVwib25DbGVhcigkZXZlbnQpXCJcclxuICAgICAgICAgICAgICAgIChsb2FkU3VjY2Vzcyk9XCJvbkxvYWRTdWNjZXNzKClcIlxyXG4gICAgICAgICAgICA+PC9mYXJyaXMtbG9va3VwLWdyaWQ+XHJcbiAgICAgICAgPC9kYXRhZ3JpZC10b29sdGlwPlxyXG4gICAgPC9kaXY+XHJcbiAgICBgLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRMb29rdXBDb21wb25lbnQgZXh0ZW5kcyBEYXRhZ3JpZEJhc2VFZGl0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG4gICAgQFZpZXdDaGlsZCgnbG9va3VwJykgaW5zdGFuY2U6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcblxyXG5cclxuICAgIHNldCBjb250cm9sSWQoaWQpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNvbnRyb2xJZCA9IGlkO1xyXG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlLnVyaSkge1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLmNvbnRyb2xJZCArPSAnXycrIHRoaXMuaW5zdGFuY2UudXJpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdG9wUHJvcGFnYXRpb24gPSBmYWxzZTtcclxuICAgIGNvbnN0cnVjdG9yKHJlbmRlcjogUmVuZGVyZXIyLCBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBydHM6IFJ1bnRpbWVTdGF0ZVNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICBzdXBlcihyZW5kZXIsIGVsLCBpbmplY3Rvcik7XHJcbiAgICAgICAgdGhpcy5ydHMuc3RhdGUkLnN1YnNjcmliZShzdGF0ZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5mb3JtICYmIHN0YXRlLmZvcm0ubG9va3VwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmcgPSBzdGF0ZS5mb3JtLmxvb2t1cC5wZW5kaW5nO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5wZW5kaW5nID0gdGhpcy5wZW5kaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKCB7fSAsIExvb2t1cERlZmF1bHRPcHRpb25zLCB0aGlzLm9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB0aGlzLmlucHV0RWxlbWVudCA9IHRoaXMuaW5zdGFuY2UuaW5wdXRHcm91cC50ZXh0Ym94Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9hZGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VbJ2h0dHAnXSA9ICB7IGdldERhdGE6IHRoaXMub3B0aW9ucy5sb2FkZXIgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VbJ2hvc3QnXSA9IHRoaXMuZGc7XHJcbiAgICB9XHJcblxyXG4gICAgb25EaWFsb2dDbG9zZWQoKSB7XHJcbiAgICAgICAgLy8gdGhpcy5sb29rdXAuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRGlhbG9nT3BlbigpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkxvYWRTdWNjZXNzKCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAvLyBjb25zdCByb3dEYXRhID0gdGhpcy5pbnN0YW5jZS5zZWxlY3Rpb25NZ3IuZ2V0QmluZGluZ0RhdGEoKTtcclxuICAgICAgICAvLyB0aGlzLmluc3RhbmNlWydkZWZhdWx0TWFwcGluZyddLmxvb2t1cEZpZWxkTWFwKG51bGwsIHRoaXMuaW5zdGFuY2UubWFwRmllbGRzLCByb3dEYXRhKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jbGVhcikge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuY2xlYXIoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXh0SW5mb0Zvcm1hdHRlciA9IChlKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5leHRJbmZvRm9ybWF0dGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZXh0SW5mb0Zvcm1hdHRlcih7IGJpbmRpbmdEYXRhOiB0aGlzLmRyLnJvd0RhdGEsIGluc3RhbmNlOiBlLmluc3RhbmNlIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==