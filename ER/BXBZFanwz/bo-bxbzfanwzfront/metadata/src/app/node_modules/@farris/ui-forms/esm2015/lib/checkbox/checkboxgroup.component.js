/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Optional, Injector } from '@angular/core';
/*
 * @Author: 胡玉洋(Yuyang)
 * @Date: 2019-08-29
 * @LastEditors:  胡玉洋(Yuyang)
 * @LastEditTime: 2019-08-29
 * @QQ: 664927877
 * @Version: v0.0.8
 */
import { Component, Input, forwardRef, Output, EventEmitter } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { IdService, CommonUtils } from '@farris/ui-common';
export class FarrisCheckboxGroupComponent {
    /**
     * @param {?} idSer
     * @param {?} inject
     */
    constructor(idSer, inject) {
        this.idSer = idSer;
        this.inject = inject;
        /* radio 数组 */
        this.data = [];
        /* 分隔符 默认逗号*/
        this.separator = ',';
        /* 值类型是否是string */
        this.isStringValue = true;
        this.textField = 'name';
        this.valueField = 'value';
        this.changeValue = new EventEmitter();
        /* checkbox赋值事件 */
        this.setCheckboxData = new EventEmitter();
        this.controlChange = (/**
         * @return {?}
         */
        () => { });
        this.controlTouch = (/**
         * @return {?}
         */
        () => { });
        if (this.inject) {
            this.commonUtils = this.inject.get(CommonUtils);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // 初始化name
        this.name = this.idSer.generate().replace(/-/g, '_');
        this.setCheckboxData.emit(this);
        // todo 取值可以实现promise
        if (this.loadData) {
            this.loadDataSubscription = this.loadData().subscribe((/**
             * @param {?} res
             * @return {?}
             */
            res => this.data = res.data));
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.loadDataSubscription) {
            this.loadDataSubscription.unsubscribe();
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    _getText(item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.textField, item);
            }
            else {
                return item[this.textField];
            }
        }
        else {
            return '';
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    _getValue(item) {
        if (item) {
            if (this.commonUtils && this.commonUtils.getValue) {
                return this.commonUtils.getValue(this.valueField, item);
            }
            else {
                return item[this.valueField];
            }
        }
        else {
            return '';
        }
    }
    /* 选中input值 */
    /**
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    clickHandler(item, index) {
        /** @type {?} */
        let arrValue = this.transformToArr(this.value) || [];
        /** @type {?} */
        const val = String(this._getValue(item));
        if (!arrValue || !arrValue.length) {
            arrValue.push(val);
        }
        else {
            if (arrValue.some((/**
             * @param {?} item
             * @return {?}
             */
            item => item == val))) {
                arrValue = arrValue.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n !== val));
            }
            else {
                arrValue.push(val);
            }
        }
        // 更新value值
        this.value = this.transformToStr(arrValue);
        // 传值formcontrol
        this.controlChange(this.value);
        this.controlTouch(this.value);
        this.changeValue.emit(this.value);
    }
    /* 被选中 */
    /**
     * @param {?} item
     * @return {?}
     */
    checked(item) {
        /** @type {?} */
        const val = String(this._getValue(item));
        /** @type {?} */
        const checkedValue = this.transformToArr(this.value);
        // 多值
        return checkedValue.some((/**
         * @param {?} item
         * @return {?}
         */
        item => item == val));
    }
    /* 值到数组值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    transformToArr(value) {
        if (!value) {
            return [];
        }
        if (!this.isStringValue) {
            return value;
        }
        return value.split(this.separator);
    }
    /* 值到字符串值的转换 */
    /**
     * @param {?} value
     * @return {?}
     */
    transformToStr(value) {
        /** @type {?} */
        const allVals = this.data.map((/**
         * @param {?} n
         * @return {?}
         */
        n => this._getValue(n)));
        /** @type {?} */
        const r = [];
        allVals.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (value.some((/**
             * @param {?} item
             * @return {?}
             */
            item => item == n))) {
                r.push(n);
            }
        }));
        if (!this.isStringValue) {
            return r;
        }
        return r.join(this.separator);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        this.value = value;
    }
    /* change操作值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.controlChange = fn;
    }
    /* blur值变化  方法重写*/
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.controlTouch = fn;
    }
}
FarrisCheckboxGroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-checkboxgroup',
                template: "<div class=\"farris-input-wrap\" [class.farris-checkradio-hor]=\"horizontal\">\r\n    <div\r\n        class=\"custom-control custom-checkbox\"\r\n        *ngFor=\"let item of data; let i = index\"\r\n    >\r\n        <input\r\n            #input\r\n            class=\"custom-control-input\"\r\n            [name]=\"name\"\r\n            id=\"{{ 'checkbox_' + name + i }}\"\r\n            type=\"checkbox\"\r\n            [value]=\"_getValue(item)\"\r\n            (click)=\"clickHandler(item, i)\"\r\n            [checked]=\"checked(item)\"\r\n            [disabled]=\"disable\"\r\n            tabindex=\"{{ tabIndex }}\"\r\n        />\r\n        <label\r\n            class=\"custom-control-label\"\r\n            for=\"{{ 'checkbox_' + name + i }}\"\r\n            title=\"{{_getText(item)}}\"\r\n            >{{ _getText(item) }}</label\r\n        >\r\n    </div>\r\n</div>\r\n",
                providers: [{
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => FarrisCheckboxGroupComponent)),
                        multi: true,
                    }],
                exportAs: 'FarrisCheckboxGroupComponent'
            }] }
];
/** @nocollapse */
FarrisCheckboxGroupComponent.ctorParameters = () => [
    { type: IdService },
    { type: Injector, decorators: [{ type: Optional }] }
];
FarrisCheckboxGroupComponent.propDecorators = {
    tabIndex: [{ type: Input, args: ['tab-index',] }],
    data: [{ type: Input }],
    type: [{ type: Input }],
    name: [{ type: Input }],
    horizontal: [{ type: Input }],
    separator: [{ type: Input }],
    disable: [{ type: Input }],
    value: [{ type: Input }],
    isStringValue: [{ type: Input }],
    textField: [{ type: Input }],
    valueField: [{ type: Input }],
    loadData: [{ type: Input }],
    changeValue: [{ type: Output }],
    setCheckboxData: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.tabIndex;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.data;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.type;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.name;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.horizontal;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.separator;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.disable;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.value;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.isStringValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.textField;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.valueField;
    /**
     * 加载数据事件
     * @type {?}
     */
    FarrisCheckboxGroupComponent.prototype.loadData;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.loadDataSubscription;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.changeValue;
    /** @type {?} */
    FarrisCheckboxGroupComponent.prototype.setCheckboxData;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlChange;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.controlTouch;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.idSer;
    /**
     * @type {?}
     * @private
     */
    FarrisCheckboxGroupComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3hncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWZvcm1zLyIsInNvdXJjZXMiOlsibGliL2NoZWNrYm94L2NoZWNrYm94Z3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQXVDLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVN4RixPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRixPQUFPLEVBQUUsaUJBQWlCLEVBQXdCLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQWMzRCxNQUFNLE9BQU8sNEJBQTRCOzs7OztJQTBDckMsWUFBb0IsS0FBZ0IsRUFBc0IsTUFBZ0I7UUFBdEQsVUFBSyxHQUFMLEtBQUssQ0FBVztRQUFzQixXQUFNLEdBQU4sTUFBTSxDQUFVOztRQXJDakUsU0FBSSxHQUFVLEVBQUUsQ0FBQzs7UUFZakIsY0FBUyxHQUFHLEdBQUcsQ0FBQzs7UUFTaEIsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFFckIsY0FBUyxHQUFHLE1BQU0sQ0FBQztRQUNuQixlQUFVLEdBQUcsT0FBTyxDQUFDO1FBTXBCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7UUFHdEMsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBa0k1QyxrQkFBYTs7O1FBQXlCLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBQztRQUNoRCxpQkFBWTs7O1FBQXlCLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBQztRQTlIbkQsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcs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RDs7SUFDMUQsNERBQW1DOztJQUVuQyxtREFBZ0Q7O0lBR2hELHVEQUFvRDs7Ozs7SUFFcEQsbURBQWlDOzs7OztJQWdJakMscURBQXdEOzs7OztJQUN4RCxvREFBdUQ7Ozs7O0lBL0gzQyw2Q0FBd0I7Ozs7O0lBQUUsOENBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT25EZXN0cm95LCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMsIE9wdGlvbmFsLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG4vKlxyXG4gKiBAQXV0aG9yOiDog6HnjonmtIsoWXV5YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0yOVxyXG4gKiBATGFzdEVkaXRvcnM6ICDog6HnjonmtIsoWXV5YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTA4LTI5XHJcbiAqIEBRUTogNjY0OTI3ODc3XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjhcclxuICovXHJcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIGZvcndhcmRSZWYsIE9uSW5pdCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBJZFNlcnZpY2UsIENvbW1vblV0aWxzIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmYXJyaXMtY2hlY2tib3hncm91cCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY2hlY2tib3hncm91cC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBwcm92aWRlcnM6IFt7XHJcbiAgICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gRmFycmlzQ2hlY2tib3hHcm91cENvbXBvbmVudCksXHJcbiAgICAgICAgbXVsdGk6IHRydWUsXHJcbiAgICB9XSxcclxuICAgIGV4cG9ydEFzOiAnRmFycmlzQ2hlY2tib3hHcm91cENvbXBvbmVudCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc0NoZWNrYm94R3JvdXBDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgQElucHV0KCd0YWItaW5kZXgnKSB0YWJJbmRleDogbnVtYmVyO1xyXG5cclxuICAgIC8qIHJhZGlvIOaVsOe7hCAqL1xyXG4gICAgQElucHV0KCkgZGF0YTogYW55W10gPSBbXTtcclxuXHJcbiAgICAvKiBjaGVja2JveCDnsbvlnosgICDljp/nlJ/miJbogIXmjInpkq7nsbvlnosqL1xyXG4gICAgQElucHV0KCkgdHlwZTogc3RyaW5nO1xyXG5cclxuICAgIC8qIOWkjemAieahhm5hbWUgKi9cclxuICAgIEBJbnB1dCgpIG5hbWU6IHN0cmluZztcclxuXHJcbiAgICAvKiDmmK/lkKbmsLTlubPliIbluIMgKi9cclxuICAgIEBJbnB1dCgpIGhvcml6b250YWw6IGJvb2xlYW47XHJcblxyXG4gICAgLyog5YiG6ZqU56ymIOm7mOiupOmAl+WPtyovXHJcbiAgICBASW5wdXQoKSBzZXBhcmF0b3IgPSAnLCc7XHJcblxyXG4gICAgLyog56aB55SoICovXHJcbiAgICBASW5wdXQoKSBkaXNhYmxlOiBib29sZWFuO1xyXG5cclxuICAgIC8qIOWkjemAieahhue7hOeahOWAvCAqL1xyXG4gICAgQElucHV0KCkgdmFsdWU6IGFueTtcclxuXHJcbiAgICAvKiDlgLznsbvlnovmmK/lkKbmmK9zdHJpbmcgKi9cclxuICAgIEBJbnB1dCgpIGlzU3RyaW5nVmFsdWUgPSB0cnVlO1xyXG5cclxuICAgIEBJbnB1dCgpIHRleHRGaWVsZCA9ICduYW1lJztcclxuICAgIEBJbnB1dCgpIHZhbHVlRmllbGQgPSAndmFsdWUnO1xyXG5cclxuICAgIC8qKiDliqDovb3mlbDmja7kuovku7YgKi9cclxuICAgIEBJbnB1dCgpIGxvYWREYXRhOiAoZW1wdHlEYXRhPzogYW55W10pID0+IE9ic2VydmFibGU8YW55PjtcclxuICAgIGxvYWREYXRhU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgQE91dHB1dCgpIGNoYW5nZVZhbHVlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgLyogY2hlY2tib3jotYvlgLzkuovku7YgKi9cclxuICAgIEBPdXRwdXQoKSBzZXRDaGVja2JveERhdGEgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgICBwcml2YXRlIGNvbW1vblV0aWxzOiBDb21tb25VdGlscztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGlkU2VyOiBJZFNlcnZpY2UsIEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0OiBJbmplY3Rvcikge1xyXG4gICAgICAgIGlmICh0aGlzLmluamVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3QuZ2V0KENvbW1vblV0aWxzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgLy8g5Yid5aeL5YyWbmFtZVxyXG4gICAgICAgIHRoaXMubmFtZSA9IHRoaXMuaWRTZXIuZ2VuZXJhdGUoKS5yZXBsYWNlKC8tL2csICdfJyk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0Q2hlY2tib3hEYXRhLmVtaXQodGhpcyk7XHJcbiAgICAgICAgLy8gdG9kbyDlj5blgLzlj6/ku6Xlrp7njrBwcm9taXNlXHJcbiAgICAgICAgaWYgKHRoaXMubG9hZERhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkRGF0YVN1YnNjcmlwdGlvbiA9IHRoaXMubG9hZERhdGEoKS5zdWJzY3JpYmUocmVzID0+IHRoaXMuZGF0YSA9IHJlcy5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmxvYWREYXRhU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGFTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2dldFRleHQoaXRlbSkge1xyXG4gICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbW1vblV0aWxzICYmIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMudGV4dEZpZWxkLCBpdGVtKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW3RoaXMudGV4dEZpZWxkXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2dldFZhbHVlKGl0ZW0pIHtcclxuICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21tb25VdGlscyAmJiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSh0aGlzLnZhbHVlRmllbGQsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bdGhpcy52YWx1ZUZpZWxkXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyog6YCJ5LitaW5wdXTlgLwgKi9cclxuICAgIGNsaWNrSGFuZGxlcihpdGVtOiBhbnksIGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgYXJyVmFsdWUgPSB0aGlzLnRyYW5zZm9ybVRvQXJyKHRoaXMudmFsdWUpIHx8IFtdO1xyXG5cclxuICAgICAgICBjb25zdCB2YWwgPSBTdHJpbmcodGhpcy5fZ2V0VmFsdWUoaXRlbSkpO1xyXG4gICAgICAgIGlmICghYXJyVmFsdWUgfHwgIWFyclZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBhcnJWYWx1ZS5wdXNoKHZhbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGFyclZhbHVlLnNvbWUoaXRlbSA9PiBpdGVtID09IHZhbCkpIHtcclxuICAgICAgICAgICAgICAgIGFyclZhbHVlID0gYXJyVmFsdWUuZmlsdGVyKG4gPT4gbiAhPT0gdmFsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFyclZhbHVlLnB1c2godmFsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5pu05pawdmFsdWXlgLxcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy50cmFuc2Zvcm1Ub1N0cihhcnJWYWx1ZSk7XHJcblxyXG4gICAgICAgIC8vIOS8oOWAvGZvcm1jb250cm9sXHJcbiAgICAgICAgdGhpcy5jb250cm9sQ2hhbmdlKHRoaXMudmFsdWUpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFRvdWNoKHRoaXMudmFsdWUpO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlVmFsdWUuZW1pdCh0aGlzLnZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDooqvpgInkuK0gKi9cclxuICAgIGNoZWNrZWQoaXRlbTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdmFsID0gU3RyaW5nKHRoaXMuX2dldFZhbHVlKGl0ZW0pKTtcclxuICAgICAgICBjb25zdCBjaGVja2VkVmFsdWUgPSB0aGlzLnRyYW5zZm9ybVRvQXJyKHRoaXMudmFsdWUpO1xyXG4gICAgICAgIC8vIOWkmuWAvFxyXG4gICAgICAgIHJldHVybiBjaGVja2VkVmFsdWUuc29tZShpdGVtID0+IGl0ZW0gPT0gdmFsKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDlgLzliLDmlbDnu4TlgLznmoTovazmjaIgKi9cclxuICAgIHRyYW5zZm9ybVRvQXJyKHZhbHVlOiBhbnkpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5pc1N0cmluZ1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB2YWx1ZS5zcGxpdCh0aGlzLnNlcGFyYXRvcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyog5YC85Yiw5a2X56ym5Liy5YC855qE6L2s5o2iICovXHJcbiAgICB0cmFuc2Zvcm1Ub1N0cih2YWx1ZTogQXJyYXk8c3RyaW5nPikge1xyXG5cclxuICAgICAgICBjb25zdCBhbGxWYWxzID0gdGhpcy5kYXRhLm1hcChuID0+IHRoaXMuX2dldFZhbHVlKG4pKTtcclxuICAgICAgICBjb25zdCByID0gW107XHJcbiAgICAgICAgYWxsVmFscy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUuc29tZShpdGVtID0+IGl0ZW0gPT0gbikpIHtcclxuICAgICAgICAgICAgICAgIHIucHVzaChuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNTdHJpbmdWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHIuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKiBjaGFuZ2Xmk43kvZzlgLzlj5jljJYgIOaWueazlemHjeWGmSovXHJcbiAgICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jb250cm9sQ2hhbmdlID0gZm47XHJcbiAgICB9XHJcblxyXG4gICAgLyogYmx1cuWAvOWPmOWMliAg5pa55rOV6YeN5YaZKi9cclxuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jb250cm9sVG91Y2ggPSBmbjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNvbnRyb2xDaGFuZ2U6ICh2YWx1ZTogYW55KSA9PiB2b2lkID0gKCkgPT4geyB9O1xyXG4gICAgcHJpdmF0ZSBjb250cm9sVG91Y2g6ICh2YWx1ZTogYW55KSA9PiB2b2lkID0gKCkgPT4geyB9O1xyXG5cclxufVxyXG4iXX0=