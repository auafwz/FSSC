/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:53
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-20 07:39:45
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Injectable, EventEmitter } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { BehaviorSubject, of, Subject } from 'rxjs';
import { map, distinctUntilChanged, filter, switchMap } from 'rxjs/operators';
import { CalculationType } from '../types';
import { initDataGridState, ROW_INDEX_FIELD, IS_GROUP_ROW_FIELD, GROUP_ROW_FIELD, IS_GROUP_FOOTER_ROW_FIELD, GROUP_VISIBLE_FIELD, GROUP_LEVEL_FIELD } from './state';
import { cloneDeep, groupBy, isPlainObject, flatten } from 'lodash-es';
import { Utils } from '../utils/utils';
import { DatagridColumnsHelper } from './datagrid-columns.helper';
import { BigNumber } from 'bignumber.js';
export class DatagridFacadeService {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
        this.localId = 'zh-CHS';
        // public virtualizedService: VirtualizedLoaderService;
        this.store = new BehaviorSubject(null);
        this.virtualRowSubject = new BehaviorSubject(null);
        this.gridSizeSubject = new Subject();
        this.errorSubject = new Subject();
        this.selectRowSubject = new Subject();
        this.unSelectRowSubject = new Subject();
        this.columnResizeSubject = new Subject();
        this.clearSelectionSubject = new Subject();
        this.checkRowSubject = new Subject();
        this.unCheckRowSubject = new Subject();
        this.clearCheckedsSubject = new Subject();
        this.clearAllSubject = new Subject();
        this.checkAllSubject = new Subject();
        this.unCheckAllSubject = new Subject();
        this.selectAllSubject = new Subject();
        this.selectCellSubject = new Subject();
        this.error$ = this.errorSubject.asObservable();
        this.selectRow$ = this.selectRowSubject.asObservable();
        this.unSelectRow$ = this.unSelectRowSubject.asObservable();
        this.columnResize$ = this.columnResizeSubject.asObservable();
        this.clearSelections$ = this.clearSelectionSubject.asObservable();
        this.checkRow$ = this.checkRowSubject.asObservable();
        this.unCheckRow$ = this.unCheckRowSubject.asObservable();
        this.clearCheckeds$ = this.clearCheckedsSubject.asObservable();
        this.clearAll$ = this.clearAllSubject.asObservable();
        this.checkAll$ = this.checkAllSubject.asObservable();
        this.unCheckAll$ = this.unCheckAllSubject.asObservable();
        this.selectAll$ = this.selectAllSubject.asObservable();
        this.currentCell$ = this.selectCellSubject.asObservable();
        this.editCell$ = new EventEmitter();
        this.clientSort$ = new EventEmitter();
        this.rowAppend$ = new EventEmitter();
        this.rowUpdate$ = new EventEmitter();
        this.rowDelete$ = new EventEmitter();
        this.state$ = this.store.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        (state) => state)));
        this.columnGroup$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        (state) => state)), map((/**
         * @param {?} state
         * @return {?}
         */
        (state) => state.columnsGroup)), switchMap((/**
         * @param {?} colgroup
         * @return {?}
         */
        (colgroup) => {
            return of(colgroup);
        })), distinctUntilChanged());
        this.gridSize$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        (state) => state)), map((/**
         * @param {?} state
         * @return {?}
         */
        (state) => {
            const { headerHeight, pagerHeight, width, columnsGroup, height, rowHeight } = Object.assign({}, state);
            return { headerHeight, pagerHeight, width, columnsGroup, height, rowHeight };
        })), distinctUntilChanged());
        this.data$ = this.virtualRowSubject.pipe(filter((/**
         * @param {?} vs
         * @return {?}
         */
        vs => vs)), switchMap((/**
         * @param {?} vs
         * @return {?}
         */
        (vs) => {
            return of({
                index: vs.startIndex || 0,
                rows: vs.virtualRows || [],
                top: vs.topHideHeight,
                bottom: vs.bottomHideHeight,
                scrolling: vs.isScrollChange
            });
        })), distinctUntilChanged());
        this.difference = (/**
         * @param {?} first
         * @param {?} second
         * @return {?}
         */
        (first, second) => first.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => !second.includes(item))));
        this.differenceBy = (/**
         * @param {?} a
         * @param {?} b
         * @param {?} fn
         * @return {?}
         */
        (a, b, fn) => {
            /** @type {?} */
            const s = new Set(b.map(fn));
            return a.map(fn).filter((/**
             * @param {?} el
             * @return {?}
             */
            el => !s.has(el)));
        });
        this._state = cloneDeep(initDataGridState);
    }
    /**
     * @param {?} scrolltop
     * @param {?=} isScrollChange
     * @return {?}
     */
    updateVirthualRows(scrolltop, isScrollChange = false) {
        // console.time('计算虚拟加载');
        /** @type {?} */
        const virtual = this.getVirthualRows(scrolltop);
        virtual.isScrollChange = isScrollChange;
        // console.timeEnd('计算虚拟加载');
        this.updateState({ virtual }, false);
        this.virtualRowSubject.next(virtual);
    }
    /**
     * @param {?} scrolltop
     * @return {?}
     */
    getVirthualRows(scrolltop) {
        if (scrolltop === undefined) {
            scrolltop = 0;
        }
        /** @type {?} */
        const data = this._state.data || [];
        /** @type {?} */
        const virtual = { rowIndex: 0, virtualRows: data, topHideHeight: 0, bottomHideHeight: 0 };
        if (data.length === 0 || (this._state.autoHeight && !this._state.groupRows)) {
            virtual.virtualRows = data;
            return virtual;
        }
        if (this._state.flatColumns && this._state.flatColumns.length) {
            // data = this._state.data;
            // if (!this._state.groupRows) {
            //     if (this._state.virtual && this._state.virtualized) {
            //         this.virtualizedService.state = this._state;
            //         const rows = this.virtualizedService.getRows(scrolltop);
            //         virtual = { ...this._state.virtual, ...rows };
            //     } else {
            //         virtual.virtualRows = data;
            //     }
            // } else {
            //     // 行分组数据处理
            //     const groupRows = this.groupRows2(cloneDeep(data));
            //     virtual.virtualRows = groupRows;
            // }
            if (this._state.groupRows) {
                // 行分组数据处理
                /** @type {?} */
                const groupRows = this.groupRows2(cloneDeep(data));
                virtual.virtualRows = groupRows;
            }
        }
        if (this._state.mergeCell && this._state.enableClientSortForMergeCell) {
            virtual.virtualRows = this.sort(virtual.virtualRows);
        }
        return virtual;
    }
    // getDeltaTopHeight(scrolTop, firstIndex) {
    //     const {rowsLength: viewRowsCount, top, bottom} = this.virtualizedService.getRowsCount(scrolTop, this._state.pageSize, firstIndex);
    //     const gridContainerRowsCount = this.virtualizedService.displayRowsCount();
    //     let deltaTopHeight = 0;
    //     if (viewRowsCount < gridContainerRowsCount) {
    //         deltaTopHeight = (gridContainerRowsCount - viewRowsCount) * this._state.rowHeight - this._state.headerHeight;
    //     }
    //     return deltaTopHeight;
    // }
    /**
     * @param {?=} original
     * @return {?}
     */
    getData(original = false) {
        if (original) {
            return this._state.originalData || [];
        }
        return this._state.data || [];
    }
    /**
     * @return {?}
     */
    getState() {
        return this._state;
    }
    /**
     * @return {?}
     */
    getVirtualState() {
        return this._state.virtual;
    }
    /**
     * @return {?}
     */
    getPageInfo() {
        const { pageIndex, pageSize } = Object.assign({}, this._state);
        return { pageIndex, pageSize };
    }
    /**
     * @param {?} state
     * @return {?}
     */
    initState(state) {
        this.updateState(state, false);
        this._state.originalData = cloneDeep(this._state.data);
        this.initColumns();
        this.gridSizeSubject.next(this._state);
        this.updateVirthualRows(0);
    }
    /**
     * 加载数据
     * @param {?} data
     * @param {?=} updateOriginalData 是否更新原始数据, 默认为 true
     * @param {?=} sortable
     * @return {?}
     */
    loadData(data, updateOriginalData = true, sortable = false) {
        data = data || [];
        this.updateState({ data }, false);
        if (updateOriginalData) {
            this._state.originalData = cloneDeep(this._state.data);
        }
        if (sortable && this._state.sortName) {
            /** @type {?} */
            const sortedData = this.sort(this._state.data);
            this.updateState({ data: sortedData }, false);
        }
        else {
            // this.updateState({ data: this._state.originalData }, false);
        }
        this.updateVirthualRows(this._state.virtual.scrollTop || 0);
    }
    /**
     * 复原指定行的数据
     * @param {?} rowId
     * @return {?}
     */
    resetRow(rowId) {
        /** @type {?} */
        const origData = this._state.originalData;
        if (origData) {
            /** @type {?} */
            const origRowData = origData.find((/**
             * @param {?} r
             * @return {?}
             */
            r => this.primaryId(r) === rowId));
            this.getCurrentRow().data = cloneDeep(origRowData);
            this.updateRow(rowId, origRowData);
        }
    }
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     // console.log(virtual);
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    /**
     * @param {?} url
     * @return {?}
     */
    fetchData(url) {
        return this.http.get(url).pipe(map((/**
         * @param {?} r
         * @return {?}
         */
        r => (/** @type {?} */ (r)))));
    }
    /**
     * @param {?} total
     * @return {?}
     */
    setTotal(total) {
        this.updateState({ total }, false);
    }
    /**
     * @param {?} property
     * @param {?} value
     * @return {?}
     */
    updateProperty(property, value) {
        this.updateState({ [property]: value }, false);
    }
    /**
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?} total
     * @return {?}
     */
    setPagination(pageIndex, pageSize, total) {
        this.updateState({ pageIndex, pageSize, total }, false);
    }
    /**
     * @param {?} scrollTop
     * @return {?}
     */
    setScrollTop(scrollTop) {
        /** @type {?} */
        const virtual = Object.assign({}, this._state.virtual, { scrollTop });
        this.updateState({ virtual }, false);
    }
    /**
     * @return {?}
     */
    isMultiSelect() {
        return this._state.multiSelect;
    }
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    _isRowSelected(id) {
        if (!id || !this._state.currentRow) {
            return false;
        }
        else {
            return this._state.currentRow.id.toString() === id.toString();
        }
    }
    /**
     * @param {?} id
     * @param {?=} selections
     * @return {?}
     */
    isRowSelected(id, selections = null) {
        /** @type {?} */
        const flag = this._isRowSelected(id);
        if (!this.isMultiSelect() || this._state.onlySelectSelf) {
            return flag;
        }
        else {
            if (!selections) {
                selections = this._state.selections;
            }
            if (this._canCancelSelectWhenMulti()) {
                return flag;
            }
            if (!selections || selections.length === 0) {
                return false;
            }
            else {
                return selections.findIndex((/**
                 * @param {?} sr
                 * @return {?}
                 */
                sr => sr.id == id)) > -1;
            }
        }
    }
    /**
     * @param {?} id
     * @param {?=} checkeds
     * @return {?}
     */
    isRowChecked(id, checkeds = null) {
        if (!checkeds) {
            checkeds = this.getCheckeds();
        }
        if (!id || !checkeds.length) {
            return false;
        }
        return checkeds.findIndex((/**
         * @param {?} sr
         * @return {?}
         */
        sr => sr.id.toString() === id.toString())) > -1;
    }
    /**
     * @return {?}
     */
    isCheckAll() {
        /** @type {?} */
        const allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        r => this.primaryId(r)));
        /** @type {?} */
        const checkIds = this._state.checkedRows.map((/**
         * @param {?} r
         * @return {?}
         */
        r => r.id));
        if (this.difference(allRows, checkIds).length) {
            return false; // this._state.checkedRows.length === allRows.length;
        }
        else {
            return true;
        }
    }
    /**
     * @return {?}
     */
    getCurrentPageCheckeds() {
        /** @type {?} */
        const allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        r => this.primaryId(r)));
        return this._state.checkedRows.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => allRows.indexOf(n.id) > -1));
    }
    /**
     * @return {?}
     */
    getCurrentRow() {
        return this._state.currentRow || undefined;
    }
    /**
     * @return {?}
     */
    getSelections() {
        // 如果数据源变了，需要重新计算
        /** @type {?} */
        const data = this._state.data;
        if (this._state.selections && this._state.selections.length) {
            if (!data || !data.length) {
                this._state.selections = [];
            }
            else {
                /** @type {?} */
                const temp = data.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => this.primaryId(n)));
                this._state.selections = this._state.selections.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    return temp.includes(n.id);
                }));
            }
        }
        return this._state.selections || [];
    }
    /**
     * @private
     * @return {?}
     */
    getCheckedRowsFromSource() {
        return (this._state.checkedRows || []).map((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            /** @type {?} */
            const d = this.findRow(n.id);
            if (d && d.data) {
                n.data = d.data;
            }
            return n;
        }));
    }
    /**
     * @param {?=} fromDataSource
     * @return {?}
     */
    getCheckeds(fromDataSource = false) {
        if (fromDataSource) {
            this._state.checkedRows = this.getCheckedRowsFromSource();
        }
        return this._state.checkedRows || [];
    }
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    updateCheckedData(rowid, rowData) {
        /** @type {?} */
        const checkeds = this.getCheckeds();
        if (checkeds.length) {
            /** @type {?} */
            const item = checkeds.find((/**
             * @param {?} n
             * @return {?}
             */
            n => this.primaryId(n) == rowid));
            if (item) {
                Object.keys(rowData).forEach((/**
                 * @param {?} k
                 * @return {?}
                 */
                k => {
                    Utils.setValue(k, rowData[k], item.data);
                }));
            }
        }
    }
    /**
     * @param {?} ids
     * @param {?=} checked
     * @return {?}
     */
    setCheckedRows(ids, checked = true) {
        if (ids && ids.length) {
            /** @type {?} */
            let checkeds = this._state.checkedRows || [];
            ids.forEach((/**
             * @param {?} id
             * @return {?}
             */
            id => {
                /** @type {?} */
                const row = this.findRow(id);
                if (checked && row) {
                    if (!this.isRowChecked(id, checkeds)) {
                        /** @type {?} */
                        const srow = { id: this.primaryId(row.data), data: row.data, index: row.index };
                        checkeds.push(srow);
                    }
                }
                else {
                    if (!this._state.enableMorePageSelect || !checked) {
                        checkeds = checkeds.filter((/**
                         * @param {?} sr
                         * @return {?}
                         */
                        sr => sr.id !== id));
                    }
                }
            }));
            this._state.checkedRows = checkeds;
        }
        else {
            this._clearCheckeds();
        }
    }
    /**
     * @param {?} id
     * @param {?=} checked
     * @return {?}
     */
    checkRecord(id, checked = true) {
        if (id) {
            /** @type {?} */
            const row = this.findRow(id);
            if (row) {
                const { index: rowIndex, data: rowData } = Object.assign({}, row);
                if (checked) {
                    this.checkRow(rowIndex, rowData);
                }
                else {
                    this.unCheckRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next(`未找到ID为${id}的数据。`);
            }
        }
        else {
            this.errorSubject.next(`参数id 不能为空。`);
        }
    }
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    checkRow(rowIndex, rowData) {
        if (!this._state.multiSelect) {
            this._clearCheckeds();
        }
        /** @type {?} */
        const id = this.primaryId(rowData);
        /** @type {?} */
        const checkeds = this._state.checkedRows || [];
        if (id && !this.isRowChecked(id, checkeds)) {
            /** @type {?} */
            const srow = { id, data: rowData, index: rowIndex };
            checkeds.push(srow);
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                this.selectRow(rowIndex, rowData);
            }
            this.checkRowSubject.next(srow);
        }
    }
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    unCheckRow(rowIndex, rowData) {
        /** @type {?} */
        const id = this.primaryId(rowData);
        /** @type {?} */
        let checkeds = this._state.checkedRows || [];
        if (this.isRowChecked(id, checkeds)) {
            /** @type {?} */
            const srow = { id, data: rowData, index: rowIndex };
            checkeds = checkeds.filter((/**
             * @param {?} sr
             * @return {?}
             */
            sr => '' + sr.id !== '' + id));
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                this.unSelectRow(rowIndex, rowData);
            }
            this.unCheckRowSubject.next(srow);
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    setCurrentPageData(data) {
        this._state.currentPageData = data;
    }
    /**
     * @return {?}
     */
    getCurrentPageData() {
        return this._state.currentPageData || [];
    }
    /**
     * 获取所有可以操作的行
     * @private
     * @return {?}
     */
    getAllRowsForLive() {
        /** @type {?} */
        let allData = this._state.data || [];
        if (this._state.pagination && !this._state.pagerOnServer) {
            // 获取当前页数据
            allData = this.getCurrentPageData();
        }
        // 排除掉禁用的行
        if (this._state.disableRow) {
            allData = allData.filter((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            (n, i) => !this._state.disableRow(n, i)));
        }
        return allData;
    }
    /**
     * @return {?}
     */
    checkAll() {
        this._state.checkedRows = this._state.checkedRows || [];
        /** @type {?} */
        const allData = this.getAllRowsForLive();
        /** @type {?} */
        const allCheckeds = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        (r, i) => {
            return {
                id: this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (!this._state.checkedRows.length) {
            this._state.checkedRows = allCheckeds;
        }
        else {
            /** @type {?} */
            const _checkeds = [];
            allCheckeds.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                if (!this._state.checkedRows.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.id == element.id))) {
                    _checkeds.push(element);
                }
            }));
            this._state.checkedRows = this._state.checkedRows.concat(_checkeds);
        }
        if (this._state.selectOnCheck && !this._state.onlySelectSelf) {
            this._state.selections = [];
            this._state.selections = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            (r, i) => {
                return {
                    id: this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.checkAllSubject.next(this._state.checkedRows);
    }
    /**
     * @return {?}
     */
    selectAll() {
        this._state.selections = [];
        /** @type {?} */
        const allData = this.getAllRowsForLive();
        this._state.selections = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        (r, i) => {
            return {
                id: this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (this._state.checkOnSelect) {
            this._state.checkedRows = [];
            this._state.checkedRows = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            (r, i) => {
                return {
                    id: this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.selectAllSubject.next(this._state.selections);
    }
    /**
     * @param {?} id
     * @return {?}
     */
    findRow(id) {
        if (this._state.data && this._state.data.length) {
            /** @type {?} */
            let index = -1;
            /** @type {?} */
            const data = this._state.data.find((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            (n, i) => {
                /** @type {?} */
                const r = this.primaryId(n) == id;
                if (r) {
                    index = i;
                }
                return r;
            }));
            if (index === -1) {
                return null;
            }
            return { index, data };
        }
        return null;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    findRowIndex(id) {
        if (this._state.data && this._state.data.length) {
            return this._state.data.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            n => this.primaryId(n) === id));
        }
        return -1;
    }
    /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    setSelectRow(id, select = true) {
        /** @type {?} */
        const row = this.findRow(id);
        const { index: rowIndex, data: rowData } = Object.assign({}, row);
        /** @type {?} */
        const srow = { id, data: rowData, index: rowIndex };
        if (this.isMultiSelect()) {
            if (select) {
                this.selectRowForMulti(srow, false);
            }
            else {
                this.unSelectRowForMulti(srow, false);
            }
        }
        /** @type {?} */
        const _sr = select ? srow : null;
        this.updateState({ currentRow: _sr }, false);
    }
    /**
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    selectRecord(id, select = true) {
        if (id) {
            /** @type {?} */
            const row = this.findRow(id);
            if (row) {
                const { index: rowIndex, data: rowData } = Object.assign({}, row);
                if (select) {
                    this.selectRow(rowIndex, rowData);
                }
                else {
                    this.unSelectRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next(`未找到ID为${id}的数据。`);
            }
        }
        else {
            this.errorSubject.next(`参数id 不能为空。`);
        }
    }
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    selectRow(rowIndex, rowData) {
        /** @type {?} */
        const isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        const id = this.primaryId(rowData);
        /** @type {?} */
        const srow = { id, data: rowData, index: rowIndex };
        if (!this.isRowSelected(id) || !this._state.currentRow) {
            if (!isMultiSelect) {
                this.updateState({ currentRow: srow }, false);
                this.selectRowSubject.next(this._state.currentRow);
                if (this._state.showCheckbox && this._state.checkOnSelect) {
                    this._state.checkedRows = [srow];
                    this.checkRowSubject.next(srow);
                }
            }
            else {
                this.selectRowForMulti(srow);
            }
        }
    }
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @return {?}
     */
    selectRowForMulti(srow, emit = true) {
        if (this._state.onlySelectSelf) {
            this._clearSelections();
            this.updateState({ currentRow: srow, selections: [srow] }, false);
        }
        else {
            this._state.selections = this._state.selections || [];
            this._state.selections = this._state.selections.filter((/**
             * @param {?} sr
             * @return {?}
             */
            sr => sr.id !== srow.id));
            this._state.selections.push(srow);
        }
        if (emit) {
            this.selectRowSubject.next(srow);
        }
        if (this._state.checkOnSelect) {
            this.checkRow(srow.index, srow.data);
        }
    }
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @return {?}
     */
    unSelectRowForMulti(srow, emit = true) {
        this._state.selections = this._state.selections.filter((/**
         * @param {?} sr
         * @return {?}
         */
        sr => sr.id !== srow.id));
        if (this._canCancelSelectWhenMulti() || (this._state.currentRow && this._state.currentRow.id === srow.id)) {
            this.updateState({ currentRow: null });
        }
        if (this._state.checkOnSelect) {
            this.unCheckRow(srow.index, srow.data);
        }
        if (emit) {
            this.unSelectRowSubject.next(srow);
        }
    }
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    unSelectRow(rowIndex, rowData) {
        /** @type {?} */
        const id = this.primaryId(rowData);
        /** @type {?} */
        const isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        const srow = { id, index: rowIndex, data: rowData };
        if (!isMultiSelect) {
            if (this._state.currentRow) {
                this.updateState({ currentRow: null });
                this.unSelectRowSubject.next(srow);
                if (this._state.showCheckbox) {
                    this.unCheckRow(srow.index, srow.data);
                }
            }
        }
        else {
            this.unSelectRowForMulti(srow);
        }
    }
    /**
     * @private
     * @return {?}
     */
    _canCancelSelectWhenMulti() {
        return !this._state.keepSelect && this._state.onlySelectSelf;
    }
    /**
     * @private
     * @param {?=} excludeIds
     * @return {?}
     */
    _clearSelections(excludeIds) {
        this._state.currentRow = null;
        if (!excludeIds || !excludeIds.length) {
            this._state.selections = [];
        }
        else {
            this._state.selections = this._state.selections.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                return excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                i => i == n.id)) > -1;
            }));
        }
    }
    /**
     * @private
     * @param {?=} rows
     * @return {?}
     */
    _clearCheckeds(rows = []) {
        if (!rows.length) {
            this._state.checkedRows = [];
        }
        else {
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => rows.findIndex((/**
             * @param {?} r
             * @return {?}
             */
            r => this.primaryId(r) === n.id)) == -1));
        }
    }
    /**
     * @param {?=} excludeIds
     * @return {?}
     */
    clearSelections(excludeIds) {
        /** @type {?} */
        const rows = this._state.selections;
        excludeIds = excludeIds || [];
        this._clearSelections(excludeIds);
        /** @type {?} */
        const unCheckRows = rows.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => excludeIds.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        i => i == n.id)) == -1));
        if (this._state.checkOnSelect || (!this._state.multiSelect && this._state.showCheckbox)) {
            // this._state.checkedRows = [];
            // this.clearCheckedsSubject.next(rows);
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                return !rows.find((/**
                 * @param {?} t1
                 * @return {?}
                 */
                t1 => t1.id == n.id && excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                i => i == n.id)) == -1));
            }));
            this.clearCheckedsSubject.next(unCheckRows);
        }
        this.clearSelectionSubject.next(unCheckRows);
    }
    /**
     * @param {?=} clearAll
     * @return {?}
     */
    clearCheckeds(clearAll = true) {
        /** @type {?} */
        const rows = this.getAllRowsForLive();
        /** @type {?} */
        const _rows = clearAll ? [] : rows;
        this._clearCheckeds(_rows);
        if (this._state.selectOnCheck) {
            this._clearSelections();
        }
        this.clearCheckedsSubject.next(rows);
    }
    /**
     * @return {?}
     */
    clearAll() {
        this._clearCheckeds();
        this._clearSelections();
        this.clearAllSubject.next();
    }
    /**
     * @param {?} flag
     * @return {?}
     */
    setMultiSelect(flag) {
        this._state.multiSelect = flag;
    }
    /**
     * @param {?} flag
     * @return {?}
     */
    setCheckOnSelect(flag) {
        this._state.checkOnSelect = flag;
    }
    /**
     * @param {?} flag
     * @return {?}
     */
    setSelectOnCheck(flag) {
        this._state.selectOnCheck = flag;
    }
    /**
     * @param {?} dr
     * @param {?} field
     * @param {?=} cellElement
     * @param {?=} cellRef
     * @return {?}
     */
    setCurrentCell(dr, field, cellElement, cellRef) {
        const { rowIndex, rowData } = Object.assign({}, dr);
        /** @type {?} */
        let currentCell = Object.assign({}, this._state.currentCell, { rowIndex, rowData, field, rowId: this.primaryId(rowData), cellElement });
        if (field !== this._state.ControlPanelFeild) {
            if (cellRef) {
                currentCell.cellRef = cellRef;
            }
            if (field) {
                currentCell.column = this.getColumn(field);
            }
            /** @type {?} */
            const isLastRow = rowIndex === this.getData().length - 1;
            currentCell['lastRow'] = isLastRow;
        }
        else {
            currentCell = null;
        }
        this.updateState({ currentCell }, false);
        this.selectRow(rowIndex, rowData);
        if (this._state.currentRow) {
            this._state.currentRow.dr = dr;
        }
        this.selectCellSubject.next(currentCell);
    }
    /**
     * @return {?}
     */
    cancelSelectCell() {
        if (this._state.currentCell) {
            this.updateState({ currentCell: null }, false);
            this.selectCellSubject.next(null);
        }
    }
    /**
     * @param {?} rowData
     * @return {?}
     */
    primaryId(rowData) {
        return rowData[this._state.idField];
    }
    /**
     * @return {?}
     */
    getCurrentCell() {
        return this._state.currentCell;
    }
    /**
     * @return {?}
     */
    editCell() {
        if (this._state.currentCell) {
            if (!this._state.currentCell.isEditing) {
                /** @type {?} */
                const cei = Object.assign({}, this._state.currentCell, { isEditing: true });
                this.updateState({ currentCell: cei }, false);
                this.selectCellSubject.next(cei);
                // this.editCell$.next(cei);
            }
        }
    }
    /**
     * @return {?}
     */
    endEditCell() {
        if (this._state.currentCell && this._state.currentCell.isEditing) {
            /** @type {?} */
            const cei = Object.assign({}, this._state.currentCell, { isEditing: false });
            this.updateState({ currentCell: cei }, false);
            this.selectCellSubject.next(cei);
            // this.editCell$.next(cei);
        }
    }
    /**
     * @param {?} rowData
     * @return {?}
     */
    appendRow(rowData) {
        if (rowData && this.primaryId(rowData)) {
            /** @type {?} */
            const pid = this.primaryId(rowData);
            if (this.findRowIndex(pid) === -1) {
                this._state.data.push(rowData);
                /** @type {?} */
                const newData = [...this._state.data];
                this.updateState({ data: newData }, false);
                this._state.originalData = cloneDeep(this._state.data);
                this.refresh();
                this.rowAppend$.emit(rowData);
            }
            else {
                throw new Error(`主键ID 已存在！ID: ${pid}`);
            }
        }
        else {
            throw new Error(`主键标识字段不能为空。`);
        }
    }
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    updateRow(rowid, rowData) {
        /** @type {?} */
        const row = this.findRow(rowid);
        if (row && row.data) {
            if (rowData) {
                /** @type {?} */
                const keys = Object.keys(rowData);
                keys.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                field => {
                    Utils.setValue(field, rowData[field], row.data);
                }));
                // 更新已勾选的数据
                this.updateCheckedData(rowid, rowData);
                this.rowUpdate$.emit(row);
            }
        }
        else {
            console.log('Can not found rowid: ' + rowid);
        }
        // Object.assign(this.findRow(id), row);
    }
    /**
     * @param {?} rowid
     * @return {?}
     */
    deleteRow(rowid) {
        /** @type {?} */
        const row = this.findRow(rowid);
        if (row) {
            /** @type {?} */
            const newData = this.removeRow(this._state.data, rowid);
            this.updateState({ data: newData }, false);
            this._state.originalData = cloneDeep(this._state.data);
            this.refresh();
            this.rowDelete$.emit(rowid);
            return row;
        }
        else {
            console.log('Can not found row by ID:' + rowid);
        }
    }
    /**
     * 从数组中删除指定的ID
     * @param {?} data 数组
     * @param {?} rowId 要删除的ID
     * @return {?}
     */
    removeRow(data, rowId) {
        /** @type {?} */
        const newData = data.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            /** @type {?} */
            const id = this.primaryId(n);
            return rowId !== id;
        }));
        return newData;
    }
    /**
     * @param {?} cellInfo
     * @return {?}
     */
    isCellSelected(cellInfo) {
        /** @type {?} */
        const cc = this.getCurrentCell();
        if (!cc) {
            return false;
        }
        else {
            if (this._state.currentRow.index === cc.rowIndex) {
                return cc.field === cellInfo.field;
            }
            return false;
        }
    }
    /**
     * @protected
     * @param {?} state
     * @param {?=} emit
     * @return {?}
     */
    updateState(state, emit = true) {
        /** @type {?} */
        const newState = Object.assign({}, this._state, state);
        this._state = newState;
        if (emit) {
            this.store.next(this._state);
        }
    }
    /**
     * @param {?=} newSize
     * @return {?}
     */
    resize(newSize) {
        if (newSize) {
            this.updateState(newSize, false);
        }
        this.resetColumnsSize();
        if (!this._state.groupRows) {
            this.updateVirthualRows(this._state.virtual.scrollTop);
        }
    }
    /**
     * @param {?} fit
     * @return {?}
     */
    fitColumns(fit) {
        this.updateState({ fitColumns: fit }, false);
        // const r = this.useUserSetColumnSize();
        // this.setFitColumnsWidth(this._state.columnsGroup, true, r);
        // this.gridSizeSubject.next(this._state);
        this.resetColumnsSize();
    }
    /**
     * @private
     * @return {?}
     */
    useUserSetColumnSize() {
        if (this._state.autoFitColumns) {
            /** @type {?} */
            const gridWidth = this._state.width;
            /** @type {?} */
            const userSetColumnWidth = this._state.columnsGroup.originalTotalWidth;
            return userSetColumnWidth > gridWidth;
        }
        return false;
    }
    /**
     * @private
     * @return {?}
     */
    resetColumnsSize() {
        if (this._state.fitColumns) {
            // 20200421
            /** @type {?} */
            const r = this.useUserSetColumnSize();
            this.setFitColumnsWidth(this._state.columnsGroup, r, r);
        }
        this.gridSizeSubject.next(this._state);
    }
    /**
     * 更新列设置
     * @param {?} columns 新的列集合
     * @param {?=} restitute 是否还原初始宽度 默认为 false
     * @param {?=} emit
     * @return {?}
     */
    updateColumns(columns, restitute = false, emit = false) {
        this._state.columns = columns;
        this.initColumns(emit, restitute);
        this.resizeColumns(restitute);
    }
    /**
     * @param {?=} emit
     * @param {?=} restColumnWidth
     * @return {?}
     */
    initColumns(emit = false, restColumnWidth = false) {
        /** @type {?} */
        const columns = this._state.flatColumns;
        /** @type {?} */
        let colgroup = {
            leftFixed: [],
            rightFixed: [],
            normalColumns: []
        };
        if (columns && columns.length) {
            /** @type {?} */
            const leftFixedCols = this.getFixedCols('left');
            /** @type {?} */
            const rightFixedCols = this.getFixedCols('right');
            /** @type {?} */
            const normalCols = this.getFixedCols();
            columns.forEach((/**
             * @param {?} c
             * @return {?}
             */
            c => {
                if (!c.originalWidth) {
                    c.originalWidth = c.width;
                }
            }));
            colgroup = {
                leftFixed: leftFixedCols,
                rightFixed: rightFixedCols,
                normalColumns: normalCols
            };
            this.initColumnsWidth(colgroup, restColumnWidth);
            if (this._state.fitColumns) {
                this.setFitColumnsWidth(colgroup, true);
            }
            this.updateState({ columnsGroup: colgroup }, emit);
        }
        else {
            colgroup.leftFixedWidth = 0;
            colgroup.rightFixedWidth = 0;
            colgroup.normalWidth = 0;
            colgroup.totalWidth = 0;
            this.updateState({ columnsGroup: colgroup }, emit);
        }
    }
    /**
     * @param {?} field
     * @param {?=} fixed
     * @return {?}
     */
    getColumnIndex(field, fixed = '') {
        /** @type {?} */
        const colgroup = this._state.columnsGroup;
        if (!fixed) {
            return colgroup.normalColumns.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field === field));
        }
        else {
            if (fixed === 'left') {
                return colgroup.leftFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.field === field));
            }
            else if (fixed === 'right') {
                return colgroup.rightFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.field === field));
            }
        }
    }
    /**
     * @return {?}
     */
    columnResizeEnd() {
        // const colgroup = this._state.columnsGroup;
        // this.initColumnsWidth(colgroup, false);
        // this.updateState({ columnsGroup:  {...colgroup} }, false);
        // this.gridSizeSubject.next(this._state);
        this.resizeColumns();
    }
    /**
     * @param {?=} restitute
     * @return {?}
     */
    resizeColumns(restitute = false) {
        /** @type {?} */
        const colgroup = this._state.columnsGroup;
        this.initColumnsWidth(colgroup, restitute);
        if (this._state.fitColumns) {
            /** @type {?} */
            const r = this.useUserSetColumnSize();
            if (r) {
                this.setFitColumnsWidth(colgroup, restitute, r);
            }
            else {
                this.setFitColumnsWidth(colgroup, restitute);
            }
        }
        this.updateState({ columnsGroup: Object.assign({}, colgroup) }, false);
        this.gridSizeSubject.next(this._state);
    }
    /**
     * @return {?}
     */
    getAllFlatColumns() {
        return flatten(this._state.columns);
    }
    /**
     * @param {?} fieldName
     * @return {?}
     */
    getColumn(fieldName) {
        return this.getAllFlatColumns().find((/**
         * @param {?} n
         * @return {?}
         */
        n => n.field === fieldName));
    }
    /**
     * @param {?} colgroup
     * @param {?=} restitute
     * @param {?=} useUserSetColumnSize
     * @return {?}
     */
    setFitColumnsWidth(colgroup, restitute = false, useUserSetColumnSize = false) {
        if (!colgroup) {
            return;
        }
        colgroup.normalWidth = this._state.width - colgroup.leftFixedWidth - colgroup.rightFixedWidth;
        if (!colgroup.normalWidth || colgroup.normalWidth < 0) {
            return;
        }
        if (useUserSetColumnSize) {
            colgroup.totalWidth = colgroup.originalTotalWidth;
            if (restitute) {
                colgroup.normalColumns.forEach((/**
                 * @param {?} col
                 * @return {?}
                 */
                col => {
                    col.width = col.originalWidth;
                }));
            }
            // 更新 normalColumns width
            colgroup.normalWidth = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            (totalWidth, col) => {
                if (!restitute && col.width) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
        else {
            /** @type {?} */
            const minWidth = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            (totalWidth, col) => {
                if (!restitute) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            colgroup.normalWidth = colgroup.normalWidth - 2;
            colgroup.normalColumns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            col => {
                if (!restitute) {
                    // col.width = Math.floor( col.width / minWidth * colgroup.normalWidth );
                    col.width = Number((col.width / minWidth * colgroup.normalWidth).toFixed(2));
                }
                else {
                    // col.width = Math.floor( col.originalWidth / minWidth * colgroup.normalWidth );
                    col.width = Number((col.originalWidth / minWidth * colgroup.normalWidth).toFixed(2));
                }
            }));
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
    }
    /**
     * @private
     * @param {?=} direction
     * @return {?}
     */
    getFixedCols(direction = '') {
        /** @type {?} */
        let cols = [];
        if (!direction) {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            col => !col.fixed));
        }
        else {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            col => col.fixed === direction));
        }
        // 多表头，重新计算列的顺序
        if (this._state.columns.length > 1 && cols.length) {
            /** @type {?} */
            const fields = DatagridColumnsHelper.getFields(this._state.columns);
            /** @type {?} */
            const newcols = [];
            fields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                /** @type {?} */
                const c = cols.find((/**
                 * @param {?} col
                 * @return {?}
                 */
                col => (col.field || '') === f));
                if (c) {
                    newcols.push(c);
                }
            }));
            return newcols;
        }
        return cols;
    }
    // restitute: 还原初始宽度，默认 false
    /**
     * @private
     * @param {?} colgroup
     * @param {?=} restitute
     * @return {?}
     */
    initColumnsWidth(colgroup, restitute = false) {
        /** @type {?} */
        let offset = 0;
        offset = this._state.showLineNumber ? offset + this._state.lineNumberWidth : offset;
        offset = this._state.showCheckbox ? offset + this._state.checkboxColumnWidth : offset;
        /** @type {?} */
        const getColsWidth = (/**
         * @param {?} cols
         * @param {?} val
         * @param {?} reset
         * @return {?}
         */
        (cols, val, reset) => {
            return cols.reduce((/**
             * @param {?} r
             * @param {?} c
             * @return {?}
             */
            (r, c) => {
                c.left = r;
                if (!reset) {
                    return r + c.width;
                }
                else {
                    return r + c.originalWidth;
                }
            }), val);
        });
        colgroup.leftFixedWidth = offset;
        if (colgroup.leftFixed && colgroup.leftFixed.length) {
            colgroup.leftFixedWidth = getColsWidth(colgroup.leftFixed, offset, restitute);
        }
        colgroup.rightFixedWidth = 0;
        if (colgroup.rightFixed && colgroup.rightFixed.length) {
            colgroup.rightFixedWidth = getColsWidth(colgroup.rightFixed, 0, restitute);
        }
        colgroup.normalWidth = 0;
        if (this._state.columns && this._state.columns.length) {
            colgroup.normalWidth = getColsWidth(colgroup.normalColumns, 0, restitute);
            colgroup.originalTotalWidth = getColsWidth(colgroup.normalColumns, 0, true);
        }
        colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
    }
    /**
     * @param {?=} isShow
     * @return {?}
     */
    showCheckbox(isShow = true) {
        /** @type {?} */
        const colgroup = this._state.columnsGroup;
        this.updateState({ showCheckbox: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.checkboxColumnWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.checkboxColumnWidth;
        }
        this.columnResizeSubject.next(colgroup);
    }
    /**
     * @return {?}
     */
    hideCheckbox() {
        this.showCheckbox(false);
    }
    /**
     * @param {?=} isShow
     * @return {?}
     */
    showLineNumber(isShow = true) {
        /** @type {?} */
        const colgroup = this._state.columnsGroup;
        this.updateState({ showLineNumber: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.lineNumberWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.lineNumberWidth;
        }
        this.columnResizeSubject.next(colgroup);
    }
    /**
     * @return {?}
     */
    hideLineNumber() {
        this.showLineNumber(false);
    }
    /**
     * @param {?} sortName
     * @param {?} sortOrder
     * @return {?}
     */
    setSortInfo(sortName, sortOrder) {
        sortName = sortName || '';
        sortOrder = sortOrder || '';
        /** @type {?} */
        const fields = sortName.split(',');
        /** @type {?} */
        const orders = sortOrder.split(',');
        // if (!this._state.multiSort) {
        /** @type {?} */
        const colgroup = this._state.columnsGroup;
        /** @type {?} */
        const updateFieldOrder = (/**
         * @param {?} cols
         * @return {?}
         */
        (cols) => {
            if (!cols || !cols.length) {
                return;
            }
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            col => {
                col.order = undefined;
                /** @type {?} */
                const i = fields.findIndex((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f === col.field));
                if (i > -1) {
                    col.order = orders[i];
                }
            }));
        });
        updateFieldOrder(colgroup.normalColumns);
        updateFieldOrder(colgroup.leftFixed);
        updateFieldOrder(colgroup.rightFixed);
        // }
        this.updateState({ sortName, sortOrder }, false);
    }
    /**
     * @param {?} arr
     * @param {?} props
     * @param {?} orders
     * @return {?}
     */
    orderBy(arr, props, orders) {
        /** @type {?} */
        const colObj = props.reduce((/**
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        (c, n) => {
            c[n] = this.getColumn(n);
            return c;
        }), {});
        return [...arr].sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => props.reduce((/**
         * @param {?} acc
         * @param {?} prop
         * @param {?} i
         * @return {?}
         */
        (acc, prop, i) => {
            if (acc === 0) {
                /** @type {?} */
                let valA = Utils.getValue(prop, a);
                /** @type {?} */
                let valB = Utils.getValue(prop, b);
                if (colObj[prop] && colObj[prop]['isMultilingualField']) {
                    valA = Utils.getMultilingualValue(valA, this.localId);
                    valB = Utils.getMultilingualValue(valB, this.localId);
                }
                if (valA === undefined || valA === null) {
                    valA = '';
                }
                if (valB === undefined || valB === null) {
                    valB = '';
                }
                const [p1, p2] = orders && orders[i] === 'desc' ? [valB, valA] : [valA, valB];
                if (typeof p1 === 'string') {
                    acc = p1.localeCompare(p2);
                }
                else {
                    acc = p1 > p2 ? 1 : p1 < p2 ? -1 : 0;
                }
            }
            return acc;
        }), 0)));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    sort(data) {
        /** @type {?} */
        const orders = this._state.sortOrder.split(',');
        /** @type {?} */
        const fields = this._state.sortName.split(',');
        if (this._state.mergeCell && this._state.mergeFields && this._state.mergeFields.length) {
            /** @type {?} */
            const newOrders = [];
            /** @type {?} */
            const newFields = [...this._state.mergeFields];
            fields.forEach((/**
             * @param {?} f
             * @param {?} i
             * @return {?}
             */
            (f, i) => {
                /** @type {?} */
                let k = newFields.indexOf(f);
                if (k == -1) {
                    newFields.push(f);
                    k = newFields.length - 1;
                }
                newOrders[k] = orders[i];
            }));
            return this.orderBy(data, newFields, newOrders);
        }
        return this.orderBy(data, fields, orders);
    }
    /**
     * @param {?=} data
     * @return {?}
     */
    clientSort(data) {
        if (this._state.sortName) {
            if (data) {
                this.updateState({ data }, false);
            }
            /** @type {?} */
            const sortedData = this.sort(this._state.data);
            this.loadData(sortedData, false);
        }
        else {
            this.clearSort();
        }
        this.clientSort$.emit({ sortName: this._state.sortName, sortOrder: this._state.sortOrder });
    }
    /**
     * @return {?}
     */
    clearSort() {
        this.loadData(this._state.originalData, false);
    }
    /**
     * @param {?} filterData
     * @return {?}
     */
    loadFilterData(filterData) {
        this.loadData(filterData, false);
    }
    //#region 变更集
    /**
     * @private
     * @param {?} rowid
     * @return {?}
     */
    hasRowChanges(rowid) {
        /** @type {?} */
        const _changes = this._state.changes;
        if (!_changes) {
            return false;
        }
        return _changes[rowid];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    appendChanges(changes) {
        if (!changes) {
            return;
        }
        /** @type {?} */
        const id = changes[this._state.idField];
        if (!id) {
            return;
        }
        /** @type {?} */
        const _id = '' + id;
        if (!this.hasRowChanges(_id)) {
            this._state.changes = this._state.changes || {};
            this._state.changes[_id] = changes;
        }
        else {
            this._state.changes[_id] = Object.assign(this._state.changes[_id], changes);
        }
    }
    /**
     * @return {?}
     */
    acceptChanges() {
        /** @type {?} */
        const changes = this._state.changes;
        if (changes) {
            /** @type {?} */
            const keys = Object.keys(changes);
            keys.forEach((/**
             * @param {?} id
             * @return {?}
             */
            id => {
                this.updateRow(id, changes[id]);
            }));
            this._state.originalData = cloneDeep(this._state.data);
        }
    }
    /**
     * @param {?=} rowid
     * @return {?}
     */
    rejectChanges(rowid = null) {
        /** @type {?} */
        const changes = this._state.changes;
        if (changes) {
            if (!rowid) {
                this._state.data = cloneDeep(this._state.originalData);
                this._state.changes = null;
            }
            else {
                /** @type {?} */
                const rowChanges = this._state.changes['' + rowid];
                if (rowChanges) {
                    /** @type {?} */
                    const orgiRow = this._state.originalData.find((/**
                     * @param {?} r
                     * @return {?}
                     */
                    r => this.primaryId(r) === rowid));
                    this._state.data.forEach((/**
                     * @param {?} r
                     * @return {?}
                     */
                    r => {
                        if (this.primaryId(r) === rowid) {
                            r = cloneDeep(orgiRow);
                        }
                    }));
                }
            }
            this.refresh();
        }
    }
    /**
     * @return {?}
     */
    getChanges() {
        return this._state.changes;
    }
    /**
     * @return {?}
     */
    refresh() {
        /** @type {?} */
        const data = cloneDeep(this._state.data);
        this.loadData(data);
    }
    //#endregion
    /**
     * 构造合计行
     * @param {?} data 数据集合
     * @return {?}
     */
    getFooterData(data) {
        if (this._state.showFooter) {
            // const columns = this._state.flatColumns;
            /** @type {?} */
            const columns = flatten(this._state.columns).filter((/**
             * @param {?} col
             * @return {?}
             */
            (col) => !col.colspan));
            /** @type {?} */
            const footerRow = {};
            columns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            col => {
                if (col.footer && col.footer.options) {
                    /** @type {?} */
                    const options = col.footer.options;
                    /** @type {?} */
                    const text = options.text;
                    /** @type {?} */
                    const typ = (/** @type {?} */ (options.calculationType));
                    if (typ !== undefined && typ != -1) {
                        /** @type {?} */
                        const val = this.calculation(data, typ, col);
                        footerRow[col.field] = val;
                    }
                    else {
                        footerRow[col.field] = text || '';
                    }
                }
                else {
                    footerRow[col.field] = '';
                }
            }));
            return [footerRow];
        }
        return [];
    }
    /**
     * @private
     * @param {?} items
     * @param {?} fields
     * @return {?}
     */
    arrToGroup(items, fields) {
        if (fields.length) {
            /** @type {?} */
            const first = fields.shift();
            /** @type {?} */
            const g1 = groupBy(items, (/**
             * @param {?} n
             * @return {?}
             */
            (n) => Utils.getValue(first, n)));
            this.toGroup(g1, fields);
            return g1;
        }
    }
    /**
     * @private
     * @param {?} g1
     * @param {?} fieldArr
     * @return {?}
     */
    toGroup(g1, fieldArr) {
        if (fieldArr.length) {
            Object.keys(g1).forEach((/**
             * @param {?} k
             * @return {?}
             */
            (k) => {
                /** @type {?} */
                const items = g1[k];
                /** @type {?} */
                const _nextFields = fieldArr.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                (n) => n));
                /** @type {?} */
                const _f = _nextFields.shift();
                g1[k] = groupBy(items, (/**
                 * @param {?} n
                 * @return {?}
                 */
                (n) => Utils.getValue(_f, n)));
                if (_nextFields.length) {
                    this.toGroup(g1[k], _nextFields);
                }
            }));
        }
    }
    /**
     * @private
     * @param {?} groupRows
     * @param {?} initLevel
     * @param {?} parent
     * @return {?}
     */
    groupRows2Flat(groupRows, initLevel, parent) {
        /** @type {?} */
        let results = [];
        if (initLevel === undefined) {
            initLevel = 0;
        }
        /** @type {?} */
        const idfield = this._state.idField;
        /** @type {?} */
        const columns = this._state.flatColumns;
        /** @type {?} */
        const data = this._state.data;
        /** @type {?} */
        const groupFieldArr = this._state.groupField.split(',');
        /** @type {?} */
        const pid = parent ? parent[idfield] : null;
        /** @type {?} */
        const colspan = this._state.columnsGroup.normalColumns.length;
        Object.keys(groupRows).forEach((/**
         * @param {?} k
         * @param {?} m
         * @return {?}
         */
        (k, m) => {
            /** @type {?} */
            const groupItem = { [idfield]: Utils.uuid(),
                [IS_GROUP_ROW_FIELD]: true, [GROUP_LEVEL_FIELD]: initLevel, data: {}, value: k,
                [GROUP_VISIBLE_FIELD]: true, expanded: true, field: groupFieldArr[initLevel],
                colspan, total: 0, rows: [], [GROUP_ROW_FIELD]: pid };
            // TFS: 356955
            if (parent) {
                groupItem.rows = parent.rows.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => !n[IS_GROUP_ROW_FIELD] &&
                    !n[IS_GROUP_FOOTER_ROW_FIELD] && Utils.getValue(groupFieldArr[initLevel], n) === k));
            }
            else {
                groupItem.rows = data.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => '' + Utils.getValue(groupFieldArr[initLevel], n) === k));
            }
            if (parent) {
                parent.rows.push(groupItem);
            }
            groupItem.total = groupItem.rows.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => !n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD])).length;
            results.push(groupItem);
            /** @type {?} */
            const items = groupRows[k];
            if (isPlainObject(items)) {
                /** @type {?} */
                const level = initLevel + 1;
                results = results.concat(this.groupRows2Flat(items, level, groupItem));
            }
            else {
                groupItem.total = items.length;
                items.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    n[GROUP_ROW_FIELD] = groupItem[idfield];
                    n[GROUP_VISIBLE_FIELD] = true;
                    n[GROUP_LEVEL_FIELD] = groupItem[GROUP_LEVEL_FIELD] + 1;
                    return n;
                }));
                groupItem.rows = items;
                results = results.concat(items);
            }
            if (this._state.groupFooter) {
                /** @type {?} */
                const footerItem = {
                    [IS_GROUP_FOOTER_ROW_FIELD]: true,
                    [GROUP_ROW_FIELD]: groupItem[idfield],
                    [GROUP_VISIBLE_FIELD]: true,
                    [GROUP_LEVEL_FIELD]: initLevel,
                    data: {}
                };
                groupItem.rows.push(footerItem);
                results.push(footerItem);
            }
        }));
        return results;
    }
    /**
     * 更新分组合计行数据
     * @private
     * @param {?} groupFooterRow
     * @param {?} columns
     * @param {?} groupRows
     * @return {?}
     */
    updateGroupFooterData(groupFooterRow, columns, groupRows) {
        columns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        col => {
            if (col.groupFooter && col.groupFooter.options) {
                /** @type {?} */
                const options = col.groupFooter.options;
                /** @type {?} */
                const text = options.text;
                /** @type {?} */
                const typ = (/** @type {?} */ (options.calculationType));
                if (typ !== undefined && typ != -1) {
                    /** @type {?} */
                    const val = this.calculation(groupRows, typ, col);
                    groupFooterRow.data[col.field] = val;
                }
                else {
                    groupFooterRow.data[col.field] = text || '';
                }
            }
            else {
                groupFooterRow.data[col.field] = '';
            }
        }));
    }
    /**
     * 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     * @private
     * @param {?} data
     * @return {?}
     */
    groupRows2(data) {
        if (data && data.length) {
            /** @type {?} */
            const columns = this._state.flatColumns;
            /** @type {?} */
            const groupField = this._state.groupField || '';
            if (!groupField) {
                return data;
            }
            /** @type {?} */
            const groupData = this.arrToGroup(data, groupField.split(','));
            /** @type {?} */
            const result = this.groupRows2Flat(groupData, 0, null);
            /** @type {?} */
            let k = 0;
            /** @type {?} */
            const prow = (/**
             * @param {?} pid
             * @return {?}
             */
            (pid) => result.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this._state.idField] === pid)));
            result.map((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            (n, i) => {
                if (!n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    n[ROW_INDEX_FIELD] = k;
                    k++;
                }
                // 更新合计行数据
                if (n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    /** @type {?} */
                    const rows = prow(n[GROUP_ROW_FIELD]).rows.filter((/**
                     * @param {?} r
                     * @return {?}
                     */
                    (r) => !r[IS_GROUP_ROW_FIELD] && !r[IS_GROUP_FOOTER_ROW_FIELD]));
                    this.updateGroupFooterData(n, columns, rows);
                }
                return n;
            }));
            return result;
        }
        return [];
    }
    /**
     * @param {?} groupFooter
     * @return {?}
     */
    showGroupFooter(groupFooter) {
        this.updateState({ groupFooter }, false);
        this.updateVirthualRows(0);
    }
    /**
     * @param {?} groupRowId
     * @return {?}
     */
    updateGroupFooter(groupRowId) {
        /** @type {?} */
        const groupRow = this._state.virtual.virtualRows.find((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            return n['id'] === groupRowId;
        }));
        if (groupRow) {
            /** @type {?} */
            const groupRows = groupRow.rows;
            /** @type {?} */
            const groupFooterRows = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            (n) => n['__group_footer__']));
            /** @type {?} */
            const columns = this._state.flatColumns;
            /** @type {?} */
            const rows = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            (n) => !n['__group_footer__']));
            groupFooterRows.forEach((/**
             * @param {?} n
             * @return {?}
             */
            (n) => {
                this.updateGroupFooterData(n, columns, rows);
            }));
        }
    }
    /**
     * @private
     * @param {?} data
     * @param {?} typ
     * @param {?} col
     * @return {?}
     */
    calculation(data, typ, col) {
        /** @type {?} */
        let val = '';
        // TFS: 357000
        // http://10.24.1.11:8080/tfs/GSP/GSPCloud/web/_queries?id=357000&triage=true&fullScreen=false&_a=edit
        if (!data || !data.length) {
            return '';
        }
        /** @type {?} */
        const field = col.field;
        /** @type {?} */
        const arr = data.map((/**
         * @param {?} o
         * @return {?}
         */
        (o) => Utils.getValue(field, o) || 0));
        switch (typ) {
            case CalculationType.sum:
                // val = sumBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).toFixed();
                break;
            case CalculationType.max:
                // const maxObj = maxBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, maxObj);
                val = BigNumber.max.apply(null, arr).toFixed();
                break;
            case CalculationType.min:
                // const minObj = minBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, minObj);
                val = BigNumber.min.apply(null, arr).toFixed();
                break;
            case CalculationType.average:
                // val = meanBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).div(arr.length).toFixed();
                break;
            case CalculationType.count:
                val = data.length;
                break;
        }
        return val;
    }
    //#region 组件初始属性
    /**
     * @param {?} opts
     * @return {?}
     */
    setinitialOptions(opts) {
        this._state.initialOptions = {};
        // 分组
        this._state.initialOptions['groupField'] = opts.groupField;
        // 排序
        this._state.initialOptions['sort'] = {
            sortName: opts.sortName,
            sortOrder: opts.sortOrder
        };
        // 列显示隐藏、对齐方式
        if (opts.columns && opts.columns[0]) {
            this._state.initialOptions['columnFields'] = ((/** @type {?} */ (opts.columns[0]))).map((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                return {
                    width: n.width || 100,
                    field: n.field,
                    halign: n.halign,
                    align: n.align,
                    visible: n.visible,
                    footer: cloneDeep(n.footer || {}),
                    groupFooter: cloneDeep(n.groupFooter || {})
                };
            }));
        }
    }
}
DatagridFacadeService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DatagridFacadeService.ctorParameters = () => [
    { type: HttpClient }
];
if (false) {
    /** @type {?} */
    DatagridFacadeService.prototype.localId;
    /**
     * @type {?}
     * @protected
     */
    DatagridFacadeService.prototype._state;
    /** @type {?} */
    DatagridFacadeService.prototype.store;
    /** @type {?} */
    DatagridFacadeService.prototype.virtualRowSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSizeSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.errorSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unSelectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.columnResizeSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearSelectionSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearCheckedsSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectCellSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.error$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unSelectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnResize$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearSelections$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearCheckeds$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.currentCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.editCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.clientSort$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowAppend$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowUpdate$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowDelete$;
    /** @type {?} */
    DatagridFacadeService.prototype.state$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnGroup$;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSize$;
    /** @type {?} */
    DatagridFacadeService.prototype.data$;
    /** @type {?} */
    DatagridFacadeService.prototype.difference;
    /** @type {?} */
    DatagridFacadeService.prototype.differenceBy;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFjLEVBQUUsRUFBUyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkUsT0FBTyxFQUFFLEdBQUcsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFxQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2pILE9BQU8sRUFBMkIsZUFBZSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3BFLE9BQU8sRUFBdUIsaUJBQWlCLEVBQ3ZCLGVBQWUsRUFBRSxrQkFBa0IsRUFBRSxlQUFlLEVBQUUseUJBQXlCLEVBQUUsbUJBQW1CLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFHakssT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQStCLGFBQWEsRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDcEcsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFekMsTUFBTSxPQUFPLHFCQUFxQjs7OztJQXNGOUIsWUFBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQXBGcEMsWUFBTyxHQUFHLFFBQVEsQ0FBQzs7UUFLbkIsVUFBSyxHQUFHLElBQUksZUFBZSxDQUFzQixJQUFJ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Qzs7Ozs7SUFDM0MsaURBQXlDOzs7OztJQUN6QyxrREFBMEM7O0lBRTFDLHVDQUEwQzs7SUFDMUMsMkNBQWtEOztJQUNsRCw2Q0FBdUQ7O0lBQ3ZELDhDQUF3RDs7SUFDeEQsaURBQTZEOztJQUM3RCwwQ0FBZ0Q7O0lBQ2hELDRDQUFvRDs7SUFDcEQsK0NBQTBEOztJQUMxRCwwQ0FBZ0Q7O0lBQ2hELDBDQUFnRDs7SUFDaEQsNENBQW9EOztJQUNwRCwyQ0FBa0Q7O0lBQ2xELDZDQUFxRDs7SUFDckQsMENBQStCOztJQUMvQiw0Q0FBaUM7O0lBQ2pDLDJDQUFnQzs7SUFDaEMsMkNBQWdDOztJQUNoQywyQ0FBZ0M7O0lBRWhDLHVDQUVFOztJQUVGLDZDQU9FOztJQUVGLDBDQU9FOztJQUVGLHNDQVlFOztJQUVGLDJDQUEyRjs7SUFDM0YsNkNBR0M7Ozs7O0lBRVcscUNBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0Mzo1M1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMS0yMCAwNzozOTo0NVxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIG9mLCBtZXJnZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIsIHN3aXRjaE1hcCwgYXVkaXRUaW1lLCBkZWJvdW5jZVRpbWUsIGRlYm91bmNlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uLCBDb2x1bW5Hcm91cCwgQ2FsY3VsYXRpb25UeXBlIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBGYXJyaXNEYXRhZ3JpZFN0YXRlLCBpbml0RGF0YUdyaWRTdGF0ZSwgRGF0YVJlc3VsdCwgQ2VsbEluZm8sIFZpcnR1YWxpemVkU3RhdGUsIFNlbGVjdGVkUm93LFxyXG4gICAgICAgIFJvd0RhdGFDaGFuZ2VzLCBST1dfSU5ERVhfRklFTEQsIElTX0dST1VQX1JPV19GSUVMRCwgR1JPVVBfUk9XX0ZJRUxELCBJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxELCBHUk9VUF9WSVNJQkxFX0ZJRUxELCBHUk9VUF9MRVZFTF9GSUVMRCB9IGZyb20gJy4vc3RhdGUnO1xyXG5pbXBvcnQgeyBWaXJ0dWFsaXplZExvYWRlclNlcnZpY2UgfSBmcm9tICcuL3ZpcnR1YWxpemVkLWxvYWRlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRSb3cgfSBmcm9tICcuLi90eXBlcy9kYXRhZ3JpZC1yb3cnO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAsIGdyb3VwQnksIHN1bUJ5LCBtYXhCeSwgbWluQnksIG1lYW5CeSwgaXNQbGFpbk9iamVjdCwgZmxhdHRlbiB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbHVtbnNIZWxwZXIgfSBmcm9tICcuL2RhdGFncmlkLWNvbHVtbnMuaGVscGVyJztcclxuaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnYmlnbnVtYmVyLmpzJztcclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIHtcclxuXHJcbiAgICBsb2NhbElkID0gJ3poLUNIUyc7XHJcblxyXG4gICAgcHJvdGVjdGVkIF9zdGF0ZTogRmFycmlzRGF0YWdyaWRTdGF0ZTtcclxuICAgIC8vIHB1YmxpYyB2aXJ0dWFsaXplZFNlcnZpY2U6IFZpcnR1YWxpemVkTG9hZGVyU2VydmljZTtcclxuXHJcbiAgICBzdG9yZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8RmFycmlzRGF0YWdyaWRTdGF0ZT4obnVsbCk7XHJcblxyXG4gICAgdmlydHVhbFJvd1N1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4obnVsbCk7XHJcbiAgICBncmlkU2l6ZVN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBlcnJvclN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RSb3dTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSB1blNlbGVjdFJvd1N1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNvbHVtblJlc2l6ZVN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNsZWFyU2VsZWN0aW9uU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIGNoZWNrUm93U3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHByaXZhdGUgdW5DaGVja1Jvd1N1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNsZWFyQ2hlY2tlZHNTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjbGVhckFsbFN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIGNoZWNrQWxsU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIHVuQ2hlY2tBbGxTdWJqZWN0ID0gIG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIHNlbGVjdEFsbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RDZWxsU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgZXJyb3IkID0gdGhpcy5lcnJvclN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxlY3RSb3ckID0gdGhpcy5zZWxlY3RSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgdW5TZWxlY3RSb3ckID0gIHRoaXMudW5TZWxlY3RSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY29sdW1uUmVzaXplJCA9IHRoaXMuY29sdW1uUmVzaXplU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNsZWFyU2VsZWN0aW9ucyQgPSB0aGlzLmNsZWFyU2VsZWN0aW9uU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNoZWNrUm93JCA9IHRoaXMuY2hlY2tSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgdW5DaGVja1JvdyQgPSB0aGlzLnVuQ2hlY2tSb3dTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY2xlYXJDaGVja2VkcyQgPSB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY2xlYXJBbGwkID0gdGhpcy5jbGVhckFsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjaGVja0FsbCQgPSB0aGlzLmNoZWNrQWxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHVuQ2hlY2tBbGwkID0gdGhpcy51bkNoZWNrQWxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHNlbGVjdEFsbCQgPSB0aGlzLnNlbGVjdEFsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjdXJyZW50Q2VsbCQgPSB0aGlzLnNlbGVjdENlbGxTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgZWRpdENlbGwkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgY2xpZW50U29ydCQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICByb3dBcHBlbmQkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgcm93VXBkYXRlJCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHJvd0RlbGV0ZSQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcmVhZG9ubHkgc3RhdGUkID0gdGhpcy5zdG9yZS5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICAgIGZpbHRlciggKHN0YXRlOiBhbnkpID0+IHN0YXRlKVxyXG4gICAgKTtcclxuXHJcbiAgICByZWFkb25seSBjb2x1bW5Hcm91cCQgPSB0aGlzLmdyaWRTaXplU3ViamVjdC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICAgIGZpbHRlciggKHN0YXRlOiBhbnkpID0+IHN0YXRlKSxcclxuICAgICAgICBtYXAoKHN0YXRlOiBGYXJyaXNEYXRhZ3JpZFN0YXRlKSA9PiBzdGF0ZS5jb2x1bW5zR3JvdXApLFxyXG4gICAgICAgIHN3aXRjaE1hcCgoY29sZ3JvdXA6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gb2YoIGNvbGdyb3VwKTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXHJcbiAgICApO1xyXG5cclxuICAgIGdyaWRTaXplJCA9IHRoaXMuZ3JpZFNpemVTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpLnBpcGUoXHJcbiAgICAgICAgZmlsdGVyKCAoc3RhdGU6IGFueSkgPT4gc3RhdGUpLFxyXG4gICAgICAgIG1hcCgoc3RhdGU6IEZhcnJpc0RhdGFncmlkU3RhdGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBoZWFkZXJIZWlnaHQsIHBhZ2VySGVpZ2h0LCB3aWR0aCwgY29sdW1uc0dyb3VwLCBoZWlnaHQsIHJvd0hlaWdodCB9ID0gey4uLnN0YXRlfTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgaGVhZGVySGVpZ2h0LCBwYWdlckhlaWdodCwgd2lkdGgsIGNvbHVtbnNHcm91cCwgaGVpZ2h0LCByb3dIZWlnaHQgfTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXHJcbiAgICApO1xyXG5cclxuICAgIHJlYWRvbmx5IGRhdGEkID0gdGhpcy52aXJ0dWFsUm93U3ViamVjdC5waXBlKFxyXG4gICAgICAgIGZpbHRlcih2cyA9PiB2cyksXHJcbiAgICAgICAgc3dpdGNoTWFwKCh2czogVmlydHVhbGl6ZWRTdGF0ZSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gb2Yoe1xyXG4gICAgICAgICAgICAgICAgaW5kZXg6IHZzLnN0YXJ0SW5kZXggfHwgMCxcclxuICAgICAgICAgICAgICAgIHJvd3M6IHZzLnZpcnR1YWxSb3dzIHx8IFtdLFxyXG4gICAgICAgICAgICAgICAgdG9wOiB2cy50b3BIaWRlSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgYm90dG9tOiB2cy5ib3R0b21IaWRlSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsaW5nOiB2cy5pc1Njcm9sbENoYW5nZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXHJcbiAgICApO1xyXG5cclxuICAgIGRpZmZlcmVuY2UgPSAoZmlyc3Q6IGFueVtdLCBzZWNvbmQ6IGFueVtdKSA9PiBmaXJzdC5maWx0ZXIoaXRlbSA9PiAhc2Vjb25kLmluY2x1ZGVzKGl0ZW0pKTtcclxuICAgIGRpZmZlcmVuY2VCeSA9IChhLCBiLCBmbikgPT4ge1xyXG4gICAgICAgIGNvbnN0IHMgPSBuZXcgU2V0KGIubWFwKGZuKSk7XHJcbiAgICAgICAgcmV0dXJuIGEubWFwKGZuKS5maWx0ZXIoZWwgPT4gIXMuaGFzKGVsKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUgPSAgY2xvbmVEZWVwKGluaXREYXRhR3JpZFN0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVWaXJ0aHVhbFJvd3Moc2Nyb2xsdG9wOiBudW1iZXIsIGlzU2Nyb2xsQ2hhbmdlID0gZmFsc2UpIHtcclxuICAgICAgICAvLyBjb25zb2xlLnRpbWUoJ+iuoeeul+iZmuaLn+WKoOi9vScpO1xyXG4gICAgICAgIGNvbnN0IHZpcnR1YWwgPSB0aGlzLmdldFZpcnRodWFsUm93cyhzY3JvbGx0b3ApO1xyXG4gICAgICAgIHZpcnR1YWwuaXNTY3JvbGxDaGFuZ2UgPSBpc1Njcm9sbENoYW5nZTtcclxuICAgICAgICAvLyBjb25zb2xlLnRpbWVFbmQoJ+iuoeeul+iZmuaLn+WKoOi9vScpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3ZpcnR1YWx9LCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy52aXJ0dWFsUm93U3ViamVjdC5uZXh0KHZpcnR1YWwpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZpcnRodWFsUm93cyhzY3JvbGx0b3ApOiBWaXJ0dWFsaXplZFN0YXRlIHtcclxuICAgICAgICBpZiAoc2Nyb2xsdG9wID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgc2Nyb2xsdG9wID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGEgPSAgdGhpcy5fc3RhdGUuZGF0YSB8fCBbXTtcclxuICAgICAgICBjb25zdCB2aXJ0dWFsID0ge3Jvd0luZGV4OiAwLCB2aXJ0dWFsUm93czogZGF0YSwgdG9wSGlkZUhlaWdodDogMCwgYm90dG9tSGlkZUhlaWdodDogMCB9O1xyXG5cclxuICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDAgfHwgKHRoaXMuX3N0YXRlLmF1dG9IZWlnaHQgJiYgIXRoaXMuX3N0YXRlLmdyb3VwUm93cykpIHtcclxuICAgICAgICAgICAgdmlydHVhbC52aXJ0dWFsUm93cyA9IGRhdGE7XHJcbiAgICAgICAgICAgIHJldHVybiB2aXJ0dWFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zICYmIHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAvLyBkYXRhID0gdGhpcy5fc3RhdGUuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIC8vIGlmICghdGhpcy5fc3RhdGUuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAodGhpcy5fc3RhdGUudmlydHVhbCAmJiB0aGlzLl9zdGF0ZS52aXJ0dWFsaXplZCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLnN0YXRlID0gdGhpcy5fc3RhdGU7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgY29uc3Qgcm93cyA9IHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLmdldFJvd3Moc2Nyb2xsdG9wKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICB2aXJ0dWFsID0geyAuLi50aGlzLl9zdGF0ZS52aXJ0dWFsLCAuLi5yb3dzIH07XHJcbiAgICAgICAgICAgIC8vICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSBkYXRhO1xyXG4gICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAgLy8g6KGM5YiG57uE5pWw5o2u5aSE55CGXHJcbiAgICAgICAgICAgIC8vICAgICBjb25zdCBncm91cFJvd3MgPSB0aGlzLmdyb3VwUm93czIoY2xvbmVEZWVwKGRhdGEpKTtcclxuICAgICAgICAgICAgLy8gICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSBncm91cFJvd3M7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICAgICAgLy8g6KGM5YiG57uE5pWw5o2u5aSE55CGXHJcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cFJvd3MgPSB0aGlzLmdyb3VwUm93czIoY2xvbmVEZWVwKGRhdGEpKTtcclxuICAgICAgICAgICAgICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSBncm91cFJvd3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5tZXJnZUNlbGwgJiYgdGhpcy5fc3RhdGUuZW5hYmxlQ2xpZW50U29ydEZvck1lcmdlQ2VsbCkge1xyXG4gICAgICAgICAgICB2aXJ0dWFsLnZpcnR1YWxSb3dzID0gdGhpcy5zb3J0KHZpcnR1YWwudmlydHVhbFJvd3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZpcnR1YWw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZ2V0RGVsdGFUb3BIZWlnaHQoc2Nyb2xUb3AsIGZpcnN0SW5kZXgpIHtcclxuICAgIC8vICAgICBjb25zdCB7cm93c0xlbmd0aDogdmlld1Jvd3NDb3VudCwgdG9wLCBib3R0b219ID0gdGhpcy52aXJ0dWFsaXplZFNlcnZpY2UuZ2V0Um93c0NvdW50KHNjcm9sVG9wLCB0aGlzLl9zdGF0ZS5wYWdlU2l6ZSwgZmlyc3RJbmRleCk7XHJcbiAgICAvLyAgICAgY29uc3QgZ3JpZENvbnRhaW5lclJvd3NDb3VudCA9IHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLmRpc3BsYXlSb3dzQ291bnQoKTtcclxuICAgIC8vICAgICBsZXQgZGVsdGFUb3BIZWlnaHQgPSAwO1xyXG4gICAgLy8gICAgIGlmICh2aWV3Um93c0NvdW50IDwgZ3JpZENvbnRhaW5lclJvd3NDb3VudCkge1xyXG4gICAgLy8gICAgICAgICBkZWx0YVRvcEhlaWdodCA9IChncmlkQ29udGFpbmVyUm93c0NvdW50IC0gdmlld1Jvd3NDb3VudCkgKiB0aGlzLl9zdGF0ZS5yb3dIZWlnaHQgLSB0aGlzLl9zdGF0ZS5oZWFkZXJIZWlnaHQ7XHJcbiAgICAvLyAgICAgfVxyXG5cclxuICAgIC8vICAgICByZXR1cm4gZGVsdGFUb3BIZWlnaHQ7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZ2V0RGF0YShvcmlnaW5hbCA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKG9yaWdpbmFsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgfHwgW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5kYXRhIHx8IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFN0YXRlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRWaXJ0dWFsU3RhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLnZpcnR1YWw7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UGFnZUluZm8oKSB7XHJcbiAgICAgICAgY29uc3QgeyBwYWdlSW5kZXgsIHBhZ2VTaXplIH0gPSB7Li4udGhpcy5fc3RhdGV9O1xyXG4gICAgICAgIHJldHVybiB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFN0YXRlKHN0YXRlOiBQYXJ0aWFsPEZhcnJpc0RhdGFncmlkU3RhdGU+KSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZShzdGF0ZSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICB0aGlzLmluaXRDb2x1bW5zKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKDApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog5Yqg6L295pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gZGF0YTog5pWw5o2u5YiX6KGoXHJcbiAgICAgKiBAcGFyYW0gdXBkYXRlT3JpZ2luYWxEYXRhIOaYr+WQpuabtOaWsOWOn+Wni+aVsOaNriwg6buY6K6k5Li6IHRydWVcclxuICAgICAqL1xyXG4gICAgbG9hZERhdGEoZGF0YTogYW55LCB1cGRhdGVPcmlnaW5hbERhdGEgPSB0cnVlLCBzb3J0YWJsZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgZGF0YSA9IGRhdGEgfHwgW107XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGRhdGEgfSwgZmFsc2UpO1xyXG5cclxuICAgICAgICBpZiAodXBkYXRlT3JpZ2luYWxEYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNvcnRhYmxlICYmIHRoaXMuX3N0YXRlLnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNvcnRlZERhdGEgPSB0aGlzLnNvcnQodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBkYXRhOiBzb3J0ZWREYXRhIH0sIGZhbHNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyB0aGlzLnVwZGF0ZVN0YXRlKHsgZGF0YTogdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhIH0sIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKHRoaXMuX3N0YXRlLnZpcnR1YWwuc2Nyb2xsVG9wIHx8IDApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlpI3ljp/mjIflrprooYznmoTmlbDmja4gKi9cclxuICAgIHJlc2V0Um93KHJvd0lkOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBvcmlnRGF0YSA9IHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YTtcclxuICAgICAgICBpZiAob3JpZ0RhdGEpIHtcclxuICAgICAgICAgICAgY29uc3Qgb3JpZ1Jvd0RhdGEgPSBvcmlnRGF0YS5maW5kKHIgPT4gdGhpcy5wcmltYXJ5SWQocikgPT09IHJvd0lkKTtcclxuICAgICAgICAgICAgdGhpcy5nZXRDdXJyZW50Um93KCkuZGF0YSA9IGNsb25lRGVlcChvcmlnUm93RGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUm93KHJvd0lkLCBvcmlnUm93RGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGxvYWREYXRhRm9yVmlydHVhbChkYXRhOiBhbnkpIHtcclxuICAgIC8vICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgZGF0YSB9LCBmYWxzZSk7XHJcbiAgICAvLyAgICAgLy8gdGhpcy52aXJ0dWFsaXplZFNlcnZpY2Uuc3RhdGUgPSB0aGlzLl9zdGF0ZTtcclxuICAgIC8vICAgICBjb25zdCB2aXJ0dWFsID0geyAuLi50aGlzLl9zdGF0ZS52aXJ0dWFsLCAuLi50aGlzLnZpcnR1YWxpemVkU2VydmljZS5yZWxvYWQoKSB9O1xyXG4gICAgLy8gICAgIC8vIGNvbnNvbGUubG9nKHZpcnR1YWwpO1xyXG4gICAgLy8gICAgIHRoaXMudmlydHVhbFJvd1N1YmplY3QubmV4dCh2aXJ0dWFsKTtcclxuICAgIC8vICAgICB0aGlzLnVwZGF0ZVN0YXRlKHt2aXJ0dWFsfSk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZmV0Y2hEYXRhKHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxEYXRhUmVzdWx0PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoIHIgPT4gciBhcyBEYXRhUmVzdWx0IClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFRvdGFsKHRvdGFsOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKCB7dG90YWx9LCBmYWxzZSApO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVByb3BlcnR5KHByb3BlcnR5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgW3Byb3BlcnR5XTogdmFsdWUgfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFBhZ2luYXRpb24ocGFnZUluZGV4OiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsIH0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRTY3JvbGxUb3Aoc2Nyb2xsVG9wOiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCB2aXJ0dWFsID0geyAuLi50aGlzLl9zdGF0ZS52aXJ0dWFsLCBzY3JvbGxUb3B9O1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3ZpcnR1YWx9LCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNNdWx0aVNlbGVjdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUubXVsdGlTZWxlY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaXNSb3dTZWxlY3RlZChpZDogYW55KSB7XHJcbiAgICAgICAgaWYgKCFpZCB8fCAhdGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cuaWQudG9TdHJpbmcoKSA9PT0gaWQudG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNSb3dTZWxlY3RlZChpZDogYW55LCBzZWxlY3Rpb25zID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGZsYWcgPSB0aGlzLl9pc1Jvd1NlbGVjdGVkKGlkKTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNNdWx0aVNlbGVjdCgpIHx8IHRoaXMuX3N0YXRlLm9ubHlTZWxlY3RTZWxmKSB7XHJcbiAgICAgICAgICAgcmV0dXJuIGZsYWc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCFzZWxlY3Rpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX2NhbkNhbmNlbFNlbGVjdFdoZW5NdWx0aSgpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmxhZztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFzZWxlY3Rpb25zIHx8IHNlbGVjdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0aW9ucy5maW5kSW5kZXgoc3IgPT4gc3IuaWQgPT0gaWQpID4gLTE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNSb3dDaGVja2VkKGlkOiBhbnksIGNoZWNrZWRzID0gbnVsbCkge1xyXG4gICAgICAgIGlmICghY2hlY2tlZHMpIHtcclxuICAgICAgICAgICAgY2hlY2tlZHMgPSB0aGlzLmdldENoZWNrZWRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaWQgfHwgIWNoZWNrZWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY2hlY2tlZHMuZmluZEluZGV4KHNyID0+IHNyLmlkLnRvU3RyaW5nKCkgPT09IGlkLnRvU3RyaW5nKCkpID4gLTE7XHJcbiAgICB9XHJcblxyXG4gICAgaXNDaGVja0FsbCgpIHtcclxuICAgICAgICBjb25zdCBhbGxSb3dzID0gdGhpcy5nZXRBbGxSb3dzRm9yTGl2ZSgpLm1hcChyID0+IHRoaXMucHJpbWFyeUlkKHIpKTtcclxuICAgICAgICBjb25zdCBjaGVja0lkcyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLm1hcChyID0+IHIuaWQpO1xyXG4gICAgICAgIGlmICh0aGlzLmRpZmZlcmVuY2UoYWxsUm93cywgY2hlY2tJZHMpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmxlbmd0aCA9PT0gYWxsUm93cy5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldEN1cnJlbnRQYWdlQ2hlY2tlZHMoKSB7XHJcbiAgICAgICAgY29uc3QgYWxsUm93cyA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKS5tYXAociA9PiB0aGlzLnByaW1hcnlJZChyKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmZpbHRlcihuID0+IGFsbFJvd3MuaW5kZXhPZihuLmlkKSA+IC0xKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDdXJyZW50Um93KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jdXJyZW50Um93IHx8IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWxlY3Rpb25zKCkge1xyXG4gICAgICAgIC8vIOWmguaenOaVsOaNrua6kOWPmOS6hu+8jOmcgOimgemHjeaWsOiuoeeul1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhO1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zICYmIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXA6IGFueVtdID0gZGF0YS5tYXAobiA9PiB0aGlzLnByaW1hcnlJZChuKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRlbXAuaW5jbHVkZXMobi5pZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyB8fCBbXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENoZWNrZWRSb3dzRnJvbVNvdXJjZSgpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdKS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLmZpbmRSb3cobi5pZCk7XHJcbiAgICAgICAgICAgIGlmIChkICYmIGQuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgbi5kYXRhID0gZC5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENoZWNrZWRzKGZyb21EYXRhU291cmNlID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoZnJvbURhdGFTb3VyY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLmdldENoZWNrZWRSb3dzRnJvbVNvdXJjZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUNoZWNrZWREYXRhKHJvd2lkOiBhbnksIHJvd0RhdGE6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pIHtcclxuICAgICAgICBjb25zdCBjaGVja2VkcyA9IHRoaXMuZ2V0Q2hlY2tlZHMoKTtcclxuICAgICAgICBpZiAoY2hlY2tlZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjaGVja2Vkcy5maW5kKG4gPT4gdGhpcy5wcmltYXJ5SWQobikgPT0gcm93aWQpO1xyXG4gICAgICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocm93RGF0YSkuZm9yRWFjaChrID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlscy5zZXRWYWx1ZShrLCByb3dEYXRhW2tdLCBpdGVtLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q2hlY2tlZFJvd3MoaWRzOiBzdHJpbmdbXSwgY2hlY2tlZCA9IHRydWUpIHtcclxuICAgICAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGNoZWNrZWRzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW107XHJcblxyXG4gICAgICAgICAgICBpZHMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQgJiYgcm93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhdGhpcy5pc1Jvd0NoZWNrZWQoaWQsIGNoZWNrZWRzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcm93ID0geyBpZDogdGhpcy5wcmltYXJ5SWQocm93LmRhdGEpLCBkYXRhOiByb3cuZGF0YSwgaW5kZXg6IHJvdy5pbmRleCB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2Vkcy5wdXNoKHNyb3cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zdGF0ZS5lbmFibGVNb3JlUGFnZVNlbGVjdCB8fCAhY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkcyA9IGNoZWNrZWRzLmZpbHRlcihzciA9PiBzci5pZCAhPT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gY2hlY2tlZHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjaGVja1JlY29yZChpZDogYW55LCBjaGVja2VkID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgICAgICBpZiAocm93KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrUm93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51bkNoZWNrUm93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JTdWJqZWN0Lm5leHQoYOacquaJvuWIsElE5Li6JHtpZH3nmoTmlbDmja7jgIJgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JTdWJqZWN0Lm5leHQoYOWPguaVsGlkIOS4jeiDveS4uuepuuOAgmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjaGVja1Jvdyhyb3dJbmRleDogbnVtYmVyLCByb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgY29uc3QgY2hlY2tlZHMgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXTtcclxuICAgICAgICBpZiAoaWQgJiYgIXRoaXMuaXNSb3dDaGVja2VkKGlkLCBjaGVja2VkcykpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQsIGRhdGE6IHJvd0RhdGEsIGluZGV4OiByb3dJbmRleCB9O1xyXG4gICAgICAgICAgICBjaGVja2Vkcy5wdXNoKHNyb3cpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IGNoZWNrZWRzO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNlbGVjdE9uQ2hlY2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jaGVja1Jvd1N1YmplY3QubmV4dChzcm93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdW5DaGVja1Jvdyhyb3dJbmRleDogbnVtYmVyLCByb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgIGxldCBjaGVja2VkcyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLmlzUm93Q2hlY2tlZChpZCwgY2hlY2tlZHMpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkLCBkYXRhOiByb3dEYXRhLCBpbmRleDogcm93SW5kZXggfTtcclxuICAgICAgICAgICAgY2hlY2tlZHMgPSBjaGVja2Vkcy5maWx0ZXIoc3IgPT4gJycgKyBzci5pZCAhPT0gJycgKyBpZCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gY2hlY2tlZHM7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2VsZWN0T25DaGVjaykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudW5DaGVja1Jvd1N1YmplY3QubmV4dChzcm93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q3VycmVudFBhZ2VEYXRhKGRhdGE6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmN1cnJlbnRQYWdlRGF0YSA9IGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VycmVudFBhZ2VEYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jdXJyZW50UGFnZURhdGEgfHwgW107XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKiDojrflj5bmiYDmnInlj6/ku6Xmk43kvZznmoTooYwgKi9cclxuICAgIHByaXZhdGUgZ2V0QWxsUm93c0ZvckxpdmUoKSB7XHJcbiAgICAgICAgbGV0IGFsbERhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhIHx8IFtdO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUucGFnaW5hdGlvbiAmJiAhdGhpcy5fc3RhdGUucGFnZXJPblNlcnZlcikge1xyXG4gICAgICAgICAgICAvLyDojrflj5blvZPliY3pobXmlbDmja5cclxuICAgICAgICAgICAgYWxsRGF0YSA9IHRoaXMuZ2V0Q3VycmVudFBhZ2VEYXRhKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDmjpLpmaTmjonnpoHnlKjnmoTooYxcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZGlzYWJsZVJvdykge1xyXG4gICAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5maWx0ZXIoKG4sIGkpID0+ICF0aGlzLl9zdGF0ZS5kaXNhYmxlUm93KG4sIGkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFsbERhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXTtcclxuICAgICAgICBjb25zdCBhbGxEYXRhID0gdGhpcy5nZXRBbGxSb3dzRm9yTGl2ZSgpO1xyXG4gICAgICAgIGNvbnN0IGFsbENoZWNrZWRzID0gYWxsRGF0YS5tYXAoIChyLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5wcmltYXJ5SWQociksXHJcbiAgICAgICAgICAgICAgICBpbmRleDogaSxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBhbGxDaGVja2VkcztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBfY2hlY2tlZHMgPSBbXTtcclxuICAgICAgICAgICAgYWxsQ2hlY2tlZHMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MuZmluZChuID0+IG4uaWQgPT0gZWxlbWVudC5pZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBfY2hlY2tlZHMucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmNvbmNhdChfY2hlY2tlZHMpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zZWxlY3RPbkNoZWNrICYmICF0aGlzLl9zdGF0ZS5vbmx5U2VsZWN0U2VsZikge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBhbGxEYXRhLm1hcCggKHIsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMucHJpbWFyeUlkKHIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiBpLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHJcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jaGVja0FsbFN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0QWxsKCkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgY29uc3QgYWxsRGF0YSA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKTtcclxuXHJcbiAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IGFsbERhdGEubWFwKCAociwgaSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMucHJpbWFyeUlkKHIpLFxyXG4gICAgICAgICAgICAgICAgaW5kZXg6IGksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gYWxsRGF0YS5tYXAoIChyLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLnByaW1hcnlJZChyKSxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0QWxsU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRSb3coaWQpOiB7aW5kZXg6IG51bWJlciwgZGF0YTogYW55fSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmRhdGEgJiYgdGhpcy5fc3RhdGUuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGluZGV4ID0gLTE7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9zdGF0ZS5kYXRhLmZpbmQoIChuLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5wcmltYXJ5SWQobikgPT0gaWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHtpbmRleCwgZGF0YX07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRSb3dJbmRleChpZCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5kYXRhICYmIHRoaXMuX3N0YXRlLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5kYXRhLmZpbmRJbmRleChuID0+IHRoaXMucHJpbWFyeUlkKG4pID09PSBpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u6YCJ5Lit6KGM77yM5LiN6Kem5Y+RZ3JpZCDpgInkuK3kuovku7bvvIzlj5bmtojpgInkuK3kuovku7ZcclxuICAgICAqL1xyXG4gICAgc2V0U2VsZWN0Um93KGlkOiBzdHJpbmcsIHNlbGVjdCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgIGNvbnN0IHtpbmRleDogcm93SW5kZXgsIGRhdGE6IHJvd0RhdGF9ID0gey4uLnJvd307XHJcbiAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQsIGRhdGE6IHJvd0RhdGEsIGluZGV4OiByb3dJbmRleCB9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pc011bHRpU2VsZWN0KCkpIHtcclxuICAgICAgICAgICAgaWYgKHNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSb3dGb3JNdWx0aShzcm93LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93Rm9yTXVsdGkoc3JvdywgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBfc3IgPSBzZWxlY3QgPyBzcm93IDogbnVsbDtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudFJvdzogX3NyfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdFJlY29yZChpZDogYW55LCBzZWxlY3QgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKGlkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuZmluZFJvdyhpZCk7XHJcbiAgICAgICAgICAgIGlmIChyb3cpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHtpbmRleDogcm93SW5kZXgsIGRhdGE6IHJvd0RhdGF9ID0gey4uLnJvd307XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSb3cocm93SW5kZXgsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JTdWJqZWN0Lm5leHQoYOacquaJvuWIsElE5Li6JHtpZH3nmoTmlbDmja7jgIJgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JTdWJqZWN0Lm5leHQoYOWPguaVsGlkIOS4jeiDveS4uuepuuOAgmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RSb3cocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaXNNdWx0aVNlbGVjdCA9IHRoaXMuaXNNdWx0aVNlbGVjdCgpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5wcmltYXJ5SWQocm93RGF0YSk7XHJcbiAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQsIGRhdGE6IHJvd0RhdGEsIGluZGV4OiByb3dJbmRleCB9O1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNSb3dTZWxlY3RlZChpZCkgfHwgIXRoaXMuX3N0YXRlLmN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgaWYgKCFpc011bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudFJvdzogc3JvdyB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJvd1N1YmplY3QubmV4dCh0aGlzLl9zdGF0ZS5jdXJyZW50Um93KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2hvd0NoZWNrYm94ICYmIHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IFsgc3JvdyBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJvd0Zvck11bHRpKHNyb3cpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0Um93Rm9yTXVsdGkoc3JvdzogeyBpZDogYW55LCBkYXRhOiBhbnksIGluZGV4OiBhbnkgfSwgZW1pdCA9IHRydWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUub25seVNlbGVjdFNlbGYpIHtcclxuICAgICAgICAgICAgdGhpcy5fY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjdXJyZW50Um93OiBzcm93LCBzZWxlY3Rpb25zOiBbc3Jvd10gfSwgZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zIHx8IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5maWx0ZXIoc3IgPT4gc3IuaWQgIT09IHNyb3cuaWQpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zLnB1c2goc3Jvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlbWl0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja1Jvdyhzcm93LmluZGV4LCBzcm93LmRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVuU2VsZWN0Um93Rm9yTXVsdGkoc3JvdzogeyBpZDogYW55LCBkYXRhOiBhbnksIGluZGV4OiBhbnkgfSwgZW1pdCA9IHRydWUpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5maWx0ZXIoc3IgPT4gc3IuaWQgIT09IHNyb3cuaWQpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fY2FuQ2FuY2VsU2VsZWN0V2hlbk11bHRpKCkgfHwgKHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cgJiYgdGhpcy5fc3RhdGUuY3VycmVudFJvdy5pZCA9PT0gc3Jvdy5pZCkpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IG51bGwgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY2hlY2tPblNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLnVuQ2hlY2tSb3coc3Jvdy5pbmRleCwgc3Jvdy5kYXRhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChlbWl0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5TZWxlY3RSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICB1blNlbGVjdFJvdyhyb3dJbmRleDogbnVtYmVyLCByb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgIGNvbnN0IGlzTXVsdGlTZWxlY3QgPSB0aGlzLmlzTXVsdGlTZWxlY3QoKTtcclxuICAgICAgICBjb25zdCBzcm93ID0ge2lkLCBpbmRleDogcm93SW5kZXgsIGRhdGE6IHJvd0RhdGF9O1xyXG4gICAgICAgIGlmICghaXNNdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IG51bGwgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNob3dDaGVja2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5DaGVja1Jvdyhzcm93LmluZGV4LCBzcm93LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvd0Zvck11bHRpKHNyb3cpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jYW5DYW5jZWxTZWxlY3RXaGVuTXVsdGkoKSB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLl9zdGF0ZS5rZWVwU2VsZWN0ICYmIHRoaXMuX3N0YXRlLm9ubHlTZWxlY3RTZWxmO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NsZWFyU2VsZWN0aW9ucyhleGNsdWRlSWRzPzogc3RyaW5nW10pIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5jdXJyZW50Um93ID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKCFleGNsdWRlSWRzIHx8ICFleGNsdWRlSWRzLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zLmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBleGNsdWRlSWRzLmZpbmRJbmRleChpID0+IGkgPT0gbi5pZCkgPiAtMTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NsZWFyQ2hlY2tlZHMocm93cyA9IFtdKSB7XHJcbiAgICAgICAgaWYgKCFyb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IFtdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MuZmlsdGVyKG4gPT4gcm93cy5maW5kSW5kZXgociA9PiB0aGlzLnByaW1hcnlJZChyKSA9PT0gbi5pZCkgPT0gLTEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNlbGVjdGlvbnMoZXhjbHVkZUlkcz86IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgY29uc3Qgcm93cyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnM7XHJcbiAgICAgICAgZXhjbHVkZUlkcyA9IGV4Y2x1ZGVJZHMgfHwgW107XHJcbiAgICAgICAgdGhpcy5fY2xlYXJTZWxlY3Rpb25zKGV4Y2x1ZGVJZHMpO1xyXG4gICAgICAgIGNvbnN0IHVuQ2hlY2tSb3dzID0gcm93cy5maWx0ZXIobiA9PiBleGNsdWRlSWRzLmZpbmRJbmRleChpID0+IGkgPT0gbi5pZCkgPT0gLTEpO1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0IHx8ICghdGhpcy5fc3RhdGUubXVsdGlTZWxlY3QgJiYgdGhpcy5fc3RhdGUuc2hvd0NoZWNrYm94KSkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IFtdO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJqZWN0Lm5leHQocm93cyk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFyb3dzLmZpbmQodDEgPT4gdDEuaWQgPT0gbi5pZCAmJiBleGNsdWRlSWRzLmZpbmRJbmRleChpID0+IGkgPT0gbi5pZCkgPT0gLTEpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5jbGVhckNoZWNrZWRzU3ViamVjdC5uZXh0KHVuQ2hlY2tSb3dzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvblN1YmplY3QubmV4dCh1bkNoZWNrUm93cyk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJDaGVja2VkcyhjbGVhckFsbCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCByb3dzID0gdGhpcy5nZXRBbGxSb3dzRm9yTGl2ZSgpO1xyXG4gICAgICAgIGNvbnN0IF9yb3dzID0gY2xlYXJBbGwgPyBbXSA6IHJvd3M7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJDaGVja2Vkcyhfcm93cyk7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNlbGVjdE9uQ2hlY2spIHtcclxuICAgICAgICAgICB0aGlzLl9jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jbGVhckNoZWNrZWRzU3ViamVjdC5uZXh0KHJvd3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyQWxsKCkge1xyXG4gICAgICAgIHRoaXMuX2NsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICB0aGlzLl9jbGVhclNlbGVjdGlvbnMoKTtcclxuICAgICAgICB0aGlzLmNsZWFyQWxsU3ViamVjdC5uZXh0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TXVsdGlTZWxlY3QoZmxhZzogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLm11bHRpU2VsZWN0ID0gZmxhZztcclxuICAgIH1cclxuXHJcbiAgICBzZXRDaGVja09uU2VsZWN0KGZsYWc6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0ID0gZmxhZztcclxuICAgIH1cclxuXHJcbiAgICBzZXRTZWxlY3RPbkNoZWNrKGZsYWc6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3RPbkNoZWNrID0gZmxhZztcclxuICAgIH1cclxuXHJcbiAgICBzZXRDdXJyZW50Q2VsbChkcjogRGF0YWdyaWRSb3csIGZpZWxkOiBzdHJpbmcsIGNlbGxFbGVtZW50PzogYW55LCBjZWxsUmVmPzogYW55ICkge1xyXG4gICAgICAgIGNvbnN0IHsgcm93SW5kZXgsIHJvd0RhdGEgfSA9IHsuLi5kcn07XHJcbiAgICAgICAgbGV0IGN1cnJlbnRDZWxsID0gey4uLnRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsLCByb3dJbmRleCwgcm93RGF0YSwgZmllbGQsIHJvd0lkOiB0aGlzLnByaW1hcnlJZChyb3dEYXRhKSwgY2VsbEVsZW1lbnQgfTtcclxuXHJcbiAgICAgICAgaWYgKGZpZWxkICE9PSB0aGlzLl9zdGF0ZS5Db250cm9sUGFuZWxGZWlsZCkge1xyXG4gICAgICAgICAgICBpZiAoY2VsbFJlZikge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENlbGwuY2VsbFJlZiA9IGNlbGxSZWY7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENlbGwuY29sdW1uID0gdGhpcy5nZXRDb2x1bW4oZmllbGQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBpc0xhc3RSb3cgPSByb3dJbmRleCA9PT0gdGhpcy5nZXREYXRhKCkubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgY3VycmVudENlbGxbJ2xhc3RSb3cnXSA9IGlzTGFzdFJvdztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjdXJyZW50Q2VsbCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2N1cnJlbnRDZWxsfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudFJvdykge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jdXJyZW50Um93LmRyID0gZHI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VsZWN0Q2VsbFN1YmplY3QubmV4dChjdXJyZW50Q2VsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsU2VsZWN0Q2VsbCgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7Y3VycmVudENlbGw6IG51bGx9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbFN1YmplY3QubmV4dChudWxsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpbWFyeUlkKHJvd0RhdGE6IGFueSkge1xyXG4gICAgICAgIHJldHVybiByb3dEYXRhW3RoaXMuX3N0YXRlLmlkRmllbGRdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEN1cnJlbnRDZWxsKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbDtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0Q2VsbCgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbC5pc0VkaXRpbmcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNlaSA9IHsgLi4udGhpcy5fc3RhdGUuY3VycmVudENlbGwsIGlzRWRpdGluZzogdHJ1ZSB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRDZWxsOiBjZWkgfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsU3ViamVjdC5uZXh0KGNlaSk7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmVkaXRDZWxsJC5uZXh0KGNlaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZW5kRWRpdENlbGwoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsICYmIHRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsLmlzRWRpdGluZykge1xyXG4gICAgICAgICAgICBjb25zdCBjZWkgPSB7IC4uLnRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsLCBpc0VkaXRpbmc6IGZhbHNlIH07XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjdXJyZW50Q2VsbDogY2VpIH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsU3ViamVjdC5uZXh0KGNlaSk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZWRpdENlbGwkLm5leHQoY2VpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXBwZW5kUm93KHJvd0RhdGE6IGFueSkge1xyXG4gICAgICAgIGlmIChyb3dEYXRhICYmIHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5maW5kUm93SW5kZXgocGlkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLmRhdGEucHVzaChyb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSBbLi4udGhpcy5fc3RhdGUuZGF0YV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtkYXRhOiBuZXdEYXRhfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvd0FwcGVuZCQuZW1pdChyb3dEYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5Li76ZSuSUQg5bey5a2Y5Zyo77yBSUQ6ICR7cGlkfWApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuLvplK7moIfor4blrZfmrrXkuI3og73kuLrnqbrjgIJgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlUm93KHJvd2lkOiBhbnksIHJvd0RhdGE6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuZmluZFJvdyhyb3dpZCk7XHJcbiAgICAgICAgaWYgKHJvdyAmJiByb3cuZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAocm93RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAga2V5cy5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlscy5zZXRWYWx1ZShmaWVsZCwgcm93RGF0YVtmaWVsZF0sIHJvdy5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw5bey5Yu+6YCJ55qE5pWw5o2uXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNoZWNrZWREYXRhKHJvd2lkLCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucm93VXBkYXRlJC5lbWl0KHJvdyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ2FuIG5vdCBmb3VuZCByb3dpZDogJyArIHJvd2lkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbih0aGlzLmZpbmRSb3coaWQpLCByb3cpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZVJvdyhyb3dpZCkge1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuZmluZFJvdyhyb3dpZCk7XHJcbiAgICAgICAgaWYgKHJvdykge1xyXG4gICAgICAgICAgICBjb25zdCBuZXdEYXRhID0gdGhpcy5yZW1vdmVSb3codGhpcy5fc3RhdGUuZGF0YSwgcm93aWQpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtkYXRhOiBuZXdEYXRhfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICB0aGlzLnJvd0RlbGV0ZSQuZW1pdChyb3dpZCk7XHJcbiAgICAgICAgICAgIHJldHVybiByb3c7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0NhbiBub3QgZm91bmQgcm93IGJ5IElEOicgKyByb3dpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDku47mlbDnu4TkuK3liKDpmaTmjIflrprnmoRJRFxyXG4gICAgICogQHBhcmFtIGRhdGEg5pWw57uEXHJcbiAgICAgKiBAcGFyYW0gcm93SWQg6KaB5Yig6Zmk55qESURcclxuICAgICAqL1xyXG4gICAgcmVtb3ZlUm93KGRhdGEsIHJvd0lkKSB7XHJcbiAgICAgICAgY29uc3QgbmV3RGF0YSA9IGRhdGEuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKG4pO1xyXG4gICAgICAgICAgICByZXR1cm4gcm93SWQgIT09IGlkO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3RGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBpc0NlbGxTZWxlY3RlZChjZWxsSW5mbzogQ2VsbEluZm8pIHtcclxuICAgICAgICBjb25zdCBjYyA9IHRoaXMuZ2V0Q3VycmVudENlbGwoKTtcclxuICAgICAgICBpZiAoIWNjKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cuaW5kZXggPT09IGNjLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2MuZmllbGQgPT09IGNlbGxJbmZvLmZpZWxkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHVwZGF0ZVN0YXRlKHN0YXRlOiBQYXJ0aWFsPEZhcnJpc0RhdGFncmlkU3RhdGU+LCBlbWl0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0geyAuLi50aGlzLl9zdGF0ZSwgLi4uc3RhdGUgfTtcclxuICAgICAgICB0aGlzLl9zdGF0ZSA9IG5ld1N0YXRlO1xyXG4gICAgICAgIGlmIChlbWl0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmUubmV4dCh0aGlzLl9zdGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlc2l6ZShuZXdTaXplPzoge3dpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBba2V5OiBzdHJpbmddOiBhbnl9KSB7XHJcbiAgICAgICAgaWYgKG5ld1NpemUpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZShuZXdTaXplLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVzZXRDb2x1bW5zU2l6ZSgpO1xyXG4gICAgICAgIGlmICghdGhpcy5fc3RhdGUuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKHRoaXMuX3N0YXRlLnZpcnR1YWwuc2Nyb2xsVG9wKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZml0Q29sdW1ucyhmaXQpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtmaXRDb2x1bW5zOiBmaXR9LCBmYWxzZSk7XHJcbiAgICAgICAgLy8gY29uc3QgciA9IHRoaXMudXNlVXNlclNldENvbHVtblNpemUoKTtcclxuICAgICAgICAvLyB0aGlzLnNldEZpdENvbHVtbnNXaWR0aCh0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXAsIHRydWUsIHIpO1xyXG4gICAgICAgIC8vIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgICAgIHRoaXMucmVzZXRDb2x1bW5zU2l6ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXNlVXNlclNldENvbHVtblNpemUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmF1dG9GaXRDb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyaWRXaWR0aCA9IHRoaXMuX3N0YXRlLndpZHRoO1xyXG4gICAgICAgICAgICBjb25zdCB1c2VyU2V0Q29sdW1uV2lkdGggPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXAub3JpZ2luYWxUb3RhbFdpZHRoO1xyXG4gICAgICAgICAgICByZXR1cm4gdXNlclNldENvbHVtbldpZHRoID4gZ3JpZFdpZHRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZXNldENvbHVtbnNTaXplKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5maXRDb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIC8vIDIwMjAwNDIxXHJcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLnVzZVVzZXJTZXRDb2x1bW5TaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Rml0Q29sdW1uc1dpZHRoKHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cCwgciwgcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pu05paw5YiX6K6+572uXHJcbiAgICAgKiBAcGFyYW0gY29sdW1ucyDmlrDnmoTliJfpm4blkIhcclxuICAgICAqIEBwYXJhbSByZXN0aXR1dGUg5piv5ZCm6L+Y5Y6f5Yid5aeL5a695bqmIOm7mOiupOS4uiBmYWxzZVxyXG4gICAgICovXHJcbiAgICB1cGRhdGVDb2x1bW5zKGNvbHVtbnMsIHJlc3RpdHV0ZSA9IGZhbHNlLCBlbWl0ID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5jb2x1bW5zID0gY29sdW1ucztcclxuICAgICAgICB0aGlzLmluaXRDb2x1bW5zKGVtaXQsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgdGhpcy5yZXNpemVDb2x1bW5zKHJlc3RpdHV0ZSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGluaXRDb2x1bW5zKGVtaXQgPSBmYWxzZSwgcmVzdENvbHVtbldpZHRoID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcbiAgICAgICAgbGV0IGNvbGdyb3VwOiBhbnkgPSB7XHJcbiAgICAgICAgICAgIGxlZnRGaXhlZDogW10sXHJcbiAgICAgICAgICAgIHJpZ2h0Rml4ZWQ6IFtdLFxyXG4gICAgICAgICAgICBub3JtYWxDb2x1bW5zOiBbXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGNvbHVtbnMgJiYgY29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbGVmdEZpeGVkQ29scyA9IHRoaXMuZ2V0Rml4ZWRDb2xzKCdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0Rml4ZWRDb2xzID0gdGhpcy5nZXRGaXhlZENvbHMoJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vcm1hbENvbHMgPSB0aGlzLmdldEZpeGVkQ29scygpO1xyXG5cclxuICAgICAgICAgICAgY29sdW1ucy5mb3JFYWNoKGMgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjLm9yaWdpbmFsV2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjLm9yaWdpbmFsV2lkdGggPSBjLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbGdyb3VwID0ge1xyXG4gICAgICAgICAgICAgICAgbGVmdEZpeGVkOiBsZWZ0Rml4ZWRDb2xzLFxyXG4gICAgICAgICAgICAgICAgcmlnaHRGaXhlZDogcmlnaHRGaXhlZENvbHMsXHJcbiAgICAgICAgICAgICAgICBub3JtYWxDb2x1bW5zOiBub3JtYWxDb2xzXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLmluaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIHJlc3RDb2x1bW5XaWR0aCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuZml0Q29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY29sdW1uc0dyb3VwOiBjb2xncm91cCB9LCBlbWl0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IDA7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLnJpZ2h0Rml4ZWRXaWR0aCA9IDA7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLm5vcm1hbFdpZHRoID0gMDtcclxuICAgICAgICAgICAgY29sZ3JvdXAudG90YWxXaWR0aCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjb2x1bW5zR3JvdXA6IGNvbGdyb3VwIH0sIGVtaXQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRDb2x1bW5JbmRleChmaWVsZDogc3RyaW5nLCBmaXhlZDogJ3JpZ2h0J3wgJycgfCAnbGVmdCcgPSAnJykge1xyXG4gICAgICAgIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG4gICAgICAgIGlmICghZml4ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbGdyb3VwLm5vcm1hbENvbHVtbnMuZmluZEluZGV4KG4gPT4gbi5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChmaXhlZCA9PT0gJ2xlZnQnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sZ3JvdXAubGVmdEZpeGVkLmZpbmRJbmRleChuID0+IG4uZmllbGQgPT09IGZpZWxkKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChmaXhlZCA9PT0gJ3JpZ2h0Jykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbGdyb3VwLnJpZ2h0Rml4ZWQuZmluZEluZGV4KG4gPT4gbi5maWVsZCA9PT0gZmllbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbHVtblJlc2l6ZUVuZCgpIHtcclxuICAgICAgICAvLyBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICAvLyB0aGlzLmluaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIGZhbHNlKTtcclxuICAgICAgICAvLyB0aGlzLnVwZGF0ZVN0YXRlKHsgY29sdW1uc0dyb3VwOiAgey4uLmNvbGdyb3VwfSB9LCBmYWxzZSk7XHJcbiAgICAgICAgLy8gdGhpcy5ncmlkU2l6ZVN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZSk7XHJcbiAgICAgICAgdGhpcy5yZXNpemVDb2x1bW5zKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJlc2l6ZUNvbHVtbnMocmVzdGl0dXRlID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICB0aGlzLmluaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmZpdENvbHVtbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMudXNlVXNlclNldENvbHVtblNpemUoKTtcclxuICAgICAgICAgICAgaWYgKHIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCByZXN0aXR1dGUsIHIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGaXRDb2x1bW5zV2lkdGgoY29sZ3JvdXAsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGNvbHVtbnNHcm91cDogIHsuLi5jb2xncm91cH0gfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEFsbEZsYXRDb2x1bW5zKCkge1xyXG4gICAgICAgIHJldHVybiBmbGF0dGVuPERhdGFDb2x1bW4+KHRoaXMuX3N0YXRlLmNvbHVtbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvbHVtbihmaWVsZE5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsbEZsYXRDb2x1bW5zKCkuZmluZChuID0+IG4uZmllbGQgPT09IGZpZWxkTmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Rml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwOiBDb2x1bW5Hcm91cCwgcmVzdGl0dXRlID0gZmFsc2UsIHVzZVVzZXJTZXRDb2x1bW5TaXplID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoIWNvbGdyb3VwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSB0aGlzLl9zdGF0ZS53aWR0aCAtIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoIC0gY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoO1xyXG5cclxuICAgICAgICBpZiAoIWNvbGdyb3VwLm5vcm1hbFdpZHRoIHx8IGNvbGdyb3VwLm5vcm1hbFdpZHRoIDwgMCApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICh1c2VVc2VyU2V0Q29sdW1uU2l6ZSkge1xyXG4gICAgICAgICAgICBjb2xncm91cC50b3RhbFdpZHRoID0gY29sZ3JvdXAub3JpZ2luYWxUb3RhbFdpZHRoO1xyXG4gICAgICAgICAgICBpZiAocmVzdGl0dXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjb2xncm91cC5ub3JtYWxDb2x1bW5zLmZvckVhY2goIGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLndpZHRoID0gY29sLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDmm7TmlrAgbm9ybWFsQ29sdW1ucyB3aWR0aFxyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IGNvbGdyb3VwLm5vcm1hbENvbHVtbnMucmVkdWNlKCh0b3RhbFdpZHRoLCBjb2wpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdGl0dXRlICYmIGNvbC53aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbFdpZHRoICs9IGNvbC53aWR0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsV2lkdGggKz0gY29sLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgY29sZ3JvdXAudG90YWxXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoICsgY29sZ3JvdXAubm9ybWFsV2lkdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgbWluV2lkdGggPSBjb2xncm91cC5ub3JtYWxDb2x1bW5zLnJlZHVjZSgodG90YWxXaWR0aCwgY29sKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3RpdHV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbFdpZHRoICs9IGNvbC53aWR0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsV2lkdGggKz0gY29sLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSBjb2xncm91cC5ub3JtYWxXaWR0aCAtIDI7XHJcblxyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxDb2x1bW5zLmZvckVhY2goIGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3RpdHV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbC53aWR0aCA9IE1hdGguZmxvb3IoIGNvbC53aWR0aCAvIG1pbldpZHRoICogY29sZ3JvdXAubm9ybWFsV2lkdGggKTtcclxuICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGggPSBOdW1iZXIoKGNvbC53aWR0aCAvIG1pbldpZHRoICogY29sZ3JvdXAubm9ybWFsV2lkdGggKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29sLndpZHRoID0gTWF0aC5mbG9vciggY29sLm9yaWdpbmFsV2lkdGggLyBtaW5XaWR0aCAqIGNvbGdyb3VwLm5vcm1hbFdpZHRoICk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLndpZHRoID0gIE51bWJlcigoIGNvbC5vcmlnaW5hbFdpZHRoIC8gbWluV2lkdGggKiBjb2xncm91cC5ub3JtYWxXaWR0aCApLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29sZ3JvdXAudG90YWxXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoICsgY29sZ3JvdXAubm9ybWFsV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEZpeGVkQ29scyhkaXJlY3Rpb246ICdsZWZ0JyB8ICdyaWdodCcgfCAnJyA9ICcnKSB7XHJcbiAgICAgICAgbGV0IGNvbHMgPSBbXTtcclxuICAgICAgICBpZiAoIWRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICBjb2xzID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnMuZmlsdGVyKGNvbCA9PiAhY29sLmZpeGVkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2xzID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnMuZmlsdGVyKGNvbCA9PiBjb2wuZml4ZWQgPT09IGRpcmVjdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlpJrooajlpLTvvIzph43mlrDorqHnrpfliJfnmoTpobrluo9cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY29sdW1ucy5sZW5ndGggPiAxICYmIGNvbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IERhdGFncmlkQ29sdW1uc0hlbHBlci5nZXRGaWVsZHModGhpcy5fc3RhdGUuY29sdW1ucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld2NvbHMgPSBbXTtcclxuICAgICAgICAgICAgZmllbGRzLmZvckVhY2goZiA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjID0gIGNvbHMuZmluZChjb2wgPT4gKGNvbC5maWVsZCB8fCAnJyApID09PSBmKTtcclxuICAgICAgICAgICAgICAgIGlmIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3Y29scy5wdXNoKGMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ld2NvbHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY29scztcclxuICAgIH1cclxuXHJcbiAgICAvLyByZXN0aXR1dGU6IOi/mOWOn+WIneWni+WuveW6pu+8jOm7mOiupCBmYWxzZVxyXG4gICAgcHJpdmF0ZSBpbml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwOiBDb2x1bW5Hcm91cCwgIHJlc3RpdHV0ZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgbGV0IG9mZnNldCA9IDA7XHJcbiAgICAgICAgb2Zmc2V0ID0gdGhpcy5fc3RhdGUuc2hvd0xpbmVOdW1iZXIgPyBvZmZzZXQgKyB0aGlzLl9zdGF0ZS5saW5lTnVtYmVyV2lkdGggOiBvZmZzZXQ7XHJcbiAgICAgICAgb2Zmc2V0ID0gdGhpcy5fc3RhdGUuc2hvd0NoZWNrYm94ID8gb2Zmc2V0ICsgdGhpcy5fc3RhdGUuY2hlY2tib3hDb2x1bW5XaWR0aCA6IG9mZnNldDtcclxuXHJcbiAgICAgICAgY29uc3QgZ2V0Q29sc1dpZHRoID0gKGNvbHMsIHZhbCwgcmVzZXQpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbHMucmVkdWNlKChyLCBjKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjLmxlZnQgPSByO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByICsgYy53aWR0aDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgKyBjLm9yaWdpbmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHZhbCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSBvZmZzZXQ7XHJcbiAgICAgICAgaWYgKGNvbGdyb3VwLmxlZnRGaXhlZCAmJiBjb2xncm91cC5sZWZ0Rml4ZWQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gZ2V0Q29sc1dpZHRoKGNvbGdyb3VwLmxlZnRGaXhlZCwgb2Zmc2V0LCByZXN0aXR1dGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoID0gMDtcclxuICAgICAgICBpZiAoY29sZ3JvdXAucmlnaHRGaXhlZCAmJiBjb2xncm91cC5yaWdodEZpeGVkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggPSBnZXRDb2xzV2lkdGgoY29sZ3JvdXAucmlnaHRGaXhlZCwgMCwgcmVzdGl0dXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbGdyb3VwLm5vcm1hbFdpZHRoID0gMDtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY29sdW1ucyAmJiB0aGlzLl9zdGF0ZS5jb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IGdldENvbHNXaWR0aChjb2xncm91cC5ub3JtYWxDb2x1bW5zLCAwLCByZXN0aXR1dGUpO1xyXG4gICAgICAgICAgICBjb2xncm91cC5vcmlnaW5hbFRvdGFsV2lkdGggPSBnZXRDb2xzV2lkdGgoY29sZ3JvdXAubm9ybWFsQ29sdW1ucywgMCwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb2xncm91cC50b3RhbFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggKyBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggKyBjb2xncm91cC5ub3JtYWxXaWR0aDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0NoZWNrYm94KGlzU2hvdyA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtzaG93Q2hlY2tib3g6IGlzU2hvd30sIGZhbHNlKTtcclxuICAgICAgICBpZiAoaXNTaG93KSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggKyB0aGlzLl9zdGF0ZS5jaGVja2JveENvbHVtbldpZHRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggLSB0aGlzLl9zdGF0ZS5jaGVja2JveENvbHVtbldpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb2x1bW5SZXNpemVTdWJqZWN0Lm5leHQoY29sZ3JvdXApO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVDaGVja2JveCgpIHtcclxuICAgICAgICB0aGlzLnNob3dDaGVja2JveChmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0xpbmVOdW1iZXIoaXNTaG93ID0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGNvbGdyb3VwID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe3Nob3dMaW5lTnVtYmVyOiBpc1Nob3d9LCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKGlzU2hvdykge1xyXG4gICAgICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgdGhpcy5fc3RhdGUubGluZU51bWJlcldpZHRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggLSB0aGlzLl9zdGF0ZS5saW5lTnVtYmVyV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbHVtblJlc2l6ZVN1YmplY3QubmV4dChjb2xncm91cCk7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZUxpbmVOdW1iZXIoKSB7XHJcbiAgICAgICAgdGhpcy5zaG93TGluZU51bWJlcihmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U29ydEluZm8oc29ydE5hbWUsIHNvcnRPcmRlcikge1xyXG4gICAgICAgIHNvcnROYW1lID0gc29ydE5hbWUgfHwgJyc7XHJcbiAgICAgICAgc29ydE9yZGVyID0gc29ydE9yZGVyIHx8ICcnO1xyXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHNvcnROYW1lLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJzID0gc29ydE9yZGVyLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgLy8gaWYgKCF0aGlzLl9zdGF0ZS5tdWx0aVNvcnQpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuXHJcbiAgICAgICAgY29uc3QgdXBkYXRlRmllbGRPcmRlciA9IChjb2xzOiBEYXRhQ29sdW1uW10pID0+IHtcclxuICAgICAgICAgICAgaWYgKCFjb2xzIHx8ICFjb2xzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbHMuZm9yRWFjaCggY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbC5vcmRlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBmaWVsZHMuZmluZEluZGV4KGYgPT4gZiA9PT0gY29sLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2wub3JkZXIgPSBvcmRlcnNbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHVwZGF0ZUZpZWxkT3JkZXIoY29sZ3JvdXAubm9ybWFsQ29sdW1ucyk7XHJcbiAgICAgICAgdXBkYXRlRmllbGRPcmRlcihjb2xncm91cC5sZWZ0Rml4ZWQpO1xyXG4gICAgICAgIHVwZGF0ZUZpZWxkT3JkZXIoY29sZ3JvdXAucmlnaHRGaXhlZCk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtzb3J0TmFtZSwgc29ydE9yZGVyfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIG9yZGVyQnkoYXJyLCBwcm9wczogYW55W10sIG9yZGVyczogYW55W10pIHtcclxuICAgICAgICBjb25zdCBjb2xPYmogPSBwcm9wcy5yZWR1Y2UoKGMsIG4pID0+IHtcclxuICAgICAgICAgICAgY1tuXSA9IHRoaXMuZ2V0Q29sdW1uKG4pO1xyXG4gICAgICAgICAgICByZXR1cm4gYztcclxuICAgICAgICB9LCB7fSk7XHJcblxyXG4gICAgICAgIHJldHVybiBbLi4uYXJyXS5zb3J0KChhLCBiKSA9PlxyXG4gICAgICAgICAgICBwcm9wcy5yZWR1Y2UoKGFjYywgcHJvcCwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjYyA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB2YWxBID0gVXRpbHMuZ2V0VmFsdWUocHJvcCwgYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbEIgPSBVdGlscy5nZXRWYWx1ZShwcm9wLCBiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbE9ialtwcm9wXSAmJiBjb2xPYmpbcHJvcF1bJ2lzTXVsdGlsaW5ndWFsRmllbGQnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxBID0gVXRpbHMuZ2V0TXVsdGlsaW5ndWFsVmFsdWUodmFsQSwgdGhpcy5sb2NhbElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsQiA9IFV0aWxzLmdldE11bHRpbGluZ3VhbFZhbHVlKHZhbEIsIHRoaXMubG9jYWxJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsQSA9PT0gdW5kZWZpbmVkIHx8IHZhbEEgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsQSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsQiA9PT0gdW5kZWZpbmVkIHx8IHZhbEIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsQiA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3AxLCBwMl0gPSBvcmRlcnMgJiYgb3JkZXJzW2ldID09PSAnZGVzYycgPyBbdmFsQiwgdmFsQV0gOiBbdmFsQSwgdmFsQl07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwMSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjID0gcDEubG9jYWxlQ29tcGFyZShwMik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjID0gcDEgPiBwMiA/IDEgOiBwMSA8IHAyID8gLTEgOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XHJcbiAgICAgICAgICAgIH0sIDApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzb3J0KGRhdGE6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IG9yZGVycyA9IHRoaXMuX3N0YXRlLnNvcnRPcmRlci5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuX3N0YXRlLnNvcnROYW1lLnNwbGl0KCcsJyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5tZXJnZUNlbGwgJiYgdGhpcy5fc3RhdGUubWVyZ2VGaWVsZHMgJiYgdGhpcy5fc3RhdGUubWVyZ2VGaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld09yZGVycyA9IFtdO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdGaWVsZHMgPSBbLi4udGhpcy5fc3RhdGUubWVyZ2VGaWVsZHNdO1xyXG4gICAgICAgICAgICBmaWVsZHMuZm9yRWFjaCgoZiwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGsgPSBuZXdGaWVsZHMuaW5kZXhPZihmKTtcclxuICAgICAgICAgICAgICAgIGlmIChrID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RmllbGRzLnB1c2goZik7XHJcbiAgICAgICAgICAgICAgICAgICAgayA9IG5ld0ZpZWxkcy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV3T3JkZXJzW2tdID0gb3JkZXJzW2ldO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9yZGVyQnkoZGF0YSwgbmV3RmllbGRzLCBuZXdPcmRlcnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3JkZXJCeShkYXRhLCBmaWVsZHMsIG9yZGVycyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNsaWVudFNvcnQoZGF0YT86IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGRhdGEgfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHNvcnRlZERhdGEgPSB0aGlzLnNvcnQodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoc29ydGVkRGF0YSwgZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJTb3J0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNsaWVudFNvcnQkLmVtaXQoe3NvcnROYW1lOiB0aGlzLl9zdGF0ZS5zb3J0TmFtZSwgc29ydE9yZGVyOiB0aGlzLl9zdGF0ZS5zb3J0T3JkZXJ9KTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNvcnQoKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkRmlsdGVyRGF0YShmaWx0ZXJEYXRhOiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMubG9hZERhdGEoZmlsdGVyRGF0YSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyNyZWdpb24g5Y+Y5pu06ZuGXHJcblxyXG4gICAgcHJpdmF0ZSBoYXNSb3dDaGFuZ2VzKHJvd2lkOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBfY2hhbmdlcyA9IHRoaXMuX3N0YXRlLmNoYW5nZXM7XHJcbiAgICAgICAgaWYgKCFfY2hhbmdlcykge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfY2hhbmdlc1tyb3dpZF07XHJcbiAgICB9XHJcblxyXG4gICAgYXBwZW5kQ2hhbmdlcyhjaGFuZ2VzOiBSb3dEYXRhQ2hhbmdlcykge1xyXG4gICAgICAgIGlmICghY2hhbmdlcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlkID0gY2hhbmdlc1t0aGlzLl9zdGF0ZS5pZEZpZWxkXTtcclxuICAgICAgICBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgX2lkID0gJycgKyBpZDtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzUm93Q2hhbmdlcyhfaWQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoYW5nZXMgPSB0aGlzLl9zdGF0ZS5jaGFuZ2VzIHx8IHt9O1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGFuZ2VzW19pZF0gPSBjaGFuZ2VzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoYW5nZXNbX2lkXSA9IE9iamVjdC5hc3NpZ24odGhpcy5fc3RhdGUuY2hhbmdlc1tfaWRdLCBjaGFuZ2VzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYWNjZXB0Q2hhbmdlcygpIHtcclxuICAgICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5fc3RhdGUuY2hhbmdlcztcclxuICAgICAgICBpZiAoY2hhbmdlcykge1xyXG4gICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICAgIGtleXMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJvdyhpZCwgY2hhbmdlc1tpZF0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlamVjdENoYW5nZXMocm93aWQgPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuX3N0YXRlLmNoYW5nZXM7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMpIHtcclxuICAgICAgICAgICAgaWYgKCFyb3dpZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuZGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hhbmdlcyA9IG51bGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb3dDaGFuZ2VzID0gIHRoaXMuX3N0YXRlLmNoYW5nZXNbJycgKyByb3dpZF07XHJcbiAgICAgICAgICAgICAgICBpZiAocm93Q2hhbmdlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9yZ2lSb3cgPSB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEuZmluZChyID0+IHRoaXMucHJpbWFyeUlkKHIpID09PSByb3dpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuZGF0YS5mb3JFYWNoKHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5SWQocikgPT09IHJvd2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gY2xvbmVEZWVwKG9yZ2lSb3cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRDaGFuZ2VzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jaGFuZ2VzO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZnJlc2goKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICB0aGlzLmxvYWREYXRhKGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5p6E6YCg5ZCI6K6h6KGMXHJcbiAgICAgKiBAcGFyYW0gZGF0YSDmlbDmja7pm4blkIhcclxuICAgICAqL1xyXG4gICAgZ2V0Rm9vdGVyRGF0YShkYXRhKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNob3dGb290ZXIpIHtcclxuICAgICAgICAgICAgLy8gY29uc3QgY29sdW1ucyA9IHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zO1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW5zID0gZmxhdHRlbjxEYXRhQ29sdW1uPih0aGlzLl9zdGF0ZS5jb2x1bW5zKS5maWx0ZXIoKGNvbDogRGF0YUNvbHVtbikgPT4gIWNvbC5jb2xzcGFuKTtcclxuICAgICAgICAgICAgY29uc3QgZm9vdGVyUm93ID0ge307XHJcblxyXG4gICAgICAgICAgICBjb2x1bW5zLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjb2wuZm9vdGVyICYmIGNvbC5mb290ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb2wuZm9vdGVyLm9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IG9wdGlvbnMudGV4dDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXAgPSBvcHRpb25zLmNhbGN1bGF0aW9uVHlwZSBhcyBDYWxjdWxhdGlvblR5cGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXAgIT09IHVuZGVmaW5lZCAmJiB0eXAgIT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gdGhpcy5jYWxjdWxhdGlvbihkYXRhLCB0eXAsIGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlclJvd1tjb2wuZmllbGRdID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlclJvd1tjb2wuZmllbGRdID0gdGV4dCB8fCAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvb3RlclJvd1tjb2wuZmllbGRdID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIFtmb290ZXJSb3ddO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcnJUb0dyb3VwKGl0ZW1zLCBmaWVsZHM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgZmlyc3QgPSBmaWVsZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgY29uc3QgZzEgPSBncm91cEJ5KGl0ZW1zLCAobikgPT4gVXRpbHMuZ2V0VmFsdWUoZmlyc3QsIG4pKTtcclxuICAgICAgICAgICAgdGhpcy50b0dyb3VwKGcxLCBmaWVsZHMpO1xyXG4gICAgICAgICAgICByZXR1cm4gZzE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdG9Hcm91cChnMSwgZmllbGRBcnIpIHtcclxuICAgICAgICBpZiAoZmllbGRBcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGcxKS5mb3JFYWNoKChrKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtcyA9IGcxW2tdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX25leHRGaWVsZHMgPSBmaWVsZEFyci5tYXAoKG4pID0+IG4pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX2YgPSBfbmV4dEZpZWxkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgZzFba10gPSBncm91cEJ5KGl0ZW1zLCAobikgPT4gVXRpbHMuZ2V0VmFsdWUoX2YsIG4pKTtcclxuICAgICAgICAgICAgICAgIGlmIChfbmV4dEZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvR3JvdXAoZzFba10sIF9uZXh0RmllbGRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ3JvdXBSb3dzMkZsYXQoZ3JvdXBSb3dzLCBpbml0TGV2ZWwsIHBhcmVudCkge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gW107XHJcbiAgICAgICAgaWYgKGluaXRMZXZlbCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGluaXRMZXZlbCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlkZmllbGQgPSB0aGlzLl9zdGF0ZS5pZEZpZWxkO1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fc3RhdGUuZGF0YTtcclxuICAgICAgICBjb25zdCBncm91cEZpZWxkQXJyID0gdGhpcy5fc3RhdGUuZ3JvdXBGaWVsZC5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGNvbnN0IHBpZCA9IHBhcmVudCA/IHBhcmVudFtpZGZpZWxkXSA6IG51bGw7XHJcbiAgICAgICAgY29uc3QgY29sc3BhbiA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cC5ub3JtYWxDb2x1bW5zLmxlbmd0aDtcclxuICAgICAgICBPYmplY3Qua2V5cyhncm91cFJvd3MpLmZvckVhY2goKGssIG0pID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwSXRlbSA9IHsgW2lkZmllbGRdOiBVdGlscy51dWlkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW0lTX0dST1VQX1JPV19GSUVMRF06IHRydWUsIFtHUk9VUF9MRVZFTF9GSUVMRF06IGluaXRMZXZlbCwgZGF0YTogeyB9LCB2YWx1ZTogayxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbR1JPVVBfVklTSUJMRV9GSUVMRF06IHRydWUsIGV4cGFuZGVkOiB0cnVlLCBmaWVsZDogZ3JvdXBGaWVsZEFycltpbml0TGV2ZWxdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHNwYW4sIHRvdGFsOiAwLCByb3dzOiBbXSwgW0dST1VQX1JPV19GSUVMRF06IHBpZH07XHJcblxyXG4gICAgICAgICAgICAvLyBURlM6IDM1Njk1NVxyXG4gICAgICAgICAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBncm91cEl0ZW0ucm93cyA9IHBhcmVudC5yb3dzLmZpbHRlcihuID0+ICFuW0lTX0dST1VQX1JPV19GSUVMRF0gJiZcclxuICAgICAgICAgICAgICAgICAgICAhbltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSAmJiAgVXRpbHMuZ2V0VmFsdWUoZ3JvdXBGaWVsZEFycltpbml0TGV2ZWxdLCBuKSA9PT0gayk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBncm91cEl0ZW0ucm93cyA9IGRhdGEuZmlsdGVyKG4gPT4gJycgKyBVdGlscy5nZXRWYWx1ZShncm91cEZpZWxkQXJyW2luaXRMZXZlbF0sIG4pID09PSBrKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgcGFyZW50LnJvd3MucHVzaChncm91cEl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBncm91cEl0ZW0udG90YWwgPSBncm91cEl0ZW0ucm93cy5maWx0ZXIobiA9PiAhbltJU19HUk9VUF9ST1dfRklFTERdICYmICFuW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICByZXN1bHRzLnB1c2goZ3JvdXBJdGVtKTtcclxuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBncm91cFJvd3Nba107XHJcbiAgICAgICAgICAgIGlmIChpc1BsYWluT2JqZWN0KGl0ZW1zKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGV2ZWwgPSBpbml0TGV2ZWwgKyAxO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KHRoaXMuZ3JvdXBSb3dzMkZsYXQoaXRlbXMsIGxldmVsLCBncm91cEl0ZW0pKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGdyb3VwSXRlbS50b3RhbCA9IGl0ZW1zLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBuW0dST1VQX1JPV19GSUVMRF0gPSBncm91cEl0ZW1baWRmaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgbltHUk9VUF9WSVNJQkxFX0ZJRUxEXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgbltHUk9VUF9MRVZFTF9GSUVMRF0gPSBncm91cEl0ZW1bR1JPVVBfTEVWRUxfRklFTERdICsgMTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBJdGVtLnJvd3MgPSBpdGVtcztcclxuICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmNvbmNhdChpdGVtcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0ZS5ncm91cEZvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9vdGVySXRlbSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBbSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF06IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgW0dST1VQX1JPV19GSUVMRF06IGdyb3VwSXRlbVtpZGZpZWxkXSxcclxuICAgICAgICAgICAgICAgICAgICBbR1JPVVBfVklTSUJMRV9GSUVMRF06IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgW0dST1VQX0xFVkVMX0ZJRUxEXTogaW5pdExldmVsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHt9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBJdGVtLnJvd3MucHVzaChmb290ZXJJdGVtKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChmb290ZXJJdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmm7TmlrDliIbnu4TlkIjorqHooYzmlbDmja4gKi9cclxuICAgIHByaXZhdGUgdXBkYXRlR3JvdXBGb290ZXJEYXRhKGdyb3VwRm9vdGVyUm93OiBhbnksIGNvbHVtbnM6IGFueSwgZ3JvdXBSb3dzOiBhbnkpIHtcclxuICAgICAgICBjb2x1bW5zLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgaWYgKGNvbC5ncm91cEZvb3RlciAmJiBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbC5ncm91cEZvb3Rlci5vcHRpb25zO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IG9wdGlvbnMudGV4dDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHR5cCA9IG9wdGlvbnMuY2FsY3VsYXRpb25UeXBlIGFzIENhbGN1bGF0aW9uVHlwZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwICE9PSB1bmRlZmluZWQgJiYgdHlwICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gdGhpcy5jYWxjdWxhdGlvbihncm91cFJvd3MsIHR5cCwgY29sKTtcclxuICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlclJvdy5kYXRhW2NvbC5maWVsZF0gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwRm9vdGVyUm93LmRhdGFbY29sLmZpZWxkXSA9IHRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBncm91cEZvb3RlclJvdy5kYXRhW2NvbC5maWVsZF0gPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDlpJrlrZfmrrXliIbnu4RcclxuICAgICAqIGdyb3VwRmllbGQg5Lul6YCX5Y+35YiG6ZqU77yM5LuO5bem5Yiw5Y+z5L6d5qyh6L+b6KGM5YiG57uEXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ3JvdXBSb3dzMihkYXRhOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBGaWVsZCA9IHRoaXMuX3N0YXRlLmdyb3VwRmllbGQgfHwgJyc7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWdyb3VwRmllbGQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBncm91cERhdGEgPSB0aGlzLmFyclRvR3JvdXAoZGF0YSwgZ3JvdXBGaWVsZC5zcGxpdCgnLCcpKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5ncm91cFJvd3MyRmxhdChncm91cERhdGEsIDAsIG51bGwpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGsgPSAwO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcHJvdyA9IChwaWQpID0+IHJlc3VsdC5maW5kKG4gPT4gblt0aGlzLl9zdGF0ZS5pZEZpZWxkXSA9PT0gcGlkKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3VsdC5tYXAoKG4sIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghbltJU19HUk9VUF9ST1dfRklFTERdICYmICFuW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbltST1dfSU5ERVhfRklFTERdID0gaztcclxuICAgICAgICAgICAgICAgICAgICBrKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw5ZCI6K6h6KGM5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBpZiAobltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBwcm93KG5bR1JPVVBfUk9XX0ZJRUxEXSkucm93cy5maWx0ZXIoKHI6IGFueSkgPT4gIXJbSVNfR1JPVVBfUk9XX0ZJRUxEXSAmJiAhcltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cEZvb3RlckRhdGEobiwgY29sdW1ucywgcm93cyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dHcm91cEZvb3Rlcihncm91cEZvb3Rlcikge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2dyb3VwRm9vdGVyfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVmlydGh1YWxSb3dzKDApO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUdyb3VwRm9vdGVyKGdyb3VwUm93SWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGdyb3VwUm93ID0gdGhpcy5fc3RhdGUudmlydHVhbC52aXJ0dWFsUm93cy5maW5kKChuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5bJ2lkJ10gPT09IGdyb3VwUm93SWQ7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChncm91cFJvdykge1xyXG4gICAgICAgICAgICBjb25zdCBncm91cFJvd3MgPSBncm91cFJvdy5yb3dzO1xyXG4gICAgICAgICAgICBjb25zdCBncm91cEZvb3RlclJvd3MgPSBncm91cFJvd3MuZmlsdGVyKChuOiBhbnkpID0+IG5bJ19fZ3JvdXBfZm9vdGVyX18nXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBncm91cFJvd3MuZmlsdGVyKChuOiBhbnkpID0+ICFuWydfX2dyb3VwX2Zvb3Rlcl9fJ10pO1xyXG5cclxuICAgICAgICAgICAgZ3JvdXBGb290ZXJSb3dzLmZvckVhY2goKG46IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cEZvb3RlckRhdGEobiwgY29sdW1ucywgcm93cyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGN1bGF0aW9uKGRhdGE6IGFueSwgdHlwOiBDYWxjdWxhdGlvblR5cGUsIGNvbDogYW55KSB7XHJcbiAgICAgICAgbGV0IHZhbDogYW55ID0gJyc7XHJcbiAgICAgICAgLy8gVEZTOiAzNTcwMDBcclxuICAgICAgICAvLyBodHRwOi8vMTAuMjQuMS4xMTo4MDgwL3Rmcy9HU1AvR1NQQ2xvdWQvd2ViL19xdWVyaWVzP2lkPTM1NzAwMCZ0cmlhZ2U9dHJ1ZSZmdWxsU2NyZWVuPWZhbHNlJl9hPWVkaXRcclxuICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZmllbGQgPSBjb2wuZmllbGQ7XHJcbiAgICAgICAgY29uc3QgYXJyID0gZGF0YS5tYXAoKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSB8fCAwKTtcclxuICAgICAgICBzd2l0Y2ggKHR5cCkge1xyXG4gICAgICAgICAgICBjYXNlIENhbGN1bGF0aW9uVHlwZS5zdW06XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBzdW1CeShkYXRhLCAobykgPT4gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG8pKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5zdW0uYXBwbHkobnVsbCwgYXJyKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUubWF4OlxyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgbWF4T2JqID0gbWF4QnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbWF4T2JqKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5tYXguYXBwbHkobnVsbCwgYXJyKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUubWluOlxyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgbWluT2JqID0gbWluQnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbWluT2JqKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5taW4uYXBwbHkobnVsbCwgYXJyKS50b0ZpeGVkKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUuYXZlcmFnZTpcclxuICAgICAgICAgICAgICAgIC8vIHZhbCA9IG1lYW5CeShkYXRhLCAobykgPT4gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG8pKTtcclxuICAgICAgICAgICAgICAgIHZhbCA9IEJpZ051bWJlci5zdW0uYXBwbHkobnVsbCwgYXJyKS5kaXYoYXJyLmxlbmd0aCkudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLmNvdW50OlxyXG4gICAgICAgICAgICAgICAgdmFsID0gZGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyNyZWdpb24g57uE5Lu25Yid5aeL5bGe5oCnXHJcblxyXG4gICAgc2V0aW5pdGlhbE9wdGlvbnMob3B0czoge1trZXk6IHN0cmluZ106IGFueX0pIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5pbml0aWFsT3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIC8vIOWIhue7hFxyXG4gICAgICAgIHRoaXMuX3N0YXRlLmluaXRpYWxPcHRpb25zWydncm91cEZpZWxkJ10gPSBvcHRzLmdyb3VwRmllbGQ7XHJcblxyXG4gICAgICAgIC8vIOaOkuW6j1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmluaXRpYWxPcHRpb25zWydzb3J0J10gPSB7XHJcbiAgICAgICAgICAgIHNvcnROYW1lOiBvcHRzLnNvcnROYW1lLFxyXG4gICAgICAgICAgICBzb3J0T3JkZXI6IG9wdHMuc29ydE9yZGVyXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyDliJfmmL7npLrpmpDol4/jgIHlr7npvZDmlrnlvI9cclxuICAgICAgICBpZiAob3B0cy5jb2x1bW5zICYmIG9wdHMuY29sdW1uc1swXSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5pbml0aWFsT3B0aW9uc1snY29sdW1uRmllbGRzJ10gPSAob3B0cy5jb2x1bW5zWzBdIGFzIGFueSkubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogbi53aWR0aCB8fCAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IG4uZmllbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFsaWduOiBuLmhhbGlnbixcclxuICAgICAgICAgICAgICAgICAgICBhbGlnbjogbi5hbGlnbixcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiBuLnZpc2libGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyOiBjbG9uZURlZXAobi5mb290ZXIgfHwge30pLFxyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwRm9vdGVyOiBjbG9uZURlZXAobi5ncm91cEZvb3RlciB8fCB7fSlcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxufVxyXG4iXX0=