/**
 * @fileoverview added by tsickle
 * Generated from: lib/querycondition.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewEncapsulation, Input, ComponentFactoryResolver, Injector, Output, EventEmitter, LOCALE_ID, ViewChild, NgZone } from '@angular/core';
import { CommunicationService } from './service/communicationservice';
import { ConvertorService } from './service/convertorservice';
import { ControlType } from './entity/controltype';
import { ConfigDialogComponent } from './fieldconfigdialog/configdialog.component';
import { BsModalService } from '@farris/ui-modal';
import { SolutionService } from './service/solution.service';
import { LocaleService } from '@farris/ui-locale';
var QueryConditionComponent = /** @class */ (function () {
    function QueryConditionComponent(communicationService, convertorService, resolver, injector, modalService, localeService) {
        this.communicationService = communicationService;
        this.convertorService = convertorService;
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.localeService = localeService;
        this._resetFieldConfigs = [];
        this.isControlInline = true;
        this.showCompleteLabel = false;
        this.fieldConditionsChange = new EventEmitter();
        this.localeIds = {
            'en': 'en',
            'zh-CHS': 'zh-CHS'
        };
        this.controlType = ControlType;
        this.showButton = false;
        this.fieldCodeOfClearFields = [];
        // 获取ngZone
        this.ngZone = null;
        this.currentLocale = this.injector.get(LOCALE_ID);
        this.solutionService = this.injector.get(SolutionService);
        if (!this.ngZone) {
            this.ngZone = this.injector.get(NgZone, null);
        }
    }
    Object.defineProperty(QueryConditionComponent.prototype, "resetFieldConfigs", {
        get: /**
         * @return {?}
         */
        function () {
            return this._resetFieldConfigs;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value && value.length > 0) {
                this.solutionService.updateControlConfigState(value);
            }
            this._resetFieldConfigs = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(QueryConditionComponent.prototype, "selectedFieldConditions", {
        get: /**
         * @return {?}
         */
        function () {
            return this._selectedFieldConditions;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._selectedFieldConditions = value;
        },
        enumerable: true,
        configurable: true
    });
    ;
    /**
     * @return {?}
     */
    QueryConditionComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    QueryConditionComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.currentLocale === this.localeIds['en']) {
            this.isControlInline = false;
        }
        this.selectedFieldConditions = this.selectedFieldConditions || new Array();
    };
    /**
     * @return {?}
     */
    QueryConditionComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    QueryConditionComponent.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} currentItem
     * @return {?}
     */
    QueryConditionComponent.prototype.hasSetMultiClass = /**
     * @param {?} currentItem
     * @return {?}
     */
    function (currentItem) {
        if (currentItem.control.className && currentItem.control.className.indexOf('farris-group-multi-label') > -1) {
            return true;
        }
        return false;
    };
    /* */
    /* */
    /**
     * @param {?} currentItem
     * @return {?}
     */
    QueryConditionComponent.prototype.getStyle = /* */
    /**
     * @param {?} currentItem
     * @return {?}
     */
    function (currentItem) {
        /** @type {?} */
        var defaultCondtionStyle = 'col-12 col-md-6 col-xl-3 col-el-2';
        // 设置显示标签全并且显示了折行
        // if(this.showCompleteLabel && currentItem.control.className == 'farris-group-multi-label'){
        //     return defaultCondtionStyle.concat(" farris-group-multi-label");
        // }
        /** @type {?} */
        var className = currentItem.control.className;
        className = className ? className.replace('farris-group-multi-label', '') : '';
        return className ? className : defaultCondtionStyle;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    QueryConditionComponent.prototype.configDialogConfirm = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.selectedFieldConditions = (/** @type {?} */ ((/** @type {?} */ (event))));
        this.fieldConditionsChange.emit(event);
    };
    /**
     * @return {?}
     */
    QueryConditionComponent.prototype.openFieldConfigDialog = /**
     * @return {?}
     */
    function () {
        this.configDialog.inputSelectedFileds = this.selectedFieldConditions ? this.selectedFieldConditions : [];
        this.configDialog.dialog.show();
    };
    /**
     * @param {?=} exceptRequired
     * @return {?}
     */
    QueryConditionComponent.prototype.resetSelectedConditionValues = /**
     * @param {?=} exceptRequired
     * @return {?}
     */
    function (exceptRequired) {
        if (exceptRequired === void 0) { exceptRequired = false; }
        return this.selectedFieldConditions.map((/**
         * @param {?} fieldCondition
         * @return {?}
         */
        function (fieldCondition) {
            if (exceptRequired) {
                if (!fieldCondition.control.isRequired()) {
                    fieldCondition.value.clearValue();
                }
            }
            else {
                fieldCondition.value.clearValue();
            }
            return fieldCondition;
        }));
    };
    /**
     * @return {?}
     */
    QueryConditionComponent.prototype.conditionChange = /**
     * @return {?}
     */
    function () {
        this.fieldConditionsChange.emit(this.selectedFieldConditions);
    };
    /**
     * @param {?} conditions
     * @return {?}
     */
    QueryConditionComponent.prototype.confirmLabelFormat = /**
     * @param {?} conditions
     * @return {?}
     */
    function (conditions) {
        if (this.isControlInline) {
            this.labelFormat = 'farris-form-controls-inline';
            /** @type {?} */
            var hasCustom_1 = false;
            if (conditions.length) {
                // 复选框label标签目前在框的右侧，超出宽度后下方出现滚动条，计算标签最大长度时需将其排除
                /** @type {?} */
                var noCheckBoxConditions_1 = [];
                conditions.forEach((/**
                 * @param {?} condition
                 * @return {?}
                 */
                function (condition) {
                    if (condition.control.getControlType() != ControlType.BoolCheck) {
                        noCheckBoxConditions_1.push(condition);
                    }
                    if (condition.control['className'] && condition.control['className'] != 'farris-group-multi-label') {
                        hasCustom_1 = true;
                    }
                }));
                this.labelFormat += hasCustom_1 ? ' condition-is-custom' : ' condition-with-fixed';
                /** @type {?} */
                var maxLength_1 = 0;
                if (noCheckBoxConditions_1.length) {
                    noCheckBoxConditions_1.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        maxLength_1 = (item.fieldName.length > maxLength_1) ? (item.fieldName.length) : maxLength_1;
                    }));
                }
                //需要完整显示控件标签时，根据标签最大长度确定标签栏每行可显示的字符数
                if (this.showCompleteLabel) {
                    if (maxLength_1 > 8) {
                        //标签超出8个字符后，设置每行最多可显示10个字符
                        this.labelFormat = this.labelFormat.concat(" f-form-label-xl");
                    }
                    else if ((maxLength_1 < 9) && (maxLength_1 > 6)) {
                        //标签超出6个字符、不超过8个字符时，设置每行最多可显示8个字符
                        this.labelFormat = this.labelFormat.concat(" f-form-label-lg");
                    }
                }
            }
        }
        if (this.labelFormat) {
            return this.labelFormat + (this.isControlInline && this.showCompleteLabel ? ' condition-with-complete' : '');
        }
    };
    QueryConditionComponent.decorators = [
        { type: Component, args: [{
                    selector: 'farris-querycondition',
                    template: "<div class=\"row f-utils-flex-row-wrap farris-form {{confirmLabelFormat(selectedFieldConditions)}} condition-div\"  id=\"querycondition\" #queryConditionWrap>\r\n    <ng-container *ngFor=\"let currentItem of selectedFieldConditions;let i=index;\">\r\n        <app-solution-input  \r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.Text\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-input>\r\n\r\n        <app-solution-inputgroup\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.InputGroup\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-inputgroup>\r\n        \r\n        <app-solution-dropdownlist\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.DropDownList\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-dropdownlist>\r\n        \r\n        <app-solution-smarthelp\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.SmartHelp\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-smarthelp>\r\n        \r\n        <app-solution-single-number\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.SingleNumber\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-single-number>\r\n\r\n        <app-solution-numberrange\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.NumberRange\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-numberrange>\r\n        \r\n        <app-solution-datepicker\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.SingleDate\"\r\n            [(item)]=\"selectedFieldConditions[i]\"\r\n            [controlType]=\"currentItem.control.getControlType()\">\r\n        </app-solution-datepicker>\r\n        \r\n        <app-solution-datepicker\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.DateRange\"\r\n            [(item)]=\"selectedFieldConditions[i]\"\r\n            [controlType]=\"currentItem.control.getControlType()\">\r\n        </app-solution-datepicker>\r\n\r\n        <app-solution-datepicker\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.SingleYear\"\r\n            [(item)]=\"selectedFieldConditions[i]\"\r\n            [controlType]=\"currentItem.control.getControlType()\">\r\n        </app-solution-datepicker>\r\n        \r\n        <app-solution-datepicker\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.SingleMonth\"\r\n            [(item)]=\"selectedFieldConditions[i]\"\r\n            [controlType]=\"currentItem.control.getControlType()\">\r\n        </app-solution-datepicker>\r\n        \r\n        <app-solution-datepicker\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.MonthRange\"\r\n            [(item)]=\"selectedFieldConditions[i]\"\r\n            [controlType]=\"currentItem.control.getControlType()\">\r\n        </app-solution-datepicker>\r\n        \r\n        <app-solution-datepicker\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.SingleDateTime\"\r\n            [(item)]=\"selectedFieldConditions[i]\"\r\n            [controlType]=\"currentItem.control.getControlType()\">\r\n        </app-solution-datepicker>\r\n        \r\n        <app-solution-datepicker\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.DateTimeRange\"\r\n            [(item)]=\"selectedFieldConditions[i]\"\r\n            [controlType]=\"currentItem.control.getControlType()\">\r\n        </app-solution-datepicker>\r\n\r\n        <app-solution-combolookup\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.ComboLookUp\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-combolookup>\r\n\r\n        <app-solution-checkbox\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.BoolCheck\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-checkbox>\r\n\r\n        <app-solution-radio\r\n            [ngClass]=\"getStyle(currentItem)\"\r\n            [label-text-multi]=\"hasSetMultiClass(currentItem)\"\r\n            [changeFields]=\"fieldCodeOfClearFields\"\r\n            (conditionChange)=\"conditionChange()\"\r\n            *ngIf=\"currentItem.control.getControlType() == controlType.Radio\"\r\n            [(item)]=\"selectedFieldConditions[i]\">\r\n        </app-solution-radio>\r\n    </ng-container>\r\n</div>\r\n<app-queryconfigdialog \r\n    #configDialog \r\n    [inputSelectedFileds]=\"selectedFieldConditions\" \r\n    [filedsDataSource]=\"fieldConfigs\"\r\n    (confirmEmitter)=\"configDialogConfirm($event)\">\r\n</app-queryconfigdialog>",
                    encapsulation: ViewEncapsulation.None,
                    providers: [CommunicationService],
                    styles: [".condition-div{min-height:30px}.f-solution-radio-group .farris-checkradio-hor{flex-wrap:nowrap;overflow-x:auto}.f-solution-radio-group .farris-checkradio-hor::-webkit-scrollbar{width:6px;height:6px;background-color:#eee}.f-solution-radio-group .farris-checkradio-hor::-webkit-scrollbar-track{border-radius:0}.f-solution-radio-group .farris-checkradio-hor::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.15);-webkit-transition:.2s;transition:.2s;border-radius:6px}.f-solution-radio-group .farris-checkradio-hor::-webkit-scrollbar-thumb:hover{background-color:rgba(0,0,0,.45)}.f-solution-radio-group .farris-checkradio-hor .custom-radio{flex-shrink:0}"]
                }] }
    ];
    /** @nocollapse */
    QueryConditionComponent.ctorParameters = function () { return [
        { type: CommunicationService },
        { type: ConvertorService },
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: BsModalService },
        { type: LocaleService }
    ]; };
    QueryConditionComponent.propDecorators = {
        fieldConfigs: [{ type: Input }],
        resetFieldConfigs: [{ type: Input }],
        isControlInline: [{ type: Input }],
        selectedFieldConditions: [{ type: Input }],
        showCompleteLabel: [{ type: Input }],
        isDisabled: [{ type: Input }],
        fieldConditionsChange: [{ type: Output }],
        configDialog: [{ type: ViewChild, args: ['configDialog',] }],
        queryConditionWrapEl: [{ type: ViewChild, args: ["queryConditionWrap",] }]
    };
    return QueryConditionComponent;
}());
export { QueryConditionComponent };
if (false) {
    /** @type {?} */
    QueryConditionComponent.prototype.fieldConfigs;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype._resetFieldConfigs;
    /** @type {?} */
    QueryConditionComponent.prototype.isControlInline;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype._selectedFieldConditions;
    /** @type {?} */
    QueryConditionComponent.prototype.showCompleteLabel;
    /** @type {?} */
    QueryConditionComponent.prototype.isDisabled;
    /** @type {?} */
    QueryConditionComponent.prototype.fieldConditionsChange;
    /** @type {?} */
    QueryConditionComponent.prototype.configDialog;
    /** @type {?} */
    QueryConditionComponent.prototype.localeIds;
    /** @type {?} */
    QueryConditionComponent.prototype.currentLocale;
    /** @type {?} */
    QueryConditionComponent.prototype.solutionService;
    /** @type {?} */
    QueryConditionComponent.prototype.controlType;
    /** @type {?} */
    QueryConditionComponent.prototype.labelFormat;
    /** @type {?} */
    QueryConditionComponent.prototype.showButton;
    /** @type {?} */
    QueryConditionComponent.prototype.fieldCodeOfClearFields;
    /** @type {?} */
    QueryConditionComponent.prototype.queryConditionWrapEl;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype.communicationService;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype.convertorService;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    QueryConditionComponent.prototype.localeService;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnljb25kaXRpb24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21wb25lbnQtcXVlcnljb25kaXRpb24vIiwic291cmNlcyI6WyJsaWIvcXVlcnljb25kaXRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxLQUFLLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUM1RSxNQUFNLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQXlDLE1BQU0sRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFFcEksT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDdEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQ25GLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWxEO0lBeURJLGlDQUNZLG9CQUEwQyxFQUMxQyxnQkFBa0MsRUFDbEMsUUFBa0MsRUFDbEMsUUFBa0IsRUFDbEIsWUFBNEIsRUFDNUIsYUFBNEI7UUFMNUIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUMxQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBckRoQyx1QkFBa0IsR0FBQyxF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QW9COztJQUVwQiw2Q0FBNEI7O0lBRTVCLHlEQUEyQzs7SUFDM0MsdURBQXNEOzs7OztJQUV0RCx5Q0FBc0I7Ozs7O0lBRWxCLHVEQUFrRDs7Ozs7SUFDbEQsbURBQTBDOzs7OztJQUMxQywyQ0FBMEM7Ozs7O0lBQzFDLDJDQUEwQjs7Ozs7SUFDMUIsK0NBQW9DOzs7OztJQUNwQyxnREFBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdFbmNhcHN1bGF0aW9uLCBJbnB1dCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeSxcclxuICAgIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBMT0NBTEVfSUQsIFZpZXdDaGlsZCwgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0NoZWNrZWQsICAgTmdab25lLCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFF1ZXJ5Q29uZGl0aW9uIH0gZnJvbSAnLi9lbnRpdHkvcXVlcnljb25kaXRpb24nO1xyXG5pbXBvcnQgeyBDb21tdW5pY2F0aW9uU2VydmljZSB9IGZyb20gJy4vc2VydmljZS9jb21tdW5pY2F0aW9uc2VydmljZSc7XHJcbmltcG9ydCB7IENvbnZlcnRvclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvY29udmVydG9yc2VydmljZSc7XHJcbmltcG9ydCB7IENvbnRyb2xUeXBlIH0gZnJvbSAnLi9lbnRpdHkvY29udHJvbHR5cGUnO1xyXG5pbXBvcnQgeyBDb25maWdEaWFsb2dDb21wb25lbnQgfSBmcm9tICcuL2ZpZWxkY29uZmlnZGlhbG9nL2NvbmZpZ2RpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBTb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2Uvc29sdXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLXF1ZXJ5Y29uZGl0aW9uJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9xdWVyeWNvbmRpdGlvbi5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9xdWVyeWNvbmRpdGlvbi5jb21wb25lbnQuY3NzJ10sXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gICAgcHJvdmlkZXJzOiBbQ29tbXVuaWNhdGlvblNlcnZpY2VdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBRdWVyeUNvbmRpdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdDaGVja2VkLEFmdGVyVmlld0luaXQge1xyXG5cclxuICAgIEBJbnB1dCgpIGZpZWxkQ29uZmlnczogQXJyYXk8UXVlcnlDb25kaXRpb24+O1xyXG4gICAgcHJpdmF0ZSBfcmVzZXRGaWVsZENvbmZpZ3M9W107XHJcbiAgICBASW5wdXQoKSBcclxuICAgIHNldCByZXNldEZpZWxkQ29uZmlncyh2YWx1ZTpBcnJheTxhbnk+KXtcclxuICAgICAgICBpZih2YWx1ZSYmdmFsdWUubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICB0aGlzLnNvbHV0aW9uU2VydmljZS51cGRhdGVDb250cm9sQ29uZmlnU3RhdGUodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9yZXNldEZpZWxkQ29uZmlncz12YWx1ZTtcclxuICAgIH1cclxuICAgIGdldCByZXNldEZpZWxkQ29uZmlncygpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yZXNldEZpZWxkQ29uZmlncztcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIGlzQ29udHJvbElubGluZTogYm9vbGVhbiA9IHRydWU7XHJcbiAgICBwcml2YXRlIF9zZWxlY3RlZEZpZWxkQ29uZGl0aW9uczpBcnJheTxRdWVyeUNvbmRpdGlvbj47XHJcbiAgICBASW5wdXQoKSBcclxuICAgIHNldCBzZWxlY3RlZEZpZWxkQ29uZGl0aW9ucyh2YWx1ZTpBcnJheTxRdWVyeUNvbmRpdGlvbj4pe1xyXG4gICAgICAgIHRoaXMuX3NlbGVjdGVkRmllbGRDb25kaXRpb25zPXZhbHVlO1xyXG4gICAgfVxyXG4gICAgZ2V0IHNlbGVjdGVkRmllbGRDb25kaXRpb25zKCk6QXJyYXk8UXVlcnlDb25kaXRpb24+e1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZEZpZWxkQ29uZGl0aW9ucztcclxuICAgIH07XHJcblxyXG4gICAgQElucHV0KCkgc2hvd0NvbXBsZXRlTGFiZWw6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBpc0Rpc2FibGVkOiBib29sZWFuO1xyXG5cclxuICAgIEBPdXRwdXQoKSBmaWVsZENvbmRpdGlvbnNDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnY29uZmlnRGlhbG9nJykgY29uZmlnRGlhbG9nOiBDb25maWdEaWFsb2dDb21wb25lbnQ7XHJcblxyXG4gICAgbG9jYWxlSWRzID0ge1xyXG4gICAgICAgICdlbic6ICdlbicsXHJcbiAgICAgICAgJ3poLUNIUyc6ICd6aC1DSFMnXHJcbiAgICB9XHJcbiAgICBjdXJyZW50TG9jYWxlOiBzdHJpbmc7XHJcbiAgICBcclxuICAgIHNvbHV0aW9uU2VydmljZTogU29sdXRpb25TZXJ2aWNlO1xyXG4gICAgXHJcbiAgICBjb250cm9sVHlwZSA9IENvbnRyb2xUeXBlO1xyXG4gICAgXHJcbiAgICBsYWJlbEZvcm1hdDogc3RyaW5nO1xyXG5cclxuICAgIHNob3dCdXR0b246IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICBmaWVsZENvZGVPZkNsZWFyRmllbGRzOiBBcnJheTxzdHJpbmc+ID0gW107XHJcbiAgICBAVmlld0NoaWxkKFwicXVlcnlDb25kaXRpb25XcmFwXCIpIHF1ZXJ5Q29uZGl0aW9uV3JhcEVsO1xyXG4gICAgLy8g6I635Y+Wbmdab25lXHJcbiAgICBwcml2YXRlIG5nWm9uZSA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGNvbW11bmljYXRpb25TZXJ2aWNlOiBDb21tdW5pY2F0aW9uU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGNvbnZlcnRvclNlcnZpY2U6IENvbnZlcnRvclNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2VcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudExvY2FsZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExPQ0FMRV9JRCk7XHJcbiAgICAgICAgdGhpcy5zb2x1dGlvblNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChTb2x1dGlvblNlcnZpY2UpO1xyXG4gICAgICAgIGlmICghdGhpcy5uZ1pvbmUpIHsgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMubmdab25lID0gdGhpcy5pbmplY3Rvci5nZXQ8Tmdab25lPihOZ1pvbmUsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRMb2NhbGUgPT09IHRoaXMubG9jYWxlSWRzWydlbiddKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNDb250cm9sSW5saW5lID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZENvbmRpdGlvbnMgPSB0aGlzLnNlbGVjdGVkRmllbGRDb25kaXRpb25zIHx8IG5ldyBBcnJheTxRdWVyeUNvbmRpdGlvbj4oKTtcclxuICAgIH1cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpe1xyXG4gICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdDaGVja2VkKCk6IHZvaWQge1xyXG4gICAgICAgIFxyXG4gICAgICAgXHJcbiAgICB9XHJcbiAgICBoYXNTZXRNdWx0aUNsYXNzKGN1cnJlbnRJdGVtOiBhbnkpOmJvb2xlYW57XHJcbiAgICAgICAgaWYoY3VycmVudEl0ZW0uY29udHJvbC5jbGFzc05hbWUmJmN1cnJlbnRJdGVtLmNvbnRyb2wuY2xhc3NOYW1lLmluZGV4T2YoJ2ZhcnJpcy1ncm91cC1tdWx0aS1sYWJlbCcpPi0xKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIC8qICovXHJcbiAgICBnZXRTdHlsZShjdXJyZW50SXRlbTogYW55KTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBkZWZhdWx0Q29uZHRpb25TdHlsZSA9ICdjb2wtMTIgY29sLW1kLTYgY29sLXhsLTMgY29sLWVsLTInO1xyXG4gICAgICAgIC8vIOiuvue9ruaYvuekuuagh+etvuWFqOW5tuS4lOaYvuekuuS6huaKmOihjFxyXG4gICAgICAgIC8vIGlmKHRoaXMuc2hvd0NvbXBsZXRlTGFiZWwgJiYgY3VycmVudEl0ZW0uY29udHJvbC5jbGFzc05hbWUgPT0gJ2ZhcnJpcy1ncm91cC1tdWx0aS1sYWJlbCcpe1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gZGVmYXVsdENvbmR0aW9uU3R5bGUuY29uY2F0KFwiIGZhcnJpcy1ncm91cC1tdWx0aS1sYWJlbFwiKTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgbGV0IGNsYXNzTmFtZT1jdXJyZW50SXRlbS5jb250cm9sLmNsYXNzTmFtZTtcclxuICAgICAgICBjbGFzc05hbWU9Y2xhc3NOYW1lP2NsYXNzTmFtZS5yZXBsYWNlKCdmYXJyaXMtZ3JvdXAtbXVsdGktbGFiZWwnLCcnKTonJzsgICAgICAgIFxyXG4gICAgICAgIHJldHVybiBjbGFzc05hbWUgPyBjbGFzc05hbWUgOiBkZWZhdWx0Q29uZHRpb25TdHlsZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25maWdEaWFsb2dDb25maXJtKGV2ZW50OiBFdmVudCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRGaWVsZENvbmRpdGlvbnMgPSBldmVudCBhcyB1bmtub3duIGFzIEFycmF5PFF1ZXJ5Q29uZGl0aW9uPjtcclxuICAgICAgICB0aGlzLmZpZWxkQ29uZGl0aW9uc0NoYW5nZS5lbWl0KGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuRmllbGRDb25maWdEaWFsb2coKSB7XHJcbiAgICAgICAgdGhpcy5jb25maWdEaWFsb2cuaW5wdXRTZWxlY3RlZEZpbGVkcyA9IHRoaXMuc2VsZWN0ZWRGaWVsZENvbmRpdGlvbnMgPyB0aGlzLnNlbGVjdGVkRmllbGRDb25kaXRpb25zIDogW107XHJcbiAgICAgICAgdGhpcy5jb25maWdEaWFsb2cuZGlhbG9nLnNob3coKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldFNlbGVjdGVkQ29uZGl0aW9uVmFsdWVzKGV4Y2VwdFJlcXVpcmVkPWZhbHNlKTogQXJyYXk8UXVlcnlDb25kaXRpb24+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZEZpZWxkQ29uZGl0aW9ucy5tYXAoZmllbGRDb25kaXRpb24gPT4ge1xyXG4gICAgICAgICAgICBpZihleGNlcHRSZXF1aXJlZCl7XHJcbiAgICAgICAgICAgICAgICBpZighZmllbGRDb25kaXRpb24uY29udHJvbC5pc1JlcXVpcmVkKCkpe1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkQ29uZGl0aW9uLnZhbHVlLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBmaWVsZENvbmRpdGlvbi52YWx1ZS5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiBmaWVsZENvbmRpdGlvbjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25kaXRpb25DaGFuZ2UoKSB7XHJcbiAgICAgICAgdGhpcy5maWVsZENvbmRpdGlvbnNDaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkRmllbGRDb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25maXJtTGFiZWxGb3JtYXQoY29uZGl0aW9uczogQXJyYXk8UXVlcnlDb25kaXRpb24+KSB7XHJcbiAgICAgICAgaWYodGhpcy5pc0NvbnRyb2xJbmxpbmUpIHtcclxuICAgICAgICAgICAgdGhpcy5sYWJlbEZvcm1hdCA9ICdmYXJyaXMtZm9ybS1jb250cm9scy1pbmxpbmUnO1xyXG4gICAgICAgICAgICBsZXQgaGFzQ3VzdG9tPWZhbHNlO1xyXG4gICAgICAgICAgICBpZihjb25kaXRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5aSN6YCJ5qGGbGFiZWzmoIfnrb7nm67liY3lnKjmoYbnmoTlj7PkvqfvvIzotoXlh7rlrr3luqblkI7kuIvmlrnlh7rnjrDmu5rliqjmnaHvvIzorqHnrpfmoIfnrb7mnIDlpKfplb/luqbml7bpnIDlsIblhbbmjpLpmaRcclxuICAgICAgICAgICAgICAgIGxldCBub0NoZWNrQm94Q29uZGl0aW9uczogQXJyYXk8UXVlcnlDb25kaXRpb24+ID0gW107XHJcbiAgICAgICAgICAgICAgICBjb25kaXRpb25zLmZvckVhY2goY29uZGl0aW9uID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZihjb25kaXRpb24uY29udHJvbC5nZXRDb250cm9sVHlwZSgpICE9IENvbnRyb2xUeXBlLkJvb2xDaGVjayl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vQ2hlY2tCb3hDb25kaXRpb25zLnB1c2goY29uZGl0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY29uZGl0aW9uLmNvbnRyb2xbJ2NsYXNzTmFtZSddJiYgY29uZGl0aW9uLmNvbnRyb2xbJ2NsYXNzTmFtZSddIT0gJ2ZhcnJpcy1ncm91cC1tdWx0aS1sYWJlbCcpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNDdXN0b209dHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsRm9ybWF0Kz1oYXNDdXN0b20/JyBjb25kaXRpb24taXMtY3VzdG9tJzonIGNvbmRpdGlvbi13aXRoLWZpeGVkJzsgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBtYXhMZW5ndGggPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYobm9DaGVja0JveENvbmRpdGlvbnMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBub0NoZWNrQm94Q29uZGl0aW9ucy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhMZW5ndGggPSAoaXRlbS5maWVsZE5hbWUubGVuZ3RoID4gbWF4TGVuZ3RoKSA/IChpdGVtLmZpZWxkTmFtZS5sZW5ndGgpIDogbWF4TGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy/pnIDopoHlrozmlbTmmL7npLrmjqfku7bmoIfnrb7ml7bvvIzmoLnmja7moIfnrb7mnIDlpKfplb/luqbnoa7lrprmoIfnrb7moI/mr4/ooYzlj6/mmL7npLrnmoTlrZfnrKbmlbBcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2hvd0NvbXBsZXRlTGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihtYXhMZW5ndGggPiA4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v5qCH562+6LaF5Ye6OOS4quWtl+espuWQju+8jOiuvue9ruavj+ihjOacgOWkmuWPr+aYvuekujEw5Liq5a2X56ymXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFiZWxGb3JtYXQgPSB0aGlzLmxhYmVsRm9ybWF0LmNvbmNhdChcIiBmLWZvcm0tbGFiZWwteGxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoKG1heExlbmd0aCA8IDkpICYmIChtYXhMZW5ndGggPiA2KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+agh+etvui2heWHujbkuKrlrZfnrKbjgIHkuI3otoXov4c45Liq5a2X56ym5pe277yM6K6+572u5q+P6KGM5pyA5aSa5Y+v5pi+56S6OOS4quWtl+esplxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxhYmVsRm9ybWF0ID0gdGhpcy5sYWJlbEZvcm1hdC5jb25jYXQoXCIgZi1mb3JtLWxhYmVsLWxnXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmxhYmVsRm9ybWF0KXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFiZWxGb3JtYXQgKyAodGhpcy5pc0NvbnRyb2xJbmxpbmUmJnRoaXMuc2hvd0NvbXBsZXRlTGFiZWw/JyBjb25kaXRpb24td2l0aC1jb21wbGV0ZSc6JycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=