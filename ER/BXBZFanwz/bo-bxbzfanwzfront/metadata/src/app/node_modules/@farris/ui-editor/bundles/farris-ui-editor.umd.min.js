!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/router"),require("@angular/core"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@farris/ui-editor",["exports","@angular/router","@angular/core","@angular/common","@angular/forms"],e):e((t.farris=t.farris||{},t.farris["ui-editor"]={}),t.ng.router,t.ng.core,t.ng.common,t.ng.forms)}(this,function(t,s,a,e,n){"use strict";var u=(i.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],i.ctorParameters=function(){return[]},i.ngInjectableDef=a.defineInjectable({factory:function(){return new i},token:i,providedIn:"root"}),i);function i(){}var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var r=function(){return(r=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},l=function(){var t="undefined"!=typeof window?window:undefined;return t&&t.tinymce?t.tinymce:null},p=(d.propDecorators={onBeforePaste:[{type:a.Output}],onBlur:[{type:a.Output}],onClick:[{type:a.Output}],onContextMenu:[{type:a.Output}],onCopy:[{type:a.Output}],onCut:[{type:a.Output}],onDblclick:[{type:a.Output}],onDrag:[{type:a.Output}],onDragDrop:[{type:a.Output}],onDragEnd:[{type:a.Output}],onDragGesture:[{type:a.Output}],onDragOver:[{type:a.Output}],onDrop:[{type:a.Output}],onFocus:[{type:a.Output}],onFocusIn:[{type:a.Output}],onFocusOut:[{type:a.Output}],onKeyDown:[{type:a.Output}],onKeyPress:[{type:a.Output}],onKeyUp:[{type:a.Output}],onMouseDown:[{type:a.Output}],onMouseEnter:[{type:a.Output}],onMouseLeave:[{type:a.Output}],onMouseMove:[{type:a.Output}],onMouseOut:[{type:a.Output}],onMouseOver:[{type:a.Output}],onMouseUp:[{type:a.Output}],onPaste:[{type:a.Output}],onSelectionChange:[{type:a.Output}],onActivate:[{type:a.Output}],onAddUndo:[{type:a.Output}],onBeforeAddUndo:[{type:a.Output}],onBeforeExecCommand:[{type:a.Output}],onBeforeGetContent:[{type:a.Output}],onBeforeRenderUI:[{type:a.Output}],onBeforeSetContent:[{type:a.Output}],onChange:[{type:a.Output}],onClearUndos:[{type:a.Output}],onDeactivate:[{type:a.Output}],onDirty:[{type:a.Output}],onExecCommand:[{type:a.Output}],onGetContent:[{type:a.Output}],onHide:[{type:a.Output}],onInit:[{type:a.Output}],onLoadContent:[{type:a.Output}],onNodeChange:[{type:a.Output}],onPostProcess:[{type:a.Output}],onPostRender:[{type:a.Output}],onPreInit:[{type:a.Output}],onPreProcess:[{type:a.Output}],onProgressState:[{type:a.Output}],onRedo:[{type:a.Output}],onRemove:[{type:a.Output}],onReset:[{type:a.Output}],onSaveContent:[{type:a.Output}],onSetAttrib:[{type:a.Output}],onObjectResizeStart:[{type:a.Output}],onObjectResized:[{type:a.Output}],onObjectSelected:[{type:a.Output}],onSetContent:[{type:a.Output}],onShow:[{type:a.Output}],onSubmit:[{type:a.Output}],onUndo:[{type:a.Output}],onVisualAid:[{type:a.Output}]},d);function d(){this.onBeforePaste=new a.EventEmitter,this.onBlur=new a.EventEmitter,this.onClick=new a.EventEmitter,this.onContextMenu=new a.EventEmitter,this.onCopy=new a.EventEmitter,this.onCut=new a.EventEmitter,this.onDblclick=new a.EventEmitter,this.onDrag=new a.EventEmitter,this.onDragDrop=new a.EventEmitter,this.onDragEnd=new a.EventEmitter,this.onDragGesture=new a.EventEmitter,this.onDragOver=new a.EventEmitter,this.onDrop=new a.EventEmitter,this.onFocus=new a.EventEmitter,this.onFocusIn=new a.EventEmitter,this.onFocusOut=new a.EventEmitter,this.onKeyDown=new a.EventEmitter,this.onKeyPress=new a.EventEmitter,this.onKeyUp=new a.EventEmitter,this.onMouseDown=new a.EventEmitter,this.onMouseEnter=new a.EventEmitter,this.onMouseLeave=new a.EventEmitter,this.onMouseMove=new a.EventEmitter,this.onMouseOut=new a.EventEmitter,this.onMouseOver=new a.EventEmitter,this.onMouseUp=new a.EventEmitter,this.onPaste=new a.EventEmitter,this.onSelectionChange=new a.EventEmitter,this.onActivate=new a.EventEmitter,this.onAddUndo=new a.EventEmitter,this.onBeforeAddUndo=new a.EventEmitter,this.onBeforeExecCommand=new a.EventEmitter,this.onBeforeGetContent=new a.EventEmitter,this.onBeforeRenderUI=new a.EventEmitter,this.onBeforeSetContent=new a.EventEmitter,this.onChange=new a.EventEmitter,this.onClearUndos=new a.EventEmitter,this.onDeactivate=new a.EventEmitter,this.onDirty=new a.EventEmitter,this.onExecCommand=new a.EventEmitter,this.onGetContent=new a.EventEmitter,this.onHide=new a.EventEmitter,this.onInit=new a.EventEmitter,this.onLoadContent=new a.EventEmitter,this.onNodeChange=new a.EventEmitter,this.onPostProcess=new a.EventEmitter,this.onPostRender=new a.EventEmitter,this.onPreInit=new a.EventEmitter,this.onPreProcess=new a.EventEmitter,this.onProgressState=new a.EventEmitter,this.onRedo=new a.EventEmitter,this.onRemove=new a.EventEmitter,this.onReset=new a.EventEmitter,this.onSaveContent=new a.EventEmitter,this.onSetAttrib=new a.EventEmitter,this.onObjectResizeStart=new a.EventEmitter,this.onObjectResized=new a.EventEmitter,this.onObjectSelected=new a.EventEmitter,this.onSetContent=new a.EventEmitter,this.onShow=new a.EventEmitter,this.onSubmit=new a.EventEmitter,this.onUndo=new a.EventEmitter,this.onVisualAid=new a.EventEmitter}var c,h,m=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],f=function(n,i){m.forEach(function(t){var e=n[t];i.on(t.substring(2),function(t){return n.ngZone.run(function(){return e.emit({event:t,editor:i})})})})},y=0,E=function(t){var e=(new Date).getTime();return t+"_"+Math.floor(1e9*Math.random())+ ++y+String(e)},g=function(t){return void 0!==t&&"textarea"===t.tagName.toLowerCase()},v=function(t){return void 0===t||""===t?[]:Array.isArray(t)?t:t.split(" ")},_=function(t,e){return v(t).concat(v(e))},b=function(){},O=function(t){return null===t||t===undefined},w=function(){return{listeners:[],scriptId:E("tiny-script"),scriptLoaded:!1}},C=(c=w(),{load:function(t,e,n){c.scriptLoaded?n():(c.listeners.push(n),t.getElementById(c.scriptId)||function(t,e,n,i){var o=e.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.id=t,o.src=n;var r=function(){o.removeEventListener("load",r),i()};o.addEventListener("load",r),e.head&&e.head.appendChild(o)}(c.scriptId,t,e,function(){c.listeners.forEach(function(t){return t()}),c.scriptLoaded=!0}))},reinitialize:function(){c=w()}}),S=new a.InjectionToken("TINYMCE_SCRIPT_SRC"),P={provide:n.NG_VALUE_ACCESSOR,useExisting:a.forwardRef(function(){return I}),multi:!0},I=(function B(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(F,h=p),Object.defineProperty(F.prototype,"disabledClass",{get:function(){return this._disabled},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"readonlyClass",{get:function(){return this._readOnly},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled=t,this._editor&&this._editor.initialized&&(this._editor.setMode(t?"readonly":"design"),this.setDivElement(t),this.editorBlured())},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"readOnly",{get:function(){return this._readOnly},set:function(t){this._readOnly=t,this._editor&&this._editor.initialized&&(this._editor.setMode(t?"readonly":"design"),this.setDivElement(t),this.editorBlured())},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"editor",{get:function(){return this._editor},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"fontFamilyList",{get:function(){return this._fontFamilyList},set:function(t){t&&(this._fontFamilyList=t)},enumerable:!0,configurable:!0}),Object.defineProperty(F.prototype,"defaultFontFamily",{get:function(){return this._defaultFontFamily},set:function(t){t&&(this._defaultFontFamily=t)},enumerable:!0,configurable:!0}),F.prototype.ngOnInit=function(){var o=this;this.init={selector:"textarea",menubar:!1,inline:!1,plugins:["advlist autolink lists link image charmap print preview anchor textcolor powerpaste","searchreplace visualblocks code fullscreen","insertdatetime media table image imagetools code help nonbreaking"],language:this.localeIds[this.currentLocale],toolbar:"undo redo | formatselect fontsizeselect fontselect | bold italic underline strikethrough forecolor backcolor link |         alignleft aligncenter alignright alignjustify |         bullist numlist outdent indent table image | removeformat",min_height:100,fontsize_formats:"12px 14px 16px 18px 24px 36px 48px 56px 72px",font_formats:"微软雅黑=Microsoft YaHei,Helvetica Neue,PingFang SC,sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;宋体=simsun,serif;仿宋体=FangSong,serif;黑体=SimHei,sans-serif;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;",images_upload_url:"postAcceptor.php",images_upload_handler:function(t,e,n){if(o.beforeUpload)o.beforeUpload(t).subscribe(function(t){e(t)},function(t){n(t)});else{var i=new FileReader;i.readAsDataURL(t.blob()),i.onload=function(){e(this.result)}}},branding:!1,readonly:!1,setup:null,end_container_on_empty_block:!0,powerpaste_word_import:"propmt",powerpaste_html_import:"propmt",powerpaste_allow_local_images:!0,paste_data_images:!0,autoresize_min_height:100,autoresize_max_height:800,autoresize_on_init:!0,autoresize_overflow_padding:0,nonbreaking_force_tab:!0,default_link_target:"_blank"}},F.prototype.editorBlured=function(){var e=this;setTimeout(function(){var t=e._editor.iframeElement.contentWindow.document.getElementsByClassName(e.editorBodyCls);t&&t.length&&t[0].blur()},0)},F.prototype.writeValue=function(t){this._editor&&this._editor.initialized?(this._editor.setContent(O(t)?"":t),this._divElement.innerHTML=O(t)?"":t):this.initialValue=null===t?undefined:t,!this.__WEBPAGEURL__&&this.router&&(this.__WEBPAGEURL__=this.router.url)},F.prototype.registerOnChange=function(t){this.onChangeCallback=t},F.prototype.registerOnTouched=function(t){this.onTouchedCallback=t},F.prototype.setDisabledState=function(t){this._editor?this._editor.setMode(t?"readonly":"design"):t&&(this.init=r({},this.init,{readonly:!0}))},F.prototype.ngAfterViewInit=function(){e.isPlatformBrowser(this.platformId)&&(this.editorId=this.editorId||E("tiny-angular"),this.inline="undefined"!=typeof this.inline?"boolean"!=typeof this.inline||this.inline:this.init&&this.init.inline,this.createElement(),this.init.selector="#"+this.editorId,l()?this.initialise():this._element&&this._element.ownerDocument&&C.load(this._element.ownerDocument,this.getScriptSrc(),this.initialise))},F.prototype.ngOnDestroy=function(){this.__WEBPAGEURL__="",this._editor&&(this._editor.remove(),this._editor=null,this._divElement=null)},F.prototype.createElement=function(){var t="string"==typeof this.tagName?this.tagName:"div";this._element=document.createElement(this.inline?t:"textarea"),this._element.setAttribute("class","d-none"),this._divElement=document.createElement("div"),this.showBorder?this._divElement.className="farris-editor-placeholder":this._divElement.className="farris-editor-placeholder farris-editor-placeholder-border",this._render.setStyle(this._divElement,"height",this.height+"px"),this._element&&(this._element.id=this.editorId,g(this._element)&&(this._element.style.visibility="hidden"),this._elementRef.nativeElement.appendChild(this._element),this._elementRef.nativeElement.appendChild(this._divElement))},F.prototype.initialise=function(){var n=this,t=r({},this.init,{target:this._element,inline:this.inline,plugins:_(this.init&&this.init.plugins,this.plugins),toolbar:this.toolbar||this.init&&this.init.toolbar,height:this.height,autoresize_max_height:this.autoresizeMaxHeight,setup:function(e){(n._editor=e).on("init",function(t){n.initEditor(e),n._readOnly||n._disabled?n._editor.setMode("readonly"):n._editor.setMode("design"),setTimeout(function(){n.setDivElement(n._readOnly||n._disabled)},0)}),e.on("PastePostProcess",function(t){n.replaceFontFamily(t.node)}),f(n,e),n.init&&"function"==typeof n.init.setup&&n.init.setup(e)}});g(this._element)&&(this._element.style.visibility=""),this.ngZone.runOutsideAngular(function(){setTimeout(function(){l().init(t)},0)})},F.prototype.setDivElement=function(t){t?this._divElement.classList.remove("d-none"):this._divElement.classList.add("d-none")},F.prototype.getScriptSrc=function(){return O(this.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+this.apiKey+"/tinymce/"+this.cloudChannel+"/tinymce.min.js":this.tinymceScriptSrc},F.prototype.initEditor=function(t){var e=this;t.on("blur",function(){return e.ngZone.run(function(){return e.onTouchedCallback()})}),t.on(this.modelEvents,function(){e.ngZone.run(function(){e.onChangeCallback(t.getContent({format:e.outputFormat})),e._divElement.innerHTML=t.getContent({format:e.outputFormat})})}),"string"==typeof this.initialValue&&this.ngZone.run(function(){t.setContent(e.initialValue),e._divElement.innerHTML=e.initialValue,e.onChangeCallback(t.getContent({format:e.outputFormat}))})},F.prototype.replaceFontFamily=function(t){if(t.children&&t.children.length)for(var e=0;e<t.children.length;e++)this.replaceFontFamily(t.children[e]);var n=t.style.fontFamily,i=t.getAttribute("face");if(n){var o=n.split(","),r=this.getFontFamilyArray(o);t.style.fontFamily=r}if(i){var s=i.split(",");r=this.getFontFamilyArray(s),t.setAttribute("face",r)}},F.prototype.getFontFamilyArray=function(t,n){var i=this;void 0===n&&(n=this._fontFamilyList);var o=[];t.forEach(function(e){n.find(function(t){return t===i.trim(e)})&&o.push(i.trim(e))});var e=o.join(",");return e=e||this._defaultFontFamily},F.prototype.trim=function(t){return t.replace(/^\s*|\s*$/g,"")},F.decorators=[{type:a.Component,args:[{selector:"farris-editor",template:"<ng-template></ng-template>",providers:[P],encapsulation:a.ViewEncapsulation.None,styles:[":host{display:block}.farris-editor .mce-tinymce .mce-toolbar .mce-btn-group>div{white-space:pre-wrap}.farris-editor .mce-tinymce{box-sizing:border-box;box-shadow:none}.farris-editor .mce-panel,.farris-editor .mce-tinymce{border-color:#d8dce6}.farris-editor.farris-editor-disabled .mce-statusbar,.farris-editor.farris-editor-disabled .mce-top-part,.farris-editor.farris-editor-readonly .mce-statusbar,.farris-editor.farris-editor-readonly .mce-top-part{display:none}.farris-editor.farris-editor-disabled .mce-edit-area,.farris-editor.farris-editor-readonly .mce-edit-area{border-top:none}.farris-editor.farris-editor-disabled.farris-editor-border .mce-tinymce,.farris-editor.farris-editor-readonly.farris-editor-border .mce-tinymce{border-width:0 0 1px!important}"]}]}],F.ctorParameters=function(){return[{type:a.ElementRef},{type:a.NgZone},{type:Object,decorators:[{type:a.Inject,args:[a.PLATFORM_ID]}]},{type:a.Injector,decorators:[{type:a.Optional}]},{type:String,decorators:[{type:a.Optional},{type:a.Inject,args:[S]}]}]},F.propDecorators={rootClass:[{type:a.HostBinding,args:["class"]}],disabledClass:[{type:a.HostBinding,args:["class.farris-editor-disabled"]}],readonlyClass:[{type:a.HostBinding,args:["class.farris-editor-readonly"]}],disabled:[{type:a.Input}],readOnly:[{type:a.Input}],cloudChannel:[{type:a.Input}],apiKey:[{type:a.Input}],editorId:[{type:a.Input}],initialValue:[{type:a.Input}],outputFormat:[{type:a.Input}],inline:[{type:a.Input}],tagName:[{type:a.Input}],plugins:[{type:a.Input}],toolbar:[{type:a.Input}],modelEvents:[{type:a.Input}],height:[{type:a.Input}],autoresizeMaxHeight:[{type:a.Input}],showBorder:[{type:a.Input},{type:a.HostBinding,args:["class.farris-editor-border"]}],fontFamilyList:[{type:a.Input}],defaultFontFamily:[{type:a.Input}],beforeUpload:[{type:a.Input}]},F);function F(t,e,n,i,o){var r=h.call(this)||this;return r.platformId=n,r.injector=i,r.tinymceScriptSrc=o,r.rootClass="farris-editor",r.localeIds={en:"es","zh-CHS":"zh_CN"},r.currentLocale="zh-CHS",r.cloudChannel="5",r.apiKey="no-api-key",r.editorId="",r.modelEvents="change keyup undo redo",r.height=100,r.autoresizeMaxHeight=800,r.showBorder=!0,r._fontFamilyList=["Microsoft YaHei","Helvetica Neue","PingFang SC","sans-serif","simsun","serif","SimHei","arial","helvetica","arial black","avant garde","book antiqua","palatino","FangSong"],r._defaultFontFamily="Microsoft YaHei",r.onTouchedCallback=b,r.onChangeCallback=b,r.__WEBPAGEURL__="",r.editorBodyCls="mce-content-body",r._elementRef=t,r.ngZone=e,r._render=r.injector.get(a.Renderer2),r.initialise=r.initialise.bind(r),r.injector&&(r.currentLocale=r.injector.get(a.LOCALE_ID),r.editorService=r.injector.get(u),r.router=r.injector.get(s.Router,null),r.router&&r.router.events.subscribe(function(t){t instanceof s.NavigationStart?r.__WEBPAGEURL__||(r.__WEBPAGEURL__=t.url):t instanceof s.NavigationEnd&&r.__WEBPAGEURL__===t.url&&r.editor&&(r.editor.destroy(),r.initialise())})),r}var M=(D.forRoot=function(t){return{ngModule:D,providers:[{provide:S,useValue:t}]}},D.decorators=[{type:a.NgModule,args:[{declarations:[I],imports:[e.CommonModule,n.FormsModule],exports:[I],providers:[u]}]}],D);function D(){}t.EditorService=u,t.TINYMCE_SCRIPT_SRC=S,t.EditorComponent=I,t.EditorModule=M,t.Events=p,t.validEvents=m,t.getTinymce=l,t.ScriptLoader=C,t.bindHandlers=f,t.uuid=E,t.isTextarea=g,t.normalizePluginArray=v,t.mergePlugins=_,t.noop=b,t.isNullOrUndefined=O,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-editor.umd.min.js.map