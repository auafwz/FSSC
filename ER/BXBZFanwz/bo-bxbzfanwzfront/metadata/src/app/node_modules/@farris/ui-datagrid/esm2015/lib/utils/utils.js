/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:53
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-19 20:31:27
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
export class Utils {
    /**
     * @return {?}
     */
    static uuid() {
        /**
         * @return {?}
         */
        function S4() {
            // tslint:disable-next-line: no-bitwise
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }
        return (S4() + S4() + '-' + S4() + '-' + S4() + '-' + S4() + '-' + S4() + S4() + S4());
    }
    /**
     * 获取对象中指定字段的值。 field: 可以为带有层级结构的路径，如： user.firstName | name 等
     * @param {?} field
     * @param {?} data
     * @param {?=} safe
     * @return {?}
     */
    static getValue(field, data, safe = false) {
        if (!data) {
            return '';
        }
        /** @type {?} */
        let resultVal = '';
        if (field.indexOf('.') === -1 || data.hasOwnProperty(field)) {
            resultVal = data[field];
        }
        else {
            resultVal = field.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            (obj, key) => {
                if (obj) {
                    return obj[key];
                }
                else {
                    return null;
                }
            }), data);
        }
        if (safe) {
            return this.escapeValue(resultVal);
        }
        return resultVal;
    }
    /**
     * @param {?} field
     * @param {?} val
     * @param {?} obj
     * @param {?=} nest
     * @return {?}
     */
    static setValue(field, val, obj, nest = true) {
        if (field) {
            if (field.indexOf('.') > -1 && nest) {
                /** @type {?} */
                let lastObj = null;
                /** @type {?} */
                const _fields = field.split('.');
                _fields.reduce((/**
                 * @param {?} c
                 * @param {?} p
                 * @return {?}
                 */
                (c, p) => {
                    lastObj = c;
                    return c[p];
                }), obj);
                if (lastObj) {
                    lastObj[_fields.pop()] = val;
                }
            }
            else {
                obj[field] = val;
            }
        }
    }
    /**
     * 获取多语值
     * @param {?} valObj
     * @param {?} localeId
     * @return {?}
     */
    static getMultilingualValue(valObj, localeId) {
        if (valObj && typeof valObj === 'object' && Object.keys(valObj).length > 0) {
            localeId = localeId || 'zh-CHS';
            /** @type {?} */
            const val = valObj[localeId];
            if (val !== undefined) {
                return val;
            }
            else {
                console.log(`can not find '${localeId}' in `, valObj);
                return '';
            }
        }
        else {
            return '';
        }
    }
    /**
     * @param {?} val
     * @return {?}
     */
    static escapeValue(val) {
        if (val === null || val === undefined || val === '') {
            return '';
        }
        /** @type {?} */
        const escapeHTML = (/**
         * @param {?} unsafe_str
         * @return {?}
         */
        (unsafe_str) => {
            return unsafe_str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\"/g, '&quot;')
                .replace(/\'/g, '&#39;')
                .replace(/\//g, '&#x2F;');
            // .replace('src','drc');
        });
        if (typeof val === 'string') {
            return escapeHTML(val);
        }
        return val;
    }
    /**
     * @param {?} evt
     * @return {?}
     */
    static eventPath(evt) {
        /** @type {?} */
        const path = (evt.composedPath && evt.composedPath()) || evt.path;
        /** @type {?} */
        const target = evt.target;
        if (path != null) {
            return (path.indexOf(window) < 0) ? path.concat(window) : path;
        }
        if (target === window) {
            return [window];
        }
        /** @type {?} */
        const getParents = (/**
         * @param {?} node
         * @param {?=} memo
         * @return {?}
         */
        (node, memo = undefined) => {
            memo = memo || [];
            /** @type {?} */
            const parentNode = node.parentNode;
            if (!parentNode) {
                return memo;
            }
            else {
                return getParents(parentNode, memo.concat(parentNode));
            }
        });
        return [target].concat(getParents(target), window);
    }
    /**
     * @return {?}
     */
    static hasDialogOpen() {
        // return document.body.classList.value.indexOf('modal-open') > -1;
        // 兼容IE 11
        return document.body.className.indexOf('modal-open') > -1;
    }
    /**
     * @param {?} el
     * @param {?} evt
     * @param {?} fn
     * @param {?=} opts
     * @return {?}
     */
    static on(el, evt, fn, opts = {}) {
        /** @type {?} */
        const delegatorFn = (/**
         * @param {?} e
         * @return {?}
         */
        e => e.target.matches(opts.target) && fn.call(e.target, e));
        el.addEventListener(evt, opts.target ? delegatorFn : fn, opts.options || false);
        return (/**
         * @return {?}
         */
        () => {
            el.removeEventListener(evt, delegatorFn, opts);
        });
    }
    /**
     * @param {?} el
     * @param {?} evt
     * @param {?=} fn
     * @param {?=} opts
     * @return {?}
     */
    static off(el, evt, fn = (/**
     * @return {?}
     */
    () => { }), opts = {}) {
        el.removeEventListener(evt, fn, opts);
    }
    /**
     * 获取字符长度，中文汉字占2个字符
     * @param {?} str
     * @return {?}
     */
    static getBLen(str) {
        if (str == null) {
            return 0;
        }
        if (typeof str !== 'string') {
            str += '';
        }
        return str.replace(/[^\x00-\xff]/g, '01').length;
    }
    // static difference(first: any[], second: any[]): any[] {
    //     return first.filter(item => !second.includes(item));
    // }
    // static getDiffItems(arr1, arr2) {
    //     const diff1 = Utils.difference(arr1, arr2);
    //     const diff2 = Utils.difference(arr2, arr1);
    //     return diff1.concat(diff2);
    // }
    /**
     * @param {?} col
     * @param {?} localeId
     * @return {?}
     */
    static getWhenEmptyText(col, localeId) {
        /** @type {?} */
        const EMPTY_INPUT_TEXT = {
            'zh-CHS': '请输入',
            'zh-CHT': '請輸入',
            en: 'Please input'
        };
        /** @type {?} */
        const EMPTY_SELECT_TEXT = {
            'zh-CHS': '请选择',
            'zh-CHT': '請選擇',
            en: 'Please select'
        };
        if (col.editor) {
            switch (col.editor.type) {
                case 'datepicker':
                case 'select':
                case 'lookup':
                case 'combolist':
                case 'combo-lookup':
                    return EMPTY_SELECT_TEXT[localeId];
                default:
                    return EMPTY_INPUT_TEXT[localeId];
            }
        }
        // 控制面板列
        if (col.field === '_datagrid-setting-control_') {
            return '';
        }
        return EMPTY_INPUT_TEXT[localeId];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3V0aWxzL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVFBLE1BQU0sT0FBTyxLQUFLOzs7O0lBRWQsTUFBTSxDQUFDLElBQUk7Ozs7UUFDUCxTQUFTLEVBQUU7WUFDUCx1Q0FBdUM7WUFDdkMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRSxDQUFDO1FBQ0QsT0FBTyxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxHQUFHLEdBQUcsR0FBRyxFQUFFLEVBQUUsR0FBRyxHQUFHLEdBQUcsRUFBRSxFQUFFLEdBQUcsR0FBRyxHQUFHLEVBQUUsRUFBRSxHQUFHLEdBQUcsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzNGLENBQUM7Ozs7Ozs7O0lBTUQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFhLEVBQUUsSUFBUyxFQUFFLElBQUksR0FBRyxLQUFLO1FBQ2xELElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDUCxPQUFRLEVBQUUsQ0FBQztTQUNkOztZQUNHLFNBQVMsR0FBRyxFQUFFO1FBQ2xCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3pELFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDM0I7YUFBTTtZQUNILFNBQVMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1B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QWdCLENBQUMsR0FBUSxFQUFFLFFBQVE7O2NBRWhDLGdCQUFnQixHQUFHO1lBQ3JCLFFBQVEsRUFBRSxLQUFLO1lBQ2YsUUFBUSxFQUFFLEtBQUs7WUFDZixFQUFFLEVBQUUsY0FBYztTQUNyQjs7Y0FFSyxpQkFBaUIsR0FBRztZQUN0QixRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVEsRUFBRSxLQUFLO1lBQ2YsRUFBRSxFQUFFLGVBQWU7U0FDdEI7UUFHRCxJQUFJLEdBQUcsQ0FBQyxNQUFNLEVBQUU7WUFDWixRQUFRLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO2dCQUNyQixLQUFLLFlBQVksQ0FBQztnQkFDbEIsS0FBSyxRQUFRLENBQUM7Z0JBQ2QsS0FBSyxRQUFRLENBQUM7Z0JBQ2QsS0FBSyxXQUFXLENBQUM7Z0JBQ2pCLEtBQUssY0FBYztvQkFDZixPQUFRLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN4QztvQkFDSSxPQUFPLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ3pDO1NBQ0o7UUFFRCxRQUFRO1FBQ1IsSUFBSSxHQUFHLENBQUMsS0FBSyxLQUFLLDRCQUE0QixFQUFFO1lBQzVDLE9BQU8sRUFBRSxDQUFDO1NBQ2I7UUFFRCxPQUFPLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMDYgMDc6NDM6NTNcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMTkgMjA6MzE6MjdcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmV4cG9ydCBjbGFzcyBVdGlscyB7XHJcblxyXG4gICAgc3RhdGljIHV1aWQoKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gUzQoKSB7XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tYml0d2lzZVxyXG4gICAgICAgICAgICByZXR1cm4gKCgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCkgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gKFM0KCkgKyBTNCgpICsgJy0nICsgUzQoKSArICctJyArIFM0KCkgKyAnLScgKyBTNCgpICsgJy0nICsgUzQoKSArIFM0KCkgKyBTNCgpKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blr7nosaHkuK3mjIflrprlrZfmrrXnmoTlgLzjgIIgZmllbGQ6IOWPr+S7peS4uuW4puacieWxgue6p+e7k+aehOeahOi3r+W+hO+8jOWmgu+8miB1c2VyLmZpcnN0TmFtZSB8IG5hbWUg562JXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBnZXRWYWx1ZShmaWVsZDogc3RyaW5nLCBkYXRhOiBhbnksIHNhZmUgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcmVzdWx0VmFsID0gJyc7XHJcbiAgICAgICAgaWYgKGZpZWxkLmluZGV4T2YoJy4nKSA9PT0gLTEgfHwgZGF0YS5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gZGF0YVtmaWVsZF07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gZmllbGQuc3BsaXQoJy4nKS5yZWR1Y2UoKG9iaiwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialtrZXldO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2FmZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lc2NhcGVWYWx1ZShyZXN1bHRWYWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0VmFsO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBzZXRWYWx1ZSggZmllbGQ6IHN0cmluZywgdmFsOiBhbnksIG9iajogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgbmVzdCA9IHRydWUpIHtcclxuICAgICAgICBpZiAoZmllbGQpIHtcclxuICAgICAgICAgICAgaWYgKGZpZWxkLmluZGV4T2YoJy4nKSA+IC0xICYmIG5lc3QpIHtcclxuICAgICAgICAgICAgICAgIGxldCBsYXN0T2JqID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9maWVsZHMgPSBmaWVsZC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgX2ZpZWxkcy5yZWR1Y2UoIChjLCBwKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFzdE9iaiA9IGM7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNbcF07XHJcbiAgICAgICAgICAgICAgICB9LCBvYmopO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChsYXN0T2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFzdE9ialtfZmllbGRzLnBvcCgpXSA9IHZhbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9ialtmaWVsZF0gPSB2YWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiOt+WPluWkmuivreWAvCAqL1xyXG4gICAgc3RhdGljIGdldE11bHRpbGluZ3VhbFZhbHVlKHZhbE9iaiwgbG9jYWxlSWQpIHtcclxuICAgICAgICBpZiAodmFsT2JqICYmIHR5cGVvZiB2YWxPYmogPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKHZhbE9iaikubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBsb2NhbGVJZCA9IGxvY2FsZUlkIHx8ICd6aC1DSFMnO1xyXG4gICAgICAgICAgICBjb25zdCB2YWwgPSB2YWxPYmpbbG9jYWxlSWRdO1xyXG4gICAgICAgICAgICBpZiAodmFsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgY2FuIG5vdCBmaW5kICcke2xvY2FsZUlkfScgaW4gYCwgdmFsT2JqKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHN0YXRpYyBlc2NhcGVWYWx1ZSh2YWw6IGFueSkge1xyXG4gICAgICAgIGlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQgfHwgdmFsID09PSAnJykge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBlc2NhcGVIVE1MID0gKHVuc2FmZV9zdHIpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuc2FmZV9zdHJcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxcIi9nLCAnJnF1b3Q7JylcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCcvZywgJyYjMzk7JylcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXC8vZywgJyYjeDJGOycpO1xyXG4gICAgICAgICAgICAgICAgLy8gLnJlcGxhY2UoJ3NyYycsJ2RyYycpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXNjYXBlSFRNTCh2YWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZXZlbnRQYXRoKGV2dDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcGF0aCA9IChldnQuY29tcG9zZWRQYXRoICYmIGV2dC5jb21wb3NlZFBhdGgoKSkgfHwgZXZ0LnBhdGg7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcclxuXHJcbiAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKHBhdGguaW5kZXhPZih3aW5kb3cpIDwgMCkgPyBwYXRoLmNvbmNhdCh3aW5kb3cpIDogcGF0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0YXJnZXQgPT09IHdpbmRvdykge1xyXG4gICAgICAgICAgICByZXR1cm4gW3dpbmRvd107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBnZXRQYXJlbnRzID0gKG5vZGUsIG1lbW8gPSB1bmRlZmluZWQpID0+IHtcclxuICAgICAgICAgICAgbWVtbyA9IG1lbW8gfHwgW107XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXBhcmVudE5vZGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtZW1vO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFBhcmVudHMocGFyZW50Tm9kZSwgbWVtby5jb25jYXQocGFyZW50Tm9kZSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIFt0YXJnZXRdLmNvbmNhdChnZXRQYXJlbnRzKHRhcmdldCksIHdpbmRvdyk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGhhc0RpYWxvZ09wZW4oKSB7XHJcbiAgICAgICAgLy8gcmV0dXJuIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnZhbHVlLmluZGV4T2YoJ21vZGFsLW9wZW4nKSA+IC0xO1xyXG4gICAgICAgIC8vIOWFvOWuuUlFIDExXHJcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lLmluZGV4T2YoJ21vZGFsLW9wZW4nKSA+IC0xO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBvbihlbCwgZXZ0LCBmbiwgb3B0czogYW55ID0ge30pIHtcclxuICAgICAgICBjb25zdCBkZWxlZ2F0b3JGbiA9IGUgPT4gZS50YXJnZXQubWF0Y2hlcyhvcHRzLnRhcmdldCkgJiYgZm4uY2FsbChlLnRhcmdldCwgZSk7XHJcbiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihldnQsIG9wdHMudGFyZ2V0ID8gZGVsZWdhdG9yRm4gOiBmbiwgb3B0cy5vcHRpb25zIHx8IGZhbHNlKTtcclxuICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2dCwgZGVsZWdhdG9yRm4sIG9wdHMpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIG9mZihlbCwgZXZ0LCBmbj0gKCkgPT4ge30sIG9wdHM6IGFueSA9IHt9KSB7XHJcbiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihldnQsIGZuLCBvcHRzKTtcclxuICAgIH1cclxuICAgIC8qKiDojrflj5blrZfnrKbplb/luqbvvIzkuK3mlofmsYnlrZfljaAy5Liq5a2X56ymICovXHJcbiAgICBzdGF0aWMgZ2V0QkxlbihzdHIpIHtcclxuICAgICAgICBpZiAoc3RyID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgc3RyICs9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1teXFx4MDAtXFx4ZmZdL2csICcwMScpLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzdGF0aWMgZGlmZmVyZW5jZShmaXJzdDogYW55W10sIHNlY29uZDogYW55W10pOiBhbnlbXSB7XHJcbiAgICAvLyAgICAgcmV0dXJuIGZpcnN0LmZpbHRlcihpdGVtID0+ICFzZWNvbmQuaW5jbHVkZXMoaXRlbSkpO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIHN0YXRpYyBnZXREaWZmSXRlbXMoYXJyMSwgYXJyMikge1xyXG4gICAgLy8gICAgIGNvbnN0IGRpZmYxID0gVXRpbHMuZGlmZmVyZW5jZShhcnIxLCBhcnIyKTtcclxuICAgIC8vICAgICBjb25zdCBkaWZmMiA9IFV0aWxzLmRpZmZlcmVuY2UoYXJyMiwgYXJyMSk7XHJcblxyXG4gICAgLy8gICAgIHJldHVybiBkaWZmMS5jb25jYXQoZGlmZjIpO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIHN0YXRpYyBnZXRXaGVuRW1wdHlUZXh0KGNvbDogYW55LCBsb2NhbGVJZCkge1xyXG5cclxuICAgICAgICBjb25zdCBFTVBUWV9JTlBVVF9URVhUID0ge1xyXG4gICAgICAgICAgICAnemgtQ0hTJzogJ+ivt+i+k+WFpScsXHJcbiAgICAgICAgICAgICd6aC1DSFQnOiAn6KuL6Ly45YWlJyxcclxuICAgICAgICAgICAgZW46ICdQbGVhc2UgaW5wdXQnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgRU1QVFlfU0VMRUNUX1RFWFQgPSB7XHJcbiAgICAgICAgICAgICd6aC1DSFMnOiAn6K+36YCJ5oupJyxcclxuICAgICAgICAgICAgJ3poLUNIVCc6ICfoq4vpgbjmk4cnLFxyXG4gICAgICAgICAgICBlbjogJ1BsZWFzZSBzZWxlY3QnXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGlmIChjb2wuZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoY29sLmVkaXRvci50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRlcGlja2VyJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3NlbGVjdCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdsb29rdXAnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnY29tYm9saXN0JzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbWJvLWxvb2t1cCc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICBFTVBUWV9TRUxFQ1RfVEVYVFtsb2NhbGVJZF07XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBFTVBUWV9JTlBVVF9URVhUW2xvY2FsZUlkXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5o6n5Yi26Z2i5p2/5YiXXHJcbiAgICAgICAgaWYgKGNvbC5maWVsZCA9PT0gJ19kYXRhZ3JpZC1zZXR0aW5nLWNvbnRyb2xfJykge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gRU1QVFlfSU5QVVRfVEVYVFtsb2NhbGVJZF07XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==