/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, NgZone } from '@angular/core';
import { fromEvent, Subject } from 'rxjs';
import { throttleTime, debounceTime } from 'rxjs/operators';
import { animationFrame } from 'rxjs/internal/scheduler/animationFrame';
import * as i0 from "@angular/core";
/**
 * @record
 */
function ScrollElement() { }
if (false) {
    /** @type {?} */
    ScrollElement.prototype.element;
    /** @type {?} */
    ScrollElement.prototype.id;
}
/**
 * @record
 */
function ScrollSpy() { }
if (false) {
    /** @type {?} */
    ScrollSpy.prototype.elements;
    /** @type {?} */
    ScrollSpy.prototype.currentSectionId;
    /** @type {?} */
    ScrollSpy.prototype.subject;
    /** @type {?|undefined} */
    ScrollSpy.prototype.clickChange;
}
/**
 * @record
 */
function ScrollSpies() { }
/**
 * @record
 */
function ScrollFollow() { }
if (false) {
    /** @type {?} */
    ScrollFollow.prototype.element;
    /** @type {?} */
    ScrollFollow.prototype.id;
}
/**
 * @record
 */
function ScrollFollowSpipes() { }
/**
 * @record
 */
function ScrollContents() { }
/**
 * @record
 */
function Offsets() { }
/**
 * @record
 */
function ScrollChange() { }
/**
 * @record
 */
function CurrentId() { }
if (false) {
    /** @type {?} */
    CurrentId.prototype.subject;
    /** @type {?} */
    CurrentId.prototype.idValue;
}
/**
 * @record
 */
function CurrentIdObj() { }
var FarrisScrollSpyService = /** @class */ (function () {
    function FarrisScrollSpyService(ngzone) {
        this.ngzone = ngzone;
        // 监听区块当前时候的样式
        this.scrollSpyPartActiveClsName = 'f-scrollspy-part-active';
        this.fixedTabContainerClsName = 'f-scrollspy-container-fixed';
        /**
         * 被监听滚动的contents
         */
        this.scrollContents = {};
        /**
         * 被监听滚动的sections
         */
        this.scrollSpies = {};
        /**
         * 监听滚动的锚点部分
         */
        this.scrollFollowSpipes = {};
        this.scrollSpyListFollowTypeChanges = {};
        /**
         * 滚动监听偏移距离
         */
        this.offsets = {};
        /**
         * 默认监听分组名称
         */
        this.defaultId = 'default';
        // currentSectionId: Subject<any> = new Subject();
        this.currentSectionIdObj = {};
        this.scrollChange = {};
    }
    //获取currentid
    //获取currentid
    /**
     * @param {?} groupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.getCurrentSectionId = 
    //获取currentid
    /**
     * @param {?} groupId
     * @return {?}
     */
    function (groupId) {
        if (!groupId) {
            groupId = this.defaultId;
        }
        return this.currentSectionIdObj[groupId].subject;
        // return this.currentSectionId;
    };
    //滚动变化时改变currentid
    //滚动变化时改变currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setCurrentSectionId = 
    //滚动变化时改变currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    function (groupId, value) {
        if (!groupId) {
            groupId = this.defaultId;
        }
        this.currentSectionIdObj[groupId].subject.next(value);
        //console.log(this.currentSectionIdObj);
        // this.currentSectionId.next(value);
    };
    //设置不同group组的currentid
    //设置不同group组的currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setCurrentSectionIdObj = 
    //设置不同group组的currentid
    /**
     * @param {?} groupId
     * @param {?} value
     * @return {?}
     */
    function (groupId, value) {
        var _this = this;
        if (!groupId) {
            groupId = this.defaultId;
        }
        if (!this.currentSectionIdObj[groupId]) {
            this.currentSectionIdObj[groupId] = (/** @type {?} */ ({
                subject: new Subject(),
                idValue: value
            }));
        }
        else {
            this.currentSectionIdObj[groupId].idValue = value;
        }
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this.scrollFollowSpipes[groupId] && _this.scrollFollowSpipes[groupId].length) {
                /** @type {?} */
                var item = _this.scrollFollowSpipes[groupId].find((/**
                 * @param {?} scrollFollowItem
                 * @return {?}
                 */
                function (scrollFollowItem) {
                    return scrollFollowItem['id'] == _this.currentSectionIdObj[groupId].idValue;
                }));
                if (item) {
                    _this.fScrollFollowClick(groupId, item);
                }
            }
        }), 0);
        // this.fScrollFollowClick(key,follow);
    };
    /**
     * @return {?}
     */
    FarrisScrollSpyService.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.scrollSubscription.unsubscribe();
    };
    /**Observer部分 供指令初始化调用 */
    // public getCurrentSection$(scrollSpyId: string = this.defaultId): Observable<string> {
    //   if(scrollSpyId !== ''){
    //     return this.scrollChange[scrollSpyId];
    //   }
    //   else{
    //     return this.scrollChange[this.defaultId];
    //   }
    // }
    /**
     * Observer部分 供指令初始化调用
     * @param {?=} scrollSpyId
     * @return {?}
     */
    // public getCurrentSection$(scrollSpyId: string = this.defaultId): Observable<string> {
    //   if(scrollSpyId !== ''){
    //     return this.scrollChange[scrollSpyId];
    //   }
    //   else{
    //     return this.scrollChange[this.defaultId];
    //   }
    // }
    FarrisScrollSpyService.prototype.updateScrollGroup = /**
     * Observer部分 供指令初始化调用
     * @param {?=} scrollSpyId
     * @return {?}
     */
    // public getCurrentSection$(scrollSpyId: string = this.defaultId): Observable<string> {
    //   if(scrollSpyId !== ''){
    //     return this.scrollChange[scrollSpyId];
    //   }
    //   else{
    //     return this.scrollChange[this.defaultId];
    //   }
    // }
    function (scrollSpyId) {
        if (scrollSpyId === void 0) { scrollSpyId = this.defaultId; }
        /** @type {?} */
        var groupId = scrollSpyId !== '' ? scrollSpyId : this.defaultId;
        if (!this.scrollChange[groupId]) {
            this.scrollChange[groupId] = new Subject();
        }
        return this.scrollChange[groupId];
    };
    /**content部分滚动事件监听 */
    /**
     * content部分滚动事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    FarrisScrollSpyService.prototype.subscribeScroll = /**
     * content部分滚动事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.scrollSubscription = fromEvent(_this.scrollContents[key], 'scroll')
                .pipe(debounceTime(20, animationFrame))
                .subscribe((/**
             * @return {?}
             */
            function () {
                if (_this.scrollSpies[key]) {
                    var _a = _this.scrollSpies[key], currentSectionId = _a.currentSectionId, elements = _a.elements, subject_1 = _a.subject;
                    /** @type {?} */
                    var scrollTop_1 = _this.scrollContents[key].scrollTop;
                    /** @type {?} */
                    var topElementInView = elements.filter((/**
                     * @param {?} el
                     * @return {?}
                     */
                    function (el) {
                        return el.element.offsetTop <= scrollTop_1 + _this.offsets[key];
                    }));
                    if (!topElementInView || !topElementInView.length) {
                        return;
                    }
                    //console.log(topElementInView);
                    /** @type {?} */
                    var topElementId_1 = topElementInView[0].id;
                    //判断 点击是否是点击引起的滚动
                    if (_this.scrollSpies[key].clickChange) {
                        _this.scrollSpies[key].clickChange = false;
                        return;
                    }
                    else {
                        _this.scrollSpies[key].clickChange = false;
                        if (topElementId_1 !== currentSectionId) {
                            _this.scrollSpies[key].currentSectionId = topElementId_1;
                            _this.ngzone.run((/**
                             * @return {?}
                             */
                            function () {
                                subject_1.next(topElementId_1);
                            }));
                        }
                    }
                }
            }));
        }));
    };
    /**tab部分点击事件监听 */
    /**
     * tab部分点击事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    FarrisScrollSpyService.prototype.subscribeClick = /**
     * tab部分点击事件监听
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        //Object.keys(this.scrollFollowSpipes).forEach((key:string):void=>{
        if (this.scrollFollowSpipes[key] && this.scrollFollowSpipes[key].length) {
            this.scrollFollowSpipes[key].forEach((/**
             * @param {?} follow
             * @return {?}
             */
            function (follow) {
                fromEvent(follow.element, 'click')
                    .pipe(throttleTime(100))
                    .subscribe((/**
                 * @param {?} event
                 * @return {?}
                 */
                function (event) {
                    event.stopPropagation();
                    _this.fScrollFollowClick(key, follow);
                    // if(this.scrollSpies[key]){
                    //   const { currentSectionId, elements, subject } = this.scrollSpies[key];
                    //   this.scrollSpies[key].clickChange = true;
                    //   if(follow.id !== currentSectionId){
                    //     const topElementInView = elements.find(el => el.id === follow.id);
                    //     if(!topElementInView) { return; }
                    //     this.scrollSpies[key].currentSectionId = follow.id;
                    //     //this.scrollContents[key].offsetTop
                    //     this.scrollContents[key].scrollTop = Math.round(topElementInView.element.offsetTop - this.offsets[key]);
                    //     subject.next(follow.id);
                    //   }
                    // }
                }));
            }));
        }
        //});
    };
    /**
     * @param {?} key
     * @param {?} follow
     * @return {?}
     */
    FarrisScrollSpyService.prototype.fScrollFollowClick = /**
     * @param {?} key
     * @param {?} follow
     * @return {?}
     */
    function (key, follow) {
        if (this.scrollSpies[key]) {
            var _a = this.scrollSpies[key], currentSectionId = _a.currentSectionId, elements = _a.elements, subject = _a.subject;
            this.scrollSpies[key].clickChange = true;
            if (follow.id !== currentSectionId) {
                /** @type {?} */
                var topElementInView = elements.find((/**
                 * @param {?} el
                 * @return {?}
                 */
                function (el) { return el.id === follow.id; }));
                if (!topElementInView) {
                    return;
                }
                this.scrollSpies[key].currentSectionId = follow.id;
                //this.scrollContents[key].offsetTop
                if (this.scrollContents[key]) {
                    this.scrollContents[key].scrollTop = Math.round(topElementInView.element.offsetTop - this.offsets[key]);
                }
                subject.next(follow.id);
            }
        }
    };
    /**添加需要被滚动监听部分 */
    /**
     * 添加需要被滚动监听部分
     * @param {?} element
     * @param {?=} contentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.addContentElement = /**
     * 添加需要被滚动监听部分
     * @param {?} element
     * @param {?=} contentId
     * @return {?}
     */
    function (element, contentId) {
        if (contentId === void 0) { contentId = this.defaultId; }
        if (contentId !== '') {
            this.scrollContents[contentId] = element;
            this.subscribeScroll(contentId);
        }
        else {
            this.scrollContents[this.defaultId] = element;
            this.subscribeScroll(this.defaultId);
        }
        // 判断是有待改变的状态
        this.updateContainerClsName(contentId);
    };
    /**移除需要被滚动监听部分元素 */
    /**
     * 移除需要被滚动监听部分元素
     * @param {?=} contentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.removeContentElement = /**
     * 移除需要被滚动监听部分元素
     * @param {?=} contentId
     * @return {?}
     */
    function (contentId) {
        if (contentId === void 0) { contentId = this.defaultId; }
        /** @type {?} */
        var removeId = contentId !== '' ? contentId : this.defaultId;
        delete this.scrollSpies[removeId];
    };
    /**添加滚动监听tab部分元素*/
    /**
     * 添加滚动监听tab部分元素
     * @param {?} element
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.addFollowElement = /**
     * 添加滚动监听tab部分元素
     * @param {?} element
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    function (element, followId, followContentId) {
        if (followContentId === void 0) { followContentId = this.defaultId; }
        /** @type {?} */
        var groupId = followContentId !== '' ? followContentId : this.defaultId;
        /** @type {?} */
        var follow = {
            element: element,
            id: followId
        };
        if (!this.scrollFollowSpipes[groupId]) {
            this.scrollFollowSpipes[groupId] = [];
        }
        /** @type {?} */
        var follows = this.scrollFollowSpipes[groupId];
        follows.push(follow);
        this.scrollFollowSpipes[groupId] = follows;
        this.subscribeClick(groupId);
    };
    /**移除滚动监听tab部分元素 */
    /**
     * 移除滚动监听tab部分元素
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.removeFollowElement = /**
     * 移除滚动监听tab部分元素
     * @param {?} followId
     * @param {?=} followContentId
     * @return {?}
     */
    function (followId, followContentId) {
        if (followContentId === void 0) { followContentId = this.defaultId; }
        /** @type {?} */
        var elements = this.scrollFollowSpipes[followContentId].filter((/**
         * @param {?} el
         * @return {?}
         */
        function (el) {
            return el.id !== followId;
        }));
        if (!elements.length) {
            delete this.scrollFollowSpipes[followContentId];
            return;
        }
        this.scrollFollowSpipes[followContentId] = elements;
    };
    /**添加滚动监听锚点部分元素 */
    /**
     * 添加滚动监听锚点部分元素
     * @param {?} element
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.addElement = /**
     * 添加滚动监听锚点部分元素
     * @param {?} element
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    function (element, scrollId, scrollGroupId) {
        var _this = this;
        if (scrollGroupId === void 0) { scrollGroupId = this.defaultId; }
        if (!this.scrollSpies[scrollGroupId]) {
            this.scrollSpies[scrollGroupId] = (/** @type {?} */ ({
                elements: [],
                currentSectionId: '',
                subject: new Subject(),
            }));
            this.scrollSpies[scrollGroupId].subject
                .subscribe((/**
             * @param {?} currentSection
             * @return {?}
             */
            function (currentSection) {
                if (_this.scrollChange[scrollGroupId]) {
                    _this.scrollChange[scrollGroupId].next(currentSection);
                }
            }));
        }
        if (this.hasElement(scrollId, scrollGroupId)) {
            return;
        }
        /** @type {?} */
        var el = {
            element: element,
            id: scrollId
        }
        // 加入时，判断是否是当前
        ;
        // 加入时，判断是否是当前
        this.updateScrollSpyActiveClsName(scrollGroupId, el);
        /** @type {?} */
        var elements = this.scrollSpies[scrollGroupId].elements;
        elements.push(el);
        elements.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) { return b.element.getBoundingClientRect().top - a.element.getBoundingClientRect().top; }));
        this.scrollSpies[scrollGroupId].elements = elements;
    };
    /**移除滚动监听锚点部分元素 */
    /**
     * 移除滚动监听锚点部分元素
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.removeElement = /**
     * 移除滚动监听锚点部分元素
     * @param {?} scrollId
     * @param {?=} scrollGroupId
     * @return {?}
     */
    function (scrollId, scrollGroupId) {
        if (scrollGroupId === void 0) { scrollGroupId = this.defaultId; }
        /** @type {?} */
        var elements = this.scrollSpies[scrollGroupId].elements.filter((/**
         * @param {?} el
         * @return {?}
         */
        function (el) {
            return el.id !== scrollId;
        }));
        if (!elements.length) {
            delete this.scrollSpies[scrollGroupId];
            return;
        }
        this.scrollSpies[scrollGroupId].elements = elements;
    };
    /**判断scrollGroupId 是否有id名为elementId 的元素 */
    /**
     * 判断scrollGroupId 是否有id名为elementId 的元素
     * @private
     * @param {?} elementId
     * @param {?} scrollGroupId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.hasElement = /**
     * 判断scrollGroupId 是否有id名为elementId 的元素
     * @private
     * @param {?} elementId
     * @param {?} scrollGroupId
     * @return {?}
     */
    function (elementId, scrollGroupId) {
        return this.scrollSpies[scrollGroupId].elements.some((/**
         * @param {?} element
         * @return {?}
         */
        function (element) { return element.id === elementId; }));
    };
    /**设置offset */
    /**
     * 设置offset
     * @param {?=} offset
     * @param {?=} contentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setOffset = /**
     * 设置offset
     * @param {?=} offset
     * @param {?=} contentId
     * @return {?}
     */
    function (offset, contentId) {
        if (offset === void 0) { offset = 0; }
        if (contentId === void 0) { contentId = this.defaultId; }
        if (contentId !== '') {
            this.offsets[contentId] = offset;
        }
        else {
            this.offsets[this.defaultId] = offset;
        }
    };
    /*ScrollSpy组件(锚点列表区域）初始化预设defaultId */
    /*ScrollSpy组件(锚点列表区域）初始化预设defaultId */
    /**
     * @param {?} groupid
     * @return {?}
     */
    FarrisScrollSpyService.prototype.setGroupId = /*ScrollSpy组件(锚点列表区域）初始化预设defaultId */
    /**
     * @param {?} groupid
     * @return {?}
     */
    function (groupid) {
        if (groupid) {
            this.defaultId = groupid;
        }
    };
    /**
     * @return {?}
     */
    FarrisScrollSpyService.prototype.getGroupId = /**
     * @return {?}
     */
    function () {
        return this.defaultId;
    };
    /*改变 ScrollSpy组件（锚点列表区域）的显示状态时 */
    /*改变 ScrollSpy组件（锚点列表区域）的显示状态时 */
    /**
     * @param {?} groupid
     * @param {?} followTypeData
     * @return {?}
     */
    FarrisScrollSpyService.prototype.changeGroupIdFollowType = /*改变 ScrollSpy组件（锚点列表区域）的显示状态时 */
    /**
     * @param {?} groupid
     * @param {?} followTypeData
     * @return {?}
     */
    function (groupid, followTypeData) {
        this.scrollSpyListFollowTypeChanges[groupid] = followTypeData;
        this.updateContainerClsName(groupid);
    };
    /**
     * @private
     * @param {?} groupid
     * @return {?}
     */
    FarrisScrollSpyService.prototype.updateContainerClsName = /**
     * @private
     * @param {?} groupid
     * @return {?}
     */
    function (groupid) {
        // 没有待更新变化
        if (!this.scrollSpyListFollowTypeChanges.hasOwnProperty(groupid)) {
            return;
        }
        // container并不存在的时候
        if (!this.scrollContents.hasOwnProperty(groupid)) {
            return;
        }
        /** @type {?} */
        var followTypeData = this.scrollSpyListFollowTypeChanges[groupid];
        /** @type {?} */
        var containerEl = this.scrollContents[groupid];
        // Container的Element 
        if (followTypeData['prev'] == 'fixedTab') {
            //移除class
            containerEl.className = containerEl.className.replace(this.fixedTabContainerClsName, '');
        }
        else if (followTypeData['next'] == 'fixedTab') {
            // 增加class
            containerEl.className += ' ' + this.fixedTabContainerClsName;
        }
        this.scrollSpyListFollowTypeChanges[groupid] = null;
    };
    /**
     * @param {?} groupId
     * @param {?} currentId
     * @return {?}
     */
    FarrisScrollSpyService.prototype.updateScrollSpiesActiveClsName = /**
     * @param {?} groupId
     * @param {?} currentId
     * @return {?}
     */
    function (groupId, currentId) {
        var _this = this;
        // 追加、移除class
        this.scrollSpies[groupId].elements.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (item.id == currentId) {
                // 找到当前
                if (item.element.className.indexOf(_this.scrollSpyPartActiveClsName) < 0) {
                    item.element.className += ' ' + _this.scrollSpyPartActiveClsName;
                }
            }
            else {
                // 其他
                item.element.className = item.element.className.replace(_this.scrollSpyPartActiveClsName, '');
            }
        }));
    };
    /**
     * 当追加ScrollSpy块的时候，判断是否是已经设置的当前
     * @param groupId
     * @param scrollEl
     */
    /**
     * 当追加ScrollSpy块的时候，判断是否是已经设置的当前
     * @private
     * @param {?} groupId
     * @param {?} scrollEl
     * @return {?}
     */
    FarrisScrollSpyService.prototype.updateScrollSpyActiveClsName = /**
     * 当追加ScrollSpy块的时候，判断是否是已经设置的当前
     * @private
     * @param {?} groupId
     * @param {?} scrollEl
     * @return {?}
     */
    function (groupId, scrollEl) {
        // 如果已设置
        if (this.currentSectionIdObj[groupId]) {
            if (this.currentSectionIdObj[groupId]['idValue'] == scrollEl.id) {
                scrollEl.element.className += ' ' + this.scrollSpyPartActiveClsName;
            }
        }
    };
    FarrisScrollSpyService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root',
                },] }
    ];
    /** @nocollapse */
    FarrisScrollSpyService.ctorParameters = function () { return [
        { type: NgZone }
    ]; };
    /** @nocollapse */ FarrisScrollSpyService.ngInjectableDef = i0.defineInjectable({ factory: function FarrisScrollSpyService_Factory() { return new FarrisScrollSpyService(i0.inject(i0.NgZone)); }, token: FarrisScrollSpyService, providedIn: "root" });
    return FarrisScrollSpyService;
}());
export { FarrisScrollSpyService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.scrollSpyPartActiveClsName;
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.fixedTabContainerClsName;
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.scrollSubscription;
    /**
     * 被监听滚动的contents
     * @type {?}
     */
    FarrisScrollSpyService.prototype.scrollContents;
    /**
     * 被监听滚动的sections
     * @type {?}
     */
    FarrisScrollSpyService.prototype.scrollSpies;
    /**
     * 监听滚动的锚点部分
     * @type {?}
     */
    FarrisScrollSpyService.prototype.scrollFollowSpipes;
    /**
     * @type {?}
     * @private
     */
    FarrisScrollSpyService.prototype.scrollSpyListFollowTypeChanges;
    /**
     * 滚动监听偏移距离
     * @type {?}
     */
    FarrisScrollSpyService.prototype.offsets;
    /**
     * 默认监听分组名称
     * @type {?}
     */
    FarrisScrollSpyService.prototype.defaultId;
    /** @type {?} */
    FarrisScrollSpyService.prototype.currentSectionIdObj;
    /** @type {?} */
    FarrisScrollSpyService.prototype.scrollChange;
    /** @type {?} */
    FarrisScrollSpyService.prototype.ngzone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLXNjcm9sbHNweS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1zY3JvbGxzcHkvIiwic291cmNlcyI6WyJsaWIvZmFycmlzLXNjcm9sbHNweS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFhLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBNEIsTUFBTSxNQUFNLENBQUM7QUFDcEUsT0FBTyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7Ozs7O0FBRXhFLDRCQUdDOzs7SUFGQyxnQ0FBcUI7O0lBQ3JCLDJCQUFVOzs7OztBQUdaLHdCQUtDOzs7SUFKQyw2QkFBMEI7O0lBQzFCLHFDQUF5Qjs7SUFDekIsNEJBQXlCOztJQUN6QixnQ0FBcUI7Ozs7O0FBR3ZCLDBCQUVDOzs7O0FBRUQsMkJBR0M7OztJQUZDLCtCQUFxQjs7SUFDckIsMEJBQVU7Ozs7O0FBRVosaUNBRUM7Ozs7QUFFRCw2QkFFQzs7OztBQUNELHNCQUVDOzs7O0FBRUQsMkJBRUM7Ozs7QUFFRCx3QkFHQzs7O0lBRkMsNEJBQXlCOztJQUN6Qiw0QkFBZTs7Ozs7QUFFakIsMkJBRUM7QUFHRDtJQXdFRSxnQ0FBbUIsTUFBYztRQUFkLFdBQU0sR0FBTixNQUFNLENBQVE7O1FBbkV6QiwrQkFBMEIsR0FBRyx5QkFBeUIsQ0FBQztRQUN2RCw2QkFBd0IsR0FBRyw2QkFBNkIsQ0FBQzs7OztRQUdqRSxtQkFBYyxHQUFtQixFQUFFLENBQUM7Ozs7UUFFcEMsZ0JBQVcsR0FBZ0IsRUFBRSxDQUFDOzs7O1FBRTlCLHVCQUFrQixHQUF1QixFQUFFLENBQUM7UUFDcEMsbUNBQThCLEdBQUcsRUFBRSxDQUFDOzs7O1FBRzVDLFlBQU8sR0FBWSxF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QkFDM0QsUUFBUSxDQUFDLE9BQU8sQ0FBQyxTQUFTLElBQUUsR0FBRyxHQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQzthQUNqRTtTQUNGO0lBQ0gsQ0FBQzs7Z0JBNVZGLFVBQVUsU0FBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7Ozs7Z0JBbkQrQixNQUFNOzs7aUNBQXRDO0NBK1lDLEFBOVZELElBOFZDO1NBM1ZZLHNCQUFzQjs7Ozs7O0lBRWpDLDREQUErRDs7Ozs7SUFDL0QsMERBQWlFOzs7OztJQUNqRSxvREFBeUM7Ozs7O0lBRXpDLGdEQUFvQzs7Ozs7SUFFcEMsNkNBQThCOzs7OztJQUU5QixvREFBNEM7Ozs7O0lBQzVDLGdFQUE0Qzs7Ozs7SUFHNUMseUNBQXNCOzs7OztJQUV0QiwyQ0FBOEI7O0lBSTlCLHFEQUF1Qzs7SUE4Q3ZDLDhDQUFnQzs7SUFHcEIsd0NBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT25EZXN0cm95LCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgZnJvbUV2ZW50LCBTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGhyb3R0bGVUaW1lLCBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IGFuaW1hdGlvbkZyYW1lIH0gZnJvbSAncnhqcy9pbnRlcm5hbC9zY2hlZHVsZXIvYW5pbWF0aW9uRnJhbWUnO1xyXG5cclxuaW50ZXJmYWNlIFNjcm9sbEVsZW1lbnQge1xyXG4gIGVsZW1lbnQ6IEhUTUxFbGVtZW50LFxyXG4gIGlkOiBzdHJpbmdcclxufVxyXG5cclxuaW50ZXJmYWNlIFNjcm9sbFNweSB7XHJcbiAgZWxlbWVudHM6IFNjcm9sbEVsZW1lbnRbXTtcclxuICBjdXJyZW50U2VjdGlvbklkOiBzdHJpbmc7XHJcbiAgc3ViamVjdDogU3ViamVjdDxzdHJpbmc+O1xyXG4gIGNsaWNrQ2hhbmdlPzogYm9vbGVhbiAvL+WIpOaWreaYr+WQpuaYr+eCueWHu+WvvOiHtOeahOmhtemdoua7muWKqFxyXG59XHJcblxyXG5pbnRlcmZhY2UgU2Nyb2xsU3BpZXMge1xyXG4gIFtzY3JvbGxTcHlJZDogc3RyaW5nXTogU2Nyb2xsU3B5XHJcbn1cclxuXHJcbmludGVyZmFjZSBTY3JvbGxGb2xsb3cge1xyXG4gIGVsZW1lbnQ6IEhUTUxFbGVtZW50LFxyXG4gIGlkOiBzdHJpbmdcclxufVxyXG5pbnRlcmZhY2UgU2Nyb2xsRm9sbG93U3BpcGVzIHtcclxuICBbc2Nyb2xsRm9sbG93SWQ6IHN0cmluZ106IFNjcm9sbEZvbGxvd1tdXHJcbn1cclxuXHJcbmludGVyZmFjZSBTY3JvbGxDb250ZW50cyB7XHJcbiAgW3Njcm9sbEZvbGxvd0lkOiBzdHJpbmddOiBIVE1MRWxlbWVudFxyXG59XHJcbmludGVyZmFjZSBPZmZzZXRzIHtcclxuICBbc2Nyb2xsRm9sbG93SWQ6IHN0cmluZ106IG51bWJlclxyXG59XHJcblxyXG5pbnRlcmZhY2UgU2Nyb2xsQ2hhbmdlIHtcclxuICBbc2Nyb2xsRm9sbG93SWQ6IHN0cmluZ106IFN1YmplY3Q8YW55PlxyXG59XHJcblxyXG5pbnRlcmZhY2UgQ3VycmVudElkIHtcclxuICBzdWJqZWN0OiBTdWJqZWN0PHN0cmluZz47XHJcbiAgaWRWYWx1ZTogc3RyaW5nXHJcbn1cclxuaW50ZXJmYWNlIEN1cnJlbnRJZE9iaiB7XHJcbiAgW2dyb3VwSWQ6IHN0cmluZ106IEN1cnJlbnRJZFxyXG59XHJcblxyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc1Njcm9sbFNweVNlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gIC8vIOebkeWQrOWMuuWdl+W9k+WJjeaXtuWAmeeahOagt+W8j1xyXG4gIHByaXZhdGUgc2Nyb2xsU3B5UGFydEFjdGl2ZUNsc05hbWUgPSAnZi1zY3JvbGxzcHktcGFydC1hY3RpdmUnO1xyXG4gIHByaXZhdGUgZml4ZWRUYWJDb250YWluZXJDbHNOYW1lID0gJ2Ytc2Nyb2xsc3B5LWNvbnRhaW5lci1maXhlZCc7XHJcbiAgcHJpdmF0ZSBzY3JvbGxTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAvKirooqvnm5HlkKzmu5rliqjnmoRjb250ZW50cyAqL1xyXG4gIHNjcm9sbENvbnRlbnRzOiBTY3JvbGxDb250ZW50cyA9IHt9O1xyXG4gIC8qKuiiq+ebkeWQrOa7muWKqOeahHNlY3Rpb25zKi9cclxuICBzY3JvbGxTcGllczogU2Nyb2xsU3BpZXMgPSB7fTtcclxuICAvKirnm5HlkKzmu5rliqjnmoTplJrngrnpg6jliIYgKi9cclxuICBzY3JvbGxGb2xsb3dTcGlwZXM6IFNjcm9sbEZvbGxvd1NwaXBlcyA9IHt9O1xyXG4gIHByaXZhdGUgc2Nyb2xsU3B5TGlzdEZvbGxvd1R5cGVDaGFuZ2VzID0ge307XHJcblxyXG4gIC8qKua7muWKqOebkeWQrOWBj+enu+i3neemuyAqL1xyXG4gIG9mZnNldHM6IE9mZnNldHMgPSB7fTtcclxuICAvKirpu5jorqTnm5HlkKzliIbnu4TlkI3np7AgKi9cclxuICBkZWZhdWx0SWQ6IHN0cmluZyA9ICdkZWZhdWx0JztcclxuXHJcbiAgLy8gY3VycmVudFNlY3Rpb25JZDogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgY3VycmVudFNlY3Rpb25JZE9iajogQ3VycmVudElkT2JqID0ge307XHJcbiAgLy/ojrflj5ZjdXJyZW50aWRcclxuICBnZXRDdXJyZW50U2VjdGlvbklkKGdyb3VwSWQ6IHN0cmluZykge1xyXG4gICAgaWYgKCFncm91cElkKSB7XHJcbiAgICAgIGdyb3VwSWQgPSB0aGlzLmRlZmF1bHRJZDtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmN1cnJlbnRTZWN0aW9uSWRPYmpbZ3JvdXBJZF0uc3ViamVjdDtcclxuICAgIC8vIHJldHVybiB0aGlzLmN1cnJlbnRTZWN0aW9uSWQ7XHJcbiAgfVxyXG4gIC8v5rua5Yqo5Y+Y5YyW5pe25pS55Y+YY3VycmVudGlkXHJcbiAgc2V0Q3VycmVudFNlY3Rpb25JZChncm91cElkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcclxuICAgIGlmICghZ3JvdXBJZCkge1xyXG4gICAgICBncm91cElkID0gdGhpcy5kZWZhdWx0SWQ7XHJcbiAgICB9XHJcbiAgICB0aGlzLmN1cnJlbnRTZWN0aW9uSWRPYmpbZ3JvdXBJZF0uc3ViamVjdC5uZXh0KHZhbHVlKTtcclxuICAgIC8vY29uc29sZS5sb2codGhpcy5jdXJyZW50U2VjdGlvbklkT2JqKTtcclxuICAgIC8vIHRoaXMuY3VycmVudFNlY3Rpb25JZC5uZXh0KHZhbHVlKTtcclxuICB9XHJcbiAgLy/orr7nva7kuI3lkIxncm91cOe7hOeahGN1cnJlbnRpZFxyXG4gIHNldEN1cnJlbnRTZWN0aW9uSWRPYmooZ3JvdXBJZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWdyb3VwSWQpIHtcclxuICAgICAgZ3JvdXBJZCA9IHRoaXMuZGVmYXVsdElkO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLmN1cnJlbnRTZWN0aW9uSWRPYmpbZ3JvdXBJZF0pIHtcclxuICAgICAgdGhpcy5jdXJyZW50U2VjdGlvbklkT2JqW2dyb3VwSWRdID0ge1xyXG4gICAgICAgIHN1YmplY3Q6IG5ldyBTdWJqZWN0KCksXHJcbiAgICAgICAgaWRWYWx1ZTogdmFsdWVcclxuICAgICAgfSBhcyBDdXJyZW50SWQ7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5jdXJyZW50U2VjdGlvbklkT2JqW2dyb3VwSWRdLmlkVmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZih0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1tncm91cElkXSAmJiB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1tncm91cElkXS5sZW5ndGgpe1xyXG4gICAgICAgIGxldCBpdGVtID0gdGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNbZ3JvdXBJZF0uZmluZChzY3JvbGxGb2xsb3dJdGVtPT57XHJcbiAgICAgICAgICByZXR1cm4gc2Nyb2xsRm9sbG93SXRlbVsnaWQnXSA9PSB0aGlzLmN1cnJlbnRTZWN0aW9uSWRPYmpbZ3JvdXBJZF0uaWRWYWx1ZTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIGlmKGl0ZW0pe1xyXG4gICAgICAgICAgdGhpcy5mU2Nyb2xsRm9sbG93Q2xpY2soZ3JvdXBJZCxpdGVtKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIDApO1xyXG4gICAgLy8gdGhpcy5mU2Nyb2xsRm9sbG93Q2xpY2soa2V5LGZvbGxvdyk7XHJcbiAgfVxyXG5cclxuXHJcbiAgc2Nyb2xsQ2hhbmdlOiBTY3JvbGxDaGFuZ2UgPSB7fTtcclxuXHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBuZ3pvbmU6IE5nWm9uZSkgeyB9XHJcblxyXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2Nyb2xsU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICAvKipPYnNlcnZlcumDqOWIhiDkvpvmjIfku6TliJ3lp4vljJbosIPnlKggKi9cclxuICAvLyBwdWJsaWMgZ2V0Q3VycmVudFNlY3Rpb24kKHNjcm9sbFNweUlkOiBzdHJpbmcgPSB0aGlzLmRlZmF1bHRJZCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgLy8gICBpZihzY3JvbGxTcHlJZCAhPT0gJycpe1xyXG4gIC8vICAgICByZXR1cm4gdGhpcy5zY3JvbGxDaGFuZ2Vbc2Nyb2xsU3B5SWRdO1xyXG4gIC8vICAgfVxyXG4gIC8vICAgZWxzZXtcclxuICAvLyAgICAgcmV0dXJuIHRoaXMuc2Nyb2xsQ2hhbmdlW3RoaXMuZGVmYXVsdElkXTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGVTY3JvbGxHcm91cChzY3JvbGxTcHlJZDogc3RyaW5nID0gdGhpcy5kZWZhdWx0SWQpIHtcclxuICAgIGNvbnN0IGdyb3VwSWQgPSBzY3JvbGxTcHlJZCAhPT0gJycgPyBzY3JvbGxTcHlJZCA6IHRoaXMuZGVmYXVsdElkO1xyXG4gICAgaWYgKCF0aGlzLnNjcm9sbENoYW5nZVtncm91cElkXSkge1xyXG4gICAgICB0aGlzLnNjcm9sbENoYW5nZVtncm91cElkXSA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5zY3JvbGxDaGFuZ2VbZ3JvdXBJZF07XHJcbiAgfVxyXG4gIC8qKmNvbnRlbnTpg6jliIbmu5rliqjkuovku7bnm5HlkKwgKi9cclxuICBwcml2YXRlIHN1YnNjcmliZVNjcm9sbChrZXk6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5uZ3pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICB0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbiA9IGZyb21FdmVudCh0aGlzLnNjcm9sbENvbnRlbnRzW2tleV0sICdzY3JvbGwnKVxyXG4gICAgICAgIC5waXBlKGRlYm91bmNlVGltZSgyMCwgYW5pbWF0aW9uRnJhbWUpKVxyXG4gICAgICAgIC5zdWJzY3JpYmUoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMuc2Nyb2xsU3BpZXNba2V5XSkge1xyXG4gICAgICAgICAgICBjb25zdCB7IGN1cnJlbnRTZWN0aW9uSWQsIGVsZW1lbnRzLCBzdWJqZWN0IH0gPSB0aGlzLnNjcm9sbFNwaWVzW2tleV07XHJcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsQ29udGVudHNba2V5XS5zY3JvbGxUb3A7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvcEVsZW1lbnRJblZpZXcgPSBlbGVtZW50cy5maWx0ZXIoKGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGVsLmVsZW1lbnQub2Zmc2V0VG9wIDw9IHNjcm9sbFRvcCArIHRoaXMub2Zmc2V0c1trZXldXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKCF0b3BFbGVtZW50SW5WaWV3IHx8ICF0b3BFbGVtZW50SW5WaWV3Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKHRvcEVsZW1lbnRJblZpZXcpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3BFbGVtZW50SWQ6IHN0cmluZyA9IHRvcEVsZW1lbnRJblZpZXdbMF0uaWQ7XHJcbiAgICAgICAgICAgIC8v5Yik5patIOeCueWHu+aYr+WQpuaYr+eCueWHu+W8lei1t+eahOa7muWKqFxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxTcGllc1trZXldLmNsaWNrQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zY3JvbGxTcGllc1trZXldLmNsaWNrQ2hhbmdlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jbGlja0NoYW5nZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgIGlmICh0b3BFbGVtZW50SWQgIT09IGN1cnJlbnRTZWN0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jdXJyZW50U2VjdGlvbklkID0gdG9wRWxlbWVudElkO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZ3pvbmUucnVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KHRvcEVsZW1lbnRJZCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKnRhYumDqOWIhueCueWHu+S6i+S7tuebkeWQrCAqL1xyXG4gIHByaXZhdGUgc3Vic2NyaWJlQ2xpY2soa2V5KTogdm9pZCB7XHJcbiAgICAvL09iamVjdC5rZXlzKHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzKS5mb3JFYWNoKChrZXk6c3RyaW5nKTp2b2lkPT57XHJcbiAgICBpZiAodGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNba2V5XSAmJiB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1trZXldLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1trZXldLmZvckVhY2goKGZvbGxvdykgPT4ge1xyXG4gICAgICAgIGZyb21FdmVudChmb2xsb3cuZWxlbWVudCwgJ2NsaWNrJylcclxuICAgICAgICAgIC5waXBlKHRocm90dGxlVGltZSgxMDApKVxyXG4gICAgICAgICAgLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZlNjcm9sbEZvbGxvd0NsaWNrKGtleSwgZm9sbG93KTtcclxuICAgICAgICAgICAgLy8gaWYodGhpcy5zY3JvbGxTcGllc1trZXldKXtcclxuXHJcbiAgICAgICAgICAgIC8vICAgY29uc3QgeyBjdXJyZW50U2VjdGlvbklkLCBlbGVtZW50cywgc3ViamVjdCB9ID0gdGhpcy5zY3JvbGxTcGllc1trZXldO1xyXG4gICAgICAgICAgICAvLyAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jbGlja0NoYW5nZSA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vICAgaWYoZm9sbG93LmlkICE9PSBjdXJyZW50U2VjdGlvbklkKXtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IHRvcEVsZW1lbnRJblZpZXcgPSBlbGVtZW50cy5maW5kKGVsID0+IGVsLmlkID09PSBmb2xsb3cuaWQpO1xyXG4gICAgICAgICAgICAvLyAgICAgaWYoIXRvcEVsZW1lbnRJblZpZXcpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLnNjcm9sbFNwaWVzW2tleV0uY3VycmVudFNlY3Rpb25JZCA9IGZvbGxvdy5pZDtcclxuICAgICAgICAgICAgLy8gICAgIC8vdGhpcy5zY3JvbGxDb250ZW50c1trZXldLm9mZnNldFRvcFxyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5zY3JvbGxDb250ZW50c1trZXldLnNjcm9sbFRvcCA9IE1hdGgucm91bmQodG9wRWxlbWVudEluVmlldy5lbGVtZW50Lm9mZnNldFRvcCAtIHRoaXMub2Zmc2V0c1trZXldKTtcclxuICAgICAgICAgICAgLy8gICAgIHN1YmplY3QubmV4dChmb2xsb3cuaWQpO1xyXG4gICAgICAgICAgICAvLyAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gICAgLy99KTtcclxuICB9XHJcblxyXG4gIGZTY3JvbGxGb2xsb3dDbGljayhrZXksIGZvbGxvdyl7XHJcbiAgICBpZih0aGlzLnNjcm9sbFNwaWVzW2tleV0pe1xyXG4gICAgICBjb25zdCB7IGN1cnJlbnRTZWN0aW9uSWQsIGVsZW1lbnRzLCBzdWJqZWN0IH0gPSB0aGlzLnNjcm9sbFNwaWVzW2tleV07XHJcbiAgICAgIHRoaXMuc2Nyb2xsU3BpZXNba2V5XS5jbGlja0NoYW5nZSA9IHRydWU7XHJcbiAgICAgIGlmIChmb2xsb3cuaWQgIT09IGN1cnJlbnRTZWN0aW9uSWQpIHtcclxuICAgICAgICBjb25zdCB0b3BFbGVtZW50SW5WaWV3ID0gZWxlbWVudHMuZmluZChlbCA9PiBlbC5pZCA9PT0gZm9sbG93LmlkKTtcclxuICAgICAgICBpZiAoIXRvcEVsZW1lbnRJblZpZXcpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgdGhpcy5zY3JvbGxTcGllc1trZXldLmN1cnJlbnRTZWN0aW9uSWQgPSBmb2xsb3cuaWQ7XHJcbiAgICAgICAgLy90aGlzLnNjcm9sbENvbnRlbnRzW2tleV0ub2Zmc2V0VG9wXHJcbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsQ29udGVudHNba2V5XSkge1xyXG4gICAgICAgICAgdGhpcy5zY3JvbGxDb250ZW50c1trZXldLnNjcm9sbFRvcCA9IE1hdGgucm91bmQodG9wRWxlbWVudEluVmlldy5lbGVtZW50Lm9mZnNldFRvcCAtIHRoaXMub2Zmc2V0c1trZXldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ViamVjdC5uZXh0KGZvbGxvdy5pZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKirmt7vliqDpnIDopoHooqvmu5rliqjnm5HlkKzpg6jliIYgKi9cclxuICBwdWJsaWMgYWRkQ29udGVudEVsZW1lbnQoZWxlbWVudDogSFRNTEVsZW1lbnQsIGNvbnRlbnRJZCA9IHRoaXMuZGVmYXVsdElkKTogdm9pZCB7XHJcbiAgICBpZiAoY29udGVudElkICE9PSAnJykge1xyXG4gICAgICB0aGlzLnNjcm9sbENvbnRlbnRzW2NvbnRlbnRJZF0gPSBlbGVtZW50O1xyXG4gICAgICB0aGlzLnN1YnNjcmliZVNjcm9sbChjb250ZW50SWQpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuc2Nyb2xsQ29udGVudHNbdGhpcy5kZWZhdWx0SWRdID0gZWxlbWVudDtcclxuICAgICAgdGhpcy5zdWJzY3JpYmVTY3JvbGwodGhpcy5kZWZhdWx0SWQpO1xyXG4gICAgfVxyXG4gICAgLy8g5Yik5pat5piv5pyJ5b6F5pS55Y+Y55qE54q25oCBXHJcbiAgICB0aGlzLnVwZGF0ZUNvbnRhaW5lckNsc05hbWUoY29udGVudElkKTtcclxuICB9XHJcbiAgLyoq56e76Zmk6ZyA6KaB6KKr5rua5Yqo55uR5ZCs6YOo5YiG5YWD57SgICovXHJcbiAgcHVibGljIHJlbW92ZUNvbnRlbnRFbGVtZW50KGNvbnRlbnRJZCA9IHRoaXMuZGVmYXVsdElkKTogdm9pZCB7XHJcbiAgICBjb25zdCByZW1vdmVJZCA9IGNvbnRlbnRJZCAhPT0gJycgPyBjb250ZW50SWQgOiB0aGlzLmRlZmF1bHRJZDtcclxuICAgIGRlbGV0ZSB0aGlzLnNjcm9sbFNwaWVzW3JlbW92ZUlkXTtcclxuICB9XHJcbiAgLyoq5re75Yqg5rua5Yqo55uR5ZCsdGFi6YOo5YiG5YWD57SgKi9cclxuICBwdWJsaWMgYWRkRm9sbG93RWxlbWVudChlbGVtZW50OiBIVE1MRWxlbWVudCwgZm9sbG93SWQsIGZvbGxvd0NvbnRlbnRJZCA9IHRoaXMuZGVmYXVsdElkKTogdm9pZCB7XHJcbiAgICBjb25zdCBncm91cElkID0gZm9sbG93Q29udGVudElkICE9PSAnJyA/IGZvbGxvd0NvbnRlbnRJZCA6IHRoaXMuZGVmYXVsdElkO1xyXG5cclxuICAgIGNvbnN0IGZvbGxvdyA9IHtcclxuICAgICAgZWxlbWVudDogZWxlbWVudCxcclxuICAgICAgaWQ6IGZvbGxvd0lkXHJcbiAgICB9O1xyXG4gICAgaWYgKCF0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1tncm91cElkXSkge1xyXG4gICAgICB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1tncm91cElkXSA9IFtdXHJcbiAgICB9XHJcbiAgICBjb25zdCBmb2xsb3dzID0gdGhpcy5zY3JvbGxGb2xsb3dTcGlwZXNbZ3JvdXBJZF07XHJcbiAgICBmb2xsb3dzLnB1c2goZm9sbG93KTtcclxuICAgIHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzW2dyb3VwSWRdID0gZm9sbG93cztcclxuICAgIHRoaXMuc3Vic2NyaWJlQ2xpY2soZ3JvdXBJZCk7XHJcbiAgfVxyXG4gIC8qKuenu+mZpOa7muWKqOebkeWQrHRhYumDqOWIhuWFg+e0oCAqL1xyXG4gIHB1YmxpYyByZW1vdmVGb2xsb3dFbGVtZW50KGZvbGxvd0lkLCBmb2xsb3dDb250ZW50SWQgPSB0aGlzLmRlZmF1bHRJZCk6IHZvaWQge1xyXG4gICAgY29uc3QgZWxlbWVudHMgPSB0aGlzLnNjcm9sbEZvbGxvd1NwaXBlc1tmb2xsb3dDb250ZW50SWRdLmZpbHRlcihlbCA9PiB7XHJcbiAgICAgIHJldHVybiBlbC5pZCAhPT0gZm9sbG93SWQ7XHJcbiAgICB9KVxyXG4gICAgaWYgKCFlbGVtZW50cy5sZW5ndGgpIHtcclxuICAgICAgZGVsZXRlIHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzW2ZvbGxvd0NvbnRlbnRJZF07XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc2Nyb2xsRm9sbG93U3BpcGVzW2ZvbGxvd0NvbnRlbnRJZF0gPSBlbGVtZW50cztcclxuICB9XHJcbiAgLyoq5re75Yqg5rua5Yqo55uR5ZCs6ZSa54K56YOo5YiG5YWD57SgICovXHJcbiAgcHVibGljIGFkZEVsZW1lbnQoZWxlbWVudDogSFRNTEVsZW1lbnQsIHNjcm9sbElkOiBzdHJpbmcsIHNjcm9sbEdyb3VwSWQ6IHN0cmluZyA9IHRoaXMuZGVmYXVsdElkKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuc2Nyb2xsU3BpZXNbc2Nyb2xsR3JvdXBJZF0pIHtcclxuICAgICAgdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXSA9IHtcclxuICAgICAgICBlbGVtZW50czogW10sXHJcbiAgICAgICAgY3VycmVudFNlY3Rpb25JZDogJycsXHJcbiAgICAgICAgc3ViamVjdDogbmV3IFN1YmplY3QoKSxcclxuICAgICAgfSBhcyBTY3JvbGxTcHk7XHJcblxyXG4gICAgICB0aGlzLnNjcm9sbFNwaWVzW3Njcm9sbEdyb3VwSWRdLnN1YmplY3RcclxuICAgICAgICAuc3Vic2NyaWJlKChjdXJyZW50U2VjdGlvbjogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5zY3JvbGxDaGFuZ2Vbc2Nyb2xsR3JvdXBJZF0pIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxDaGFuZ2Vbc2Nyb2xsR3JvdXBJZF0ubmV4dChjdXJyZW50U2VjdGlvbik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmhhc0VsZW1lbnQoc2Nyb2xsSWQsIHNjcm9sbEdyb3VwSWQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbDogU2Nyb2xsRWxlbWVudCA9IHtcclxuICAgICAgZWxlbWVudDogZWxlbWVudCxcclxuICAgICAgaWQ6IHNjcm9sbElkXHJcbiAgICB9XHJcbiAgICAvLyDliqDlhaXml7bvvIzliKTmlq3mmK/lkKbmmK/lvZPliY1cclxuICAgIHRoaXMudXBkYXRlU2Nyb2xsU3B5QWN0aXZlQ2xzTmFtZShzY3JvbGxHcm91cElkLGVsKTtcclxuICAgIGNvbnN0IGVsZW1lbnRzOiBhbnlbXSA9IHRoaXMuc2Nyb2xsU3BpZXNbc2Nyb2xsR3JvdXBJZF0uZWxlbWVudHM7XHJcbiAgICBlbGVtZW50cy5wdXNoKGVsKTtcclxuICAgIGVsZW1lbnRzLnNvcnQoKGEsIGIpOiBudW1iZXIgPT4gYi5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIGEuZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3ApO1xyXG5cclxuICAgIHRoaXMuc2Nyb2xsU3BpZXNbc2Nyb2xsR3JvdXBJZF0uZWxlbWVudHMgPSBlbGVtZW50cztcclxuICB9XHJcbiAgLyoq56e76Zmk5rua5Yqo55uR5ZCs6ZSa54K56YOo5YiG5YWD57SgICovXHJcbiAgcHVibGljIHJlbW92ZUVsZW1lbnQoc2Nyb2xsSWQ6IHN0cmluZywgc2Nyb2xsR3JvdXBJZDogc3RyaW5nID0gdGhpcy5kZWZhdWx0SWQpOiB2b2lkIHtcclxuICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXS5lbGVtZW50cy5maWx0ZXIoKGVsKTogYm9vbGVhbiA9PiB7XHJcbiAgICAgIHJldHVybiBlbC5pZCAhPT0gc2Nyb2xsSWRcclxuICAgIH1cclxuICAgICk7XHJcbiAgICBpZiAoIWVsZW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICBkZWxldGUgdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXS5lbGVtZW50cyA9IGVsZW1lbnRzO1xyXG4gIH1cclxuICAvKirliKTmlq1zY3JvbGxHcm91cElkIOaYr+WQpuaciWlk5ZCN5Li6ZWxlbWVudElkIOeahOWFg+e0oCAqL1xyXG4gIHByaXZhdGUgaGFzRWxlbWVudChlbGVtZW50SWQ6IHN0cmluZywgc2Nyb2xsR3JvdXBJZDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5zY3JvbGxTcGllc1tzY3JvbGxHcm91cElkXS5lbGVtZW50cy5zb21lKChlbGVtZW50KTogYm9vbGVhbiA9PiBlbGVtZW50LmlkID09PSBlbGVtZW50SWQpO1xyXG4gIH1cclxuICAvKirorr7nva5vZmZzZXQgKi9cclxuICBwdWJsaWMgc2V0T2Zmc2V0KG9mZnNldDogbnVtYmVyID0gMCwgY29udGVudElkOiBzdHJpbmcgPSB0aGlzLmRlZmF1bHRJZCk6IHZvaWQge1xyXG4gICAgaWYgKGNvbnRlbnRJZCAhPT0gJycpIHtcclxuICAgICAgdGhpcy5vZmZzZXRzW2NvbnRlbnRJZF0gPSBvZmZzZXQ7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5vZmZzZXRzW3RoaXMuZGVmYXVsdElkXSA9IG9mZnNldDtcclxuICAgIH1cclxuICB9XHJcbiAgLypTY3JvbGxTcHnnu4Tku7Yo6ZSa54K55YiX6KGo5Yy65Z+f77yJ5Yid5aeL5YyW6aKE6K6+ZGVmYXVsdElkICovXHJcbiAgc2V0R3JvdXBJZChncm91cGlkKSB7XHJcbiAgICBpZiAoZ3JvdXBpZCkge1xyXG4gICAgICB0aGlzLmRlZmF1bHRJZCA9IGdyb3VwaWQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRHcm91cElkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGVmYXVsdElkO1xyXG4gIH1cclxuICAvKuaUueWPmCBTY3JvbGxTcHnnu4Tku7bvvIjplJrngrnliJfooajljLrln5/vvInnmoTmmL7npLrnirbmgIHml7YgKi9cclxuICBjaGFuZ2VHcm91cElkRm9sbG93VHlwZShncm91cGlkLCBmb2xsb3dUeXBlRGF0YSkge1xyXG4gICAgdGhpcy5zY3JvbGxTcHlMaXN0Rm9sbG93VHlwZUNoYW5nZXNbZ3JvdXBpZF0gPSBmb2xsb3dUeXBlRGF0YTtcclxuICAgIHRoaXMudXBkYXRlQ29udGFpbmVyQ2xzTmFtZShncm91cGlkKTtcclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVDb250YWluZXJDbHNOYW1lKGdyb3VwaWQpIHtcclxuICAgIC8vIOayoeacieW+heabtOaWsOWPmOWMllxyXG4gICAgaWYgKCF0aGlzLnNjcm9sbFNweUxpc3RGb2xsb3dUeXBlQ2hhbmdlcy5oYXNPd25Qcm9wZXJ0eShncm91cGlkKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBjb250YWluZXLlubbkuI3lrZjlnKjnmoTml7blgJlcclxuICAgIGlmICghdGhpcy5zY3JvbGxDb250ZW50cy5oYXNPd25Qcm9wZXJ0eShncm91cGlkKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgZm9sbG93VHlwZURhdGEgPSB0aGlzLnNjcm9sbFNweUxpc3RGb2xsb3dUeXBlQ2hhbmdlc1tncm91cGlkXTtcclxuICAgIGxldCBjb250YWluZXJFbCA9IHRoaXMuc2Nyb2xsQ29udGVudHNbZ3JvdXBpZF07XHJcbiAgICAvLyBDb250YWluZXLnmoRFbGVtZW50IFxyXG4gICAgaWYgKGZvbGxvd1R5cGVEYXRhWydwcmV2J10gPT0gJ2ZpeGVkVGFiJykge1xyXG4gICAgICAvL+enu+mZpGNsYXNzXHJcbiAgICAgIGNvbnRhaW5lckVsLmNsYXNzTmFtZSA9IGNvbnRhaW5lckVsLmNsYXNzTmFtZS5yZXBsYWNlKHRoaXMuZml4ZWRUYWJDb250YWluZXJDbHNOYW1lLCAnJyk7XHJcbiAgICB9IGVsc2UgaWYgKGZvbGxvd1R5cGVEYXRhWyduZXh0J10gPT0gJ2ZpeGVkVGFiJykge1xyXG4gICAgICAvLyDlop7liqBjbGFzc1xyXG4gICAgICBjb250YWluZXJFbC5jbGFzc05hbWUgKz0gJyAnICsgdGhpcy5maXhlZFRhYkNvbnRhaW5lckNsc05hbWU7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNjcm9sbFNweUxpc3RGb2xsb3dUeXBlQ2hhbmdlc1tncm91cGlkXSA9IG51bGw7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVTY3JvbGxTcGllc0FjdGl2ZUNsc05hbWUoZ3JvdXBJZCxjdXJyZW50SWQpIHtcclxuICAgIC8vIOi/veWKoOOAgeenu+mZpGNsYXNzXHJcbiAgICB0aGlzLnNjcm9sbFNwaWVzW2dyb3VwSWRdLmVsZW1lbnRzLm1hcCgoaXRlbTogU2Nyb2xsRWxlbWVudCkgPT4ge1xyXG4gICAgICBpZiAoaXRlbS5pZCA9PSBjdXJyZW50SWQpIHtcclxuICAgICAgICAvLyDmib7liLDlvZPliY1cclxuICAgICAgICBpZiAoaXRlbS5lbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKHRoaXMuc2Nyb2xsU3B5UGFydEFjdGl2ZUNsc05hbWUpIDwgMCkge1xyXG4gICAgICAgICAgaXRlbS5lbGVtZW50LmNsYXNzTmFtZSArPSAnICcgKyB0aGlzLnNjcm9sbFNweVBhcnRBY3RpdmVDbHNOYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDlhbbku5ZcclxuICAgICAgICBpdGVtLmVsZW1lbnQuY2xhc3NOYW1lID0gaXRlbS5lbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKHRoaXMuc2Nyb2xsU3B5UGFydEFjdGl2ZUNsc05hbWUsICcnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOW9k+i/veWKoFNjcm9sbFNweeWdl+eahOaXtuWAme+8jOWIpOaWreaYr+WQpuaYr+W3sue7j+iuvue9rueahOW9k+WJjVxyXG4gICAqIEBwYXJhbSBncm91cElkIFxyXG4gICAqIEBwYXJhbSBzY3JvbGxFbCBcclxuICAgKi9cclxuICBwcml2YXRlICB1cGRhdGVTY3JvbGxTcHlBY3RpdmVDbHNOYW1lKGdyb3VwSWQsc2Nyb2xsRWw6U2Nyb2xsRWxlbWVudCl7XHJcbiAgICAvLyDlpoLmnpzlt7Lorr7nva5cclxuICAgIGlmKHRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXSl7XHJcbiAgICAgIGlmKHRoaXMuY3VycmVudFNlY3Rpb25JZE9ialtncm91cElkXVsnaWRWYWx1ZSddPT1zY3JvbGxFbC5pZCl7XHJcbiAgICAgICAgc2Nyb2xsRWwuZWxlbWVudC5jbGFzc05hbWUrPScgJyt0aGlzLnNjcm9sbFNweVBhcnRBY3RpdmVDbHNOYW1lO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=