/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Renderer2, ElementRef, ViewChild, ViewEncapsulation, HostListener } from '@angular/core';
import { QuerySolutionService } from '@farris/ui-filter-condition';
import { deepCopy } from './utils';
// 用于显示点击 简单筛选 项的下拉面板
export class FilterPanelComponent {
    /**
     * @param {?} renderer
     * @param {?} elementRef
     * @param {?} filterConditionSer
     */
    constructor(renderer, elementRef, filterConditionSer) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.filterConditionSer = filterConditionSer;
        this._hide = false;
        this.hidePanel = new EventEmitter();
        this.submit = new EventEmitter();
        this.filterSubmit = new EventEmitter();
        this.clearFilter = new EventEmitter();
        this.canSubmit = false;
        this.fiexedLeft = true;
        // 全局标识，初始化标识元素没有发生mousemove
        this.hasMove = false;
        this._documentMouseUpEvent = null;
        this.el = this.elementRef.nativeElement;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set hide(val) {
        this._hide = val;
    }
    /**
     * @return {?}
     */
    get hide() {
        return this._hide;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const self = this;
        this._documentMouseUpEvent = this.renderer.listen(document, 'mouseup', (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            if (event.target.closest('#mainContainerTabset')) {
                self.hidePanel.emit(event);
                return;
            }
            if (this.hasMove) {
                return;
            }
            if (!event.target.closest('.f-filter-panel')
                && !event.target.closest('.modal')
                && !event.target.closest('.overlay-container') && !event.target.closest('.overlay-pane')) {
                self.hidePanel.emit(event);
            }
            this.hasMove = false;
        }));
        if (this.option.item && (this.option.item.control.controltype == 'dropdown' || this.option.item.control.controltype == 'radio')) {
            this.canSubmit = true;
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        /** @type {?} */
        const _panel = this.el.querySelector('.f-filter-panel');
        if (_panel && this.option.target) {
            /** @type {?} */
            const h = _panel.offsetHeight;
            /** @type {?} */
            const rect = this.option.target.getBoundingClientRect();
            if (window['innerHeight'] - this.option.top < h) {
                if (rect.top > h) {
                    this.option.top = rect.top - h - 14;
                }
                else {
                    this.option.top = 32;
                }
                /** @type {?} */
                const arrow = this.el.querySelector('.f-filter-panel-arrow');
                if (arrow) {
                    arrow.style.display = 'none';
                }
            }
        }
        if (_panel && this.option.right) {
            if (this.option.left + _panel.offsetWidth > window['innerWidth']) {
                // 超出显示在做
                this.fiexedLeft = false;
                this.option.left = this.option.right - _panel.offsetWidth;
            }
            else {
                this.fiexedLeft = true;
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this._documentMouseUpEvent) {
            this._documentMouseUpEvent();
            this._documentMouseUpEvent = null;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseDown($event) {
        this.hasMove = false;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseMove($event) {
        this.hasMove = true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSearch(event) {
        if (this.option.item.control.controltype == 'radio') {
            this.panelFilterSubmit();
        }
        else if (this.option.item.control.controltype == 'text' && event['type'] == 'enter') {
            this.panelFilterSubmit();
        }
        // this.filterItem = event;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    panelFilterCancel($event) {
        this.hidePanel.emit($event);
    }
    /**
     * @param {?=} clear
     * @return {?}
     */
    panelFilterSubmit(clear = false) {
        if (!clear && !this.canSubmit) {
            return;
        }
        if (this.option.item.control.controltype === 'text') {
            /** @type {?} */
            const farrisSearchRecord = this.option.item.valueText;
            /** @type {?} */
            let farrisSearchRecordArray = [];
            /** @type {?} */
            const storagelabelCode = this.option.item.labelCode;
            /** @type {?} */
            let filterPanelArray = JSON.parse(localStorage.getItem(this.option.localStorageKey));
            if (Array.isArray(filterPanelArray)) {
                filterPanelArray = null;
            }
            if (!filterPanelArray || !filterPanelArray[storagelabelCode] || !filterPanelArray[storagelabelCode].length
                && farrisSearchRecord && farrisSearchRecord.length) {
                farrisSearchRecordArray.push(farrisSearchRecord);
            }
            else {
                farrisSearchRecordArray = filterPanelArray[storagelabelCode];
                /** @type {?} */
                const index = filterPanelArray[storagelabelCode].indexOf(farrisSearchRecord);
                if (index < 0 && farrisSearchRecord && farrisSearchRecord.length) {
                    farrisSearchRecordArray.unshift(farrisSearchRecord);
                }
                farrisSearchRecordArray = farrisSearchRecordArray.slice(0, 6);
            }
            if (filterPanelArray == null) {
                filterPanelArray = {};
            }
            filterPanelArray[storagelabelCode] = farrisSearchRecordArray;
            localStorage.setItem(this.option.localStorageKey, JSON.stringify(filterPanelArray));
        }
        /** @type {?} */
        const conditions = this.filterConditionSer.setFilterConditions(this.option.item);
        if (!clear) {
            this.filterSubmit.emit({
                item: this.option.item,
                filter: conditions
            });
        }
        this.submit.emit(this.option.item);
    }
    /**
     * @return {?}
     */
    panelFilterClear() {
        this.panelFilterempty();
        this.panelFilterSubmit(true);
        this.clearFilter.emit(this.option.item);
    }
    /**
     * @return {?}
     */
    panelFilterempty() {
        this.filterClearValue(this.option.item);
        this.option.item.valueText = '';
        this.option.item.filled = false;
        this.option.item = deepCopy(this.option.item);
        this.canSubmit = false;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    filterClearValue(item) {
        switch (item.control.controltype) {
            case 'text':
            case 'search':
            case 'singleDate':
            case 'year':
            case 'month':
            case 'dropdown':
            case 'singlenumber':
            case 'radio':
                item.value.value = null;
                break;
            case 'date':
            case 'datetime':
            case 'monthRange':
            case 'yearRange':
                item.value.startTime = null;
                item.value.endTime = null;
                break;
            case 'number':
                item.value.startValue = null;
                item.value.endValue = null;
                break;
            case 'help':
                item.value.value = [];
                item.value.valueField = null;
                item.value.textValue = null;
                break;
            case 'checkboxgroup':
            case 'bool-check':
                item.value.value = [];
                break;
            case 'input-group':
                item.value.value = [];
                item.value.textValue = null;
                item.value.textField = null;
                item.value.isInputText = null;
                break;
            case 'flexibleNumber':
            case 'flexibleDate':
                item.value.startValue = null;
                item.value.endValue = null;
                item.value.value = null;
                break;
            default:
                item.value.value = null;
                break;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onSubmitChange(event) {
        this.canSubmit = event;
    }
}
FilterPanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-filter-panel',
                template: "<div class=\"f-filter-panel-wrapper\" #filterPanel [ngClass]=\"{'d-none': hide}\">\r\n    <div \r\n    [class]=\"'f-filter-panel f-filter-panel-'+(option.item && option.item.control.controltype)\"\r\n    [ngStyle]=\"{\r\n        'left': option.left > 0 ? option.left+'px' : '0px',\r\n        'top': option.top > 0 ? option.top+'px' : '0px',\r\n        'width': (option.width && option.width > 0) ? option.width+'px':'',\r\n        'height': (option.height && option.height > 0) ? option.height+'px':'',\r\n        'max-width': (option.maxWidth && option.maxWidth > 0) ? option.maxWidth+'px':'',\r\n        'max-height': (option.maxHeight && option.maxHeight > 0) ? option.maxHeight+'px':''\r\n    }\">\r\n        <div class=\"f-filter-panel-inner\" [ngClass]=\"{'f-filter-panel-inner-xs': option.item && option.item.control.controltype == 'radio','f-filter-panel-inner-auto': !option.item}\">\r\n            <div class=\"f-filter-panel-arrow\" [ngStyle]=\"{'left':fiexedLeft?'26px':'auto','right':fiexedLeft?'auto':'26px'}\"></div>\r\n            <div class=\"f-filter-panel-extend\" *ngIf=\"option.panelExtendTemplate\">\r\n                <ng-container [ngTemplateOutlet]=\"option.panelExtendTemplate\"></ng-container>\r\n            </div>\r\n            <div class=\"f-filter-panel-header\" *ngIf=\"option.showLable && option.item && option.item.control.controltype != 'radio'\">\r\n                <div class=\"panel-header-title\">\r\n                    {{ 'filterPanel.filter' | locale }}\r\n                </div>\r\n                <!-- <div class=\"panel-header-toolbar\"></div> -->\r\n            </div>\r\n            <div class=\"f-filter-panel-content\" *ngIf=\"option.item\">\r\n                <div class=\"f-filter-panel-form\">\r\n                    <ng-container [ngSwitch]=\"option.item.control.controltype\">\r\n                        <div class=\"filter-input-item filter-type-input position-relative\" *ngSwitchCase=\"'text'\">\r\n                            <panel-filter-input [item]=\"option.item\" [localStorageKey]=\"option.localStorageKey\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-input>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-search\" *ngSwitchCase=\"'search'\">\r\n                            <panel-filter-search [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-search>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'singleDate'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'year'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'3'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'month'\">\r\n                            <panel-filter-date [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'2'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-date>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'date'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'datetime'\">\r\n                            <panel-filter-daterange [item]=\"option.item\" [showTime]=\"true\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'monthRange'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'2'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-date\" *ngSwitchCase=\"'yearRange'\">\r\n                            <panel-filter-daterange [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" [showType]=\"'3'\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-daterange>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-dropdown\" *ngSwitchCase=\"'dropdown'\">\r\n                            <panel-filter-dropdown [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"  (submitChange)=\"onSubmitChange($event)\"></panel-filter-dropdown>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-number\" *ngSwitchCase=\"'number'\">\r\n                            <panel-filter-number [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-number>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-single-number\" *ngSwitchCase=\"'singlenumber'\">\r\n                            <panel-filter-single-number [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-single-number>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-help\" *ngSwitchCase=\"'help'\">\r\n                            <panel-filter-help [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-help>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-checkboxgroup\" *ngSwitchCase=\"'checkboxgroup'\">\r\n                            <panel-filter-checkbox [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-checkbox>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-radio\" *ngSwitchCase=\"'radio'\">\r\n                            <panel-filter-radio [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\"></panel-filter-radio>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-radio\" *ngSwitchCase=\"'input-group'\">\r\n                            <panel-filter-inputgroup [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\"  (submitChange)=\"onSubmitChange($event)\"></panel-filter-inputgroup>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-flexiblenumber\" *ngSwitchCase=\"'flexibleNumber'\">\r\n                            <panel-filter-flexiblenumber [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-flexiblenumber>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-flexibledate\" *ngSwitchCase=\"'flexibleDate'\">\r\n                            <panel-filter-flexibledate [item]=\"option.item\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-flexibledate>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-boolcheck\" *ngSwitchCase=\"'bool-check'\">\r\n                            <panel-filter-checkbox [item]=\"option.item\" [boolcheck]=\"true\"\r\n                                (searchHandle)=\"onSearch($event)\" class=\"form-group farris-form-group\"\r\n                                style=\"white-space: nowrap;\" (submitChange)=\"onSubmitChange($event)\"></panel-filter-checkbox>\r\n                        </div>\r\n                        <div class=\"filter-input-item filter-type-default\" *ngSwitchDefault>\r\n                            <panel-filter-input [item]=\"option.item\" [localStorageKey]=\"option.localStorageKey\"\r\n                                (searchHandle)=\"onSearch($event)\" (submitChange)=\"onSubmitChange($event)\" class=\"form-group farris-form-group\"></panel-filter-input>\r\n                        </div>\r\n                    </ng-container>\r\n                </div>\r\n\r\n            </div>\r\n            <div class=\"f-filter-panel-footer\" *ngIf=\"option.item && option.item.control.controltype != 'radio'\">\r\n                <div class=\"filer-panel-clear\">\r\n                    <button class=\"btn btn-link\" (click)=\"panelFilterClear()\">{{ 'filterPanel.reset' | locale }}</button>\r\n                    <button class=\"btn btn-link btn-empty\" (click)=\"panelFilterempty()\">{{ 'filterPanel.empty' | locale }}</button>\r\n                </div>\r\n                <div class=\"filter-panel-btns\">\r\n                    <button class=\"btn btn-secondary\" (click)=\"panelFilterCancel($event)\">{{ 'filterPanel.cancel' | locale }}</button>\r\n                    <button class=\"filter-panel-submit btn btn-primary\" (click)=\"panelFilterSubmit()\" [disabled]=\"!canSubmit\">{{ 'filterPanel.confirm' | locale }}</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>",
                encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
FilterPanelComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: QuerySolutionService }
];
FilterPanelComponent.propDecorators = {
    option: [{ type: Input }],
    hide: [{ type: Input }],
    hidePanel: [{ type: Output }],
    submit: [{ type: Output }],
    filterSubmit: [{ type: Output }],
    clearFilter: [{ type: Output }],
    filterPanel: [{ type: ViewChild, args: ['filterPanel',] }],
    onMouseDown: [{ type: HostListener, args: ['mousedown', ['$event'],] }],
    onMouseMove: [{ type: HostListener, args: ['mousemove', ['$event'],] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.el;
    /** @type {?} */
    FilterPanelComponent.prototype.option;
    /** @type {?} */
    FilterPanelComponent.prototype._hide;
    /** @type {?} */
    FilterPanelComponent.prototype.hidePanel;
    /** @type {?} */
    FilterPanelComponent.prototype.submit;
    /** @type {?} */
    FilterPanelComponent.prototype.filterSubmit;
    /** @type {?} */
    FilterPanelComponent.prototype.clearFilter;
    /** @type {?} */
    FilterPanelComponent.prototype.filterPanel;
    /** @type {?} */
    FilterPanelComponent.prototype.canSubmit;
    /** @type {?} */
    FilterPanelComponent.prototype.fiexedLeft;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.hasMove;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype._documentMouseUpEvent;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    FilterPanelComponent.prototype.filterConditionSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZmlsdGVyLXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUMxRCxVQUFVLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFaEgsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQzs7QUFPbkMsTUFBTSxPQUFPLG9CQUFvQjs7Ozs7O0lBcUI3QixZQUFvQixRQUFtQixFQUFVLFVBQXNCLEVBQVUsa0JBQXdDO1FBQXJHLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQVUsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFzQjtRQWxCekgsVUFBSyxHQUFHLEtBQUssQ0FBQztRQVFKLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQy9CLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFM0MsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixlQUFVLEdBQUMsSUFBSSxDQUFDOztRQUVSLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFDaEIsMEJBQXFCLEdBQUcsSUFBSSxDQUFDO1FBRWpDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUM7SUFDNUMsQ0FBQzs7Ozs7SUFuQkQsSUFDSSxJQUFJLENBQUMsR0FB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O0lBMUZyQyxrQ0FBd0I7O0lBQ3hCLHNDQUFtQzs7SUFDbkMscUNBQWM7O0lBUWQseUNBQXlDOztJQUN6QyxzQ0FBc0M7O0lBQ3RDLDRDQUE0Qzs7SUFDNUMsMkNBQTJDOztJQUMzQywyQ0FBa0Q7O0lBQ2xELHlDQUFrQjs7SUFDbEIsMENBQWdCOzs7OztJQUVoQix1Q0FBd0I7Ozs7O0lBQ3hCLHFEQUFxQzs7Ozs7SUFDekIsd0NBQTJCOzs7OztJQUFFLDBDQUE4Qjs7Ozs7SUFBRSxrREFBZ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBSZW5kZXJlcjIsXHJcbiAgICAgICAgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiwgSG9zdExpc3RlbmVyLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRmlsdGVyUGFuZWxPcHRpb24gfSBmcm9tICcuL2ZpbHRlci1wYW5lbC5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBRdWVyeVNvbHV0aW9uU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktZmlsdGVyLWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IGRlZXBDb3B5IH0gZnJvbSAnLi91dGlscyc7XHJcbi8vIOeUqOS6juaYvuekuueCueWHuyDnroDljZXnrZvpgIkg6aG555qE5LiL5ouJ6Z2i5p2/XHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmYXJyaXMtZmlsdGVyLXBhbmVsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9maWx0ZXItcGFuZWwuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRmlsdGVyUGFuZWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICBwcml2YXRlIGVsOiBIVE1MRWxlbWVudDtcclxuICAgIEBJbnB1dCgpIG9wdGlvbjogRmlsdGVyUGFuZWxPcHRpb247XHJcbiAgICBfaGlkZSA9IGZhbHNlO1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBoaWRlKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2hpZGUgPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXQgaGlkZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faGlkZTtcclxuICAgIH1cclxuICAgIEBPdXRwdXQoKSBoaWRlUGFuZWwgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBAT3V0cHV0KCkgc3VibWl0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIGZpbHRlclN1Ym1pdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSBjbGVhckZpbHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlclBhbmVsJykgZmlsdGVyUGFuZWw6IEVsZW1lbnRSZWY7XHJcbiAgICBjYW5TdWJtaXQgPSBmYWxzZTtcclxuICAgIGZpZXhlZExlZnQ9dHJ1ZTtcclxuICAgIC8vIOWFqOWxgOagh+ivhu+8jOWIneWni+WMluagh+ivhuWFg+e0oOayoeacieWPkeeUn21vdXNlbW92ZVxyXG4gICAgcHJpdmF0ZSBoYXNNb3ZlID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIF9kb2N1bWVudE1vdXNlVXBFdmVudCA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZiwgcHJpdmF0ZSBmaWx0ZXJDb25kaXRpb25TZXI6IFF1ZXJ5U29sdXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5lbCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgfVxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5fZG9jdW1lbnRNb3VzZVVwRXZlbnQgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbihkb2N1bWVudCwgJ21vdXNldXAnLCAoZXZlbnQpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuY2xvc2VzdCgnI21haW5Db250YWluZXJUYWJzZXQnKSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5oaWRlUGFuZWwuZW1pdChldmVudCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc01vdmUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFldmVudC50YXJnZXQuY2xvc2VzdCgnLmYtZmlsdGVyLXBhbmVsJylcclxuICAgICAgICAgICAgICAgICYmICFldmVudC50YXJnZXQuY2xvc2VzdCgnLm1vZGFsJylcclxuICAgICAgICAgICAgICAgICYmICFldmVudC50YXJnZXQuY2xvc2VzdCgnLm92ZXJsYXktY29udGFpbmVyJykgJiYgIWV2ZW50LnRhcmdldC5jbG9zZXN0KCcub3ZlcmxheS1wYW5lJykpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuaGlkZVBhbmVsLmVtaXQoZXZlbnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmhhc01vdmUgPSBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb24uaXRlbSAmJiAodGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlID09ICdkcm9wZG93bicgfHwgdGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlID09ICdyYWRpbycpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FuU3VibWl0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIGNvbnN0IF9wYW5lbDogYW55ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuZi1maWx0ZXItcGFuZWwnKTtcclxuICAgICAgICBpZiAoX3BhbmVsICYmIHRoaXMub3B0aW9uLnRhcmdldCkge1xyXG4gICAgICAgICAgICBjb25zdCBoID0gX3BhbmVsLm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMub3B0aW9uLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgaWYgKHdpbmRvd1snaW5uZXJIZWlnaHQnXSAtIHRoaXMub3B0aW9uLnRvcCA8IGgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZWN0LnRvcCA+IGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbi50b3AgPSByZWN0LnRvcCAtIGggLSAxNDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb24udG9wID0gMzI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJvdzogYW55ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcuZi1maWx0ZXItcGFuZWwtYXJyb3cnKTtcclxuICAgICAgICAgICAgICAgIGlmIChhcnJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFycm93LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoX3BhbmVsJiZ0aGlzLm9wdGlvbi5yaWdodCl7XHJcbiAgICAgICAgICAgIGlmKHRoaXMub3B0aW9uLmxlZnQrX3BhbmVsLm9mZnNldFdpZHRoPndpbmRvd1snaW5uZXJXaWR0aCddKXtcclxuICAgICAgICAgICAgICAgIC8vIOi2heWHuuaYvuekuuWcqOWBmlxyXG4gICAgICAgICAgICAgICAgdGhpcy5maWV4ZWRMZWZ0PWZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb24ubGVmdD10aGlzLm9wdGlvbi5yaWdodC1fcGFuZWwub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWV4ZWRMZWZ0PXRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50TW91c2VVcEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50TW91c2VVcEV2ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50TW91c2VVcEV2ZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ21vdXNlZG93bicsIFsnJGV2ZW50J10pXHJcbiAgICBvbk1vdXNlRG93bigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmhhc01vdmUgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZW1vdmUnLCBbJyRldmVudCddKVxyXG4gICAgb25Nb3VzZU1vdmUoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5oYXNNb3ZlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb25TZWFyY2goZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb24uaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlID09ICdyYWRpbycpIHtcclxuICAgICAgICAgICAgdGhpcy5wYW5lbEZpbHRlclN1Ym1pdCgpO1xyXG4gICAgICAgIH1lbHNlIGlmKHRoaXMub3B0aW9uLml0ZW0uY29udHJvbC5jb250cm9sdHlwZSA9PSAndGV4dCcmJmV2ZW50Wyd0eXBlJ109PSdlbnRlcicpe1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsRmlsdGVyU3VibWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuZmlsdGVySXRlbSA9IGV2ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHBhbmVsRmlsdGVyQ2FuY2VsKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuaGlkZVBhbmVsLmVtaXQoJGV2ZW50KTtcclxuICAgIH1cclxuICAgIHBhbmVsRmlsdGVyU3VibWl0KGNsZWFyOiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoIWNsZWFyICYmICF0aGlzLmNhblN1Ym1pdCkge3JldHVybjsgfVxyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbi5pdGVtLmNvbnRyb2wuY29udHJvbHR5cGUgPT09ICd0ZXh0Jykge1xyXG4gICAgICAgICAgICBjb25zdCBmYXJyaXNTZWFyY2hSZWNvcmQgPSB0aGlzLm9wdGlvbi5pdGVtLnZhbHVlVGV4dDtcclxuICAgICAgICAgICAgbGV0IGZhcnJpc1NlYXJjaFJlY29yZEFycmF5ID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IHN0b3JhZ2VsYWJlbENvZGUgPSB0aGlzLm9wdGlvbi5pdGVtLmxhYmVsQ29kZTtcclxuICAgICAgICAgICAgbGV0IGZpbHRlclBhbmVsQXJyYXkgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMub3B0aW9uLmxvY2FsU3RvcmFnZUtleSkpO1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShmaWx0ZXJQYW5lbEFycmF5KSkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyUGFuZWxBcnJheSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFmaWx0ZXJQYW5lbEFycmF5IHx8ICFmaWx0ZXJQYW5lbEFycmF5W3N0b3JhZ2VsYWJlbENvZGVdIHx8ICFmaWx0ZXJQYW5lbEFycmF5W3N0b3JhZ2VsYWJlbENvZGVdLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgICYmIGZhcnJpc1NlYXJjaFJlY29yZCAmJiBmYXJyaXNTZWFyY2hSZWNvcmQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBmYXJyaXNTZWFyY2hSZWNvcmRBcnJheS5wdXNoKGZhcnJpc1NlYXJjaFJlY29yZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmYXJyaXNTZWFyY2hSZWNvcmRBcnJheSA9IGZpbHRlclBhbmVsQXJyYXlbc3RvcmFnZWxhYmVsQ29kZV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGZpbHRlclBhbmVsQXJyYXlbc3RvcmFnZWxhYmVsQ29kZV0uaW5kZXhPZihmYXJyaXNTZWFyY2hSZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMCAmJiBmYXJyaXNTZWFyY2hSZWNvcmQgJiYgZmFycmlzU2VhcmNoUmVjb3JkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZhcnJpc1NlYXJjaFJlY29yZEFycmF5LnVuc2hpZnQoZmFycmlzU2VhcmNoUmVjb3JkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZhcnJpc1NlYXJjaFJlY29yZEFycmF5ID0gZmFycmlzU2VhcmNoUmVjb3JkQXJyYXkuc2xpY2UoMCwgNik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGZpbHRlclBhbmVsQXJyYXkgPT0gbnVsbCkgeyBmaWx0ZXJQYW5lbEFycmF5ID0ge307IH1cclxuICAgICAgICAgICAgZmlsdGVyUGFuZWxBcnJheVtzdG9yYWdlbGFiZWxDb2RlXSA9IGZhcnJpc1NlYXJjaFJlY29yZEFycmF5O1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm9wdGlvbi5sb2NhbFN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KGZpbHRlclBhbmVsQXJyYXkpKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5maWx0ZXJDb25kaXRpb25TZXIuc2V0RmlsdGVyQ29uZGl0aW9ucyh0aGlzLm9wdGlvbi5pdGVtKTtcclxuICAgICAgICBpZiAoIWNsZWFyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyU3VibWl0LmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgaXRlbTogdGhpcy5vcHRpb24uaXRlbSxcclxuICAgICAgICAgICAgICAgIGZpbHRlcjogY29uZGl0aW9uc1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdWJtaXQuZW1pdCh0aGlzLm9wdGlvbi5pdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICBwYW5lbEZpbHRlckNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMucGFuZWxGaWx0ZXJlbXB0eSgpO1xyXG4gICAgICAgIHRoaXMucGFuZWxGaWx0ZXJTdWJtaXQodHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5jbGVhckZpbHRlci5lbWl0KHRoaXMub3B0aW9uLml0ZW0pO1xyXG4gICAgfVxyXG4gICAgcGFuZWxGaWx0ZXJlbXB0eSgpIHtcclxuICAgICAgICB0aGlzLmZpbHRlckNsZWFyVmFsdWUodGhpcy5vcHRpb24uaXRlbSk7XHJcbiAgICAgICAgdGhpcy5vcHRpb24uaXRlbS52YWx1ZVRleHQgPSAnJztcclxuICAgICAgICB0aGlzLm9wdGlvbi5pdGVtLmZpbGxlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMub3B0aW9uLml0ZW0gPSBkZWVwQ29weSh0aGlzLm9wdGlvbi5pdGVtKTtcclxuICAgICAgICB0aGlzLmNhblN1Ym1pdCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbHRlckNsZWFyVmFsdWUoaXRlbSkge1xyXG4gICAgICAgIHN3aXRjaCAoaXRlbS5jb250cm9sLmNvbnRyb2x0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxyXG4gICAgICAgICAgICBjYXNlICdzZWFyY2gnOlxyXG4gICAgICAgICAgICBjYXNlICdzaW5nbGVEYXRlJzpcclxuICAgICAgICAgICAgY2FzZSAneWVhcic6XHJcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcclxuICAgICAgICAgICAgY2FzZSAnZHJvcGRvd24nOlxyXG4gICAgICAgICAgICBjYXNlICdzaW5nbGVudW1iZXInOlxyXG4gICAgICAgICAgICBjYXNlICdyYWRpbyc6XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkYXRlJzpcclxuICAgICAgICAgICAgY2FzZSAnZGF0ZXRpbWUnOlxyXG4gICAgICAgICAgICBjYXNlICdtb250aFJhbmdlJzpcclxuICAgICAgICAgICAgY2FzZSAneWVhclJhbmdlJzpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuc3RhcnRUaW1lID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuZW5kVGltZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuc3RhcnRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLmVuZFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdoZWxwJzpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudmFsdWVGaWVsZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLnRleHRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnY2hlY2tib3hncm91cCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2wtY2hlY2snOlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS52YWx1ZSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2lucHV0LWdyb3VwJzpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudGV4dFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudGV4dEZpZWxkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuaXNJbnB1dFRleHQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2ZsZXhpYmxlTnVtYmVyJzpcclxuICAgICAgICAgICAgY2FzZSAnZmxleGlibGVEYXRlJzpcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuc3RhcnRWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLmVuZFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUudmFsdWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25TdWJtaXRDaGFuZ2UoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmNhblN1Ym1pdCA9IGV2ZW50O1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=