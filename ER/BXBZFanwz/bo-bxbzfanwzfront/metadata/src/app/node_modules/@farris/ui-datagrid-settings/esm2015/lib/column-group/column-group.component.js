/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Injector, ChangeDetectorRef, ElementRef, ViewChild, EventEmitter, Output } from '@angular/core';
import { NgForm } from '@angular/forms';
import { DatagridSettingsComponent } from '../datagrid-settings.component';
export class ColumnGroupSettingComponent {
    /**
     * @param {?} injector
     * @param {?} gridSettingComponentRef
     * @param {?} cd
     */
    constructor(injector, gridSettingComponentRef, cd) {
        this.injector = injector;
        this.gridSettingComponentRef = gridSettingComponentRef;
        this.cd = cd;
        this.fields = [];
        this.formatColumns = [];
        this.groupFields = [];
        this.groupFieldsChange = new EventEmitter();
        this.formatColumnsChange = new EventEmitter();
        this.groupColumns = [];
        this.allowGroupColumns = [];
        this.activeCalculationCol = null;
        this.showSelectColumnsPanel = false;
        this.summaryItems = [];
        this.summaryItems2 = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.summaryItems = this.gridSettingComponentRef.summaryItems;
        this.summaryItems2 = this.gridSettingComponentRef.summaryItems2;
        this.setGroupColumns();
        this.registerEventHandle();
        this.initCalculationColumns();
        if (this.colForm) {
            this.colForm.valueChanges.subscribe((/**
             * @param {?} v
             * @return {?}
             */
            v => {
                if (!this.colForm.pristine) {
                    this.formatColumnsChange.emit(this.formatColumns);
                }
            }));
        }
        this.formatColumns.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            this.checkColumnOptions(n);
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.formatColumns && !changes.formatColumns.isFirstChange()) {
            this.formatColumns.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                this.checkColumnOptions(n);
            }));
            this.setGroupColumns();
            this.initCalculationColumns();
        }
    }
    /**
     * @private
     * @return {?}
     */
    initCalculationColumns() {
        this.activeCalculationCol = this.formatColumns[0];
    }
    /**
     * @private
     * @return {?}
     */
    registerEventHandle() {
        this.groupingSettingEl.nativeElement.addEventListener('click', (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e.target !== this.selectcolumnspanel.nativeElement) {
                this.showSelectColumnsPanel = false;
            }
        }), false);
    }
    /**
     * @private
     * @return {?}
     */
    setGroupColumns() {
        if (this.groupFields && this.groupFields.length) {
            this.groupColumns = this.groupFields.map((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                return this.columns[0].find((/**
                 * @param {?} col
                 * @return {?}
                 */
                col => col.field === f));
            })).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n));
        }
        else {
            this.groupColumns = [];
        }
        this.onGroupFieldsChange();
    }
    /**
     * @private
     * @return {?}
     */
    getAllowGroupingColumns() {
        return this.columns[0].filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.allowGrouping || n.allowGrouping === undefined));
    }
    /**
     * @private
     * @return {?}
     */
    onGroupFieldsChange() {
        this.groupFieldsChange.emit(this.groupFields);
    }
    /**
     * @private
     * @param {?} col
     * @return {?}
     */
    checkColumnOptions(col) {
        if (col) {
            if (col.groupFooter === undefined) {
                col.groupFooter = { options: { calculationType: -1 } };
            }
            else {
                col.groupFooter.options = col.groupFooter.options || { calculationType: -1 };
                if (col.groupFooter.options.calculationType === undefined) {
                    col.groupFooter.options.calculationType = -1;
                }
            }
            // if (this.activeField.footer === undefined) {
            //     this.activeField.footer =  { options: {calculationType: -1} };
            // } else {
            //     this.activeField.footer.options = this.activeField.footer.options || {calculationType: -1};
            //     if (this.activeField.footer.options.calculationType === undefined) {
            //         this.activeField.footer.options.calculationType = -1;
            //     }
            // }
        }
    }
    /**
     * 显示或隐藏字段选取面板
     * @param {?} $event
     * @return {?}
     */
    toggleGroupingColumnPanel($event) {
        $event.stopPropagation();
        this.showSelectColumnsPanel = !this.showSelectColumnsPanel;
        this.allowGroupColumns = this.getAllowGroupingColumns();
    }
    /**
     * 添加分组字段
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    addGroupColumn($event, col) {
        $event.stopPropagation();
        if (this.groupFields.indexOf(col.field) === -1) {
            this.groupColumns = [...this.groupColumns, col];
            this.groupFields = this.groupColumns.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.field));
            this.onGroupFieldsChange();
            this.showSelectColumnsPanel = false;
        }
    }
    /**
     * 移除分组字段
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    onRemoveGroupingField($event, col) {
        $event.stopPropagation();
        this.groupFields = this.groupFields.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n !== col.field));
        this.setGroupColumns();
    }
    /**
     * 拖动分组字段进行排序
     * @param {?} $event
     * @return {?}
     */
    onGroupingFieldDropped($event) {
        console.log('grouping field droped.', $event);
        const { removedIndex, addedIndex } = $event;
        /** @type {?} */
        const removedItem = this.groupFields.splice(removedIndex, 1);
        this.groupFields.splice(addedIndex, 0, ...removedItem);
        this.setGroupColumns();
    }
    /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    onFieldClick($event, col) {
        this.activeCalculationCol = col;
    }
}
ColumnGroupSettingComponent.decorators = [
    { type: Component, args: [{
                selector: 'column-group-setting',
                template: "<div #groupingSetting class=\"d-flex flex-column flex-fill column-group-setting\">\r\n\r\n    <div region=\"north\" class=\"north d-flex flex-column group-fields\" style=\"height: 78px; \">\r\n        <div class=\"title\">\r\n            {{'datagrid.settings.grouppingField' | locale }}\r\n            <span class=\"text-warning\"> ({{'datagrid.settings.moreGrouppingFieldWarningMessage' | locale }})</span>\r\n        </div>\r\n        <div #groupfieldcontainer class=\"flex-fill p-2 all-fields\">\r\n            <ul class=\"list-group\" style=\"display: inline-block;\"  column-group-drag (drop)=\"onGroupingFieldDropped($event)\">\r\n                <li class=\"list-group-item list-group-item-action btn btn-light smooth-dnd-draggable-wrapper group-field\"\r\n                *ngFor=\"let item of groupColumns\">\r\n                    {{ item.title }}\r\n                    <span class=\"f-icon f-icon-close\" style=\"cursor: pointer;\" title=\"{{'datagrid.settings.removeGrouppingFieldTip' | locale }}\" (click)=\"onRemoveGroupingField($event, item)\"></span>\r\n                </li>\r\n\r\n                <li class=\"list-group-item list-group-item-action btn btn-light btn-add-groupfield\" title=\"{{'datagrid.settings.addGrouppingFieldTip' | locale }}\"\r\n                    *ngIf=\"!groupFields || groupFields.length < 3\" (click)=\"toggleGroupingColumnPanel($event)\">\r\n                   <span class=\"f-icon f-icon-add\" style=\"font-size: 24px;\"></span>\r\n                </li>\r\n            </ul>\r\n            <div #selectcolumnspanel class=\"group-field-panel\" [style.display]=\"showSelectColumnsPanel? '': 'none'\"\r\n            [style.width.px]=\"groupfieldcontainer.offsetWidth - 16\">\r\n                <ul class=\"list-group\">\r\n                    <li class=\"list-group-item list-group-item-action btn btn-light\" *ngFor=\"let item of allowGroupColumns\"\r\n                    (click)=\"addGroupColumn($event, item)\" [style.display]=\"groupFields.indexOf(item.field) > -1 ? 'none': ''\">\r\n                        {{ item.title }}\r\n                    </li>\r\n                </ul>\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    <div region=\"center\" class=\"center  d-flex flex-column flex-fill\" style=\"overflow:hidden;\">\r\n        <div class=\"group-sum-fields\">\r\n            {{'datagrid.settings.grouppingSummary' | locale}}\r\n        </div>\r\n        <div class=\"flex-fill p-2\" style=\" background-color: #fff; overflow: auto;\">\r\n            <div class=\"d-flex flex-row flex-fill dg-column-format-setting\" style=\"height: 100%\">\r\n                <div region=\"west\" class=\"west d-flex flex-column\" style=\"width: 360px; min-width:260px;overflow: hidden;\">\r\n                    <div style=\"overflow: auto;padding-right: 5px;\" class=\"flex-fill\">\r\n                        <ul class=\"list-group  list-group-flush\">\r\n                            <li class=\"list-group-item list-group-item-action format-setting-column\"\r\n                            *ngFor=\"let item of formatColumns\"\r\n                            [class.active]=\"activeCalculationCol && activeCalculationCol.field === item.field\"\r\n                            (click)=\"onFieldClick($event, item)\"\r\n                             >\r\n                                {{ item.title }}\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                 \r\n                </div>\r\n                <div region=\"center\" class=\"center flex-fill\" style=\"overflow:auto;padding: 0 10px; padding-left: 20px\">\r\n                    <form #groupSumform=\"ngForm\">\r\n                        <div class=\"farris-group-wrap\">\r\n                            <div class=\"form-group farris-form-group\">\r\n                                <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                    <span class=\"farris-label-text\">{{'datagrid.settings.grouppingSummaryType' | locale}}</span>\r\n                                </label>\r\n                                <div class=\"farris-input-wrap\">\r\n                                   \r\n                                    <farris-combo-list name=\"groupFooter.options.calculationType\" \r\n                                    [data]=\" activeCalculationCol.dataType === 'number'?  summaryItems : summaryItems2 \" \r\n                                    [editable]=\"false\"\r\n                                    [(ngModel)]=\"activeCalculationCol.groupFooter.options.calculationType\"\r\n                                    [idField]=\"'value'\"\r\n                                    [textField]=\"'title'\"\r\n                                    [enableClear]=\"false\"></farris-combo-list>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"farris-group-wrap\" *ngIf=\"activeCalculationCol.groupFooter.options.calculationType == -1\">\r\n                            <div class=\"form-group farris-form-group\">\r\n                                <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                    <span class=\"farris-label-text\">{{'datagrid.settings.grouppingSummaryText' | locale}}</span>\r\n                                </label>\r\n                                <div class=\"farris-input-wrap\">\r\n                                    <input type=\"input\" name=\"groupFooter.options.text\" class=\"form-control\" [(ngModel)]=\"activeCalculationCol.groupFooter.options.text\">\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n               \r\n            </div>\r\n\r\n\r\n\r\n        </div>\r\n    </div>\r\n\r\n</div>",
                styles: [`
        .column-group-setting{ height: 100%; background-color: #ffffff; padding: 0 10px 10px 10px}
        .smooth-dnd-ghost.group-field {
            z-index: 999999999 !important;
        }
        .active {
            background-color: rgb(231 241 255);
            color: rgb(0 0 0);
        }
        .column-group-setting .group-field {
            float: left;max-width: 200px;margin-right: 10px;
            width: auto; padding: 5px;padding-right: 30px;
            border-radius: 20px;padding-left: 10px; cursor:move
        }
        .group-field .f-icon { position: absolute;right: 2px;top: 7px; }
        .btn-add-groupfield{float: left;width: 32px;padding: 0px;padding-top: 3px; border-radius: 20px;}
        .group-field-panel{
            height: 260px; border-radius: 5px; z-index: 3;position: absolute;
            background: rgb(255 255 255); box-shadow: 1px 1px 4px rgb(156 155 155 / 75%);
            overflow: hidden;
            overflow-y: auto;
        }
        .group-field-panel ul {
            display: inline-block;margin: 20px;margin-top: 5px;
        }
        .group-field-panel li {
            float: left; cursor: pointer;max-width: 200px;margin-right: 10px;width: auto;
            padding: 10px; min-width: 80px; margin-top: 15px; text-align: center;
        }
        .format-setting-column {
            background: rgba(247,248,251,0.6);
            padding: 7px 10px;
            margin-bottom: 5px;
            border: 1px solid rgba(233,236,243,0.45);
            border-radius: 5px;
        }
        .format-setting-column.active {
            border: 1px solid rgb(42 135 255);
            background: rgb(239 247 255);
            border-top: 1px solid rgb(42 135 255)!important;
            border-bottom: 1px solid rgb(42 135 255)!important;
        }

        `]
            }] }
];
/** @nocollapse */
ColumnGroupSettingComponent.ctorParameters = () => [
    { type: Injector },
    { type: DatagridSettingsComponent },
    { type: ChangeDetectorRef }
];
ColumnGroupSettingComponent.propDecorators = {
    columns: [{ type: Input }],
    fields: [{ type: Input }],
    formatColumns: [{ type: Input }],
    groupFields: [{ type: Input }],
    groupFieldsChange: [{ type: Output }],
    formatColumnsChange: [{ type: Output }],
    groupingSettingEl: [{ type: ViewChild, args: ['groupingSetting',] }],
    selectcolumnspanel: [{ type: ViewChild, args: ['selectcolumnspanel',] }],
    colForm: [{ type: ViewChild, args: ['groupSumform',] }]
};
if (false) {
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.columns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.fields;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.formatColumns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupFields;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupFieldsChange;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.formatColumnsChange;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupingSettingEl;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.selectcolumnspanel;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.colForm;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.groupColumns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.allowGroupColumns;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.activeCalculationCol;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.showSelectColumnsPanel;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.summaryItems;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.summaryItems2;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupSettingComponent.prototype.injector;
    /** @type {?} */
    ColumnGroupSettingComponent.prototype.gridSettingComponentRef;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupSettingComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLWdyb3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtc2V0dGluZ3MvIiwic291cmNlcyI6WyJsaWIvY29sdW1uLWdyb3VwL2NvbHVtbi1ncm91cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQTRCLE1BQU0sZUFBZSxDQUFDO0FBQzdKLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQW9EM0UsTUFBTSxPQUFPLDJCQUEyQjs7Ozs7O0lBcUJwQyxZQUFvQixRQUFrQixFQUFTLHVCQUFrRCxFQUFVLEVBQXFCO1FBQTVHLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBUyw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQTJCO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFuQnZILFdBQU0sR0FBRyxFQUFFLENBQUM7UUFDWixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUVuQixnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUVoQixzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3ZDLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFNbkQsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFDbEIsc0JBQWlCLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLHlCQUFvQixHQUFHLElBQUksQ0FBQztRQUU1QiwyQkFBc0IsR0FBRyxLQUFLLENBQUM7UUFDL0IsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFDbEIsa0JBQWEsR0FBRyxFQUFFLENBQUM7SUFDaUgsQ0FBQzs7OztJQUVySSxRQUFRO1FBRUosSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDO1FBQzlELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLGFBQWEsQ0FBQztRQUVoRSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7UUFFOUIsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsU0FBUzs7OztZQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUU7b0JBQ3hCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO2lCQUNyRDtZQUNMLENBQUMsRUFBQyxDQUFDO1NBQ047UUFFRCxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTtZQUMzQixJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0IsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUM5QixJQUFJLE9BQU8sQ0FBQyxhQUFhLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ2pFLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTzs7OztZQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUMzQixJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsQ0FBQyxFQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDdkIsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7U0FDakM7SUFDTCxDQUFDOzs7OztJQUVPLHNCQUFzQjtRQUMxQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0RCxDQUFDOzs7OztJQUVPLG1CQUFtQjtRQUN2QixJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLE9BQU87Ozs7UUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ2pFLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsYUFBYSxFQUFFO2dCQUNyRCxJQUFJLENBQUMsc0JBQXNCLEdBQUcsS0FBSyxDQUFDO2FBQ3ZDO1FBQ0wsQ0FBQyxHQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2QsQ0FBQzs7Ozs7SUFFTyxlQUFlO1FBQ25CLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRTtZQUM3QyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRzs7OztZQUFFLENBQUMsQ0FBQyxFQUFFO2dCQUMxQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSTs7OztnQkFBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssQ0FBQyxFQUFDLENBQUM7WUFDeEQsQ0FBQyxFQUFDLENBQUMsTUFBTTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUM7U0FDckI7YUFBTTtZQUNILElBQUksQ0FBQyxZQUFZLEdBQUcsRUFBRSxDQUFDO1NBQzFCO1FBQ0QsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7SUFDL0IsQ0FBQzs7Ozs7SUFFTyx1QkFBdUI7UUFDM0IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU07Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhLElBQUksQ0FBQyxDQUFDLGFBQWEsS0FBSyxTQUFTLEVBQUMsQ0FBQztJQUN6RixDQUFDOzs7OztJQUVPLG1CQUFtQjtRQUN2QixJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNsRCxDQUFDOzs7Ozs7SUFFTyxrQkFBa0IsQ0FBQyxHQUFHO1FBQzFCLElBQUksR0FBRyxFQUFFO1lBRUwsSUFBSSxHQUFHLENBQUMsV0FBVyxLQUFLLFNBQVMsRUFBRTtnQkFDL0IsR0FBRyxDQUFDLFdBQVcsR0FBRyxFQUFFLE9BQU8sRUFBRSxFQUFDLGVBQWUsRUFBRSxDQUFDLENBQUMsRUFBQyxFQUFFLENBQUM7YUFDeEQ7aUJBQU07Z0JBQ0gsR0FBRyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLFdBQVcsQ0FBQyxPQUFPLElBQUksRUFBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLEVBQUMsQ0FBQztnQkFDM0UsSUFBSSxHQUFHLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEtBQUssU0FBUyxFQUFFO29CQUN2RCxHQUFHLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDLENBQUM7aUJBQ2hEO2FBQ0o7WUFFRCwrQ0FBK0M7WUFDL0MscUVBQXFFO1lBQ3JFLFdBQVc7WUFDWCxrR0FBa0c7WUFDbEcsMkVBQTJFO1lBQzNFLGdFQUFnRTtZQUNoRSxRQUFRO1lBQ1IsSUFBSTtTQUNQO0lBQ0wsQ0FBQzs7Ozs7O0lBS0QseUJBQXlCLENBQUMsTUFBTTtRQUM1QixNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLHNCQUFzQixHQUFHLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDO1FBQzNELElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztJQUM1RCxDQUFDOzs7Ozs7O0lBR0QsY0FBYyxDQUFDLE1BQU0sRUFBRSxHQUFHO1FBQ3RCLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN6QixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUM1QyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ2hELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7WUFDM0IsSUFBSSxDQUFDLHNCQUFzQixHQUFHLEtBQUssQ0FBQztTQUN2QztJQUNMLENBQUM7Ozs7Ozs7SUFHRCxxQkFBcUIsQ0FBQyxNQUFNLEVBQUUsR0FBRztRQUM3QixNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU07Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsS0FBSyxFQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7OztJQUdELHNCQUFzQixDQUFDLE1BQU07UUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRSxNQUFNLENBQUMsQ0FBQztjQUN4QyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsR0FBRyxNQUFNOztjQUVyQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLEdBQUcsV0FBVyxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7OztJQUVELFlBQVksQ0FBQyxNQUFNLEVBQUUsR0FBRztRQUNwQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsR0FBRyxDQUFDO0lBQ3BDLENBQUM7OztZQXRNSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHNCQUFzQjtnQkFDaEMsOHlMQUE0Qzt5QkFFeEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7U0EyQ0M7YUFFUjs7OztZQXJEa0MsUUFBUTtZQUVsQyx5QkFBeUI7WUFGVyxpQkFBaUI7OztzQkF1RHpELEtBQUs7cUJBQ0wsS0FBSzs0QkFDTCxLQUFLOzBCQUVMLEtBQUs7Z0NBRUwsTUFBTTtrQ0FDTixNQUFNO2dDQUVOLFNBQVMsU0FBQyxpQkFBaUI7aUNBQzNCLFNBQVMsU0FBQyxvQkFBb0I7c0JBQzlCLFNBQVMsU0FBQyxjQUFjOzs7O0lBWHpCLDhDQUFpQjs7SUFDakIsNkNBQXFCOztJQUNyQixvREFBNEI7O0lBRTVCLGtEQUEwQjs7SUFFMUIsd0RBQWlEOztJQUNqRCwwREFBbUQ7O0lBRW5ELHdEQUE0RDs7SUFDNUQseURBQWdFOztJQUNoRSw4Q0FBMkM7O0lBRTNDLG1EQUFrQjs7SUFDbEIsd0RBQXVCOztJQUN2QiwyREFBNEI7O0lBRTVCLDZEQUErQjs7SUFDL0IsbURBQWtCOztJQUNsQixvREFBbUI7Ozs7O0lBQ1AsK0NBQTBCOztJQUFFLDhEQUF5RDs7Ozs7SUFBRSx5Q0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEluamVjdG9yLCBDaGFuZ2VEZXRlY3RvclJlZiwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5nRm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRGF0YWdyaWRTZXR0aW5nc0NvbXBvbmVudCB9IGZyb20gJy4uL2RhdGFncmlkLXNldHRpbmdzLmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnY29sdW1uLWdyb3VwLXNldHRpbmcnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NvbHVtbi1ncm91cC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgXHJcbiAgICAgICAgLmNvbHVtbi1ncm91cC1zZXR0aW5neyBoZWlnaHQ6IDEwMCU7IGJhY2tncm91bmQtY29sb3I6ICNmZmZmZmY7IHBhZGRpbmc6IDAgMTBweCAxMHB4IDEwcHh9XHJcbiAgICAgICAgLnNtb290aC1kbmQtZ2hvc3QuZ3JvdXAtZmllbGQge1xyXG4gICAgICAgICAgICB6LWluZGV4OiA5OTk5OTk5OTkgIWltcG9ydGFudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLmFjdGl2ZSB7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyMzEgMjQxIDI1NSk7XHJcbiAgICAgICAgICAgIGNvbG9yOiByZ2IoMCAwIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICAuY29sdW1uLWdyb3VwLXNldHRpbmcgLmdyb3VwLWZpZWxkIHtcclxuICAgICAgICAgICAgZmxvYXQ6IGxlZnQ7bWF4LXdpZHRoOiAyMDBweDttYXJnaW4tcmlnaHQ6IDEwcHg7XHJcbiAgICAgICAgICAgIHdpZHRoOiBhdXRvOyBwYWRkaW5nOiA1cHg7cGFkZGluZy1yaWdodDogMzBweDtcclxuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMjBweDtwYWRkaW5nLWxlZnQ6IDEwcHg7IGN1cnNvcjptb3ZlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5ncm91cC1maWVsZCAuZi1pY29uIHsgcG9zaXRpb246IGFic29sdXRlO3JpZ2h0OiAycHg7dG9wOiA3cHg7IH1cclxuICAgICAgICAuYnRuLWFkZC1ncm91cGZpZWxke2Zsb2F0OiBsZWZ0O3dpZHRoOiAzMnB4O3BhZGRpbmc6IDBweDtwYWRkaW5nLXRvcDogM3B4OyBib3JkZXItcmFkaXVzOiAyMHB4O31cclxuICAgICAgICAuZ3JvdXAtZmllbGQtcGFuZWx7XHJcbiAgICAgICAgICAgIGhlaWdodDogMjYwcHg7IGJvcmRlci1yYWRpdXM6IDVweDsgei1pbmRleDogMztwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYigyNTUgMjU1IDI1NSk7IGJveC1zaGFkb3c6IDFweCAxcHggNHB4IHJnYigxNTYgMTU1IDE1NSAvIDc1JSk7XHJcbiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47XHJcbiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5ncm91cC1maWVsZC1wYW5lbCB1bCB7XHJcbiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazttYXJnaW46IDIwcHg7bWFyZ2luLXRvcDogNXB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICAuZ3JvdXAtZmllbGQtcGFuZWwgbGkge1xyXG4gICAgICAgICAgICBmbG9hdDogbGVmdDsgY3Vyc29yOiBwb2ludGVyO21heC13aWR0aDogMjAwcHg7bWFyZ2luLXJpZ2h0OiAxMHB4O3dpZHRoOiBhdXRvO1xyXG4gICAgICAgICAgICBwYWRkaW5nOiAxMHB4OyBtaW4td2lkdGg6IDgwcHg7IG1hcmdpbi10b3A6IDE1cHg7IHRleHQtYWxpZ246IGNlbnRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLmZvcm1hdC1zZXR0aW5nLWNvbHVtbiB7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjQ3LDI0OCwyNTEsMC42KTtcclxuICAgICAgICAgICAgcGFkZGluZzogN3B4IDEwcHg7XHJcbiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDVweDtcclxuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyMzMsMjM2LDI0MywwLjQ1KTtcclxuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICAuZm9ybWF0LXNldHRpbmctY29sdW1uLmFjdGl2ZSB7XHJcbiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYig0MiAxMzUgMjU1KTtcclxuICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiKDIzOSAyNDcgMjU1KTtcclxuICAgICAgICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHJnYig0MiAxMzUgMjU1KSFpbXBvcnRhbnQ7XHJcbiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2IoNDIgMTM1IDI1NSkhaW1wb3J0YW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYFxyXG4gICAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29sdW1uR3JvdXBTZXR0aW5nQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gICAgQElucHV0KCkgY29sdW1ucztcclxuICAgIEBJbnB1dCgpIGZpZWxkcyA9IFtdO1xyXG4gICAgQElucHV0KCkgZm9ybWF0Q29sdW1ucyA9IFtdO1xyXG5cclxuICAgIEBJbnB1dCgpIGdyb3VwRmllbGRzID0gW107XHJcblxyXG4gICAgQE91dHB1dCgpIGdyb3VwRmllbGRzQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgQE91dHB1dCgpIGZvcm1hdENvbHVtbnNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnZ3JvdXBpbmdTZXR0aW5nJykgZ3JvdXBpbmdTZXR0aW5nRWw6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdzZWxlY3Rjb2x1bW5zcGFuZWwnKSBzZWxlY3Rjb2x1bW5zcGFuZWw6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdncm91cFN1bWZvcm0nKSBjb2xGb3JtOiBOZ0Zvcm07XHJcblxyXG4gICAgZ3JvdXBDb2x1bW5zID0gW107XHJcbiAgICBhbGxvd0dyb3VwQ29sdW1ucyA9IFtdO1xyXG4gICAgYWN0aXZlQ2FsY3VsYXRpb25Db2wgPSBudWxsO1xyXG5cclxuICAgIHNob3dTZWxlY3RDb2x1bW5zUGFuZWwgPSBmYWxzZTtcclxuICAgIHN1bW1hcnlJdGVtcyA9IFtdO1xyXG4gICAgc3VtbWFyeUl0ZW1zMiA9IFtdO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHB1YmxpYyBncmlkU2V0dGluZ0NvbXBvbmVudFJlZjogRGF0YWdyaWRTZXR0aW5nc0NvbXBvbmVudCwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG5cclxuICAgICAgICB0aGlzLnN1bW1hcnlJdGVtcyA9IHRoaXMuZ3JpZFNldHRpbmdDb21wb25lbnRSZWYuc3VtbWFyeUl0ZW1zO1xyXG4gICAgICAgIHRoaXMuc3VtbWFyeUl0ZW1zMiA9IHRoaXMuZ3JpZFNldHRpbmdDb21wb25lbnRSZWYuc3VtbWFyeUl0ZW1zMjtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRHcm91cENvbHVtbnMoKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnRIYW5kbGUoKTtcclxuICAgICAgICB0aGlzLmluaXRDYWxjdWxhdGlvbkNvbHVtbnMoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29sRm9ybSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbEZvcm0udmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb2xGb3JtLnByaXN0aW5lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtYXRDb2x1bW5zQ2hhbmdlLmVtaXQodGhpcy5mb3JtYXRDb2x1bW5zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmZvcm1hdENvbHVtbnMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja0NvbHVtbk9wdGlvbnMobik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmZvcm1hdENvbHVtbnMgJiYgIWNoYW5nZXMuZm9ybWF0Q29sdW1ucy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtYXRDb2x1bW5zLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQ29sdW1uT3B0aW9ucyhuKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0R3JvdXBDb2x1bW5zKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdENhbGN1bGF0aW9uQ29sdW1ucygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRDYWxjdWxhdGlvbkNvbHVtbnMoKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVDYWxjdWxhdGlvbkNvbCA9IHRoaXMuZm9ybWF0Q29sdW1uc1swXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyRXZlbnRIYW5kbGUoKSB7XHJcbiAgICAgICAgdGhpcy5ncm91cGluZ1NldHRpbmdFbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0ICAhPT0gdGhpcy5zZWxlY3Rjb2x1bW5zcGFuZWwubmF0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93U2VsZWN0Q29sdW1uc1BhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRHcm91cENvbHVtbnMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JvdXBGaWVsZHMgJiYgdGhpcy5ncm91cEZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5ncm91cENvbHVtbnMgPSB0aGlzLmdyb3VwRmllbGRzLm1hcCggZiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb2x1bW5zWzBdLmZpbmQoY29sID0+IGNvbC5maWVsZCA9PT0gZik7XHJcbiAgICAgICAgICAgIH0pLmZpbHRlcihuID0+IG4pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBDb2x1bW5zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub25Hcm91cEZpZWxkc0NoYW5nZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0QWxsb3dHcm91cGluZ0NvbHVtbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1uc1swXS5maWx0ZXIobiA9PiBuLmFsbG93R3JvdXBpbmcgfHwgbi5hbGxvd0dyb3VwaW5nID09PSB1bmRlZmluZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25Hcm91cEZpZWxkc0NoYW5nZSgpIHtcclxuICAgICAgICB0aGlzLmdyb3VwRmllbGRzQ2hhbmdlLmVtaXQodGhpcy5ncm91cEZpZWxkcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0NvbHVtbk9wdGlvbnMoY29sKSB7XHJcbiAgICAgICAgaWYgKGNvbCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKGNvbC5ncm91cEZvb3RlciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb2wuZ3JvdXBGb290ZXIgPSB7IG9wdGlvbnM6IHtjYWxjdWxhdGlvblR5cGU6IC0xfSB9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMgPSBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucyB8fCB7Y2FsY3VsYXRpb25UeXBlOiAtMX07XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgPSAtMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gaWYgKHRoaXMuYWN0aXZlRmllbGQuZm9vdGVyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgLy8gICAgIHRoaXMuYWN0aXZlRmllbGQuZm9vdGVyID0gIHsgb3B0aW9uczoge2NhbGN1bGF0aW9uVHlwZTogLTF9IH07XHJcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLmFjdGl2ZUZpZWxkLmZvb3Rlci5vcHRpb25zID0gdGhpcy5hY3RpdmVGaWVsZC5mb290ZXIub3B0aW9ucyB8fCB7Y2FsY3VsYXRpb25UeXBlOiAtMX07XHJcbiAgICAgICAgICAgIC8vICAgICBpZiAodGhpcy5hY3RpdmVGaWVsZC5mb290ZXIub3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHRoaXMuYWN0aXZlRmllbGQuZm9vdGVyLm9wdGlvbnMuY2FsY3VsYXRpb25UeXBlID0gLTE7XHJcbiAgICAgICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmmL7npLrmiJbpmpDol4/lrZfmrrXpgInlj5bpnaLmnb9cclxuICAgICAqL1xyXG4gICAgdG9nZ2xlR3JvdXBpbmdDb2x1bW5QYW5lbCgkZXZlbnQpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5zaG93U2VsZWN0Q29sdW1uc1BhbmVsID0gIXRoaXMuc2hvd1NlbGVjdENvbHVtbnNQYW5lbDtcclxuICAgICAgICB0aGlzLmFsbG93R3JvdXBDb2x1bW5zID0gdGhpcy5nZXRBbGxvd0dyb3VwaW5nQ29sdW1ucygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmt7vliqDliIbnu4TlrZfmrrUgKi9cclxuICAgIGFkZEdyb3VwQ29sdW1uKCRldmVudCwgY29sKSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmICh0aGlzLmdyb3VwRmllbGRzLmluZGV4T2YoY29sLmZpZWxkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5ncm91cENvbHVtbnMgPSBbLi4udGhpcy5ncm91cENvbHVtbnMsIGNvbF07XHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBGaWVsZHMgPSB0aGlzLmdyb3VwQ29sdW1ucy5tYXAobiA9PiBuLmZpZWxkKTtcclxuICAgICAgICAgICAgdGhpcy5vbkdyb3VwRmllbGRzQ2hhbmdlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1NlbGVjdENvbHVtbnNQYW5lbCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKiog56e76Zmk5YiG57uE5a2X5q61ICovXHJcbiAgICBvblJlbW92ZUdyb3VwaW5nRmllbGQoJGV2ZW50LCBjb2wpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5ncm91cEZpZWxkcyA9IHRoaXMuZ3JvdXBGaWVsZHMuZmlsdGVyKG4gPT4gbiAhPT0gY29sLmZpZWxkKTtcclxuICAgICAgICB0aGlzLnNldEdyb3VwQ29sdW1ucygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmi5bliqjliIbnu4TlrZfmrrXov5vooYzmjpLluo8gKi9cclxuICAgIG9uR3JvdXBpbmdGaWVsZERyb3BwZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2dyb3VwaW5nIGZpZWxkIGRyb3BlZC4nLCAkZXZlbnQpO1xyXG4gICAgICAgIGNvbnN0IHsgcmVtb3ZlZEluZGV4LCBhZGRlZEluZGV4IH0gPSAkZXZlbnQ7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlbW92ZWRJdGVtID0gdGhpcy5ncm91cEZpZWxkcy5zcGxpY2UocmVtb3ZlZEluZGV4LCAxKTtcclxuICAgICAgICB0aGlzLmdyb3VwRmllbGRzLnNwbGljZShhZGRlZEluZGV4LCAwLCAuLi5yZW1vdmVkSXRlbSk7XHJcbiAgICAgICAgdGhpcy5zZXRHcm91cENvbHVtbnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkZpZWxkQ2xpY2soJGV2ZW50LCBjb2wpIHtcclxuICAgICAgICB0aGlzLmFjdGl2ZUNhbGN1bGF0aW9uQ29sID0gY29sO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==