/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { delay, filter } from 'rxjs/operators';
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2019-08-12 07:47:12
* @LastEditors: 疯狂秀才(Lucas Huang)
* @LastEditTime: 2019-11-27 13:31:43
* @QQ: 1055818239
* @Version: v0.0.1
*/
import { Renderer2, Self, NgZone, ChangeDetectorRef, Optional, ContentChildren, QueryList } from '@angular/core';
import { Validators, FormBuilder, FormGroup } from '@angular/forms';
import { Directive, Input, Output, EventEmitter, HostListener, ElementRef, Injector, Inject, forwardRef } from '@angular/core';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { DatagridCellComponent } from './datagrid-cell.component';
import { DatagridRowHoverDirective } from './datagrid-row-hover.directive';
import { Utils } from '../../utils/utils';
import { DatagridBodyComponent } from './datagrid-body.component';
import { ALLOW_EDIT_CELL_HIGHLIGHT_CLS } from '../../types/constant';
var DatagridRowDirective = /** @class */ (function () {
    function DatagridRowDirective(dg, injector, fb, el, render, drHover) {
        this.dg = dg;
        this.injector = injector;
        this.fb = fb;
        this.el = el;
        this.render = render;
        this.drHover = drHover;
        this.editable = false;
        this.clickHandler = new EventEmitter();
        this.form = new FormGroup({});
        this.documentRowDblclickEvent = null;
        this.columnsChangedSubscription = null;
        this.datasourceChangedSubscription = null;
        this.subscriptions = [];
        this.dfs = this.injector.get(DatagridFacadeService);
        this.ngZone = this.injector.get(NgZone);
        this.cd = this.injector.get(ChangeDetectorRef);
        this.dgb = this.injector.get(DatagridBodyComponent);
    }
    Object.defineProperty(DatagridRowDirective.prototype, "rowId", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.rowData) {
                return this.dfs.primaryId(this.rowData);
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridRowDirective.prototype, "disabled", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.dg.disableRow) {
                return this.dg.disableRow(this.rowData, this.rowIndex);
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.datasourceChangedSubscription = this.dg.dgs.onDataSourceChange.subscribe((/**
         * @return {?}
         */
        function () {
            _this.renderCustomStyle();
        }));
        this.columnsChangedSubscription = this.dg.dgs.columnsChanged.subscribe((/**
         * @return {?}
         */
        function () {
            _this.createControl();
        }));
        /** @type {?} */
        var s$ = this.dg.dfs.rowUpdate$.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            if (row && row.data) {
                // this.rowData = cloneDeep(row.data);
                if (_this.dfs.primaryId(row.data) === _this.rowId) {
                    _this.renderCustomStyle(row.data);
                }
                // this.cd.detectChanges();
            }
        }));
        this.subscriptions.push(s$);
        /** @type {?} */
        var s1$ = this.dg.dgs.updateEmptyStyle$.subscribe((/**
         * @return {?}
         */
        function () {
            _this.updateCellEmptyStyle();
        }));
        this.subscriptions.push(s1$);
        /** @type {?} */
        var s2$ = this.dg.dfs.selectRow$.pipe(filter((/**
         * @param {?} r
         * @return {?}
         */
        function (r) {
            return r.id === _this.rowId;
        }))).subscribe((/**
         * @return {?}
         */
        function () {
            if (_this.dg.selectedRow && !_this.dg.selectedRow.dr) {
                /** @type {?} */
                var p = _this.getRowPosition();
                if (p === 'left') {
                    _this.dg.selectedRow.drl = _this;
                }
                else if (p === 'right') {
                    _this.dg.selectedRow.drr = _this;
                }
                else {
                    _this.dg.selectedRow.dr = _this;
                }
            }
        }));
        this.subscriptions.push(s2$);
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.columnsChangedSubscription) {
            this.columnsChangedSubscription.unsubscribe();
            this.columnsChangedSubscription = null;
        }
        if (this.datasourceChangedSubscription) {
            this.datasourceChangedSubscription.unsubscribe();
            this.datasourceChangedSubscription = null;
        }
        if (this.subscriptions && this.subscriptions.length) {
            this.subscriptions.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.unsubscribe(); }));
            this.subscriptions = [];
        }
        if (this.form) {
            this.form = null;
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridRowDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.updateCellEmptyStyle();
        }
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.renderCustomStyle();
        this.updateCellEmptyStyle();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridRowDirective.prototype.getRowPosition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var id = this.el.nativeElement.id;
        if (id.indexOf('fixedleft') > -1) {
            return 'left';
        }
        else if (id.indexOf('fixedright') > -1) {
            return 'right';
        }
        else {
            return 'center';
        }
    };
    /**
     * @param {?=} rowData
     * @return {?}
     */
    DatagridRowDirective.prototype.renderCustomStyle = /**
     * @param {?=} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData === void 0) { rowData = null; }
        if (this.dg.rowStyler) {
            /** @type {?} */
            var _rd = rowData || this.rowData;
            /** @type {?} */
            var trStyle = this.dg.rowStyler(_rd, this.rowIndex);
            if (trStyle && Object.keys(trStyle).length) {
                this.dg.renderCustomStyle(trStyle, this.el.nativeElement);
            }
            else {
                this.dg.dgs.removeCssRule("#" + this.dg.id + " #" + this.el.nativeElement.id);
            }
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridRowDirective.prototype.onRowClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (event.target['className'] && event.target['className'].indexOf('checkbox-column') > -1) {
            return;
        }
        if (!this.dg.enableSelectRow) {
            return;
        }
        if (this.dg.disabled) {
            return;
        }
        if (this.dg.disableRow) {
            if (this.dg.disableRow(this.rowData, this.rowIndex)) {
                event.stopPropagation();
                return false;
            }
        }
        // if (!this.dg.editable) {
        //     event.stopPropagation();
        // }
        /** @type {?} */
        var rowId = this.dfs.primaryId(this.rowData);
        if (!rowId) {
            console.warn("\u5728\u7B2C " + (this.rowIndex + 1) + " \u884C\uFF0C\u4E3B\u952E\u5B57\u6BB5[" + this.dg.idField + "]\u7684\u503C\u4E3A \u7A7A\uFF0C\u8BF7\u68C0\u67E5\u76F8\u5173\u6570\u636E\u3002");
        }
        /** @type {?} */
        var beforEventParam = {
            rowIndex: this.rowIndex,
            rowData: this.rowData,
            gridInstance: this.dg
        };
        if (!event.shiftKey) {
            this.dg.dgs.focusRowChanged.emit({
                rowIndex: this.rowIndex,
                rowData: this.rowData
            });
        }
        /** @type {?} */
        var useNewSelectionMode = this.dg.sms.beforRowClick(tslib_1.__assign({}, beforEventParam, { e: event, id: rowId, dr: this }));
        if (useNewSelectionMode) {
            return;
        }
        if (!this.dfs.isRowSelected(rowId)) {
            /** @type {?} */
            var canendedit = this.dg.endRowEdit();
            if (!canendedit || canendedit.canEnd) {
                this.dg.beforeSelect(beforEventParam).pipe(delay(100)).subscribe((/**
                 * @param {?} canSelect
                 * @return {?}
                 */
                function (canSelect) {
                    if (canSelect) {
                        _this.dfs.selectRow(_this.rowIndex, _this.rowData);
                        if (_this.dg.selectedRow) {
                            _this.dg.selectedRow.dr = _this;
                        }
                        /** @type {?} */
                        var trCLS = _this.el.nativeElement.className;
                        if (trCLS.indexOf('f-datagrid-row-selected') === -1) {
                            _this.el.nativeElement.className = trCLS + ' f-datagrid-row-selected';
                        }
                        // this.drHover.setRowHoverCls(false);
                        // this.dg.selectChanged.emit(this.dg.selectedRow);
                        _this.clickHandler.emit();
                    }
                    _this.dg.rowClick.emit({ data: _this.rowData, grid: _this.dg, dblclick: false });
                    _this.dg.dgs.setSelecedRow.emit({ selected: true, id: _this.dfs.primaryId(_this.rowData) });
                }));
            }
        }
        else {
            if (this.dg.selectedRow && !this.dg.selectedRow.dr) {
                this.dg.selectedRow.dr = this;
            }
            if (!this.dg.keepSelect) {
                this.dg.beforeUnselect(beforEventParam).subscribe((/**
                 * @param {?} canUnselect
                 * @return {?}
                 */
                function (canUnselect) {
                    if (canUnselect) {
                        // this.dg.unSelect.emit(this.dg.selectedRow);
                        _this.dfs.unSelectRow(_this.rowIndex, _this.rowData);
                        /** @type {?} */
                        var trCLS = _this.el.nativeElement.className;
                        if (trCLS.indexOf('f-datagrid-row-selected') > -1) {
                            _this.el.nativeElement.className = trCLS.replace('f-datagrid-row-selected', '');
                        }
                    }
                    _this.dg.rowClick.emit({ data: _this.rowData, grid: _this.dg, dblclick: false });
                    _this.dg.dgs.setSelecedRow.emit();
                }));
            }
            else {
                this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.initFormControl = /**
     * @return {?}
     */
    function () {
        this.form = this.fb.group({});
        this.createControl();
        this.form['bindingData'] = this.rowData;
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.createControl = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.dg && this.dg.flatColumns) {
            this.dg.flatColumns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                if (!col.editor && !col.editorTemplate) {
                    return;
                }
                if (!_this.form.controls[col.field]) {
                    /** @type {?} */
                    var control = _this.createFormControl(col);
                    _this.form.addControl(col.field, control);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} col
     * @return {?}
     */
    DatagridRowDirective.prototype.createFormControl = /**
     * @private
     * @param {?} col
     * @return {?}
     */
    function (col) {
        return this.fb.control(Utils.getValue(col.field, this.rowData), {
            validators: col.editor ? this.bindValidations(col.editor.validators) : null
        });
    };
    /**
     * @private
     * @param {?} validators
     * @return {?}
     */
    DatagridRowDirective.prototype.bindValidations = /**
     * @private
     * @param {?} validators
     * @return {?}
     */
    function (validators) {
        var _this = this;
        /** @type {?} */
        var validations = [];
        if (validators && validators.length) {
            validators.forEach((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                /** @type {?} */
                var validation = null;
                switch (v.type) {
                    case 'required':
                        validation = Validators.required;
                        break;
                    case 'min':
                        validation = Validators.min(v.value);
                        break;
                    case 'max':
                        validation = Validators.max(v.value);
                        break;
                    case 'minLength':
                        validation = Validators.minLength(v.value);
                        break;
                    case 'maxLength':
                        validation = Validators.maxLength(v.value);
                        break;
                    case 'email':
                        validation = Validators.email;
                        break;
                    case 'requiredTrue':
                        validation = Validators.requiredTrue;
                        break;
                    case 'pattern':
                        validation = Validators.pattern(v.value);
                        break;
                }
                if (validation) {
                    validations.push(validation);
                }
                else {
                    if (_this.dg.validators && _this.dg.validators.length) {
                        /** @type {?} */
                        var vfn = _this.dg.validators.find((/**
                         * @param {?} vr
                         * @return {?}
                         */
                        function (vr) { return vr.name === v.type; }));
                        if (vfn) {
                            validation = vfn.value(_this.rowData);
                            validations.push(validation);
                        }
                    }
                }
            }));
        }
        return validations;
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.refresh = /**
     * @return {?}
     */
    function () {
        this.updateRowHeight();
        this.updateCellEmptyStyle();
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.updateRowHeight = /**
     * @return {?}
     */
    function () {
        if (!this.dg.nowrap) {
            /** @type {?} */
            var centerTr = this.dgb.mainArea.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
            centerTr.style.height = 'auto';
            /** @type {?} */
            var trHeight = centerTr.offsetHeight;
            /** @type {?} */
            var leftTrDom = null;
            /** @type {?} */
            var rightTrDom = null;
            /** @type {?} */
            var heightSizeList = [trHeight];
            if (this.dgb) {
                if (this.dgb.fixedLeftEl) {
                    leftTrDom = this.dgb.fixedLeftEl.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
                    if (leftTrDom) {
                        leftTrDom.style.height = 'auto';
                        heightSizeList.push(leftTrDom.offsetHeight);
                    }
                }
                if (this.dgb.fixedRightEl) {
                    rightTrDom = this.dgb.fixedRightEl.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
                    if (rightTrDom) {
                        rightTrDom.style.height = 'auto';
                        heightSizeList.push(rightTrDom.offsetHeight);
                    }
                }
                /** @type {?} */
                var maxHeight = Math.max.apply(Math, tslib_1.__spread(heightSizeList));
                centerTr.style.height = maxHeight + "px";
                if (leftTrDom) {
                    leftTrDom.style.height = maxHeight + "px";
                }
                if (rightTrDom) {
                    rightTrDom.style.height = maxHeight + "px";
                }
                this.cd.markForCheck();
                this.dgb.updateCanvasHeight();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridRowDirective.prototype.updateCellEmptyStyle = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.dg.enableEditCellStyle) {
            return;
        }
        /** @type {?} */
        var rowIsDisabled = false;
        if (this.dg.disableRow) {
            rowIsDisabled = this.dg.disableRow(this.rowData, this.rowIndex);
        }
        /** @type {?} */
        var updateCellEmptyText = (/**
         * @param {?} cells
         * @return {?}
         */
        function (cells) {
            if (cells.length) {
                for (var k = 0; k < cells.length; k++) {
                    /** @type {?} */
                    var field = cells[k].getAttribute('field');
                    if (field) {
                        /** @type {?} */
                        var col = _this.dfs.getColumn(field);
                        if (col) {
                            if (!col.editor) {
                                continue;
                            }
                            /** @type {?} */
                            var cls = col.align === 'right' ? 'allow-edit-cell-left' : 'allow-edit-cell';
                            /** @type {?} */
                            var emptyicon_cls = ALLOW_EDIT_CELL_HIGHLIGHT_CLS[col.editor.type];
                            /** @type {?} */
                            var span = cells[k].querySelector('.cell-text-box');
                            /** @type {?} */
                            var colVal = Utils.getValue(field, _this.rowData);
                            /** @type {?} */
                            var fmtVal = _this.dg.colFormatSer.format(colVal, _this.rowData, col.formatter);
                            if (!_this.dg.editable || rowIsDisabled || _this.dg.cellIsReadOnly(col, _this.rowData)) {
                                cells[k].className = cells[k].className.replace(cls, '');
                                cells[k].className = cells[k].className.replace(emptyicon_cls, '');
                                if (span) {
                                    if (span.className.indexOf('cell-empty') > -1) {
                                        span.className = span.className.replace('cell-empty', '');
                                    }
                                    if (colVal === '' || colVal === null || colVal === undefined) {
                                        span.innerHTML = '';
                                    }
                                    else {
                                        span.innerHTML = fmtVal;
                                    }
                                }
                            }
                            else {
                                if (span) {
                                    if (colVal === '' || colVal === null || colVal === undefined) {
                                        if (span.className.indexOf('cell-empty') === -1) {
                                            span.className = span.className + ' cell-empty';
                                        }
                                        span.innerHTML = Utils.getWhenEmptyText(col, _this.dg.localeService.localeId);
                                    }
                                    else {
                                        span.innerHTML = fmtVal;
                                    }
                                }
                                if (cells[k].className.indexOf('cell-readonly') > -1) {
                                    cells[k].className = cells[k].className.replace('cell-readonly', '');
                                }
                                if (cells[k].className.indexOf(cls) === -1) {
                                    _this.render.addClass(cells[k], cls);
                                }
                                if (cells[k].className.indexOf(emptyicon_cls) === -1) {
                                    _this.render.addClass(cells[k], emptyicon_cls);
                                }
                            }
                        }
                    }
                }
            }
        });
        // if (this.dgb.fixedLeftEl) {
        //     const leftTrDom = this.dgb.fixedLeftEl.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
        //     if (leftTrDom) {
        //         updateCellEmptyText(leftTrDom.querySelectorAll('td[field]'));
        //     }
        // }
        /** @type {?} */
        var cells = this.el.nativeElement.querySelectorAll('td[field]:not([field="_datagrid-setting-control_"])');
        updateCellEmptyText(cells);
    };
    DatagridRowDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[grid-row]',
                    exportAs: 'gridRow'
                },] }
    ];
    /** @nocollapse */
    DatagridRowDirective.ctorParameters = function () { return [
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] },
        { type: Injector },
        { type: FormBuilder },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DatagridRowHoverDirective, decorators: [{ type: Optional }, { type: Self }] }
    ]; };
    DatagridRowDirective.propDecorators = {
        editable: [{ type: Input }],
        rowData: [{ type: Input, args: ['grid-row',] }],
        rowIndex: [{ type: Input }],
        clickHandler: [{ type: Output }],
        cells: [{ type: ContentChildren, args: [forwardRef((/**
                     * @return {?}
                     */
                    function () { return DatagridCellComponent; })), { descendants: true },] }],
        onRowClick: [{ type: HostListener, args: ['click', ['$event'],] }]
    };
    return DatagridRowDirective;
}());
export { DatagridRowDirective };
if (false) {
    /** @type {?} */
    DatagridRowDirective.prototype.editable;
    /** @type {?} */
    DatagridRowDirective.prototype.rowData;
    /** @type {?} */
    DatagridRowDirective.prototype.rowIndex;
    /** @type {?} */
    DatagridRowDirective.prototype.clickHandler;
    /** @type {?} */
    DatagridRowDirective.prototype.cells;
    /** @type {?} */
    DatagridRowDirective.prototype.form;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.documentRowDblclickEvent;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.dgb;
    /** @type {?} */
    DatagridRowDirective.prototype.cd;
    /** @type {?} */
    DatagridRowDirective.prototype.columnsChangedSubscription;
    /** @type {?} */
    DatagridRowDirective.prototype.datasourceChangedSubscription;
    /** @type {?} */
    DatagridRowDirective.prototype.subscriptions;
    /** @type {?} */
    DatagridRowDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.fb;
    /** @type {?} */
    DatagridRowDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.render;
    /** @type {?} */
    DatagridRowDirective.prototype.drHover;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtcm93LmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9ib2R5L2RhdGFncmlkLXJvdy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7QUFVL0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUE0QixpQkFBaUIsRUFBYSxRQUFRLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0SixPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRSxPQUFPLEVBQ0gsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFDNUMsVUFBVSxFQUFpQixRQUFRLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFDbEUsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFHbEUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDM0UsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRWxFLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXJFO0lBcUNJLDhCQUN3RCxFQUFxQixFQUNqRSxRQUFrQixFQUFVLEVBQWUsRUFBUyxFQUFjLEVBQ2xFLE1BQWlCLEVBQTZCLE9BQWtDO1FBRnBDLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ2pFLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFhO1FBQVMsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNsRSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQTZCLFlBQU8sR0FBUCxPQUFPLENBQTJCO1FBbkNuRixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBR2hCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQW1CNUMsU0FBSSxHQUFjLElBQUksU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTVCLDZCQUF3QixHQUFRLElBQUksQ0FBQztRQUs3QywrQkFBMEIsR0FBaUIsSUFBSSxDQUFDO1FBQ2hELGtDQUE2QixHQUFpQixJQUFJLENBQUM7UUFDbkQsa0JBQWEsR0FBbUIsRUFBRSxDQUFDO1FBSy9CLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDeEQsQ0FBQztJQWpDRCxzQkFBSSx1Q0FBSzs7OztRQUFUO1lBQ0ksSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO2dCQUNkLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQzNDO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwwQ0FBUTs7OztRQUFaO1lBQ0ksSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRTtnQkFDcEIsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUMxRDtZQUNELE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUM7OztPQUFBOzs7O0lBdUJELHVDQUFROzs7SUFBUjtRQUFBLGlCQTJDQztRQTFDRyxJQUFJLENBQUMsNkJBQTZCLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsU0FBUzs7O1FBQUM7WUFDMUUsS0FBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDN0IsQ0FBQyxFQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsMEJBQTBCLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLFNBQVM7OztRQUFDO1lBQ25FLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QixDQUFDLEVBQUMsQ0FBQzs7WUFFRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFDLEdBQWlDO1lBQzFFLElBQUksR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2pCLHNDQUFzQztnQkFDdEMsSUFBSSxLQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSSxDQUFDLEtBQUssRUFBRTtvQkFDN0MsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDcEM7Z0JBQ0QsMkJBQTJCO2FBQzlCO1FBQ0wsQ0FBQyxFQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7O1lBRXRCLEdBQUcsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTOzs7UUFBQztZQUNoRCxLQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUNoQyxDQUFDLEVBQUM7UUFDRixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQzs7WUFFdkIsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQ25DLE1BQU07Ozs7UUFBQyxVQUFDLENBQU07WUFDVixPQUFPLENBQUMsQ0FBQyxFQUFFLEtBQUssS0FBSSxDQUFDLEtBQUssQ0FBQztRQUMvQixDQUFDLEVBQUMsQ0FDTCxDQUFDLFNBQVM7OztRQUFDO1lBQ1IsSUFBSSxLQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsSUFBSSxDQUFDLEtBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsRUFBRTs7b0JBQzFDLENBQUMsR0FBRyxLQUFJLENBQUMsY0FBYyxFQUFFO2dCQUMvQixJQUFJLENBQUMsS0FBSyxNQUFNLEVBQUU7b0JBQ2QsS0FBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxHQUFHLEtBQUksQ0FBQztpQkFDbEM7cUJBQU0sSUFBSSxDQUFDLEtBQUssT0FBTyxFQUFFO29CQUN0QixLQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEdBQUcsS0FBSSxDQUFDO2lCQUNsQztxQkFBTTtvQkFDSCxLQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEdBQUcsS0FBSSxDQUFDO2lCQUNqQzthQUNKO1FBQ0wsQ0FBQyxFQUFDO1FBRUYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQzs7OztJQUVELDBDQUFXOzs7SUFBWDtRQUNJLElBQUksSUFBSSxDQUFDLDBCQUEwQixFQUFFO1lBQ2pDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM5QyxJQUFJLENBQUMsMEJBQTBCLEdBQUcsSUFBSSxDQUFDO1NBQzFDO1FBRUQsSUFBSSxJQUFJLENBQUMsNkJBQTZCLEVBQUU7WUFDcEMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2pELElBQUksQ0FBQyw2QkFBNkIsR0FBRyxJQUFJLENBQUM7U0FDN0M7UUFFRCxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUU7WUFDakQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQWYsQ0FBZSxFQUFDLENBQUM7WUFDakQsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7U0FDM0I7UUFFRCxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDWCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNwQjtJQUNMLENBQUM7Ozs7O0lBRUQsMENBQVc7Ozs7SUFBWCxVQUFZLE9BQXNCO1FBQzlCLElBQUksT0FBTyxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDckQsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7U0FDL0I7SUFDTCxDQUFDOzs7O0lBRUQsOENBQWU7OztJQUFmO1FBQ0ksSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7SUFDaEMsQ0FBQzs7Ozs7SUFFTyw2Q0FBYzs7OztJQUF0Qjs7WUFDVSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFBRTtRQUNuQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDOUIsT0FBTyxNQUFNLENBQUM7U0FDakI7YUFBTSxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDdEMsT0FBTyxPQUFPLENBQUM7U0FDbEI7YUFBTTtZQUNILE9BQU8sUUFBUSxDQUFDO1NBQ25CO0lBQ0wsQ0FBQzs7Ozs7SUFHRCxnREFBaUI7Ozs7SUFBakIsVUFBa0IsT0FBYztRQUFkLHdCQUFBLEVBQUEsY0FBYztRQUM1QixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFOztnQkFDYixHQUFHLEdBQUcsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPOztnQkFDN0IsT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQ3JELElBQUksT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFO2dCQUN4QyxJQUFJLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO2FBQzdEO2lCQUFNO2dCQUNILElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxVQUFLLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUksQ0FBQyxDQUFDO2FBQzVFO1NBQ0o7SUFDTCxDQUFDOzs7OztJQUdELHlDQUFVOzs7O0lBRFYsVUFDVyxLQUFpQjtRQUQ1QixpQkFnR0M7UUE3RkcsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDeEYsT0FBTztTQUNWO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsZUFBZSxFQUFFO1lBQzFCLE9BQU87U0FDVjtRQUVELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUU7WUFDbEIsT0FBTztTQUNWO1FBRUQsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRTtZQUNwQixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNqRCxLQUFLLENBQUMsZUFBZSxFQUFFLENBQUM7Z0JBQ3hCLE9BQU8sS0FBSyxDQUFDO2FBQ2hCO1NBQ0o7Ozs7O1lBTUssS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFFOUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNSLE9BQU8sQ0FBQyxJQUFJLENBQUMsbUJBQU0sSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLCtDQUFXLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxxRkFBaUIsQ0FBQyxDQUFDO1NBQ3BGOztZQUVLLGVBQWUsR0FBRztZQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRTtTQUN4QjtRQUVELElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7Z0JBQzdCLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtnQkFDdkIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO2FBQ3hCLENBQUMsQ0FBQztTQUNOOztZQUNLLG1CQUFtQixHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGFBQWEsc0JBQU0sZUFBZSxJQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsSUFBSSxJQUFHO1FBQzVHLElBQUksbUJBQW1CLEVBQUU7WUFDckIsT0FBTztTQUNWO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxFQUFFOztnQkFDMUIsVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFO1lBRXZDLElBQUksQ0FBQyxVQUFVLElBQUksVUFBVSxDQUFDLE1BQU0sRUFBRTtnQkFDbEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUN0QyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQ2IsQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUMsU0FBa0I7b0JBQzNCLElBQUksU0FBUyxFQUFFO3dCQUNYLEtBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUNoRCxJQUFJLEtBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFOzRCQUNyQixLQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEdBQUcsS0FBSSxDQUFDO3lCQUNqQzs7NEJBQ0ssS0FBSyxHQUFHLEtBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLFNBQVM7d0JBQzdDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFOzRCQUNqRCxLQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEdBQUcsS0FBSyxHQUFHLDBCQUEwQixDQUFDO3lCQUN4RTt3QkFDRCxzQ0FBc0M7d0JBQ3RDLG1EQUFtRDt3QkFDbkQsS0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQztxQkFDNUI7b0JBQ0QsS0FBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUksQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7b0JBQzlFLEtBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxLQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUM3RixDQUFDLEVBQUMsQ0FBQzthQUNOO1NBQ0o7YUFBTTtZQUNILElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2hELElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUM7YUFDakM7WUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3JCLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxDQUFDLFNBQVM7Ozs7Z0JBQUMsVUFBQyxXQUFvQjtvQkFDbkUsSUFBSSxXQUFXLEVBQUU7d0JBQ2IsOENBQThDO3dCQUM5QyxLQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxLQUFJLENBQUMsUUFBUSxFQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzs7NEJBRTVDLEtBQUssR0FBRyxLQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxTQUFTO3dCQUM3QyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMseUJBQXlCLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTs0QkFDL0MsS0FBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMseUJBQXlCLEVBQUUsRUFBRSxDQUFDLENBQUM7eUJBQ2xGO3FCQUNKO29CQUNELEtBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFJLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxLQUFJLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO29CQUM5RSxLQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3JDLENBQUMsRUFBQyxDQUFDO2FBQ047aUJBQU07Z0JBQ0gsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7YUFDakY7U0FDSjtJQUNMLENBQUM7Ozs7SUFFRCw4Q0FBZTs7O0lBQWY7UUFDSSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDNUMsQ0FBQzs7OztJQUVELDRDQUFhOzs7SUFBYjtRQUFBLGlCQVVDO1FBVEcsSUFBSSxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLE9BQU87Ozs7WUFBQyxVQUFBLEdBQUc7Z0JBQzNCLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRTtvQkFBRSxPQUFPO2lCQUFFO2dCQUNuRCxJQUFJLENBQUMsS0FBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFOzt3QkFDMUIsT0FBTyxHQUFHLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUM7b0JBQzNDLEtBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7aUJBQzVDO1lBQ0wsQ0FBQyxFQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7Ozs7OztJQUVPLGdEQUFpQjs7Ozs7SUFBekIsVUFBMEIsR0FBRztRQUN6QixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUNsQixLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUN2QztZQUNJLFVBQVUsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7U0FDOUUsQ0FDSixDQUFDO0lBQ04sQ0FBQzs7Ozs7O0lBRU8sOENBQWU7Ozs7O0lBQXZCLFVBQXdCLFVBQStCO1FBQXZELGlCQThDQzs7WUE3Q1MsV0FBVyxHQUFHLEVBQUU7UUFDdEIsSUFBSSxVQUFVLElBQUksVUFBVSxDQUFDLE1BQU0sRUFBRTtZQUVqQyxVQUFVLENBQUMsT0FBTzs7OztZQUFDLFVBQUMsQ0FBb0I7O29CQUNoQyxVQUFVLEdBQUcsSUFBSTtnQkFDckIsUUFBUSxDQUFDLENBQUMsSUFBSSxFQUFFO29CQUNaLEtBQUssVUFBVTt3QkFDWCxVQUFVLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQzt3QkFDakMsTUFBTTtvQkFDVixLQUFLLEtBQUs7d0JBQ04sVUFBVSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNyQyxNQUFNO29CQUNWLEtBQUssS0FBSzt3QkFDTixVQUFVLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQ3JDLE1BQU07b0JBQ1YsS0FBSyxXQUFXO3dCQUNaLFVBQVUsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQzt3QkFDM0MsTUFBTTtvQkFDVixLQUFLLFdBQVc7d0JBQ1osVUFBVSxHQUFHLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUMzQyxNQUFNO29CQUNWLEtBQUssT0FBTzt3QkFDUixVQUFVLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQzt3QkFDOUIsTUFBTTtvQkFDVixLQUFLLGNBQWM7d0JBQ2YsVUFBVSxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUM7d0JBQ3JDLE1BQU07b0JBQ1YsS0FBSyxTQUFTO3dCQUNWLFVBQVUsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQzt3QkFDekMsTUFBTTtpQkFDYjtnQkFDRCxJQUFJLFVBQVUsRUFBRTtvQkFDWixXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUNoQztxQkFBTTtvQkFDSCxJQUFJLEtBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxJQUFJLEtBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRTs7NEJBQzNDLEdBQUcsR0FBRyxLQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJOzs7O3dCQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFsQixDQUFrQixFQUFDO3dCQUM3RCxJQUFJLEdBQUcsRUFBRTs0QkFDTCxVQUFVLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7NEJBQ3JDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7eUJBQ2hDO3FCQUNKO2lCQUNKO1lBQ0wsQ0FBQyxFQUFDLENBQUM7U0FDTjtRQUNELE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7Ozs7SUFHRCxzQ0FBTzs7O0lBQVA7UUFDSSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7SUFDaEMsQ0FBQzs7OztJQUVELDhDQUFlOzs7SUFBZjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRTs7Z0JBQ1gsUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ25HLFFBQVEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQzs7Z0JBQ3pCLFFBQVEsR0FBRyxRQUFRLENBQUMsWUFBWTs7Z0JBQ2xDLFNBQVMsR0FBRyxJQUFJOztnQkFDaEIsVUFBVSxHQUFHLElBQUk7O2dCQUNmLGNBQWMsR0FBRyxDQUFDLFFBQVEsQ0FBQztZQUNqQyxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRTtvQkFDdEIsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUM7b0JBQ2xHLElBQUksU0FBUyxFQUFFO3dCQUNYLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQzt3QkFDaEMsY0FBYyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7cUJBQy9DO2lCQUNKO2dCQUNELElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUU7b0JBQ3ZCLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDO29CQUNwRyxJQUFJLFVBQVUsRUFBRTt3QkFDWixVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7d0JBQ2pDLGNBQWMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDO3FCQUNoRDtpQkFDSjs7b0JBRUssU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLE9BQVIsSUFBSSxtQkFBUSxjQUFjLEVBQUM7Z0JBRTdDLFFBQVEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFNLFNBQVMsT0FBSSxDQUFDO2dCQUN6QyxJQUFJLFNBQVMsRUFBRTtvQkFDWCxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBTSxTQUFTLE9BQUksQ0FBQztpQkFDN0M7Z0JBRUQsSUFBSSxVQUFVLEVBQUU7b0JBQ1osVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQU0sU0FBUyxPQUFJLENBQUM7aUJBQzlDO2dCQUVELElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsQ0FBQzthQUNqQztTQUNKO0lBQ0wsQ0FBQzs7Ozs7SUFFTyxtREFBb0I7Ozs7SUFBNUI7UUFBQSxpQkFtRkM7UUFqRkcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsbUJBQW1CLEVBQUU7WUFDOUIsT0FBTztTQUNWOztZQUVHLGFBQWEsR0FBRyxLQUFLO1FBQ3pCLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7WUFDcEIsYUFBYSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ25FOztZQUVLLG1CQUFtQjs7OztRQUFHLFVBQUMsS0FBSztZQUM5QixJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUU7Z0JBRWQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7O3dCQUM3QixLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUM7b0JBQzVDLElBQUksS0FBSyxFQUFFOzs0QkFDRCxHQUFHLEdBQUcsS0FBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO3dCQUNyQyxJQUFJLEdBQUcsRUFBRTs0QkFFTCxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRTtnQ0FDYixTQUFTOzZCQUNaOztnQ0FDSyxHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxpQkFBaUI7O2dDQUN4RSxhQUFhLEdBQUcsNkJBQTZCLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7O2dDQUM5RCxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQzs7Z0NBQy9DLE1BQU0sR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDOztnQ0FDNUMsTUFBTSxHQUFHLEtBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsS0FBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDOzRCQUMvRSxJQUFJLENBQUMsS0FBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLElBQUksYUFBYSxJQUFJLEtBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0NBQ2pGLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dDQUN6RCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsQ0FBQztnQ0FDbkUsSUFBSSxJQUFJLEVBQUU7b0NBQ04sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTt3Q0FDM0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7cUNBQzdEO29DQUVELElBQUksTUFBTSxLQUFLLEVBQUUsSUFBSSxNQUFNLEtBQUssSUFBSSxJQUFJLE1BQU0sS0FBSyxTQUFTLEVBQUU7d0NBQzFELElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO3FDQUN2Qjt5Q0FBTTt3Q0FDSCxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztxQ0FDM0I7aUNBQ0o7NkJBQ0o7aUNBQU07Z0NBQ0gsSUFBSSxJQUFJLEVBQUU7b0NBQ04sSUFBSSxNQUFNLEtBQUssRUFBRSxJQUFJLE1BQU0sS0FBSyxJQUFJLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTt3Q0FDMUQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTs0Q0FDN0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLGFBQWEsQ0FBQzt5Q0FDbkQ7d0NBRUQsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLEtBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO3FDQUNoRjt5Q0FBTTt3Q0FDSCxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztxQ0FDM0I7aUNBQ0o7Z0NBRUQsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtvQ0FDbEQsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsRUFBRSxDQUFDLENBQUM7aUNBQ3hFO2dDQUVELElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7b0NBQ3hDLEtBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztpQ0FDdkM7Z0NBRUQsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtvQ0FDbEQsS0FBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxDQUFDO2lDQUNqRDs2QkFDSjt5QkFDSjtxQkFDSjtpQkFDSjthQUNKO1FBQ0wsQ0FBQyxDQUFBOzs7Ozs7OztZQVVLLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxxREFBcUQsQ0FBQztRQUMzRyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMvQixDQUFDOztnQkFuY0osU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxZQUFZO29CQUN0QixRQUFRLEVBQUUsU0FBUztpQkFDdEI7Ozs7Z0JBYlEsaUJBQWlCLHVCQWdEakIsTUFBTSxTQUFDLFVBQVU7Ozt3QkFBQyxjQUFNLE9BQUEsaUJBQWlCLEVBQWpCLENBQWlCLEVBQUM7Z0JBbkRaLFFBQVE7Z0JBSjFCLFdBQVc7Z0JBSXBCLFVBQVU7Z0JBTGIsU0FBUztnQkFZVCx5QkFBeUIsdUJBOENFLFFBQVEsWUFBSSxJQUFJOzs7MkJBbkMvQyxLQUFLOzBCQUNMLEtBQUssU0FBQyxVQUFVOzJCQUNoQixLQUFLOytCQUNMLE1BQU07d0JBRU4sZUFBZSxTQUFDLFVBQVU7OztvQkFBQyxjQUFNLE9BQUEscUJBQXFCLEVBQXJCLENBQXFCLEVBQUMsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUU7NkJBMEk5RSxZQUFZLFNBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDOztJQWdUckMsMkJBQUM7Q0FBQSxBQXBjRCxJQW9jQztTQWhjWSxvQkFBb0I7OztJQUM3Qix3Q0FBMEI7O0lBQzFCLHVDQUFnQzs7SUFDaEMsd0NBQTBCOztJQUMxQiw0Q0FBNEM7O0lBRTVDLHFDQUF5SDs7SUFpQnpILG9DQUFvQzs7Ozs7SUFDcEMsbUNBQW1DOzs7OztJQUNuQyx3REFBNkM7Ozs7O0lBQzdDLHNDQUF1Qjs7Ozs7SUFDdkIsbUNBQW1DOztJQUNuQyxrQ0FBc0I7O0lBRXRCLDBEQUFnRDs7SUFDaEQsNkRBQW1EOztJQUNuRCw2Q0FBbUM7O0lBRS9CLGtDQUF5RTs7Ozs7SUFDekUsd0NBQTBCOzs7OztJQUFFLGtDQUF1Qjs7SUFBRSxrQ0FBcUI7Ozs7O0lBQzFFLHNDQUF5Qjs7SUFBRSx1Q0FBNkQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWxheSwgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuLypcclxuKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiogQERhdGU6IDIwMTktMDgtMTIgMDc6NDc6MTJcclxuKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuKiBATGFzdEVkaXRUaW1lOiAyMDE5LTExLTI3IDEzOjMxOjQzXHJcbiogQFFROiAxMDU1ODE4MjM5XHJcbiogQFZlcnNpb246IHYwLjAuMVxyXG4qL1xyXG5pbXBvcnQgeyBSZW5kZXJlcjIsIFNlbGYsIE5nWm9uZSwgU2ltcGxlQ2hhbmdlcywgT25DaGFuZ2VzLCBDaGFuZ2VEZXRlY3RvclJlZiwgT25EZXN0cm95LCBPcHRpb25hbCwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVmFsaWRhdG9ycywgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7XHJcbiAgICBEaXJlY3RpdmUsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSG9zdExpc3RlbmVyLFxyXG4gICAgT25Jbml0LCBFbGVtZW50UmVmLCBBZnRlclZpZXdJbml0LCBJbmplY3RvciwgSW5qZWN0LCBmb3J3YXJkUmVmXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkRmFjYWRlU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENlbGxDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLWNlbGwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRSb3cgfSBmcm9tICcuLi8uLi90eXBlcy9kYXRhZ3JpZC1yb3cnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFZhbGlkYXRvciB9IGZyb20gJy4uLy4uL3R5cGVzL2RhdGFncmlkLXZhbGlkYXRvcic7XHJcbmltcG9ydCB7IERhdGFncmlkUm93SG92ZXJEaXJlY3RpdmUgfSBmcm9tICcuL2RhdGFncmlkLXJvdy1ob3Zlci5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgRGF0YWdyaWRCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEZvcm1hdENlbGxEYXRhUGlwZSB9IGZyb20gJy4uLy4uL3V0aWxzL2Zvcm1hdC1jZWxsLWRhdGEucGlwZSc7XHJcbmltcG9ydCB7IEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tncmlkLXJvd10nLFxyXG4gICAgZXhwb3J0QXM6ICdncmlkUm93J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRSb3dEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIERhdGFncmlkUm93LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcbiAgICBASW5wdXQoKSBlZGl0YWJsZSA9IGZhbHNlO1xyXG4gICAgQElucHV0KCdncmlkLXJvdycpIHJvd0RhdGE6IGFueTtcclxuICAgIEBJbnB1dCgpIHJvd0luZGV4OiBudW1iZXI7XHJcbiAgICBAT3V0cHV0KCkgY2xpY2tIYW5kbGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLy8g55So5LqO5pW06KGM57yW6L6R77yM5Yu/5Yqo77yB77yB77yBXHJcbiAgICBAQ29udGVudENoaWxkcmVuKGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRDZWxsQ29tcG9uZW50KSwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KSBjZWxsczogUXVlcnlMaXN0PERhdGFncmlkQ2VsbENvbXBvbmVudD47XHJcblxyXG4gICAgZ2V0IHJvd0lkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJvd0RhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGZzLnByaW1hcnlJZCh0aGlzLnJvd0RhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGlzYWJsZWQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZVJvdykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZy5kaXNhYmxlUm93KHRoaXMucm93RGF0YSwgdGhpcy5yb3dJbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZm9ybTogRm9ybUdyb3VwID0gbmV3IEZvcm1Hcm91cCh7fSk7XHJcbiAgICBwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBkb2N1bWVudFJvd0RibGNsaWNrRXZlbnQ6IGFueSA9IG51bGw7XHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lO1xyXG4gICAgcHJpdmF0ZSBkZ2I6IERhdGFncmlkQm9keUNvbXBvbmVudDtcclxuICAgIGNkOiBDaGFuZ2VEZXRlY3RvclJlZjtcclxuXHJcbiAgICBjb2x1bW5zQ2hhbmdlZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIGRhdGFzb3VyY2VDaGFuZ2VkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBEYXRhZ3JpZENvbXBvbmVudCkpIHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLCBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgQE9wdGlvbmFsKCkgQFNlbGYoKSBwdWJsaWMgZHJIb3ZlcjogRGF0YWdyaWRSb3dIb3ZlckRpcmVjdGl2ZSkge1xyXG4gICAgICAgIHRoaXMuZGZzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRGYWNhZGVTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLm5nWm9uZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nWm9uZSk7XHJcbiAgICAgICAgdGhpcy5jZCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKTtcclxuICAgICAgICB0aGlzLmRnYiA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkQm9keUNvbXBvbmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhc291cmNlQ2hhbmdlZFN1YnNjcmlwdGlvbiA9IHRoaXMuZGcuZGdzLm9uRGF0YVNvdXJjZUNoYW5nZS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckN1c3RvbVN0eWxlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuY29sdW1uc0NoYW5nZWRTdWJzY3JpcHRpb24gPSB0aGlzLmRnLmRncy5jb2x1bW5zQ2hhbmdlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNvbnRyb2woKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgcyQgPSB0aGlzLmRnLmRmcy5yb3dVcGRhdGUkLnN1YnNjcmliZSgocm93OiB7IGluZGV4OiBudW1iZXIsIGRhdGE6IGFueSB9KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyb3cgJiYgcm93LmRhdGEpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMucm93RGF0YSA9IGNsb25lRGVlcChyb3cuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZnMucHJpbWFyeUlkKHJvdy5kYXRhKSA9PT0gdGhpcy5yb3dJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyQ3VzdG9tU3R5bGUocm93LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzJCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHMxJCA9IHRoaXMuZGcuZGdzLnVwZGF0ZUVtcHR5U3R5bGUkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ2VsbEVtcHR5U3R5bGUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzMSQpO1xyXG5cclxuICAgICAgICBjb25zdCBzMiQgPSB0aGlzLmRnLmRmcy5zZWxlY3RSb3ckLnBpcGUoXHJcbiAgICAgICAgICAgIGZpbHRlcigocjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5pZCA9PT0gdGhpcy5yb3dJZDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93ICYmICF0aGlzLmRnLnNlbGVjdGVkUm93LmRyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5nZXRSb3dQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHAgPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHJsID0gdGhpcztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocCA9PT0gJ3JpZ2h0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHJyID0gdGhpcztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5kciA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goczIkKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2x1bW5zQ2hhbmdlZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbnNDaGFuZ2VkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29sdW1uc0NoYW5nZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YXNvdXJjZUNoYW5nZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhc291cmNlQ2hhbmdlZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFzb3VyY2VDaGFuZ2VkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnMgJiYgdGhpcy5zdWJzY3JpcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChuID0+IG4udW5zdWJzY3JpYmUoKSk7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZm9ybSkge1xyXG4gICAgICAgICAgICB0aGlzLmZvcm0gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMucm93RGF0YSAmJiAhY2hhbmdlcy5yb3dEYXRhLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNlbGxFbXB0eVN0eWxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLnJlbmRlckN1c3RvbVN0eWxlKCk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVDZWxsRW1wdHlTdHlsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Um93UG9zaXRpb24oKSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuaWQ7XHJcbiAgICAgICAgaWYgKGlkLmluZGV4T2YoJ2ZpeGVkbGVmdCcpID4gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdsZWZ0JztcclxuICAgICAgICB9IGVsc2UgaWYgKGlkLmluZGV4T2YoJ2ZpeGVkcmlnaHQnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAncmlnaHQnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnY2VudGVyJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJlbmRlckN1c3RvbVN0eWxlKHJvd0RhdGEgPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcucm93U3R5bGVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9yZCA9IHJvd0RhdGEgfHwgdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICBjb25zdCB0clN0eWxlID0gdGhpcy5kZy5yb3dTdHlsZXIoX3JkLCB0aGlzLnJvd0luZGV4KTtcclxuICAgICAgICAgICAgaWYgKHRyU3R5bGUgJiYgT2JqZWN0LmtleXModHJTdHlsZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnJlbmRlckN1c3RvbVN0eWxlKHRyU3R5bGUsIHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmRncy5yZW1vdmVDc3NSdWxlKGAjJHt0aGlzLmRnLmlkfSAjJHt0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuaWR9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignY2xpY2snLCBbJyRldmVudCddKVxyXG4gICAgb25Sb3dDbGljayhldmVudDogTW91c2VFdmVudCkge1xyXG5cclxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0WydjbGFzc05hbWUnXSAmJiBldmVudC50YXJnZXRbJ2NsYXNzTmFtZSddLmluZGV4T2YoJ2NoZWNrYm94LWNvbHVtbicpID4gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLmVuYWJsZVNlbGVjdFJvdykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlUm93KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3codGhpcy5yb3dEYXRhLCB0aGlzLnJvd0luZGV4KSkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlmICghdGhpcy5kZy5lZGl0YWJsZSkge1xyXG4gICAgICAgIC8vICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJvd0lkID0gdGhpcy5kZnMucHJpbWFyeUlkKHRoaXMucm93RGF0YSk7XHJcblxyXG4gICAgICAgIGlmICghcm93SWQpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKGDlnKjnrKwgJHt0aGlzLnJvd0luZGV4ICsgMX0g6KGM77yM5Li76ZSu5a2X5q61WyR7dGhpcy5kZy5pZEZpZWxkfV3nmoTlgLzkuLog56m677yM6K+35qOA5p+l55u45YWz5pWw5o2u44CCYCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBiZWZvckV2ZW50UGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHJvd0luZGV4OiB0aGlzLnJvd0luZGV4LFxyXG4gICAgICAgICAgICByb3dEYXRhOiB0aGlzLnJvd0RhdGEsXHJcbiAgICAgICAgICAgIGdyaWRJbnN0YW5jZTogdGhpcy5kZ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICghZXZlbnQuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5kZ3MuZm9jdXNSb3dDaGFuZ2VkLmVtaXQoe1xyXG4gICAgICAgICAgICAgICAgcm93SW5kZXg6IHRoaXMucm93SW5kZXgsXHJcbiAgICAgICAgICAgICAgICByb3dEYXRhOiB0aGlzLnJvd0RhdGFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHVzZU5ld1NlbGVjdGlvbk1vZGUgPSB0aGlzLmRnLnNtcy5iZWZvclJvd0NsaWNrKHsgLi4uYmVmb3JFdmVudFBhcmFtLCBlOiBldmVudCwgaWQ6IHJvd0lkLCBkcjogdGhpcyB9KTtcclxuICAgICAgICBpZiAodXNlTmV3U2VsZWN0aW9uTW9kZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGZzLmlzUm93U2VsZWN0ZWQocm93SWQpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbmVuZGVkaXQgPSB0aGlzLmRnLmVuZFJvd0VkaXQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghY2FuZW5kZWRpdCB8fCBjYW5lbmRlZGl0LmNhbkVuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5iZWZvcmVTZWxlY3QoYmVmb3JFdmVudFBhcmFtKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIGRlbGF5KDEwMClcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKChjYW5TZWxlY3Q6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FuU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGZzLnNlbGVjdFJvdyh0aGlzLnJvd0luZGV4LCB0aGlzLnJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5kciA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJDTFMgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xhc3NOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJDTFMuaW5kZXhPZignZi1kYXRhZ3JpZC1yb3ctc2VsZWN0ZWQnKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc05hbWUgPSB0ckNMUyArICcgZi1kYXRhZ3JpZC1yb3ctc2VsZWN0ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZHJIb3Zlci5zZXRSb3dIb3ZlckNscyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGcuc2VsZWN0Q2hhbmdlZC5lbWl0KHRoaXMuZGcuc2VsZWN0ZWRSb3cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlci5lbWl0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcucm93Q2xpY2suZW1pdCh7IGRhdGE6IHRoaXMucm93RGF0YSwgZ3JpZDogdGhpcy5kZywgZGJsY2xpY2s6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuZGdzLnNldFNlbGVjZWRSb3cuZW1pdCh7IHNlbGVjdGVkOiB0cnVlLCBpZDogdGhpcy5kZnMucHJpbWFyeUlkKHRoaXMucm93RGF0YSkgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93ICYmICF0aGlzLmRnLnNlbGVjdGVkUm93LmRyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmRyID0gdGhpcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmtlZXBTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuYmVmb3JlVW5zZWxlY3QoYmVmb3JFdmVudFBhcmFtKS5zdWJzY3JpYmUoKGNhblVuc2VsZWN0OiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhblVuc2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGcudW5TZWxlY3QuZW1pdCh0aGlzLmRnLnNlbGVjdGVkUm93KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZnMudW5TZWxlY3RSb3codGhpcy5yb3dJbmRleCwgdGhpcy5yb3dEYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyQ0xTID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyQ0xTLmluZGV4T2YoJ2YtZGF0YWdyaWQtcm93LXNlbGVjdGVkJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZSA9IHRyQ0xTLnJlcGxhY2UoJ2YtZGF0YWdyaWQtcm93LXNlbGVjdGVkJywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcucm93Q2xpY2suZW1pdCh7IGRhdGE6IHRoaXMucm93RGF0YSwgZ3JpZDogdGhpcy5kZywgZGJsY2xpY2s6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuZGdzLnNldFNlbGVjZWRSb3cuZW1pdCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnJvd0NsaWNrLmVtaXQoeyBkYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWQ6IHRoaXMuZGcsIGRibGNsaWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpbml0Rm9ybUNvbnRyb2woKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtID0gdGhpcy5mYi5ncm91cCh7fSk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVDb250cm9sKCk7XHJcbiAgICAgICAgdGhpcy5mb3JtWydiaW5kaW5nRGF0YSddID0gdGhpcy5yb3dEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNvbnRyb2woKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcgJiYgdGhpcy5kZy5mbGF0Q29sdW1ucykge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmZsYXRDb2x1bW5zLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghY29sLmVkaXRvciAmJiAhY29sLmVkaXRvclRlbXBsYXRlKSB7IHJldHVybjsgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZvcm0uY29udHJvbHNbY29sLmZpZWxkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2wgPSB0aGlzLmNyZWF0ZUZvcm1Db250cm9sKGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtLmFkZENvbnRyb2woY29sLmZpZWxkLCBjb250cm9sKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlRm9ybUNvbnRyb2woY29sKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmIuY29udHJvbChcclxuICAgICAgICAgICAgVXRpbHMuZ2V0VmFsdWUoY29sLmZpZWxkLCB0aGlzLnJvd0RhdGEpLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZGF0b3JzOiBjb2wuZWRpdG9yID8gdGhpcy5iaW5kVmFsaWRhdGlvbnMoY29sLmVkaXRvci52YWxpZGF0b3JzKSA6IG51bGxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kVmFsaWRhdGlvbnModmFsaWRhdG9yczogRGF0YWdyaWRWYWxpZGF0b3JbXSkge1xyXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25zID0gW107XHJcbiAgICAgICAgaWYgKHZhbGlkYXRvcnMgJiYgdmFsaWRhdG9ycy5sZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhbGlkYXRvcnMuZm9yRWFjaCgodjogRGF0YWdyaWRWYWxpZGF0b3IpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWxpZGF0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodi50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVxdWlyZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uID0gVmFsaWRhdG9ycy5yZXF1aXJlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWluJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9IFZhbGlkYXRvcnMubWluKHYudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdtYXgnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uID0gVmFsaWRhdG9ycy5tYXgodi52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ21pbkxlbmd0aCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb24gPSBWYWxpZGF0b3JzLm1pbkxlbmd0aCh2LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWF4TGVuZ3RoJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9IFZhbGlkYXRvcnMubWF4TGVuZ3RoKHYudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdlbWFpbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb24gPSBWYWxpZGF0b3JzLmVtYWlsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdyZXF1aXJlZFRydWUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uID0gVmFsaWRhdG9ycy5yZXF1aXJlZFRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3BhdHRlcm4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uID0gVmFsaWRhdG9ycy5wYXR0ZXJuKHYudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbnMucHVzaCh2YWxpZGF0aW9uKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcudmFsaWRhdG9ycyAmJiB0aGlzLmRnLnZhbGlkYXRvcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZmbiA9IHRoaXMuZGcudmFsaWRhdG9ycy5maW5kKHZyID0+IHZyLm5hbWUgPT09IHYudHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2Zm4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb24gPSB2Zm4udmFsdWUodGhpcy5yb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25zLnB1c2godmFsaWRhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmFsaWRhdGlvbnM7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJlZnJlc2goKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVSb3dIZWlnaHQoKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUNlbGxFbXB0eVN0eWxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlUm93SGVpZ2h0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5kZy5ub3dyYXApIHtcclxuICAgICAgICAgICAgY29uc3QgY2VudGVyVHIgPSB0aGlzLmRnYi5tYWluQXJlYS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RyW2luZGV4PVwiJyArIHRoaXMucm93SW5kZXggKyAnXCJdJyk7XHJcbiAgICAgICAgICAgIGNlbnRlclRyLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICAgICAgY29uc3QgdHJIZWlnaHQgPSBjZW50ZXJUci5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICAgIGxldCBsZWZ0VHJEb20gPSBudWxsO1xyXG4gICAgICAgICAgICBsZXQgcmlnaHRUckRvbSA9IG51bGw7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlaWdodFNpemVMaXN0ID0gW3RySGVpZ2h0XTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGdiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZ2IuZml4ZWRMZWZ0RWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0VHJEb20gPSB0aGlzLmRnYi5maXhlZExlZnRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RyW2luZGV4PVwiJyArIHRoaXMucm93SW5kZXggKyAnXCJdJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxlZnRUckRvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0VHJEb20uc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHRTaXplTGlzdC5wdXNoKGxlZnRUckRvbS5vZmZzZXRIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnYi5maXhlZFJpZ2h0RWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByaWdodFRyRG9tID0gdGhpcy5kZ2IuZml4ZWRSaWdodEVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcigndHJbaW5kZXg9XCInICsgdGhpcy5yb3dJbmRleCArICdcIl0nKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmlnaHRUckRvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodFRyRG9tLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0U2l6ZUxpc3QucHVzaChyaWdodFRyRG9tLm9mZnNldEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IG1heEhlaWdodCA9IE1hdGgubWF4KC4uLmhlaWdodFNpemVMaXN0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjZW50ZXJUci5zdHlsZS5oZWlnaHQgPSBgJHttYXhIZWlnaHR9cHhgO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxlZnRUckRvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnRUckRvbS5zdHlsZS5oZWlnaHQgPSBgJHttYXhIZWlnaHR9cHhgO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyaWdodFRyRG9tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRUckRvbS5zdHlsZS5oZWlnaHQgPSBgJHttYXhIZWlnaHR9cHhgO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnYi51cGRhdGVDYW52YXNIZWlnaHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUNlbGxFbXB0eVN0eWxlKCkge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuZW5hYmxlRWRpdENlbGxTdHlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcm93SXNEaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3cpIHtcclxuICAgICAgICAgICAgcm93SXNEaXNhYmxlZCA9IHRoaXMuZGcuZGlzYWJsZVJvdyh0aGlzLnJvd0RhdGEsIHRoaXMucm93SW5kZXgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdXBkYXRlQ2VsbEVtcHR5VGV4dCA9IChjZWxscykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2VsbHMubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBjZWxscy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gY2VsbHNba10uZ2V0QXR0cmlidXRlKCdmaWVsZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmRmcy5nZXRDb2x1bW4oZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb2wuZWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjbHMgPSBjb2wuYWxpZ24gPT09ICdyaWdodCcgPyAnYWxsb3ctZWRpdC1jZWxsLWxlZnQnIDogJ2FsbG93LWVkaXQtY2VsbCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbXB0eWljb25fY2xzID0gQUxMT1dfRURJVF9DRUxMX0hJR0hMSUdIVF9DTFNbY29sLmVkaXRvci50eXBlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwYW4gPSBjZWxsc1trXS5xdWVyeVNlbGVjdG9yKCcuY2VsbC10ZXh0LWJveCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sVmFsID0gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmbXRWYWwgPSB0aGlzLmRnLmNvbEZvcm1hdFNlci5mb3JtYXQoY29sVmFsLCB0aGlzLnJvd0RhdGEsIGNvbC5mb3JtYXR0ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmVkaXRhYmxlIHx8IHJvd0lzRGlzYWJsZWQgfHwgdGhpcy5kZy5jZWxsSXNSZWFkT25seShjb2wsIHRoaXMucm93RGF0YSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsc1trXS5jbGFzc05hbWUgPSBjZWxsc1trXS5jbGFzc05hbWUucmVwbGFjZShjbHMsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsc1trXS5jbGFzc05hbWUgPSBjZWxsc1trXS5jbGFzc05hbWUucmVwbGFjZShlbXB0eWljb25fY2xzLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwYW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwYW4uY2xhc3NOYW1lLmluZGV4T2YoJ2NlbGwtZW1wdHknKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuLmNsYXNzTmFtZSA9IHNwYW4uY2xhc3NOYW1lLnJlcGxhY2UoJ2NlbGwtZW1wdHknLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2xWYWwgPT09ICcnIHx8IGNvbFZhbCA9PT0gbnVsbCB8fCBjb2xWYWwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uaW5uZXJIVE1MID0gZm10VmFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3Bhbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sVmFsID09PSAnJyB8fCBjb2xWYWwgPT09IG51bGwgfHwgY29sVmFsID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcGFuLmNsYXNzTmFtZS5pbmRleE9mKCdjZWxsLWVtcHR5JykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5jbGFzc05hbWUgPSBzcGFuLmNsYXNzTmFtZSArICcgY2VsbC1lbXB0eSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5pbm5lckhUTUwgPSBVdGlscy5nZXRXaGVuRW1wdHlUZXh0KGNvbCwgdGhpcy5kZy5sb2NhbGVTZXJ2aWNlLmxvY2FsZUlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uaW5uZXJIVE1MID0gZm10VmFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbHNba10uY2xhc3NOYW1lLmluZGV4T2YoJ2NlbGwtcmVhZG9ubHknKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxzW2tdLmNsYXNzTmFtZSA9IGNlbGxzW2tdLmNsYXNzTmFtZS5yZXBsYWNlKCdjZWxsLXJlYWRvbmx5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGxzW2tdLmNsYXNzTmFtZS5pbmRleE9mKGNscykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKGNlbGxzW2tdLCBjbHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGxzW2tdLmNsYXNzTmFtZS5pbmRleE9mKGVtcHR5aWNvbl9jbHMpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyhjZWxsc1trXSwgZW1wdHlpY29uX2Nscyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIC8vIGlmICh0aGlzLmRnYi5maXhlZExlZnRFbCkge1xyXG4gICAgICAgIC8vICAgICBjb25zdCBsZWZ0VHJEb20gPSB0aGlzLmRnYi5maXhlZExlZnRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RyW2luZGV4PVwiJyArIHRoaXMucm93SW5kZXggKyAnXCJdJyk7XHJcbiAgICAgICAgLy8gICAgIGlmIChsZWZ0VHJEb20pIHtcclxuICAgICAgICAvLyAgICAgICAgIHVwZGF0ZUNlbGxFbXB0eVRleHQobGVmdFRyRG9tLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkW2ZpZWxkXScpKTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2VsbHMgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgndGRbZmllbGRdOm5vdChbZmllbGQ9XCJfZGF0YWdyaWQtc2V0dGluZy1jb250cm9sX1wiXSknKTtcclxuICAgICAgICB1cGRhdGVDZWxsRW1wdHlUZXh0KGNlbGxzKTtcclxuICAgIH1cclxufVxyXG4iXX0=