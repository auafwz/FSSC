/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:53
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-20 07:39:45
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Injectable, EventEmitter } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { BehaviorSubject, of, Subject } from 'rxjs';
import { map, distinctUntilChanged, filter, switchMap } from 'rxjs/operators';
import { CalculationType } from '../types';
import { initDataGridState, ROW_INDEX_FIELD, IS_GROUP_ROW_FIELD, GROUP_ROW_FIELD, IS_GROUP_FOOTER_ROW_FIELD, GROUP_VISIBLE_FIELD, GROUP_LEVEL_FIELD } from './state';
import { cloneDeep, groupBy, isPlainObject, flatten } from 'lodash-es';
import { Utils } from '../utils/utils';
import { DatagridColumnsHelper } from './datagrid-columns.helper';
import { BigNumber } from 'bignumber.js';
var DatagridFacadeService = /** @class */ (function () {
    function DatagridFacadeService(http) {
        this.http = http;
        this.localId = 'zh-CHS';
        // public virtualizedService: VirtualizedLoaderService;
        this.store = new BehaviorSubject(null);
        this.virtualRowSubject = new BehaviorSubject(null);
        this.gridSizeSubject = new Subject();
        this.errorSubject = new Subject();
        this.selectRowSubject = new Subject();
        this.unSelectRowSubject = new Subject();
        this.columnResizeSubject = new Subject();
        this.clearSelectionSubject = new Subject();
        this.checkRowSubject = new Subject();
        this.unCheckRowSubject = new Subject();
        this.clearCheckedsSubject = new Subject();
        this.clearAllSubject = new Subject();
        this.checkAllSubject = new Subject();
        this.unCheckAllSubject = new Subject();
        this.selectAllSubject = new Subject();
        this.selectCellSubject = new Subject();
        this.error$ = this.errorSubject.asObservable();
        this.selectRow$ = this.selectRowSubject.asObservable();
        this.unSelectRow$ = this.unSelectRowSubject.asObservable();
        this.columnResize$ = this.columnResizeSubject.asObservable();
        this.clearSelections$ = this.clearSelectionSubject.asObservable();
        this.checkRow$ = this.checkRowSubject.asObservable();
        this.unCheckRow$ = this.unCheckRowSubject.asObservable();
        this.clearCheckeds$ = this.clearCheckedsSubject.asObservable();
        this.clearAll$ = this.clearAllSubject.asObservable();
        this.checkAll$ = this.checkAllSubject.asObservable();
        this.unCheckAll$ = this.unCheckAllSubject.asObservable();
        this.selectAll$ = this.selectAllSubject.asObservable();
        this.currentCell$ = this.selectCellSubject.asObservable();
        this.editCell$ = new EventEmitter();
        this.clientSort$ = new EventEmitter();
        this.rowAppend$ = new EventEmitter();
        this.rowUpdate$ = new EventEmitter();
        this.rowDelete$ = new EventEmitter();
        this.state$ = this.store.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })));
        this.columnGroup$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })), map((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state.columnsGroup; })), switchMap((/**
         * @param {?} colgroup
         * @return {?}
         */
        function (colgroup) {
            return of(colgroup);
        })), distinctUntilChanged());
        this.gridSize$ = this.gridSizeSubject.asObservable().pipe(filter((/**
         * @param {?} state
         * @return {?}
         */
        function (state) { return state; })), map((/**
         * @param {?} state
         * @return {?}
         */
        function (state) {
            var _a = tslib_1.__assign({}, state), headerHeight = _a.headerHeight, pagerHeight = _a.pagerHeight, width = _a.width, columnsGroup = _a.columnsGroup, height = _a.height, rowHeight = _a.rowHeight;
            return { headerHeight: headerHeight, pagerHeight: pagerHeight, width: width, columnsGroup: columnsGroup, height: height, rowHeight: rowHeight };
        })), distinctUntilChanged());
        this.data$ = this.virtualRowSubject.pipe(filter((/**
         * @param {?} vs
         * @return {?}
         */
        function (vs) { return vs; })), switchMap((/**
         * @param {?} vs
         * @return {?}
         */
        function (vs) {
            return of({
                index: vs.startIndex || 0,
                rows: vs.virtualRows || [],
                top: vs.topHideHeight,
                bottom: vs.bottomHideHeight,
                scrolling: vs.isScrollChange
            });
        })), distinctUntilChanged());
        this.difference = (/**
         * @param {?} first
         * @param {?} second
         * @return {?}
         */
        function (first, second) { return first.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return !second.includes(item); })); });
        this.differenceBy = (/**
         * @param {?} a
         * @param {?} b
         * @param {?} fn
         * @return {?}
         */
        function (a, b, fn) {
            /** @type {?} */
            var s = new Set(b.map(fn));
            return a.map(fn).filter((/**
             * @param {?} el
             * @return {?}
             */
            function (el) { return !s.has(el); }));
        });
        this._state = cloneDeep(initDataGridState);
    }
    /**
     * @param {?} scrolltop
     * @param {?=} isScrollChange
     * @return {?}
     */
    DatagridFacadeService.prototype.updateVirthualRows = /**
     * @param {?} scrolltop
     * @param {?=} isScrollChange
     * @return {?}
     */
    function (scrolltop, isScrollChange) {
        if (isScrollChange === void 0) { isScrollChange = false; }
        // console.time('计算虚拟加载');
        /** @type {?} */
        var virtual = this.getVirthualRows(scrolltop);
        virtual.isScrollChange = isScrollChange;
        // console.timeEnd('计算虚拟加载');
        this.updateState({ virtual: virtual }, false);
        this.virtualRowSubject.next(virtual);
    };
    /**
     * @param {?} scrolltop
     * @return {?}
     */
    DatagridFacadeService.prototype.getVirthualRows = /**
     * @param {?} scrolltop
     * @return {?}
     */
    function (scrolltop) {
        if (scrolltop === undefined) {
            scrolltop = 0;
        }
        /** @type {?} */
        var data = this._state.data || [];
        /** @type {?} */
        var virtual = { rowIndex: 0, virtualRows: data, topHideHeight: 0, bottomHideHeight: 0 };
        if (data.length === 0 || (this._state.autoHeight && !this._state.groupRows)) {
            virtual.virtualRows = data;
            return virtual;
        }
        if (this._state.flatColumns && this._state.flatColumns.length) {
            // data = this._state.data;
            // if (!this._state.groupRows) {
            //     if (this._state.virtual && this._state.virtualized) {
            //         this.virtualizedService.state = this._state;
            //         const rows = this.virtualizedService.getRows(scrolltop);
            //         virtual = { ...this._state.virtual, ...rows };
            //     } else {
            //         virtual.virtualRows = data;
            //     }
            // } else {
            //     // 行分组数据处理
            //     const groupRows = this.groupRows2(cloneDeep(data));
            //     virtual.virtualRows = groupRows;
            // }
            if (this._state.groupRows) {
                // 行分组数据处理
                /** @type {?} */
                var groupRows = this.groupRows2(cloneDeep(data));
                virtual.virtualRows = groupRows;
            }
        }
        if (this._state.mergeCell && this._state.enableClientSortForMergeCell) {
            virtual.virtualRows = this.sort(virtual.virtualRows);
        }
        return virtual;
    };
    // getDeltaTopHeight(scrolTop, firstIndex) {
    //     const {rowsLength: viewRowsCount, top, bottom} = this.virtualizedService.getRowsCount(scrolTop, this._state.pageSize, firstIndex);
    //     const gridContainerRowsCount = this.virtualizedService.displayRowsCount();
    //     let deltaTopHeight = 0;
    //     if (viewRowsCount < gridContainerRowsCount) {
    //         deltaTopHeight = (gridContainerRowsCount - viewRowsCount) * this._state.rowHeight - this._state.headerHeight;
    //     }
    //     return deltaTopHeight;
    // }
    // getDeltaTopHeight(scrolTop, firstIndex) {
    //     const {rowsLength: viewRowsCount, top, bottom} = this.virtualizedService.getRowsCount(scrolTop, this._state.pageSize, firstIndex);
    //     const gridContainerRowsCount = this.virtualizedService.displayRowsCount();
    //     let deltaTopHeight = 0;
    //     if (viewRowsCount < gridContainerRowsCount) {
    //         deltaTopHeight = (gridContainerRowsCount - viewRowsCount) * this._state.rowHeight - this._state.headerHeight;
    //     }
    //     return deltaTopHeight;
    // }
    /**
     * @param {?=} original
     * @return {?}
     */
    DatagridFacadeService.prototype.getData = 
    // getDeltaTopHeight(scrolTop, firstIndex) {
    //     const {rowsLength: viewRowsCount, top, bottom} = this.virtualizedService.getRowsCount(scrolTop, this._state.pageSize, firstIndex);
    //     const gridContainerRowsCount = this.virtualizedService.displayRowsCount();
    //     let deltaTopHeight = 0;
    //     if (viewRowsCount < gridContainerRowsCount) {
    //         deltaTopHeight = (gridContainerRowsCount - viewRowsCount) * this._state.rowHeight - this._state.headerHeight;
    //     }
    //     return deltaTopHeight;
    // }
    /**
     * @param {?=} original
     * @return {?}
     */
    function (original) {
        if (original === void 0) { original = false; }
        if (original) {
            return this._state.originalData || [];
        }
        return this._state.data || [];
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getState = /**
     * @return {?}
     */
    function () {
        return this._state;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getVirtualState = /**
     * @return {?}
     */
    function () {
        return this._state.virtual;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getPageInfo = /**
     * @return {?}
     */
    function () {
        var _a = tslib_1.__assign({}, this._state), pageIndex = _a.pageIndex, pageSize = _a.pageSize;
        return { pageIndex: pageIndex, pageSize: pageSize };
    };
    /**
     * @param {?} state
     * @return {?}
     */
    DatagridFacadeService.prototype.initState = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.updateState(state, false);
        this._state.originalData = cloneDeep(this._state.data);
        this.initColumns();
        this.gridSizeSubject.next(this._state);
        this.updateVirthualRows(0);
    };
    /** 加载数据
     * @param data: 数据列表
     * @param updateOriginalData 是否更新原始数据, 默认为 true
     */
    /**
     * 加载数据
     * @param {?} data
     * @param {?=} updateOriginalData 是否更新原始数据, 默认为 true
     * @param {?=} sortable
     * @return {?}
     */
    DatagridFacadeService.prototype.loadData = /**
     * 加载数据
     * @param {?} data
     * @param {?=} updateOriginalData 是否更新原始数据, 默认为 true
     * @param {?=} sortable
     * @return {?}
     */
    function (data, updateOriginalData, sortable) {
        if (updateOriginalData === void 0) { updateOriginalData = true; }
        if (sortable === void 0) { sortable = false; }
        data = data || [];
        this.updateState({ data: data }, false);
        if (updateOriginalData) {
            this._state.originalData = cloneDeep(this._state.data);
        }
        if (sortable && this._state.sortName) {
            /** @type {?} */
            var sortedData = this.sort(this._state.data);
            this.updateState({ data: sortedData }, false);
        }
        else {
            // this.updateState({ data: this._state.originalData }, false);
        }
        this.updateVirthualRows(this._state.virtual.scrollTop || 0);
    };
    /** 复原指定行的数据 */
    /**
     * 复原指定行的数据
     * @param {?} rowId
     * @return {?}
     */
    DatagridFacadeService.prototype.resetRow = /**
     * 复原指定行的数据
     * @param {?} rowId
     * @return {?}
     */
    function (rowId) {
        var _this = this;
        /** @type {?} */
        var origData = this._state.originalData;
        if (origData) {
            /** @type {?} */
            var origRowData = origData.find((/**
             * @param {?} r
             * @return {?}
             */
            function (r) { return _this.primaryId(r) === rowId; }));
            this.getCurrentRow().data = cloneDeep(origRowData);
            this.updateRow(rowId, origRowData);
        }
    };
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     // console.log(virtual);
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     // console.log(virtual);
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    /**
     * @param {?} url
     * @return {?}
     */
    DatagridFacadeService.prototype.fetchData = 
    // loadDataForVirtual(data: any) {
    //     this.updateState({ data }, false);
    //     // this.virtualizedService.state = this._state;
    //     const virtual = { ...this._state.virtual, ...this.virtualizedService.reload() };
    //     // console.log(virtual);
    //     this.virtualRowSubject.next(virtual);
    //     this.updateState({virtual});
    // }
    /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        return this.http.get(url).pipe(map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return (/** @type {?} */ (r)); })));
    };
    /**
     * @param {?} total
     * @return {?}
     */
    DatagridFacadeService.prototype.setTotal = /**
     * @param {?} total
     * @return {?}
     */
    function (total) {
        this.updateState({ total: total }, false);
    };
    /**
     * @param {?} property
     * @param {?} value
     * @return {?}
     */
    DatagridFacadeService.prototype.updateProperty = /**
     * @param {?} property
     * @param {?} value
     * @return {?}
     */
    function (property, value) {
        var _a;
        this.updateState((_a = {}, _a[property] = value, _a), false);
    };
    /**
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?} total
     * @return {?}
     */
    DatagridFacadeService.prototype.setPagination = /**
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?} total
     * @return {?}
     */
    function (pageIndex, pageSize, total) {
        this.updateState({ pageIndex: pageIndex, pageSize: pageSize, total: total }, false);
    };
    /**
     * @param {?} scrollTop
     * @return {?}
     */
    DatagridFacadeService.prototype.setScrollTop = /**
     * @param {?} scrollTop
     * @return {?}
     */
    function (scrollTop) {
        /** @type {?} */
        var virtual = tslib_1.__assign({}, this._state.virtual, { scrollTop: scrollTop });
        this.updateState({ virtual: virtual }, false);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.isMultiSelect = /**
     * @return {?}
     */
    function () {
        return this._state.multiSelect;
    };
    /**
     * @private
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype._isRowSelected = /**
     * @private
     * @param {?} id
     * @return {?}
     */
    function (id) {
        if (!id || !this._state.currentRow) {
            return false;
        }
        else {
            return this._state.currentRow.id.toString() === id.toString();
        }
    };
    /**
     * @param {?} id
     * @param {?=} selections
     * @return {?}
     */
    DatagridFacadeService.prototype.isRowSelected = /**
     * @param {?} id
     * @param {?=} selections
     * @return {?}
     */
    function (id, selections) {
        if (selections === void 0) { selections = null; }
        /** @type {?} */
        var flag = this._isRowSelected(id);
        if (!this.isMultiSelect() || this._state.onlySelectSelf) {
            return flag;
        }
        else {
            if (!selections) {
                selections = this._state.selections;
            }
            if (this._canCancelSelectWhenMulti()) {
                return flag;
            }
            if (!selections || selections.length === 0) {
                return false;
            }
            else {
                return selections.findIndex((/**
                 * @param {?} sr
                 * @return {?}
                 */
                function (sr) { return sr.id == id; })) > -1;
            }
        }
    };
    /**
     * @param {?} id
     * @param {?=} checkeds
     * @return {?}
     */
    DatagridFacadeService.prototype.isRowChecked = /**
     * @param {?} id
     * @param {?=} checkeds
     * @return {?}
     */
    function (id, checkeds) {
        if (checkeds === void 0) { checkeds = null; }
        if (!checkeds) {
            checkeds = this.getCheckeds();
        }
        if (!id || !checkeds.length) {
            return false;
        }
        return checkeds.findIndex((/**
         * @param {?} sr
         * @return {?}
         */
        function (sr) { return sr.id.toString() === id.toString(); })) > -1;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.isCheckAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return _this.primaryId(r); }));
        /** @type {?} */
        var checkIds = this._state.checkedRows.map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return r.id; }));
        if (this.difference(allRows, checkIds).length) {
            return false; // this._state.checkedRows.length === allRows.length;
        }
        else {
            return true;
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentPageCheckeds = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allRows = this.getAllRowsForLive().map((/**
         * @param {?} r
         * @return {?}
         */
        function (r) { return _this.primaryId(r); }));
        return this._state.checkedRows.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return allRows.indexOf(n.id) > -1; }));
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentRow = /**
     * @return {?}
     */
    function () {
        return this._state.currentRow || undefined;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getSelections = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 如果数据源变了，需要重新计算
        /** @type {?} */
        var data = this._state.data;
        if (this._state.selections && this._state.selections.length) {
            if (!data || !data.length) {
                this._state.selections = [];
            }
            else {
                /** @type {?} */
                var temp_1 = data.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return _this.primaryId(n); }));
                this._state.selections = this._state.selections.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    return temp_1.includes(n.id);
                }));
            }
        }
        return this._state.selections || [];
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.getCheckedRowsFromSource = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        return (this._state.checkedRows || []).map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var d = _this.findRow(n.id);
            if (d && d.data) {
                n.data = d.data;
            }
            return n;
        }));
    };
    /**
     * @param {?=} fromDataSource
     * @return {?}
     */
    DatagridFacadeService.prototype.getCheckeds = /**
     * @param {?=} fromDataSource
     * @return {?}
     */
    function (fromDataSource) {
        if (fromDataSource === void 0) { fromDataSource = false; }
        if (fromDataSource) {
            this._state.checkedRows = this.getCheckedRowsFromSource();
        }
        return this._state.checkedRows || [];
    };
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.updateCheckedData = /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    function (rowid, rowData) {
        var _this = this;
        /** @type {?} */
        var checkeds = this.getCheckeds();
        if (checkeds.length) {
            /** @type {?} */
            var item_1 = checkeds.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.primaryId(n) == rowid; }));
            if (item_1) {
                Object.keys(rowData).forEach((/**
                 * @param {?} k
                 * @return {?}
                 */
                function (k) {
                    Utils.setValue(k, rowData[k], item_1.data);
                }));
            }
        }
    };
    /**
     * @param {?} ids
     * @param {?=} checked
     * @return {?}
     */
    DatagridFacadeService.prototype.setCheckedRows = /**
     * @param {?} ids
     * @param {?=} checked
     * @return {?}
     */
    function (ids, checked) {
        var _this = this;
        if (checked === void 0) { checked = true; }
        if (ids && ids.length) {
            /** @type {?} */
            var checkeds_1 = this._state.checkedRows || [];
            ids.forEach((/**
             * @param {?} id
             * @return {?}
             */
            function (id) {
                /** @type {?} */
                var row = _this.findRow(id);
                if (checked && row) {
                    if (!_this.isRowChecked(id, checkeds_1)) {
                        /** @type {?} */
                        var srow = { id: _this.primaryId(row.data), data: row.data, index: row.index };
                        checkeds_1.push(srow);
                    }
                }
                else {
                    if (!_this._state.enableMorePageSelect || !checked) {
                        checkeds_1 = checkeds_1.filter((/**
                         * @param {?} sr
                         * @return {?}
                         */
                        function (sr) { return sr.id !== id; }));
                    }
                }
            }));
            this._state.checkedRows = checkeds_1;
        }
        else {
            this._clearCheckeds();
        }
    };
    /**
     * @param {?} id
     * @param {?=} checked
     * @return {?}
     */
    DatagridFacadeService.prototype.checkRecord = /**
     * @param {?} id
     * @param {?=} checked
     * @return {?}
     */
    function (id, checked) {
        if (checked === void 0) { checked = true; }
        if (id) {
            /** @type {?} */
            var row = this.findRow(id);
            if (row) {
                var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
                if (checked) {
                    this.checkRow(rowIndex, rowData);
                }
                else {
                    this.unCheckRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next("\u672A\u627E\u5230ID\u4E3A" + id + "\u7684\u6570\u636E\u3002");
            }
        }
        else {
            this.errorSubject.next("\u53C2\u6570id \u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.checkRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    function (rowIndex, rowData) {
        if (!this._state.multiSelect) {
            this._clearCheckeds();
        }
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var checkeds = this._state.checkedRows || [];
        if (id && !this.isRowChecked(id, checkeds)) {
            /** @type {?} */
            var srow = { id: id, data: rowData, index: rowIndex };
            checkeds.push(srow);
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                this.selectRow(rowIndex, rowData);
            }
            this.checkRowSubject.next(srow);
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.unCheckRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    function (rowIndex, rowData) {
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var checkeds = this._state.checkedRows || [];
        if (this.isRowChecked(id, checkeds)) {
            /** @type {?} */
            var srow = { id: id, data: rowData, index: rowIndex };
            checkeds = checkeds.filter((/**
             * @param {?} sr
             * @return {?}
             */
            function (sr) { return '' + sr.id !== '' + id; }));
            this._state.checkedRows = checkeds;
            if (this._state.selectOnCheck) {
                this.unSelectRow(rowIndex, rowData);
            }
            this.unCheckRowSubject.next(srow);
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.setCurrentPageData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this._state.currentPageData = data;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentPageData = /**
     * @return {?}
     */
    function () {
        return this._state.currentPageData || [];
    };
    /** 获取所有可以操作的行 */
    /**
     * 获取所有可以操作的行
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.getAllRowsForLive = /**
     * 获取所有可以操作的行
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var allData = this._state.data || [];
        if (this._state.pagination && !this._state.pagerOnServer) {
            // 获取当前页数据
            allData = this.getCurrentPageData();
        }
        // 排除掉禁用的行
        if (this._state.disableRow) {
            allData = allData.filter((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) { return !_this._state.disableRow(n, i); }));
        }
        return allData;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.checkAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._state.checkedRows = this._state.checkedRows || [];
        /** @type {?} */
        var allData = this.getAllRowsForLive();
        /** @type {?} */
        var allCheckeds = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        function (r, i) {
            return {
                id: _this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (!this._state.checkedRows.length) {
            this._state.checkedRows = allCheckeds;
        }
        else {
            /** @type {?} */
            var _checkeds_1 = [];
            allCheckeds.forEach((/**
             * @param {?} element
             * @return {?}
             */
            function (element) {
                if (!_this._state.checkedRows.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.id == element.id; }))) {
                    _checkeds_1.push(element);
                }
            }));
            this._state.checkedRows = this._state.checkedRows.concat(_checkeds_1);
        }
        if (this._state.selectOnCheck && !this._state.onlySelectSelf) {
            this._state.selections = [];
            this._state.selections = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            function (r, i) {
                return {
                    id: _this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.checkAllSubject.next(this._state.checkedRows);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.selectAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._state.selections = [];
        /** @type {?} */
        var allData = this.getAllRowsForLive();
        this._state.selections = allData.map((/**
         * @param {?} r
         * @param {?} i
         * @return {?}
         */
        function (r, i) {
            return {
                id: _this.primaryId(r),
                index: i,
                data: r
            };
        }));
        if (this._state.checkOnSelect) {
            this._state.checkedRows = [];
            this._state.checkedRows = allData.map((/**
             * @param {?} r
             * @param {?} i
             * @return {?}
             */
            function (r, i) {
                return {
                    id: _this.primaryId(r),
                    index: i,
                    data: r
                };
            }));
        }
        this.selectAllSubject.next(this._state.selections);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype.findRow = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        if (this._state.data && this._state.data.length) {
            /** @type {?} */
            var index_1 = -1;
            /** @type {?} */
            var data = this._state.data.find((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) {
                /** @type {?} */
                var r = _this.primaryId(n) == id;
                if (r) {
                    index_1 = i;
                }
                return r;
            }));
            if (index_1 === -1) {
                return null;
            }
            return { index: index_1, data: data };
        }
        return null;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DatagridFacadeService.prototype.findRowIndex = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        if (this._state.data && this._state.data.length) {
            return this._state.data.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.primaryId(n) === id; }));
        }
        return -1;
    };
    /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     */
    /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    DatagridFacadeService.prototype.setSelectRow = /**
     * 设置选中行，不触发grid 选中事件，取消选中事件
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    function (id, select) {
        if (select === void 0) { select = true; }
        /** @type {?} */
        var row = this.findRow(id);
        var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (this.isMultiSelect()) {
            if (select) {
                this.selectRowForMulti(srow, false);
            }
            else {
                this.unSelectRowForMulti(srow, false);
            }
        }
        /** @type {?} */
        var _sr = select ? srow : null;
        this.updateState({ currentRow: _sr }, false);
    };
    /**
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRecord = /**
     * @param {?} id
     * @param {?=} select
     * @return {?}
     */
    function (id, select) {
        if (select === void 0) { select = true; }
        if (id) {
            /** @type {?} */
            var row = this.findRow(id);
            if (row) {
                var _a = tslib_1.__assign({}, row), rowIndex = _a.index, rowData = _a.data;
                if (select) {
                    this.selectRow(rowIndex, rowData);
                }
                else {
                    this.unSelectRow(rowIndex, rowData);
                }
            }
            else {
                this.errorSubject.next("\u672A\u627E\u5230ID\u4E3A" + id + "\u7684\u6570\u636E\u3002");
            }
        }
        else {
            this.errorSubject.next("\u53C2\u6570id \u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    function (rowIndex, rowData) {
        /** @type {?} */
        var isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var srow = { id: id, data: rowData, index: rowIndex };
        if (!this.isRowSelected(id) || !this._state.currentRow) {
            if (!isMultiSelect) {
                this.updateState({ currentRow: srow }, false);
                this.selectRowSubject.next(this._state.currentRow);
                if (this._state.showCheckbox && this._state.checkOnSelect) {
                    this._state.checkedRows = [srow];
                    this.checkRowSubject.next(srow);
                }
            }
            else {
                this.selectRowForMulti(srow);
            }
        }
    };
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.selectRowForMulti = /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @return {?}
     */
    function (srow, emit) {
        if (emit === void 0) { emit = true; }
        if (this._state.onlySelectSelf) {
            this._clearSelections();
            this.updateState({ currentRow: srow, selections: [srow] }, false);
        }
        else {
            this._state.selections = this._state.selections || [];
            this._state.selections = this._state.selections.filter((/**
             * @param {?} sr
             * @return {?}
             */
            function (sr) { return sr.id !== srow.id; }));
            this._state.selections.push(srow);
        }
        if (emit) {
            this.selectRowSubject.next(srow);
        }
        if (this._state.checkOnSelect) {
            this.checkRow(srow.index, srow.data);
        }
    };
    /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.unSelectRowForMulti = /**
     * @private
     * @param {?} srow
     * @param {?=} emit
     * @return {?}
     */
    function (srow, emit) {
        if (emit === void 0) { emit = true; }
        this._state.selections = this._state.selections.filter((/**
         * @param {?} sr
         * @return {?}
         */
        function (sr) { return sr.id !== srow.id; }));
        if (this._canCancelSelectWhenMulti() || (this._state.currentRow && this._state.currentRow.id === srow.id)) {
            this.updateState({ currentRow: null });
        }
        if (this._state.checkOnSelect) {
            this.unCheckRow(srow.index, srow.data);
        }
        if (emit) {
            this.unSelectRowSubject.next(srow);
        }
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.unSelectRow = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    function (rowIndex, rowData) {
        /** @type {?} */
        var id = this.primaryId(rowData);
        /** @type {?} */
        var isMultiSelect = this.isMultiSelect();
        /** @type {?} */
        var srow = { id: id, index: rowIndex, data: rowData };
        if (!isMultiSelect) {
            if (this._state.currentRow) {
                this.updateState({ currentRow: null });
                this.unSelectRowSubject.next(srow);
                if (this._state.showCheckbox) {
                    this.unCheckRow(srow.index, srow.data);
                }
            }
        }
        else {
            this.unSelectRowForMulti(srow);
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype._canCancelSelectWhenMulti = /**
     * @private
     * @return {?}
     */
    function () {
        return !this._state.keepSelect && this._state.onlySelectSelf;
    };
    /**
     * @private
     * @param {?=} excludeIds
     * @return {?}
     */
    DatagridFacadeService.prototype._clearSelections = /**
     * @private
     * @param {?=} excludeIds
     * @return {?}
     */
    function (excludeIds) {
        this._state.currentRow = null;
        if (!excludeIds || !excludeIds.length) {
            this._state.selections = [];
        }
        else {
            this._state.selections = this._state.selections.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return i == n.id; })) > -1;
            }));
        }
    };
    /**
     * @private
     * @param {?=} rows
     * @return {?}
     */
    DatagridFacadeService.prototype._clearCheckeds = /**
     * @private
     * @param {?=} rows
     * @return {?}
     */
    function (rows) {
        var _this = this;
        if (rows === void 0) { rows = []; }
        if (!rows.length) {
            this._state.checkedRows = [];
        }
        else {
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return rows.findIndex((/**
             * @param {?} r
             * @return {?}
             */
            function (r) { return _this.primaryId(r) === n.id; })) == -1; }));
        }
    };
    /**
     * @param {?=} excludeIds
     * @return {?}
     */
    DatagridFacadeService.prototype.clearSelections = /**
     * @param {?=} excludeIds
     * @return {?}
     */
    function (excludeIds) {
        /** @type {?} */
        var rows = this._state.selections;
        excludeIds = excludeIds || [];
        this._clearSelections(excludeIds);
        /** @type {?} */
        var unCheckRows = rows.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return excludeIds.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i == n.id; })) == -1; }));
        if (this._state.checkOnSelect || (!this._state.multiSelect && this._state.showCheckbox)) {
            // this._state.checkedRows = [];
            // this.clearCheckedsSubject.next(rows);
            this._state.checkedRows = this._state.checkedRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return !rows.find((/**
                 * @param {?} t1
                 * @return {?}
                 */
                function (t1) { return t1.id == n.id && excludeIds.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                function (i) { return i == n.id; })) == -1; }));
            }));
            this.clearCheckedsSubject.next(unCheckRows);
        }
        this.clearSelectionSubject.next(unCheckRows);
    };
    /**
     * @param {?=} clearAll
     * @return {?}
     */
    DatagridFacadeService.prototype.clearCheckeds = /**
     * @param {?=} clearAll
     * @return {?}
     */
    function (clearAll) {
        if (clearAll === void 0) { clearAll = true; }
        /** @type {?} */
        var rows = this.getAllRowsForLive();
        /** @type {?} */
        var _rows = clearAll ? [] : rows;
        this._clearCheckeds(_rows);
        if (this._state.selectOnCheck) {
            this._clearSelections();
        }
        this.clearCheckedsSubject.next(rows);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.clearAll = /**
     * @return {?}
     */
    function () {
        this._clearCheckeds();
        this._clearSelections();
        this.clearAllSubject.next();
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setMultiSelect = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.multiSelect = flag;
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setCheckOnSelect = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.checkOnSelect = flag;
    };
    /**
     * @param {?} flag
     * @return {?}
     */
    DatagridFacadeService.prototype.setSelectOnCheck = /**
     * @param {?} flag
     * @return {?}
     */
    function (flag) {
        this._state.selectOnCheck = flag;
    };
    /**
     * @param {?} dr
     * @param {?} field
     * @param {?=} cellElement
     * @param {?=} cellRef
     * @return {?}
     */
    DatagridFacadeService.prototype.setCurrentCell = /**
     * @param {?} dr
     * @param {?} field
     * @param {?=} cellElement
     * @param {?=} cellRef
     * @return {?}
     */
    function (dr, field, cellElement, cellRef) {
        var _a = tslib_1.__assign({}, dr), rowIndex = _a.rowIndex, rowData = _a.rowData;
        /** @type {?} */
        var currentCell = tslib_1.__assign({}, this._state.currentCell, { rowIndex: rowIndex, rowData: rowData, field: field, rowId: this.primaryId(rowData), cellElement: cellElement });
        if (field !== this._state.ControlPanelFeild) {
            if (cellRef) {
                currentCell.cellRef = cellRef;
            }
            if (field) {
                currentCell.column = this.getColumn(field);
            }
            /** @type {?} */
            var isLastRow = rowIndex === this.getData().length - 1;
            currentCell['lastRow'] = isLastRow;
        }
        else {
            currentCell = null;
        }
        this.updateState({ currentCell: currentCell }, false);
        this.selectRow(rowIndex, rowData);
        if (this._state.currentRow) {
            this._state.currentRow.dr = dr;
        }
        this.selectCellSubject.next(currentCell);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.cancelSelectCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell) {
            this.updateState({ currentCell: null }, false);
            this.selectCellSubject.next(null);
        }
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.primaryId = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        return rowData[this._state.idField];
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getCurrentCell = /**
     * @return {?}
     */
    function () {
        return this._state.currentCell;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.editCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell) {
            if (!this._state.currentCell.isEditing) {
                /** @type {?} */
                var cei = tslib_1.__assign({}, this._state.currentCell, { isEditing: true });
                this.updateState({ currentCell: cei }, false);
                this.selectCellSubject.next(cei);
                // this.editCell$.next(cei);
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.endEditCell = /**
     * @return {?}
     */
    function () {
        if (this._state.currentCell && this._state.currentCell.isEditing) {
            /** @type {?} */
            var cei = tslib_1.__assign({}, this._state.currentCell, { isEditing: false });
            this.updateState({ currentCell: cei }, false);
            this.selectCellSubject.next(cei);
            // this.editCell$.next(cei);
        }
    };
    /**
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.appendRow = /**
     * @param {?} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData && this.primaryId(rowData)) {
            /** @type {?} */
            var pid = this.primaryId(rowData);
            if (this.findRowIndex(pid) === -1) {
                this._state.data.push(rowData);
                /** @type {?} */
                var newData = tslib_1.__spread(this._state.data);
                this.updateState({ data: newData }, false);
                this._state.originalData = cloneDeep(this._state.data);
                this.refresh();
                this.rowAppend$.emit(rowData);
            }
            else {
                throw new Error("\u4E3B\u952EID \u5DF2\u5B58\u5728\uFF01ID: " + pid);
            }
        }
        else {
            throw new Error("\u4E3B\u952E\u6807\u8BC6\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A\u3002");
        }
    };
    /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    DatagridFacadeService.prototype.updateRow = /**
     * @param {?} rowid
     * @param {?} rowData
     * @return {?}
     */
    function (rowid, rowData) {
        /** @type {?} */
        var row = this.findRow(rowid);
        if (row && row.data) {
            if (rowData) {
                /** @type {?} */
                var keys = Object.keys(rowData);
                keys.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                function (field) {
                    Utils.setValue(field, rowData[field], row.data);
                }));
                // 更新已勾选的数据
                this.updateCheckedData(rowid, rowData);
                this.rowUpdate$.emit(row);
            }
        }
        else {
            console.log('Can not found rowid: ' + rowid);
        }
        // Object.assign(this.findRow(id), row);
    };
    /**
     * @param {?} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.deleteRow = /**
     * @param {?} rowid
     * @return {?}
     */
    function (rowid) {
        /** @type {?} */
        var row = this.findRow(rowid);
        if (row) {
            /** @type {?} */
            var newData = this.removeRow(this._state.data, rowid);
            this.updateState({ data: newData }, false);
            this._state.originalData = cloneDeep(this._state.data);
            this.refresh();
            this.rowDelete$.emit(rowid);
            return row;
        }
        else {
            console.log('Can not found row by ID:' + rowid);
        }
    };
    /**
     * 从数组中删除指定的ID
     * @param data 数组
     * @param rowId 要删除的ID
     */
    /**
     * 从数组中删除指定的ID
     * @param {?} data 数组
     * @param {?} rowId 要删除的ID
     * @return {?}
     */
    DatagridFacadeService.prototype.removeRow = /**
     * 从数组中删除指定的ID
     * @param {?} data 数组
     * @param {?} rowId 要删除的ID
     * @return {?}
     */
    function (data, rowId) {
        var _this = this;
        /** @type {?} */
        var newData = data.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var id = _this.primaryId(n);
            return rowId !== id;
        }));
        return newData;
    };
    /**
     * @param {?} cellInfo
     * @return {?}
     */
    DatagridFacadeService.prototype.isCellSelected = /**
     * @param {?} cellInfo
     * @return {?}
     */
    function (cellInfo) {
        /** @type {?} */
        var cc = this.getCurrentCell();
        if (!cc) {
            return false;
        }
        else {
            if (this._state.currentRow.index === cc.rowIndex) {
                return cc.field === cellInfo.field;
            }
            return false;
        }
    };
    /**
     * @protected
     * @param {?} state
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.updateState = /**
     * @protected
     * @param {?} state
     * @param {?=} emit
     * @return {?}
     */
    function (state, emit) {
        if (emit === void 0) { emit = true; }
        /** @type {?} */
        var newState = tslib_1.__assign({}, this._state, state);
        this._state = newState;
        if (emit) {
            this.store.next(this._state);
        }
    };
    /**
     * @param {?=} newSize
     * @return {?}
     */
    DatagridFacadeService.prototype.resize = /**
     * @param {?=} newSize
     * @return {?}
     */
    function (newSize) {
        if (newSize) {
            this.updateState(newSize, false);
        }
        this.resetColumnsSize();
        if (!this._state.groupRows) {
            this.updateVirthualRows(this._state.virtual.scrollTop);
        }
    };
    /**
     * @param {?} fit
     * @return {?}
     */
    DatagridFacadeService.prototype.fitColumns = /**
     * @param {?} fit
     * @return {?}
     */
    function (fit) {
        this.updateState({ fitColumns: fit }, false);
        // const r = this.useUserSetColumnSize();
        // this.setFitColumnsWidth(this._state.columnsGroup, true, r);
        // this.gridSizeSubject.next(this._state);
        this.resetColumnsSize();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.useUserSetColumnSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._state.autoFitColumns) {
            /** @type {?} */
            var gridWidth = this._state.width;
            /** @type {?} */
            var userSetColumnWidth = this._state.columnsGroup.originalTotalWidth;
            return userSetColumnWidth > gridWidth;
        }
        return false;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFacadeService.prototype.resetColumnsSize = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._state.fitColumns) {
            // 20200421
            /** @type {?} */
            var r = this.useUserSetColumnSize();
            this.setFitColumnsWidth(this._state.columnsGroup, r, r);
        }
        this.gridSizeSubject.next(this._state);
    };
    /**
     * 更新列设置
     * @param columns 新的列集合
     * @param restitute 是否还原初始宽度 默认为 false
     */
    /**
     * 更新列设置
     * @param {?} columns 新的列集合
     * @param {?=} restitute 是否还原初始宽度 默认为 false
     * @param {?=} emit
     * @return {?}
     */
    DatagridFacadeService.prototype.updateColumns = /**
     * 更新列设置
     * @param {?} columns 新的列集合
     * @param {?=} restitute 是否还原初始宽度 默认为 false
     * @param {?=} emit
     * @return {?}
     */
    function (columns, restitute, emit) {
        if (restitute === void 0) { restitute = false; }
        if (emit === void 0) { emit = false; }
        this._state.columns = columns;
        this.initColumns(emit, restitute);
        this.resizeColumns(restitute);
    };
    /**
     * @param {?=} emit
     * @param {?=} restColumnWidth
     * @return {?}
     */
    DatagridFacadeService.prototype.initColumns = /**
     * @param {?=} emit
     * @param {?=} restColumnWidth
     * @return {?}
     */
    function (emit, restColumnWidth) {
        if (emit === void 0) { emit = false; }
        if (restColumnWidth === void 0) { restColumnWidth = false; }
        /** @type {?} */
        var columns = this._state.flatColumns;
        /** @type {?} */
        var colgroup = {
            leftFixed: [],
            rightFixed: [],
            normalColumns: []
        };
        if (columns && columns.length) {
            /** @type {?} */
            var leftFixedCols = this.getFixedCols('left');
            /** @type {?} */
            var rightFixedCols = this.getFixedCols('right');
            /** @type {?} */
            var normalCols = this.getFixedCols();
            columns.forEach((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                if (!c.originalWidth) {
                    c.originalWidth = c.width;
                }
            }));
            colgroup = {
                leftFixed: leftFixedCols,
                rightFixed: rightFixedCols,
                normalColumns: normalCols
            };
            this.initColumnsWidth(colgroup, restColumnWidth);
            if (this._state.fitColumns) {
                this.setFitColumnsWidth(colgroup, true);
            }
            this.updateState({ columnsGroup: colgroup }, emit);
        }
        else {
            colgroup.leftFixedWidth = 0;
            colgroup.rightFixedWidth = 0;
            colgroup.normalWidth = 0;
            colgroup.totalWidth = 0;
            this.updateState({ columnsGroup: colgroup }, emit);
        }
    };
    /**
     * @param {?} field
     * @param {?=} fixed
     * @return {?}
     */
    DatagridFacadeService.prototype.getColumnIndex = /**
     * @param {?} field
     * @param {?=} fixed
     * @return {?}
     */
    function (field, fixed) {
        if (fixed === void 0) { fixed = ''; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        if (!fixed) {
            return colgroup.normalColumns.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.field === field; }));
        }
        else {
            if (fixed === 'left') {
                return colgroup.leftFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === field; }));
            }
            else if (fixed === 'right') {
                return colgroup.rightFixed.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.field === field; }));
            }
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.columnResizeEnd = /**
     * @return {?}
     */
    function () {
        // const colgroup = this._state.columnsGroup;
        // this.initColumnsWidth(colgroup, false);
        // this.updateState({ columnsGroup:  {...colgroup} }, false);
        // this.gridSizeSubject.next(this._state);
        this.resizeColumns();
    };
    /**
     * @param {?=} restitute
     * @return {?}
     */
    DatagridFacadeService.prototype.resizeColumns = /**
     * @param {?=} restitute
     * @return {?}
     */
    function (restitute) {
        if (restitute === void 0) { restitute = false; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.initColumnsWidth(colgroup, restitute);
        if (this._state.fitColumns) {
            /** @type {?} */
            var r = this.useUserSetColumnSize();
            if (r) {
                this.setFitColumnsWidth(colgroup, restitute, r);
            }
            else {
                this.setFitColumnsWidth(colgroup, restitute);
            }
        }
        this.updateState({ columnsGroup: tslib_1.__assign({}, colgroup) }, false);
        this.gridSizeSubject.next(this._state);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getAllFlatColumns = /**
     * @return {?}
     */
    function () {
        return flatten(this._state.columns);
    };
    /**
     * @param {?} fieldName
     * @return {?}
     */
    DatagridFacadeService.prototype.getColumn = /**
     * @param {?} fieldName
     * @return {?}
     */
    function (fieldName) {
        return this.getAllFlatColumns().find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n.field === fieldName; }));
    };
    /**
     * @param {?} colgroup
     * @param {?=} restitute
     * @param {?=} useUserSetColumnSize
     * @return {?}
     */
    DatagridFacadeService.prototype.setFitColumnsWidth = /**
     * @param {?} colgroup
     * @param {?=} restitute
     * @param {?=} useUserSetColumnSize
     * @return {?}
     */
    function (colgroup, restitute, useUserSetColumnSize) {
        if (restitute === void 0) { restitute = false; }
        if (useUserSetColumnSize === void 0) { useUserSetColumnSize = false; }
        if (!colgroup) {
            return;
        }
        colgroup.normalWidth = this._state.width - colgroup.leftFixedWidth - colgroup.rightFixedWidth;
        if (!colgroup.normalWidth || colgroup.normalWidth < 0) {
            return;
        }
        if (useUserSetColumnSize) {
            colgroup.totalWidth = colgroup.originalTotalWidth;
            if (restitute) {
                colgroup.normalColumns.forEach((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) {
                    col.width = col.originalWidth;
                }));
            }
            // 更新 normalColumns width
            colgroup.normalWidth = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            function (totalWidth, col) {
                if (!restitute && col.width) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
        else {
            /** @type {?} */
            var minWidth_1 = colgroup.normalColumns.reduce((/**
             * @param {?} totalWidth
             * @param {?} col
             * @return {?}
             */
            function (totalWidth, col) {
                if (!restitute) {
                    return totalWidth += col.width;
                }
                else {
                    return totalWidth += col.originalWidth;
                }
            }), 0);
            colgroup.normalWidth = colgroup.normalWidth - 2;
            colgroup.normalColumns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                if (!restitute) {
                    // col.width = Math.floor( col.width / minWidth * colgroup.normalWidth );
                    col.width = Number((col.width / minWidth_1 * colgroup.normalWidth).toFixed(2));
                }
                else {
                    // col.width = Math.floor( col.originalWidth / minWidth * colgroup.normalWidth );
                    col.width = Number((col.originalWidth / minWidth_1 * colgroup.normalWidth).toFixed(2));
                }
            }));
            colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
        }
    };
    /**
     * @private
     * @param {?=} direction
     * @return {?}
     */
    DatagridFacadeService.prototype.getFixedCols = /**
     * @private
     * @param {?=} direction
     * @return {?}
     */
    function (direction) {
        if (direction === void 0) { direction = ''; }
        /** @type {?} */
        var cols = [];
        if (!direction) {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return !col.fixed; }));
        }
        else {
            cols = this._state.flatColumns.filter((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return col.fixed === direction; }));
        }
        // 多表头，重新计算列的顺序
        if (this._state.columns.length > 1 && cols.length) {
            /** @type {?} */
            var fields = DatagridColumnsHelper.getFields(this._state.columns);
            /** @type {?} */
            var newcols_1 = [];
            fields.forEach((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                /** @type {?} */
                var c = cols.find((/**
                 * @param {?} col
                 * @return {?}
                 */
                function (col) { return (col.field || '') === f; }));
                if (c) {
                    newcols_1.push(c);
                }
            }));
            return newcols_1;
        }
        return cols;
    };
    // restitute: 还原初始宽度，默认 false
    // restitute: 还原初始宽度，默认 false
    /**
     * @private
     * @param {?} colgroup
     * @param {?=} restitute
     * @return {?}
     */
    DatagridFacadeService.prototype.initColumnsWidth = 
    // restitute: 还原初始宽度，默认 false
    /**
     * @private
     * @param {?} colgroup
     * @param {?=} restitute
     * @return {?}
     */
    function (colgroup, restitute) {
        if (restitute === void 0) { restitute = false; }
        /** @type {?} */
        var offset = 0;
        offset = this._state.showLineNumber ? offset + this._state.lineNumberWidth : offset;
        offset = this._state.showCheckbox ? offset + this._state.checkboxColumnWidth : offset;
        /** @type {?} */
        var getColsWidth = (/**
         * @param {?} cols
         * @param {?} val
         * @param {?} reset
         * @return {?}
         */
        function (cols, val, reset) {
            return cols.reduce((/**
             * @param {?} r
             * @param {?} c
             * @return {?}
             */
            function (r, c) {
                c.left = r;
                if (!reset) {
                    return r + c.width;
                }
                else {
                    return r + c.originalWidth;
                }
            }), val);
        });
        colgroup.leftFixedWidth = offset;
        if (colgroup.leftFixed && colgroup.leftFixed.length) {
            colgroup.leftFixedWidth = getColsWidth(colgroup.leftFixed, offset, restitute);
        }
        colgroup.rightFixedWidth = 0;
        if (colgroup.rightFixed && colgroup.rightFixed.length) {
            colgroup.rightFixedWidth = getColsWidth(colgroup.rightFixed, 0, restitute);
        }
        colgroup.normalWidth = 0;
        if (this._state.columns && this._state.columns.length) {
            colgroup.normalWidth = getColsWidth(colgroup.normalColumns, 0, restitute);
            colgroup.originalTotalWidth = getColsWidth(colgroup.normalColumns, 0, true);
        }
        colgroup.totalWidth = colgroup.leftFixedWidth + colgroup.rightFixedWidth + colgroup.normalWidth;
    };
    /**
     * @param {?=} isShow
     * @return {?}
     */
    DatagridFacadeService.prototype.showCheckbox = /**
     * @param {?=} isShow
     * @return {?}
     */
    function (isShow) {
        if (isShow === void 0) { isShow = true; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.updateState({ showCheckbox: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.checkboxColumnWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.checkboxColumnWidth;
        }
        this.columnResizeSubject.next(colgroup);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.hideCheckbox = /**
     * @return {?}
     */
    function () {
        this.showCheckbox(false);
    };
    /**
     * @param {?=} isShow
     * @return {?}
     */
    DatagridFacadeService.prototype.showLineNumber = /**
     * @param {?=} isShow
     * @return {?}
     */
    function (isShow) {
        if (isShow === void 0) { isShow = true; }
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        this.updateState({ showLineNumber: isShow }, false);
        if (isShow) {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth + this._state.lineNumberWidth;
        }
        else {
            colgroup.leftFixedWidth = colgroup.leftFixedWidth - this._state.lineNumberWidth;
        }
        this.columnResizeSubject.next(colgroup);
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.hideLineNumber = /**
     * @return {?}
     */
    function () {
        this.showLineNumber(false);
    };
    /**
     * @param {?} sortName
     * @param {?} sortOrder
     * @return {?}
     */
    DatagridFacadeService.prototype.setSortInfo = /**
     * @param {?} sortName
     * @param {?} sortOrder
     * @return {?}
     */
    function (sortName, sortOrder) {
        sortName = sortName || '';
        sortOrder = sortOrder || '';
        /** @type {?} */
        var fields = sortName.split(',');
        /** @type {?} */
        var orders = sortOrder.split(',');
        // if (!this._state.multiSort) {
        /** @type {?} */
        var colgroup = this._state.columnsGroup;
        /** @type {?} */
        var updateFieldOrder = (/**
         * @param {?} cols
         * @return {?}
         */
        function (cols) {
            if (!cols || !cols.length) {
                return;
            }
            cols.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                col.order = undefined;
                /** @type {?} */
                var i = fields.findIndex((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) { return f === col.field; }));
                if (i > -1) {
                    col.order = orders[i];
                }
            }));
        });
        updateFieldOrder(colgroup.normalColumns);
        updateFieldOrder(colgroup.leftFixed);
        updateFieldOrder(colgroup.rightFixed);
        // }
        this.updateState({ sortName: sortName, sortOrder: sortOrder }, false);
    };
    /**
     * @param {?} arr
     * @param {?} props
     * @param {?} orders
     * @return {?}
     */
    DatagridFacadeService.prototype.orderBy = /**
     * @param {?} arr
     * @param {?} props
     * @param {?} orders
     * @return {?}
     */
    function (arr, props, orders) {
        var _this = this;
        /** @type {?} */
        var colObj = props.reduce((/**
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        function (c, n) {
            c[n] = _this.getColumn(n);
            return c;
        }), {});
        return tslib_1.__spread(arr).sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            return props.reduce((/**
             * @param {?} acc
             * @param {?} prop
             * @param {?} i
             * @return {?}
             */
            function (acc, prop, i) {
                if (acc === 0) {
                    /** @type {?} */
                    var valA = Utils.getValue(prop, a);
                    /** @type {?} */
                    var valB = Utils.getValue(prop, b);
                    if (colObj[prop] && colObj[prop]['isMultilingualField']) {
                        valA = Utils.getMultilingualValue(valA, _this.localId);
                        valB = Utils.getMultilingualValue(valB, _this.localId);
                    }
                    if (valA === undefined || valA === null) {
                        valA = '';
                    }
                    if (valB === undefined || valB === null) {
                        valB = '';
                    }
                    var _a = tslib_1.__read(orders && orders[i] === 'desc' ? [valB, valA] : [valA, valB], 2), p1 = _a[0], p2 = _a[1];
                    if (typeof p1 === 'string') {
                        acc = p1.localeCompare(p2);
                    }
                    else {
                        acc = p1 > p2 ? 1 : p1 < p2 ? -1 : 0;
                    }
                }
                return acc;
            }), 0);
        }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.sort = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var orders = this._state.sortOrder.split(',');
        /** @type {?} */
        var fields = this._state.sortName.split(',');
        if (this._state.mergeCell && this._state.mergeFields && this._state.mergeFields.length) {
            /** @type {?} */
            var newOrders_1 = [];
            /** @type {?} */
            var newFields_1 = tslib_1.__spread(this._state.mergeFields);
            fields.forEach((/**
             * @param {?} f
             * @param {?} i
             * @return {?}
             */
            function (f, i) {
                /** @type {?} */
                var k = newFields_1.indexOf(f);
                if (k == -1) {
                    newFields_1.push(f);
                    k = newFields_1.length - 1;
                }
                newOrders_1[k] = orders[i];
            }));
            return this.orderBy(data, newFields_1, newOrders_1);
        }
        return this.orderBy(data, fields, orders);
    };
    /**
     * @param {?=} data
     * @return {?}
     */
    DatagridFacadeService.prototype.clientSort = /**
     * @param {?=} data
     * @return {?}
     */
    function (data) {
        if (this._state.sortName) {
            if (data) {
                this.updateState({ data: data }, false);
            }
            /** @type {?} */
            var sortedData = this.sort(this._state.data);
            this.loadData(sortedData, false);
        }
        else {
            this.clearSort();
        }
        this.clientSort$.emit({ sortName: this._state.sortName, sortOrder: this._state.sortOrder });
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.clearSort = /**
     * @return {?}
     */
    function () {
        this.loadData(this._state.originalData, false);
    };
    /**
     * @param {?} filterData
     * @return {?}
     */
    DatagridFacadeService.prototype.loadFilterData = /**
     * @param {?} filterData
     * @return {?}
     */
    function (filterData) {
        this.loadData(filterData, false);
    };
    //#region 变更集
    //#region 变更集
    /**
     * @private
     * @param {?} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.hasRowChanges = 
    //#region 变更集
    /**
     * @private
     * @param {?} rowid
     * @return {?}
     */
    function (rowid) {
        /** @type {?} */
        var _changes = this._state.changes;
        if (!_changes) {
            return false;
        }
        return _changes[rowid];
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridFacadeService.prototype.appendChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (!changes) {
            return;
        }
        /** @type {?} */
        var id = changes[this._state.idField];
        if (!id) {
            return;
        }
        /** @type {?} */
        var _id = '' + id;
        if (!this.hasRowChanges(_id)) {
            this._state.changes = this._state.changes || {};
            this._state.changes[_id] = changes;
        }
        else {
            this._state.changes[_id] = Object.assign(this._state.changes[_id], changes);
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.acceptChanges = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var changes = this._state.changes;
        if (changes) {
            /** @type {?} */
            var keys = Object.keys(changes);
            keys.forEach((/**
             * @param {?} id
             * @return {?}
             */
            function (id) {
                _this.updateRow(id, changes[id]);
            }));
            this._state.originalData = cloneDeep(this._state.data);
        }
    };
    /**
     * @param {?=} rowid
     * @return {?}
     */
    DatagridFacadeService.prototype.rejectChanges = /**
     * @param {?=} rowid
     * @return {?}
     */
    function (rowid) {
        var _this = this;
        if (rowid === void 0) { rowid = null; }
        /** @type {?} */
        var changes = this._state.changes;
        if (changes) {
            if (!rowid) {
                this._state.data = cloneDeep(this._state.originalData);
                this._state.changes = null;
            }
            else {
                /** @type {?} */
                var rowChanges = this._state.changes['' + rowid];
                if (rowChanges) {
                    /** @type {?} */
                    var orgiRow_1 = this._state.originalData.find((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) { return _this.primaryId(r) === rowid; }));
                    this._state.data.forEach((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) {
                        if (_this.primaryId(r) === rowid) {
                            r = cloneDeep(orgiRow_1);
                        }
                    }));
                }
            }
            this.refresh();
        }
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.getChanges = /**
     * @return {?}
     */
    function () {
        return this._state.changes;
    };
    /**
     * @return {?}
     */
    DatagridFacadeService.prototype.refresh = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var data = cloneDeep(this._state.data);
        this.loadData(data);
    };
    //#endregion
    /**
     * 构造合计行
     * @param data 数据集合
     */
    //#endregion
    /**
     * 构造合计行
     * @param {?} data 数据集合
     * @return {?}
     */
    DatagridFacadeService.prototype.getFooterData = 
    //#endregion
    /**
     * 构造合计行
     * @param {?} data 数据集合
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (this._state.showFooter) {
            // const columns = this._state.flatColumns;
            /** @type {?} */
            var columns = flatten(this._state.columns).filter((/**
             * @param {?} col
             * @return {?}
             */
            function (col) { return !col.colspan; }));
            /** @type {?} */
            var footerRow_1 = {};
            columns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                if (col.footer && col.footer.options) {
                    /** @type {?} */
                    var options = col.footer.options;
                    /** @type {?} */
                    var text = options.text;
                    /** @type {?} */
                    var typ = (/** @type {?} */ (options.calculationType));
                    if (typ !== undefined && typ != -1) {
                        /** @type {?} */
                        var val = _this.calculation(data, typ, col);
                        footerRow_1[col.field] = val;
                    }
                    else {
                        footerRow_1[col.field] = text || '';
                    }
                }
                else {
                    footerRow_1[col.field] = '';
                }
            }));
            return [footerRow_1];
        }
        return [];
    };
    /**
     * @private
     * @param {?} items
     * @param {?} fields
     * @return {?}
     */
    DatagridFacadeService.prototype.arrToGroup = /**
     * @private
     * @param {?} items
     * @param {?} fields
     * @return {?}
     */
    function (items, fields) {
        if (fields.length) {
            /** @type {?} */
            var first_1 = fields.shift();
            /** @type {?} */
            var g1 = groupBy(items, (/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return Utils.getValue(first_1, n); }));
            this.toGroup(g1, fields);
            return g1;
        }
    };
    /**
     * @private
     * @param {?} g1
     * @param {?} fieldArr
     * @return {?}
     */
    DatagridFacadeService.prototype.toGroup = /**
     * @private
     * @param {?} g1
     * @param {?} fieldArr
     * @return {?}
     */
    function (g1, fieldArr) {
        var _this = this;
        if (fieldArr.length) {
            Object.keys(g1).forEach((/**
             * @param {?} k
             * @return {?}
             */
            function (k) {
                /** @type {?} */
                var items = g1[k];
                /** @type {?} */
                var _nextFields = fieldArr.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n; }));
                /** @type {?} */
                var _f = _nextFields.shift();
                g1[k] = groupBy(items, (/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return Utils.getValue(_f, n); }));
                if (_nextFields.length) {
                    _this.toGroup(g1[k], _nextFields);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} groupRows
     * @param {?} initLevel
     * @param {?} parent
     * @return {?}
     */
    DatagridFacadeService.prototype.groupRows2Flat = /**
     * @private
     * @param {?} groupRows
     * @param {?} initLevel
     * @param {?} parent
     * @return {?}
     */
    function (groupRows, initLevel, parent) {
        var _this = this;
        /** @type {?} */
        var results = [];
        if (initLevel === undefined) {
            initLevel = 0;
        }
        /** @type {?} */
        var idfield = this._state.idField;
        /** @type {?} */
        var columns = this._state.flatColumns;
        /** @type {?} */
        var data = this._state.data;
        /** @type {?} */
        var groupFieldArr = this._state.groupField.split(',');
        /** @type {?} */
        var pid = parent ? parent[idfield] : null;
        /** @type {?} */
        var colspan = this._state.columnsGroup.normalColumns.length;
        Object.keys(groupRows).forEach((/**
         * @param {?} k
         * @param {?} m
         * @return {?}
         */
        function (k, m) {
            var _a, _b;
            /** @type {?} */
            var groupItem = (_a = {}, _a[idfield] = Utils.uuid(), _a[IS_GROUP_ROW_FIELD] = true, _a[GROUP_LEVEL_FIELD] = initLevel, _a.data = {}, _a.value = k, _a[GROUP_VISIBLE_FIELD] = true, _a.expanded = true, _a.field = groupFieldArr[initLevel], _a.colspan = colspan, _a.total = 0, _a.rows = [], _a[GROUP_ROW_FIELD] = pid, _a);
            // TFS: 356955
            if (parent) {
                groupItem.rows = parent.rows.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return !n[IS_GROUP_ROW_FIELD] &&
                    !n[IS_GROUP_FOOTER_ROW_FIELD] && Utils.getValue(groupFieldArr[initLevel], n) === k; }));
            }
            else {
                groupItem.rows = data.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return '' + Utils.getValue(groupFieldArr[initLevel], n) === k; }));
            }
            if (parent) {
                parent.rows.push(groupItem);
            }
            groupItem.total = groupItem.rows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD]; })).length;
            results.push(groupItem);
            /** @type {?} */
            var items = groupRows[k];
            if (isPlainObject(items)) {
                /** @type {?} */
                var level = initLevel + 1;
                results = results.concat(_this.groupRows2Flat(items, level, groupItem));
            }
            else {
                groupItem.total = items.length;
                items.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    n[GROUP_ROW_FIELD] = groupItem[idfield];
                    n[GROUP_VISIBLE_FIELD] = true;
                    n[GROUP_LEVEL_FIELD] = groupItem[GROUP_LEVEL_FIELD] + 1;
                    return n;
                }));
                groupItem.rows = items;
                results = results.concat(items);
            }
            if (_this._state.groupFooter) {
                /** @type {?} */
                var footerItem = (_b = {},
                    _b[IS_GROUP_FOOTER_ROW_FIELD] = true,
                    _b[GROUP_ROW_FIELD] = groupItem[idfield],
                    _b[GROUP_VISIBLE_FIELD] = true,
                    _b[GROUP_LEVEL_FIELD] = initLevel,
                    _b.data = {},
                    _b);
                groupItem.rows.push(footerItem);
                results.push(footerItem);
            }
        }));
        return results;
    };
    /** 更新分组合计行数据 */
    /**
     * 更新分组合计行数据
     * @private
     * @param {?} groupFooterRow
     * @param {?} columns
     * @param {?} groupRows
     * @return {?}
     */
    DatagridFacadeService.prototype.updateGroupFooterData = /**
     * 更新分组合计行数据
     * @private
     * @param {?} groupFooterRow
     * @param {?} columns
     * @param {?} groupRows
     * @return {?}
     */
    function (groupFooterRow, columns, groupRows) {
        var _this = this;
        columns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        function (col) {
            if (col.groupFooter && col.groupFooter.options) {
                /** @type {?} */
                var options = col.groupFooter.options;
                /** @type {?} */
                var text = options.text;
                /** @type {?} */
                var typ = (/** @type {?} */ (options.calculationType));
                if (typ !== undefined && typ != -1) {
                    /** @type {?} */
                    var val = _this.calculation(groupRows, typ, col);
                    groupFooterRow.data[col.field] = val;
                }
                else {
                    groupFooterRow.data[col.field] = text || '';
                }
            }
            else {
                groupFooterRow.data[col.field] = '';
            }
        }));
    };
    /** 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     */
    /**
     * 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     * @private
     * @param {?} data
     * @return {?}
     */
    DatagridFacadeService.prototype.groupRows2 = /**
     * 多字段分组
     * groupField 以逗号分隔，从左到右依次进行分组
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (data && data.length) {
            /** @type {?} */
            var columns_1 = this._state.flatColumns;
            /** @type {?} */
            var groupField = this._state.groupField || '';
            if (!groupField) {
                return data;
            }
            /** @type {?} */
            var groupData = this.arrToGroup(data, groupField.split(','));
            /** @type {?} */
            var result_1 = this.groupRows2Flat(groupData, 0, null);
            /** @type {?} */
            var k_1 = 0;
            /** @type {?} */
            var prow_1 = (/**
             * @param {?} pid
             * @return {?}
             */
            function (pid) { return result_1.find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this._state.idField] === pid; })); });
            result_1.map((/**
             * @param {?} n
             * @param {?} i
             * @return {?}
             */
            function (n, i) {
                if (!n[IS_GROUP_ROW_FIELD] && !n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    n[ROW_INDEX_FIELD] = k_1;
                    k_1++;
                }
                // 更新合计行数据
                if (n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    /** @type {?} */
                    var rows = prow_1(n[GROUP_ROW_FIELD]).rows.filter((/**
                     * @param {?} r
                     * @return {?}
                     */
                    function (r) { return !r[IS_GROUP_ROW_FIELD] && !r[IS_GROUP_FOOTER_ROW_FIELD]; }));
                    _this.updateGroupFooterData(n, columns_1, rows);
                }
                return n;
            }));
            return result_1;
        }
        return [];
    };
    /**
     * @param {?} groupFooter
     * @return {?}
     */
    DatagridFacadeService.prototype.showGroupFooter = /**
     * @param {?} groupFooter
     * @return {?}
     */
    function (groupFooter) {
        this.updateState({ groupFooter: groupFooter }, false);
        this.updateVirthualRows(0);
    };
    /**
     * @param {?} groupRowId
     * @return {?}
     */
    DatagridFacadeService.prototype.updateGroupFooter = /**
     * @param {?} groupRowId
     * @return {?}
     */
    function (groupRowId) {
        var _this = this;
        /** @type {?} */
        var groupRow = this._state.virtual.virtualRows.find((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return n['id'] === groupRowId;
        }));
        if (groupRow) {
            /** @type {?} */
            var groupRows = groupRow.rows;
            /** @type {?} */
            var groupFooterRows = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n['__group_footer__']; }));
            /** @type {?} */
            var columns_2 = this._state.flatColumns;
            /** @type {?} */
            var rows_1 = groupRows.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !n['__group_footer__']; }));
            groupFooterRows.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                _this.updateGroupFooterData(n, columns_2, rows_1);
            }));
        }
    };
    /**
     * @private
     * @param {?} data
     * @param {?} typ
     * @param {?} col
     * @return {?}
     */
    DatagridFacadeService.prototype.calculation = /**
     * @private
     * @param {?} data
     * @param {?} typ
     * @param {?} col
     * @return {?}
     */
    function (data, typ, col) {
        /** @type {?} */
        var val = '';
        // TFS: 357000
        // http://10.24.1.11:8080/tfs/GSP/GSPCloud/web/_queries?id=357000&triage=true&fullScreen=false&_a=edit
        if (!data || !data.length) {
            return '';
        }
        /** @type {?} */
        var field = col.field;
        /** @type {?} */
        var arr = data.map((/**
         * @param {?} o
         * @return {?}
         */
        function (o) { return Utils.getValue(field, o) || 0; }));
        switch (typ) {
            case CalculationType.sum:
                // val = sumBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).toFixed();
                break;
            case CalculationType.max:
                // const maxObj = maxBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, maxObj);
                val = BigNumber.max.apply(null, arr).toFixed();
                break;
            case CalculationType.min:
                // const minObj = minBy(data, (o) => Utils.getValue(field, o));
                // val = Utils.getValue(field, minObj);
                val = BigNumber.min.apply(null, arr).toFixed();
                break;
            case CalculationType.average:
                // val = meanBy(data, (o) => Utils.getValue(field, o));
                val = BigNumber.sum.apply(null, arr).div(arr.length).toFixed();
                break;
            case CalculationType.count:
                val = data.length;
                break;
        }
        return val;
    };
    //#region 组件初始属性
    //#region 组件初始属性
    /**
     * @param {?} opts
     * @return {?}
     */
    DatagridFacadeService.prototype.setinitialOptions = 
    //#region 组件初始属性
    /**
     * @param {?} opts
     * @return {?}
     */
    function (opts) {
        this._state.initialOptions = {};
        // 分组
        this._state.initialOptions['groupField'] = opts.groupField;
        // 排序
        this._state.initialOptions['sort'] = {
            sortName: opts.sortName,
            sortOrder: opts.sortOrder
        };
        // 列显示隐藏、对齐方式
        if (opts.columns && opts.columns[0]) {
            this._state.initialOptions['columnFields'] = ((/** @type {?} */ (opts.columns[0]))).map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return {
                    width: n.width || 100,
                    field: n.field,
                    halign: n.halign,
                    align: n.align,
                    visible: n.visible,
                    footer: cloneDeep(n.footer || {}),
                    groupFooter: cloneDeep(n.groupFooter || {})
                };
            }));
        }
    };
    DatagridFacadeService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridFacadeService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return DatagridFacadeService;
}());
export { DatagridFacadeService };
if (false) {
    /** @type {?} */
    DatagridFacadeService.prototype.localId;
    /**
     * @type {?}
     * @protected
     */
    DatagridFacadeService.prototype._state;
    /** @type {?} */
    DatagridFacadeService.prototype.store;
    /** @type {?} */
    DatagridFacadeService.prototype.virtualRowSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSizeSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.errorSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unSelectRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.columnResizeSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearSelectionSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckRowSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearCheckedsSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.clearAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.checkAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.unCheckAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectAllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.selectCellSubject;
    /** @type {?} */
    DatagridFacadeService.prototype.error$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unSelectRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnResize$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearSelections$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckRow$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearCheckeds$;
    /** @type {?} */
    DatagridFacadeService.prototype.clearAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.checkAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.unCheckAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.selectAll$;
    /** @type {?} */
    DatagridFacadeService.prototype.currentCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.editCell$;
    /** @type {?} */
    DatagridFacadeService.prototype.clientSort$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowAppend$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowUpdate$;
    /** @type {?} */
    DatagridFacadeService.prototype.rowDelete$;
    /** @type {?} */
    DatagridFacadeService.prototype.state$;
    /** @type {?} */
    DatagridFacadeService.prototype.columnGroup$;
    /** @type {?} */
    DatagridFacadeService.prototype.gridSize$;
    /** @type {?} */
    DatagridFacadeService.prototype.data$;
    /** @type {?} */
    DatagridFacadeService.prototype.difference;
    /** @type {?} */
    DatagridFacadeService.prototype.differenceBy;
    /**
     * @type {?}
     * @private
     */
    DatagridFacadeService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFTQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBYyxFQUFFLEVBQVMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxHQUFHLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBcUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqSCxPQUFPLEVBQTJCLGVBQWUsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNwRSxPQUFPLEVBQXVCLGlCQUFpQixFQUN2QixlQUFlLEVBQUUsa0JBQWtCLEVBQUUsZUFBZSxFQUFFLHlCQUF5QixFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBR2pLLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUErQixhQUFhLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BHLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDO0lBdUZJLCtCQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBcEZwQyxZQUFPLEdBQUcsUUFBUSxDQUFDOztRQUtuQixVQUFLLEdBQUcsSUFBSSxlQUFlLENBQXNCLElBQUksQ0FBQyxDQUFDO1FBRXZELHNC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QztTQUNOO0lBQ0wsQ0FBQzs7Z0JBempESixVQUFVOzs7O2dCQVpGLFVBQVU7O0lBd2tEbkIsNEJBQUM7Q0FBQSxBQTVqREQsSUE0akRDO1NBM2pEWSxxQkFBcUI7OztJQUU5Qix3Q0FBbUI7Ozs7O0lBRW5CLHVDQUFzQzs7SUFHdEMsc0NBQXVEOztJQUV2RCxrREFBbUQ7O0lBQ25ELGdEQUFxQzs7SUFDckMsNkNBQTZCOzs7OztJQUM3QixpREFBOEM7Ozs7O0lBQzlDLG1EQUFnRDs7Ozs7SUFDaEQsb0RBQWlEOzs7OztJQUNqRCxzREFBOEM7Ozs7O0lBQzlDLGdEQUE2Qzs7Ozs7SUFDN0Msa0RBQStDOzs7OztJQUMvQyxxREFBa0Q7Ozs7O0lBQ2xELGdEQUE2Qzs7Ozs7SUFDN0MsZ0RBQXdDOzs7OztJQUN4QyxrREFBMkM7Ozs7O0lBQzNDLGlEQUF5Qzs7Ozs7SUFDekMsa0RBQTBDOztJQUUxQyx1Q0FBMEM7O0lBQzFDLDJDQUFrRDs7SUFDbEQsNkNBQXVEOztJQUN2RCw4Q0FBd0Q7O0lBQ3hELGlEQUE2RDs7SUFDN0QsMENBQWdEOztJQUNoRCw0Q0FBb0Q7O0lBQ3BELCtDQUEwRDs7SUFDMUQsMENBQWdEOztJQUNoRCwwQ0FBZ0Q7O0lBQ2hELDRDQUFvRDs7SUFDcEQsMkNBQWtEOztJQUNsRCw2Q0FBcUQ7O0lBQ3JELDBDQUErQjs7SUFDL0IsNENBQWlDOztJQUNqQywyQ0FBZ0M7O0lBQ2hDLDJDQUFnQzs7SUFDaEMsMkNBQWdDOztJQUVoQyx1Q0FFRTs7SUFFRiw2Q0FPRTs7SUFFRiwwQ0FPRTs7SUFFRixzQ0FZRTs7SUFFRiwyQ0FBMkY7O0lBQzNGLDZDQUdDOzs7OztJQUVXLHFDQUF3QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMDYgMDc6NDM6NTNcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMjAgMDc6Mzk6NDVcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcblxyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBvZiwgbWVyZ2UsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyLCBzd2l0Y2hNYXAsIGF1ZGl0VGltZSwgZGVib3VuY2VUaW1lLCBkZWJvdW5jZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiwgQ29sdW1uR3JvdXAsIENhbGN1bGF0aW9uVHlwZSB9IGZyb20gJy4uL3R5cGVzJztcclxuaW1wb3J0IHsgRmFycmlzRGF0YWdyaWRTdGF0ZSwgaW5pdERhdGFHcmlkU3RhdGUsIERhdGFSZXN1bHQsIENlbGxJbmZvLCBWaXJ0dWFsaXplZFN0YXRlLCBTZWxlY3RlZFJvdyxcclxuICAgICAgICBSb3dEYXRhQ2hhbmdlcywgUk9XX0lOREVYX0ZJRUxELCBJU19HUk9VUF9ST1dfRklFTEQsIEdST1VQX1JPV19GSUVMRCwgSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRCwgR1JPVVBfVklTSUJMRV9GSUVMRCwgR1JPVVBfTEVWRUxfRklFTEQgfSBmcm9tICcuL3N0YXRlJztcclxuaW1wb3J0IHsgVmlydHVhbGl6ZWRMb2FkZXJTZXJ2aWNlIH0gZnJvbSAnLi92aXJ0dWFsaXplZC1sb2FkZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93IH0gZnJvbSAnLi4vdHlwZXMvZGF0YWdyaWQtcm93JztcclxuaW1wb3J0IHsgY2xvbmVEZWVwLCBncm91cEJ5LCBzdW1CeSwgbWF4QnksIG1pbkJ5LCBtZWFuQnksIGlzUGxhaW5PYmplY3QsIGZsYXR0ZW4gfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb2x1bW5zSGVscGVyIH0gZnJvbSAnLi9kYXRhZ3JpZC1jb2x1bW5zLmhlbHBlcic7XHJcbmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ2JpZ251bWJlci5qcyc7XHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkRmFjYWRlU2VydmljZSB7XHJcblxyXG4gICAgbG9jYWxJZCA9ICd6aC1DSFMnO1xyXG5cclxuICAgIHByb3RlY3RlZCBfc3RhdGU6IEZhcnJpc0RhdGFncmlkU3RhdGU7XHJcbiAgICAvLyBwdWJsaWMgdmlydHVhbGl6ZWRTZXJ2aWNlOiBWaXJ0dWFsaXplZExvYWRlclNlcnZpY2U7XHJcblxyXG4gICAgc3RvcmUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEZhcnJpc0RhdGFncmlkU3RhdGU+KG51bGwpO1xyXG5cclxuICAgIHZpcnR1YWxSb3dTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KG51bGwpO1xyXG4gICAgZ3JpZFNpemVTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgZXJyb3JTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgc2VsZWN0Um93U3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHByaXZhdGUgdW5TZWxlY3RSb3dTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjb2x1bW5SZXNpemVTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjbGVhclNlbGVjdGlvblN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBjaGVja1Jvd1N1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBwcml2YXRlIHVuQ2hlY2tSb3dTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjbGVhckNoZWNrZWRzU3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIHByaXZhdGUgY2xlYXJBbGxTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgcHJpdmF0ZSBjaGVja0FsbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSB1bkNoZWNrQWxsU3ViamVjdCA9ICBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RBbGxTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgc2VsZWN0Q2VsbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgIGVycm9yJCA9IHRoaXMuZXJyb3JTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgc2VsZWN0Um93JCA9IHRoaXMuc2VsZWN0Um93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHVuU2VsZWN0Um93JCA9ICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNvbHVtblJlc2l6ZSQgPSB0aGlzLmNvbHVtblJlc2l6ZVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjbGVhclNlbGVjdGlvbnMkID0gdGhpcy5jbGVhclNlbGVjdGlvblN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBjaGVja1JvdyQgPSB0aGlzLmNoZWNrUm93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHVuQ2hlY2tSb3ckID0gdGhpcy51bkNoZWNrUm93U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNsZWFyQ2hlY2tlZHMkID0gdGhpcy5jbGVhckNoZWNrZWRzU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGNsZWFyQWxsJCA9IHRoaXMuY2xlYXJBbGxTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY2hlY2tBbGwkID0gdGhpcy5jaGVja0FsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB1bkNoZWNrQWxsJCA9IHRoaXMudW5DaGVja0FsbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBzZWxlY3RBbGwkID0gdGhpcy5zZWxlY3RBbGxTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgY3VycmVudENlbGwkID0gdGhpcy5zZWxlY3RDZWxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIGVkaXRDZWxsJCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIGNsaWVudFNvcnQkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgcm93QXBwZW5kJCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHJvd1VwZGF0ZSQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICByb3dEZWxldGUkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHJlYWRvbmx5IHN0YXRlJCA9IHRoaXMuc3RvcmUuYXNPYnNlcnZhYmxlKCkucGlwZShcclxuICAgICAgICBmaWx0ZXIoIChzdGF0ZTogYW55KSA9PiBzdGF0ZSlcclxuICAgICk7XHJcblxyXG4gICAgcmVhZG9ubHkgY29sdW1uR3JvdXAkID0gdGhpcy5ncmlkU2l6ZVN1YmplY3QuYXNPYnNlcnZhYmxlKCkucGlwZShcclxuICAgICAgICBmaWx0ZXIoIChzdGF0ZTogYW55KSA9PiBzdGF0ZSksXHJcbiAgICAgICAgbWFwKChzdGF0ZTogRmFycmlzRGF0YWdyaWRTdGF0ZSkgPT4gc3RhdGUuY29sdW1uc0dyb3VwKSxcclxuICAgICAgICBzd2l0Y2hNYXAoKGNvbGdyb3VwOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKCBjb2xncm91cCk7XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxyXG4gICAgKTtcclxuXHJcbiAgICBncmlkU2l6ZSQgPSB0aGlzLmdyaWRTaXplU3ViamVjdC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICAgIGZpbHRlciggKHN0YXRlOiBhbnkpID0+IHN0YXRlKSxcclxuICAgICAgICBtYXAoKHN0YXRlOiBGYXJyaXNEYXRhZ3JpZFN0YXRlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgaGVhZGVySGVpZ2h0LCBwYWdlckhlaWdodCwgd2lkdGgsIGNvbHVtbnNHcm91cCwgaGVpZ2h0LCByb3dIZWlnaHQgfSA9IHsuLi5zdGF0ZX07XHJcbiAgICAgICAgICAgIHJldHVybiB7IGhlYWRlckhlaWdodCwgcGFnZXJIZWlnaHQsIHdpZHRoLCBjb2x1bW5zR3JvdXAsIGhlaWdodCwgcm93SGVpZ2h0IH07XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxyXG4gICAgKTtcclxuXHJcbiAgICByZWFkb25seSBkYXRhJCA9IHRoaXMudmlydHVhbFJvd1N1YmplY3QucGlwZShcclxuICAgICAgICBmaWx0ZXIodnMgPT4gdnMpLFxyXG4gICAgICAgIHN3aXRjaE1hcCgodnM6IFZpcnR1YWxpemVkU3RhdGUpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtcclxuICAgICAgICAgICAgICAgIGluZGV4OiB2cy5zdGFydEluZGV4IHx8IDAsXHJcbiAgICAgICAgICAgICAgICByb3dzOiB2cy52aXJ0dWFsUm93cyB8fCBbXSxcclxuICAgICAgICAgICAgICAgIHRvcDogdnMudG9wSGlkZUhlaWdodCxcclxuICAgICAgICAgICAgICAgIGJvdHRvbTogdnMuYm90dG9tSGlkZUhlaWdodCxcclxuICAgICAgICAgICAgICAgIHNjcm9sbGluZzogdnMuaXNTY3JvbGxDaGFuZ2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxyXG4gICAgKTtcclxuXHJcbiAgICBkaWZmZXJlbmNlID0gKGZpcnN0OiBhbnlbXSwgc2Vjb25kOiBhbnlbXSkgPT4gZmlyc3QuZmlsdGVyKGl0ZW0gPT4gIXNlY29uZC5pbmNsdWRlcyhpdGVtKSk7XHJcbiAgICBkaWZmZXJlbmNlQnkgPSAoYSwgYiwgZm4pID0+IHtcclxuICAgICAgICBjb25zdCBzID0gbmV3IFNldChiLm1hcChmbikpO1xyXG4gICAgICAgIHJldHVybiBhLm1hcChmbikuZmlsdGVyKGVsID0+ICFzLmhhcyhlbCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlID0gIGNsb25lRGVlcChpbml0RGF0YUdyaWRTdGF0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlVmlydGh1YWxSb3dzKHNjcm9sbHRvcDogbnVtYmVyLCBpc1Njcm9sbENoYW5nZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgLy8gY29uc29sZS50aW1lKCforqHnrpfomZrmi5/liqDovb0nKTtcclxuICAgICAgICBjb25zdCB2aXJ0dWFsID0gdGhpcy5nZXRWaXJ0aHVhbFJvd3Moc2Nyb2xsdG9wKTtcclxuICAgICAgICB2aXJ0dWFsLmlzU2Nyb2xsQ2hhbmdlID0gaXNTY3JvbGxDaGFuZ2U7XHJcbiAgICAgICAgLy8gY29uc29sZS50aW1lRW5kKCforqHnrpfomZrmi5/liqDovb0nKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHt2aXJ0dWFsfSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMudmlydHVhbFJvd1N1YmplY3QubmV4dCh2aXJ0dWFsKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRWaXJ0aHVhbFJvd3Moc2Nyb2xsdG9wKTogVmlydHVhbGl6ZWRTdGF0ZSB7XHJcbiAgICAgICAgaWYgKHNjcm9sbHRvcCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHNjcm9sbHRvcCA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkYXRhID0gIHRoaXMuX3N0YXRlLmRhdGEgfHwgW107XHJcbiAgICAgICAgY29uc3QgdmlydHVhbCA9IHtyb3dJbmRleDogMCwgdmlydHVhbFJvd3M6IGRhdGEsIHRvcEhpZGVIZWlnaHQ6IDAsIGJvdHRvbUhpZGVIZWlnaHQ6IDAgfTtcclxuXHJcbiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAwIHx8ICh0aGlzLl9zdGF0ZS5hdXRvSGVpZ2h0ICYmICF0aGlzLl9zdGF0ZS5ncm91cFJvd3MpKSB7XHJcbiAgICAgICAgICAgIHZpcnR1YWwudmlydHVhbFJvd3MgPSBkYXRhO1xyXG4gICAgICAgICAgICByZXR1cm4gdmlydHVhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucyAmJiB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8gZGF0YSA9IHRoaXMuX3N0YXRlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiAoIXRoaXMuX3N0YXRlLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICAvLyAgICAgaWYgKHRoaXMuX3N0YXRlLnZpcnR1YWwgJiYgdGhpcy5fc3RhdGUudmlydHVhbGl6ZWQpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLnZpcnR1YWxpemVkU2VydmljZS5zdGF0ZSA9IHRoaXMuX3N0YXRlO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIGNvbnN0IHJvd3MgPSB0aGlzLnZpcnR1YWxpemVkU2VydmljZS5nZXRSb3dzKHNjcm9sbHRvcCk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdmlydHVhbCA9IHsgLi4udGhpcy5fc3RhdGUudmlydHVhbCwgLi4ucm93cyB9O1xyXG4gICAgICAgICAgICAvLyAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICB2aXJ0dWFsLnZpcnR1YWxSb3dzID0gZGF0YTtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gICAgIC8vIOihjOWIhue7hOaVsOaNruWkhOeQhlxyXG4gICAgICAgICAgICAvLyAgICAgY29uc3QgZ3JvdXBSb3dzID0gdGhpcy5ncm91cFJvd3MyKGNsb25lRGVlcChkYXRhKSk7XHJcbiAgICAgICAgICAgIC8vICAgICB2aXJ0dWFsLnZpcnR1YWxSb3dzID0gZ3JvdXBSb3dzO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0ZS5ncm91cFJvd3MpIHtcclxuICAgICAgICAgICAgICAgIC8vIOihjOWIhue7hOaVsOaNruWkhOeQhlxyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBSb3dzID0gdGhpcy5ncm91cFJvd3MyKGNsb25lRGVlcChkYXRhKSk7XHJcbiAgICAgICAgICAgICAgICB2aXJ0dWFsLnZpcnR1YWxSb3dzID0gZ3JvdXBSb3dzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUubWVyZ2VDZWxsICYmIHRoaXMuX3N0YXRlLmVuYWJsZUNsaWVudFNvcnRGb3JNZXJnZUNlbGwpIHtcclxuICAgICAgICAgICAgdmlydHVhbC52aXJ0dWFsUm93cyA9IHRoaXMuc29ydCh2aXJ0dWFsLnZpcnR1YWxSb3dzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB2aXJ0dWFsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGdldERlbHRhVG9wSGVpZ2h0KHNjcm9sVG9wLCBmaXJzdEluZGV4KSB7XHJcbiAgICAvLyAgICAgY29uc3Qge3Jvd3NMZW5ndGg6IHZpZXdSb3dzQ291bnQsIHRvcCwgYm90dG9tfSA9IHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLmdldFJvd3NDb3VudChzY3JvbFRvcCwgdGhpcy5fc3RhdGUucGFnZVNpemUsIGZpcnN0SW5kZXgpO1xyXG4gICAgLy8gICAgIGNvbnN0IGdyaWRDb250YWluZXJSb3dzQ291bnQgPSB0aGlzLnZpcnR1YWxpemVkU2VydmljZS5kaXNwbGF5Um93c0NvdW50KCk7XHJcbiAgICAvLyAgICAgbGV0IGRlbHRhVG9wSGVpZ2h0ID0gMDtcclxuICAgIC8vICAgICBpZiAodmlld1Jvd3NDb3VudCA8IGdyaWRDb250YWluZXJSb3dzQ291bnQpIHtcclxuICAgIC8vICAgICAgICAgZGVsdGFUb3BIZWlnaHQgPSAoZ3JpZENvbnRhaW5lclJvd3NDb3VudCAtIHZpZXdSb3dzQ291bnQpICogdGhpcy5fc3RhdGUucm93SGVpZ2h0IC0gdGhpcy5fc3RhdGUuaGVhZGVySGVpZ2h0O1xyXG4gICAgLy8gICAgIH1cclxuXHJcbiAgICAvLyAgICAgcmV0dXJuIGRlbHRhVG9wSGVpZ2h0O1xyXG4gICAgLy8gfVxyXG5cclxuICAgIGdldERhdGEob3JpZ2luYWwgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChvcmlnaW5hbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhIHx8IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuZGF0YSB8fCBbXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTdGF0ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmlydHVhbFN0YXRlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS52aXJ0dWFsO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFBhZ2VJbmZvKCkge1xyXG4gICAgICAgIGNvbnN0IHsgcGFnZUluZGV4LCBwYWdlU2l6ZSB9ID0gey4uLnRoaXMuX3N0YXRlfTtcclxuICAgICAgICByZXR1cm4geyBwYWdlSW5kZXgsIHBhZ2VTaXplIH07XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGluaXRTdGF0ZShzdGF0ZTogUGFydGlhbDxGYXJyaXNEYXRhZ3JpZFN0YXRlPikge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoc3RhdGUsIGZhbHNlKTtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgdGhpcy5pbml0Q29sdW1ucygpO1xyXG5cclxuICAgICAgICB0aGlzLmdyaWRTaXplU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVZpcnRodWFsUm93cygwKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqIOWKoOi9veaVsOaNrlxyXG4gICAgICogQHBhcmFtIGRhdGE6IOaVsOaNruWIl+ihqFxyXG4gICAgICogQHBhcmFtIHVwZGF0ZU9yaWdpbmFsRGF0YSDmmK/lkKbmm7TmlrDljp/lp4vmlbDmja4sIOm7mOiupOS4uiB0cnVlXHJcbiAgICAgKi9cclxuICAgIGxvYWREYXRhKGRhdGE6IGFueSwgdXBkYXRlT3JpZ2luYWxEYXRhID0gdHJ1ZSwgc29ydGFibGUgPSBmYWxzZSkge1xyXG4gICAgICAgIGRhdGEgPSBkYXRhIHx8IFtdO1xyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBkYXRhIH0sIGZhbHNlKTtcclxuXHJcbiAgICAgICAgaWYgKHVwZGF0ZU9yaWdpbmFsRGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzb3J0YWJsZSAmJiB0aGlzLl9zdGF0ZS5zb3J0TmFtZSkge1xyXG4gICAgICAgICAgICBjb25zdCBzb3J0ZWREYXRhID0gdGhpcy5zb3J0KHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgZGF0YTogc29ydGVkRGF0YSB9LCBmYWxzZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gdGhpcy51cGRhdGVTdGF0ZSh7IGRhdGE6IHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSB9LCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZVZpcnRodWFsUm93cyh0aGlzLl9zdGF0ZS52aXJ0dWFsLnNjcm9sbFRvcCB8fCAwKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5aSN5Y6f5oyH5a6a6KGM55qE5pWw5o2uICovXHJcbiAgICByZXNldFJvdyhyb3dJZDogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgb3JpZ0RhdGEgPSB0aGlzLl9zdGF0ZS5vcmlnaW5hbERhdGE7XHJcbiAgICAgICAgaWYgKG9yaWdEYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdSb3dEYXRhID0gb3JpZ0RhdGEuZmluZChyID0+IHRoaXMucHJpbWFyeUlkKHIpID09PSByb3dJZCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q3VycmVudFJvdygpLmRhdGEgPSBjbG9uZURlZXAob3JpZ1Jvd0RhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVJvdyhyb3dJZCwgb3JpZ1Jvd0RhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBsb2FkRGF0YUZvclZpcnR1YWwoZGF0YTogYW55KSB7XHJcbiAgICAvLyAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGRhdGEgfSwgZmFsc2UpO1xyXG4gICAgLy8gICAgIC8vIHRoaXMudmlydHVhbGl6ZWRTZXJ2aWNlLnN0YXRlID0gdGhpcy5fc3RhdGU7XHJcbiAgICAvLyAgICAgY29uc3QgdmlydHVhbCA9IHsgLi4udGhpcy5fc3RhdGUudmlydHVhbCwgLi4udGhpcy52aXJ0dWFsaXplZFNlcnZpY2UucmVsb2FkKCkgfTtcclxuICAgIC8vICAgICAvLyBjb25zb2xlLmxvZyh2aXJ0dWFsKTtcclxuICAgIC8vICAgICB0aGlzLnZpcnR1YWxSb3dTdWJqZWN0Lm5leHQodmlydHVhbCk7XHJcbiAgICAvLyAgICAgdGhpcy51cGRhdGVTdGF0ZSh7dmlydHVhbH0pO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIGZldGNoRGF0YSh1cmw6IHN0cmluZyk6IE9ic2VydmFibGU8RGF0YVJlc3VsdD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCkucGlwZShcclxuICAgICAgICAgICAgbWFwKCByID0+IHIgYXMgRGF0YVJlc3VsdCApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRUb3RhbCh0b3RhbDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSgge3RvdGFsfSwgZmFsc2UgKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVQcm9wZXJ0eShwcm9wZXJ0eTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IFtwcm9wZXJ0eV06IHZhbHVlIH0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQYWdpbmF0aW9uKHBhZ2VJbmRleDogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSggeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbCB9LCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2Nyb2xsVG9wKHNjcm9sbFRvcDogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgdmlydHVhbCA9IHsgLi4udGhpcy5fc3RhdGUudmlydHVhbCwgc2Nyb2xsVG9wfTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHt2aXJ0dWFsfSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzTXVsdGlTZWxlY3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLm11bHRpU2VsZWN0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2lzUm93U2VsZWN0ZWQoaWQ6IGFueSkge1xyXG4gICAgICAgIGlmICghaWQgfHwgIXRoaXMuX3N0YXRlLmN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jdXJyZW50Um93LmlkLnRvU3RyaW5nKCkgPT09IGlkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlzUm93U2VsZWN0ZWQoaWQ6IGFueSwgc2VsZWN0aW9ucyA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBmbGFnID0gdGhpcy5faXNSb3dTZWxlY3RlZChpZCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzTXVsdGlTZWxlY3QoKSB8fCB0aGlzLl9zdGF0ZS5vbmx5U2VsZWN0U2VsZikge1xyXG4gICAgICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghc2VsZWN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9jYW5DYW5jZWxTZWxlY3RXaGVuTXVsdGkoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZsYWc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghc2VsZWN0aW9ucyB8fCBzZWxlY3Rpb25zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGlvbnMuZmluZEluZGV4KHNyID0+IHNyLmlkID09IGlkKSA+IC0xO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlzUm93Q2hlY2tlZChpZDogYW55LCBjaGVja2VkcyA9IG51bGwpIHtcclxuICAgICAgICBpZiAoIWNoZWNrZWRzKSB7XHJcbiAgICAgICAgICAgIGNoZWNrZWRzID0gdGhpcy5nZXRDaGVja2VkcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWlkIHx8ICFjaGVja2Vkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNoZWNrZWRzLmZpbmRJbmRleChzciA9PiBzci5pZC50b1N0cmluZygpID09PSBpZC50b1N0cmluZygpKSA+IC0xO1xyXG4gICAgfVxyXG5cclxuICAgIGlzQ2hlY2tBbGwoKSB7XHJcbiAgICAgICAgY29uc3QgYWxsUm93cyA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKS5tYXAociA9PiB0aGlzLnByaW1hcnlJZChyKSk7XHJcbiAgICAgICAgY29uc3QgY2hlY2tJZHMgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5tYXAociA9PiByLmlkKTtcclxuICAgICAgICBpZiAodGhpcy5kaWZmZXJlbmNlKGFsbFJvd3MsIGNoZWNrSWRzKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5sZW5ndGggPT09IGFsbFJvd3MubGVuZ3RoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRDdXJyZW50UGFnZUNoZWNrZWRzKCkge1xyXG4gICAgICAgIGNvbnN0IGFsbFJvd3MgPSB0aGlzLmdldEFsbFJvd3NGb3JMaXZlKCkubWFwKHIgPT4gdGhpcy5wcmltYXJ5SWQocikpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5maWx0ZXIobiA9PiBhbGxSb3dzLmluZGV4T2Yobi5pZCkgPiAtMSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q3VycmVudFJvdygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY3VycmVudFJvdyB8fCB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2VsZWN0aW9ucygpIHtcclxuICAgICAgICAvLyDlpoLmnpzmlbDmja7mupDlj5jkuobvvIzpnIDopoHph43mlrDorqHnrpdcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fc3RhdGUuZGF0YTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2VsZWN0aW9ucyAmJiB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wOiBhbnlbXSA9IGRhdGEubWFwKG4gPT4gdGhpcy5wcmltYXJ5SWQobikpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wLmluY2x1ZGVzKG4uaWQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgfHwgW107XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDaGVja2VkUm93c0Zyb21Tb3VyY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXSkubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkID0gdGhpcy5maW5kUm93KG4uaWQpO1xyXG4gICAgICAgICAgICBpZiAoZCAmJiBkLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgIG4uZGF0YSA9IGQuZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDaGVja2Vkcyhmcm9tRGF0YVNvdXJjZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKGZyb21EYXRhU291cmNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gdGhpcy5nZXRDaGVja2VkUm93c0Zyb21Tb3VyY2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVDaGVja2VkRGF0YShyb3dpZDogYW55LCByb3dEYXRhOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KSB7XHJcbiAgICAgICAgY29uc3QgY2hlY2tlZHMgPSB0aGlzLmdldENoZWNrZWRzKCk7XHJcbiAgICAgICAgaWYgKGNoZWNrZWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gY2hlY2tlZHMuZmluZChuID0+IHRoaXMucHJpbWFyeUlkKG4pID09IHJvd2lkKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHJvd0RhdGEpLmZvckVhY2goayA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbHMuc2V0VmFsdWUoaywgcm93RGF0YVtrXSwgaXRlbS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldENoZWNrZWRSb3dzKGlkczogc3RyaW5nW10sIGNoZWNrZWQgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKGlkcyAmJiBpZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBjaGVja2VkcyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzIHx8IFtdO1xyXG5cclxuICAgICAgICAgICAgaWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93KGlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChjaGVja2VkICYmIHJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggIXRoaXMuaXNSb3dDaGVja2VkKGlkLCBjaGVja2VkcykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3JvdyA9IHsgaWQ6IHRoaXMucHJpbWFyeUlkKHJvdy5kYXRhKSwgZGF0YTogcm93LmRhdGEsIGluZGV4OiByb3cuaW5kZXggfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZHMucHVzaChzcm93KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc3RhdGUuZW5hYmxlTW9yZVBhZ2VTZWxlY3QgfHwgIWNoZWNrZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZHMgPSBjaGVja2Vkcy5maWx0ZXIoc3IgPT4gc3IuaWQgIT09IGlkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IGNoZWNrZWRzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tSZWNvcmQoaWQ6IGFueSwgY2hlY2tlZCA9IHRydWUpIHtcclxuICAgICAgICBpZiAoaWQpIHtcclxuICAgICAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93KGlkKTtcclxuICAgICAgICAgICAgaWYgKHJvdykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qge2luZGV4OiByb3dJbmRleCwgZGF0YTogcm93RGF0YX0gPSB7Li4ucm93fTtcclxuICAgICAgICAgICAgICAgIGlmIChjaGVja2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja1Jvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5DaGVja1Jvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDmnKrmib7liLBJROS4uiR7aWR955qE5pWw5o2u44CCYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDlj4LmlbBpZCDkuI3og73kuLrnqbrjgIJgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tSb3cocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9zdGF0ZS5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLl9jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgIGNvbnN0IGNoZWNrZWRzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW107XHJcbiAgICAgICAgaWYgKGlkICYmICF0aGlzLmlzUm93Q2hlY2tlZChpZCwgY2hlY2tlZHMpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkLCBkYXRhOiByb3dEYXRhLCBpbmRleDogcm93SW5kZXggfTtcclxuICAgICAgICAgICAgY2hlY2tlZHMucHVzaChzcm93KTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBjaGVja2VkcztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zZWxlY3RPbkNoZWNrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVuQ2hlY2tSb3cocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLnByaW1hcnlJZChyb3dEYXRhKTtcclxuICAgICAgICBsZXQgY2hlY2tlZHMgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyB8fCBbXTtcclxuICAgICAgICBpZiAodGhpcy5pc1Jvd0NoZWNrZWQoaWQsIGNoZWNrZWRzKSkge1xyXG4gICAgICAgICAgICBjb25zdCBzcm93ID0geyBpZCwgZGF0YTogcm93RGF0YSwgaW5kZXg6IHJvd0luZGV4IH07XHJcbiAgICAgICAgICAgIGNoZWNrZWRzID0gY2hlY2tlZHMuZmlsdGVyKHNyID0+ICcnICsgc3IuaWQgIT09ICcnICsgaWQpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IGNoZWNrZWRzO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNlbGVjdE9uQ2hlY2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudW5TZWxlY3RSb3cocm93SW5kZXgsIHJvd0RhdGEpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVuQ2hlY2tSb3dTdWJqZWN0Lm5leHQoc3Jvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEN1cnJlbnRQYWdlRGF0YShkYXRhOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5jdXJyZW50UGFnZURhdGEgPSBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEN1cnJlbnRQYWdlRGF0YSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY3VycmVudFBhZ2VEYXRhIHx8IFtdO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog6I635Y+W5omA5pyJ5Y+v5Lul5pON5L2c55qE6KGMICovXHJcbiAgICBwcml2YXRlIGdldEFsbFJvd3NGb3JMaXZlKCkge1xyXG4gICAgICAgIGxldCBhbGxEYXRhID0gdGhpcy5fc3RhdGUuZGF0YSB8fCBbXTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnBhZ2luYXRpb24gJiYgIXRoaXMuX3N0YXRlLnBhZ2VyT25TZXJ2ZXIpIHtcclxuICAgICAgICAgICAgLy8g6I635Y+W5b2T5YmN6aG15pWw5o2uXHJcbiAgICAgICAgICAgIGFsbERhdGEgPSB0aGlzLmdldEN1cnJlbnRQYWdlRGF0YSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5o6S6Zmk5o6J56aB55So55qE6KGMXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmRpc2FibGVSb3cpIHtcclxuICAgICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEuZmlsdGVyKChuLCBpKSA9PiAhdGhpcy5fc3RhdGUuZGlzYWJsZVJvdyhuLCBpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhbGxEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrQWxsKCkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgfHwgW107XHJcbiAgICAgICAgY29uc3QgYWxsRGF0YSA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKTtcclxuICAgICAgICBjb25zdCBhbGxDaGVja2VkcyA9IGFsbERhdGEubWFwKCAociwgaSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMucHJpbWFyeUlkKHIpLFxyXG4gICAgICAgICAgICAgICAgaW5kZXg6IGksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzID0gYWxsQ2hlY2tlZHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgX2NoZWNrZWRzID0gW107XHJcbiAgICAgICAgICAgIGFsbENoZWNrZWRzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmZpbmQobiA9PiBuLmlkID09IGVsZW1lbnQuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2NoZWNrZWRzLnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cy5jb25jYXQoX2NoZWNrZWRzKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuc2VsZWN0T25DaGVjayAmJiAhdGhpcy5fc3RhdGUub25seVNlbGVjdFNlbGYpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gYWxsRGF0YS5tYXAoIChyLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzLnByaW1hcnlJZChyKSxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiByXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2hlY2tBbGxTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdEFsbCgpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gW107XHJcblxyXG4gICAgICAgIGNvbnN0IGFsbERhdGEgPSB0aGlzLmdldEFsbFJvd3NGb3JMaXZlKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBhbGxEYXRhLm1hcCggKHIsIGkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGlkOiB0aGlzLnByaW1hcnlJZChyKSxcclxuICAgICAgICAgICAgICAgIGluZGV4OiBpLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogclxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY2hlY2tPblNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IGFsbERhdGEubWFwKCAociwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5wcmltYXJ5SWQociksXHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogclxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNlbGVjdEFsbFN1YmplY3QubmV4dCh0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kUm93KGlkKToge2luZGV4OiBudW1iZXIsIGRhdGE6IGFueX0ge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5kYXRhICYmIHRoaXMuX3N0YXRlLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBpbmRleCA9IC0xO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fc3RhdGUuZGF0YS5maW5kKCAobiwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMucHJpbWFyeUlkKG4pID09IGlkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7aW5kZXgsIGRhdGF9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kUm93SW5kZXgoaWQpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZGF0YSAmJiB0aGlzLl9zdGF0ZS5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuZGF0YS5maW5kSW5kZXgobiA9PiB0aGlzLnByaW1hcnlJZChuKSA9PT0gaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rumAieS4reihjO+8jOS4jeinpuWPkWdyaWQg6YCJ5Lit5LqL5Lu277yM5Y+W5raI6YCJ5Lit5LqL5Lu2XHJcbiAgICAgKi9cclxuICAgIHNldFNlbGVjdFJvdyhpZDogc3RyaW5nLCBzZWxlY3QgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5maW5kUm93KGlkKTtcclxuICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkLCBkYXRhOiByb3dEYXRhLCBpbmRleDogcm93SW5kZXggfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNNdWx0aVNlbGVjdCgpKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93Rm9yTXVsdGkoc3JvdywgZmFsc2UpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvd0Zvck11bHRpKHNyb3csIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgX3NyID0gc2VsZWN0ID8gc3JvdyA6IG51bGw7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IF9zcn0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RSZWNvcmQoaWQ6IGFueSwgc2VsZWN0ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3coaWQpO1xyXG4gICAgICAgICAgICBpZiAocm93KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7aW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfSA9IHsuLi5yb3d9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Um93KHJvd0luZGV4LCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDmnKrmib7liLBJROS4uiR7aWR955qE5pWw5o2u44CCYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGDlj4LmlbBpZCDkuI3og73kuLrnqbrjgIJgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0Um93KHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGlzTXVsdGlTZWxlY3QgPSB0aGlzLmlzTXVsdGlTZWxlY3QoKTtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJpbWFyeUlkKHJvd0RhdGEpO1xyXG4gICAgICAgIGNvbnN0IHNyb3cgPSB7IGlkLCBkYXRhOiByb3dEYXRhLCBpbmRleDogcm93SW5kZXggfTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzUm93U2VsZWN0ZWQoaWQpIHx8ICF0aGlzLl9zdGF0ZS5jdXJyZW50Um93KSB7XHJcbiAgICAgICAgICAgIGlmICghaXNNdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGN1cnJlbnRSb3c6IHNyb3cgfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSb3dTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUuY3VycmVudFJvdyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnNob3dDaGVja2JveCAmJiB0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBbIHNyb3cgXTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrUm93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSb3dGb3JNdWx0aShzcm93KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdFJvd0Zvck11bHRpKHNyb3c6IHsgaWQ6IGFueSwgZGF0YTogYW55LCBpbmRleDogYW55IH0sIGVtaXQgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLm9ubHlTZWxlY3RTZWxmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudFJvdzogc3Jvdywgc2VsZWN0aW9uczogW3Nyb3ddIH0sIGZhbHNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMuZmlsdGVyKHNyID0+IHNyLmlkICE9PSBzcm93LmlkKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5wdXNoKHNyb3cpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdFJvd1N1YmplY3QubmV4dChzcm93KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jaGVja09uU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tSb3coc3Jvdy5pbmRleCwgc3Jvdy5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1blNlbGVjdFJvd0Zvck11bHRpKHNyb3c6IHsgaWQ6IGFueSwgZGF0YTogYW55LCBpbmRleDogYW55IH0sIGVtaXQgPSB0cnVlKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0aW9ucyA9IHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMuZmlsdGVyKHNyID0+IHNyLmlkICE9PSBzcm93LmlkKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2NhbkNhbmNlbFNlbGVjdFdoZW5NdWx0aSgpIHx8ICh0aGlzLl9zdGF0ZS5jdXJyZW50Um93ICYmIHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cuaWQgPT09IHNyb3cuaWQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjdXJyZW50Um93OiBudWxsIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmNoZWNrT25TZWxlY3QpIHtcclxuICAgICAgICAgICAgdGhpcy51bkNoZWNrUm93KHNyb3cuaW5kZXgsIHNyb3cuZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnVuU2VsZWN0Um93U3ViamVjdC5uZXh0KHNyb3cpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RSb3cocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLnByaW1hcnlJZChyb3dEYXRhKTtcclxuICAgICAgICBjb25zdCBpc011bHRpU2VsZWN0ID0gdGhpcy5pc011bHRpU2VsZWN0KCk7XHJcbiAgICAgICAgY29uc3Qgc3JvdyA9IHtpZCwgaW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhfTtcclxuICAgICAgICBpZiAoIWlzTXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjdXJyZW50Um93OiBudWxsIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51blNlbGVjdFJvd1N1YmplY3QubmV4dChzcm93KTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zaG93Q2hlY2tib3gpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuQ2hlY2tSb3coc3Jvdy5pbmRleCwgc3Jvdy5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5TZWxlY3RSb3dGb3JNdWx0aShzcm93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY2FuQ2FuY2VsU2VsZWN0V2hlbk11bHRpKCkge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5fc3RhdGUua2VlcFNlbGVjdCAmJiB0aGlzLl9zdGF0ZS5vbmx5U2VsZWN0U2VsZjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jbGVhclNlbGVjdGlvbnMoZXhjbHVkZUlkcz86IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY3VycmVudFJvdyA9IG51bGw7XHJcblxyXG4gICAgICAgIGlmICghZXhjbHVkZUlkcyB8fCAhZXhjbHVkZUlkcy5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zID0gdGhpcy5fc3RhdGUuc2VsZWN0aW9ucy5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXhjbHVkZUlkcy5maW5kSW5kZXgoaSA9PiBpID09IG4uaWQpID4gLTE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jbGVhckNoZWNrZWRzKHJvd3MgPSBbXSkge1xyXG4gICAgICAgIGlmICghcm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBbXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmZpbHRlcihuID0+IHJvd3MuZmluZEluZGV4KHIgPT4gdGhpcy5wcmltYXJ5SWQocikgPT09IG4uaWQpID09IC0xKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJTZWxlY3Rpb25zKGV4Y2x1ZGVJZHM/OiBzdHJpbmdbXSkge1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSB0aGlzLl9zdGF0ZS5zZWxlY3Rpb25zO1xyXG4gICAgICAgIGV4Y2x1ZGVJZHMgPSBleGNsdWRlSWRzIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuX2NsZWFyU2VsZWN0aW9ucyhleGNsdWRlSWRzKTtcclxuICAgICAgICBjb25zdCB1bkNoZWNrUm93cyA9IHJvd3MuZmlsdGVyKG4gPT4gZXhjbHVkZUlkcy5maW5kSW5kZXgoaSA9PiBpID09IG4uaWQpID09IC0xKTtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuY2hlY2tPblNlbGVjdCB8fCAoIXRoaXMuX3N0YXRlLm11bHRpU2VsZWN0ICYmIHRoaXMuX3N0YXRlLnNob3dDaGVja2JveCkpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5fc3RhdGUuY2hlY2tlZFJvd3MgPSBbXTtcclxuICAgICAgICAgICAgLy8gdGhpcy5jbGVhckNoZWNrZWRzU3ViamVjdC5uZXh0KHJvd3MpO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGVja2VkUm93cyA9IHRoaXMuX3N0YXRlLmNoZWNrZWRSb3dzLmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAhcm93cy5maW5kKHQxID0+IHQxLmlkID09IG4uaWQgJiYgZXhjbHVkZUlkcy5maW5kSW5kZXgoaSA9PiBpID09IG4uaWQpID09IC0xKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJDaGVja2Vkc1N1YmplY3QubmV4dCh1bkNoZWNrUm93cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb25TdWJqZWN0Lm5leHQodW5DaGVja1Jvd3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyQ2hlY2tlZHMoY2xlYXJBbGwgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3Qgcm93cyA9IHRoaXMuZ2V0QWxsUm93c0ZvckxpdmUoKTtcclxuICAgICAgICBjb25zdCBfcm93cyA9IGNsZWFyQWxsID8gW10gOiByb3dzO1xyXG4gICAgICAgIHRoaXMuX2NsZWFyQ2hlY2tlZHMoX3Jvd3MpO1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zZWxlY3RPbkNoZWNrKSB7XHJcbiAgICAgICAgICAgdGhpcy5fY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2xlYXJDaGVja2Vkc1N1YmplY3QubmV4dChyb3dzKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckFsbCgpIHtcclxuICAgICAgICB0aGlzLl9jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgdGhpcy5jbGVhckFsbFN1YmplY3QubmV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE11bHRpU2VsZWN0KGZsYWc6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZS5tdWx0aVNlbGVjdCA9IGZsYWc7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q2hlY2tPblNlbGVjdChmbGFnOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY2hlY2tPblNlbGVjdCA9IGZsYWc7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2VsZWN0T25DaGVjayhmbGFnOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuc2VsZWN0T25DaGVjayA9IGZsYWc7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q3VycmVudENlbGwoZHI6IERhdGFncmlkUm93LCBmaWVsZDogc3RyaW5nLCBjZWxsRWxlbWVudD86IGFueSwgY2VsbFJlZj86IGFueSApIHtcclxuICAgICAgICBjb25zdCB7IHJvd0luZGV4LCByb3dEYXRhIH0gPSB7Li4uZHJ9O1xyXG4gICAgICAgIGxldCBjdXJyZW50Q2VsbCA9IHsuLi50aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbCwgcm93SW5kZXgsIHJvd0RhdGEsIGZpZWxkLCByb3dJZDogdGhpcy5wcmltYXJ5SWQocm93RGF0YSksIGNlbGxFbGVtZW50IH07XHJcblxyXG4gICAgICAgIGlmIChmaWVsZCAhPT0gdGhpcy5fc3RhdGUuQ29udHJvbFBhbmVsRmVpbGQpIHtcclxuICAgICAgICAgICAgaWYgKGNlbGxSZWYpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLmNlbGxSZWYgPSBjZWxsUmVmO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZmllbGQpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLmNvbHVtbiA9IHRoaXMuZ2V0Q29sdW1uKGZpZWxkKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgaXNMYXN0Um93ID0gcm93SW5kZXggPT09IHRoaXMuZ2V0RGF0YSgpLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIGN1cnJlbnRDZWxsWydsYXN0Um93J10gPSBpc0xhc3RSb3c7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudENlbGwgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtjdXJyZW50Q2VsbH0sIGZhbHNlKTtcclxuICAgICAgICB0aGlzLnNlbGVjdFJvdyhyb3dJbmRleCwgcm93RGF0YSk7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY3VycmVudFJvdy5kciA9IGRyO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNlbGVjdENlbGxTdWJqZWN0Lm5leHQoY3VycmVudENlbGwpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbFNlbGVjdENlbGwoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe2N1cnJlbnRDZWxsOiBudWxsfSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdENlbGxTdWJqZWN0Lm5leHQobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaW1hcnlJZChyb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gcm93RGF0YVt0aGlzLl9zdGF0ZS5pZEZpZWxkXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDdXJyZW50Q2VsbCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY3VycmVudENlbGw7XHJcbiAgICB9XHJcblxyXG4gICAgZWRpdENlbGwoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fc3RhdGUuY3VycmVudENlbGwuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjZWkgPSB7IC4uLnRoaXMuX3N0YXRlLmN1cnJlbnRDZWxsLCBpc0VkaXRpbmc6IHRydWUgfTtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjdXJyZW50Q2VsbDogY2VpIH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbFN1YmplY3QubmV4dChjZWkpO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5lZGl0Q2VsbCQubmV4dChjZWkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGVuZEVkaXRDZWxsKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbCAmJiB0aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbC5pc0VkaXRpbmcpIHtcclxuICAgICAgICAgICAgY29uc3QgY2VpID0geyAuLi50aGlzLl9zdGF0ZS5jdXJyZW50Q2VsbCwgaXNFZGl0aW5nOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY3VycmVudENlbGw6IGNlaSB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbFN1YmplY3QubmV4dChjZWkpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmVkaXRDZWxsJC5uZXh0KGNlaSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFwcGVuZFJvdyhyb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAocm93RGF0YSAmJiB0aGlzLnByaW1hcnlJZChyb3dEYXRhKSkge1xyXG4gICAgICAgICAgICBjb25zdCBwaWQgPSB0aGlzLnByaW1hcnlJZChyb3dEYXRhKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZmluZFJvd0luZGV4KHBpZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5kYXRhLnB1c2gocm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdEYXRhID0gWy4uLnRoaXMuX3N0YXRlLmRhdGFdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7ZGF0YTogbmV3RGF0YX0sIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yb3dBcHBlbmQkLmVtaXQocm93RGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOS4u+mUrklEIOW3suWtmOWcqO+8gUlEOiAke3BpZH1gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5Li76ZSu5qCH6K+G5a2X5q615LiN6IO95Li656m644CCYCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVJvdyhyb3dpZDogYW55LCByb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3cocm93aWQpO1xyXG4gICAgICAgIGlmIChyb3cgJiYgcm93LmRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKHJvd0RhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhyb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIGtleXMuZm9yRWFjaChmaWVsZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbHMuc2V0VmFsdWUoZmllbGQsIHJvd0RhdGFbZmllbGRdLCByb3cuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIOabtOaWsOW3suWLvumAieeahOaVsOaNrlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDaGVja2VkRGF0YShyb3dpZCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvd1VwZGF0ZSQuZW1pdChyb3cpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0NhbiBub3QgZm91bmQgcm93aWQ6ICcgKyByb3dpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIE9iamVjdC5hc3NpZ24odGhpcy5maW5kUm93KGlkKSwgcm93KTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVSb3cocm93aWQpIHtcclxuICAgICAgICBjb25zdCByb3cgPSB0aGlzLmZpbmRSb3cocm93aWQpO1xyXG4gICAgICAgIGlmIChyb3cpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IHRoaXMucmVtb3ZlUm93KHRoaXMuX3N0YXRlLmRhdGEsIHJvd2lkKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7ZGF0YTogbmV3RGF0YX0sIGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhID0gY2xvbmVEZWVwKHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dEZWxldGUkLmVtaXQocm93aWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcm93O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDYW4gbm90IGZvdW5kIHJvdyBieSBJRDonICsgcm93aWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5LuO5pWw57uE5Lit5Yig6Zmk5oyH5a6a55qESURcclxuICAgICAqIEBwYXJhbSBkYXRhIOaVsOe7hFxyXG4gICAgICogQHBhcmFtIHJvd0lkIOimgeWIoOmZpOeahElEXHJcbiAgICAgKi9cclxuICAgIHJlbW92ZVJvdyhkYXRhLCByb3dJZCkge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSBkYXRhLmZpbHRlcihuID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLnByaW1hcnlJZChuKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJvd0lkICE9PSBpZDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld0RhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgaXNDZWxsU2VsZWN0ZWQoY2VsbEluZm86IENlbGxJbmZvKSB7XHJcbiAgICAgICAgY29uc3QgY2MgPSB0aGlzLmdldEN1cnJlbnRDZWxsKCk7XHJcbiAgICAgICAgaWYgKCFjYykge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCB0aGlzLl9zdGF0ZS5jdXJyZW50Um93LmluZGV4ID09PSBjYy5yb3dJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNjLmZpZWxkID09PSBjZWxsSW5mby5maWVsZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVTdGF0ZShzdGF0ZTogUGFydGlhbDxGYXJyaXNEYXRhZ3JpZFN0YXRlPiwgZW1pdCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IHsgLi4udGhpcy5fc3RhdGUsIC4uLnN0YXRlIH07XHJcbiAgICAgICAgdGhpcy5fc3RhdGUgPSBuZXdTdGF0ZTtcclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3JlLm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNpemUobmV3U2l6ZT86IHt3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgW2tleTogc3RyaW5nXTogYW55fSkge1xyXG4gICAgICAgIGlmIChuZXdTaXplKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUobmV3U2l6ZSwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlc2V0Q29sdW1uc1NpemUoKTtcclxuICAgICAgICBpZiAoIXRoaXMuX3N0YXRlLmdyb3VwUm93cykge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVZpcnRodWFsUm93cyh0aGlzLl9zdGF0ZS52aXJ0dWFsLnNjcm9sbFRvcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpdENvbHVtbnMoZml0KSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7Zml0Q29sdW1uczogZml0fSwgZmFsc2UpO1xyXG4gICAgICAgIC8vIGNvbnN0IHIgPSB0aGlzLnVzZVVzZXJTZXRDb2x1bW5TaXplKCk7XHJcbiAgICAgICAgLy8gdGhpcy5zZXRGaXRDb2x1bW5zV2lkdGgodGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwLCB0cnVlLCByKTtcclxuICAgICAgICAvLyB0aGlzLmdyaWRTaXplU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlKTtcclxuICAgICAgICB0aGlzLnJlc2V0Q29sdW1uc1NpemUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVzZVVzZXJTZXRDb2x1bW5TaXplKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5hdXRvRml0Q29sdW1ucykge1xyXG4gICAgICAgICAgICBjb25zdCBncmlkV2lkdGggPSB0aGlzLl9zdGF0ZS53aWR0aDtcclxuICAgICAgICAgICAgY29uc3QgdXNlclNldENvbHVtbldpZHRoID0gdGhpcy5fc3RhdGUuY29sdW1uc0dyb3VwLm9yaWdpbmFsVG90YWxXaWR0aDtcclxuICAgICAgICAgICAgcmV0dXJuIHVzZXJTZXRDb2x1bW5XaWR0aCA+IGdyaWRXaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzZXRDb2x1bW5zU2l6ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuZml0Q29sdW1ucykge1xyXG4gICAgICAgICAgICAvLyAyMDIwMDQyMVxyXG4gICAgICAgICAgICBjb25zdCByID0gdGhpcy51c2VVc2VyU2V0Q29sdW1uU2l6ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldEZpdENvbHVtbnNXaWR0aCh0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXAsIHIsIHIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdyaWRTaXplU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOabtOaWsOWIl+iuvue9rlxyXG4gICAgICogQHBhcmFtIGNvbHVtbnMg5paw55qE5YiX6ZuG5ZCIXHJcbiAgICAgKiBAcGFyYW0gcmVzdGl0dXRlIOaYr+WQpui/mOWOn+WIneWni+WuveW6piDpu5jorqTkuLogZmFsc2VcclxuICAgICAqL1xyXG4gICAgdXBkYXRlQ29sdW1ucyhjb2x1bW5zLCByZXN0aXR1dGUgPSBmYWxzZSwgZW1pdCA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuY29sdW1ucyA9IGNvbHVtbnM7XHJcbiAgICAgICAgdGhpcy5pbml0Q29sdW1ucyhlbWl0LCByZXN0aXR1dGUpO1xyXG4gICAgICAgIHRoaXMucmVzaXplQ29sdW1ucyhyZXN0aXR1dGUpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBpbml0Q29sdW1ucyhlbWl0ID0gZmFsc2UsIHJlc3RDb2x1bW5XaWR0aCA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgY29sdW1ucyA9IHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zO1xyXG4gICAgICAgIGxldCBjb2xncm91cDogYW55ID0ge1xyXG4gICAgICAgICAgICBsZWZ0Rml4ZWQ6IFtdLFxyXG4gICAgICAgICAgICByaWdodEZpeGVkOiBbXSxcclxuICAgICAgICAgICAgbm9ybWFsQ29sdW1uczogW11cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChjb2x1bW5zICYmIGNvbHVtbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxlZnRGaXhlZENvbHMgPSB0aGlzLmdldEZpeGVkQ29scygnbGVmdCcpO1xyXG4gICAgICAgICAgICBjb25zdCByaWdodEZpeGVkQ29scyA9IHRoaXMuZ2V0Rml4ZWRDb2xzKCdyaWdodCcpO1xyXG4gICAgICAgICAgICBjb25zdCBub3JtYWxDb2xzID0gdGhpcy5nZXRGaXhlZENvbHMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbHVtbnMuZm9yRWFjaChjID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghYy5vcmlnaW5hbFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYy5vcmlnaW5hbFdpZHRoID0gYy53aWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb2xncm91cCA9IHtcclxuICAgICAgICAgICAgICAgIGxlZnRGaXhlZDogbGVmdEZpeGVkQ29scyxcclxuICAgICAgICAgICAgICAgIHJpZ2h0Rml4ZWQ6IHJpZ2h0Rml4ZWRDb2xzLFxyXG4gICAgICAgICAgICAgICAgbm9ybWFsQ29sdW1uczogbm9ybWFsQ29sc1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCByZXN0Q29sdW1uV2lkdGgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmZpdENvbHVtbnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7IGNvbHVtbnNHcm91cDogY29sZ3JvdXAgfSwgZW1pdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSAwO1xyXG4gICAgICAgICAgICBjb2xncm91cC5yaWdodEZpeGVkV2lkdGggPSAwO1xyXG4gICAgICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IDA7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLnRvdGFsV2lkdGggPSAwO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgY29sdW1uc0dyb3VwOiBjb2xncm91cCB9LCBlbWl0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29sdW1uSW5kZXgoZmllbGQ6IHN0cmluZywgZml4ZWQ6ICdyaWdodCd8ICcnIHwgJ2xlZnQnID0gJycpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICBpZiAoIWZpeGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2xncm91cC5ub3JtYWxDb2x1bW5zLmZpbmRJbmRleChuID0+IG4uZmllbGQgPT09IGZpZWxkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZml4ZWQgPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbGdyb3VwLmxlZnRGaXhlZC5maW5kSW5kZXgobiA9PiBuLmZpZWxkID09PSBmaWVsZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZml4ZWQgPT09ICdyaWdodCcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xncm91cC5yaWdodEZpeGVkLmZpbmRJbmRleChuID0+IG4uZmllbGQgPT09IGZpZWxkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb2x1bW5SZXNpemVFbmQoKSB7XHJcbiAgICAgICAgLy8gY29uc3QgY29sZ3JvdXAgPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXA7XHJcbiAgICAgICAgLy8gdGhpcy5pbml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCBmYWxzZSk7XHJcbiAgICAgICAgLy8gdGhpcy51cGRhdGVTdGF0ZSh7IGNvbHVtbnNHcm91cDogIHsuLi5jb2xncm91cH0gfSwgZmFsc2UpO1xyXG4gICAgICAgIC8vIHRoaXMuZ3JpZFNpemVTdWJqZWN0Lm5leHQodGhpcy5fc3RhdGUpO1xyXG4gICAgICAgIHRoaXMucmVzaXplQ29sdW1ucygpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICByZXNpemVDb2x1bW5zKHJlc3RpdHV0ZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgY29sZ3JvdXAgPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXA7XHJcbiAgICAgICAgdGhpcy5pbml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCByZXN0aXR1dGUpO1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5maXRDb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLnVzZVVzZXJTZXRDb2x1bW5TaXplKCk7XHJcbiAgICAgICAgICAgIGlmIChyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZpdENvbHVtbnNXaWR0aChjb2xncm91cCwgcmVzdGl0dXRlLCByKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml0Q29sdW1uc1dpZHRoKGNvbGdyb3VwLCByZXN0aXR1dGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjb2x1bW5zR3JvdXA6ICB7Li4uY29sZ3JvdXB9IH0sIGZhbHNlKTtcclxuICAgICAgICB0aGlzLmdyaWRTaXplU3ViamVjdC5uZXh0KHRoaXMuX3N0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRBbGxGbGF0Q29sdW1ucygpIHtcclxuICAgICAgICByZXR1cm4gZmxhdHRlbjxEYXRhQ29sdW1uPih0aGlzLl9zdGF0ZS5jb2x1bW5zKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDb2x1bW4oZmllbGROYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxGbGF0Q29sdW1ucygpLmZpbmQobiA9PiBuLmZpZWxkID09PSBmaWVsZE5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEZpdENvbHVtbnNXaWR0aChjb2xncm91cDogQ29sdW1uR3JvdXAsIHJlc3RpdHV0ZSA9IGZhbHNlLCB1c2VVc2VyU2V0Q29sdW1uU2l6ZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKCFjb2xncm91cCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbGdyb3VwLm5vcm1hbFdpZHRoID0gdGhpcy5fc3RhdGUud2lkdGggLSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCAtIGNvbGdyb3VwLnJpZ2h0Rml4ZWRXaWR0aDtcclxuXHJcbiAgICAgICAgaWYgKCFjb2xncm91cC5ub3JtYWxXaWR0aCB8fCBjb2xncm91cC5ub3JtYWxXaWR0aCA8IDAgKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAodXNlVXNlclNldENvbHVtblNpemUpIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAudG90YWxXaWR0aCA9IGNvbGdyb3VwLm9yaWdpbmFsVG90YWxXaWR0aDtcclxuICAgICAgICAgICAgaWYgKHJlc3RpdHV0ZSkge1xyXG4gICAgICAgICAgICAgICAgY29sZ3JvdXAubm9ybWFsQ29sdW1ucy5mb3JFYWNoKCBjb2wgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aCA9IGNvbC5vcmlnaW5hbFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5pu05pawIG5vcm1hbENvbHVtbnMgd2lkdGhcclxuICAgICAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSBjb2xncm91cC5ub3JtYWxDb2x1bW5zLnJlZHVjZSgodG90YWxXaWR0aCwgY29sKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3RpdHV0ZSAmJiBjb2wud2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWxXaWR0aCArPSBjb2wud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbFdpZHRoICs9IGNvbC5vcmlnaW5hbFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgICAgIGNvbGdyb3VwLnRvdGFsV2lkdGggPSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCArIGNvbGdyb3VwLnJpZ2h0Rml4ZWRXaWR0aCArIGNvbGdyb3VwLm5vcm1hbFdpZHRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbldpZHRoID0gY29sZ3JvdXAubm9ybWFsQ29sdW1ucy5yZWR1Y2UoKHRvdGFsV2lkdGgsIGNvbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN0aXR1dGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWxXaWR0aCArPSBjb2wud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbFdpZHRoICs9IGNvbC5vcmlnaW5hbFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgICAgIGNvbGdyb3VwLm5vcm1hbFdpZHRoID0gY29sZ3JvdXAubm9ybWFsV2lkdGggLSAyO1xyXG5cclxuICAgICAgICAgICAgY29sZ3JvdXAubm9ybWFsQ29sdW1ucy5mb3JFYWNoKCBjb2wgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN0aXR1dGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb2wud2lkdGggPSBNYXRoLmZsb29yKCBjb2wud2lkdGggLyBtaW5XaWR0aCAqIGNvbGdyb3VwLm5vcm1hbFdpZHRoICk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLndpZHRoID0gTnVtYmVyKChjb2wud2lkdGggLyBtaW5XaWR0aCAqIGNvbGdyb3VwLm5vcm1hbFdpZHRoICkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbC53aWR0aCA9IE1hdGguZmxvb3IoIGNvbC5vcmlnaW5hbFdpZHRoIC8gbWluV2lkdGggKiBjb2xncm91cC5ub3JtYWxXaWR0aCApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aCA9ICBOdW1iZXIoKCBjb2wub3JpZ2luYWxXaWR0aCAvIG1pbldpZHRoICogY29sZ3JvdXAubm9ybWFsV2lkdGggKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwLnRvdGFsV2lkdGggPSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCArIGNvbGdyb3VwLnJpZ2h0Rml4ZWRXaWR0aCArIGNvbGdyb3VwLm5vcm1hbFdpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRGaXhlZENvbHMoZGlyZWN0aW9uOiAnbGVmdCcgfCAncmlnaHQnIHwgJycgPSAnJykge1xyXG4gICAgICAgIGxldCBjb2xzID0gW107XHJcbiAgICAgICAgaWYgKCFkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgY29scyA9IHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zLmZpbHRlcihjb2wgPT4gIWNvbC5maXhlZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29scyA9IHRoaXMuX3N0YXRlLmZsYXRDb2x1bW5zLmZpbHRlcihjb2wgPT4gY29sLmZpeGVkID09PSBkaXJlY3Rpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5aSa6KGo5aS077yM6YeN5paw6K6h566X5YiX55qE6aG65bqPXHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmNvbHVtbnMubGVuZ3RoID4gMSAmJiBjb2xzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBEYXRhZ3JpZENvbHVtbnNIZWxwZXIuZ2V0RmllbGRzKHRoaXMuX3N0YXRlLmNvbHVtbnMpO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdjb2xzID0gW107XHJcbiAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYyA9ICBjb2xzLmZpbmQoY29sID0+IChjb2wuZmllbGQgfHwgJycgKSA9PT0gZik7XHJcbiAgICAgICAgICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld2NvbHMucHVzaChjKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXdjb2xzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbHM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmVzdGl0dXRlOiDov5jljp/liJ3lp4vlrr3luqbvvIzpu5jorqQgZmFsc2VcclxuICAgIHByaXZhdGUgaW5pdENvbHVtbnNXaWR0aChjb2xncm91cDogQ29sdW1uR3JvdXAsICByZXN0aXR1dGUgPSBmYWxzZSkge1xyXG4gICAgICAgIGxldCBvZmZzZXQgPSAwO1xyXG4gICAgICAgIG9mZnNldCA9IHRoaXMuX3N0YXRlLnNob3dMaW5lTnVtYmVyID8gb2Zmc2V0ICsgdGhpcy5fc3RhdGUubGluZU51bWJlcldpZHRoIDogb2Zmc2V0O1xyXG4gICAgICAgIG9mZnNldCA9IHRoaXMuX3N0YXRlLnNob3dDaGVja2JveCA/IG9mZnNldCArIHRoaXMuX3N0YXRlLmNoZWNrYm94Q29sdW1uV2lkdGggOiBvZmZzZXQ7XHJcblxyXG4gICAgICAgIGNvbnN0IGdldENvbHNXaWR0aCA9IChjb2xzLCB2YWwsIHJlc2V0KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2xzLnJlZHVjZSgociwgYykgPT4ge1xyXG4gICAgICAgICAgICAgICAgYy5sZWZ0ID0gcjtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gciArIGMud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByICsgYy5vcmlnaW5hbFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB2YWwpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoID0gb2Zmc2V0O1xyXG4gICAgICAgIGlmIChjb2xncm91cC5sZWZ0Rml4ZWQgJiYgY29sZ3JvdXAubGVmdEZpeGVkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IGdldENvbHNXaWR0aChjb2xncm91cC5sZWZ0Rml4ZWQsIG9mZnNldCwgcmVzdGl0dXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbGdyb3VwLnJpZ2h0Rml4ZWRXaWR0aCA9IDA7XHJcbiAgICAgICAgaWYgKGNvbGdyb3VwLnJpZ2h0Rml4ZWQgJiYgY29sZ3JvdXAucmlnaHRGaXhlZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoID0gZ2V0Q29sc1dpZHRoKGNvbGdyb3VwLnJpZ2h0Rml4ZWQsIDAsIHJlc3RpdHV0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb2xncm91cC5ub3JtYWxXaWR0aCA9IDA7XHJcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmNvbHVtbnMgJiYgdGhpcy5fc3RhdGUuY29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubm9ybWFsV2lkdGggPSBnZXRDb2xzV2lkdGgoY29sZ3JvdXAubm9ybWFsQ29sdW1ucywgMCwgcmVzdGl0dXRlKTtcclxuICAgICAgICAgICAgY29sZ3JvdXAub3JpZ2luYWxUb3RhbFdpZHRoID0gZ2V0Q29sc1dpZHRoKGNvbGdyb3VwLm5vcm1hbENvbHVtbnMsIDAsIHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29sZ3JvdXAudG90YWxXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgY29sZ3JvdXAucmlnaHRGaXhlZFdpZHRoICsgY29sZ3JvdXAubm9ybWFsV2lkdGg7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHNob3dDaGVja2JveChpc1Nob3cgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgY29sZ3JvdXAgPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXA7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7c2hvd0NoZWNrYm94OiBpc1Nob3d9LCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKGlzU2hvdykge1xyXG4gICAgICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoICsgdGhpcy5fc3RhdGUuY2hlY2tib3hDb2x1bW5XaWR0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoIC0gdGhpcy5fc3RhdGUuY2hlY2tib3hDb2x1bW5XaWR0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY29sdW1uUmVzaXplU3ViamVjdC5uZXh0KGNvbGdyb3VwKTtcclxuICAgIH1cclxuXHJcbiAgICBoaWRlQ2hlY2tib3goKSB7XHJcbiAgICAgICAgdGhpcy5zaG93Q2hlY2tib3goZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dMaW5lTnVtYmVyKGlzU2hvdyA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBjb2xncm91cCA9IHRoaXMuX3N0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtzaG93TGluZU51bWJlcjogaXNTaG93fSwgZmFsc2UpO1xyXG4gICAgICAgIGlmIChpc1Nob3cpIHtcclxuICAgICAgICAgICAgY29sZ3JvdXAubGVmdEZpeGVkV2lkdGggPSBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCArIHRoaXMuX3N0YXRlLmxpbmVOdW1iZXJXaWR0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2xncm91cC5sZWZ0Rml4ZWRXaWR0aCA9IGNvbGdyb3VwLmxlZnRGaXhlZFdpZHRoIC0gdGhpcy5fc3RhdGUubGluZU51bWJlcldpZHRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb2x1bW5SZXNpemVTdWJqZWN0Lm5leHQoY29sZ3JvdXApO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVMaW5lTnVtYmVyKCkge1xyXG4gICAgICAgIHRoaXMuc2hvd0xpbmVOdW1iZXIoZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNvcnRJbmZvKHNvcnROYW1lLCBzb3J0T3JkZXIpIHtcclxuICAgICAgICBzb3J0TmFtZSA9IHNvcnROYW1lIHx8ICcnO1xyXG4gICAgICAgIHNvcnRPcmRlciA9IHNvcnRPcmRlciB8fCAnJztcclxuICAgICAgICBjb25zdCBmaWVsZHMgPSBzb3J0TmFtZS5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGNvbnN0IG9yZGVycyA9IHNvcnRPcmRlci5zcGxpdCgnLCcpO1xyXG4gICAgICAgIC8vIGlmICghdGhpcy5fc3RhdGUubXVsdGlTb3J0KSB7XHJcbiAgICAgICAgY29uc3QgY29sZ3JvdXAgPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXA7XHJcblxyXG4gICAgICAgIGNvbnN0IHVwZGF0ZUZpZWxkT3JkZXIgPSAoY29sczogRGF0YUNvbHVtbltdKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghY29scyB8fCAhY29scy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb2xzLmZvckVhY2goIGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb2wub3JkZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gZmllbGRzLmZpbmRJbmRleChmID0+IGYgPT09IGNvbC5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sLm9yZGVyID0gb3JkZXJzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB1cGRhdGVGaWVsZE9yZGVyKGNvbGdyb3VwLm5vcm1hbENvbHVtbnMpO1xyXG4gICAgICAgIHVwZGF0ZUZpZWxkT3JkZXIoY29sZ3JvdXAubGVmdEZpeGVkKTtcclxuICAgICAgICB1cGRhdGVGaWVsZE9yZGVyKGNvbGdyb3VwLnJpZ2h0Rml4ZWQpO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7c29ydE5hbWUsIHNvcnRPcmRlcn0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBvcmRlckJ5KGFyciwgcHJvcHM6IGFueVtdLCBvcmRlcnM6IGFueVtdKSB7XHJcbiAgICAgICAgY29uc3QgY29sT2JqID0gcHJvcHMucmVkdWNlKChjLCBuKSA9PiB7XHJcbiAgICAgICAgICAgIGNbbl0gPSB0aGlzLmdldENvbHVtbihuKTtcclxuICAgICAgICAgICAgcmV0dXJuIGM7XHJcbiAgICAgICAgfSwge30pO1xyXG5cclxuICAgICAgICByZXR1cm4gWy4uLmFycl0uc29ydCgoYSwgYikgPT5cclxuICAgICAgICAgICAgcHJvcHMucmVkdWNlKChhY2MsIHByb3AsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChhY2MgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdmFsQSA9IFV0aWxzLmdldFZhbHVlKHByb3AsIGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB2YWxCID0gVXRpbHMuZ2V0VmFsdWUocHJvcCwgYik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xPYmpbcHJvcF0gJiYgY29sT2JqW3Byb3BdWydpc011bHRpbGluZ3VhbEZpZWxkJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsQSA9IFV0aWxzLmdldE11bHRpbGluZ3VhbFZhbHVlKHZhbEEsIHRoaXMubG9jYWxJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbEIgPSBVdGlscy5nZXRNdWx0aWxpbmd1YWxWYWx1ZSh2YWxCLCB0aGlzLmxvY2FsSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbEEgPT09IHVuZGVmaW5lZCB8fCB2YWxBID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbEEgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbEIgPT09IHVuZGVmaW5lZCB8fCB2YWxCID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbEIgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFtwMSwgcDJdID0gb3JkZXJzICYmIG9yZGVyc1tpXSA9PT0gJ2Rlc2MnID8gW3ZhbEIsIHZhbEFdIDogW3ZhbEEsIHZhbEJdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcDEgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYyA9IHAxLmxvY2FsZUNvbXBhcmUocDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYyA9IHAxID4gcDIgPyAxIDogcDEgPCBwMiA/IC0xIDogMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgICAgICAgICB9LCAwKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgc29ydChkYXRhOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBvcmRlcnMgPSB0aGlzLl9zdGF0ZS5zb3J0T3JkZXIuc3BsaXQoJywnKTtcclxuICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLl9zdGF0ZS5zb3J0TmFtZS5zcGxpdCgnLCcpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUubWVyZ2VDZWxsICYmIHRoaXMuX3N0YXRlLm1lcmdlRmllbGRzICYmIHRoaXMuX3N0YXRlLm1lcmdlRmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBuZXdPcmRlcnMgPSBbXTtcclxuICAgICAgICAgICAgY29uc3QgbmV3RmllbGRzID0gWy4uLnRoaXMuX3N0YXRlLm1lcmdlRmllbGRzXTtcclxuICAgICAgICAgICAgZmllbGRzLmZvckVhY2goKGYsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBrID0gbmV3RmllbGRzLmluZGV4T2YoZik7XHJcbiAgICAgICAgICAgICAgICBpZiAoayA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0ZpZWxkcy5wdXNoKGYpO1xyXG4gICAgICAgICAgICAgICAgICAgIGsgPSBuZXdGaWVsZHMubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG5ld09yZGVyc1trXSA9IG9yZGVyc1tpXTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcmRlckJ5KGRhdGEsIG5ld0ZpZWxkcywgbmV3T3JkZXJzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm9yZGVyQnkoZGF0YSwgZmllbGRzLCBvcmRlcnMpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjbGllbnRTb3J0KGRhdGE/OiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUuc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBkYXRhIH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBzb3J0ZWREYXRhID0gdGhpcy5zb3J0KHRoaXMuX3N0YXRlLmRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWREYXRhKHNvcnRlZERhdGEsIGZhbHNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyU29ydCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jbGllbnRTb3J0JC5lbWl0KHtzb3J0TmFtZTogdGhpcy5fc3RhdGUuc29ydE5hbWUsIHNvcnRPcmRlcjogdGhpcy5fc3RhdGUuc29ydE9yZGVyfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJTb3J0KCkge1xyXG4gICAgICAgIHRoaXMubG9hZERhdGEodGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZEZpbHRlckRhdGEoZmlsdGVyRGF0YTogYW55W10pIHtcclxuICAgICAgICB0aGlzLmxvYWREYXRhKGZpbHRlckRhdGEsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8jcmVnaW9uIOWPmOabtOmbhlxyXG5cclxuICAgIHByaXZhdGUgaGFzUm93Q2hhbmdlcyhyb3dpZDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgX2NoYW5nZXMgPSB0aGlzLl9zdGF0ZS5jaGFuZ2VzO1xyXG4gICAgICAgIGlmICghX2NoYW5nZXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gX2NoYW5nZXNbcm93aWRdO1xyXG4gICAgfVxyXG5cclxuICAgIGFwcGVuZENoYW5nZXMoY2hhbmdlczogUm93RGF0YUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoIWNoYW5nZXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpZCA9IGNoYW5nZXNbdGhpcy5fc3RhdGUuaWRGaWVsZF07XHJcbiAgICAgICAgaWYgKCFpZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IF9pZCA9ICcnICsgaWQ7XHJcbiAgICAgICAgaWYgKCF0aGlzLmhhc1Jvd0NoYW5nZXMoX2lkKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGFuZ2VzID0gdGhpcy5fc3RhdGUuY2hhbmdlcyB8fCB7fTtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuY2hhbmdlc1tfaWRdID0gY2hhbmdlcztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZS5jaGFuZ2VzW19pZF0gPSBPYmplY3QuYXNzaWduKHRoaXMuX3N0YXRlLmNoYW5nZXNbX2lkXSwgY2hhbmdlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFjY2VwdENoYW5nZXMoKSB7XHJcbiAgICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuX3N0YXRlLmNoYW5nZXM7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMpIHtcclxuICAgICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGNoYW5nZXMpO1xyXG4gICAgICAgICAgICBrZXlzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVSb3coaWQsIGNoYW5nZXNbaWRdKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLl9zdGF0ZS5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZWplY3RDaGFuZ2VzKHJvd2lkID0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLl9zdGF0ZS5jaGFuZ2VzO1xyXG4gICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIGlmICghcm93aWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLmRhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLmNoYW5nZXMgPSBudWxsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93Q2hhbmdlcyA9ICB0aGlzLl9zdGF0ZS5jaGFuZ2VzWycnICsgcm93aWRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvd0NoYW5nZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmdpUm93ID0gdGhpcy5fc3RhdGUub3JpZ2luYWxEYXRhLmZpbmQociA9PiB0aGlzLnByaW1hcnlJZChyKSA9PT0gcm93aWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLmRhdGEuZm9yRWFjaChyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJpbWFyeUlkKHIpID09PSByb3dpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGNsb25lRGVlcChvcmdpUm93KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2hhbmdlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGUuY2hhbmdlcztcclxuICAgIH1cclxuXHJcbiAgICByZWZyZXNoKCkge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBjbG9uZURlZXAodGhpcy5fc3RhdGUuZGF0YSk7XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YShkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaehOmAoOWQiOiuoeihjFxyXG4gICAgICogQHBhcmFtIGRhdGEg5pWw5o2u6ZuG5ZCIXHJcbiAgICAgKi9cclxuICAgIGdldEZvb3RlckRhdGEoZGF0YSkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZS5zaG93Rm9vdGVyKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGNvbHVtbnMgPSB0aGlzLl9zdGF0ZS5mbGF0Q29sdW1ucztcclxuICAgICAgICAgICAgY29uc3QgY29sdW1ucyA9IGZsYXR0ZW48RGF0YUNvbHVtbj4odGhpcy5fc3RhdGUuY29sdW1ucykuZmlsdGVyKChjb2w6IERhdGFDb2x1bW4pID0+ICFjb2wuY29sc3Bhbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvb3RlclJvdyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgY29sdW1ucy5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sLmZvb3RlciAmJiBjb2wuZm9vdGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gY29sLmZvb3Rlci5vcHRpb25zO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBvcHRpb25zLnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwID0gb3B0aW9ucy5jYWxjdWxhdGlvblR5cGUgYXMgQ2FsY3VsYXRpb25UeXBlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwICE9PSB1bmRlZmluZWQgJiYgdHlwICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuY2FsY3VsYXRpb24oZGF0YSwgdHlwLCBjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb290ZXJSb3dbY29sLmZpZWxkXSA9IHZhbDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb290ZXJSb3dbY29sLmZpZWxkXSA9IHRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmb290ZXJSb3dbY29sLmZpZWxkXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBbZm9vdGVyUm93XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXJyVG9Hcm91cChpdGVtcywgZmllbGRzOiBzdHJpbmdbXSkge1xyXG4gICAgICAgIGlmIChmaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0ID0gZmllbGRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGcxID0gZ3JvdXBCeShpdGVtcywgKG4pID0+IFV0aWxzLmdldFZhbHVlKGZpcnN0LCBuKSk7XHJcbiAgICAgICAgICAgIHRoaXMudG9Hcm91cChnMSwgZmllbGRzKTtcclxuICAgICAgICAgICAgcmV0dXJuIGcxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHRvR3JvdXAoZzEsIGZpZWxkQXJyKSB7XHJcbiAgICAgICAgaWYgKGZpZWxkQXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhnMSkuZm9yRWFjaCgoaykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBnMVtrXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9uZXh0RmllbGRzID0gZmllbGRBcnIubWFwKChuKSA9PiBuKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9mID0gX25leHRGaWVsZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgIGcxW2tdID0gZ3JvdXBCeShpdGVtcywgKG4pID0+IFV0aWxzLmdldFZhbHVlKF9mLCBuKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX25leHRGaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b0dyb3VwKGcxW2tdLCBfbmV4dEZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdyb3VwUm93czJGbGF0KGdyb3VwUm93cywgaW5pdExldmVsLCBwYXJlbnQpIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IFtdO1xyXG4gICAgICAgIGlmIChpbml0TGV2ZWwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpbml0TGV2ZWwgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpZGZpZWxkID0gdGhpcy5fc3RhdGUuaWRGaWVsZDtcclxuICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX3N0YXRlLmRhdGE7XHJcbiAgICAgICAgY29uc3QgZ3JvdXBGaWVsZEFyciA9IHRoaXMuX3N0YXRlLmdyb3VwRmllbGQuc3BsaXQoJywnKTtcclxuICAgICAgICBjb25zdCBwaWQgPSBwYXJlbnQgPyBwYXJlbnRbaWRmaWVsZF0gOiBudWxsO1xyXG4gICAgICAgIGNvbnN0IGNvbHNwYW4gPSB0aGlzLl9zdGF0ZS5jb2x1bW5zR3JvdXAubm9ybWFsQ29sdW1ucy5sZW5ndGg7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoZ3JvdXBSb3dzKS5mb3JFYWNoKChrLCBtKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBncm91cEl0ZW0gPSB7IFtpZGZpZWxkXTogVXRpbHMudXVpZCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtJU19HUk9VUF9ST1dfRklFTERdOiB0cnVlLCBbR1JPVVBfTEVWRUxfRklFTERdOiBpbml0TGV2ZWwsIGRhdGE6IHsgfSwgdmFsdWU6IGssXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW0dST1VQX1ZJU0lCTEVfRklFTERdOiB0cnVlLCBleHBhbmRlZDogdHJ1ZSwgZmllbGQ6IGdyb3VwRmllbGRBcnJbaW5pdExldmVsXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzcGFuLCB0b3RhbDogMCwgcm93czogW10sIFtHUk9VUF9ST1dfRklFTERdOiBwaWR9O1xyXG5cclxuICAgICAgICAgICAgLy8gVEZTOiAzNTY5NTVcclxuICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBJdGVtLnJvd3MgPSBwYXJlbnQucm93cy5maWx0ZXIobiA9PiAhbltJU19HUk9VUF9ST1dfRklFTERdICYmXHJcbiAgICAgICAgICAgICAgICAgICAgIW5bSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF0gJiYgIFV0aWxzLmdldFZhbHVlKGdyb3VwRmllbGRBcnJbaW5pdExldmVsXSwgbikgPT09IGspO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBJdGVtLnJvd3MgPSBkYXRhLmZpbHRlcihuID0+ICcnICsgVXRpbHMuZ2V0VmFsdWUoZ3JvdXBGaWVsZEFycltpbml0TGV2ZWxdLCBuKSA9PT0gayk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgIHBhcmVudC5yb3dzLnB1c2goZ3JvdXBJdGVtKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZ3JvdXBJdGVtLnRvdGFsID0gZ3JvdXBJdGVtLnJvd3MuZmlsdGVyKG4gPT4gIW5bSVNfR1JPVVBfUk9XX0ZJRUxEXSAmJiAhbltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSkubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGdyb3VwSXRlbSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZ3JvdXBSb3dzW2tdO1xyXG4gICAgICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChpdGVtcykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxldmVsID0gaW5pdExldmVsICsgMTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmNvbmNhdCh0aGlzLmdyb3VwUm93czJGbGF0KGl0ZW1zLCBsZXZlbCwgZ3JvdXBJdGVtKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBncm91cEl0ZW0udG90YWwgPSBpdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbltHUk9VUF9ST1dfRklFTERdID0gZ3JvdXBJdGVtW2lkZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgIG5bR1JPVVBfVklTSUJMRV9GSUVMRF0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIG5bR1JPVVBfTEVWRUxfRklFTERdID0gZ3JvdXBJdGVtW0dST1VQX0xFVkVMX0ZJRUxEXSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGdyb3VwSXRlbS5yb3dzID0gaXRlbXM7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5jb25jYXQoaXRlbXMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUuZ3JvdXBGb290ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvb3Rlckl0ZW0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgW0lTX0dST1VQX0ZPT1RFUl9ST1dfRklFTERdOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIFtHUk9VUF9ST1dfRklFTERdOiBncm91cEl0ZW1baWRmaWVsZF0sXHJcbiAgICAgICAgICAgICAgICAgICAgW0dST1VQX1ZJU0lCTEVfRklFTERdOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIFtHUk9VUF9MRVZFTF9GSUVMRF06IGluaXRMZXZlbCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7fVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGdyb3VwSXRlbS5yb3dzLnB1c2goZm9vdGVySXRlbSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZm9vdGVySXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH1cclxuXHJcbiAgICAvKiog5pu05paw5YiG57uE5ZCI6K6h6KGM5pWw5o2uICovXHJcbiAgICBwcml2YXRlIHVwZGF0ZUdyb3VwRm9vdGVyRGF0YShncm91cEZvb3RlclJvdzogYW55LCBjb2x1bW5zOiBhbnksIGdyb3VwUm93czogYW55KSB7XHJcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb2wuZ3JvdXBGb290ZXIgJiYgY29sLmdyb3VwRm9vdGVyLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb2wuZ3JvdXBGb290ZXIub3B0aW9ucztcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBvcHRpb25zLnRleHQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0eXAgPSBvcHRpb25zLmNhbGN1bGF0aW9uVHlwZSBhcyBDYWxjdWxhdGlvblR5cGU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cCAhPT0gdW5kZWZpbmVkICYmIHR5cCAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuY2FsY3VsYXRpb24oZ3JvdXBSb3dzLCB0eXAsIGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBGb290ZXJSb3cuZGF0YVtjb2wuZmllbGRdID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlclJvdy5kYXRhW2NvbC5maWVsZF0gPSB0ZXh0IHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZ3JvdXBGb290ZXJSb3cuZGF0YVtjb2wuZmllbGRdID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5aSa5a2X5q615YiG57uEXHJcbiAgICAgKiBncm91cEZpZWxkIOS7pemAl+WPt+WIhumalO+8jOS7juW3puWIsOWPs+S+neasoei/m+ihjOWIhue7hFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdyb3VwUm93czIoZGF0YTogYW55W10pIHtcclxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLl9zdGF0ZS5ncm91cEZpZWxkIHx8ICcnO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFncm91cEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBEYXRhID0gdGhpcy5hcnJUb0dyb3VwKGRhdGEsIGdyb3VwRmllbGQuc3BsaXQoJywnKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ3JvdXBSb3dzMkZsYXQoZ3JvdXBEYXRhLCAwLCBudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBrID0gMDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHByb3cgPSAocGlkKSA9PiByZXN1bHQuZmluZChuID0+IG5bdGhpcy5fc3RhdGUuaWRGaWVsZF0gPT09IHBpZCk7XHJcblxyXG4gICAgICAgICAgICByZXN1bHQubWFwKChuLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW5bSVNfR1JPVVBfUk9XX0ZJRUxEXSAmJiAhbltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5bUk9XX0lOREVYX0ZJRUxEXSA9IGs7XHJcbiAgICAgICAgICAgICAgICAgICAgaysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIOabtOaWsOWQiOiuoeihjOaVsOaNrlxyXG4gICAgICAgICAgICAgICAgaWYgKG5bSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dzID0gcHJvdyhuW0dST1VQX1JPV19GSUVMRF0pLnJvd3MuZmlsdGVyKChyOiBhbnkpID0+ICFyW0lTX0dST1VQX1JPV19GSUVMRF0gJiYgIXJbSVNfR1JPVVBfRk9PVEVSX1JPV19GSUVMRF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBGb290ZXJEYXRhKG4sIGNvbHVtbnMsIHJvd3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93R3JvdXBGb290ZXIoZ3JvdXBGb290ZXIpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtncm91cEZvb3Rlcn0sIGZhbHNlKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVZpcnRodWFsUm93cygwKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVHcm91cEZvb3Rlcihncm91cFJvd0lkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBncm91cFJvdyA9IHRoaXMuX3N0YXRlLnZpcnR1YWwudmlydHVhbFJvd3MuZmluZCgobjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBuWydpZCddID09PSBncm91cFJvd0lkO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoZ3JvdXBSb3cpIHtcclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBSb3dzID0gZ3JvdXBSb3cucm93cztcclxuICAgICAgICAgICAgY29uc3QgZ3JvdXBGb290ZXJSb3dzID0gZ3JvdXBSb3dzLmZpbHRlcigobjogYW55KSA9PiBuWydfX2dyb3VwX2Zvb3Rlcl9fJ10pO1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fc3RhdGUuZmxhdENvbHVtbnM7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByb3dzID0gZ3JvdXBSb3dzLmZpbHRlcigobjogYW55KSA9PiAhblsnX19ncm91cF9mb290ZXJfXyddKTtcclxuXHJcbiAgICAgICAgICAgIGdyb3VwRm9vdGVyUm93cy5mb3JFYWNoKChuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBGb290ZXJEYXRhKG4sIGNvbHVtbnMsIHJvd3MpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGlvbihkYXRhOiBhbnksIHR5cDogQ2FsY3VsYXRpb25UeXBlLCBjb2w6IGFueSkge1xyXG4gICAgICAgIGxldCB2YWw6IGFueSA9ICcnO1xyXG4gICAgICAgIC8vIFRGUzogMzU3MDAwXHJcbiAgICAgICAgLy8gaHR0cDovLzEwLjI0LjEuMTE6ODA4MC90ZnMvR1NQL0dTUENsb3VkL3dlYi9fcXVlcmllcz9pZD0zNTcwMDAmdHJpYWdlPXRydWUmZnVsbFNjcmVlbj1mYWxzZSZfYT1lZGl0XHJcbiAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGZpZWxkID0gY29sLmZpZWxkO1xyXG4gICAgICAgIGNvbnN0IGFyciA9IGRhdGEubWFwKChvKSA9PiBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbykgfHwgMCk7XHJcbiAgICAgICAgc3dpdGNoICh0eXApIHtcclxuICAgICAgICAgICAgY2FzZSBDYWxjdWxhdGlvblR5cGUuc3VtOlxyXG4gICAgICAgICAgICAgICAgLy8gdmFsID0gc3VtQnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIuc3VtLmFwcGx5KG51bGwsIGFycikudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLm1heDpcclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IG1heE9iaiA9IG1heEJ5KGRhdGEsIChvKSA9PiBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbykpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFsID0gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG1heE9iaik7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIubWF4LmFwcGx5KG51bGwsIGFycikudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLm1pbjpcclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IG1pbk9iaiA9IG1pbkJ5KGRhdGEsIChvKSA9PiBVdGlscy5nZXRWYWx1ZShmaWVsZCwgbykpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFsID0gVXRpbHMuZ2V0VmFsdWUoZmllbGQsIG1pbk9iaik7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIubWluLmFwcGx5KG51bGwsIGFycikudG9GaXhlZCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsY3VsYXRpb25UeXBlLmF2ZXJhZ2U6XHJcbiAgICAgICAgICAgICAgICAvLyB2YWwgPSBtZWFuQnkoZGF0YSwgKG8pID0+IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBvKSk7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSBCaWdOdW1iZXIuc3VtLmFwcGx5KG51bGwsIGFycikuZGl2KGFyci5sZW5ndGgpLnRvRml4ZWQoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENhbGN1bGF0aW9uVHlwZS5jb3VudDpcclxuICAgICAgICAgICAgICAgIHZhbCA9IGRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jcmVnaW9uIOe7hOS7tuWIneWni+WxnuaAp1xyXG5cclxuICAgIHNldGluaXRpYWxPcHRpb25zKG9wdHM6IHtba2V5OiBzdHJpbmddOiBhbnl9KSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUuaW5pdGlhbE9wdGlvbnMgPSB7fTtcclxuICAgICAgICAvLyDliIbnu4RcclxuICAgICAgICB0aGlzLl9zdGF0ZS5pbml0aWFsT3B0aW9uc1snZ3JvdXBGaWVsZCddID0gb3B0cy5ncm91cEZpZWxkO1xyXG5cclxuICAgICAgICAvLyDmjpLluo9cclxuICAgICAgICB0aGlzLl9zdGF0ZS5pbml0aWFsT3B0aW9uc1snc29ydCddID0ge1xyXG4gICAgICAgICAgICBzb3J0TmFtZTogb3B0cy5zb3J0TmFtZSxcclxuICAgICAgICAgICAgc29ydE9yZGVyOiBvcHRzLnNvcnRPcmRlclxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8g5YiX5pi+56S66ZqQ6JeP44CB5a+56b2Q5pa55byPXHJcbiAgICAgICAgaWYgKG9wdHMuY29sdW1ucyAmJiBvcHRzLmNvbHVtbnNbMF0pIHtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUuaW5pdGlhbE9wdGlvbnNbJ2NvbHVtbkZpZWxkcyddID0gKG9wdHMuY29sdW1uc1swXSBhcyBhbnkpLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG4ud2lkdGggfHwgMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBuLmZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbGlnbjogbi5oYWxpZ24sXHJcbiAgICAgICAgICAgICAgICAgICAgYWxpZ246IG4uYWxpZ24sXHJcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogbi52aXNpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgIGZvb3RlcjogY2xvbmVEZWVwKG4uZm9vdGVyIHx8IHt9KSxcclxuICAgICAgICAgICAgICAgICAgICBncm91cEZvb3RlcjogY2xvbmVEZWVwKG4uZ3JvdXBGb290ZXIgfHwge30pXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcbn1cclxuIl19