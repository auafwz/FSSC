/**
 * @fileoverview added by tsickle
 * Generated from: lib/service/f-file-uploader.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Optional } from '@angular/core';
import { Observable, Subject } from 'rxjs';
import { mergeMap, finalize } from 'rxjs/operators';
import { FFileUtils } from '../utils/index';
import { UploadStatus, UploadServerService } from '../model/index';
var FFileUploaderService = /** @class */ (function () {
    function FFileUploaderService(uploadServerSer) {
        var _this = this;
        this.uploadServerSer = uploadServerSer;
        this.allowedContentTypes = ['*'];
        //默认不限制,0代表不限制 Number.POSITIVE_INFINITY
        this.maxUploads = 0;
        // 单位M，默认是12M,0代表不限制
        this.maxFileSize = 12;
        this.concurrency = Number.POSITIVE_INFINITY;
        this.uploadedCount = 0;
        this.extendServerConfig = null;
        this.queue = [];
        this.serviceEvents = new EventEmitter();
        this.uploadScheduler = new Subject();
        this.subs = [];
        this.uploadScheduler
            .pipe(mergeMap((/**
         * @param {?} upload
         * @return {?}
         */
        function (upload) {
            return _this.serverMethod(upload);
        }), this.concurrency))
            .subscribe((/**
         * @param {?} uploadOutput
         * @return {?}
         */
        function (uploadOutput) {
            // if (uploadOutput.type == 'removed' || uploadOutput.type == 'done') {
            //   // 删除或者done移除
            //   const subIndex = this.subs.findIndex(sub => sub.id === uploadOutput.file.id);
            //   if (subIndex > -1 && this.subs[subIndex].sub) {
            //     this.subs[subIndex].sub.unsubscribe();
            //   }
            //   this.subs.splice(subIndex, 1);
            // }
            if (uploadOutput.type == 'removed') {
                // 事件中返回的都是
                _this.queue = _this.queue.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.progress.status !== UploadStatus.Remove; }));
                if (!uploadOutput.hasOwnProperty('message')) {
                    uploadOutput['message'] = "被删除";
                }
            }
            if (uploadOutput.type == 'error') {
                // 上传失败的附件移除
                _this.queue = _this.queue.filter((/**
                 * @param {?} queueItem
                 * @return {?}
                 */
                function (queueItem) {
                    return uploadOutput.files.findIndex((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return queueItem.id == item.id; })) < 0;
                }));
            }
            _this.serviceEvents.emit(uploadOutput);
        }));
    }
    /**
     * @param {?} options
     * @return {?}
     */
    FFileUploaderService.prototype.setOptions = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        // 重置文件大小、类型、个数限制
        if (options) {
            for (var prop in options) {
                this[prop] = options[prop];
            }
        }
    };
    /**
     * @param {?} incomingFiles
     * @return {?}
     */
    FFileUploaderService.prototype.handleFiles = /**
     * @param {?} incomingFiles
     * @return {?}
     */
    function (incomingFiles) {
        var _this = this;
        /** @type {?} */
        var allowedIncomingFiles = [].reduce.call(incomingFiles, (/**
         * @param {?} acc
         * @param {?} checkFile
         * @param {?} i
         * @return {?}
         */
        function (acc, checkFile, i) {
            /** @type {?} */
            var futureQueueLength = acc.length + _this.queue.length + 1;
            /** @type {?} */
            var judgeResult = _this.rejectedReason(checkFile.name, checkFile.type, futureQueueLength, checkFile.size);
            if (judgeResult.allowed) {
                acc = acc.concat(checkFile);
            }
            else {
                // 不符合当前文件类型或者内容超出限制，抛出事件
                /** @type {?} */
                var rejectedFile = FFileUtils.makeUploadFile(checkFile, i);
                _this.serviceEvents.emit({ type: 'rejected', file: rejectedFile, message: judgeResult.message });
            }
            return acc;
        }), []);
        // 构造文件结构，并单个抛出事件
        [].map.call(allowedIncomingFiles, (/**
         * @param {?} file
         * @param {?} i
         * @return {?}
         */
        function (file, i) {
            /** @type {?} */
            var uploadFile = FFileUtils.makeUploadFile(file, i);
            _this.queue.push(uploadFile);
            _this.serviceEvents.emit({ type: 'addedToQueue', file: uploadFile });
        }));
        // 所有的文件都已经添加，抛出事件
        this.serviceEvents.emit({ type: 'allAddedToQueue' });
    };
    /**
     * @private
     * @param {?} name
     * @param {?} type
     * @param {?} queuelength
     * @param {?} size
     * @return {?}
     */
    FFileUploaderService.prototype.rejectedReason = /**
     * @private
     * @param {?} name
     * @param {?} type
     * @param {?} queuelength
     * @param {?} size
     * @return {?}
     */
    function (name, type, queuelength, size) {
        /** @type {?} */
        var allowed = false;
        /** @type {?} */
        var message = '';
        // 已存在同名文件
        /** @type {?} */
        var findDuplicateIndex = this.queue.findIndex((/**
         * @param {?} file
         * @return {?}
         */
        function (file) { return file.name == name; }));
        if (findDuplicateIndex > -1) {
            message = '上传失败：已存在同名文件';
        }
        else if (!this.isContentTypeAllowed(name)) {
            message = '上传失败：只允许上传' + this.allowedContentTypes.join(',') + '类型的文档';
        }
        else if (this.maxUploads > 0 && (this.maxUploads <= this.uploadedCount || (queuelength + this.uploadedCount) > this.maxUploads)) {
            message = '上传失败：文件总个数超出' + this.maxUploads + '限制';
        }
        else if (!this.isFileSizeAllowed(size)) {
            message = '上传失败：单个文件大小超出' + this.maxFileSize + 'MB的限制';
        }
        else if (size == 0) {
            message = '上传失败：不允许文件为空';
        }
        else {
            allowed = true;
        }
        return {
            allowed: allowed, message: message
        };
    };
    /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param input
     */
    /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param {?} input
     * @return {?}
     */
    FFileUploaderService.prototype.initInputEvents = /**
     * 从前端传来事件，进行服务器端方法类型判断
     * @param {?} input
     * @return {?}
     */
    function (input) {
        var _this = this;
        //debugger
        return input.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            //debugger
            switch (event.type) {
                case 'upload':
                case 'multipartUpload':
                    /** @type {?} */
                    var uploadFileIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file === event.file; }));
                    if (uploadFileIndex !== -1 && event.file) {
                        _this.uploadScheduler.next({ files: [_this.queue[uploadFileIndex]], event: event, file: null });
                    }
                    break;
                case 'uploadAll':
                    /** @type {?} */
                    var files = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.progress.status === UploadStatus.Queue; }));
                    if (files.length > 0) {
                        event.type = 'upload';
                        _this.uploadScheduler.next({ files: files, event: event, file: null });
                    }
                    break;
                case 'cancel':
                    /** @type {?} */
                    var id_1 = event.id || null;
                    if (!id_1) {
                        return;
                    }
                    /** @type {?} */
                    var fileIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.id === id_1; }));
                    if (fileIndex !== -1) {
                        _this.serviceEvents.emit({ type: 'cancelled', files: [_this.queue[fileIndex]], message: '已取消附件上传' });
                        _this.queue.splice(fileIndex, 1);
                    }
                    break;
                    // case 'cancel':
                    // debugger
                    // const id = event.id || null;
                    // if (!id) {
                    //   return;
                    // }
                    // const subs = this.subs.filter(sub => sub.id === id);
                    // subs.forEach(sub => {
                    //   if (sub.sub) {
                    //     sub.sub.unsubscribe();
                    //     const fileIndex = this.queue.findIndex(file => file.id === id);
                    //     if (fileIndex !== -1) {
                    //       this.queue[fileIndex].progress.status = UploadStatus.Cancelled;
                    //       this.serviceEvents.emit({ type: 'cancelled', file: this.queue[fileIndex] });
                    //     }
                    //   }
                    // });
                    break;
                // case 'cancelAll':
                //   this.subs.forEach(sub => {
                //     if (sub.sub) {
                //       sub.sub.unsubscribe();
                //     }
                //     const file = this.queue.find(uploadFile => uploadFile.id === sub.id);
                //     if (file) {
                //       file.progress.status = UploadStatus.Cancelled;
                //       this.serviceEvents.emit({ type: 'cancelled', file: file });
                //     }
                //   });
                //   break;
                case 'hide':
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    var ids_1 = event.id.split(',');
                    _this.queue = _this.queue.filter((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) {
                        /** @type {?} */
                        var tIndex = ids_1.findIndex((/**
                         * @param {?} tId
                         * @return {?}
                         */
                        function (tId) { return tId == file.id; }));
                        return tIndex > -1 ? false : true;
                    }));
                    break;
                case 'cancelAll':
                    // 取消，直接从队列中移除，不用修改状态
                    /** @type {?} */
                    var queueFiles = _this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    function (uploadFile) { return uploadFile.progress.status === UploadStatus.Queue; }));
                    if (queueFiles.length) {
                        _this.serviceEvents.emit({ type: 'cancelled', files: queueFiles, message: '已取消附件上传' });
                        _this.queue = _this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        function (uploadFile) { return uploadFile.progress.status != UploadStatus.Queue; }));
                    }
                    break;
                case 'remove':
                    if (!event.id) {
                        return;
                    }
                    /** @type {?} */
                    var removeIndex = _this.queue.findIndex((/**
                     * @param {?} file
                     * @return {?}
                     */
                    function (file) { return file.id === event.id; }));
                    if (removeIndex !== -1) {
                        // 得有个开始删除和已经删除
                        _this.queue[removeIndex].progress.status = UploadStatus.Remove;
                        _this.uploadScheduler.next({ files: [_this.queue[removeIndex]], event: event, file: null });
                    }
                    break;
                case 'removeAll':
                    /** @type {?} */
                    var removeQueueFiles = _this.queue.filter((/**
                     * @param {?} uploadFile
                     * @return {?}
                     */
                    function (uploadFile) { return uploadFile.progress.status === UploadStatus.Queue; }));
                    if (removeQueueFiles.length) {
                        _this.serviceEvents.emit({ type: 'cancelled', files: removeQueueFiles, message: '删除附件成功' });
                        _this.queue = _this.queue.filter((/**
                         * @param {?} uploadFile
                         * @return {?}
                         */
                        function (uploadFile) { return uploadFile.progress.status != UploadStatus.Queue; }));
                    }
                    // 正在上传的附件是如何处理
                    // const doneFiles = this.queue.filter(uploadFile => uploadFile.progress.status === UploadStatus.Done);
                    if (_this.queue.length) {
                        event.type = 'remove';
                        _this.queue.map((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) { return item.progress.status = UploadStatus.Remove; }));
                        _this.uploadScheduler.next({ files: _this.queue, event: event, file: null });
                    }
                    break;
            }
        }));
    };
    /**
     * @param {?} extendSer
     * @return {?}
     */
    FFileUploaderService.prototype.setExtendServerConfig = /**
     * @param {?} extendSer
     * @return {?}
     */
    function (extendSer) {
        this.extendServerConfig = extendSer;
    };
    /**
     * @param {?} upload
     * @return {?}
     */
    FFileUploaderService.prototype.serverMethod = /**
     * @param {?} upload
     * @return {?}
     */
    function (upload) {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            /** @type {?} */
            var sub;
            /** @type {?} */
            var ids = upload.files.map((/**
             * @param {?} fileItem
             * @return {?}
             */
            function (fileItem) { return fileItem.id; }));
            switch (upload.event.type) {
                case 'upload':
                    sub = _this.upload(upload.files, upload.event);
                    break;
                case 'multipartUpload':
                    sub = _this.multipartUpload(upload.files[0], upload.event);
                    break;
                // case 'uploadAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.uploadAll(upload.files, upload.event);
                //   break;
                case 'remove':
                    sub = _this.remove(upload.files, upload.event);
                    break;
                // case 'removeAll':
                //   ids = upload.files.map(fileItem => fileItem.id);
                //   sub = this.removeAll(upload.files, upload.event);
                //   break;
                default:
                    sub = null;
            }
            if (!sub) {
                return;
            }
            sub.pipe(finalize((/**
             * @return {?}
             */
            function () {
                // debugger;
                if (!observer.closed) {
                    observer.complete();
                }
            })))
                .subscribe((/**
             * @param {?} output
             * @return {?}
             */
            function (output) {
                // debugger;
                observer.next(output);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                observer.next(err);
            }), (/**
             * @return {?}
             */
            function () {
                observer.complete();
            }));
            _this.subs.push({ ids: ids, sub: sub, id: '' });
            // switch (upload.event.type) {
            //   case 'uploadAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   case 'removeAll':
            //     this.subs.push({ ids: ids, sub: sub, id: '' });
            //     break;
            //   default:
            // }
        }));
    };
    /**
     * 单个文件上传
     * @param file
     * @param event
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    /**
     * 单个文件上传
     * @param {?} file
     * @param {?} event
     * @return {?}
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    FFileUploaderService.prototype.multipartUpload = /**
     * 单个文件上传
     * @param {?} file
     * @param {?} event
     * @return {?}
     */
    // uploadFile(file: UploadFile, event: UploadInput): Observable<UploadOutput> {
    //   const uploadFile = <BlobFile>file.nativeFile;
    //   const uploadIndex = this.queue.findIndex(outFile => outFile.nativeFile === uploadFile);
    //   // 已经被取消的不能被上传
    //   if (this.queue[uploadIndex].progress.status === UploadStatus.Cancelled) {
    //     return new Observable(observer => {
    //       observer.complete();
    //     });
    //   }
    //   // 抛出开始上传的事件
    //   this.serviceEvents.emit({ type: 'start', files: [file] });
    //   return this.uploadServerSer.upload(file, event, this.extendServerConfig);
    // }
    function (file, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: 'start', files: [file] });
        return this.uploadServerSer.multipartUpload(file, event, this.extendServerConfig);
    };
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    FFileUploaderService.prototype.upload = /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    function (files, event) {
        // 抛出开始上传的事件
        this.serviceEvents.emit({ type: 'start', files: files });
        return this.uploadServerSer.upload(files, event, this.extendServerConfig);
    };
    /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    FFileUploaderService.prototype.remove = /**
     * @param {?} files
     * @param {?} event
     * @return {?}
     */
    function (files, event) {
        return this.uploadServerSer.remove(files, event, this.extendServerConfig);
    };
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    /**
     * @return {?}
     */
    FFileUploaderService.prototype.reset = 
    // removeAll(files: UploadFile[], event: UploadInput): Observable<UploadOutput> {
    //   return this.uploadServerSer.removeAll(files, event, this.extendServerConfig);
    // }
    // 重置
    /**
     * @return {?}
     */
    function () {
        this.queue = [];
        //this.uploadScheduler = new Subject();
        // this.subs.forEach(sub => {
        //   if (sub.sub) {
        //     sub.sub.unsubscribe();
        //   }
        // });
        this.subs = [];
    };
    // 暂时
    // 暂时
    /**
     * @param {?} contentTypes
     * @return {?}
     */
    FFileUploaderService.prototype.setContentTypes = 
    // 暂时
    /**
     * @param {?} contentTypes
     * @return {?}
     */
    function (contentTypes) {
        if (typeof contentTypes !== 'undefined' && contentTypes instanceof Array) {
            if (contentTypes.find((/**
             * @param {?} type
             * @return {?}
             */
            function (type) { return type === '*'; })) !== undefined) {
                this.allowedContentTypes = ['*'];
            }
            else {
                this.allowedContentTypes = contentTypes;
            }
            return;
        }
        this.allowedContentTypes = ['*'];
    };
    /**
     * @return {?}
     */
    FFileUploaderService.prototype.allContentTypesAllowed = /**
     * @return {?}
     */
    function () {
        return this.allowedContentTypes.find((/**
         * @param {?} type
         * @return {?}
         */
        function (type) { return type === '*'; })) !== undefined;
    };
    /**
     *
     * @param name
     */
    /**
     *
     * @param {?} name
     * @return {?}
     */
    FFileUploaderService.prototype.isContentTypeAllowed = /**
     *
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (this.allContentTypesAllowed()) {
            return true;
        }
        // 附件没有后缀
        if (name.lastIndexOf('.') < 0) {
            return false;
        }
        /** @type {?} */
        var namesuffix = name.substr(name.lastIndexOf('.'));
        // 简化计算
        return this.allowedContentTypes.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.toLowerCase() == namesuffix.toLowerCase(); })) > -1;
    };
    /**
     * @param {?} fileSize
     * @return {?}
     */
    FFileUploaderService.prototype.isFileSizeAllowed = /**
     * @param {?} fileSize
     * @return {?}
     */
    function (fileSize) {
        if (!this.maxFileSize) {
            return true;
        }
        // fileSize是b单位 maxFileSize是MB单位
        return fileSize <= this.maxFileSize * 8 * 1024 * 1024;
    };
    /** @nocollapse */
    FFileUploaderService.ctorParameters = function () { return [
        { type: UploadServerService, decorators: [{ type: Optional }] }
    ]; };
    return FFileUploaderService;
}());
export { FFileUploaderService };
if (false) {
    /** @type {?} */
    FFileUploaderService.prototype.queue;
    /** @type {?} */
    FFileUploaderService.prototype.serviceEvents;
    /** @type {?} */
    FFileUploaderService.prototype.uploadScheduler;
    /** @type {?} */
    FFileUploaderService.prototype.subs;
    /** @type {?} */
    FFileUploaderService.prototype.allowedContentTypes;
    /** @type {?} */
    FFileUploaderService.prototype.maxUploads;
    /** @type {?} */
    FFileUploaderService.prototype.maxFileSize;
    /** @type {?} */
    FFileUploaderService.prototype.concurrency;
    /** @type {?} */
    FFileUploaderService.prototype.uploadedCount;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.extendServerConfig;
    /**
     * @type {?}
     * @private
     */
    FFileUploaderService.prototype.uploadServerSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZi1maWxlLXVwbG9hZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2V4dGVuZC1maWxlLXVwbG9hZC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2YtZmlsZS11cGxvYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkQsT0FBTyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQW9CLE1BQU0sTUFBTSxDQUFDO0FBQzdELE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBeUMsWUFBWSxFQUFZLG1CQUFtQixFQUFtQixNQUFNLGdCQUFnQixDQUFDO0FBRXJJO0lBYUUsOEJBQ3NCLGVBQW9DO1FBRDFELGlCQXVDQztRQXRDcUIsb0JBQWUsR0FBZixlQUFlLENBQXFCO1FBVDFELHdCQUFtQixHQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7O1FBRXRDLGVBQVUsR0FBVyxDQUFDLENBQUM7O1FBRXZCLGdCQUFXLEdBQVcsRUFBRSxDQUFDO1FBQ3pCLGdCQUFXLEdBQVcsTUFBTSxDQUFDLGlCQUFpQixDQUFDO1FBQy9DLGtCQUFhLEdBQVEsQ0FBQyxDQUFDO1FBQ2YsdUJBQWtCLEdBQUcsSUFBSSxDQUFDO1FBS2hDLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxZQUFZLEVBQWdCLENBQUM7UUFDdEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRWYsSUFBSSxDQUFDLGVBQWU7YUFDakIsSUFBSSxDQUNILFFBQVE7Ozs7UUFBQyxV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b0I7OztJQUMvQixxQ0FBb0I7O0lBQ3BCLDZDQUEwQzs7SUFDMUMsK0NBQXlGOztJQUN6RixvQ0FBMEQ7O0lBQzFELG1EQUFzQzs7SUFFdEMsMENBQXVCOztJQUV2QiwyQ0FBeUI7O0lBQ3pCLDJDQUErQzs7SUFDL0MsNkNBQXVCOzs7OztJQUN2QixrREFBa0M7Ozs7O0lBRWhDLCtDQUF3RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtZXJnZU1hcCwgZmluYWxpemUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEZGaWxlVXRpbHMgfSBmcm9tICcuLi91dGlscy9pbmRleCc7XHJcbmltcG9ydCB7IFVwbG9hZEZpbGUsIFVwbG9hZE91dHB1dCwgVXBsb2FkSW5wdXQsIFVwbG9hZFN0YXR1cywgQmxvYkZpbGUsIFVwbG9hZFNlcnZlclNlcnZpY2UsIFVwbG9hZGVyT3B0aW9ucyB9IGZyb20gJy4uL21vZGVsL2luZGV4JztcclxuXHJcbmV4cG9ydCBjbGFzcyBGRmlsZVVwbG9hZGVyU2VydmljZSB7XHJcbiAgcXVldWU6IFVwbG9hZEZpbGVbXTtcclxuICBzZXJ2aWNlRXZlbnRzOiBFdmVudEVtaXR0ZXI8VXBsb2FkT3V0cHV0PjtcclxuICB1cGxvYWRTY2hlZHVsZXI6IFN1YmplY3Q8eyBmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQsIGZpbGVzPzogVXBsb2FkRmlsZVtdIH0+O1xyXG4gIHN1YnM6IHsgaWQ6IHN0cmluZywgc3ViOiBTdWJzY3JpcHRpb24sIGlkcz86IHN0cmluZ1tdIH1bXTtcclxuICBhbGxvd2VkQ29udGVudFR5cGVzOiBzdHJpbmdbXSA9IFsnKiddO1xyXG4gIC8v6buY6K6k5LiN6ZmQ5Yi2LDDku6PooajkuI3pmZDliLYgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZXHJcbiAgbWF4VXBsb2FkczogbnVtYmVyID0gMDtcclxuICAvLyDljZXkvY1N77yM6buY6K6k5pivMTJNLDDku6PooajkuI3pmZDliLZcclxuICBtYXhGaWxlU2l6ZTogbnVtYmVyID0gMTI7XHJcbiAgY29uY3VycmVuY3k6IG51bWJlciA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcclxuICB1cGxvYWRlZENvdW50Om51bWJlcj0wO1xyXG4gIHByaXZhdGUgZXh0ZW5kU2VydmVyQ29uZmlnID0gbnVsbDtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgdXBsb2FkU2VydmVyU2VyOiBVcGxvYWRTZXJ2ZXJTZXJ2aWNlXHJcbiAgKSB7XHJcblxyXG4gICAgdGhpcy5xdWV1ZSA9IFtdO1xyXG4gICAgdGhpcy5zZXJ2aWNlRXZlbnRzID0gbmV3IEV2ZW50RW1pdHRlcjxVcGxvYWRPdXRwdXQ+KCk7XHJcbiAgICB0aGlzLnVwbG9hZFNjaGVkdWxlciA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICB0aGlzLnN1YnMgPSBbXTtcclxuXHJcbiAgICB0aGlzLnVwbG9hZFNjaGVkdWxlclxyXG4gICAgICAucGlwZShcclxuICAgICAgICBtZXJnZU1hcCh1cGxvYWQgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmVyTWV0aG9kKHVwbG9hZCk7XHJcbiAgICAgICAgfSwgdGhpcy5jb25jdXJyZW5jeSlcclxuICAgICAgKVxyXG4gICAgICAuc3Vic2NyaWJlKHVwbG9hZE91dHB1dCA9PiB7XHJcbiAgICAgICAgLy8gaWYgKHVwbG9hZE91dHB1dC50eXBlID09ICdyZW1vdmVkJyB8fCB1cGxvYWRPdXRwdXQudHlwZSA9PSAnZG9uZScpIHtcclxuICAgICAgICAvLyAgIC8vIOWIoOmZpOaIluiAhWRvbmXnp7vpmaRcclxuICAgICAgICAvLyAgIGNvbnN0IHN1YkluZGV4ID0gdGhpcy5zdWJzLmZpbmRJbmRleChzdWIgPT4gc3ViLmlkID09PSB1cGxvYWRPdXRwdXQuZmlsZS5pZCk7XHJcbiAgICAgICAgLy8gICBpZiAoc3ViSW5kZXggPiAtMSAmJiB0aGlzLnN1YnNbc3ViSW5kZXhdLnN1Yikge1xyXG4gICAgICAgIC8vICAgICB0aGlzLnN1YnNbc3ViSW5kZXhdLnN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIC8vICAgfVxyXG4gICAgICAgIC8vICAgdGhpcy5zdWJzLnNwbGljZShzdWJJbmRleCwgMSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIGlmICh1cGxvYWRPdXRwdXQudHlwZSA9PSAncmVtb3ZlZCcpIHtcclxuICAgICAgICAgIC8vIOS6i+S7tuS4rei/lOWbnueahOmDveaYr1xyXG4gICAgICAgICAgdGhpcy5xdWV1ZSA9IHRoaXMucXVldWUuZmlsdGVyKGl0ZW0gPT4gaXRlbS5wcm9ncmVzcy5zdGF0dXMgIT09IFVwbG9hZFN0YXR1cy5SZW1vdmUpO1xyXG4gICAgICAgICAgaWYgKCF1cGxvYWRPdXRwdXQuaGFzT3duUHJvcGVydHkoJ21lc3NhZ2UnKSkge1xyXG4gICAgICAgICAgICB1cGxvYWRPdXRwdXRbJ21lc3NhZ2UnXSA9IFwi6KKr5Yig6ZmkXCI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1cGxvYWRPdXRwdXQudHlwZSA9PSAnZXJyb3InKSB7XHJcbiAgICAgICAgICAvLyDkuIrkvKDlpLHotKXnmoTpmYTku7bnp7vpmaRcclxuICAgICAgICAgIHRoaXMucXVldWUgPSB0aGlzLnF1ZXVlLmZpbHRlcihxdWV1ZUl0ZW0gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdXBsb2FkT3V0cHV0LmZpbGVzLmZpbmRJbmRleChpdGVtID0+IHF1ZXVlSXRlbS5pZCA9PSBpdGVtLmlkKSA8IDA7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQodXBsb2FkT3V0cHV0KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG4gIHNldE9wdGlvbnMob3B0aW9uczogVXBsb2FkZXJPcHRpb25zKSB7XHJcbiAgICAvLyDph43nva7mlofku7blpKflsI/jgIHnsbvlnovjgIHkuKrmlbDpmZDliLZcclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgIGZvciAobGV0IHByb3AgaW4gb3B0aW9ucykge1xyXG4gICAgICAgIHRoaXNbcHJvcF0gPSBvcHRpb25zW3Byb3BdO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIGhhbmRsZUZpbGVzKGluY29taW5nRmlsZXM6IEZpbGVMaXN0KTogdm9pZCB7XHJcblxyXG4gICAgY29uc3QgYWxsb3dlZEluY29taW5nRmlsZXM6IEZpbGVbXSA9IFtdLnJlZHVjZS5jYWxsKGluY29taW5nRmlsZXMsIChhY2M6IEZpbGVbXSwgY2hlY2tGaWxlOiBGaWxlLCBpOiBudW1iZXIpID0+IHtcclxuICAgICAgY29uc3QgZnV0dXJlUXVldWVMZW5ndGggPSBhY2MubGVuZ3RoICsgdGhpcy5xdWV1ZS5sZW5ndGggKyAxO1xyXG4gICAgICBsZXQganVkZ2VSZXN1bHQgPSB0aGlzLnJlamVjdGVkUmVhc29uKGNoZWNrRmlsZS5uYW1lLCBjaGVja0ZpbGUudHlwZSwgZnV0dXJlUXVldWVMZW5ndGgsIGNoZWNrRmlsZS5zaXplKTtcclxuICAgICAgaWYgKGp1ZGdlUmVzdWx0LmFsbG93ZWQpIHtcclxuICAgICAgICBhY2MgPSBhY2MuY29uY2F0KGNoZWNrRmlsZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5LiN56ym5ZCI5b2T5YmN5paH5Lu257G75Z6L5oiW6ICF5YaF5a656LaF5Ye66ZmQ5Yi277yM5oqb5Ye65LqL5Lu2XHJcbiAgICAgICAgY29uc3QgcmVqZWN0ZWRGaWxlOiBVcGxvYWRGaWxlID0gRkZpbGVVdGlscy5tYWtlVXBsb2FkRmlsZShjaGVja0ZpbGUsIGkpO1xyXG4gICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ3JlamVjdGVkJywgZmlsZTogcmVqZWN0ZWRGaWxlLCBtZXNzYWdlOiBqdWRnZVJlc3VsdC5tZXNzYWdlIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBhY2M7XHJcbiAgICB9LCBbXSk7XHJcblxyXG4gICAgLy8g5p6E6YCg5paH5Lu257uT5p6E77yM5bm25Y2V5Liq5oqb5Ye65LqL5Lu2XHJcbiAgICBbXS5tYXAuY2FsbChhbGxvd2VkSW5jb21pbmdGaWxlcywgKGZpbGU6IEZpbGUsIGk6IG51bWJlcikgPT4ge1xyXG4gICAgICBjb25zdCB1cGxvYWRGaWxlOiBVcGxvYWRGaWxlID0gRkZpbGVVdGlscy5tYWtlVXBsb2FkRmlsZShmaWxlLCBpKTtcclxuICAgICAgdGhpcy5xdWV1ZS5wdXNoKHVwbG9hZEZpbGUpO1xyXG4gICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6ICdhZGRlZFRvUXVldWUnLCBmaWxlOiB1cGxvYWRGaWxlIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5omA5pyJ55qE5paH5Lu26YO95bey57uP5re75Yqg77yM5oqb5Ye65LqL5Lu2XHJcbiAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6ICdhbGxBZGRlZFRvUXVldWUnIH0pO1xyXG4gIH1cclxuICBwcml2YXRlIHJlamVjdGVkUmVhc29uKG5hbWUsIHR5cGUsIHF1ZXVlbGVuZ3RoLCBzaXplKSB7XHJcbiAgICBsZXQgYWxsb3dlZCA9IGZhbHNlO1xyXG4gICAgbGV0IG1lc3NhZ2UgPSAnJztcclxuICAgIC8vIOW3suWtmOWcqOWQjOWQjeaWh+S7tlxyXG4gICAgbGV0IGZpbmREdXBsaWNhdGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KGZpbGUgPT4gZmlsZS5uYW1lID09IG5hbWUpO1xyXG4gICAgaWYgKGZpbmREdXBsaWNhdGVJbmRleCA+IC0xKSB7XHJcbiAgICAgIG1lc3NhZ2UgPSAn5LiK5Lyg5aSx6LSl77ya5bey5a2Y5Zyo5ZCM5ZCN5paH5Lu2JztcclxuICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNDb250ZW50VHlwZUFsbG93ZWQobmFtZSkpIHtcclxuICAgICAgbWVzc2FnZSA9ICfkuIrkvKDlpLHotKXvvJrlj6rlhYHorrjkuIrkvKAnICsgdGhpcy5hbGxvd2VkQ29udGVudFR5cGVzLmpvaW4oJywnKSArICfnsbvlnovnmoTmlofmoaMnO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLm1heFVwbG9hZHMgPiAwICYmICh0aGlzLm1heFVwbG9hZHM8PXRoaXMudXBsb2FkZWRDb3VudHx8IChxdWV1ZWxlbmd0aCArdGhpcy51cGxvYWRlZENvdW50KSA+IHRoaXMubWF4VXBsb2FkcykpIHtcclxuICAgICAgbWVzc2FnZSA9ICfkuIrkvKDlpLHotKXvvJrmlofku7bmgLvkuKrmlbDotoXlh7onICsgdGhpcy5tYXhVcGxvYWRzICsgJ+mZkOWItic7XHJcbiAgICB9IGVsc2UgaWYgKCF0aGlzLmlzRmlsZVNpemVBbGxvd2VkKHNpemUpKSB7XHJcbiAgICAgIG1lc3NhZ2UgPSAn5LiK5Lyg5aSx6LSl77ya5Y2V5Liq5paH5Lu25aSn5bCP6LaF5Ye6JyArIHRoaXMubWF4RmlsZVNpemUgKyAnTULnmoTpmZDliLYnO1xyXG4gICAgfSBlbHNlIGlmIChzaXplID09IDApIHtcclxuICAgICAgbWVzc2FnZSA9ICfkuIrkvKDlpLHotKXvvJrkuI3lhYHorrjmlofku7bkuLrnqbonXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhbGxvd2VkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGFsbG93ZWQsIG1lc3NhZ2VcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5LuO5YmN56uv5Lyg5p2l5LqL5Lu277yM6L+b6KGM5pyN5Yqh5Zmo56uv5pa55rOV57G75Z6L5Yik5patXHJcbiAgICogQHBhcmFtIGlucHV0IFxyXG4gICAqL1xyXG4gIGluaXRJbnB1dEV2ZW50cyhpbnB1dDogRXZlbnRFbWl0dGVyPFVwbG9hZElucHV0Pik6IFN1YnNjcmlwdGlvbiB7XHJcbiAgICAvL2RlYnVnZ2VyXHJcbiAgICByZXR1cm4gaW5wdXQuc3Vic2NyaWJlKChldmVudDogVXBsb2FkSW5wdXQpID0+IHtcclxuICAgICAgLy9kZWJ1Z2dlclxyXG4gICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcclxuICAgICAgICBjYXNlICd1cGxvYWQnOlxyXG4gICAgICAgIGNhc2UgJ211bHRpcGFydFVwbG9hZCc6XHJcbiAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlSW5kZXggPSB0aGlzLnF1ZXVlLmZpbmRJbmRleChmaWxlID0+IGZpbGUgPT09IGV2ZW50LmZpbGUpO1xyXG4gICAgICAgICAgaWYgKHVwbG9hZEZpbGVJbmRleCAhPT0gLTEgJiYgZXZlbnQuZmlsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlci5uZXh0KHsgZmlsZXM6IFt0aGlzLnF1ZXVlW3VwbG9hZEZpbGVJbmRleF1dLCBldmVudDogZXZlbnQsIGZpbGU6IG51bGwgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICd1cGxvYWRBbGwnOlxyXG4gICAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLnF1ZXVlLmZpbHRlcihmaWxlID0+IGZpbGUucHJvZ3Jlc3Muc3RhdHVzID09PSBVcGxvYWRTdGF0dXMuUXVldWUpO1xyXG4gICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZXZlbnQudHlwZSA9ICd1cGxvYWQnO1xyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlci5uZXh0KHsgZmlsZXM6IGZpbGVzLCBldmVudDogZXZlbnQsIGZpbGU6IG51bGwgfSlcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2NhbmNlbCc6XHJcbiAgICAgICAgICBjb25zdCBpZCA9IGV2ZW50LmlkIHx8IG51bGw7XHJcbiAgICAgICAgICBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGZpbGVJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KGZpbGUgPT4gZmlsZS5pZCA9PT0gaWQpO1xyXG4gICAgICAgICAgaWYgKGZpbGVJbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiAnY2FuY2VsbGVkJywgZmlsZXM6IFt0aGlzLnF1ZXVlW2ZpbGVJbmRleF1dLCBtZXNzYWdlOiAn5bey5Y+W5raI6ZmE5Lu25LiK5LygJyB9KTtcclxuICAgICAgICAgICAgdGhpcy5xdWV1ZS5zcGxpY2UoZmlsZUluZGV4LCAxKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgLy8gY2FzZSAnY2FuY2VsJzpcclxuICAgICAgICAgIC8vIGRlYnVnZ2VyXHJcbiAgICAgICAgICAvLyBjb25zdCBpZCA9IGV2ZW50LmlkIHx8IG51bGw7XHJcbiAgICAgICAgICAvLyBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAvLyAgIHJldHVybjtcclxuICAgICAgICAgIC8vIH1cclxuICAgICAgICAgIC8vIGNvbnN0IHN1YnMgPSB0aGlzLnN1YnMuZmlsdGVyKHN1YiA9PiBzdWIuaWQgPT09IGlkKTtcclxuICAgICAgICAgIC8vIHN1YnMuZm9yRWFjaChzdWIgPT4ge1xyXG4gICAgICAgICAgLy8gICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgICAgLy8gICAgIHN1Yi5zdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgIC8vICAgICBjb25zdCBmaWxlSW5kZXggPSB0aGlzLnF1ZXVlLmZpbmRJbmRleChmaWxlID0+IGZpbGUuaWQgPT09IGlkKTtcclxuICAgICAgICAgIC8vICAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgLy8gICAgICAgdGhpcy5xdWV1ZVtmaWxlSW5kZXhdLnByb2dyZXNzLnN0YXR1cyA9IFVwbG9hZFN0YXR1cy5DYW5jZWxsZWQ7XHJcbiAgICAgICAgICAvLyAgICAgICB0aGlzLnNlcnZpY2VFdmVudHMuZW1pdCh7IHR5cGU6ICdjYW5jZWxsZWQnLCBmaWxlOiB0aGlzLnF1ZXVlW2ZpbGVJbmRleF0gfSk7XHJcbiAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgLy8gICB9XHJcbiAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIC8vIGNhc2UgJ2NhbmNlbEFsbCc6XHJcbiAgICAgICAgLy8gICB0aGlzLnN1YnMuZm9yRWFjaChzdWIgPT4ge1xyXG4gICAgICAgIC8vICAgICBpZiAoc3ViLnN1Yikge1xyXG4gICAgICAgIC8vICAgICAgIHN1Yi5zdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAvLyAgICAgfVxyXG5cclxuICAgICAgICAvLyAgICAgY29uc3QgZmlsZSA9IHRoaXMucXVldWUuZmluZCh1cGxvYWRGaWxlID0+IHVwbG9hZEZpbGUuaWQgPT09IHN1Yi5pZCk7XHJcbiAgICAgICAgLy8gICAgIGlmIChmaWxlKSB7XHJcbiAgICAgICAgLy8gICAgICAgZmlsZS5wcm9ncmVzcy5zdGF0dXMgPSBVcGxvYWRTdGF0dXMuQ2FuY2VsbGVkO1xyXG4gICAgICAgIC8vICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ2NhbmNlbGxlZCcsIGZpbGU6IGZpbGUgfSk7XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyAgIH0pO1xyXG4gICAgICAgIC8vICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnaGlkZSc6XHJcbiAgICAgICAgICBpZiAoIWV2ZW50LmlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGxldCBpZHMgPSBldmVudC5pZC5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgdGhpcy5xdWV1ZSA9IHRoaXMucXVldWUuZmlsdGVyKGZpbGUgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdEluZGV4ID0gaWRzLmZpbmRJbmRleCh0SWQgPT4gdElkID09IGZpbGUuaWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gdEluZGV4ID4gLTEgPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2NhbmNlbEFsbCc6XHJcbiAgICAgICAgICAvLyDlj5bmtojvvIznm7TmjqXku47pmJ/liJfkuK3np7vpmaTvvIzkuI3nlKjkv67mlLnnirbmgIFcclxuICAgICAgICAgIGNvbnN0IHF1ZXVlRmlsZXMgPSB0aGlzLnF1ZXVlLmZpbHRlcih1cGxvYWRGaWxlID0+IHVwbG9hZEZpbGUucHJvZ3Jlc3Muc3RhdHVzID09PSBVcGxvYWRTdGF0dXMuUXVldWUpO1xyXG4gICAgICAgICAgaWYgKHF1ZXVlRmlsZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ2NhbmNlbGxlZCcsIGZpbGVzOiBxdWV1ZUZpbGVzLCBtZXNzYWdlOiAn5bey5Y+W5raI6ZmE5Lu25LiK5LygJyB9KTtcclxuICAgICAgICAgICAgdGhpcy5xdWV1ZSA9IHRoaXMucXVldWUuZmlsdGVyKHVwbG9hZEZpbGUgPT4gdXBsb2FkRmlsZS5wcm9ncmVzcy5zdGF0dXMgIT0gVXBsb2FkU3RhdHVzLlF1ZXVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3JlbW92ZSc6XHJcbiAgICAgICAgICBpZiAoIWV2ZW50LmlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IHJlbW92ZUluZGV4ID0gdGhpcy5xdWV1ZS5maW5kSW5kZXgoZmlsZSA9PiBmaWxlLmlkID09PSBldmVudC5pZCk7XHJcbiAgICAgICAgICBpZiAocmVtb3ZlSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIC8vIOW+l+acieS4quW8gOWni+WIoOmZpOWSjOW3sue7j+WIoOmZpFxyXG4gICAgICAgICAgICB0aGlzLnF1ZXVlW3JlbW92ZUluZGV4XS5wcm9ncmVzcy5zdGF0dXMgPSBVcGxvYWRTdGF0dXMuUmVtb3ZlXHJcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2NoZWR1bGVyLm5leHQoeyBmaWxlczogW3RoaXMucXVldWVbcmVtb3ZlSW5kZXhdXSwgZXZlbnQ6IGV2ZW50LCBmaWxlOiBudWxsIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmVtb3ZlQWxsJzpcclxuICAgICAgICAgIGNvbnN0IHJlbW92ZVF1ZXVlRmlsZXMgPSB0aGlzLnF1ZXVlLmZpbHRlcih1cGxvYWRGaWxlID0+IHVwbG9hZEZpbGUucHJvZ3Jlc3Muc3RhdHVzID09PSBVcGxvYWRTdGF0dXMuUXVldWUpO1xyXG4gICAgICAgICAgaWYgKHJlbW92ZVF1ZXVlRmlsZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmljZUV2ZW50cy5lbWl0KHsgdHlwZTogJ2NhbmNlbGxlZCcsIGZpbGVzOiByZW1vdmVRdWV1ZUZpbGVzLCBtZXNzYWdlOiAn5Yig6Zmk6ZmE5Lu25oiQ5YqfJyB9KTtcclxuICAgICAgICAgICAgdGhpcy5xdWV1ZSA9IHRoaXMucXVldWUuZmlsdGVyKHVwbG9hZEZpbGUgPT4gdXBsb2FkRmlsZS5wcm9ncmVzcy5zdGF0dXMgIT0gVXBsb2FkU3RhdHVzLlF1ZXVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIOato+WcqOS4iuS8oOeahOmZhOS7tuaYr+WmguS9leWkhOeQhlxyXG4gICAgICAgICAgLy8gY29uc3QgZG9uZUZpbGVzID0gdGhpcy5xdWV1ZS5maWx0ZXIodXBsb2FkRmlsZSA9PiB1cGxvYWRGaWxlLnByb2dyZXNzLnN0YXR1cyA9PT0gVXBsb2FkU3RhdHVzLkRvbmUpO1xyXG4gICAgICAgICAgaWYgKHRoaXMucXVldWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnR5cGUgPSAncmVtb3ZlJztcclxuICAgICAgICAgICAgdGhpcy5xdWV1ZS5tYXAoaXRlbSA9PiBpdGVtLnByb2dyZXNzLnN0YXR1cyA9IFVwbG9hZFN0YXR1cy5SZW1vdmUpO1xyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNjaGVkdWxlci5uZXh0KHsgZmlsZXM6IHRoaXMucXVldWUsIGV2ZW50OiBldmVudCwgZmlsZTogbnVsbCB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNldEV4dGVuZFNlcnZlckNvbmZpZyhleHRlbmRTZXIpIHtcclxuICAgIHRoaXMuZXh0ZW5kU2VydmVyQ29uZmlnID0gZXh0ZW5kU2VyO1xyXG4gIH1cclxuXHJcbiAgc2VydmVyTWV0aG9kKHVwbG9hZDogeyBmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQsIGZpbGVzPzogVXBsb2FkRmlsZVtdIH0pOiBPYnNlcnZhYmxlPFVwbG9hZE91dHB1dD4ge1xyXG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAgICAgbGV0IHN1YjtcclxuICAgICAgbGV0IGlkcyA9IHVwbG9hZC5maWxlcy5tYXAoZmlsZUl0ZW0gPT4gZmlsZUl0ZW0uaWQpO1xyXG4gICAgICBzd2l0Y2ggKHVwbG9hZC5ldmVudC50eXBlKSB7XHJcbiAgICAgICAgY2FzZSAndXBsb2FkJzpcclxuICAgICAgICAgIHN1YiA9IHRoaXMudXBsb2FkKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ211bHRpcGFydFVwbG9hZCc6XHJcbiAgICAgICAgICBzdWI9dGhpcy5tdWx0aXBhcnRVcGxvYWQodXBsb2FkLmZpbGVzWzBdLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgLy8gY2FzZSAndXBsb2FkQWxsJzpcclxuICAgICAgICAvLyAgIGlkcyA9IHVwbG9hZC5maWxlcy5tYXAoZmlsZUl0ZW0gPT4gZmlsZUl0ZW0uaWQpO1xyXG4gICAgICAgIC8vICAgc3ViID0gdGhpcy51cGxvYWRBbGwodXBsb2FkLmZpbGVzLCB1cGxvYWQuZXZlbnQpO1xyXG4gICAgICAgIC8vICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmVtb3ZlJzpcclxuICAgICAgICAgIHN1YiA9IHRoaXMucmVtb3ZlKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIC8vIGNhc2UgJ3JlbW92ZUFsbCc6XHJcbiAgICAgICAgLy8gICBpZHMgPSB1cGxvYWQuZmlsZXMubWFwKGZpbGVJdGVtID0+IGZpbGVJdGVtLmlkKTtcclxuICAgICAgICAvLyAgIHN1YiA9IHRoaXMucmVtb3ZlQWxsKHVwbG9hZC5maWxlcywgdXBsb2FkLmV2ZW50KTtcclxuICAgICAgICAvLyAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBzdWIgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghc3ViKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHN1Yi5waXBlKGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICAvLyBkZWJ1Z2dlcjtcclxuICAgICAgICBpZiAoIW9ic2VydmVyLmNsb3NlZCkge1xyXG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pKVxyXG4gICAgICAgIC5zdWJzY3JpYmUob3V0cHV0ID0+IHtcclxuICAgICAgICAgIC8vIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dChvdXRwdXQpO1xyXG4gICAgICAgIH0sIGVyciA9PiB7XHJcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KGVycik7XHJcbiAgICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgdGhpcy5zdWJzLnB1c2goeyBpZHM6IGlkcywgc3ViOiBzdWIsIGlkOiAnJyB9KTtcclxuICAgICAgLy8gc3dpdGNoICh1cGxvYWQuZXZlbnQudHlwZSkge1xyXG4gICAgICAvLyAgIGNhc2UgJ3VwbG9hZEFsbCc6XHJcbiAgICAgIC8vICAgICB0aGlzLnN1YnMucHVzaCh7IGlkczogaWRzLCBzdWI6IHN1YiwgaWQ6ICcnIH0pO1xyXG4gICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAgIC8vICAgY2FzZSAncmVtb3ZlQWxsJzpcclxuICAgICAgLy8gICAgIHRoaXMuc3Vicy5wdXNoKHsgaWRzOiBpZHMsIHN1Yjogc3ViLCBpZDogJycgfSk7XHJcbiAgICAgIC8vICAgICBicmVhaztcclxuICAgICAgLy8gICBkZWZhdWx0OlxyXG5cclxuICAgICAgLy8gfVxyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDljZXkuKrmlofku7bkuIrkvKBcclxuICAgKiBAcGFyYW0gZmlsZSBcclxuICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICovXHJcbiAgLy8gdXBsb2FkRmlsZShmaWxlOiBVcGxvYWRGaWxlLCBldmVudDogVXBsb2FkSW5wdXQpOiBPYnNlcnZhYmxlPFVwbG9hZE91dHB1dD4ge1xyXG4gIC8vICAgY29uc3QgdXBsb2FkRmlsZSA9IDxCbG9iRmlsZT5maWxlLm5hdGl2ZUZpbGU7XHJcbiAgLy8gICBjb25zdCB1cGxvYWRJbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KG91dEZpbGUgPT4gb3V0RmlsZS5uYXRpdmVGaWxlID09PSB1cGxvYWRGaWxlKTtcclxuXHJcbiAgLy8gICAvLyDlt7Lnu4/ooqvlj5bmtojnmoTkuI3og73ooqvkuIrkvKBcclxuICAvLyAgIGlmICh0aGlzLnF1ZXVlW3VwbG9hZEluZGV4XS5wcm9ncmVzcy5zdGF0dXMgPT09IFVwbG9hZFN0YXR1cy5DYW5jZWxsZWQpIHtcclxuICAvLyAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgIH1cclxuICAvLyAgIC8vIOaKm+WHuuW8gOWni+S4iuS8oOeahOS6i+S7tlxyXG4gIC8vICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiAnc3RhcnQnLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gIC8vICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmVyU2VyLnVwbG9hZChmaWxlLCBldmVudCwgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcpO1xyXG4gIC8vIH1cclxuICBtdWx0aXBhcnRVcGxvYWQoZmlsZTogVXBsb2FkRmlsZSwgZXZlbnQ6IFVwbG9hZElucHV0KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgIC8vIOaKm+WHuuW8gOWni+S4iuS8oOeahOS6i+S7tlxyXG4gICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiAnc3RhcnQnLCBmaWxlczogW2ZpbGVdIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmVyU2VyLm11bHRpcGFydFVwbG9hZChmaWxlLCBldmVudCwgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcpO1xyXG4gIH1cclxuICB1cGxvYWQoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAgIC8vIOaKm+WHuuW8gOWni+S4iuS8oOeahOS6i+S7tlxyXG4gICAgdGhpcy5zZXJ2aWNlRXZlbnRzLmVtaXQoeyB0eXBlOiAnc3RhcnQnLCBmaWxlczogZmlsZXMgfSk7XHJcbiAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIudXBsb2FkKGZpbGVzLCBldmVudCwgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlKGZpbGVzOiBVcGxvYWRGaWxlW10sIGV2ZW50OiBVcGxvYWRJbnB1dCk6IE9ic2VydmFibGU8VXBsb2FkT3V0cHV0PiB7XHJcbiAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2ZXJTZXIucmVtb3ZlKGZpbGVzLCBldmVudCwgdGhpcy5leHRlbmRTZXJ2ZXJDb25maWcpO1xyXG4gIH1cclxuICAvLyByZW1vdmVBbGwoZmlsZXM6IFVwbG9hZEZpbGVbXSwgZXZlbnQ6IFVwbG9hZElucHV0KTogT2JzZXJ2YWJsZTxVcGxvYWRPdXRwdXQ+IHtcclxuICAvLyAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZlclNlci5yZW1vdmVBbGwoZmlsZXMsIGV2ZW50LCB0aGlzLmV4dGVuZFNlcnZlckNvbmZpZyk7XHJcbiAgLy8gfVxyXG4gIC8vIOmHjee9rlxyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy5xdWV1ZSA9IFtdO1xyXG4gICAgLy90aGlzLnVwbG9hZFNjaGVkdWxlciA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICAvLyB0aGlzLnN1YnMuZm9yRWFjaChzdWIgPT4ge1xyXG4gICAgLy8gICBpZiAoc3ViLnN1Yikge1xyXG4gICAgLy8gICAgIHN1Yi5zdWIudW5zdWJzY3JpYmUoKTtcclxuICAgIC8vICAgfVxyXG4gICAgLy8gfSk7XHJcbiAgICB0aGlzLnN1YnMgPSBbXTtcclxuICB9XHJcblxyXG4gIC8vIOaaguaXtlxyXG4gIHNldENvbnRlbnRUeXBlcyhjb250ZW50VHlwZXM6IHN0cmluZ1tdKTogdm9pZCB7XHJcbiAgICBpZiAodHlwZW9mIGNvbnRlbnRUeXBlcyAhPT0gJ3VuZGVmaW5lZCcgJiYgY29udGVudFR5cGVzIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgaWYgKGNvbnRlbnRUeXBlcy5maW5kKCh0eXBlOiBzdHJpbmcpID0+IHR5cGUgPT09ICcqJykgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRoaXMuYWxsb3dlZENvbnRlbnRUeXBlcyA9IFsnKiddO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYWxsb3dlZENvbnRlbnRUeXBlcyA9IGNvbnRlbnRUeXBlcztcclxuICAgICAgfVxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmFsbG93ZWRDb250ZW50VHlwZXMgPSBbJyonXTtcclxuICB9XHJcblxyXG4gIGFsbENvbnRlbnRUeXBlc0FsbG93ZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5hbGxvd2VkQ29udGVudFR5cGVzLmZpbmQoKHR5cGU6IHN0cmluZykgPT4gdHlwZSA9PT0gJyonKSAhPT0gdW5kZWZpbmVkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBcclxuICAgKiBAcGFyYW0gbmFtZSBcclxuICAgKi9cclxuICBpc0NvbnRlbnRUeXBlQWxsb3dlZChuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLmFsbENvbnRlbnRUeXBlc0FsbG93ZWQoKSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIC8vIOmZhOS7tuayoeacieWQjue8gFxyXG4gICAgaWYgKG5hbWUubGFzdEluZGV4T2YoJy4nKSA8IDApIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgbGV0IG5hbWVzdWZmaXggPSBuYW1lLnN1YnN0cihuYW1lLmxhc3RJbmRleE9mKCcuJykpO1xyXG4gICAgLy8g566A5YyW6K6h566XXHJcbiAgICByZXR1cm4gdGhpcy5hbGxvd2VkQ29udGVudFR5cGVzLmZpbmRJbmRleChpdGVtID0+ICBpdGVtLnRvTG93ZXJDYXNlKCkgPT0gbmFtZXN1ZmZpeC50b0xvd2VyQ2FzZSgpKSA+IC0xO1xyXG4gIH1cclxuXHJcbiAgaXNGaWxlU2l6ZUFsbG93ZWQoZmlsZVNpemU6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLm1heEZpbGVTaXplKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8gZmlsZVNpemXmmK9i5Y2V5L2NIG1heEZpbGVTaXpl5pivTULljZXkvY1cclxuICAgIHJldHVybiBmaWxlU2l6ZSA8PSB0aGlzLm1heEZpbGVTaXplICogOCAqIDEwMjQgKiAxMDI0O1xyXG4gIH1cclxufVxyXG4iXX0=