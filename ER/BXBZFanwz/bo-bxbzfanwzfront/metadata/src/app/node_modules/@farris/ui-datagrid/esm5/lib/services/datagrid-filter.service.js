/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
import { Injectable, Injector, EventEmitter } from '@angular/core';
import { Compare } from '@farris/ui-common/types';
import { DatagridFacadeService } from './datagrid-facade.service';
import { Utils } from './../utils/utils';
import { ColumnFilterType } from '../types/data-column';
import { DatagridColumnsHelper } from './datagrid-columns.helper';
var DatagridFilterService = /** @class */ (function () {
    function DatagridFilterService(dfs, localeSer, inject) {
        this.dfs = dfs;
        this.localeSer = localeSer;
        this.inject = inject;
        this.removeField = new EventEmitter();
    }
    /**
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.validateRowData = /**
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        if (!conditions || Object.keys(conditions).length === 0) {
            return true;
        }
        return this.checkAllFieldInRowData(rowData, conditions);
    };
    /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.executeFilter = /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    function (data, conditions) {
        var _this = this;
        if (this.dfs.getState().enableSmartFilter) {
            return this.executeSmartFilter(data, conditions);
        }
        if (data && data.length) {
            return data.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.validateRowData(n, conditions); }));
        }
        return data;
    };
    /**
     * @private
     * @param {?} fieldDataValue
     * @param {?} operator
     * @param {?} targetValue
     * @return {?}
     */
    DatagridFilterService.prototype.getCompareResult = /**
     * @private
     * @param {?} fieldDataValue
     * @param {?} operator
     * @param {?} targetValue
     * @return {?}
     */
    function (fieldDataValue, operator, targetValue) {
        /** @type {?} */
        var op = parseInt('' + operator, 10);
        switch (op) {
            case Compare.Equal:
                return fieldDataValue == targetValue;
            case Compare.NotEqual:
                return ('' + fieldDataValue).toLowerCase() !== ('' + targetValue).toLowerCase();
            case Compare.Greater:
                return fieldDataValue > targetValue;
            case Compare.GreaterOrEqual:
                return fieldDataValue >= targetValue;
            case Compare.Less:
                return fieldDataValue < targetValue;
            case Compare.LessOrEqual:
                return fieldDataValue <= targetValue;
            case Compare.Like:
                return ('' + fieldDataValue).toLowerCase().indexOf(targetValue.toLowerCase()) > -1;
            case Compare.NotLike:
                return ('' + fieldDataValue).toLowerCase().indexOf(targetValue.toLowerCase()) === -1;
            case Compare.In:
                targetValue = targetValue || [];
                return targetValue.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n == fieldDataValue; })) > -1;
            case 1001: // Empty
                return fieldDataValue === '';
            case 1002: // NotEmpty
                return fieldDataValue !== '';
            case 1003: // Null
                return fieldDataValue === null;
            case 1004: // NotNull
                return fieldDataValue !== null;
        }
    };
    /**
     * @private
     * @param {?} result1
     * @param {?} relation
     * @param {?} result2
     * @return {?}
     */
    DatagridFilterService.prototype.getRelationResult = /**
     * @private
     * @param {?} result1
     * @param {?} relation
     * @param {?} result2
     * @return {?}
     */
    function (result1, relation, result2) {
        /** @type {?} */
        var _relation = relation.toLowerCase();
        if (_relation === 'and') {
            return result1 && result2;
        }
        else {
            return result1 || result2;
        }
    };
    /**
     * @private
     * @param {?} resultObj
     * @return {?}
     */
    DatagridFilterService.prototype.checkAllFieldResult = /**
     * @private
     * @param {?} resultObj
     * @return {?}
     */
    function (resultObj) {
        if (!resultObj) {
            return true;
        }
        return Object.values(resultObj).reduce((/**
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        function (c, n) {
            return c && n;
        }), true);
    };
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.checkAllFieldInRowData = /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        var _this = this;
        // this.state = conditions;
        /** @type {?} */
        var resultObj = null;
        if (conditions) {
            /** @type {?} */
            var fields = Object.keys(conditions);
            resultObj = {};
            fields.forEach((/**
             * @param {?} field
             * @return {?}
             */
            function (field) {
                /** @type {?} */
                var fieldValue = Utils.getValue(field, rowData);
                /** @type {?} */
                var columnObj = _this.dfs.getColumn(field);
                if (columnObj && columnObj.isMultilingualField) {
                    fieldValue = Utils.getMultilingualValue(fieldValue, _this.localeSer.localeId);
                }
                /** @type {?} */
                var where = conditions[field];
                var value1 = where.value1, operator1 = where.operator1, relation = where.relation, operator2 = where.operator2, value2 = where.value2;
                if (where) {
                    /** @type {?} */
                    var result = _this.getCompareResult(fieldValue, operator1, value1);
                    resultObj[field] = result;
                    if (relation) {
                        /** @type {?} */
                        var result2 = _this.getCompareResult(fieldValue, operator2, value2);
                        resultObj[field] = _this.getRelationResult(result, relation, result2);
                    }
                }
            }));
        }
        return this.checkAllFieldResult(resultObj);
    };
    /**
     * @param {?} field
     * @return {?}
     */
    DatagridFilterService.prototype.removeFilterField = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        this.removeField.emit(field);
    };
    /**
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.convertFilterCondition2String = /**
     * @param {?} conditions
     * @return {?}
     */
    function (conditions) {
        var _this = this;
        if (!conditions) {
            return '';
        }
        /** @type {?} */
        var str = '';
        /** @type {?} */
        var andText = this.localeSer.getValue('datagrid.filter.and');
        /** @type {?} */
        var orText = this.localeSer.getValue('datagrid.filter.or');
        /** @type {?} */
        var and = "<span class='badge badge-success'>" + andText + "</span>";
        /** @type {?} */
        var and2 = "<span class='badge badge-info'>" + andText + "</span>";
        /** @type {?} */
        var or = "<span class='badge badge-warning'>" + orText + "</span>";
        /** @type {?} */
        var lbracket = "<b>\u3014</b>";
        /** @type {?} */
        var rbracket = "<b>\u3015</b>";
        /** @type {?} */
        var ellipsis = "[ <span class=\"ellipsis\" title=\"$title$\">  $value$<i class=\"f-icon f-icon-lookup\"></i></span> ]";
        str = Object.keys(conditions).reduce((/**
         * @param {?} c
         * @param {?} r
         * @return {?}
         */
        function (c, r) {
            /** @type {?} */
            var filter = conditions[r];
            /** @type {?} */
            var col = _this.dfs.getColumn(r);
            /** @type {?} */
            var t = "<b>" + col.title + "</b>";
            /** @type {?} */
            var s = " " + t + " " + _this.getCompareString(filter.operator1) + " " + Utils.escapeValue(filter.value1) + "  ";
            if (filter.operator1 == Compare.In) {
                /** @type {?} */
                var txt = filter.value1;
                /** @type {?} */
                var txt2 = txt;
                if (col.filter.type === ColumnFilterType.enum) {
                    /** @type {?} */
                    var enumOpts = DatagridColumnsHelper.getFilterEnumOptions(col);
                    txt = DatagridColumnsHelper.getEnumText(enumOpts, filter.value1);
                    txt2 = txt.split(',').slice(0, 2).join(',');
                }
                else {
                    txt2 = txt.slice(0, 2).join(',');
                }
                s = " " + t + " " + _this.getCompareString(filter.operator1) + " [ " + txt + " ]  ";
                if (filter.value1.length > 2) {
                    s = " " + t + " " + _this.getCompareString(filter.operator1) + " " + ellipsis.replace('$title$', txt).replace('$value$', txt2) + "  ";
                }
            }
            else {
                if (filter.operator1 == Compare.Equal && Array.isArray(filter.value1)) {
                    if (!filter.value1.length) {
                        s = " " + t + " " + _this.getCompareString(filter.operator1) + " ''  ";
                    }
                }
            }
            if (filter.relation) {
                /** @type {?} */
                var s2 = t + " " + _this.getCompareString(filter.operator2) + " " + filter.value2;
                s = lbracket + " " + s + " " + (filter.relation === 'and' ? and2 : or) + " " + s2 + " " + rbracket;
            }
            return c + " <span class=\"filter-field filter-column-" + r + "\"> " + s + " AND </span>";
        }), '');
        /** @type {?} */
        var lastANDidx = str.lastIndexOf('AND');
        /** @type {?} */
        var resultStr = str.substr(0, lastANDidx);
        resultStr += str.substr(lastANDidx + 3);
        return resultStr.replace(/AND/g, and).replace(/OR/g, or);
    };
    /**
     * @private
     * @param {?} operator
     * @return {?}
     */
    DatagridFilterService.prototype.getCompareString = /**
     * @private
     * @param {?} operator
     * @return {?}
     */
    function (operator) {
        /** @type {?} */
        var op = parseInt('' + operator, 10);
        /** @type {?} */
        var code = '';
        switch (op) {
            case Compare.Equal:
            case Compare.NotEqual:
            case Compare.Greater:
            case Compare.GreaterOrEqual:
            case Compare.Less:
            case Compare.LessOrEqual:
            case Compare.Like:
            case Compare.NotLike:
            case Compare.In:
                code = Compare[op];
                code = code[0].toLowerCase() + code.substr(1);
                return this.localeSer.getValue('datagrid.filter.operators.' + code);
            case 1001: // Empty
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.empty');
            case 1002: // NotEmpty
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.notEmpty');
            case 1003: // Null
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.null');
            case 1004: // NotNull
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.notNull');
        }
    };
    /**
     * @param {?} condition
     * @return {?}
     */
    DatagridFilterService.prototype.convert2FilterArray = /**
     * @param {?} condition
     * @return {?}
     */
    function (condition) {
        /** @type {?} */
        var filterArr = [];
        if (condition) {
            /** @type {?} */
            var fields = Object.keys(condition);
            if (fields && fields.length) {
                fields.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                function (field) {
                    /** @type {?} */
                    var obj = { filterField: field, value: '', lbracket: '', rbracket: '', relation: 1, compare: 0 };
                    /** @type {?} */
                    var conditionVal = condition[field];
                    if (typeof conditionVal === 'object') {
                        obj.compare = conditionVal.operator1;
                        obj.value = conditionVal.value1;
                        filterArr.push(obj);
                        if (conditionVal.value2) {
                            obj.lbracket = '(';
                            obj.relation = conditionVal.relation === 'and' ? 1 : 2;
                            /** @type {?} */
                            var obj2 = { filterField: field, value: '', lbracket: '', rbracket: ')', relation: 1, compare: 0 };
                            obj2.compare = conditionVal.operator2;
                            obj2.value = conditionVal.value2;
                            filterArr.push(obj2);
                        }
                        else {
                            if (conditionVal.operator2) {
                                /** @type {?} */
                                var op2 = parseInt('' + conditionVal.operator2, 10);
                                if (op2 === 1001 || op2 === 1002) {
                                    obj.lbracket = '(';
                                    obj.relation = conditionVal.relation === 'and' ? 1 : 2;
                                    /** @type {?} */
                                    var obj2 = { filterField: field, value: '', lbracket: '', rbracket: ')', relation: 1, compare: 0 };
                                    obj2.compare = op2 === 1001 ? Compare.Equal : Compare.NotEqual;
                                    obj2.value = '';
                                    filterArr.push(obj2);
                                }
                            }
                        }
                    }
                    return obj;
                }));
            }
        }
        if (filterArr.length) {
            filterArr[filterArr.length - 1].relation = 0;
        }
        return filterArr;
    };
    /**
     * @param {?} col
     * @return {?}
     */
    DatagridFilterService.prototype.createColumnFilterOptions = /**
     * @param {?} col
     * @return {?}
     */
    function (col) {
        /** @type {?} */
        var filterTypeOptions = {
            type: ColumnFilterType.string,
            enableOperator: true
        };
        if (col.editor) {
            switch (col.editor.type) {
                case 'textarea':
                case 'textbox':
                case 'language-textbox':
                    filterTypeOptions = {
                        type: ColumnFilterType.string,
                        enableOperator: true
                    };
                    break;
                case 'checkbox':
                case 'switch':
                    filterTypeOptions = {
                        type: ColumnFilterType.boolean,
                        enableOperator: false
                    };
                    break;
                case 'numberbox':
                    filterTypeOptions = {
                        type: ColumnFilterType.number,
                        enableOperator: true
                    };
                    break;
                case 'combolist':
                case 'select':
                    filterTypeOptions = {
                        type: ColumnFilterType.enum,
                        enableOperator: true,
                        options: col.editor.options
                    };
                    break;
                case 'datepicker':
                    filterTypeOptions = {
                        type: col['dataType'] === 'datetime' ? ColumnFilterType.datetime : ColumnFilterType.date,
                        enableOperator: true,
                        options: {
                            dateFormat: col.editor.options.dateFormat,
                            returnFormat: col.editor.options.returnFormat
                        }
                    };
                    break;
                case 'timepicker':
                    filterTypeOptions = {
                        type: ColumnFilterType.time,
                        enableOperator: true
                    };
                    break;
            }
        }
        else if (col.formatter) {
            if (typeof col.formatter === 'object' && Object.keys(col.formatter).length) {
                /** @type {?} */
                var options = col.formatter['options'];
                switch (col.formatter['type']) {
                    case 'number':
                        filterTypeOptions = {
                            type: ColumnFilterType.number,
                            enableOperator: true
                        };
                        break;
                    case 'enum':
                        filterTypeOptions = {
                            type: ColumnFilterType.enum,
                            enableOperator: true,
                            options: options
                        };
                        break;
                    case 'boolean':
                        filterTypeOptions = {
                            type: ColumnFilterType.boolean,
                            enableOperator: false
                        };
                        break;
                    case 'datetime':
                        /** @type {?} */
                        var tye = ColumnFilterType.datetime;
                        /** @type {?} */
                        var fmt = 'yyyy-MM-dd';
                        /** @type {?} */
                        var returnFmt = 'yyyy-MM-dd';
                        if (options && options.format) {
                            fmt = options.format;
                            if (fmt.indexOf('HH:') == -1) {
                                tye = ColumnFilterType.date;
                            }
                            else {
                                returnFmt += ' HH:mm';
                                if (fmt.indexOf('ss') > -1) {
                                    returnFmt += ':ss';
                                }
                            }
                        }
                        else {
                            tye = ColumnFilterType.date;
                        }
                        filterTypeOptions = {
                            type: tye,
                            enableOperator: true
                        };
                        filterTypeOptions.options = { dateFormat: fmt, returnFormat: returnFmt };
                        break;
                    default:
                        filterTypeOptions = {
                            type: ColumnFilterType.string,
                            enableOperator: true
                        };
                }
            }
        }
        else {
            filterTypeOptions = {
                type: ColumnFilterType.string,
                enableOperator: true
            };
        }
        return filterTypeOptions;
    };
    //#region  Smart Filter
    //#region  Smart Filter
    /**
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.convertSmartFilter2EntityFilter = 
    //#region  Smart Filter
    /**
     * @param {?} conditions
     * @return {?}
     */
    function (conditions) {
        if (conditions && conditions.length) {
            return conditions.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return n;
            }));
        }
        return [];
    };
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.validateRowData2 = /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        if (!conditions || conditions.length === 0) {
            return true;
        }
        return this.checkRowDataWithCondition(rowData, conditions);
    };
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.checkRowDataWithCondition = /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        var _this = this;
        /** @type {?} */
        var resultObj = null;
        if (conditions) {
            resultObj = {};
            conditions.forEach((/**
             * @param {?} condition
             * @return {?}
             */
            function (condition) {
                /** @type {?} */
                var field = condition.FilterField;
                /** @type {?} */
                var fieldValue = Utils.getValue(field, rowData);
                /** @type {?} */
                var columnObj = _this.dfs.getColumn(field);
                if (columnObj && columnObj.isMultilingualField) {
                    fieldValue = Utils.getMultilingualValue(fieldValue, _this.localeSer.localeId);
                }
                /** @type {?} */
                var where = condition;
                var Value = where.Value, Relation = where.Relation, operator1 = where.Compare;
                if (where) {
                    /** @type {?} */
                    var r = _this.getCompareResult(fieldValue, operator1, Value);
                    if (resultObj[field] === undefined) {
                        resultObj[field] = [r];
                    }
                    else {
                        resultObj[field].push(r);
                    }
                }
            }));
        }
        // return this.checkAllFieldResult(resultObj);
        /** @type {?} */
        var fields = Object.keys(resultObj);
        /** @type {?} */
        var result = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            /** @type {?} */
            var _filters = conditions.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.FilterField === f; }));
            if (resultObj[f].length === 1) {
                result.push(resultObj[f][0]);
            }
            else {
                if (_filters[0].Relation === 1 && resultObj[f].length === 2) { // and
                    result.push(resultObj[f][0] && resultObj[f][1]);
                }
                else { // or
                    result.push(resultObj[f].indexOf(true) > -1);
                }
            }
        }));
        return result.indexOf(false) === -1;
    };
    /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.executeSmartFilter = /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    function (data, conditions) {
        var _this = this;
        if (data && data.length) {
            return data.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.validateRowData2(n, conditions); }));
        }
        return data;
    };
    DatagridFilterService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridFilterService.ctorParameters = function () { return [
        { type: DatagridFacadeService },
        { type: LocaleService },
        { type: Injector }
    ]; };
    return DatagridFilterService;
}());
export { DatagridFilterService };
if (false) {
    /** @type {?} */
    DatagridFilterService.prototype.removeField;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZmlsdGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWZpbHRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0seUJBQXlCLENBQUM7QUFDaEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ3pDLE9BQU8sRUFBYyxnQkFBZ0IsRUFBaUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNuRyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUVsRTtJQUlJLCtCQUFvQixHQUEwQixFQUFVLFNBQXdCLEVBQVUsTUFBZ0I7UUFBdEYsUUFBRyxHQUFILEdBQUcsQ0FBdUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVTtRQUYxRyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7SUFHekMsQ0FBQzs7Ozs7O0lBRUQsK0NBQWU7Ozs7O0lBQWYsVUFBZ0IsT0FBWSxFQUFFLFVBQWdEO1FBQzFFLElBQUksQ0FBQyxVQUFVLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3JELE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFDRCxPQUFPLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDNUQsQ0FBQzs7Ozs7O0lBRUQs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SUFFN0Isb0NBQWtDOzs7OztJQUFFLDBDQUFnQzs7Ozs7SUFBRSx1Q0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgRXZlbnRFbWl0dGVyLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb21wYXJlLCBFbnRpdHlGaWx0ZXIgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi90eXBlcyc7XHJcbmltcG9ydCB7IERhdGFncmlkRmFjYWRlU2VydmljZSB9IGZyb20gJy4vZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4vLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uLCBDb2x1bW5GaWx0ZXJUeXBlLCBDb2x1bW5GaWx0ZXIsIEZpbHRlckNvbmRpdGlvbiB9IGZyb20gJy4uL3R5cGVzL2RhdGEtY29sdW1uJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb2x1bW5zSGVscGVyIH0gZnJvbSAnLi9kYXRhZ3JpZC1jb2x1bW5zLmhlbHBlcic7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZEZpbHRlclNlcnZpY2Uge1xyXG4gICAgcmVtb3ZlRmllbGQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlLCBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSwgcHJpdmF0ZSBpbmplY3Q6IEluamVjdG9yKSB7XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVSb3dEYXRhKHJvd0RhdGE6IGFueSwgY29uZGl0aW9uczogeyBbZmllbGQ6IHN0cmluZ106IEZpbHRlckNvbmRpdGlvbiB9KSB7XHJcbiAgICAgICAgaWYgKCFjb25kaXRpb25zIHx8IE9iamVjdC5rZXlzKGNvbmRpdGlvbnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbGxGaWVsZEluUm93RGF0YShyb3dEYXRhLCBjb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBleGVjdXRlRmlsdGVyKGRhdGE6IFtdLCBjb25kaXRpb25zOiBhbnkpOiBhbnlbXSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLmRmcy5nZXRTdGF0ZSgpLmVuYWJsZVNtYXJ0RmlsdGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dGVTbWFydEZpbHRlcihkYXRhLCBjb25kaXRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmZpbHRlcihuID0+IHRoaXMudmFsaWRhdGVSb3dEYXRhKG4sIGNvbmRpdGlvbnMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb21wYXJlUmVzdWx0KGZpZWxkRGF0YVZhbHVlOiBhbnksIG9wZXJhdG9yOiBDb21wYXJlLCB0YXJnZXRWYWx1ZTogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgb3AgPSBwYXJzZUludCgnJyArIG9wZXJhdG9yLCAxMCk7XHJcbiAgICAgICAgc3dpdGNoIChvcCkge1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuRXF1YWw6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPT0gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RFcXVhbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJycgKyBmaWVsZERhdGFWYWx1ZSkudG9Mb3dlckNhc2UoKSAhPT0gKCcnICsgdGFyZ2V0VmFsdWUpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlID4gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyT3JFcXVhbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZERhdGFWYWx1ZSA+PSB0YXJnZXRWYWx1ZTtcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3M6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPCB0YXJnZXRWYWx1ZTtcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3NPckVxdWFsOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlIDw9IHRhcmdldFZhbHVlO1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuTGlrZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJycgKyBmaWVsZERhdGFWYWx1ZSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRhcmdldFZhbHVlLnRvTG93ZXJDYXNlKCkpID4gLTE7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RMaWtlOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgnJyArIGZpZWxkRGF0YVZhbHVlKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGFyZ2V0VmFsdWUudG9Mb3dlckNhc2UoKSkgPT09IC0xO1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuSW46XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRWYWx1ZSA9IHRhcmdldFZhbHVlIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFZhbHVlLmZpbmRJbmRleCggbiA9PiBuID09IGZpZWxkRGF0YVZhbHVlKSA+IC0xO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDE6IC8vIEVtcHR5XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPT09ICcnO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDI6ICAvLyBOb3RFbXB0eVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlICE9PSAnJztcclxuICAgICAgICAgICAgY2FzZSAxMDAzOiAvLyBOdWxsXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPT09IG51bGw7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwNDogLy8gTm90TnVsbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlICE9PSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFJlbGF0aW9uUmVzdWx0KHJlc3VsdDE6IGJvb2xlYW4sIHJlbGF0aW9uOiAnYW5kJyB8ICdvcicsIHJlc3VsdDI6IGJvb2xlYW4pIHtcclxuICAgICAgICBjb25zdCBfcmVsYXRpb24gPSByZWxhdGlvbi50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGlmIChfcmVsYXRpb24gPT09ICdhbmQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQxICYmIHJlc3VsdDI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDEgfHwgcmVzdWx0MjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0FsbEZpZWxkUmVzdWx0KHJlc3VsdE9iajogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH0pIHtcclxuICAgICAgICBpZiAoIXJlc3VsdE9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdE9iaikucmVkdWNlKChjLCBuKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBjICYmIG47XHJcbiAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0FsbEZpZWxkSW5Sb3dEYXRhKHJvd0RhdGE6IGFueSwgY29uZGl0aW9uczogeyBbZmllbGQ6IHN0cmluZ106IEZpbHRlckNvbmRpdGlvbiB9KSB7XHJcbiAgICAgICAgLy8gdGhpcy5zdGF0ZSA9IGNvbmRpdGlvbnM7XHJcbiAgICAgICAgbGV0IHJlc3VsdE9iaiA9IG51bGw7XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gT2JqZWN0LmtleXMoY29uZGl0aW9ucyk7XHJcbiAgICAgICAgICAgIHJlc3VsdE9iaiA9IHt9O1xyXG4gICAgICAgICAgICBmaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmllbGRWYWx1ZSA9IFV0aWxzLmdldFZhbHVlKGZpZWxkLCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbk9iaiA9IHRoaXMuZGZzLmdldENvbHVtbihmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uT2JqICYmIGNvbHVtbk9iai5pc011bHRpbGluZ3VhbEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRWYWx1ZSA9IFV0aWxzLmdldE11bHRpbGluZ3VhbFZhbHVlKGZpZWxkVmFsdWUsIHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB3aGVyZSA9IGNvbmRpdGlvbnNbZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZTEsIG9wZXJhdG9yMSwgcmVsYXRpb24sIG9wZXJhdG9yMiwgdmFsdWUyIH0gPSB3aGVyZTtcclxuICAgICAgICAgICAgICAgIGlmICh3aGVyZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ2V0Q29tcGFyZVJlc3VsdChmaWVsZFZhbHVlLCBvcGVyYXRvcjEsIHZhbHVlMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqW2ZpZWxkXSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVsYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0MiA9IHRoaXMuZ2V0Q29tcGFyZVJlc3VsdChmaWVsZFZhbHVlLCBvcGVyYXRvcjIsIHZhbHVlMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9ialtmaWVsZF0gPSB0aGlzLmdldFJlbGF0aW9uUmVzdWx0KHJlc3VsdCwgcmVsYXRpb24sIHJlc3VsdDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbGxGaWVsZFJlc3VsdChyZXN1bHRPYmopO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUZpbHRlckZpZWxkKGZpZWxkKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVGaWVsZC5lbWl0KGZpZWxkKTtcclxuICAgIH1cclxuXHJcbiAgICBjb252ZXJ0RmlsdGVyQ29uZGl0aW9uMlN0cmluZyhjb25kaXRpb25zOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWNvbmRpdGlvbnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgc3RyID0gJyc7XHJcbiAgICAgICAgY29uc3QgYW5kVGV4dCA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5maWx0ZXIuYW5kJyk7XHJcbiAgICAgICAgY29uc3Qgb3JUZXh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5vcicpO1xyXG4gICAgICAgIGNvbnN0IGFuZCA9IGA8c3BhbiBjbGFzcz0nYmFkZ2UgYmFkZ2Utc3VjY2Vzcyc+JHthbmRUZXh0fTwvc3Bhbj5gO1xyXG4gICAgICAgIGNvbnN0IGFuZDIgPSBgPHNwYW4gY2xhc3M9J2JhZGdlIGJhZGdlLWluZm8nPiR7YW5kVGV4dH08L3NwYW4+YDtcclxuICAgICAgICBjb25zdCBvciA9IGA8c3BhbiBjbGFzcz0nYmFkZ2UgYmFkZ2Utd2FybmluZyc+JHtvclRleHR9PC9zcGFuPmA7XHJcbiAgICAgICAgY29uc3QgbGJyYWNrZXQgPSBgPGI+44CUPC9iPmA7XHJcbiAgICAgICAgY29uc3QgcmJyYWNrZXQgPSBgPGI+44CVPC9iPmA7XHJcbiAgICAgICAgY29uc3QgZWxsaXBzaXMgPSBgWyA8c3BhbiBjbGFzcz1cImVsbGlwc2lzXCIgdGl0bGU9XCIkdGl0bGUkXCI+ICAkdmFsdWUkPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT48L3NwYW4+IF1gO1xyXG5cclxuICAgICAgICBzdHIgPSBPYmplY3Qua2V5cyhjb25kaXRpb25zKS5yZWR1Y2UoKGMsIHIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gY29uZGl0aW9uc1tyXTtcclxuICAgICAgICAgICAgY29uc3QgY29sID0gdGhpcy5kZnMuZ2V0Q29sdW1uKHIpO1xyXG4gICAgICAgICAgICBjb25zdCB0ID0gYDxiPiR7Y29sLnRpdGxlfTwvYj5gO1xyXG5cclxuICAgICAgICAgICAgbGV0IHMgPSBgICR7dH0gJHt0aGlzLmdldENvbXBhcmVTdHJpbmcoZmlsdGVyLm9wZXJhdG9yMSl9ICR7VXRpbHMuZXNjYXBlVmFsdWUoZmlsdGVyLnZhbHVlMSl9ICBgO1xyXG4gICAgICAgICAgICBpZiAoZmlsdGVyLm9wZXJhdG9yMSA9PSBDb21wYXJlLkluKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdHh0ID0gZmlsdGVyLnZhbHVlMTtcclxuICAgICAgICAgICAgICAgIGxldCB0eHQyID0gdHh0O1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbC5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5lbnVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW51bU9wdHMgPSBEYXRhZ3JpZENvbHVtbnNIZWxwZXIuZ2V0RmlsdGVyRW51bU9wdGlvbnMoY29sKTtcclxuICAgICAgICAgICAgICAgICAgICB0eHQgPSBEYXRhZ3JpZENvbHVtbnNIZWxwZXIuZ2V0RW51bVRleHQoZW51bU9wdHMsIGZpbHRlci52YWx1ZTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHR4dDIgPSB0eHQuc3BsaXQoJywnKS5zbGljZSgwLCAyKS5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHR4dDIgPSB0eHQuc2xpY2UoMCwgMikuam9pbignLCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHMgPSBgICR7dH0gJHt0aGlzLmdldENvbXBhcmVTdHJpbmcoZmlsdGVyLm9wZXJhdG9yMSl9IFsgJHt0eHR9IF0gIGA7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyLnZhbHVlMS5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcyA9IGAgJHt0fSAke3RoaXMuZ2V0Q29tcGFyZVN0cmluZyhmaWx0ZXIub3BlcmF0b3IxKX0gJHtlbGxpcHNpcy5yZXBsYWNlKCckdGl0bGUkJywgdHh0KS5yZXBsYWNlKCckdmFsdWUkJywgdHh0Mil9ICBgO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlci5vcGVyYXRvcjEgPT0gQ29tcGFyZS5FcXVhbCAmJiBBcnJheS5pc0FycmF5KGZpbHRlci52YWx1ZTEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXIudmFsdWUxLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzID0gYCAke3R9ICR7dGhpcy5nZXRDb21wYXJlU3RyaW5nKGZpbHRlci5vcGVyYXRvcjEpfSAnJyAgYDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGZpbHRlci5yZWxhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgczIgPSBgJHt0fSAke3RoaXMuZ2V0Q29tcGFyZVN0cmluZyhmaWx0ZXIub3BlcmF0b3IyKX0gJHtmaWx0ZXIudmFsdWUyfWA7XHJcbiAgICAgICAgICAgICAgICBzID0gYCR7bGJyYWNrZXR9ICR7c30gJHtmaWx0ZXIucmVsYXRpb24gPT09ICdhbmQnID8gYW5kMiA6IG9yfSAke3MyfSAke3JicmFja2V0fWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGAke2N9IDxzcGFuIGNsYXNzPVwiZmlsdGVyLWZpZWxkIGZpbHRlci1jb2x1bW4tJHtyfVwiPiAke3N9IEFORCA8L3NwYW4+YDtcclxuICAgICAgICB9LCAnJyk7XHJcbiAgICAgICAgY29uc3QgbGFzdEFORGlkeCA9IHN0ci5sYXN0SW5kZXhPZignQU5EJyk7XHJcbiAgICAgICAgbGV0IHJlc3VsdFN0ciA9IHN0ci5zdWJzdHIoMCwgbGFzdEFORGlkeCk7XHJcbiAgICAgICAgcmVzdWx0U3RyICs9IHN0ci5zdWJzdHIobGFzdEFORGlkeCArIDMpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHRTdHIucmVwbGFjZSgvQU5EL2csIGFuZCkucmVwbGFjZSgvT1IvZywgb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q29tcGFyZVN0cmluZyhvcGVyYXRvcjogQ29tcGFyZSkge1xyXG4gICAgICAgIGNvbnN0IG9wID0gcGFyc2VJbnQoJycgKyBvcGVyYXRvciwgMTApO1xyXG4gICAgICAgIGxldCBjb2RlID0gJyc7XHJcbiAgICAgICAgc3dpdGNoIChvcCkge1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuRXF1YWw6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RFcXVhbDpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkdyZWF0ZXI6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyT3JFcXVhbDpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3M6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5MZXNzT3JFcXVhbDpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxpa2U6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RMaWtlOlxyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuSW46XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gQ29tcGFyZVtvcF07XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gY29kZVswXS50b0xvd2VyQ2FzZSgpICsgY29kZS5zdWJzdHIoMSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5vcGVyYXRvcnMuJyArIGNvZGUpO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDE6IC8vIEVtcHR5XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJyAnICsgdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5vcGVyYXRvcnMuZW1wdHknKTtcclxuICAgICAgICAgICAgY2FzZSAxMDAyOiAgLy8gTm90RW1wdHlcclxuICAgICAgICAgICAgICAgIHJldHVybiAnICcgKyB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm9wZXJhdG9ycy5ub3RFbXB0eScpO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDM6IC8vIE51bGxcclxuICAgICAgICAgICAgICAgIHJldHVybiAnICcgKyB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm9wZXJhdG9ycy5udWxsJyk7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwNDogLy8gTm90TnVsbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcgJyArIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5maWx0ZXIub3BlcmF0b3JzLm5vdE51bGwnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNvbnZlcnQyRmlsdGVyQXJyYXkoY29uZGl0aW9uOiB7IFtmaWVsZDogc3RyaW5nXTogYW55IH0pOiBFbnRpdHlGaWx0ZXJbXSB7XHJcbiAgICAgICAgY29uc3QgZmlsdGVyQXJyID0gW107XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBPYmplY3Qua2V5cyhjb25kaXRpb24pO1xyXG4gICAgICAgICAgICBpZiAoZmllbGRzICYmIGZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB7IGZpbHRlckZpZWxkOiBmaWVsZCwgdmFsdWU6ICcnLCBsYnJhY2tldDogJycsIHJicmFja2V0OiAnJywgcmVsYXRpb246IDEsIGNvbXBhcmU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb25WYWwgPSBjb25kaXRpb25bZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZGl0aW9uVmFsID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY29tcGFyZSA9IGNvbmRpdGlvblZhbC5vcGVyYXRvcjE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai52YWx1ZSA9IGNvbmRpdGlvblZhbC52YWx1ZTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckFyci5wdXNoKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kaXRpb25WYWwudmFsdWUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoubGJyYWNrZXQgPSAnKCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVsYXRpb24gPSBjb25kaXRpb25WYWwucmVsYXRpb24gPT09ICdhbmQnID8gMSA6IDI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqMiA9IHsgZmlsdGVyRmllbGQ6IGZpZWxkLCB2YWx1ZTogJycsIGxicmFja2V0OiAnJywgcmJyYWNrZXQ6ICcpJywgcmVsYXRpb246IDEsIGNvbXBhcmU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IGNvbmRpdGlvblZhbC5vcGVyYXRvcjI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnZhbHVlID0gY29uZGl0aW9uVmFsLnZhbHVlMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnIucHVzaChvYmoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kaXRpb25WYWwub3BlcmF0b3IyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3AyID0gcGFyc2VJbnQoJycgKyBjb25kaXRpb25WYWwub3BlcmF0b3IyLCAxMCk7IC8vICBFbXB0eTogMTAwMSwgTm90RW1wdHk6IDEwMDJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3AyID09PSAxMDAxIHx8IG9wMiA9PT0gMTAwMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoubGJyYWNrZXQgPSAnKCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWxhdGlvbiA9IGNvbmRpdGlvblZhbC5yZWxhdGlvbiA9PT0gJ2FuZCcgPyAxIDogMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iajIgPSB7IGZpbHRlckZpZWxkOiBmaWVsZCwgdmFsdWU6ICcnLCBsYnJhY2tldDogJycsIHJicmFja2V0OiAnKScsIHJlbGF0aW9uOiAxLCBjb21wYXJlOiAwIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IG9wMiA9PT0gMTAwMSA/IENvbXBhcmUuRXF1YWwgOiBDb21wYXJlLk5vdEVxdWFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnZhbHVlID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnIucHVzaChvYmoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZmlsdGVyQXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBmaWx0ZXJBcnJbZmlsdGVyQXJyLmxlbmd0aCAtIDFdLnJlbGF0aW9uID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmaWx0ZXJBcnI7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29sdW1uRmlsdGVyT3B0aW9ucyhjb2w6IERhdGFDb2x1bW4pIHtcclxuICAgICAgICBsZXQgZmlsdGVyVHlwZU9wdGlvbnM6IENvbHVtbkZpbHRlciA9IHtcclxuICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmcsXHJcbiAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoY29sLmVkaXRvcikge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGNvbC5lZGl0b3IudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAndGV4dGFyZWEnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAndGV4dGJveCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdsYW5ndWFnZS10ZXh0Ym94JzpcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3N3aXRjaCc6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuYm9vbGVhbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcmJveCc6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUubnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb21ib2xpc3QnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnc2VsZWN0JzpcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5lbnVtLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogY29sLmVkaXRvci5vcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGVwaWNrZXInOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBjb2xbJ2RhdGFUeXBlJ10gPT09ICdkYXRldGltZScgPyBDb2x1bW5GaWx0ZXJUeXBlLmRhdGV0aW1lIDogQ29sdW1uRmlsdGVyVHlwZS5kYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUZvcm1hdDogY29sLmVkaXRvci5vcHRpb25zLmRhdGVGb3JtYXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5Gb3JtYXQ6IGNvbC5lZGl0b3Iub3B0aW9ucy5yZXR1cm5Gb3JtYXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICd0aW1lcGlja2VyJzpcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS50aW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChjb2wuZm9ybWF0dGVyKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29sLmZvcm1hdHRlciA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXMoY29sLmZvcm1hdHRlcikubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zOiBhbnkgPSBjb2wuZm9ybWF0dGVyWydvcHRpb25zJ107XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvbC5mb3JtYXR0ZXJbJ3R5cGUnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5udW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdlbnVtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLmVudW0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5ib29sZWFuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGV0aW1lJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHR5ZSA9IENvbHVtbkZpbHRlclR5cGUuZGF0ZXRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmbXQgPSAneXl5eS1NTS1kZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXR1cm5GbXQgPSAneXl5eS1NTS1kZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZm9ybWF0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbXQgPSBvcHRpb25zLmZvcm1hdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmbXQuaW5kZXhPZignSEg6JykgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eWUgPSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkZtdCArPSAnIEhIOm1tJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm10LmluZGV4T2YoJ3NzJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5GbXQgKz0gJzpzcyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHllID0gQ29sdW1uRmlsdGVyVHlwZS5kYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHllLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zLm9wdGlvbnMgPSB7IGRhdGVGb3JtYXQ6IGZtdCwgcmV0dXJuRm9ybWF0OiByZXR1cm5GbXQgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLnN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZpbHRlclR5cGVPcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI3JlZ2lvbiAgU21hcnQgRmlsdGVyXHJcblxyXG4gICAgY29udmVydFNtYXJ0RmlsdGVyMkVudGl0eUZpbHRlcihjb25kaXRpb25zOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChjb25kaXRpb25zICYmIGNvbmRpdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb25kaXRpb25zLm1hcChuID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHZhbGlkYXRlUm93RGF0YTIocm93RGF0YTogYW55LCBjb25kaXRpb25zOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWNvbmRpdGlvbnMgfHwgY29uZGl0aW9ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrUm93RGF0YVdpdGhDb25kaXRpb24ocm93RGF0YSwgY29uZGl0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja1Jvd0RhdGFXaXRoQ29uZGl0aW9uKHJvd0RhdGE6IGFueSwgY29uZGl0aW9ucykge1xyXG4gICAgICAgIGxldCByZXN1bHRPYmogPSBudWxsO1xyXG4gICAgICAgIGlmIChjb25kaXRpb25zKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdE9iaiA9IHt9O1xyXG4gICAgICAgICAgICBjb25kaXRpb25zLmZvckVhY2goY29uZGl0aW9uID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gY29uZGl0aW9uLkZpbHRlckZpZWxkO1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpZWxkVmFsdWUgPSBVdGlscy5nZXRWYWx1ZShmaWVsZCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW5PYmogPSB0aGlzLmRmcy5nZXRDb2x1bW4oZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbHVtbk9iaiAmJiBjb2x1bW5PYmouaXNNdWx0aWxpbmd1YWxGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkVmFsdWUgPSBVdGlscy5nZXRNdWx0aWxpbmd1YWxWYWx1ZShmaWVsZFZhbHVlLCB0aGlzLmxvY2FsZVNlci5sb2NhbGVJZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3Qgd2hlcmUgPSBjb25kaXRpb247XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IFZhbHVlLCBSZWxhdGlvbiwgQ29tcGFyZTogb3BlcmF0b3IxIH0gPSB3aGVyZTtcclxuICAgICAgICAgICAgICAgIGlmICh3aGVyZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmdldENvbXBhcmVSZXN1bHQoZmllbGRWYWx1ZSwgb3BlcmF0b3IxLCBWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdE9ialtmaWVsZF0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRPYmpbZmllbGRdID0gWyByIF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqW2ZpZWxkXS5wdXNoKHIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gcmV0dXJuIHRoaXMuY2hlY2tBbGxGaWVsZFJlc3VsdChyZXN1bHRPYmopO1xyXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IE9iamVjdC5rZXlzKHJlc3VsdE9iaik7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICAgICAgZmllbGRzLmZvckVhY2goIChmKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9maWx0ZXJzID0gY29uZGl0aW9ucy5maWx0ZXIobiA9PiBuLkZpbHRlckZpZWxkID09PSBmKTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdE9ialtmXS5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJlc3VsdE9ialtmXVswXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2ZpbHRlcnNbMF0uUmVsYXRpb24gPT09IDEgJiYgcmVzdWx0T2JqW2ZdLmxlbmd0aCA9PT0gMikgeyAgLy8gYW5kXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocmVzdWx0T2JqW2ZdWzBdICYmIHJlc3VsdE9ialtmXVsxXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAgLy8gb3JcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZXN1bHRPYmpbZl0uaW5kZXhPZih0cnVlKSA+IC0xKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0LmluZGV4T2YoZmFsc2UpID09PSAtMTtcclxuICAgIH1cclxuXHJcbiAgICBleGVjdXRlU21hcnRGaWx0ZXIoZGF0YTogW10sIGNvbmRpdGlvbnM6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEuZmlsdGVyKG4gPT4gdGhpcy52YWxpZGF0ZVJvd0RhdGEyKG4sIGNvbmRpdGlvbnMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcbn1cclxuIl19