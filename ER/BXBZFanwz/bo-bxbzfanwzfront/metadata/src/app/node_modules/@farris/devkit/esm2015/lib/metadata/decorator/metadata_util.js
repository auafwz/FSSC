import { ANNOTATIONS, PROP_METADATA } from './decorator';
//import { Cacheable, DefaultCacheProvider } from '../../cache';
/**
 * 元数据解析
 * 约束：
 * 1、类型装饰器：在某个类型上，某种类型的装饰器，只使用一次，不重复添加；
 * 2、属性装饰器：在某个属性上，某种类型的装饰器，只使用一次，不重复添加
 */
class MetadataUtil {
    // ----------------------------------------
    // 类型元数据
    // ----------------------------------------
    /**
     * 获取类元数据
     * 返回结果形如：
     * [
     *   Injectable
     *   NgViewModel
     *   NgViewModel
     * ]
     */
    static getClassMetadatas(constructor) {
        const metadatas = constructor[ANNOTATIONS];
        return metadatas;
    }
    /**
     * 获取某个class上的某种装饰器
     * 返回结果：NgViewModel
     */
    static getClassMetadataByName(constructor, metadataName) {
        const metadata = this.getClassMetadataByNameWithTranslate(constructor, metadataName, null, null);
        return metadata;
    }
    static getClassMetadataByNameWithTranslate(constructor, metadataName, translateService, keysToTranslate) {
        const allClassMetadatas = this.getClassMetadatas(constructor);
        if (!allClassMetadatas) {
            return null;
        }
        const metadata = allClassMetadatas.find((classMetadata) => {
            return classMetadata.ngMetadataName === metadataName;
        });
        this.translateMetadataByName(metadata, translateService, keysToTranslate);
        return metadata;
    }
    // ----------------------------------------
    // 属性元数据
    // ----------------------------------------
    /**
     * 获取所有属性的所有元数据
     * 返回格式：
     * {
     *   propName1: [ NgDefaultValue, NgMaxLength, NgMinLength],
     *   propName2: [ NgDefaultValue, NgMaxLength, NgMinLength]
     * }
     */
    // @Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })
    static getPropsMetadatas(constructor) {
        const allPropMetadatas = constructor[PROP_METADATA];
        return allPropMetadatas;
    }
    /**
     * 获取所有属性的某一类型的元数据
     * 如果同一属性
     * 返回结果：
     * {
     *    propName1: NgDefaultValue,
     *    propName2: NgDefaultValue
     * }
     */
    // @Cache({ provider: new MemoryCacheProvider(new MetadataKeyCompare()), key: ((context: any, args: any[]) => { return { constructor: args[0], metadataName: args[1] } }) })
    static getPropsMetadatasByName(constructor, metadataName) {
        const metadatas = this.getPropsMetadatasByNameWithTranslate(constructor, metadataName);
        return metadatas;
    }
    static getPropsMetadatasByNameWithTranslate(constructor, metadataName, translateService, keysToTranslate) {
        const metadatas = {};
        // 读取构造函数中存储的类属性注解。
        const allPropMetadatas = this.getPropsMetadatas(constructor);
        if (!allPropMetadatas) {
            return metadatas;
        }
        // 遍历所有属性提取注解信息。
        Object.keys(allPropMetadatas).forEach((propName) => {
            // 提取当前属性注解对象
            const propMetadatas = allPropMetadatas[propName];
            // 提取指定类型的注解项
            const metadata = propMetadatas.find((propMetadata) => {
                return propMetadata.ngMetadataName === metadataName;
            });
            if (metadata) {
                metadatas[propName] = metadata;
            }
        });
        // 翻译指定属性的值
        this.translateMetadatasByName(metadatas, translateService, keysToTranslate);
        return metadatas;
    }
    static translateMetadatasByName(metadatas, translateService, keysToTranslate) {
        Object.keys(metadatas).forEach((propName) => {
            // 提取指定类型的注解项
            this.translateMetadataByName(metadatas[propName], translateService, keysToTranslate);
        });
        return metadatas;
    }
    static translateMetadataByName(metadata, translateService, keysToTranslate) {
        if (metadata && translateService && keysToTranslate) {
            keysToTranslate.forEach((metadataPropKey) => {
                const propertyVariable = metadata[metadataPropKey];
                if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {
                    const translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();
                    metadata[metadataPropKey] = translateService.transform(translateKey, null);
                }
            });
        }
        return metadata;
    }
    /**
     * 获取某个属性的所有元数据
     * 返回格式：[ NgDefaultValue, NgMaxLength, NgMinLength]
     */
    static getPropMetadatasByName(constructor, propName) {
        // 暂不实现
        return null;
    }
    /**
     * 获取某个属性的某种元数据
     * 返回格式：NgDefaultValue
     */
    static getPropMetadataByName(constructor, propName, metadataName) {
        // 暂不实现
        return null;
    }
}
export { MetadataUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGFfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL21ldGFkYXRhL2RlY29yYXRvci9tZXRhZGF0YV91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXpELGdFQUFnRTtBQUVoRTs7Ozs7R0FLRztBQUNILE1BQU0sWUFBWTtJQUVoQiwyQ0FBMkM7SUFDM0MsUUFBUTtJQUNSLDJDQUEyQztJQUUzQzs7Ozs7Ozs7T0FRRztJQUNILE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxXQUFnQjtRQUN2QyxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDM0MsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7T0FHRztJQUNILE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxXQUFnQixFQUFFLFlBQW9CO1FBQ2xFLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxXQUFXLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNqRyxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQsTUFBTSxDQUFDLG1DQUFtQyxDQUN4QyxXQUFnQixFQUFFLFlBQW9CLEVBQ3RDLGdCQUE0QixFQUFFLGVBQTBCO1FBQ3hELE1BQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxpQkFBaUIsRUFBRTtZQUN0QixPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsTUFBTSxRQUFRLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBa0IsRUFBRSxFQUFFO1lBQzdELE9BQU8sYUFBYSxDQUFDLGNBQWMsS0FBSyxZQUFZLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFDSCxJ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QUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDakYsUUFBUSxDQUFDLGVBQWUsQ0FBQyxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLENBQUM7aUJBQzVFO1lBQ0gsQ0FBQyxDQUFDLENBQUM7U0FDSjtRQUNELE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxNQUFNLENBQUMsc0JBQXNCLENBQUMsV0FBZ0IsRUFBRSxRQUFnQjtRQUM5RCxPQUFPO1FBQ1AsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLHFCQUFxQixDQUFDLFdBQWdCLEVBQUUsUUFBZ0IsRUFBRSxZQUFvQjtRQUNuRixPQUFPO1FBQ1AsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBT0Y7QUFFRCxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBTk5PVEFUSU9OUywgUFJPUF9NRVRBREFUQSB9IGZyb20gJy4vZGVjb3JhdG9yJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlIH0gZnJvbSAnLi4vLi4vaTE4bic7XHJcbi8vaW1wb3J0IHsgQ2FjaGVhYmxlLCBEZWZhdWx0Q2FjaGVQcm92aWRlciB9IGZyb20gJy4uLy4uL2NhY2hlJztcclxuXHJcbi8qKlxyXG4gKiDlhYPmlbDmja7op6PmnpBcclxuICog57qm5p2f77yaXHJcbiAqIDHjgIHnsbvlnovoo4XppbDlmajvvJrlnKjmn5DkuKrnsbvlnovkuIrvvIzmn5Dnp43nsbvlnovnmoToo4XppbDlmajvvIzlj6rkvb/nlKjkuIDmrKHvvIzkuI3ph43lpI3mt7vliqDvvJtcclxuICogMuOAgeWxnuaAp+ijhemlsOWZqO+8muWcqOafkOS4quWxnuaAp+S4iu+8jOafkOenjeexu+Wei+eahOijhemlsOWZqO+8jOWPquS9v+eUqOS4gOasoe+8jOS4jemHjeWkjea3u+WKoFxyXG4gKi9cclxuY2xhc3MgTWV0YWRhdGFVdGlsIHtcclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vIOexu+Wei+WFg+aVsOaNrlxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W57G75YWD5pWw5o2uXHJcbiAgICog6L+U5Zue57uT5p6c5b2i5aaC77yaXHJcbiAgICogW1xyXG4gICAqICAgSW5qZWN0YWJsZVxyXG4gICAqICAgTmdWaWV3TW9kZWxcclxuICAgKiAgIE5nVmlld01vZGVsXHJcbiAgICogXVxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRDbGFzc01ldGFkYXRhcyhjb25zdHJ1Y3RvcjogYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgbWV0YWRhdGFzID0gY29uc3RydWN0b3JbQU5OT1RBVElPTlNdO1xyXG4gICAgcmV0dXJuIG1ldGFkYXRhcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluafkOS4qmNsYXNz5LiK55qE5p+Q56eN6KOF6aWw5ZmoXHJcbiAgICog6L+U5Zue57uT5p6c77yaTmdWaWV3TW9kZWxcclxuICAgKi9cclxuICBzdGF0aWMgZ2V0Q2xhc3NNZXRhZGF0YUJ5TmFtZShjb25zdHJ1Y3RvcjogYW55LCBtZXRhZGF0YU5hbWU6IHN0cmluZyk6IGFueSB7XHJcbiAgICBjb25zdCBtZXRhZGF0YSA9IHRoaXMuZ2V0Q2xhc3NNZXRhZGF0YUJ5TmFtZVdpdGhUcmFuc2xhdGUoY29uc3RydWN0b3IsIG1ldGFkYXRhTmFtZSwgbnVsbCwgbnVsbCk7XHJcbiAgICByZXR1cm4gbWV0YWRhdGE7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0Q2xhc3NNZXRhZGF0YUJ5TmFtZVdpdGhUcmFuc2xhdGUoXHJcbiAgICBjb25zdHJ1Y3RvcjogYW55LCBtZXRhZGF0YU5hbWU6IHN0cmluZyxcclxuICAgIHRyYW5zbGF0ZVNlcnZpY2U/OiBUcmFuc2xhdGUsIGtleXNUb1RyYW5zbGF0ZT86IHN0cmluZ1tdKTogYW55IHtcclxuICAgIGNvbnN0IGFsbENsYXNzTWV0YWRhdGFzID0gdGhpcy5nZXRDbGFzc01ldGFkYXRhcyhjb25zdHJ1Y3Rvcik7XHJcbiAgICBpZiAoIWFsbENsYXNzTWV0YWRhdGFzKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWV0YWRhdGEgPSBhbGxDbGFzc01ldGFkYXRhcy5maW5kKChjbGFzc01ldGFkYXRhOiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIGNsYXNzTWV0YWRhdGEubmdNZXRhZGF0YU5hbWUgPT09IG1ldGFkYXRhTmFtZTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy50cmFuc2xhdGVNZXRhZGF0YUJ5TmFtZShtZXRhZGF0YSwgdHJhbnNsYXRlU2VydmljZSwga2V5c1RvVHJhbnNsYXRlKTtcclxuICAgIHJldHVybiBtZXRhZGF0YTtcclxuICB9XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvLyDlsZ7mgKflhYPmlbDmja5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaJgOacieWxnuaAp+eahOaJgOacieWFg+aVsOaNrlxyXG4gICAqIOi/lOWbnuagvOW8j++8mlxyXG4gICAqIHtcclxuICAgKiAgIHByb3BOYW1lMTogWyBOZ0RlZmF1bHRWYWx1ZSwgTmdNYXhMZW5ndGgsIE5nTWluTGVuZ3RoXSxcclxuICAgKiAgIHByb3BOYW1lMjogWyBOZ0RlZmF1bHRWYWx1ZSwgTmdNYXhMZW5ndGgsIE5nTWluTGVuZ3RoXVxyXG4gICAqIH1cclxuICAgKi9cclxuICAgLy8gQENhY2hlYWJsZSh7IGtleTogKChjb250ZXh0OiBhbnksIGFyZ3M6IGFueVtdKSA9PiBhcmdzWzBdKSwgcHJvdmlkZXI6IG5ldyBEZWZhdWx0Q2FjaGVQcm92aWRlcigpIH0pXHJcbiAgc3RhdGljIGdldFByb3BzTWV0YWRhdGFzKGNvbnN0cnVjdG9yOiBhbnkpOiBhbnkge1xyXG4gICAgY29uc3QgYWxsUHJvcE1ldGFkYXRhcyA9IGNvbnN0cnVjdG9yW1BST1BfTUVUQURBVEFdO1xyXG4gICAgcmV0dXJuIGFsbFByb3BNZXRhZGF0YXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmiYDmnInlsZ7mgKfnmoTmn5DkuIDnsbvlnovnmoTlhYPmlbDmja5cclxuICAgKiDlpoLmnpzlkIzkuIDlsZ7mgKdcclxuICAgKiDov5Tlm57nu5PmnpzvvJpcclxuICAgKiB7XHJcbiAgICogICAgcHJvcE5hbWUxOiBOZ0RlZmF1bHRWYWx1ZSxcclxuICAgKiAgICBwcm9wTmFtZTI6IE5nRGVmYXVsdFZhbHVlXHJcbiAgICogfVxyXG4gICAqL1xyXG4gIC8vIEBDYWNoZSh7IHByb3ZpZGVyOiBuZXcgTWVtb3J5Q2FjaGVQcm92aWRlcihuZXcgTWV0YWRhdGFLZXlDb21wYXJlKCkpLCBrZXk6ICgoY29udGV4dDogYW55LCBhcmdzOiBhbnlbXSkgPT4geyByZXR1cm4geyBjb25zdHJ1Y3RvcjogYXJnc1swXSwgbWV0YWRhdGFOYW1lOiBhcmdzWzFdIH0gfSkgfSlcclxuICBzdGF0aWMgZ2V0UHJvcHNNZXRhZGF0YXNCeU5hbWUoY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcpOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgY29uc3QgbWV0YWRhdGFzID0gdGhpcy5nZXRQcm9wc01ldGFkYXRhc0J5TmFtZVdpdGhUcmFuc2xhdGUoY29uc3RydWN0b3IsIG1ldGFkYXRhTmFtZSk7XHJcbiAgICByZXR1cm4gbWV0YWRhdGFzO1xyXG4gIH1cclxuICBzdGF0aWMgZ2V0UHJvcHNNZXRhZGF0YXNCeU5hbWVXaXRoVHJhbnNsYXRlKFxyXG4gICAgY29uc3RydWN0b3I6IGFueSwgbWV0YWRhdGFOYW1lOiBzdHJpbmcsXHJcbiAgICB0cmFuc2xhdGVTZXJ2aWNlPzogVHJhbnNsYXRlLCBrZXlzVG9UcmFuc2xhdGU/OiBzdHJpbmdbXSk6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnkgfSB7XHJcbiAgICBjb25zdCBtZXRhZGF0YXMgPSB7fTtcclxuICAgIC8vIOivu+WPluaehOmAoOWHveaVsOS4reWtmOWCqOeahOexu+WxnuaAp+azqOino+OAglxyXG4gICAgY29uc3QgYWxsUHJvcE1ldGFkYXRhcyA9IHRoaXMuZ2V0UHJvcHNNZXRhZGF0YXMoY29uc3RydWN0b3IpO1xyXG4gICAgaWYgKCFhbGxQcm9wTWV0YWRhdGFzKSB7XHJcbiAgICAgIHJldHVybiBtZXRhZGF0YXM7XHJcbiAgICB9XHJcbiAgICAvLyDpgY3ljobmiYDmnInlsZ7mgKfmj5Dlj5bms6jop6Pkv6Hmga/jgIJcclxuICAgIE9iamVjdC5rZXlzKGFsbFByb3BNZXRhZGF0YXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgLy8g5o+Q5Y+W5b2T5YmN5bGe5oCn5rOo6Kej5a+56LGhXHJcbiAgICAgIGNvbnN0IHByb3BNZXRhZGF0YXM6IGFueVtdID0gYWxsUHJvcE1ldGFkYXRhc1twcm9wTmFtZV07XHJcbiAgICAgIC8vIOaPkOWPluaMh+Wumuexu+Wei+eahOazqOino+mhuVxyXG4gICAgICBjb25zdCBtZXRhZGF0YSA9IHByb3BNZXRhZGF0YXMuZmluZCgocHJvcE1ldGFkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gcHJvcE1ldGFkYXRhLm5nTWV0YWRhdGFOYW1lID09PSBtZXRhZGF0YU5hbWU7XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAobWV0YWRhdGEpIHtcclxuICAgICAgICBtZXRhZGF0YXNbcHJvcE5hbWVdID0gbWV0YWRhdGE7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8g57+76K+R5oyH5a6a5bGe5oCn55qE5YC8XHJcbiAgICB0aGlzLnRyYW5zbGF0ZU1ldGFkYXRhc0J5TmFtZShtZXRhZGF0YXMsIHRyYW5zbGF0ZVNlcnZpY2UsIGtleXNUb1RyYW5zbGF0ZSk7XHJcbiAgICByZXR1cm4gbWV0YWRhdGFzO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHRyYW5zbGF0ZU1ldGFkYXRhc0J5TmFtZShtZXRhZGF0YXM6IGFueSwgdHJhbnNsYXRlU2VydmljZT86IFRyYW5zbGF0ZSwga2V5c1RvVHJhbnNsYXRlPzogc3RyaW5nW10pXHJcbiAgICA6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnkgfSB7XHJcbiAgICBPYmplY3Qua2V5cyhtZXRhZGF0YXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgLy8g5o+Q5Y+W5oyH5a6a57G75Z6L55qE5rOo6Kej6aG5XHJcbiAgICAgIHRoaXMudHJhbnNsYXRlTWV0YWRhdGFCeU5hbWUobWV0YWRhdGFzW3Byb3BOYW1lXSwgdHJhbnNsYXRlU2VydmljZSwga2V5c1RvVHJhbnNsYXRlKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1ldGFkYXRhcztcclxuICB9XHJcblxyXG4gIHN0YXRpYyB0cmFuc2xhdGVNZXRhZGF0YUJ5TmFtZShtZXRhZGF0YTogYW55LCB0cmFuc2xhdGVTZXJ2aWNlPzogVHJhbnNsYXRlLCBrZXlzVG9UcmFuc2xhdGU/OiBzdHJpbmdbXSk6IGFueSB7XHJcbiAgICBpZiAobWV0YWRhdGEgJiYgdHJhbnNsYXRlU2VydmljZSAmJiBrZXlzVG9UcmFuc2xhdGUpIHtcclxuICAgICAga2V5c1RvVHJhbnNsYXRlLmZvckVhY2goKG1ldGFkYXRhUHJvcEtleSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5VmFyaWFibGU6IHN0cmluZyA9IG1ldGFkYXRhW21ldGFkYXRhUHJvcEtleV07XHJcbiAgICAgICAgaWYgKHByb3BlcnR5VmFyaWFibGUgJiYgcHJvcGVydHlWYXJpYWJsZS5zdGFydHNXaXRoKCd7eycpICYmIHByb3BlcnR5VmFyaWFibGUuZW5kc1dpdGgoJ319JykpIHtcclxuICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZUtleSA9IHByb3BlcnR5VmFyaWFibGUucmVwbGFjZSgne3snLCAnJykucmVwbGFjZSgnfX0nLCAnJykudHJpbSgpO1xyXG4gICAgICAgICAgbWV0YWRhdGFbbWV0YWRhdGFQcm9wS2V5XSA9IHRyYW5zbGF0ZVNlcnZpY2UudHJhbnNmb3JtKHRyYW5zbGF0ZUtleSwgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBtZXRhZGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluafkOS4quWxnuaAp+eahOaJgOacieWFg+aVsOaNrlxyXG4gICAqIOi/lOWbnuagvOW8j++8mlsgTmdEZWZhdWx0VmFsdWUsIE5nTWF4TGVuZ3RoLCBOZ01pbkxlbmd0aF1cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0UHJvcE1ldGFkYXRhc0J5TmFtZShjb25zdHJ1Y3RvcjogYW55LCBwcm9wTmFtZTogc3RyaW5nKTogYW55W10ge1xyXG4gICAgLy8g5pqC5LiN5a6e546wXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluafkOS4quWxnuaAp+eahOafkOenjeWFg+aVsOaNrlxyXG4gICAqIOi/lOWbnuagvOW8j++8mk5nRGVmYXVsdFZhbHVlXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByb3BNZXRhZGF0YUJ5TmFtZShjb25zdHJ1Y3RvcjogYW55LCBwcm9wTmFtZTogc3RyaW5nLCBtZXRhZGF0YU5hbWU6IHN0cmluZyk6IGFueSB7XHJcbiAgICAvLyDmmoLkuI3lrp7njrBcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvLyDlj4LmlbDlhYPmlbDmja5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBNZXRhZGF0YVV0aWwgfTtcclxuIl19