/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-19 15:48:27
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Directive, Input, ElementRef, Renderer2, ContentChild, Injector, forwardRef, Inject, NgZone } from '@angular/core';
import { filter, debounceTime } from 'rxjs/operators';
import { DatagridService } from './../../services/datagrid.service';
import { DatagridCellComponent } from './datagrid-cell.component';
import { DatagridBodyComponent } from './datagrid-body.component';
import { DatagridRowDirective } from './datagrid-row.directive';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { CELL_SELECTED_CLS, CELL_EDITING_CLS, ALLOW_EDIT_CELL_HIGHLIGHT_CLS } from '../../types/constant';
import { DomHandler } from '../../services/domhandler';
import { of } from 'rxjs';
import { Utils } from '../../utils/utils';
var DatagridCellEditableDirective = /** @class */ (function () {
    function DatagridCellEditableDirective(injector, el, render, dg, ngZone) {
        var _this = this;
        this.injector = injector;
        this.el = el;
        this.render = render;
        this.dg = dg;
        this.ngZone = ngZone;
        // private _readonly$ = null;
        this.cellEditorCreatedSubscription = null;
        this.cellEditorDestorySubscription = null;
        this.dgb = this.injector.get(DatagridBodyComponent);
        this.dr = this.injector.get(DatagridRowDirective);
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        if (!this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription = this.dgs.cellEditorCreated.pipe(filter((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var column = _a.column, editorRef = _a.editorRef, cellEditorRef = _a.cellEditorRef, templateRef = _a.templateRef;
                return column.field === _this.column.field && _this.dg.selectedRow.id === _this.dr.rowId;
            }))).subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var editorRef = _a.editorRef, cellEditorRef = _a.cellEditorRef, templateRef = _a.templateRef;
                // console.log('单元格编辑器创建OK', editorRef);
                if (editorRef) {
                    _this['editor'] = editorRef.instance;
                    _this['formControl'] = (/** @type {?} */ (_this.editor.formControl));
                    _this.cellEditorRef = cellEditorRef;
                    _this.emitBeginEdit();
                }
                else {
                    _this['formControl'] = (/** @type {?} */ (_this.dr.form.get(_this.column.field)));
                    _this.bindEditorInputEvent();
                    _this.dg.beginEdit.emit({ editor: null, column: _this.column, rowData: _this.rowData, gridInstance: _this.dg, template: templateRef });
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.setCellClsWithEditorType();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initCellEvent();
        this.setCellClsWithEditorType();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.initCellEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // this.cellclick = this.render.listen(this.el.nativeElement, 'click', (e) => this.onClickCell(e));
        if (this.column && (this.column.editor || this.column.editorTemplate)) {
            if (!this.dg.clickToEdit) {
                this.celldblclick = this.render.listen(this.el.nativeElement, 'dblclick', (/**
                 * @param {?} e
                 * @return {?}
                 */
                function (e) {
                    _this.onDblClickCell(e);
                }));
            }
            this.el.nativeElement.edit = (/**
             * @param {?} e
             * @return {?}
             */
            function (e) { return _this.onClickCell(e); });
            this.el.nativeElement.editCell = (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.openCellEditor();
            });
        }
        else {
            this.clickTimer = 0;
        }
        this.el.nativeElement.gridCellData = { rowData: this.rowData, rowIndex: this.dr.rowIndex };
        this.el.nativeElement.closeEdit = (/**
         * @return {?}
         */
        function () { return _this.closeEditingCell(); });
        this.el.nativeElement.selectCell = (/**
         * @param {?} e
         * @param {?} el
         * @return {?}
         */
        function (e, el) {
            if (_this.dg.disableRow && _this.dg.disableRow(_this.rowData, _this.dr.rowIndex)) {
                return;
            }
            if (_this.dg.currentCell && _this.dg.currentCell.cellElement.id === el.id && !_this.dg.keepSelect) {
                _this.dg.cancelSelectCell();
            }
            else {
                _this.selectCell(_this.column.field, el);
                _this.dg.cellClick.emit({ column: _this.column, rowData: _this.rowData, gridInstance: _this.dg, event: e });
            }
        });
        this.el.nativeElement.cancelSelected = (/**
         * @return {?}
         */
        function () {
            DomHandler.removeClass(_this.el.nativeElement, CELL_SELECTED_CLS);
            _this.render.removeClass(_this.el.nativeElement, CELL_EDITING_CLS);
        });
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.cellclick) {
            this.cellclick();
        }
        if (this.celldblclick) {
            this.celldblclick();
        }
        this.unBindEditorInputEvent();
        if (this.bindCellEventSubscription) {
            this.bindCellEventSubscription.unsubscribe();
            this.bindCellEventSubscription = null;
        }
        if (this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription.unsubscribe();
            this.cellEditorCreatedSubscription = null;
        }
        if (this.cellEditorDestorySubscription) {
            this.cellEditorDestorySubscription.unsubscribe();
            this.cellEditorDestorySubscription = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.isDifferentCell = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.dg.currentCell) {
            return true;
        }
        else {
            if (!this.dg.selectedRow || this.dg.selectedRow.index !== this.dr.rowIndex) {
                return true;
            }
            else {
                if (this.dr.rowIndex !== this.dg.currentCell.rowIndex) {
                    return true;
                }
                else {
                    return this.dg.currentCell.field !== this.column.field;
                }
            }
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onClickCell = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        // 关闭其他Grid 的编辑器
        document.body.click();
        this.dg.beforeClickCell.emit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (this.dr.disabled) {
            return;
        }
        // 20210422
        // if (this.dg.closeOtherGridEditor) {
        //     document.body.click();
        // }
        if (this.dg.disabled) {
            return;
        }
        else {
            if (!this.dg.editable || this.isReadonly()) {
                if (this.dg.enableHighlightCell) {
                    event.stopPropagation();
                    this.dg.endEditing();
                    this.selectCell(this.column.field);
                }
                return;
            }
            else {
                if (this.dg.editMode === 'row') {
                    return;
                }
            }
        }
        if (this.dg.selectionMode === 'default' && event) {
            if (event.ctrlKey || event.shiftKey) {
                return;
            }
        }
        event.stopPropagation();
        if (event.target['nodeName'] === 'INPUT') {
            return;
        }
        if (this.dg.clickToEdit && !this.dg.dblclickRow.observers.length) {
            this.dg.clickDelay = 0;
        }
        this.render.addClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (!this.dg.isSingleClick && this.dg.editMode) {
            this.dg.isSingleClick = true;
            this.clickTimer = setTimeout((/**
             * @return {?}
             */
            function () {
                if (_this.dg.isSingleClick && _this.dg.editable && _this.dg.editMode === 'cell') {
                    _this.dg.isSingleClick = false;
                    clearTimeout(_this.clickTimer);
                    // if (!this.closeEditingCell()) {
                    //     return;
                    // }
                    _this.closeEditingCell().subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            if (_this.dg.clickToEdit) {
                                _this.openCellEditor();
                            }
                            else {
                                _this.selectCell(_this.column.field);
                            }
                            _this.render.removeClass(_this.dg.el.nativeElement, 'f-datagrid-unselect');
                            event.preventDefault();
                        }
                    }));
                }
            }), this.dg.clickDelay);
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onDblClickCell = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.dg.disabled || this.isReadonly()) {
            return;
        }
        if (event.target['nodeName'] === 'INPUT' || event.target['nodeName'] === 'TEXTAREA') {
            return;
        }
        if (this.dg.editable && this.dg.editMode === 'cell') {
            // if (!this.closeEditingCell()) {
            //     return;
            // }
            this.closeEditingCell().subscribe((/**
             * @param {?} f
             * @return {?}
             */
            function (f) {
                if (f) {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.openCellEditor();
                    }));
                }
            }));
        }
        if (this.clickTimer) {
            this.dg.isSingleClick = false;
            clearTimeout(this.clickTimer);
            this.clickTimer = null;
        }
    };
    /**
     * @param {?=} col
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.isReadonly = /**
     * @param {?=} col
     * @return {?}
     */
    function (col) {
        if (col === void 0) { col = this.column; }
        // 参与合并的单元格不允许编辑
        if (this.dg.mergeCell && this.dg.mergeFields.indexOf(col.field) > -1) {
            return true;
        }
        return this.getReadonlyValue(col);
    };
    /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.getReadonlyValue = /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    function (col) {
        if (col === void 0) { col = this.column; }
        if (col.readonly !== undefined) {
            if (typeof col.readonly === 'boolean') {
                return col.readonly;
            }
            else if (typeof col.readonly === 'function') {
                return col.readonly(this.rowData);
            }
        }
        return false;
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.openCellEditor = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if ((!this.column.editor && !this.column.editorTemplate) || !this.dg.editable || this.isReadonly()) {
            this.selectCell(this.column.field);
            return;
        }
        /** @type {?} */
        var beforeEditEvent = this.dg.beforeEdit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (!beforeEditEvent || !beforeEditEvent.subscribe) {
            console.warn('please return an Observable Type.');
            return;
        }
        if (this.dg.currentCell) {
            if (!this.dg.currentCell.cellRef || this.dg.currentCell.cellRef.column.field !== this.column.field) {
                this.dg.currentCell.cellRef = this.dc;
            }
        }
        beforeEditEvent.subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            if (flag) {
                if (_this.isDifferentCell()) {
                    _this.selectCell(_this.column.field);
                }
                _this.dfs.editCell();
                // this.emitBeginEdit();
            }
            else {
                _this.selectCell(_this.column.field);
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.emitBeginEdit = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var _cellEditorRef = this.cellEditorRef || this.dc.cellEditor;
        this.render.removeClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (this.dg.editMode === 'cell') {
            this.dg.selectedRow.editors = [this.editor];
            this.dg.currentCell.editor = this.editor;
            this.dg.currentCell.cellEditorRef = _cellEditorRef;
            this.bindEditorInputEvent();
            this.render.addClass(this.el.nativeElement, CELL_EDITING_CLS);
            // this.formControl.setValue(this.dc.value);
            this.dg.beginEdit.emit({ editor: _cellEditorRef, column: this.column, rowData: this.rowData, gridInstance: this.dg });
            if (this.column.editor.type === 'textarea' && this.column.editor.options && this.column.editor.options.editType === 'dialog') {
                this.editor.showDialog();
            }
        }
        if (this.dr && !this.dg.nowrap) {
            this.dr.updateRowHeight();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.closeEditingCell = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.dg.isCellEditing()) {
            return of(true);
        }
        /** @type {?} */
        var currentCell = null;
        /** @type {?} */
        var editor = null;
        if (this.dg.currentCell) {
            // this.dg.currentCell.isEditing = false;
            // this.dfs.getCurrentCell().isEditing = false;
            currentCell = (/** @type {?} */ (this.dg.currentCell.cellRef));
            if (currentCell) {
                if (!currentCell.isEditing) {
                    return of(true);
                }
                if (currentCell.cellEditor && currentCell.cellEditor.componentRef && !currentCell.column.editorTemplate) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    if (editor) {
                        // 执行blur 事件
                        if (editor.inputElement) {
                            /** @type {?} */
                            var domName = editor.inputElement.nodeName;
                            /** @type {?} */
                            var blurFn = editor.options && editor.options.onBlur;
                            if (blurFn) {
                                if ((domName === 'INPUT' || domName === 'TEXTAREA') && this.dg['focusElement'] === editor.inputElement) {
                                    blurFn({ editorRef: editor, rowData: currentCell.rowData });
                                }
                            }
                            if (editor.inputElement.blur) {
                                editor.inputElement.blur();
                            }
                            this.dg['focusElement'] = null;
                        }
                        if (editor.blur) {
                            editor.blur();
                        }
                        if (editor.pending) {
                            return of(false);
                        }
                        if (editor.formControl) {
                            if (editor.formControl.pending) {
                                return of(false);
                            }
                            if (editor.formControl && editor.formControl.invalid && !this.dg.endEditByInvalid) {
                                return of(false);
                            }
                        }
                        else {
                            return of(true);
                        }
                    }
                    else {
                        return of(true);
                    }
                }
            }
        }
        else {
            return of(true);
        }
        this.dg.isSingleClick = false;
        /** @type {?} */
        var _col_ = (editor || currentCell).column;
        /** @type {?} */
        var afterEditEvent = this.dg.afterEdit(currentCell.rowIndex, currentCell.rowData, _col_, editor);
        if (!afterEditEvent || !afterEditEvent.subscribe) {
            console.warn('please return an Observable Type.');
            return;
        }
        /** @type {?} */
        var cellEndEdit = of(undefined);
        afterEditEvent.subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        function (flag) {
            if (flag) {
                /** @type {?} */
                var val = currentCell.value;
                if (currentCell && currentCell.formControl && val !== currentCell.formControl.value) {
                    val = currentCell.formControl.value;
                    currentCell.isEditing = false;
                    currentCell.updateValue(val);
                }
                _this.dfs.endEditCell();
                _this.dgs.onEndCellEdit(_this.dfs.getCurrentCell());
                _this.unBindEditorInputEvent();
                // 移除编辑样式
                _this.render.removeClass(_this.el.nativeElement, CELL_EDITING_CLS);
                if (_this.dg.selectedRow) {
                    _this.dg.selectedRow.editors = [];
                }
                // this.dg.selectedRow.data = this.rowData;
                // 更新行样式或者单元格样式
                _this.dfs.rowUpdate$.next({ index: currentCell.rowIndex, data: currentCell.rowData, cellRef: currentCell });
                _this.dg.endEdit.emit({ rowIndex: currentCell.rowIndex, rowData: currentCell.rowData, column: _col_, value: val });
                // 更新footerData
                _this.dgs.refreshFooterData.emit();
                cellEndEdit = of(true);
                // 刷新行数据
                // this.dr.refresh();
                if (_this.dg.selectedRow && _this.dg.selectedRow.dr) {
                    _this.dg.selectedRow.dr.refresh();
                }
            }
            else {
                if (currentCell && currentCell.cellEditor) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    editor.inputElement.focus();
                    cellEndEdit = of(false);
                }
                else {
                    cellEndEdit = of(true);
                }
            }
        }));
        return cellEndEdit;
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.cancelCellEditing = /**
     * @return {?}
     */
    function () {
        if (this.dg.currentCell && this.dg.currentCell.isEditing && this.dg.selectedRow.index > -1) {
            this.dfs.resetRow(this.dg.selectedRow.id);
            this.dc.rowData = this.dg.selectedRow.data;
            this.formControl.reset(Utils.getValue(this.column.field, this.dc.rowData));
            this.closeEditingCell();
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.bindEditorInputEvent = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var ceRef = this.cellEditorRef || this.dc.cellEditor;
        /** @type {?} */
        var input = null;
        if (ceRef) {
            input = ceRef.componentRef.instance.inputElement;
        }
        else {
            if (this.column.editorTemplate) {
                input = this.dc.el.nativeElement.querySelector('input,textarea');
            }
        }
        if (input) {
            input.focus();
            if (this.dg.selectOnEditing && this.column.editorTemplate) {
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    if (input.select) {
                        input.select();
                    }
                }));
            }
            this.editorInputKeydownEvent = this.render.listen(input, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                _this.onKeyDownForInput(e);
            }));
        }
    };
    /**
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.unBindEditorInputEvent = /**
     * @return {?}
     */
    function () {
        if (this.editorInputKeydownEvent) {
            this.editorInputKeydownEvent();
            this.editorInputKeydownEvent = null;
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.onKeyDownForInput = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _this = this;
        /** @type {?} */
        var keyCode = e.keyCode;
        if (e.altKey || e.ctrlKey) {
            return;
        }
        if ((this.editor && this.editor.stopPropagation) || keyCode === 13 || this.column.editorTemplate) {
            e.stopPropagation();
        }
        switch (keyCode) {
            case 32: // SPACE
                if (this.column.editor.type === 'switch') {
                    e.preventDefault();
                    this.editor.instance.updateChecked(e, false);
                }
                break;
            case 13: // Enter
                this.closeEditingCell().pipe(debounceTime(100)).subscribe((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) {
                    if (f) {
                        /** @type {?} */
                        var enterParam = { gird: _this.dg, cell: _this.dg.currentCell, event: e };
                        if (_this.column.onEnterHandler) {
                            _this.column.onEnterHandler(enterParam);
                        }
                        else {
                            /** @type {?} */
                            var nextTd = _this.dg.currentCell.cellElement.nextElementSibling;
                            if (_this.dg.currentCell.lastRow && !nextTd) {
                                _this.dg.lastCellEnterHandle.emit(enterParam);
                            }
                        }
                    }
                }));
                break;
            case 27: // ESC
                this.cancelCellEditing();
                break;
            case 9: // Tab
                e.stopPropagation();
                this.dg.clickDelay = 0;
                if (e.shiftKey) {
                    this.closeEditingCell().subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.movePrevCellAndEdit();
                        }
                    }));
                }
                else {
                    this.closeEditingCell().subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) {
                        if (f) {
                            _this.moveNextCellAndEdit(e);
                        }
                    }));
                    e.preventDefault();
                }
                break;
        }
    };
    /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.selectCell = /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    function (field, tdElement) {
        this.closeEditingCell();
        tdElement = tdElement || this.el.nativeElement;
        this.clearCellSelectedClass();
        if (field !== this.dg.ControlPanelFeild) {
            this.render.addClass(tdElement, CELL_SELECTED_CLS);
        }
        // this.dr.drHover.setRowHoverCls(false);
        this.dfs.setCurrentCell(this.dr, field, tdElement, this.dc);
        this.moveScrollbar(tdElement);
    };
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.moveScrollbar = /**
     * @private
     * @param {?} td
     * @return {?}
     */
    function (td) {
        /** @type {?} */
        var tdPosLeft = td.offsetLeft + td.offsetWidth;
        /** @type {?} */
        var containerWidth = this.dg.width - this.dgb.columnsGroup.leftFixedWidth;
        /** @type {?} */
        var tdRect = td.getBoundingClientRect();
        /** @type {?} */
        var scrollContainer = this.dgb.ps.elementRef.nativeElement;
        /** @type {?} */
        var psContainer = scrollContainer.getBoundingClientRect();
        /** @type {?} */
        var scrollTop = scrollContainer.scrollTop;
        /** @type {?} */
        var scrollLeft = scrollContainer.scrollLeft;
        /** @type {?} */
        var scrollbarXLeft = this.dgb.ps.elementRef.nativeElement.scrollLeft;
        if (tdPosLeft > containerWidth) {
            /** @type {?} */
            var x = tdPosLeft - containerWidth + 2;
            if (x > scrollbarXLeft) {
                this.dgb.ps.scrollToX(x);
            }
        }
        else {
            if (tdRect.x < psContainer.x) {
                /** @type {?} */
                var x = scrollLeft - tdRect.x;
                this.dgb.ps.scrollToX(x);
            }
        }
        /** @type {?} */
        var tdPosTop = tdRect.top - psContainer.top + tdRect.height;
        if (tdPosTop > psContainer.height) {
            /** @type {?} */
            var y = tdPosTop - psContainer.height;
            this.dgb.ps.scrollToY(scrollTop + y);
        }
        else {
            if (tdRect.y < psContainer.y) {
                this.dgb.ps.scrollToY(scrollTop - (psContainer.y - tdRect.y));
            }
        }
    };
    /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.moveNextCellAndEdit = /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        var fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex + 1 < this.dgb.columnsGroup.normalColumns.length) {
            /** @type {?} */
            var nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex + 1];
            /** @type {?} */
            var nextTd = this.dg.currentCell.cellElement.nextElementSibling;
            if (nextColumn && ((!nextColumn.editor && !nextColumn.editorTemplate) || this.isReadonly(nextColumn))) {
                if (nextTd) {
                    nextTd.selectCell(event, nextTd);
                }
                return;
            }
            if (nextTd) {
                nextTd.focus();
                if (nextColumn.editor || nextColumn.editorTemplate) {
                    nextTd.editCell();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
        else {
            // next row's first cell to editing
            /** @type {?} */
            var nextTr = this.dg.currentCell.cellElement.parentElement.nextElementSibling;
            if (nextTr && nextTr.tagName === 'TR') {
                // nextTr.children.find(td => td.editCell).editCell();
                /** @type {?} */
                var firstEditor = false;
                /** @type {?} */
                var i = 0;
                while (!firstEditor) {
                    firstEditor = !!nextTr.children[i].editCell;
                    if (!firstEditor) {
                        i++;
                    }
                }
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                nextTr.children[i].editCell();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.movePrevCellAndEdit = /**
     * @private
     * @return {?}
     */
    function () {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        var fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex - 1 >= 0) {
            /** @type {?} */
            var nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex - 1];
            if (nextColumn && this.isReadonly(nextColumn)) {
                return;
            }
            /** @type {?} */
            var nextTd = this.dg.currentCell.cellElement.previousElementSibling;
            if (nextTd) {
                // this.selectCell(nextColumn.field, nextTd);
                nextTd.focus();
                if (nextColumn.editor) {
                    // this.dfs.editCell();
                    nextTd.click();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.clearCellSelectedClass = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.dg.currentCell) {
            DomHandler.removeClass(this.dg.currentCell.cellElement, CELL_SELECTED_CLS);
            this.render.removeClass(this.dg.currentCell.cellElement, CELL_EDITING_CLS);
            /** @type {?} */
            var selectedCell = this.dg.el.nativeElement.querySelectorAll('.' + CELL_SELECTED_CLS);
            if (selectedCell.length) {
                selectedCell.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    _this.render.removeClass(n, CELL_SELECTED_CLS);
                }));
            }
        }
        this.dg.removeCellSelectedCls();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.setCellClsWithEditorType = /**
     * @private
     * @return {?}
     */
    function () {
        // 设置当前选中单元格样式
        if (this.dg.currentCell && this.dg.enableHighlightCell) {
            if (this.dg.currentCell.field === this.column.field && this.dg.currentCell.rowId === this.rowData[this.dg.idField] && !this.dc.isEditing) {
                this.clearCellSelectedClass();
                this.render.addClass(this.el.nativeElement, CELL_SELECTED_CLS);
            }
        }
        if (!this.dg.enableEditCellStyle) {
            return;
        }
        /** @type {?} */
        var td = this.el.nativeElement;
        this.cleanOtherEditorIcon(td);
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if (!this.column.editor) {
            return;
        }
        if (this.isReadonly()) {
            return;
        }
        /** @type {?} */
        var editorType = this.column.editor.type;
        /** @type {?} */
        var cls = this.column.align === 'right' ? 'allow-edit-cell-left' : 'allow-edit-cell';
        this.render.addClass(td, cls);
        this.render.addClass(td, ALLOW_EDIT_CELL_HIGHLIGHT_CLS[editorType]);
    };
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    DatagridCellEditableDirective.prototype.cleanOtherEditorIcon = /**
     * @private
     * @param {?} td
     * @return {?}
     */
    function (td) {
        /** @type {?} */
        var values = Object.values(ALLOW_EDIT_CELL_HIGHLIGHT_CLS);
        values.forEach((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (td.className.indexOf(v) > -1) {
                td.className = td.className.replace('allow-edit-cell-left', '').replace('allow-edit-cell', '');
                td.className = td.className.replace(v, '');
            }
        }));
    };
    DatagridCellEditableDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[cell-editable]',
                    exportAs: 'cellEditable'
                },] }
    ];
    /** @nocollapse */
    DatagridCellEditableDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] },
        { type: NgZone }
    ]; };
    DatagridCellEditableDirective.propDecorators = {
        rowData: [{ type: Input, args: ['cell-editable',] }],
        column: [{ type: Input }],
        dc: [{ type: ContentChild, args: [DatagridCellComponent,] }]
    };
    return DatagridCellEditableDirective;
}());
export { DatagridCellEditableDirective };
if (false) {
    /** @type {?} */
    DatagridCellEditableDirective.prototype.rowData;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.column;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.clickTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.celldblclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.bindCellEventSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.editorInputKeydownEvent;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.editor;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.formControl;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.cellEditorRef;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dc;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgb;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dr;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorCreatedSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorDestorySubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.injector;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.render;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dg;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY2VsbC1lZGl0YWJsZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1jZWxsLWVkaXRhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFTQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFVLFlBQVksRUFBYSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBaUIsTUFBTSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV4TCxPQUFPLEVBQUUsTUFBTSxFQUE0QixZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFaEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLDZCQUE2QixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUcsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxFQUFFLEVBQThCLE1BQU0sTUFBTSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUUxQztJQTRDSSx1Q0FDWSxRQUFrQixFQUFTLEVBQWMsRUFBVSxNQUFpQixFQUN4QixFQUFx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IEJlaGF2aW9yU3ViamVjdCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG4vKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTA2IDA3OjQzOjA3XHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTExLTE5IDE1OjQ4OjI3XHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIE9uSW5pdCwgQ29udGVudENoaWxkLCBPbkRlc3Ryb3ksIEluamVjdG9yLCBmb3J3YXJkUmVmLCBJbmplY3QsIEFmdGVyVmlld0luaXQsIE5nWm9uZSwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgc3dpdGNoTWFwLCB0YWtlTGFzdCwgZGVib3VuY2VUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENlbGxDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLWNlbGwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93RGlyZWN0aXZlIH0gZnJvbSAnLi9kYXRhZ3JpZC1yb3cuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJy4vLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEZhY2FkZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ0VMTF9TRUxFQ1RFRF9DTFMsIENFTExfRURJVElOR19DTFMsIEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5pbXBvcnQgeyBEb21IYW5kbGVyIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZG9taGFuZGxlcic7XHJcbmltcG9ydCB7IG9mLCBTdWJzY3JpcHRpb24sIGJpbmRDYWxsYmFjayB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbY2VsbC1lZGl0YWJsZV0nLFxyXG4gICAgZXhwb3J0QXM6ICdjZWxsRWRpdGFibGUnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZENlbGxFZGl0YWJsZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQge1xyXG4gICAgQElucHV0KCdjZWxsLWVkaXRhYmxlJykgcm93RGF0YTogYW55O1xyXG4gICAgQElucHV0KCkgY29sdW1uOiBEYXRhQ29sdW1uO1xyXG5cclxuICAgIHByaXZhdGUgY2xpY2tUaW1lcjogYW55O1xyXG5cclxuICAgIHByaXZhdGUgY2VsbGNsaWNrOiBhbnk7XHJcbiAgICBwcml2YXRlIGNlbGxkYmxjbGljazogYW55O1xyXG4gICAgcHJpdmF0ZSBiaW5kQ2VsbEV2ZW50U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gICAgcHJpdmF0ZSBlZGl0b3JJbnB1dEtleWRvd25FdmVudDogYW55O1xyXG4gICAgZWRpdG9yOiBhbnk7XHJcbiAgICBmb3JtQ29udHJvbDogRm9ybUNvbnRyb2w7XHJcbiAgICBjZWxsRWRpdG9yUmVmOiBhbnk7XHJcbiAgICAvLyBnZXQgZWRpdG9yKCkge1xyXG4gICAgLy8gICAgIGlmICh0aGlzLmRjLmNlbGxFZGl0b3IpIHtcclxuICAgIC8vICAgICAgICAgY29uc3QgX2VkaXRvciA9IHRoaXMuZGMuY2VsbEVkaXRvci5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAvLyAgICAgICAgIHRoaXMuZGcucGVuZGluZyA9IF9lZGl0b3IucGVuZGluZztcclxuICAgIC8vICAgICAgICAgcmV0dXJuIF9lZGl0b3I7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICAgIHJldHVybiBudWxsO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIGdldCBmb3JtQ29udHJvbCgpIHtcclxuICAgIC8vICAgICBpZiAodGhpcy5lZGl0b3IpIHtcclxuICAgIC8vICAgICAgICAgcmV0dXJuIHRoaXMuZWRpdG9yLmZvcm1Db250cm9sIGFzIEZvcm1Db250cm9sO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vIH1cclxuXHJcbiAgICBAQ29udGVudENoaWxkKERhdGFncmlkQ2VsbENvbXBvbmVudCkgZGM6IERhdGFncmlkQ2VsbENvbXBvbmVudDtcclxuICAgIHByaXZhdGUgZGdiOiBEYXRhZ3JpZEJvZHlDb21wb25lbnQ7XHJcbiAgICBwcml2YXRlIGRyOiBEYXRhZ3JpZFJvd0RpcmVjdGl2ZTtcclxuICAgIHByaXZhdGUgZGZzOiBEYXRhZ3JpZEZhY2FkZVNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGRnczogRGF0YWdyaWRTZXJ2aWNlO1xyXG5cclxuICAgIC8vIHByaXZhdGUgX3JlYWRvbmx5JCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHByaXZhdGUgY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IERhdGFncmlkQ29tcG9uZW50KSkgcHVibGljIGRnOiBEYXRhZ3JpZENvbXBvbmVudCwgcHVibGljIG5nWm9uZTogTmdab25lKSB7XHJcbiAgICAgICAgdGhpcy5kZ2IgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZEJvZHlDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuZHIgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZFJvd0RpcmVjdGl2ZSk7XHJcbiAgICAgICAgdGhpcy5kZnMgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZEZhY2FkZVNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMuZGdzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRTZXJ2aWNlKTtcclxuXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uID0gdGhpcy5kZ3MuY2VsbEVkaXRvckNyZWF0ZWQucGlwZShcclxuICAgICAgICAgICAgICAgIGZpbHRlcigoeyBjb2x1bW4sIGVkaXRvclJlZiwgY2VsbEVkaXRvclJlZiwgdGVtcGxhdGVSZWYgfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2x1bW4uZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuaWQgPT09IHRoaXMuZHIucm93SWQ7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSgoeyBlZGl0b3JSZWYsIGNlbGxFZGl0b3JSZWYsIHRlbXBsYXRlUmVmIH0pID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfljZXlhYPmoLznvJbovpHlmajliJvlu7pPSycsIGVkaXRvclJlZik7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdG9yUmVmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1snZWRpdG9yJ10gPSBlZGl0b3JSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1snZm9ybUNvbnRyb2wnXSA9IHRoaXMuZWRpdG9yLmZvcm1Db250cm9sIGFzIEZvcm1Db250cm9sO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvclJlZiA9IGNlbGxFZGl0b3JSZWY7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0QmVnaW5FZGl0KCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXNbJ2Zvcm1Db250cm9sJ10gPSB0aGlzLmRyLmZvcm0uZ2V0KHRoaXMuY29sdW1uLmZpZWxkKSBhcyBGb3JtQ29udHJvbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRFZGl0b3JJbnB1dEV2ZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5iZWdpbkVkaXQuZW1pdCh7IGVkaXRvcjogbnVsbCwgY29sdW1uOiB0aGlzLmNvbHVtbiwgcm93RGF0YTogdGhpcy5yb3dEYXRhLCBncmlkSW5zdGFuY2U6IHRoaXMuZGcsIHRlbXBsYXRlOiB0ZW1wbGF0ZVJlZiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLnJvd0RhdGEgJiYgIWNoYW5nZXMucm93RGF0YS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDZWxsQ2xzV2l0aEVkaXRvclR5cGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdENlbGxFdmVudCgpO1xyXG4gICAgICAgIHRoaXMuc2V0Q2VsbENsc1dpdGhFZGl0b3JUeXBlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0Q2VsbEV2ZW50KCkge1xyXG4gICAgICAgIC8vIHRoaXMuY2VsbGNsaWNrID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgKGUpID0+IHRoaXMub25DbGlja0NlbGwoZSkpO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbiAmJiAodGhpcy5jb2x1bW4uZWRpdG9yIHx8IHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuY2xpY2tUb0VkaXQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2VsbGRibGNsaWNrID0gdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2RibGNsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRGJsQ2xpY2tDZWxsKGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXQgPSAoZSkgPT4gdGhpcy5vbkNsaWNrQ2VsbChlKTtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXRDZWxsID0gKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3BlbkNlbGxFZGl0b3IoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNsaWNrVGltZXIgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ3JpZENlbGxEYXRhID0geyByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4IH07XHJcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsb3NlRWRpdCA9ICgpID0+IHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpO1xyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5zZWxlY3RDZWxsID0gKGUsIGVsKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3cgJiYgdGhpcy5kZy5kaXNhYmxlUm93KHRoaXMucm93RGF0YSwgdGhpcy5kci5yb3dJbmRleCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5pZCA9PT0gZWwuaWQgJiYgIXRoaXMuZGcua2VlcFNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5jYW5jZWxTZWxlY3RDZWxsKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQsIGVsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2VsbENsaWNrLmVtaXQoeyBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZywgZXZlbnQ6IGUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jYW5jZWxTZWxlY3RlZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgRG9tSGFuZGxlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNlbGxjbGljaykge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxjbGljaygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbGRibGNsaWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbGRibGNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnVuQmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRDZWxsRXZlbnRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5iaW5kQ2VsbEV2ZW50U3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jZWxsRWRpdG9yRGVzdG9yeVN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JEZXN0b3J5U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0RpZmZlcmVudENlbGwoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5zZWxlY3RlZFJvdyB8fCB0aGlzLmRnLnNlbGVjdGVkUm93LmluZGV4ICE9PSB0aGlzLmRyLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRyLnJvd0luZGV4ICE9PSB0aGlzLmRnLmN1cnJlbnRDZWxsLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRnLmN1cnJlbnRDZWxsLmZpZWxkICE9PSB0aGlzLmNvbHVtbi5maWVsZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uQ2xpY2tDZWxsKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICAvLyDlhbPpl63lhbbku5ZHcmlkIOeahOe8lui+keWZqFxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xpY2soKTtcclxuXHJcbiAgICAgICAgdGhpcy5kZy5iZWZvcmVDbGlja0NlbGwuZW1pdCh7IHJvd0luZGV4OiB0aGlzLmRyLnJvd0luZGV4LCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGNvbHVtbjogdGhpcy5jb2x1bW4sIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZHIuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gMjAyMTA0MjJcclxuICAgICAgICAvLyBpZiAodGhpcy5kZy5jbG9zZU90aGVyR3JpZEVkaXRvcikge1xyXG4gICAgICAgIC8vICAgICBkb2N1bWVudC5ib2R5LmNsaWNrKCk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmVkaXRhYmxlIHx8IHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5lbmFibGVIaWdobGlnaHRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5lbmRFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmVkaXRNb2RlID09PSAncm93Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnICYmIGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Wydub2RlTmFtZSddID09PSAnSU5QVVQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5jbGlja1RvRWRpdCAmJiAhdGhpcy5kZy5kYmxjbGlja1Jvdy5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY2xpY2tEZWxheSA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC11bnNlbGVjdCcpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuaXNTaW5nbGVDbGljayAmJiB0aGlzLmRnLmVkaXRNb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuaXNTaW5nbGVDbGljayAmJiB0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNsaWNrVGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmICghdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5zdWJzY3JpYmUoKGY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuY2xpY2tUb0VkaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5DZWxsRWRpdG9yKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWRhdGFncmlkLXVuc2VsZWN0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuZGcuY2xpY2tEZWxheSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25EYmxDbGlja0NlbGwoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlZCB8fCB0aGlzLmlzUmVhZG9ubHkoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Wydub2RlTmFtZSddID09PSAnSU5QVVQnIHx8IGV2ZW50LnRhcmdldFsnbm9kZU5hbWUnXSA9PT0gJ1RFWFRBUkVBJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAvLyBpZiAoIXRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQ2VsbEVkaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tUaW1lcikge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmlzU2luZ2xlQ2xpY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY2xpY2tUaW1lcik7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlzUmVhZG9ubHkoY29sID0gdGhpcy5jb2x1bW4pIHtcclxuICAgICAgICAvLyDlj4LkuI7lkIjlubbnmoTljZXlhYPmoLzkuI3lhYHorrjnvJbovpFcclxuICAgICAgICBpZiAodGhpcy5kZy5tZXJnZUNlbGwgJiYgdGhpcy5kZy5tZXJnZUZpZWxkcy5pbmRleE9mKGNvbC5maWVsZCkgPiAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVhZG9ubHlWYWx1ZShjb2wpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmVhZG9ubHlWYWx1ZShjb2wgPSB0aGlzLmNvbHVtbikge1xyXG4gICAgICAgIGlmIChjb2wucmVhZG9ubHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5yZWFkb25seSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sLnJlYWRvbmx5O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb2wucmVhZG9ubHkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2wucmVhZG9ubHkodGhpcy5yb3dEYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbkNlbGxFZGl0b3IoKSB7XHJcbiAgICAgICAgLy8g5b2T5YmN6KGM56aB55So77yM5LiN5YWB6K6457yW6L6R44CCXHJcbiAgICAgICAgaWYgKHRoaXMuZHIuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCghdGhpcy5jb2x1bW4uZWRpdG9yICYmICF0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkgfHwgIXRoaXMuZGcuZWRpdGFibGUgfHwgdGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYmVmb3JlRWRpdEV2ZW50ID0gdGhpcy5kZy5iZWZvcmVFZGl0KHsgcm93SW5kZXg6IHRoaXMuZHIucm93SW5kZXgsIHJvd0RhdGE6IHRoaXMucm93RGF0YSwgY29sdW1uOiB0aGlzLmNvbHVtbiwgZ3JpZEluc3RhbmNlOiB0aGlzLmRnIH0pO1xyXG4gICAgICAgIGlmICghYmVmb3JlRWRpdEV2ZW50IHx8ICFiZWZvcmVFZGl0RXZlbnQuc3Vic2NyaWJlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybigncGxlYXNlIHJldHVybiBhbiBPYnNlcnZhYmxlIFR5cGUuJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsUmVmIHx8IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbFJlZi5jb2x1bW4uZmllbGQgIT09IHRoaXMuY29sdW1uLmZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYgPSB0aGlzLmRjO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgYmVmb3JlRWRpdEV2ZW50LnN1YnNjcmliZSgoZmxhZykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNEaWZmZXJlbnRDZWxsKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGZzLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmVtaXRCZWdpbkVkaXQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGVtaXRCZWdpbkVkaXQoKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IF9jZWxsRWRpdG9yUmVmID0gdGhpcy5jZWxsRWRpdG9yUmVmIHx8IHRoaXMuZGMuY2VsbEVkaXRvcjtcclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC11bnNlbGVjdCcpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5lZGl0TW9kZSA9PT0gJ2NlbGwnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZWRpdG9ycyA9IFt0aGlzLmVkaXRvcl07XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY3VycmVudENlbGwuZWRpdG9yID0gdGhpcy5lZGl0b3I7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVkaXRvclJlZiA9IF9jZWxsRWRpdG9yUmVmO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRFZGl0b3JJbnB1dEV2ZW50KCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfRURJVElOR19DTFMpO1xyXG5cclxuICAgICAgICAgICAgLy8gdGhpcy5mb3JtQ29udHJvbC5zZXRWYWx1ZSh0aGlzLmRjLnZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5kZy5iZWdpbkVkaXQuZW1pdCh7IGVkaXRvcjogX2NlbGxFZGl0b3JSZWYsIGNvbHVtbjogdGhpcy5jb2x1bW4sIHJvd0RhdGE6IHRoaXMucm93RGF0YSwgZ3JpZEluc3RhbmNlOiB0aGlzLmRnIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvci50eXBlID09PSAndGV4dGFyZWEnICYmIHRoaXMuY29sdW1uLmVkaXRvci5vcHRpb25zICYmIHRoaXMuY29sdW1uLmVkaXRvci5vcHRpb25zLmVkaXRUeXBlID09PSAnZGlhbG9nJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lZGl0b3Iuc2hvd0RpYWxvZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kciAmJiAhdGhpcy5kZy5ub3dyYXApIHtcclxuICAgICAgICAgICAgdGhpcy5kci51cGRhdGVSb3dIZWlnaHQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2VFZGl0aW5nQ2VsbCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcuaXNDZWxsRWRpdGluZygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjdXJyZW50Q2VsbCA9IG51bGw7XHJcbiAgICAgICAgbGV0IGVkaXRvcjogYW55ID0gbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRnLmN1cnJlbnRDZWxsLmlzRWRpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRmcy5nZXRDdXJyZW50Q2VsbCgpLmlzRWRpdGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgY3VycmVudENlbGwgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYgYXMgRGF0YWdyaWRDZWxsQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudENlbGwuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2VsbC5jZWxsRWRpdG9yICYmIGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmICYmICFjdXJyZW50Q2VsbC5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IgPSBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmiafooYxibHVyIOS6i+S7tlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmlucHV0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZG9tTmFtZSA9IGVkaXRvci5pbnB1dEVsZW1lbnQubm9kZU5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibHVyRm4gPSAgZWRpdG9yLm9wdGlvbnMgJiYgZWRpdG9yLm9wdGlvbnMub25CbHVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsdXJGbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZG9tTmFtZSA9PT0gJ0lOUFVUJyB8fCBkb21OYW1lID09PSAnVEVYVEFSRUEnKSAmJiAgdGhpcy5kZ1snZm9jdXNFbGVtZW50J10gPT09IGVkaXRvci5pbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ckZuKHsgZWRpdG9yUmVmOiBlZGl0b3IsIHJvd0RhdGE6IGN1cnJlbnRDZWxsLnJvd0RhdGF9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmlucHV0RWxlbWVudC5ibHVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmlucHV0RWxlbWVudC5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ1snZm9jdXNFbGVtZW50J10gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmJsdXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IucGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5mb3JtQ29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5mb3JtQ29udHJvbC5wZW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmZvcm1Db250cm9sICYmIGVkaXRvci5mb3JtQ29udHJvbC5pbnZhbGlkICYmICF0aGlzLmRnLmVuZEVkaXRCeUludmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnN0IF9jb2xfID0gKGVkaXRvciB8fCBjdXJyZW50Q2VsbCkuY29sdW1uO1xyXG4gICAgICAgIGNvbnN0IGFmdGVyRWRpdEV2ZW50ID0gdGhpcy5kZy5hZnRlckVkaXQoY3VycmVudENlbGwucm93SW5kZXgsIGN1cnJlbnRDZWxsLnJvd0RhdGEsIF9jb2xfLCBlZGl0b3IpO1xyXG4gICAgICAgIGlmICghYWZ0ZXJFZGl0RXZlbnQgfHwgIWFmdGVyRWRpdEV2ZW50LnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ3BsZWFzZSByZXR1cm4gYW4gT2JzZXJ2YWJsZSBUeXBlLicpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY2VsbEVuZEVkaXQgPSBvZih1bmRlZmluZWQpO1xyXG5cclxuICAgICAgICBhZnRlckVkaXRFdmVudC5zdWJzY3JpYmUoKGZsYWc6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWwgPSBjdXJyZW50Q2VsbC52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2VsbCAmJiBjdXJyZW50Q2VsbC5mb3JtQ29udHJvbCAmJiB2YWwgIT09IGN1cnJlbnRDZWxsLmZvcm1Db250cm9sLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gY3VycmVudENlbGwuZm9ybUNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENlbGwuaXNFZGl0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENlbGwudXBkYXRlVmFsdWUodmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZGZzLmVuZEVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRncy5vbkVuZENlbGxFZGl0KHRoaXMuZGZzLmdldEN1cnJlbnRDZWxsKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51bkJpbmRFZGl0b3JJbnB1dEV2ZW50KCk7XHJcbiAgICAgICAgICAgICAgICAvLyDnp7vpmaTnvJbovpHmoLflvI9cclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgQ0VMTF9FRElUSU5HX0NMUyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmVkaXRvcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZGF0YSA9IHRoaXMucm93RGF0YTtcclxuICAgICAgICAgICAgICAgIC8vIOabtOaWsOihjOagt+W8j+aIluiAheWNleWFg+agvOagt+W8j1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMucm93VXBkYXRlJC5uZXh0KHsgaW5kZXg6IGN1cnJlbnRDZWxsLnJvd0luZGV4LCBkYXRhOiBjdXJyZW50Q2VsbC5yb3dEYXRhLCBjZWxsUmVmOiBjdXJyZW50Q2VsbCB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuZW5kRWRpdC5lbWl0KHsgcm93SW5kZXg6IGN1cnJlbnRDZWxsLnJvd0luZGV4LCByb3dEYXRhOiBjdXJyZW50Q2VsbC5yb3dEYXRhLCBjb2x1bW46IF9jb2xfLCB2YWx1ZTogdmFsIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIOabtOaWsGZvb3RlckRhdGFcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdzLnJlZnJlc2hGb290ZXJEYXRhLmVtaXQoKTtcclxuICAgICAgICAgICAgICAgIGNlbGxFbmRFZGl0ID0gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAvLyDliLfmlrDooYzmlbDmja5cclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZHIucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0ZWRSb3cgJiYgdGhpcy5kZy5zZWxlY3RlZFJvdy5kcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHIucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2VsbCAmJiBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yID0gY3VycmVudENlbGwuY2VsbEVkaXRvci5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmlucHV0RWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxFbmRFZGl0ID0gb2YoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsRW5kRWRpdCA9IG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGNlbGxFbmRFZGl0O1xyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbENlbGxFZGl0aW5nKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsICYmIHRoaXMuZGcuY3VycmVudENlbGwuaXNFZGl0aW5nICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLmRmcy5yZXNldFJvdyh0aGlzLmRnLnNlbGVjdGVkUm93LmlkKTtcclxuICAgICAgICAgICAgdGhpcy5kYy5yb3dEYXRhID0gdGhpcy5kZy5zZWxlY3RlZFJvdy5kYXRhO1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sLnJlc2V0KFV0aWxzLmdldFZhbHVlKHRoaXMuY29sdW1uLmZpZWxkLCB0aGlzLmRjLnJvd0RhdGEpKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBiaW5kRWRpdG9ySW5wdXRFdmVudCgpIHtcclxuICAgICAgICBjb25zdCBjZVJlZiA9IHRoaXMuY2VsbEVkaXRvclJlZiB8fCB0aGlzLmRjLmNlbGxFZGl0b3I7XHJcbiAgICAgICAgbGV0IGlucHV0ID0gbnVsbDtcclxuICAgICAgICBpZiAoY2VSZWYpIHtcclxuICAgICAgICAgICAgaW5wdXQgPSBjZVJlZi5jb21wb25lbnRSZWYuaW5zdGFuY2UuaW5wdXRFbGVtZW50O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgaW5wdXQgPSB0aGlzLmRjLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQsdGV4dGFyZWEnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5wdXQpIHtcclxuICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0T25FZGl0aW5nICYmIHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQuc2VsZWN0KSB7IGlucHV0LnNlbGVjdCgpOyB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5lZGl0b3JJbnB1dEtleWRvd25FdmVudCA9IHRoaXMucmVuZGVyLmxpc3RlbihpbnB1dCwgJ2tleWRvd24nLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbktleURvd25Gb3JJbnB1dChlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVuQmluZEVkaXRvcklucHV0RXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5lZGl0b3JJbnB1dEtleWRvd25FdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcklucHV0S2V5ZG93bkV2ZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25LZXlEb3duRm9ySW5wdXQoZTogS2V5Ym9hcmRFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGtleUNvZGUgPSBlLmtleUNvZGU7XHJcbiAgICAgICAgaWYgKGUuYWx0S2V5IHx8IGUuY3RybEtleSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgodGhpcy5lZGl0b3IgJiYgdGhpcy5lZGl0b3Iuc3RvcFByb3BhZ2F0aW9uKSB8fCBrZXlDb2RlID09PSAxMyB8fCB0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoIChrZXlDb2RlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMzI6ICAvLyBTUEFDRVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvci50eXBlID09PSAnc3dpdGNoJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5pbnN0YW5jZS51cGRhdGVDaGVja2VkKGUsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDEzOiAgLy8gRW50ZXJcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgZGVib3VuY2VUaW1lKDEwMClcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudGVyUGFyYW0gPSB7IGdpcmQ6IHRoaXMuZGcsIGNlbGw6IHRoaXMuZGcuY3VycmVudENlbGwsIGV2ZW50OiBlIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5vbkVudGVySGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2x1bW4ub25FbnRlckhhbmRsZXIoZW50ZXJQYXJhbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0VGQgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsLmxhc3RSb3cgJiYgIW5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcubGFzdENlbGxFbnRlckhhbmRsZS5lbWl0KGVudGVyUGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAyNzogLy8gRVNDXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbENlbGxFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA5OiAvLyBUYWJcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmNsaWNrRGVsYXkgPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVQcmV2Q2VsbEFuZEVkaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVOZXh0Q2VsbEFuZEVkaXQoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWxlY3RDZWxsKGZpZWxkOiBzdHJpbmcsIHRkRWxlbWVudD86IGFueSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpO1xyXG4gICAgICAgIHRkRWxlbWVudCA9IHRkRWxlbWVudCB8fCB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5jbGVhckNlbGxTZWxlY3RlZENsYXNzKCk7XHJcbiAgICAgICAgaWYgKGZpZWxkICE9PSB0aGlzLmRnLkNvbnRyb2xQYW5lbEZlaWxkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRkRWxlbWVudCwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0aGlzLmRyLmRySG92ZXIuc2V0Um93SG92ZXJDbHMoZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuZGZzLnNldEN1cnJlbnRDZWxsKHRoaXMuZHIsIGZpZWxkLCB0ZEVsZW1lbnQsIHRoaXMuZGMpO1xyXG4gICAgICAgIHRoaXMubW92ZVNjcm9sbGJhcih0ZEVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbW92ZVNjcm9sbGJhcih0ZDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdGRQb3NMZWZ0ID0gdGQub2Zmc2V0TGVmdCArIHRkLm9mZnNldFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID0gdGhpcy5kZy53aWR0aCAtIHRoaXMuZGdiLmNvbHVtbnNHcm91cC5sZWZ0Rml4ZWRXaWR0aDtcclxuICAgICAgICBjb25zdCB0ZFJlY3QgPSB0ZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICBjb25zdCBzY3JvbGxDb250YWluZXIgPSB0aGlzLmRnYi5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgcHNDb250YWluZXIgPSBzY3JvbGxDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsVG9wID0gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcDtcclxuICAgICAgICBjb25zdCBzY3JvbGxMZWZ0ID0gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbExlZnQ7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsYmFyWExlZnQgPSB0aGlzLmRnYi5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdDtcclxuICAgICAgICBpZiAodGRQb3NMZWZ0ID4gY29udGFpbmVyV2lkdGgpIHtcclxuICAgICAgICAgICAgY29uc3QgeCA9IHRkUG9zTGVmdCAtIGNvbnRhaW5lcldpZHRoICsgMjtcclxuICAgICAgICAgICAgaWYgKHggPiBzY3JvbGxiYXJYTGVmdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ2IucHMuc2Nyb2xsVG9YKHgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRkUmVjdC54IDwgcHNDb250YWluZXIueCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IHNjcm9sbExlZnQgLSB0ZFJlY3QueDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWCh4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdGRQb3NUb3AgPSB0ZFJlY3QudG9wIC0gcHNDb250YWluZXIudG9wICsgdGRSZWN0LmhlaWdodDtcclxuICAgICAgICBpZiAodGRQb3NUb3AgPiBwc0NvbnRhaW5lci5oZWlnaHQpIHtcclxuICAgICAgICAgICAgY29uc3QgeSA9IHRkUG9zVG9wIC0gcHNDb250YWluZXIuaGVpZ2h0O1xyXG4gICAgICAgICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1koc2Nyb2xsVG9wICsgeSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRkUmVjdC55IDwgcHNDb250YWluZXIueSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ2IucHMuc2Nyb2xsVG9ZKHNjcm9sbFRvcCAtIChwc0NvbnRhaW5lci55IC0gdGRSZWN0LnkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1vdmVOZXh0Q2VsbEFuZEVkaXQoZXZlbnQ/OiBhbnkpIHtcclxuICAgICAgICAvLyBpZiAoIXRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybjtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgY29uc3QgZmllbGRJbmRleCA9IHRoaXMuZGZzLmdldENvbHVtbkluZGV4KHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICBpZiAoZmllbGRJbmRleCArIDEgPCB0aGlzLmRnYi5jb2x1bW5zR3JvdXAubm9ybWFsQ29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV4dENvbHVtbiA9IHRoaXMuZGdiLmNvbHVtbnNHcm91cC5ub3JtYWxDb2x1bW5zW2ZpZWxkSW5kZXggKyAxXTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRUZCA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICBpZiAobmV4dENvbHVtbiAmJiAoKCFuZXh0Q29sdW1uLmVkaXRvciAmJiAhbmV4dENvbHVtbi5lZGl0b3JUZW1wbGF0ZSkgfHwgdGhpcy5pc1JlYWRvbmx5KG5leHRDb2x1bW4pKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRUZC5zZWxlY3RDZWxsKGV2ZW50LCBuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobmV4dFRkKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0VGQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uLmVkaXRvciB8fCBuZXh0Q29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRkLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25DZWxsRWRpdChuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gbmV4dCByb3cncyBmaXJzdCBjZWxsIHRvIGVkaXRpbmdcclxuICAgICAgICAgICAgY29uc3QgbmV4dFRyID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5wYXJlbnRFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgaWYgKG5leHRUciAmJiBuZXh0VHIudGFnTmFtZSA9PT0gJ1RSJykge1xyXG4gICAgICAgICAgICAgICAgLy8gbmV4dFRyLmNoaWxkcmVuLmZpbmQodGQgPT4gdGQuZWRpdENlbGwpLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmlyc3RFZGl0b3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlICghZmlyc3RFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaXJzdEVkaXRvciA9ICEhbmV4dFRyLmNoaWxkcmVuW2ldLmVkaXRDZWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlyc3RFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV4dFRyLmNoaWxkcmVuW2ldLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlUHJldkNlbGxBbmRFZGl0KCkge1xyXG4gICAgICAgIC8vIGlmICghdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBjb25zdCBmaWVsZEluZGV4ID0gdGhpcy5kZnMuZ2V0Q29sdW1uSW5kZXgodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgIGlmIChmaWVsZEluZGV4IC0gMSA+PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRDb2x1bW4gPSB0aGlzLmRnYi5jb2x1bW5zR3JvdXAubm9ybWFsQ29sdW1uc1tmaWVsZEluZGV4IC0gMV07XHJcbiAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uICYmIHRoaXMuaXNSZWFkb25seShuZXh0Q29sdW1uKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRUZCA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgaWYgKG5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zZWxlY3RDZWxsKG5leHRDb2x1bW4uZmllbGQsIG5leHRUZCk7XHJcbiAgICAgICAgICAgICAgICBuZXh0VGQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uLmVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGZzLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRkLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25DZWxsRWRpdChuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYXJDZWxsU2VsZWN0ZWRDbGFzcygpIHtcclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICBEb21IYW5kbGVyLnJlbW92ZUNsYXNzKHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudCwgQ0VMTF9FRElUSU5HX0NMUyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZENlbGwgPSB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZENlbGwubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENlbGwuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyhuLCBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5kZy5yZW1vdmVDZWxsU2VsZWN0ZWRDbHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldENlbGxDbHNXaXRoRWRpdG9yVHlwZSgpIHtcclxuXHJcbiAgICAgICAgLy8g6K6+572u5b2T5YmN6YCJ5Lit5Y2V5YWD5qC85qC35byPXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5lbmFibGVIaWdobGlnaHRDZWxsKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsLmZpZWxkID09PSB0aGlzLmNvbHVtbi5maWVsZCAmJiB0aGlzLmRnLmN1cnJlbnRDZWxsLnJvd0lkID09PSB0aGlzLnJvd0RhdGFbdGhpcy5kZy5pZEZpZWxkXSAmJiAhdGhpcy5kYy5pc0VkaXRpbmcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJDZWxsU2VsZWN0ZWRDbGFzcygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX1NFTEVDVEVEX0NMUyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuZW5hYmxlRWRpdENlbGxTdHlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0ZCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB0aGlzLmNsZWFuT3RoZXJFZGl0b3JJY29uKHRkKTtcclxuICAgICAgICAvLyDlvZPliY3ooYznpoHnlKjvvIzkuI3lhYHorrjnvJbovpHjgIJcclxuICAgICAgICBpZiAodGhpcy5kci5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuY29sdW1uLmVkaXRvcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5pc1JlYWRvbmx5KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZWRpdG9yVHlwZSA9IHRoaXMuY29sdW1uLmVkaXRvci50eXBlO1xyXG4gICAgICAgIGNvbnN0IGNscyA9IHRoaXMuY29sdW1uLmFsaWduID09PSAncmlnaHQnID8gJ2FsbG93LWVkaXQtY2VsbC1sZWZ0JyA6ICdhbGxvdy1lZGl0LWNlbGwnO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRkLCBjbHMpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRkLCBBTExPV19FRElUX0NFTExfSElHSExJR0hUX0NMU1tlZGl0b3JUeXBlXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbGVhbk90aGVyRWRpdG9ySWNvbih0ZCkge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IE9iamVjdC52YWx1ZXMoQUxMT1dfRURJVF9DRUxMX0hJR0hMSUdIVF9DTFMpO1xyXG4gICAgICAgIHZhbHVlcy5mb3JFYWNoKHYgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGQuY2xhc3NOYW1lLmluZGV4T2YodikgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgdGQuY2xhc3NOYW1lID0gdGQuY2xhc3NOYW1lLnJlcGxhY2UoJ2FsbG93LWVkaXQtY2VsbC1sZWZ0JywgJycpLnJlcGxhY2UoJ2FsbG93LWVkaXQtY2VsbCcsICcnKTtcclxuICAgICAgICAgICAgICAgIHRkLmNsYXNzTmFtZSA9IHRkLmNsYXNzTmFtZS5yZXBsYWNlKHYsICcnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==