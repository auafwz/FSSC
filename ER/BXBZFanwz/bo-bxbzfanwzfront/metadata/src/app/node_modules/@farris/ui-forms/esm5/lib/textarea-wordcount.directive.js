/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Injector, Input, Renderer2 } from '@angular/core';
import { NgControl } from '@angular/forms';
import { LocaleService } from '@farris/ui-locale';
import { EventManager } from '@angular/platform-browser';
var TextareaWordcountDirective = /** @class */ (function () {
    function TextareaWordcountDirective(el, render, injector) {
        this.el = el;
        this.render = render;
        this.injector = injector;
        this.useWordCount = true;
        /**
         * 统计字数的方式； surplus 剩余可输入字数; length: 当前已输入字数；
         *
         * 默认为 surplus
         */
        this.countType = 'surplus';
        this.onlyShowInDialog = false;
        this.wordCountElement = null;
        // 当前字数
        this.currentLengthElement = null;
        this.onInput = null;
        this.eventManager = this.injector.get(EventManager);
        this.localeSer = this.injector.get(LocaleService);
    }
    /**
     * @return {?}
     */
    TextareaWordcountDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.ngControl = this.injector.get(NgControl, null);
    };
    /**
     * @return {?}
     */
    TextareaWordcountDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initWordCount();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TextareaWordcountDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.useWordCount && !changes.useWordCount.isFirstChange()) {
            if (this.useWordCount) {
                this.initWordCount();
            }
            else {
                this.destroy();
            }
        }
    };
    /**
     * @return {?}
     */
    TextareaWordcountDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy();
    };
    /**
     * @private
     * @return {?}
     */
    TextareaWordcountDirective.prototype.destroy = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.onInput) {
            this.onInput();
        }
        if (this.wordCountElement) {
            this.wordCountElement.remove();
        }
    };
    /**
     * @return {?}
     */
    TextareaWordcountDirective.prototype.initWordCount = /**
     * @return {?}
     */
    function () {
        if (this.useWordCount && !this.onlyShowInDialog) {
            this.createWordCountElement();
        }
    };
    /**
     * @private
     * @return {?}
     */
    TextareaWordcountDirective.prototype.createWordCountID = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var tagName = this.el.nativeElement.tagName;
        if (this.ngControl) {
            /** @type {?} */
            var ctrlName = this.ngControl.name;
            return tagName + "_WORDCOUNT_" + ctrlName;
        }
        else {
            if (this.el.nativeElement.id) {
                return tagName + "_WORDCOUNT_" + this.el.nativeElement.id;
            }
        }
        return '';
    };
    /**
     * @private
     * @return {?}
     */
    TextareaWordcountDirective.prototype.createWordCountElement = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var max = this.el.nativeElement.maxLength;
        if (!max || max < 0) {
            console.info('未设置最大字符数，计数功能失效。');
            return;
        }
        /** @type {?} */
        var wordCountSPAN = this.render.createElement('span');
        wordCountSPAN.className = 'textarea-wordcount';
        /** @type {?} */
        var id = this.createWordCountID();
        if (id) {
            wordCountSPAN.id = id;
        }
        this.render.setStyle(wordCountSPAN, 'position', 'absolute');
        this.render.setStyle(wordCountSPAN, 'bottom', '10px');
        this.render.setStyle(wordCountSPAN, 'right', '20px');
        this.render.setStyle(wordCountSPAN, 'cursor', 'pointer');
        this.el.nativeElement.after(wordCountSPAN);
        this.wordCountElement = wordCountSPAN;
        /** @type {?} */
        var currentLengthSPAN = this.render.createElement('span');
        wordCountSPAN.appendChild(currentLengthSPAN);
        this.currentLengthElement = currentLengthSPAN;
        currentLengthSPAN.after(" / " + max);
        this.updateWordsCount();
        this.onInput = this.render.listen(this.el.nativeElement, 'input', (/**
         * @return {?}
         */
        function () {
            // value.replace(/\n|\r/gi, '') // 移除换行符
            _this.updateWordsCount();
        }));
    };
    /**
     * @return {?}
     */
    TextareaWordcountDirective.prototype.updateWordsCount = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var max = this.el.nativeElement.maxLength;
        /** @type {?} */
        var val = this.countType === 'surplus' ? max - this.el.nativeElement.value.length : this.el.nativeElement.value.length;
        /** @type {?} */
        var tip = 'messager.prompt.tips.' + this.countType;
        this.currentLengthElement.innerText = val;
        this.wordCountElement.title = this.localeSer.getValue(tip).replace('{0}', val);
    };
    TextareaWordcountDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[word-count]',
                    exportAs: 'WordCountRef'
                },] }
    ];
    /** @nocollapse */
    TextareaWordcountDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: Injector }
    ]; };
    TextareaWordcountDirective.propDecorators = {
        useWordCount: [{ type: Input, args: ['word-count',] }],
        countType: [{ type: Input }],
        onlyShowInDialog: [{ type: Input }]
    };
    return TextareaWordcountDirective;
}());
export { TextareaWordcountDirective };
if (false) {
    /** @type {?} */
    TextareaWordcountDirective.prototype.useWordCount;
    /**
     * 统计字数的方式； surplus 剩余可输入字数; length: 当前已输入字数；
     *
     * 默认为 surplus
     * @type {?}
     */
    TextareaWordcountDirective.prototype.countType;
    /** @type {?} */
    TextareaWordcountDirective.prototype.onlyShowInDialog;
    /** @type {?} */
    TextareaWordcountDirective.prototype.wordCountElement;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.currentLengthElement;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.eventManager;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.ngControl;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.onInput;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    TextareaWordcountDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dGFyZWEtd29yZGNvdW50LmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZm9ybXMvIiwic291cmNlcyI6WyJsaWIvdGV4dGFyZWEtd29yZGNvdW50LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQ00sTUFBTSxlQUFlLENBQUM7QUFDdEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFekQ7SUFzQkksb0NBQW9CLEVBQWMsRUFBVSxNQUFpQixFQUFVLFFBQWtCO1FBQXJFLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWpCcEUsaUJBQVksR0FBRyxJQUFJLENBQUM7Ozs7OztRQU1oQyxjQUFTLEdBQXlCLFNBQVMsQ0FBQztRQUU1QyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFFbEMscUJBQWdCLEdBQUcsSUFBSSxDQUFDOztRQUVoQix5QkFBb0IsR0FBRyxJQUFJLENBQUM7UUFHNUIsWUFBTyxHQUFHLElBQUksQ0FBQztRQUduQixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDdEQsQ0FBQzs7OztJQUVELDZDQUFROzs7SUFBUjtRQUNJLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMs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QkFDUCxRQUFRLEVBQUUsY0FBYztvQkFDeEIsUUFBUSxFQUFFLGNBQWM7aUJBQzNCOzs7O2dCQVRtQixVQUFVO2dCQUFtQixTQUFTO2dCQUExQixRQUFROzs7K0JBV25DLEtBQUssU0FBQyxZQUFZOzRCQU1sQixLQUFLO21DQUVMLEtBQUs7O0lBOEdWLGlDQUFDO0NBQUEsQUEzSEQsSUEySEM7U0F2SFksMEJBQTBCOzs7SUFDbkMsa0RBQXlDOzs7Ozs7O0lBTXpDLCtDQUFxRDs7SUFFckQsc0RBQWtDOztJQUVsQyxzREFBd0I7Ozs7O0lBRXhCLDBEQUFvQzs7Ozs7SUFDcEMsa0RBQW1DOzs7OztJQUNuQywrQ0FBNkI7Ozs7O0lBQzdCLDZDQUF1Qjs7Ozs7SUFDdkIsK0NBQWlDOzs7OztJQUNyQix3Q0FBc0I7Ozs7O0lBQUUsNENBQXlCOzs7OztJQUFFLDhDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSW5qZWN0b3IsIElucHV0LCBSZW5kZXJlcjIsXHJcbiAgICBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5nQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW3dvcmQtY291bnRdJyxcclxuICAgIGV4cG9ydEFzOiAnV29yZENvdW50UmVmJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgVGV4dGFyZWFXb3JkY291bnREaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuICAgIEBJbnB1dCgnd29yZC1jb3VudCcpIHVzZVdvcmRDb3VudCA9IHRydWU7XHJcbiAgICAvKipcclxuICAgICAqIOe7n+iuoeWtl+aVsOeahOaWueW8j++8myBzdXJwbHVzIOWJqeS9meWPr+i+k+WFpeWtl+aVsDsgbGVuZ3RoOiDlvZPliY3lt7LovpPlhaXlrZfmlbDvvJtcclxuICAgICAqXHJcbiAgICAgKiDpu5jorqTkuLogc3VycGx1c1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBjb3VudFR5cGU6ICdzdXJwbHVzJyB8ICdsZW5ndGgnID0gJ3N1cnBsdXMnO1xyXG5cclxuICAgIEBJbnB1dCgpIG9ubHlTaG93SW5EaWFsb2cgPSBmYWxzZTtcclxuXHJcbiAgICB3b3JkQ291bnRFbGVtZW50ID0gbnVsbDtcclxuICAgIC8vIOW9k+WJjeWtl+aVsFxyXG4gICAgcHJpdmF0ZSBjdXJyZW50TGVuZ3RoRWxlbWVudCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGV2ZW50TWFuYWdlcjogRXZlbnRNYW5hZ2VyO1xyXG4gICAgcHJpdmF0ZSBuZ0NvbnRyb2w6IE5nQ29udHJvbDtcclxuICAgIHByaXZhdGUgb25JbnB1dCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZTtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSB0aGlzLmluamVjdG9yLmdldChFdmVudE1hbmFnZXIpO1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VyID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxlU2VydmljZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5uZ0NvbnRyb2wgPSB0aGlzLmluamVjdG9yLmdldChOZ0NvbnRyb2wsIG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmluaXRXb3JkQ291bnQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcblxyXG4gICAgICAgIGlmIChjaGFuZ2VzLnVzZVdvcmRDb3VudCAmJiAhY2hhbmdlcy51c2VXb3JkQ291bnQuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVzZVdvcmRDb3VudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbml0V29yZENvdW50KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3koKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBkZXN0cm95KCkge1xyXG4gICAgICAgIGlmICh0aGlzLm9uSW5wdXQpIHtcclxuICAgICAgICAgICAgdGhpcy5vbklucHV0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy53b3JkQ291bnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMud29yZENvdW50RWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFdvcmRDb3VudCgpIHtcclxuICAgICAgICBpZiAodGhpcy51c2VXb3JkQ291bnQgJiYgIXRoaXMub25seVNob3dJbkRpYWxvZykge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVdvcmRDb3VudEVsZW1lbnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVXb3JkQ291bnRJRCgpIHtcclxuICAgICAgICBjb25zdCB0YWdOYW1lID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnRhZ05hbWU7XHJcbiAgICAgICAgaWYgKHRoaXMubmdDb250cm9sKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN0cmxOYW1lID0gdGhpcy5uZ0NvbnRyb2wubmFtZTtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RhZ05hbWV9X1dPUkRDT1VOVF8ke2N0cmxOYW1lfWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZWwubmF0aXZlRWxlbWVudC5pZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3RhZ05hbWV9X1dPUkRDT1VOVF8ke3RoaXMuZWwubmF0aXZlRWxlbWVudC5pZH1gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVdvcmRDb3VudEVsZW1lbnQoKSB7XHJcbiAgICAgICAgY29uc3QgbWF4ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50Lm1heExlbmd0aDtcclxuICAgICAgICBpZiAoIW1heCB8fCBtYXggPCAwKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygn5pyq6K6+572u5pyA5aSn5a2X56ym5pWw77yM6K6h5pWw5Yqf6IO95aSx5pWI44CCJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHdvcmRDb3VudFNQQU4gPSB0aGlzLnJlbmRlci5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgd29yZENvdW50U1BBTi5jbGFzc05hbWUgPSAndGV4dGFyZWEtd29yZGNvdW50JztcclxuXHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLmNyZWF0ZVdvcmRDb3VudElEKCk7XHJcbiAgICAgICAgaWYgKGlkKSB7XHJcbiAgICAgICAgICAgIHdvcmRDb3VudFNQQU4uaWQgPSBpZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHdvcmRDb3VudFNQQU4sICdwb3NpdGlvbicsICdhYnNvbHV0ZScpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHdvcmRDb3VudFNQQU4sICdib3R0b20nLCAnMTBweCcpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHdvcmRDb3VudFNQQU4sICdyaWdodCcsICcyMHB4Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUod29yZENvdW50U1BBTiwgJ2N1cnNvcicsICdwb2ludGVyJyk7XHJcblxyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5hZnRlcih3b3JkQ291bnRTUEFOKTtcclxuICAgICAgICB0aGlzLndvcmRDb3VudEVsZW1lbnQgPSB3b3JkQ291bnRTUEFOO1xyXG5cclxuICAgICAgICBjb25zdCBjdXJyZW50TGVuZ3RoU1BBTiA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICB3b3JkQ291bnRTUEFOLmFwcGVuZENoaWxkKGN1cnJlbnRMZW5ndGhTUEFOKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRMZW5ndGhFbGVtZW50ID0gY3VycmVudExlbmd0aFNQQU47XHJcbiAgICAgICAgY3VycmVudExlbmd0aFNQQU4uYWZ0ZXIoIGAgLyAke21heH1gICk7XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlV29yZHNDb3VudCgpO1xyXG4gICAgICAgIHRoaXMub25JbnB1dCA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdpbnB1dCcsICgpID0+IHtcclxuICAgICAgICAgICAgLy8gdmFsdWUucmVwbGFjZSgvXFxufFxcci9naSwgJycpIC8vIOenu+mZpOaNouihjOesplxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVdvcmRzQ291bnQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVXb3Jkc0NvdW50KCkge1xyXG4gICAgICAgIGNvbnN0IG1heCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5tYXhMZW5ndGg7XHJcbiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5jb3VudFR5cGUgPT09ICdzdXJwbHVzJyA/IG1heCAtIHRoaXMuZWwubmF0aXZlRWxlbWVudC52YWx1ZS5sZW5ndGggOiB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQudmFsdWUubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IHRpcCA9ICdtZXNzYWdlci5wcm9tcHQudGlwcy4nICsgdGhpcy5jb3VudFR5cGU7XHJcblxyXG4gICAgICAgIHRoaXMuY3VycmVudExlbmd0aEVsZW1lbnQuaW5uZXJUZXh0ID0gdmFsO1xyXG4gICAgICAgIHRoaXMud29yZENvdW50RWxlbWVudC50aXRsZSA9IHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKHRpcCkucmVwbGFjZSgnezB9JywgdmFsKTtcclxuICAgIH1cclxufVxyXG4iXX0=