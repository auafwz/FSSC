/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-04-08 16:51:39
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-23 16:51:21
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, EventEmitter, Output, ElementRef, Renderer2, ViewChild } from '@angular/core';
import { deepCopy, convertColumns } from '../datatable-column';
import { DataTableService } from '../datatable.service';
import { CommonUtils } from '@farris/ui-common';
import { DataTableComponent } from '../datatable.component';
import { DTCheckboxComponent } from '../datatable-checkbox.component';
var DataTableHeaderComponent = /** @class */ (function () {
    function DataTableHeaderComponent(el, dataService, render, utils, dt) {
        var _this = this;
        this.el = el;
        this.dataService = dataService;
        this.render = render;
        this.utils = utils;
        this.dt = dt;
        this.columns = [];
        this.singleSelect = true;
        this.checkedAll = new EventEmitter();
        this.rowsChange = new EventEmitter();
        this.loadData = new EventEmitter();
        this.sortType = {};
        this.filterFields = {};
        this.clickedUp = false;
        this.clickedDown = false;
        this.isCheckAll = false;
        this.allClass = ' ';
        this.width = '100%';
        this.allClass += this.el.nativeElement.classList.value;
        this.dataService.updateCheckAllStatus.subscribe((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (n !== 2) {
                _this.isCheckAll = n ? true : false;
                // this.checkallEl.elementRef.nativeElement.checked = this.isCheckAll;
            }
            else {
                _this.isCheckAll = false;
                // this.checkallEl.elementRef.nativeElement.checked = false;
            }
        }));
    }
    /**
     * @return {?}
     */
    DataTableHeaderComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.fixed === 'left') {
            this.columns = convertColumns(this.columns, 'left');
        }
        if (this.fixed === 'right') {
            this.columns = convertColumns(this.columns, 'right');
        }
    };
    /**
     * @return {?}
     */
    DataTableHeaderComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @param {?} $event
     * @return {?}
     */
    DataTableHeaderComponent.prototype.onCheckedChange = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.isCheckAll = $event.checked;
        this.checkedAll.emit($event.checked);
    };
    /**
     * @param {?} row
     * @param {?} index
     * @return {?}
     */
    DataTableHeaderComponent.prototype.createRowClassName = /**
     * @param {?} row
     * @param {?} index
     * @return {?}
     */
    function (row, index) {
        return this.rowClassName ? this.rowClassName(row, index) : '';
    };
    /**
     * @private
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    DataTableHeaderComponent.prototype.compare = /**
     * @private
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    function (a, b) {
        if (typeof a === 'string') {
            return a.localeCompare(b);
        }
        else {
            return a === b ? 0 : (a > b ? 1 : -1);
        }
    };
    /**
     * @private
     * @param {?} r1
     * @param {?} r2
     * @return {?}
     */
    DataTableHeaderComponent.prototype._sort = /**
     * @private
     * @param {?} r1
     * @param {?} r2
     * @return {?}
     */
    function (r1, r2) {
        /** @type {?} */
        var r = 0;
        /** @type {?} */
        var sortFields = this.dt.sortName.split(',');
        /** @type {?} */
        var orders = this.dt.sortOrder.split(',');
        if (!this.dt.sortName) {
            return r;
        }
        var _loop_1 = function (i) {
            /** @type {?} */
            var sn = sortFields[i];
            /** @type {?} */
            var so = orders[i];
            /** @type {?} */
            var col = this_1.columns.find((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.field === sn; }));
            /** @type {?} */
            var orderby = col['sorter'] || this_1.compare;
            /** @type {?} */
            var v1 = this_1.utils.getValue(sn, r1);
            if (v1 === null || v1 === undefined) {
                v1 = '';
            }
            /** @type {?} */
            var v2 = this_1.utils.getValue(sn, r2);
            if (v2 === null || v2 === undefined) {
                v2 = '';
            }
            r = orderby(v1, v2);
            if (r !== 0) {
                return { value: r * (so === 'asc' ? 1 : -1) };
            }
        };
        var this_1 = this;
        for (var i = 0; i < sortFields.length; i++) {
            var state_1 = _loop_1(i);
            if (typeof state_1 === "object")
                return state_1.value;
        }
        return r;
    };
    /**
     * @private
     * @return {?}
     */
    DataTableHeaderComponent.prototype.clientSort = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var sortedData = this.data.sort(this._sort.bind(this));
        this.loadData.emit(sortedData);
    };
    /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    DataTableHeaderComponent.prototype.onSortColumnClick = /**
     * @param {?} $event
     * @param {?} col
     * @return {?}
     */
    function ($event, col) {
        var _this = this;
        if (!col.sortable) {
            return;
        }
        /** @type {?} */
        var sortName = this.dt.sortName;
        /** @type {?} */
        var sortOrder = this.dt.sortOrder;
        /** @type {?} */
        var sortFields = [];
        /** @type {?} */
        var sortOrders = [];
        if (sortName) {
            sortFields = sortName.split(',');
            sortOrders = sortOrder.split(',');
        }
        /** @type {?} */
        var colOrder = col.order || 'asc';
        /** @type {?} */
        var newOrder = colOrder;
        /** @type {?} */
        var i = sortFields.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return n === col.field; }));
        if (i >= 0) {
            /** @type {?} */
            var _order = sortOrders[i] === 'asc' ? 'desc' : 'asc';
            newOrder = _order;
            if (this.dt.multiSort && newOrder === 'asc') {
                newOrder = undefined;
                sortFields.splice(i, 1);
                sortOrders.splice(i, 1);
                if (sortFields.length === 0) {
                    sortFields.push(col.field);
                    sortOrders.push('asc');
                    newOrder = 'asc';
                }
            }
            else {
                sortOrders[i] = _order;
            }
        }
        else {
            if (this.dt.multiSort) {
                sortFields.push(col.field);
                sortOrders.push(colOrder);
            }
            else {
                sortFields = [col.field];
                sortOrders = [colOrder];
            }
        }
        col.order = newOrder;
        this.dt.sortName = sortFields.join(',');
        this.dt.sortOrder = sortOrders.join(',');
        // this.dfs.setSortInfo(this.dg.sortName, this.dg.sortOrder);
        if (!this.dt.multiSort) {
            /** @type {?} */
            var updateFieldOrder = (/**
             * @param {?} cols
             * @return {?}
             */
            function (cols) {
                if (!cols || !cols.length) {
                    return;
                }
                cols.forEach((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) {
                    c.order = undefined;
                    /** @type {?} */
                    var k = sortFields.findIndex((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f === c.field; }));
                    if (k >= 0) {
                        c.order = sortOrders[k];
                    }
                }));
            });
            updateFieldOrder(this.columns);
            // this.cdRef.detectChanges();
        }
        this.dt.beforeSortColumn(this.dt.sortName, this.dt.sortOrder).subscribe((/**
         * @return {?}
         */
        function () {
            if (_this.dt.remoteSort) {
                // this.reload();
            }
            else {
                _this.clientSort();
            }
            _this.dt.columnSorted.emit({ sortName: _this.dt.sortName, sortOrder: _this.dt.sortOrder });
        }));
    };
    /**
     * @return {?}
     */
    DataTableHeaderComponent.prototype.deepCopyData = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var copyColumns = deepCopy(this.columns);
        /** @type {?} */
        var copyRows = deepCopy(this.rows);
        copyColumns.forEach((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            element.sortType = 'normal';
        }));
        return {
            copyColumns: copyColumns,
            copyRows: copyRows
        };
    };
    /* 若存在筛选条件 保存按钮可点击
     */
    /* 若存在筛选条件 保存按钮可点击
         */
    /**
     * @param {?} col
     * @return {?}
     */
    DataTableHeaderComponent.prototype.hasChecked = /* 若存在筛选条件 保存按钮可点击
         */
    /**
     * @param {?} col
     * @return {?}
     */
    function (col) {
        if (this.filterFields.hasOwnProperty(col.field)) {
            this.filterFields[col.field].some((/**
             * @param {?} ele
             * @return {?}
             */
            function (ele) {
                return ele.checked;
            }));
        }
        return false;
    };
    DataTableHeaderComponent.decorators = [
        { type: Component, args: [{
                    selector: 'datatable-header',
                    template: "\n        <table class=\"table\" [class.table-sm]=\"size === 'small'\">\n            <colgroup>\n                <col class=\"dt-checkbox-cell\" *ngIf=\"!singleSelect\" />\n                <col *ngFor=\"let col of columns\" [style.width]=\"col.width + 'px'\" />\n            </colgroup>\n            <thead>\n                <tr>\n                    <th drag-column class=\"dt-checkbox-cell\" *ngIf=\"!singleSelect\">\n                        <dt-checkbox #checkall [checked]=\"isCheckAll\" (checkedChange)=\"onCheckedChange($event)\"></dt-checkbox>\n                    </th>\n                    <th drag-column *ngFor=\"let col of columns; let i = index\" [style.textAlign]=\"col.hAlign || 'left'\">\n                        <span>{{ col.title }}</span>\n                        <ng-container *ngIf=\"col.sortable\">\n                            <span\n                                class=\"f-datatable-sort\"\n                                [class.f-datatable-sort-asc]=\"col.order === 'asc'\"\n                                [class.f-datatable-sort-desc]=\"col.order === 'desc'\"\n                                (click)=\"onSortColumnClick($event, col)\"\n                                *ngIf=\"col.order\"\n                                >\n                            </span>\n                            <span class=\"f-datatable-sort\" (click)=\"onSortColumnClick($event, col)\" *ngIf=\"!col.order\">\n                            </span>\n                        </ng-container>\n                    </th>\n                </tr>\n            </thead>\n        </table>\n    ",
                    styles: ["th>div{display:inline-block;float:right;width:20%;height:0;margin-right:5%}th>div>span.sort-container{position:relative;display:inline-block;width:100%;height:1rem}th span.farris-icon{position:absolute;left:0;opacity:.5;cursor:pointer}th span.k-i-arrow-60-up{top:0}th span.k-i-arrow-60-down{top:.5em}th span.k-i-filter{top:-.5rem}th span.clicked,th span.k-i-filter:hover{opacity:1}.farris-table-header{overflow:auto}"]
                }] }
    ];
    /** @nocollapse */
    DataTableHeaderComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: DataTableService },
        { type: Renderer2 },
        { type: CommonUtils },
        { type: DataTableComponent }
    ]; };
    DataTableHeaderComponent.propDecorators = {
        size: [{ type: Input }],
        hover: [{ type: Input }],
        columns: [{ type: Input }],
        singleSelect: [{ type: Input }],
        fixed: [{ type: Input }],
        rows: [{ type: Input }],
        data: [{ type: Input }],
        rowClassName: [{ type: Input }],
        checkedAll: [{ type: Output }],
        rowsChange: [{ type: Output }],
        loadData: [{ type: Output }],
        checkallEl: [{ type: ViewChild, args: ['checkall',] }]
    };
    return DataTableHeaderComponent;
}());
export { DataTableHeaderComponent };
if (false) {
    /** @type {?} */
    DataTableHeaderComponent.prototype.size;
    /** @type {?} */
    DataTableHeaderComponent.prototype.hover;
    /** @type {?} */
    DataTableHeaderComponent.prototype.columns;
    /** @type {?} */
    DataTableHeaderComponent.prototype.singleSelect;
    /** @type {?} */
    DataTableHeaderComponent.prototype.fixed;
    /** @type {?} */
    DataTableHeaderComponent.prototype.rows;
    /** @type {?} */
    DataTableHeaderComponent.prototype.data;
    /** @type {?} */
    DataTableHeaderComponent.prototype.rowClassName;
    /** @type {?} */
    DataTableHeaderComponent.prototype.checkedAll;
    /** @type {?} */
    DataTableHeaderComponent.prototype.rowsChange;
    /** @type {?} */
    DataTableHeaderComponent.prototype.loadData;
    /** @type {?} */
    DataTableHeaderComponent.prototype.checkallEl;
    /** @type {?} */
    DataTableHeaderComponent.prototype.sortType;
    /** @type {?} */
    DataTableHeaderComponent.prototype.filterFields;
    /** @type {?} */
    DataTableHeaderComponent.prototype.clickedUp;
    /** @type {?} */
    DataTableHeaderComponent.prototype.clickedDown;
    /** @type {?} */
    DataTableHeaderComponent.prototype.copyColumns;
    /** @type {?} */
    DataTableHeaderComponent.prototype.copyRows;
    /** @type {?} */
    DataTableHeaderComponent.prototype.originRows;
    /** @type {?} */
    DataTableHeaderComponent.prototype.isCheckAll;
    /** @type {?} */
    DataTableHeaderComponent.prototype.allClass;
    /** @type {?} */
    DataTableHeaderComponent.prototype.width;
    /** @type {?} */
    DataTableHeaderComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DataTableHeaderComponent.prototype.dataService;
    /**
     * @type {?}
     * @private
     */
    DataTableHeaderComponent.prototype.render;
    /** @type {?} */
    DataTableHeaderComponent.prototype.utils;
    /**
     * @type {?}
     * @private
     */
    DataTableHeaderComponent.prototype.dt;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXRhYmxlLWhlYWRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGF0YWJsZS8iLCJzb3VyY2VzIjpbImxpYi90YWJsZS9kYXRhdGFibGUtaGVhZGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxZQUFZLEVBQWlCLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoSSxPQUFPLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXhELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUV0RTtJQStESSxrQ0FDVyxFQUFjLEVBQ2IsV0FBNkIsRUFDN0IsTUFBaUIsRUFDbEIsS0FBa0IsRUFDakIsRUFBc0I7UUFMbEMsaUJBbUJDO1FBbEJVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDYixnQkFBVyxHQUFYLFdBQVcsQ0FBa0I7UUFDN0IsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUNsQixVQUFLLEdBQUwsS0FBSyxDQUFhO1FBQ2pCLE9BQUUsR0FBRixFQUFFLENBQW9CO1FBL0J6QixZQUFPLEdBQWlCLEVBQUUsQ0FBQztRQUMzQixpQkFBWSxHQUFHLElBQUksQ0FBQztRQVFuQixlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVoQyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNyQyxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQXFFLENBQUM7UUFLM0cs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QUNoQiw4Q0FBbUI7O0lBQ25CLDRDQUFlOztJQXFCZix5Q0FBZTs7SUFuQlgsc0NBQXFCOzs7OztJQUNyQiwrQ0FBcUM7Ozs7O0lBQ3JDLDBDQUF5Qjs7SUFDekIseUNBQXlCOzs7OztJQUN6QixzQ0FBOEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA0LTA4IDE2OjUxOjM5XHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTA5LTIzIDE2OjUxOjIxXHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgQWZ0ZXJWaWV3SW5pdCwgT3V0cHV0LCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBkZWVwQ29weSwgY29udmVydENvbHVtbnMgfSBmcm9tICcuLi9kYXRhdGFibGUtY29sdW1uJztcclxuaW1wb3J0IHsgRGF0YVRhYmxlU2VydmljZSB9IGZyb20gJy4uL2RhdGF0YWJsZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL2NvbHVtbic7XHJcbmltcG9ydCB7IENvbW1vblV0aWxzIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBEYXRhVGFibGVDb21wb25lbnQgfSBmcm9tICcuLi9kYXRhdGFibGUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRFRDaGVja2JveENvbXBvbmVudCB9IGZyb20gJy4uL2RhdGF0YWJsZS1jaGVja2JveC5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2RhdGF0YWJsZS1oZWFkZXInLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgICAgICA8dGFibGUgY2xhc3M9XCJ0YWJsZVwiIFtjbGFzcy50YWJsZS1zbV09XCJzaXplID09PSAnc21hbGwnXCI+XHJcbiAgICAgICAgICAgIDxjb2xncm91cD5cclxuICAgICAgICAgICAgICAgIDxjb2wgY2xhc3M9XCJkdC1jaGVja2JveC1jZWxsXCIgKm5nSWY9XCIhc2luZ2xlU2VsZWN0XCIgLz5cclxuICAgICAgICAgICAgICAgIDxjb2wgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zXCIgW3N0eWxlLndpZHRoXT1cImNvbC53aWR0aCArICdweCdcIiAvPlxyXG4gICAgICAgICAgICA8L2NvbGdyb3VwPlxyXG4gICAgICAgICAgICA8dGhlYWQ+XHJcbiAgICAgICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRoIGRyYWctY29sdW1uIGNsYXNzPVwiZHQtY2hlY2tib3gtY2VsbFwiICpuZ0lmPVwiIXNpbmdsZVNlbGVjdFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZHQtY2hlY2tib3ggI2NoZWNrYWxsIFtjaGVja2VkXT1cImlzQ2hlY2tBbGxcIiAoY2hlY2tlZENoYW5nZSk9XCJvbkNoZWNrZWRDaGFuZ2UoJGV2ZW50KVwiPjwvZHQtY2hlY2tib3g+XHJcbiAgICAgICAgICAgICAgICAgICAgPC90aD5cclxuICAgICAgICAgICAgICAgICAgICA8dGggZHJhZy1jb2x1bW4gKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zOyBsZXQgaSA9IGluZGV4XCIgW3N0eWxlLnRleHRBbGlnbl09XCJjb2wuaEFsaWduIHx8ICdsZWZ0J1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57eyBjb2wudGl0bGUgfX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjb2wuc29ydGFibGVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJmLWRhdGF0YWJsZS1zb3J0XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY2xhc3MuZi1kYXRhdGFibGUtc29ydC1hc2NdPVwiY29sLm9yZGVyID09PSAnYXNjJ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NsYXNzLmYtZGF0YXRhYmxlLXNvcnQtZGVzY109XCJjb2wub3JkZXIgPT09ICdkZXNjJ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNsaWNrKT1cIm9uU29ydENvbHVtbkNsaWNrKCRldmVudCwgY29sKVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJjb2wub3JkZXJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZi1kYXRhdGFibGUtc29ydFwiIChjbGljayk9XCJvblNvcnRDb2x1bW5DbGljaygkZXZlbnQsIGNvbClcIiAqbmdJZj1cIiFjb2wub3JkZXJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgICAgICAgICAgICAgPC90aD5cclxuICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICAgIDwvdGhlYWQ+XHJcbiAgICAgICAgPC90YWJsZT5cclxuICAgIGAsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9kYXRhdGFibGUtaGVhZGVyLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFUYWJsZUhlYWRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICBASW5wdXQoKSBzaXplOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBob3ZlcjogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIGNvbHVtbnM6IERhdGFDb2x1bW5bXSA9IFtdO1xyXG4gICAgQElucHV0KCkgc2luZ2xlU2VsZWN0ID0gdHJ1ZTtcclxuICAgIEBJbnB1dCgpIGZpeGVkOiBzdHJpbmc7XHJcbiAgICAvLyDmlbDmja7mjpLluo/kvb/nlKhcclxuICAgIEBJbnB1dCgpIHJvd3M6IGFueTtcclxuXHJcbiAgICAvLyDmgaLlpI3mupDmlbDmja7kvb/nlKhcclxuICAgIEBJbnB1dCgpIGRhdGE6IGFueTtcclxuICAgIEBJbnB1dCgpIHJvd0NsYXNzTmFtZTogKHJvdzogYW55LCBpbmRleDogbnVtYmVyKSA9PiBzdHJpbmc7XHJcbiAgICBAT3V0cHV0KCkgY2hlY2tlZEFsbCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAT3V0cHV0KCkgcm93c0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgQE91dHB1dCgpIGxvYWREYXRhID0gbmV3IEV2ZW50RW1pdHRlcjx7IHBhZ2VTaXplOiBudW1iZXI7IHRvdGFsOiBudW1iZXI7IGRhdGE6IGFueTsgcGFnZUluZGV4OiBudW1iZXIgfT4oKTtcclxuXHJcblxyXG4gICAgQFZpZXdDaGlsZCgnY2hlY2thbGwnKSBjaGVja2FsbEVsOiBEVENoZWNrYm94Q29tcG9uZW50O1xyXG5cclxuICAgIHNvcnRUeXBlID0ge307XHJcbiAgICBmaWx0ZXJGaWVsZHMgPSB7fTtcclxuICAgIGNsaWNrZWRVcCA9IGZhbHNlO1xyXG4gICAgY2xpY2tlZERvd24gPSBmYWxzZTtcclxuICAgIGNvcHlDb2x1bW5zOiBhbnk7XHJcbiAgICBjb3B5Um93czogYW55O1xyXG4gICAgb3JpZ2luUm93czogYW55O1xyXG4gICAgaXNDaGVja0FsbCA9IGZhbHNlO1xyXG4gICAgYWxsQ2xhc3MgPSAnICc7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBkYXRhU2VydmljZTogRGF0YVRhYmxlU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHB1YmxpYyB1dGlsczogQ29tbW9uVXRpbHMsXHJcbiAgICAgICAgcHJpdmF0ZSBkdDogRGF0YVRhYmxlQ29tcG9uZW50XHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmFsbENsYXNzICs9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QudmFsdWU7XHJcblxyXG5cclxuICAgICAgICB0aGlzLmRhdGFTZXJ2aWNlLnVwZGF0ZUNoZWNrQWxsU3RhdHVzLnN1YnNjcmliZSggKG46IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBpZiAobiAhPT0gMikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc0NoZWNrQWxsID0gbiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuY2hlY2thbGxFbC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2hlY2tlZCA9IHRoaXMuaXNDaGVja0FsbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNDaGVja0FsbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5jaGVja2FsbEVsLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHdpZHRoID0gJzEwMCUnO1xyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZml4ZWQgPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb252ZXJ0Q29sdW1ucyh0aGlzLmNvbHVtbnMsICdsZWZ0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkID09PSAncmlnaHQnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sdW1ucyA9IGNvbnZlcnRDb2x1bW5zKHRoaXMuY29sdW1ucywgJ3JpZ2h0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge31cclxuXHJcbiAgICBvbkNoZWNrZWRDaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5pc0NoZWNrQWxsID0gJGV2ZW50LmNoZWNrZWQ7XHJcbiAgICAgICAgdGhpcy5jaGVja2VkQWxsLmVtaXQoJGV2ZW50LmNoZWNrZWQpO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlUm93Q2xhc3NOYW1lKHJvdywgaW5kZXgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3dDbGFzc05hbWUgPyB0aGlzLnJvd0NsYXNzTmFtZShyb3csIGluZGV4KSA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29tcGFyZShhLCBiKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhICA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gYSA9PT0gYiA/IDAgOiAoYSA+IGIgPyAxIDogLTEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgX3NvcnQocjEsIHIyKSB7XHJcbiAgICAgICAgbGV0IHIgPSAwO1xyXG4gICAgICAgIGNvbnN0IHNvcnRGaWVsZHMgPSB0aGlzLmR0LnNvcnROYW1lLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJzID0gdGhpcy5kdC5zb3J0T3JkZXIuc3BsaXQoJywnKTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmR0LnNvcnROYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3J0RmllbGRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNuID0gc29ydEZpZWxkc1tpXTtcclxuICAgICAgICAgICAgY29uc3Qgc28gPSBvcmRlcnNbaV07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmNvbHVtbnMuZmluZChjID0+IGMuZmllbGQgPT09IHNuKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyYnkgPSBjb2xbJ3NvcnRlciddIHx8IHRoaXMuY29tcGFyZTtcclxuICAgICAgICAgICAgbGV0IHYxID0gdGhpcy51dGlscy5nZXRWYWx1ZShzbiwgcjEpO1xyXG4gICAgICAgICAgICBpZiAodjEgPT09IG51bGwgfHwgdjEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdjEgPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgdjIgPSB0aGlzLnV0aWxzLmdldFZhbHVlKHNuLCByMik7XHJcbiAgICAgICAgICAgIGlmICh2MiA9PT0gbnVsbCB8fCB2MiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB2MiA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHIgPSBvcmRlcmJ5KHYxLCB2Mik7XHJcbiAgICAgICAgICAgIGlmIChyICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gciAqIChzbyA9PT0gJ2FzYycgPyAxIDogLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBjbGllbnRTb3J0KCkge1xyXG4gICAgICAgIGNvbnN0IHNvcnRlZERhdGEgPSB0aGlzLmRhdGEuc29ydCh0aGlzLl9zb3J0LmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMubG9hZERhdGEuZW1pdChzb3J0ZWREYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBvblNvcnRDb2x1bW5DbGljaygkZXZlbnQsIGNvbCkge1xyXG4gICAgICAgIGlmICghY29sLnNvcnRhYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc29ydE5hbWUgPSB0aGlzLmR0LnNvcnROYW1lO1xyXG4gICAgICAgIGNvbnN0IHNvcnRPcmRlciA9IHRoaXMuZHQuc29ydE9yZGVyO1xyXG4gICAgICAgIGxldCBzb3J0RmllbGRzID0gW107XHJcbiAgICAgICAgbGV0IHNvcnRPcmRlcnMgPSBbXTtcclxuICAgICAgICBpZiAoc29ydE5hbWUpIHtcclxuICAgICAgICAgICAgc29ydEZpZWxkcyA9IHNvcnROYW1lLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgICAgIHNvcnRPcmRlcnMgPSBzb3J0T3JkZXIuc3BsaXQoJywnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbE9yZGVyID0gY29sLm9yZGVyIHx8ICdhc2MnO1xyXG4gICAgICAgIGxldCBuZXdPcmRlciA9IGNvbE9yZGVyO1xyXG4gICAgICAgIGNvbnN0IGkgPSBzb3J0RmllbGRzLmZpbmRJbmRleChuID0+IG4gPT09IGNvbC5maWVsZCk7XHJcbiAgICAgICAgaWYgKGkgPj0gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBfb3JkZXIgPSBzb3J0T3JkZXJzW2ldID09PSAnYXNjJyA/ICdkZXNjJyA6ICdhc2MnO1xyXG4gICAgICAgICAgICBuZXdPcmRlciA9IF9vcmRlcjtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZHQubXVsdGlTb3J0ICYmIG5ld09yZGVyID09PSAnYXNjJykge1xyXG4gICAgICAgICAgICAgICAgbmV3T3JkZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBzb3J0RmllbGRzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIHNvcnRPcmRlcnMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNvcnRGaWVsZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEZpZWxkcy5wdXNoKGNvbC5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydE9yZGVycy5wdXNoKCdhc2MnKTtcclxuICAgICAgICAgICAgICAgICAgICBuZXdPcmRlciA9ICdhc2MnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVyc1tpXSA9IF9vcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmR0Lm11bHRpU29ydCkge1xyXG4gICAgICAgICAgICAgICAgc29ydEZpZWxkcy5wdXNoKGNvbC5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICBzb3J0T3JkZXJzLnB1c2goY29sT3JkZXIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc29ydEZpZWxkcyA9IFtjb2wuZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgc29ydE9yZGVycyA9IFtjb2xPcmRlcl07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbC5vcmRlciA9IG5ld09yZGVyO1xyXG5cclxuICAgICAgICB0aGlzLmR0LnNvcnROYW1lID0gc29ydEZpZWxkcy5qb2luKCcsJyk7XHJcbiAgICAgICAgdGhpcy5kdC5zb3J0T3JkZXIgPSBzb3J0T3JkZXJzLmpvaW4oJywnKTtcclxuICAgICAgICAvLyB0aGlzLmRmcy5zZXRTb3J0SW5mbyh0aGlzLmRnLnNvcnROYW1lLCB0aGlzLmRnLnNvcnRPcmRlcik7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kdC5tdWx0aVNvcnQpIHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlRmllbGRPcmRlciA9IChjb2xzOiBEYXRhQ29sdW1uW10pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghY29scyB8fCAhY29scy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb2xzLmZvckVhY2goYyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYy5vcmRlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrID0gc29ydEZpZWxkcy5maW5kSW5kZXgoZiA9PiBmID09PSBjLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoayA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGMub3JkZXIgPSBzb3J0T3JkZXJzW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlRmllbGRPcmRlcih0aGlzLmNvbHVtbnMpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZHQuYmVmb3JlU29ydENvbHVtbih0aGlzLmR0LnNvcnROYW1lLCB0aGlzLmR0LnNvcnRPcmRlcikuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZHQucmVtb3RlU29ydCkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5yZWxvYWQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50U29ydCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmR0LmNvbHVtblNvcnRlZC5lbWl0KHsgc29ydE5hbWU6IHRoaXMuZHQuc29ydE5hbWUsIHNvcnRPcmRlcjogdGhpcy5kdC5zb3J0T3JkZXIgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVlcENvcHlEYXRhKCkge1xyXG4gICAgICAgIGNvbnN0IGNvcHlDb2x1bW5zID0gZGVlcENvcHkodGhpcy5jb2x1bW5zKTtcclxuICAgICAgICBjb25zdCBjb3B5Um93cyA9IGRlZXBDb3B5KHRoaXMucm93cyk7XHJcbiAgICAgICAgY29weUNvbHVtbnMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgZWxlbWVudC5zb3J0VHlwZSA9ICdub3JtYWwnO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNvcHlDb2x1bW5zLFxyXG4gICAgICAgICAgICBjb3B5Um93c1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKiDoi6XlrZjlnKjnrZvpgInmnaHku7Yg5L+d5a2Y5oyJ6ZKu5Y+v54K55Ye7XHJcbiAgICAgKi9cclxuICAgIGhhc0NoZWNrZWQoY29sKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyRmllbGRzLmhhc093blByb3BlcnR5KGNvbC5maWVsZCkpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJGaWVsZHNbY29sLmZpZWxkXS5zb21lKGVsZSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlLmNoZWNrZWQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuIl19